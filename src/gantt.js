!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VTableGantt={})}(this,(function(t){"use strict";var e,i,n,o;!function(t){t.default="default",t.grabing="grabing",t.scrolling="scrolling"}(e||(e={})),function(t){t.FinishToStart="finish_to_start",t.StartToStart="start_to_start",t.FinishToFinish="finish_to_finish",t.StartToFinish="start_to_finish"}(i||(i={})),function(t){t.Tasks_Separate="tasks_separate",t.Sub_Tasks_Inline="sub_tasks_inline",t.Sub_Tasks_Separate="sub_tasks_separate",t.Sub_Tasks_Arrange="sub_tasks_arrange",t.Sub_Tasks_Compact="sub_tasks_compact",t.Project_Sub_Tasks_Inline="project_sub_tasks_inline"}(n||(n={})),function(t){t.TASK="task",t.PROJECT="project",t.MILESTONE="milestone"}(o||(o={}));const r={SCROLL:"scroll",CHANGE_DATE_RANGE:"change_date_range",CLICK_TASK_BAR:"click_task_bar",CONTEXTMENU_TASK_BAR:"contextmenu_task_bar",MOUSEENTER_TASK_BAR:"mouseenter_task_bar",MOUSELEAVE_TASK_BAR:"mouseleave_task_bar",CREATE_TASK_SCHEDULE:"create_task_schedule",CREATE_DEPENDENCY_LINK:"create_dependency_link",DELETE_DEPENDENCY_LINK:"delete_dependency_link",CLICK_DEPENDENCY_LINK_POINT:"click_dependency_link_point",CONTEXTMENU_DEPENDENCY_LINK:"contextmenu_dependency_link",CLICK_MARKLINE_CREATE:"click_markline_create",CLICK_MARKLINE_CONTENT:"click_markline_content"};var s=Object.freeze({__proto__:null,get DependencyType(){return i},GANTT_EVENT_TYPE:r,get InteractionState(){return e},get TaskType(){return o},get TasksShowMode(){return n}});class a{static GenAutoIncrementId(){return a.auto_increment_id++}}a.auto_increment_id=0;class l{constructor(t){this.id=a.GenAutoIncrementId(),this.registry=t}}const h="named",d="inject",c="multi_inject",u="inversify:tagged",g="inversify:paramtypes";class p{constructor(t,e){this.key=t,this.value=e}toString(){return this.key===h?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}var f=function(t){var e;return function(t){const e="function"==typeof Symbol&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=Object.getPrototypeOf(Function),n=("object"==typeof process&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL,Map),o=new WeakMap;function r(t,e,i){let r=o.get(t);if(h(r)){if(!i)return;r=new n,o.set(t,r)}let s=r.get(e);if(h(s)){if(!i)return;s=new n,r.set(e,s)}return s}function s(t,e,i){if(a(t,e,i))return!0;const n=f(e);return!d(n)&&s(t,n,i)}function a(t,e,i){const n=r(e,i,!1);return!h(n)&&!!n.has(t)}function l(t,e,i){if(a(t,e,i))return function(t,e,i){const n=r(e,i,!1);if(!h(n))return n.get(t)}(t,e,i);const n=f(e);return d(n)?void 0:l(t,n,i)}function h(t){return void 0===t}function d(t){return null===t}function c(t){return"object"==typeof t?null!==t:"function"==typeof t}function u(t,i){switch(function(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}const n=3===i?"string":5===i?"number":"default",o=function(t,e){const i=t[e];if(null!=i){if(!p(i))throw new TypeError;return i}}(t,e);if(void 0!==o){const e=o.call(t,n);if(c(e))throw new TypeError;return e}return function(t,e){if("string"===e){const e=t.toString;if(p(e)){const i=e.call(t);if(!c(i))return i}const i=t.valueOf;if(p(i)){const e=i.call(t);if(!c(e))return e}}else{const e=t.valueOf;if(p(e)){const i=e.call(t);if(!c(i))return i}const i=t.toString;if(p(i)){const e=i.call(t);if(!c(e))return e}}throw new TypeError}(t,"default"===n?"number":n)}function g(t){const e=u(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function p(t){return"function"==typeof t}function f(t){const e=Object.getPrototypeOf(t);if("function"!=typeof t||t===i)return e;if(e!==i)return e;const n=t.prototype,o=n&&Object.getPrototypeOf(n);if(null==o||o===Object.prototype)return e;const r=o.constructor;return"function"!=typeof r||r===t?e:r}t("defineMetadata",(function(t,e,i,n){if(!c(i))throw new TypeError;return o=t,s=e,void r(i,n,!0).set(o,s);var o,s})),t("hasMetadata",(function(t,e,i){if(!c(e))throw new TypeError;return h(i)||(i=g(i)),s(t,e,i)})),t("hasOwnMetadata",(function(t,e,i){if(!c(e))throw new TypeError;return h(i)||(i=g(i)),a(t,e,i)})),t("getMetadata",(function(t,e,i){if(!c(e))throw new TypeError;return h(i)||(i=g(i)),l(t,e,i)}))}((e=t,function(t,i){"function"!=typeof e[t]&&Object.defineProperty(e,t,{configurable:!0,writable:!0,value:i})})),t}({});function v(t,e,i,n){!function(t,e,i,n){const o=[n];let r={};f.hasOwnMetadata(t,e)&&(r=f.getMetadata(t,e));let s=r[i];void 0===s&&(s=[]),s.push(...o),r[i]=s,f.defineMetadata(t,r,e)}(u,t,i.toString(),n)}function b(t){return(e,i,n)=>{v(e,0,n,t)}}function m(t){return e=>(i,n,o)=>b(new p(t,e))(i,n,o)}const y=m(d),C=m(c);function w(){return function(t){return f.defineMetadata(g,null,t),t}}function x(t){return b(new p(h,t))}const _="Singleton",S="Transient",A="ConstantValue",B="DynamicValue",T="Factory",R="Function",k="Instance",M="Invalid";class L{constructor(t,e){this.id=a.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=M,this.constraint=t=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){const t=new L(this.serviceIdentifier,this.scope);return t.activated=t.scope===_&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.provider=this.provider,t.constraint=this.constraint,t.cache=this.cache,t}}class P{getConstructorMetadata(t){return{compilerGeneratedMetadata:f.getMetadata(g,t),userGeneratedMetadata:f.getMetadata(u,t)||{}}}getPropertiesMetadata(t){throw new Error("暂未实现")}}const E=(H=h,t=>{const e=e=>{if(null==e)return!1;if(e.key===H&&e.value===t)return!0;if(null==e.constructorArgsMetadata)return!1;const i=e.constructorArgsMetadata;for(let e=0;e<i.length;e++)if(i[e].key===H&&i[e].value===t)return!0;return!1};return e.metaData=new p(H,t),e});var H;class O{constructor(t){this._binding=t}inRequestScope(){throw new Error("暂未实现")}inSingletonScope(){return this._binding.scope=_,this}inTransientScope(){return this._binding.scope=S,this}whenTargetNamed(t){return this._binding.constraint=E(t),this}}class I{constructor(t){this._binding=t}to(t){return this._binding.type=k,this._binding.implementationType=t,new O(this._binding)}toSelf(){const t=this._binding.serviceIdentifier;return this.to(t)}toDynamicValue(t){return this._binding.type=B,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new O(this._binding)}toConstantValue(t){return this._binding.type=A,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=_,new O(this._binding)}toFactory(t){return this._binding.type=T,this._binding.factory=t,this._binding.scope=_,new O(this._binding)}toService(t){this.toDynamicValue((e=>e.container.get(t)))}}const F=Symbol("ContributionProvider");class z{constructor(t,e){this.serviceIdentifier=t,this.container=e,W.setStore(this.serviceIdentifier,this)}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}refresh(){this.caches&&(this.caches.length=0,this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier)))}}function D(t,e){t(F).toDynamicValue((t=>{let{container:i}=t;return new z(e,i)})).inSingletonScope().whenTargetNamed(e)}class W{static getStore(t){return this.store.get(t)}static setStore(t,e){this.store.set(t,e)}static refreshAllContributions(){this.store.forEach((t=>{t.refresh()}))}}W.store=new Map;class N{constructor(t,e){this._args=t,this.name=e,this.taps=[]}tap(t,e){this._tap("sync",t,e)}unTap(t,e){const i="string"==typeof t?t.trim():t.name;i&&(this.taps=this.taps.filter((t=>!(t.name===i&&(!e||t.fn===e)))))}_parseOptions(t,e,i){let n;if("string"==typeof e)n={name:e.trim()};else if("object"!=typeof e||null===e)throw new Error("Invalid tap options");if("string"!=typeof n.name||""===n.name)throw new Error("Missing name for tap");return n=Object.assign({type:t,fn:i},n),n}_tap(t,e,i){this._insert(this._parseOptions(t,e,i))}_insert(t){let e;"string"==typeof t.before?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let i=0;"number"==typeof t.stage&&(i=t.stage);let n=this.taps.length;for(;n>0;){n--;const t=this.taps[n];this.taps[n+1]=t;const o=t.stage||0;if(e){if(e.has(t.name)){e.delete(t.name);continue}if(e.size>0)continue}if(!(o>i)){n++;break}}this.taps[n]=t}}class G extends N{call(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.taps.map((t=>t.fn)).forEach((t=>t(...e)))}}const j=Symbol.for("EnvContribution"),V=Symbol.for("VGlobal");class U{constructor(){this._listenerMap=new Map,this._eventListenerTransformer=t=>t}setEventListenerTransformer(t){this._eventListenerTransformer=t||(t=>t)}addEventListener(t,e,i){if(!e)return;const n=t=>{const i=this._eventListenerTransformer(t);"function"==typeof e?e(i):e.handleEvent&&e.handleEvent(i)};this._listenerMap.has(t)||this._listenerMap.set(t,new Map),this._listenerMap.get(t).set(e,n),this._nativeAddEventListener(t,n,i)}removeEventListener(t,e,i){var n;if(!e)return;const o=null===(n=this._listenerMap.get(t))||void 0===n?void 0:n.get(e);o&&(this._nativeRemoveEventListener(t,o,i),this._listenerMap.get(t).delete(e),0===this._listenerMap.get(t).size&&this._listenerMap.delete(t))}dispatchEvent(t){return this._nativeDispatchEvent(t)}clearAllEventListeners(){this._listenerMap.forEach(((t,e)=>{t.forEach(((t,i)=>{this._nativeRemoveEventListener(e,t,void 0)}))})),this._listenerMap.clear()}_nativeAddEventListener(t,e,i){throw new Error("_nativeAddEventListener must be implemented by derived classes")}_nativeRemoveEventListener(t,e,i){throw new Error("_nativeRemoveEventListener must be implemented by derived classes")}_nativeDispatchEvent(t){throw new Error("_nativeDispatchEvent must be implemented by derived classes")}}var X=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},$=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Y=function(t,e){return function(i,n){e(i,n,t)}},K=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))};let q=class extends U{get env(){return this._env}get isImageAnonymous(){return this._isImageAnonymous}set isImageAnonymous(t){this._isImageAnonymous=t}get devicePixelRatio(){return this._env||this.setEnv("browser"),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv("browser"),this.envContribution.supportEvent}set supportEvent(t){this._env||this.setEnv("browser"),this.envContribution.supportEvent=t}get supportsTouchEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents}set supportsTouchEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents=t}get supportsPointerEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents}set supportsPointerEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents=t}get supportsMouseEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents}set supportsMouseEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents=t}get applyStyles(){return this._env||this.setEnv("browser"),this.envContribution.applyStyles}set applyStyles(t){this._env||this.setEnv("browser"),this.envContribution.applyStyles=t}constructor(t){super(),this.contributions=t,this._isImageAnonymous=!0,this.eventListenerTransformer=t=>t,this.id=a.GenAutoIncrementId(),this.hooks={onSetEnv:new G(["lastEnv","env","global"])},this.measureTextMethod="native",this.optimizeVisible=!1}_nativeAddEventListener(t,e,i){return this._env||this.setEnv("browser"),this.envContribution.addEventListener(t,e,i)}_nativeRemoveEventListener(t,e,i){return this._env||this.setEnv("browser"),this.envContribution.removeEventListener(t,e,i)}_nativeDispatchEvent(t){return this._env||this.setEnv("browser"),this.envContribution.dispatchEvent(t)}bindContribution(t){const e=[];if(this.contributions.getContributions().forEach((i=>{const n=i.configure(this,t);n&&n.then&&e.push(n)})),e.length)return Promise.all(e)}getDynamicCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getStaticCanvasCount()}setEnv(t,e){if(e&&!0===e.force||this._env!==t)return this.deactiveCurrentEnv(),this.activeEnv(t,e)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(t,e){const i=this._env;this._env=t;const n=this.bindContribution(e);if(n&&n.then)return n.then((()=>{this.envParams=e,this.hooks.onSetEnv.call(i,t,this)}));this.envParams=e,this.hooks.onSetEnv.call(i,t,this)}setActiveEnvContribution(t){this.envContribution=t}createCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.createCanvas(t)}createOffscreenCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.createOffscreenCanvas(t)}releaseCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.releaseCanvas(t)}getRequestAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getRequestAnimationFrame()}getCancelAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getCancelAnimationFrame()}getElementById(t){return this._env||this.setEnv("browser"),this.envContribution.getElementById?this.envContribution.getElementById(t):null}getRootElement(){return this._env||this.setEnv("browser"),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv("browser"),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(t,e){return this._env||this.setEnv("browser"),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(t,e):null}loadImage(t){return this._env||this.setEnv("browser"),this.envContribution.loadImage(t)}loadSvg(t){return this._env||this.setEnv("browser"),this.envContribution.loadSvg(t)}loadJson(t){return this._env||this.setEnv("browser"),this.envContribution.loadJson(t)}loadArrayBuffer(t){return this._env||this.setEnv("browser"),this.envContribution.loadArrayBuffer(t)}loadBlob(t){return this._env||this.setEnv("browser"),this.envContribution.loadBlob(t)}loadFont(t,e,i){return K(this,void 0,void 0,(function*(){return this._env||this.setEnv("browser"),this.envContribution.loadFont(t,e,i)}))}isChrome(){return null!=this._isChrome||(this._env||this.setEnv("browser"),this._isChrome="browser"===this._env&&navigator.userAgent.indexOf("Chrome")>-1),this._isChrome}isSafari(){return null!=this._isSafari||(this._env||this.setEnv("browser"),this._isSafari="browser"===this._env&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(t){return this._env||this.setEnv("browser"),this.envContribution.getNativeAABBBounds(t)}removeDom(t){return this._env||this.setEnv("browser"),this.envContribution.removeDom(t)}createDom(t){return this._env||this.setEnv("browser"),this.envContribution.createDom(t)}updateDom(t,e){return this._env||this.setEnv("browser"),this.envContribution.updateDom(t,e)}getElementTop(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._env||this.setEnv("browser"),this.envContribution.getElementTop(t,e)}getElementLeft(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._env||this.setEnv("browser"),this.envContribution.getElementLeft(t,e)}getElementTopLeft(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._env||this.setEnv("browser"),this.envContribution.getElementTopLeft(t,e)}isMacOS(){return this._env||this.setEnv("browser"),this.envContribution.isMacOS()}copyToClipBoard(t){return this._env||this.setEnv("browser"),this.envContribution.copyToClipBoard(t)}};var Z;q=X([w(),Y(0,y(F)),Y(0,x(j)),$("design:paramtypes",[Object])],q),function(t){t[t.estimate=0]="estimate",t[t.actualBounding=1]="actualBounding",t[t.fontBounding=2]="fontBounding"}(Z||(Z={}));var J="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Q(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var tt={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}function o(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(t,e,n,r,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,r||t,s),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,n,o=[];if(0===this._eventsCount)return o;for(n in t=this._events)e.call(t,n)&&o.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},a.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,r=n.length,s=new Array(r);o<r;o++)s[o]=n[o].fn;return s},a.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,o,r,s){var a=i?i+t:t;if(!this._events[a])return!1;var l,h,d=this._events[a],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(t,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,e),!0;case 3:return d.fn.call(d.context,e,n),!0;case 4:return d.fn.call(d.context,e,n,o),!0;case 5:return d.fn.call(d.context,e,n,o,r),!0;case 6:return d.fn.call(d.context,e,n,o,r,s),!0}for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];d.fn.apply(d.context,l)}else{var u,g=d.length;for(h=0;h<g;h++)switch(d[h].once&&this.removeListener(t,d[h].fn,void 0,!0),c){case 1:d[h].fn.call(d[h].context);break;case 2:d[h].fn.call(d[h].context,e);break;case 3:d[h].fn.call(d[h].context,e,n);break;case 4:d[h].fn.call(d[h].context,e,n,o);break;default:if(!l)for(u=1,l=new Array(c-1);u<c;u++)l[u-1]=arguments[u];d[h].fn.apply(d[h].context,l)}}return!0},a.prototype.on=function(t,e,i){return r(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return r(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,n,o){var r=i?i+t:t;if(!this._events[r])return this;if(!e)return s(this,r),this;var a=this._events[r];if(a.fn)a.fn!==e||o&&!a.once||n&&a.context!==n||s(this,r);else{for(var l=0,h=[],d=a.length;l<d;l++)(a[l].fn!==e||o&&!a[l].once||n&&a[l].context!==n)&&h.push(a[l]);h.length?this._events[r]=1===h.length?h[0]:h:s(this,r)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&s(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a}(tt);var et=Q(tt.exports);var it=(t,e)=>Object.prototype.toString.call(t)===`[object ${e}]`;var nt=function(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"boolean"==typeof t:!0===t||!1===t||it(t,"Boolean")};var ot=t=>"function"==typeof t;var rt=t=>null==t;var st=t=>null!=t;var at=t=>{const e=typeof t;return null!==t&&"object"===e||"function"===e};var lt=t=>"object"==typeof t&&null!==t;var ht=function(t){if(!lt(t)||!it(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};var dt=t=>void 0===t;var ct=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"string"===e:"string"===e||it(t,"String")};var ut=t=>Array.isArray?Array.isArray(t):it(t,"Array");var gt=function(t){return null!==t&&"function"!=typeof t&&Number.isFinite(t.length)};var pt=t=>it(t,"Date");var ft=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"number"===e:"number"===e||it(t,"Number")};var vt=t=>ft(t)&&Number.isFinite(t);var bt=t=>new RegExp(/^(http(s)?:\/\/)\w+[^\s]+(\.[^\s]+){1,}$/).test(t);var mt=t=>new RegExp(/^data:image\/(?:gif|png|jpeg|bmp|webp|svg\+xml)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/g).test(t);var yt=t=>({}.toString.call(t).replace(/^\[object /,"").replace(/]$/,""));const Ct=Object.prototype;var wt=function(t){const e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ct)};const xt=Object.prototype.hasOwnProperty;function _t(t){if(rt(t))return!0;if(gt(t))return!t.length;const e=yt(t);if("Map"===e||"Set"===e)return!t.size;if(wt(t))return!Object.keys(t).length;for(const e in t)if(xt.call(t,e))return!1;return!0}var St=(t,e,i)=>{const n=ct(e)?e.split("."):e;for(let e=0;e<n.length;e++)t=t?t[n[e]]:void 0;return void 0===t?i:t};const At=Object.prototype.hasOwnProperty;var Bt=(t,e)=>null!=t&&At.call(t,e);function Tt(t,e,i){let n;if(!st(t)||"object"!=typeof t||e&&e(t))return t;const o=ut(t),r=t.length;n=o?new Array(r):"object"==typeof t?{}:nt(t)||ft(t)||ct(t)?t:pt(t)?new Date(+t):void 0;const s=o?void 0:Object.keys(Object(t));let a=-1;if(n)for(;++a<(s||t).length;){const o=s?s[a]:a,r=t[o];i&&i.includes(o.toString())?n[o]=r:n[o]=Tt(r,e,i)}return n}function Rt(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e){if(t===e)return;if(st(e)&&"object"==typeof e){const o=Object(e),r=[];for(const t in o)r.push(t);let{length:s}=r,a=-1;for(;s--;){const s=r[++a];!st(o[s])||"object"!=typeof o[s]||n&&ut(t[s])?Mt(t,s,o[s]):kt(t,e,s,i,n)}}}}function kt(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=t[i],s=e[i];let a=e[i],l=!0;if(ut(s)){if(n)a=[];else if(ut(r))a=r;else if(gt(r)){a=new Array(r.length);let t=-1;const e=r.length;for(;++t<e;)a[t]=r[t]}}else ht(s)?(a=null!=r?r:{},"function"!=typeof r&&"object"==typeof r||(a={})):l=!1;l&&Rt(a,s,n,o),Mt(t,i,a)}function Mt(t,e,i){(void 0!==i&&!function(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}(t[e],i)||void 0===i&&!(e in t))&&(t[e]=i)}function Lt(t){let e=-1;const i=arguments.length<=1?0:arguments.length-1;for(;++e<i;)Rt(t,e+1<1||arguments.length<=e+1?void 0:arguments[e+1],!0);return t}function Pt(t,e,i){const n=function(t){if(!t)return[];if(Object.keys)return Object.keys(t);const e=[];for(const i in t)t.hasOwnProperty(i)&&e.push(i);return e}(e);for(let o=0;o<n.length;o++){const r=n[o];(i?null!=e[r]:null==t[r])&&(t[r]=e[r])}return t}function Et(t){return st(t)?ut(t)?t:[t]:[]}function Ht(t){if(gt(t))return t[t.length-1]}const Ot=(t,e)=>{var i;if(0===t.length)return;let n=t[0];for(let o=1;o<t.length;o++){const r=t[o];(null!==(i=null==e?void 0:e(r,n))&&void 0!==i?i:r-n)>0&&(n=r)}return n},It=(t,e)=>{var i;if(0===t.length)return;let n=t[0];for(let o=1;o<t.length;o++){const r=t[o];(null!==(i=null==e?void 0:e(r,n))&&void 0!==i?i:r-n)<0&&(n=r)}return n};function Ft(t,e){if(!ut(t)||!ut(e))return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function zt(t){if(!ut(t))return[t];const e=[];for(const i of t)e.push(...zt(i));return e}function Dt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Wt(t){return Number(t)}const Nt="undefined"!=typeof console;function Gt(t,e,i){const n=[e].concat([].slice.call(i));Nt&&console[t].apply(console,n)}var jt;!function(t){t[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug"}(jt||(jt={}));let Vt=class t{static getInstance(e,i){return t._instance&&ft(e)?t._instance.level(e):t._instance||(t._instance=new t(e,i)),t._instance}static setInstance(e){return t._instance=e}static setInstanceLevel(e){t._instance?t._instance.level(e):t._instance=new t(e)}static clearInstance(){t._instance=null}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jt.None,e=arguments.length>1?arguments[1]:void 0;this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find((e=>e===t))||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex((e=>e===t));e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this._onErrorHandler.forEach((t=>t(...e)))}canLogInfo(){return this._level>=jt.Info}canLogDebug(){return this._level>=jt.Debug}canLogError(){return this._level>=jt.Error}canLogWarn(){return this._level>=jt.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return this._level>=jt.Error&&(this._onErrorHandler.length?this.callErrorHandler(...i):Gt(null!==(t=this._method)&&void 0!==t?t:"error","ERROR",i)),this}warn(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=jt.Warn&&Gt(this._method||"warn","WARN",e),this}info(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=jt.Info&&Gt(this._method||"log","INFO",e),this}debug(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=jt.Debug&&Gt(this._method||"log","DEBUG",e),this}};Vt._instance=null;function Ut(t,e){const i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-10,n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-10)*Math.max(t,e);return Math.abs(t-e)<=Math.max(i,n)}const Xt=t=>{let e=null,i=null;return function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return e&&o.every(((t,i)=>t===e[i]))||(e=o,i=t(...o)),i}};var $t=function(t,e,i){return t<e?e:t>i?i:t};var Yt=(t,e,i)=>{let[n,o]=t;o<n&&(n=t[1],o=t[0]);const r=o-n;return r>=i-e?[e,i]:(n=Math.min(Math.max(n,e),i-r),[n,n+r])};let Kt=!1;try{Kt="function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame}catch(t){Kt=!1}function qt(t,e,i){let n,o,r,s,a,l,h=0,d=!1,c=!1,u=!0;const g=!e&&0!==e&&Kt;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){const i=n,r=o;return n=o=void 0,h=e,s=t.apply(r,i),s}function f(t,e){return g?(cancelAnimationFrame(a),requestAnimationFrame(t)):setTimeout(t,e)}function v(t){const i=t-l;return void 0===l||i>=e||i<0||c&&t-h>=r}function b(){const t=Date.now();if(v(t))return m(t);a=f(b,function(t){const i=t-h,n=e-(t-l);return c?Math.min(n,r-i):n}(t))}function m(t){return a=void 0,u&&n?p(t):(n=o=void 0,s)}function y(){const t=Date.now(),i=v(t);for(var r=arguments.length,u=new Array(r),g=0;g<r;g++)u[g]=arguments[g];if(n=u,o=this,l=t,i){if(void 0===a)return function(t){return h=t,a=f(b,e),d?p(t):s}(l);if(c)return a=f(b,e),p(l)}return void 0===a&&(a=f(b,e)),s}return e=+e||0,at(i)&&(d=!!i.leading,c="maxWait"in i,c&&(r=Math.max(vt(i.maxWait)?i.maxWait:0,e)),u="trailing"in i?!!i.trailing:u),y.cancel=function(){void 0!==a&&function(t){if(g)return cancelAnimationFrame(t);clearTimeout(t)}(a),h=0,n=l=o=a=void 0},y.flush=function(){return void 0===a?s:m(Date.now())},y.pending=function(){return void 0!==a},y}function Zt(t,e,i){let n=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return at(i)&&(n="leading"in i?!!i.leading:n,o="trailing"in i?!!i.trailing:o),qt(t,e,{leading:n,trailing:o,maxWait:e})}function Jt(t,e){return i=>t*(1-i)+e*i}function Qt(t,e){return function(i){return Math.round(t*(1-i)+e*i)}}Kt=!1;const te=1e-12,ee=Math.PI,ie=ee/2,ne=2*ee,oe=2*Math.PI,re=Math.abs,se=Math.atan2,ae=Math.cos,le=Math.max,he=Math.min,de=Math.sin,ce=Math.sqrt,ue=Math.pow;function ge(t){return t>=1?ie:t<=-1?-ie:Math.asin(t)}function pe(t,e,i,n,o){let r=i,s=n;return"number"==typeof t&&"number"==typeof i&&(r=(1-o)*t+o*i),"number"==typeof e&&"number"==typeof n&&(s=(1-o)*e+o*n),{x:r,y:s}}class fe{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;this.x=0,this.y=0,this.x=t,this.y=e,this.x1=i,this.y1=n}clone(){return new fe(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x1=t.x1,this.y1=t.y1,this.defined=t.defined,this.context=t.context,this}set(t,e){return this.x=t,this.y=e,this}add(t){return ft(t)?(this.x+=t,void(this.y+=t)):(this.x+=t.x,this.y+=t.y,this)}sub(t){return ft(t)?(this.x-=t,void(this.y-=t)):(this.x-=t.x,this.y-=t.y,this)}multi(t){throw new Error("暂不支持")}div(t){throw new Error("暂不支持")}}class ve{static distancePP(t,e){return ce(ue(t.x-e.x,2)+ue(t.y-e.y,2))}static distanceNN(t,e,i,n){return ce(ue(t-i,2)+ue(e-n,2))}static distancePN(t,e,i){return ce(ue(e-t.x,2)+ue(i-t.y,2))}static pointAtPP(t,e,i){return new fe((e.x-t.x)*i+t.x,(e.y-t.y)*i+t.y)}}function be(t){return t*(Math.PI/180)}const me=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t<0)for(;t<-ne;)t+=ne;else if(t>0)for(;t>ne;)t-=ne;return t};function ye(t){for(;t<0;)t+=2*Math.PI;for(;t>=2*Math.PI;)t-=2*Math.PI;return t}function Ce(t,e,i){if(null===t)return e;if(null===e)return t;const{x11:n,x12:o,y11:r,y12:s,x21:a,x22:l,y21:h,y22:d}=xe(t,e,i);return n>=l||o<=a||r>=d||s<=h?{x1:0,y1:0,x2:0,y2:0}:{x1:Math.max(n,a),y1:Math.max(r,h),x2:Math.min(o,l),y2:Math.min(s,d)}}var we;!function(t){t[t.NONE=0]="NONE",t[t.BBOX1=1]="BBOX1",t[t.BBOX2=2]="BBOX2"}(we||(we={}));const xe=(t,e,i)=>{let n=t.x1,o=t.x2,r=t.y1,s=t.y2,a=e.x1,l=e.x2,h=e.y1,d=e.y2;return i&&(n>o&&([n,o]=[o,n]),r>s&&([r,s]=[s,r]),a>l&&([a,l]=[l,a]),h>d&&([h,d]=[d,h])),{x11:n,x12:o,y11:r,y12:s,x21:a,x22:l,y21:h,y22:d}};function _e(t,e,i){if(!t||!e)return we.NONE;const{x11:n,x12:o,y11:r,y12:s,x21:a,x22:l,y21:h,y22:d}=xe(t,e,i);return n>a&&o<l&&r>h&&s<d?we.BBOX1:a>n&&l<o&&h>r&&d<s?we.BBOX2:we.NONE}function Se(t,e,i){if(t&&e){if(!i)return!(t.x1>e.x2||t.x2<e.x1||t.y1>e.y2||t.y2<e.y1);const{x11:n,x12:o,y11:r,y12:s,x21:a,x22:l,y21:h,y22:d}=xe(t,e,!0);return!(n>l||o<a||r>d||s<h)}return!0}function Ae(t,e){return Math.abs(e[0]*t[0]+e[1]*t[1])}function Be(t,e){let{x:i,y:n}=t,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};return{x:(i-o.x)*Math.cos(e)-(n-o.y)*Math.sin(e)+o.x,y:(i-o.x)*Math.sin(e)+(n-o.y)*Math.cos(e)+o.y}}function Te(t){return{x:(t.x1+t.x2)/2,y:(t.y1+t.y2)/2}}function Re(t,e){const i=e?be(t.angle):t.angle,n=Te(t);return[Be({x:t.x1,y:t.y1},i,n),Be({x:t.x2,y:t.y1},i,n),Be({x:t.x2,y:t.y2},i,n),Be({x:t.x1,y:t.y2},i,n)]}function ke(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=Re(t,i),o=Re(e,i),r=(t,e)=>[e.x-t.x,e.y-t.y],s=r(Te(t),Te(e)),a=r(n[0],n[1]),l=r(n[1],n[2]),h=r(o[0],o[1]),d=r(o[1],o[2]),c=i?be(t.angle):t.angle;let u=i?be(90-t.angle):t.angle+ie;const g=i?be(e.angle):e.angle;let p=i?be(90-e.angle):e.angle+ie;u>oe&&(u-=oe),p>oe&&(p-=oe);const f=(t,e,i,n)=>{const o=[Math.cos(e),Math.sin(e)];return t+(Ae(o,i)+Ae(o,n))/2>Ae(o,s)};return f((t.x2-t.x1)/2,c,h,d)&&f((t.y2-t.y1)/2,u,h,d)&&f((e.x2-e.x1)/2,g,a,l)&&f((e.y2-e.y1)/2,p,a,l)}const Me=t=>{let e=t.charCodeAt(0),i=2===t.length?t.charCodeAt(1):0,n=e;return 55296<=e&&e<=56319&&56320<=i&&i<=57343&&(e&=1023,i&=1023,n=e<<10|i,n+=65536),12288===n||65281<=n&&n<=65376||65504<=n&&n<=65510?"F":8361===n||65377<=n&&n<=65470||65474<=n&&n<=65479||65482<=n&&n<=65487||65490<=n&&n<=65495||65498<=n&&n<=65500||65512<=n&&n<=65518?"H":4352<=n&&n<=4447||4515<=n&&n<=4519||4602<=n&&n<=4607||9001<=n&&n<=9002||11904<=n&&n<=11929||11931<=n&&n<=12019||12032<=n&&n<=12245||12272<=n&&n<=12283||12289<=n&&n<=12350||12353<=n&&n<=12438||12441<=n&&n<=12543||12549<=n&&n<=12589||12593<=n&&n<=12686||12688<=n&&n<=12730||12736<=n&&n<=12771||12784<=n&&n<=12830||12832<=n&&n<=12871||12880<=n&&n<=13054||13056<=n&&n<=19903||19968<=n&&n<=42124||42128<=n&&n<=42182||43360<=n&&n<=43388||44032<=n&&n<=55203||55216<=n&&n<=55238||55243<=n&&n<=55291||63744<=n&&n<=64255||65040<=n&&n<=65049||65072<=n&&n<=65106||65108<=n&&n<=65126||65128<=n&&n<=65131||110592<=n&&n<=110593||127488<=n&&n<=127490||127504<=n&&n<=127546||127552<=n&&n<=127560||127568<=n&&n<=127569||131072<=n&&n<=194367||177984<=n&&n<=196605||196608<=n&&n<=262141?"W":32<=n&&n<=126||162<=n&&n<=163||165<=n&&n<=166||172===n||175===n||10214<=n&&n<=10221||10629<=n&&n<=10630?"Na":161===n||164===n||167<=n&&n<=168||170===n||173<=n&&n<=174||176<=n&&n<=180||182<=n&&n<=186||188<=n&&n<=191||198===n||208===n||215<=n&&n<=216||222<=n&&n<=225||230===n||232<=n&&n<=234||236<=n&&n<=237||240===n||242<=n&&n<=243||247<=n&&n<=250||252===n||254===n||257===n||273===n||275===n||283===n||294<=n&&n<=295||299===n||305<=n&&n<=307||312===n||319<=n&&n<=322||324===n||328<=n&&n<=331||333===n||338<=n&&n<=339||358<=n&&n<=359||363===n||462===n||464===n||466===n||468===n||470===n||472===n||474===n||476===n||593===n||609===n||708===n||711===n||713<=n&&n<=715||717===n||720===n||728<=n&&n<=731||733===n||735===n||768<=n&&n<=879||913<=n&&n<=929||931<=n&&n<=937||945<=n&&n<=961||963<=n&&n<=969||1025===n||1040<=n&&n<=1103||1105===n||8208===n||8211<=n&&n<=8214||8216<=n&&n<=8217||8220<=n&&n<=8221||8224<=n&&n<=8226||8228<=n&&n<=8231||8240===n||8242<=n&&n<=8243||8245===n||8251===n||8254===n||8308===n||8319===n||8321<=n&&n<=8324||8364===n||8451===n||8453===n||8457===n||8467===n||8470===n||8481<=n&&n<=8482||8486===n||8491===n||8531<=n&&n<=8532||8539<=n&&n<=8542||8544<=n&&n<=8555||8560<=n&&n<=8569||8585===n||8592<=n&&n<=8601||8632<=n&&n<=8633||8658===n||8660===n||8679===n||8704===n||8706<=n&&n<=8707||8711<=n&&n<=8712||8715===n||8719===n||8721===n||8725===n||8730===n||8733<=n&&n<=8736||8739===n||8741===n||8743<=n&&n<=8748||8750===n||8756<=n&&n<=8759||8764<=n&&n<=8765||8776===n||8780===n||8786===n||8800<=n&&n<=8801||8804<=n&&n<=8807||8810<=n&&n<=8811||8814<=n&&n<=8815||8834<=n&&n<=8835||8838<=n&&n<=8839||8853===n||8857===n||8869===n||8895===n||8978===n||9312<=n&&n<=9449||9451<=n&&n<=9547||9552<=n&&n<=9587||9600<=n&&n<=9615||9618<=n&&n<=9621||9632<=n&&n<=9633||9635<=n&&n<=9641||9650<=n&&n<=9651||9654<=n&&n<=9655||9660<=n&&n<=9661||9664<=n&&n<=9665||9670<=n&&n<=9672||9675===n||9678<=n&&n<=9681||9698<=n&&n<=9701||9711===n||9733<=n&&n<=9734||9737===n||9742<=n&&n<=9743||9748<=n&&n<=9749||9756===n||9758===n||9792===n||9794===n||9824<=n&&n<=9825||9827<=n&&n<=9829||9831<=n&&n<=9834||9836<=n&&n<=9837||9839===n||9886<=n&&n<=9887||9918<=n&&n<=9919||9924<=n&&n<=9933||9935<=n&&n<=9953||9955===n||9960<=n&&n<=9983||10045===n||10071===n||10102<=n&&n<=10111||11093<=n&&n<=11097||12872<=n&&n<=12879||57344<=n&&n<=63743||65024<=n&&n<=65039||65533===n||127232<=n&&n<=127242||127248<=n&&n<=127277||127280<=n&&n<=127337||127344<=n&&n<=127386||917760<=n&&n<=917999||983040<=n&&n<=1048573||1048576<=n&&n<=1114109?"A":"N"};function Le(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;i||(i=1);const{fontStyle:n=e.fontStyle,fontVariant:o=e.fontVariant,fontWeight:r=e.fontWeight,fontSize:s=e.fontSize,fontFamily:a=e.fontFamily}=t;return(n?n+" ":"")+(o?o+" ":"")+(r?r+" ":"")+s*i+"px "+(a||"sans-serif")}let Pe=class t{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet="-/: .,@%'\"~",this._option=t,this._userSpec=null!=e?e:{},this.textSpec=this._initSpec(),st(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=st(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(rt(this._canvas)&&(st(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),rt(this._canvas)&&"undefined"!=typeof window&&void 0!==window.document&&globalThis&&st(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),rt(this._context)&&st(this._canvas)){const t=this._canvas.getContext("2d");st(t)&&(t.save(),t.font=Le(this.textSpec),this._contextSaved=!0,this._context=t)}return!rt(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:n={}}=this._option,{fontStyle:o=n.fontStyle,fontVariant:r=n.fontVariant,fontWeight:s=(null!==(t=n.fontWeight)&&void 0!==t?t:"normal"),fontSize:a=(null!==(e=n.fontSize)&&void 0!==e?e:12),fontFamily:l=(null!==(i=n.fontFamily)&&void 0!==i?i:"sans-serif"),align:h,textAlign:d=(null!=h?h:"center"),baseline:c,textBaseline:u=(null!=c?c:"middle"),ellipsis:g,limit:p}=this._userSpec;let{lineHeight:f=a}=this._userSpec;if(ct(f)&&"%"===f[f.length-1]){const t=Number.parseFloat(f.substring(0,f.length-1))/100;f=a*t}return{fontStyle:o,fontVariant:r,fontFamily:l,fontSize:a,fontWeight:s,textAlign:d,textBaseline:u,ellipsis:g,limit:p,lineHeight:f}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(rt(t))return{width:0,height:0};if(rt(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:n,textAlign:o,textBaseline:r,ellipsis:s,limit:a,lineHeight:l}=this.textSpec;let h;try{const d=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:n,textAlign:o,textBaseline:r,ellipsis:!!s,maxLineWidth:a||1/0,lineHeight:l});h={width:d.width(),height:d.height()}}catch(e){this._notSupportVRender=!0,h=this.measureWithNaiveCanvas(t)}return h}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:n,lineHeight:o}=this.textSpec;return{width:i.width,height:null!==(e=o)&&void 0!==e?e:n,fontBoundingBoxAscent:i.fontBoundingBoxAscent,fontBoundingBoxDescent:i.fontBoundingBoxDescent}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(e){const i={width:0,height:0};for(let n=0;n<e.length;n++){const o=e[n];let r=this._measureSpecialChar(o);rt(r)&&t.NUMBERS_CHAR_SET.includes(o)&&(r=this._measureNumberChar()),rt(r)&&["F","W"].includes(Me(o))&&(r=this._measureFullSizeChar()),rt(r)&&(r=this._measureLetterChar()),i.width+=r.width,i.height=Math.max(i.height,r.height),!rt(r.fontBoundingBoxAscent)&&(i.fontBoundingBoxAscent=r.fontBoundingBoxAscent),!rt(r.fontBoundingBoxDescent)&&(i.fontBoundingBoxDescent=r.fontBoundingBoxDescent)}return i}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:n,lineHeight:o}=this.textSpec;for(let e=0;e<t.length;e++){const o=t[e],r=["F","W"].includes(Me(o))?1:.53;i.width+=r*n}return i.height=null!==(e=o)&&void 0!==e?e:n,i}_measureReduce(t,e){var i;const{fontSize:n,lineHeight:o}=this.textSpec,r={width:0,height:0};if(rt(t))return r;if(ut(t)){const s=t.filter(st).map((t=>t.toString()));return 0===s.length?r:1===s.length?e(s[0]):{width:s.reduce(((t,i)=>Math.max(t,e(i).width)),0),height:s.length*((null!==(i=o)&&void 0!==i?i:n)+1)+1}}return e(t.toString())}_measureNumberChar(){if(rt(this._numberCharSize)){const e=this._standardMethod(t.NUMBERS_CHAR_SET);this._numberCharSize={width:e.width/t.NUMBERS_CHAR_SET.length,height:e.height,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return rt(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(t.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(rt(this._letterCharSize)){const e=this._standardMethod(t.ALPHABET_CHAR_SET);this._letterCharSize={width:e.width/t.ALPHABET_CHAR_SET.length,height:e.height,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(t){return st(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){st(this._canvas)&&(this._canvas=null),st(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}};Pe.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",Pe.NUMBERS_CHAR_SET="0123456789",Pe.FULL_SIZE_CHAR="字";const Ee=(t,e)=>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),He=(t,e)=>{const i=[{x:Math.cos(t.angle),y:Math.sin(t.angle)},{x:-Math.sin(t.angle),y:Math.cos(t.angle)},{x:Math.cos(e.angle),y:Math.sin(t.angle)},{x:-Math.sin(e.angle),y:Math.cos(t.angle)}];function n(t,e,i){const n=t.getRotatedCorners().map((t=>t.x*e+t.y*i));return{min:Math.min(...n),max:Math.max(...n)}}let o=0;for(const r of i){const i=n(t,r.x,r.y),s=n(e,r.x,r.y);let a;a=i.max<s.min?s.min-i.max:s.max<i.min?i.min-s.max:0,o=Math.max(o,a)}return o};function Oe(t,e,i){const{x1:n,y1:o,x2:r,y2:s}=e;return i.onlyTranslate()?(t!==e&&t.setValue(e.x1,e.y1,e.x2,e.y2),t.translate(i.e,i.f),e):(t.clear(),t.add(i.a*n+i.c*o+i.e,i.b*n+i.d*o+i.f),t.add(i.a*r+i.c*o+i.e,i.b*r+i.d*o+i.f),t.add(i.a*r+i.c*s+i.e,i.b*r+i.d*s+i.f),t.add(i.a*n+i.c*s+i.e,i.b*n+i.d*s+i.f),e)}let Ie=class t{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new t(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.x1=t,this.y1=e,this.x2=i,this.y2=n,this}set(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),n<e?(this.y2=e,this.y1=n):(this.y1=e,this.y2=n),this}add(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return ut(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=this.rotatedPoints(t,e,i);return this.clear().add(n[0],n[1]).add(n[2],n[3]).add(n[4],n[5]).add(n[6],n[7])}scale(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=this.scalePoints(t,e,i,n);return this.clear().add(o[0],o[1]).add(o[2],o[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.x1*=t,this.x2*=t,this}scaleY(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return Oe(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:n,y1:o,x2:r,y2:s}=this,a=Math.cos(t),l=Math.sin(t),h=e-e*a+i*l,d=i-e*l-i*a;return[a*n-l*o+h,l*n+a*o+d,a*n-l*s+h,l*n+a*s+d,a*r-l*o+h,l*r+a*o+d,a*r-l*s+h,l*r+a*s+d]}scalePoints(t,e,i,n){const{x1:o,y1:r,x2:s,y2:a}=this;return[t*o+(1-t)*i,e*r+(1-e)*n,t*s+(1-t)*i,e*a+(1-e)*n]}},Fe=class extends Ie{};class ze extends Ie{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var i;super(t),t&&(this.angle=null!==(i=t.angle)&&void 0!==i?i:e)}intersects(t){return ke(this,t)}setValue(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return super.setValue(t,e,i,n),this.angle=o,this}clone(){return new ze(this)}getRotatedCorners(){const t={x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2};return[Be({x:this.x1,y:this.y1},this.angle,t),Be({x:this.x2,y:this.y1},this.angle,t),Be({x:this.x1,y:this.y2},this.angle,t),Be({x:this.x2,y:this.y2},this.angle,t)]}}class De{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.a=t,this.b=e,this.c=i,this.d=n,this.e=o,this.f=r}equalToMatrix(t){return!(this.e!==t.e||this.f!==t.f||this.a!==t.a||this.d!==t.d||this.b!==t.b||this.c!==t.c)}equalTo(t,e,i,n,o,r){return!(this.e!==o||this.f!==r||this.a!==t||this.d!==n||this.b!==e||this.c!==i)}setValue(t,e,i,n,o,r){return this.a=t,this.b=e,this.c=i,this.d=n,this.e=o,this.f=r,this}reset(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}getInverse(){const t=this.a,e=this.b,i=this.c,n=this.d,o=this.e,r=this.f,s=new De,a=t*n-e*i;return s.a=n/a,s.b=-e/a,s.c=-i/a,s.d=t/a,s.e=(i*r-n*o)/a,s.f=-(t*r-e*o)/a,s}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.a*e+this.c*i,o=this.b*e+this.d*i,r=this.a*-i+this.c*e,s=this.b*-i+this.d*e;return this.a=n,this.b=o,this.c=r,this.d=s,this}rotateByCenter(t,e,i){const n=Math.cos(t),o=Math.sin(t),r=(1-n)*e+o*i,s=(1-n)*i-o*e,a=n*this.a-o*this.b,l=o*this.a+n*this.b,h=n*this.c-o*this.d,d=o*this.c+n*this.d,c=n*this.e-o*this.f+r,u=o*this.e+n*this.f+s;return this.a=a,this.b=l,this.c=h,this.d=d,this.e=c,this.f=u,this}scale(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}setScale(t,e){return this.b=this.b/this.a*t,this.c=this.c/this.d*e,this.a=t,this.d=e,this}transform(t,e,i,n,o,r){return this.multiply(t,e,i,n,o,r),this}translate(t,e){return this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e,this}transpose(){const{a:t,b:e,c:i,d:n,e:o,f:r}=this;return this.a=e,this.b=t,this.c=n,this.d=i,this.e=r,this.f=o,this}multiply(t,e,i,n,o,r){const s=this.a,a=this.b,l=this.c,h=this.d,d=s*t+l*e,c=a*t+h*e,u=s*i+l*n,g=a*i+h*n,p=s*o+l*r+this.e,f=a*o+h*r+this.f;return this.a=d,this.b=c,this.c=u,this.d=g,this.e=p,this.f=f,this}interpolate(t,e){const i=new De;return i.a=this.a+(t.a-this.a)*e,i.b=this.b+(t.b-this.b)*e,i.c=this.c+(t.c-this.c)*e,i.d=this.d+(t.d-this.d)*e,i.e=this.e+(t.e-this.e)*e,i.f=this.f+(t.f-this.f)*e,i}transformPoint(t,e){const{a:i,b:n,c:o,d:r,e:s,f:a}=this,l=i*r-n*o,h=r/l,d=-n/l,c=-o/l,u=i/l,g=(o*a-r*s)/l,p=-(i*a-n*s)/l,{x:f,y:v}=t;e.x=f*h+v*c+g,e.y=f*d+v*u+p}onlyTranslate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.a===t&&0===this.b&&0===this.c&&this.d===t}clone(){return new De(this.a,this.b,this.c,this.d,this.e,this.f)}toTransformAttrs(){const t=this.a,e=this.b,i=this.c,n=this.d,o=t*n-e*i,r={x:this.e,y:this.f,rotateDeg:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!==t||0!==e){const s=Math.sqrt(t*t+e*e);r.rotateDeg=e>0?Math.acos(t/s):-Math.acos(t/s),r.scaleX=s,r.scaleY=o/s,r.skewX=(t*i+e*n)/o,r.skewY=0}else if(0!==i||0!==n){const s=Math.sqrt(i*i+n*n);r.rotateDeg=Math.PI/2-(n>0?Math.acos(-i/s):-Math.acos(i/s)),r.scaleX=o/s,r.scaleY=s,r.skewX=0,r.skewY=(t*i+e*n)/o}return r.rotateDeg=180*r.rotateDeg/Math.PI,r}}class We{constructor(){this.CLEAN_THRESHOLD=1e3,this.L_TIME=1e3,this.R_COUNT=1,this.R_TIMESTAMP_MAX_SIZE=20}clearCache(t,e){const{CLEAN_THRESHOLD:i=this.CLEAN_THRESHOLD,L_TIME:n=this.L_TIME,R_COUNT:o=this.R_COUNT}=e;if(t.size<i)return 0;let r=0;const s=e=>{r++,t.delete(e)},a=Date.now();return t.forEach(((t,e)=>{if(t.timestamp.length<o)return s(e);let i=0;for(;a-t.timestamp[t.timestamp.length-1-i]<n&&(i++,!(i>=o)););if(i<o)return s(e);for(;a-t.timestamp[0]>n;)t.timestamp.shift()})),r}addLimitedTimestamp(t,e,i){const{R_TIMESTAMP_MAX_SIZE:n=this.R_TIMESTAMP_MAX_SIZE}=i;t.timestamp.length>n&&t.timestamp.shift(),t.timestamp.push(e)}clearTimeStamp(t,e){const{L_TIME:i=this.L_TIME}=e,n=Date.now();t.forEach((t=>{for(;n-t.timestamp[0]>i;)t.timestamp.shift()}))}clearItemTimestamp(t,e){const{L_TIME:i=this.L_TIME}=e,n=Date.now();for(;n-t.timestamp[0]>i;)t.timestamp.shift()}}function Ne(t,e,i){e/=100,i/=100;const n=(1-Math.abs(2*i-1))*e,o=n*(1-Math.abs(t/60%2-1)),r=i-n/2;let s=0,a=0,l=0;return 0<=t&&t<60?(s=n,a=o,l=0):60<=t&&t<120?(s=o,a=n,l=0):120<=t&&t<180?(s=0,a=n,l=o):180<=t&&t<240?(s=0,a=o,l=n):240<=t&&t<300?(s=o,a=0,l=n):300<=t&&t<360&&(s=n,a=0,l=o),s=Math.round(255*(s+r)),a=Math.round(255*(a+r)),l=Math.round(255*(l+r)),{r:s,g:a,b:l}}function Ge(t,e,i){t/=255,e/=255,i/=255;const n=Math.min(t,e,i),o=Math.max(t,e,i),r=o-n;let s=0,a=0,l=0;return s=0===r?0:o===t?(e-i)/r%6:o===e?(i-t)/r+2:(t-e)/r+4,s=Math.round(60*s),s<0&&(s+=360),l=(o+n)/2,a=0===r?0:r/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l:l}}const je=/^#([0-9a-f]{3,8})$/,Ve={transparent:4294967040},Ue={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Xe(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function $e(t){return ft(t)?new Je(t>>16,t>>8&255,255&t,1):ut(t)?new Je(t[0],t[1],t[2]):new Je(255,255,255)}function Ye(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Ke(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const qe=(t,e)=>{const i=je.exec(t);if(e||i){const t=parseInt(i[1],16),e=i[1].length;return 3===e?new Je((t>>8&15)+((t>>8&15)<<4),(t>>4&15)+((t>>4&15)<<4),(15&t)+((15&t)<<4),1):6===e?$e(t):8===e?new Je(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):null}};let Ze=class t{static Brighter(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===i?e:new t(e).brighter(i).toRGBA()}static SetOpacity(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===i?e:new t(e).setOpacity(i).toRGBA()}static getColorBrightness(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hsl";const n=e instanceof t?e:new t(e);switch(i){case"hsv":default:return n.getHSVBrightness();case"hsl":return n.getHSLBrightness();case"lum":return n.getLuminance();case"lum2":return n.getLuminance2();case"lum3":return n.getLuminance3();case"wcag":return n.getLuminanceWCAG()}}static parseColorString(t){if(st(Ve[t]))return function(t){return ft(t)?new Je(t>>>24,t>>>16&255,t>>>8&255,255&t):ut(t)?new Je(t[0],t[1],t[2],t[3]):new Je(255,255,255,1)}(Ve[t]);if(st(Ue[t]))return $e(Ue[t]);const e=`${t}`.trim().toLowerCase(),i=qe(e);if(void 0!==i)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const t=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new Je(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),parseFloat(t[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const t=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),i=Ne(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10));return new Je(i.r,i.g,i.b,parseFloat(t[3]))}}constructor(e){const i=t.parseColorString(e);this.color=i||new Je(255,255,255)}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:n}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(n*t))),this}add(t){const{r:e,g:i,b:n}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,n+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:n}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(n*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return.5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const n=this.color.opacity,o=Ge(this.color.r,this.color.g,this.color.b),r=Ne(rt(t)?o.h:$t(t,0,360),rt(e)?o.s:e>=0&&e<=1?100*e:e,rt(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new Je(r.r,r.g,r.b,n),this}setRGB(t,e,i){return!rt(t)&&(this.color.r=t),!rt(e)&&(this.color.g=e),!rt(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=qe(e,!0);return null!=i?i:this}setColorName(t){const e=Ue[t.toLowerCase()];return void 0!==e&&this.setHex(e),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}getLuminanceWCAG(){const t=this.color.r/255,e=this.color.g/255,i=this.color.b/255;let n,o,r;return n=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),o=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),r=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),.2126*n+.7152*o+.0722*r}clone(){return new t(this.color.toString())}copyGammaToLinear(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=Ye(t.color.r),this.color.g=Ye(t.color.g),this.color.b=Ye(t.color.b),this}copyLinearToSRGB(t){return this.color.r=Ke(t.color.r),this.color.g=Ke(t.color.g),this.color.b=Ke(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}},Je=class{constructor(t,e,i,n){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),st(n)?this.opacity=isNaN(+n)?1:Math.max(0,Math.min(1,+n)):this.opacity=1}formatHex(){return`#${Xe(this.r)+Xe(this.g)+Xe(this.b)+(1===this.opacity?"":Xe(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${1===t?"rgb(":"rgba("}${this.r},${this.g},${this.b}${1===t?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:n}=Ge(this.r,this.g,this.b);return`${1===t?"hsl(":"hsla("}${e},${i}%,${n}%${1===t?")":`,${t})`}`}toString(){return this.formatHex()}};var Qe=Object.freeze({__proto__:null,Color:Ze,DEFAULT_COLORS:Ue,RGB:Je,hexToRgb:function(t){let e="",i="",n="";const o="#"===t[0]?1:0;for(let r=o;r<t.length;r++)"#"!==t[r]&&(r<o+2?e+=t[r]:r<o+4?i+=t[r]:r<o+6&&(n+=t[r]));return[parseInt(e,16),parseInt(i,16),parseInt(n,16)]},hslToRgb:Ne,interpolateRgb:function(t,e){const i=t.r,n=e.r,o=t.g,r=e.g,s=t.b,a=e.b,l=t.opacity,h=e.opacity;return t=>{const e=Math.round(i*(1-t)+n*t),d=Math.round(o*(1-t)+r*t),c=Math.round(s*(1-t)+a*t);return new Je(e,d,c,l*(1-t)+h*t)}},rgbToHex:function(t,e,i){return Number((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},rgbToHsl:Ge});function ti(t){if(vt(t))return[t,t,t,t];if(ut(t)){const e=t.length;if(1===e){const e=t[0];return[e,e,e,e]}if(2===e){const[e,i]=t;return[e,i,e,i]}if(3===e){const[e,i,n]=t;return[e,i,n,i]}if(4===e)return t}if(at(t)){const{top:e=0,right:i=0,bottom:n=0,left:o=0}=t;return[e,i,n,o]}return[0,0,0,0]}const ei=ne-1e-8;class ii{constructor(t){this.init(t)}init(t){this.bounds=t}arc(t,e,i,n,o,r){if(Math.abs(o-n)>ei)return this.bounds.add(t-i,e-i),void this.bounds.add(t+i,e+i);let s,a,l,h,d=1/0,c=-1/0,u=1/0,g=-1/0;function p(t){l=i*Math.cos(t),h=i*Math.sin(t),l<d&&(d=l),l>c&&(c=l),h<u&&(u=h),h>g&&(g=h)}if(p(n),p(o),o!==n)if((n%=ne)<0&&(n+=ne),(o%=ne)<0&&(o+=ne),o<n&&(r=!r,s=n,n=o,o=s),r)for(o-=ne,s=n-n%ie,a=0;a<4&&s>o;++a,s-=ie)p(s);else for(s=n-n%ie+ie,a=0;a<4&&s<o;++a,s+=ie)p(s);this.bounds.add(t+d,e+u),this.bounds.add(t+c,e+g)}arcTo(t,e,i,n,o){this.bounds.add(t,e)}bezierCurveTo(t,e,i,n,o,r){this.bounds.add(t,e),this.bounds.add(i,n),this.bounds.add(o,r)}closePath(){}ellipse(){throw new Error("不支持ellipse")}lineTo(t,e){this.bounds.add(t,e)}moveTo(t,e){this.bounds.add(t,e)}quadraticCurveTo(t,e,i,n){this.bounds.add(t,e),this.bounds.add(i,n)}rect(t,e,i,n){this.bounds.add(t,e),this.bounds.add(t+i,e+n)}clear(){this.bounds.clear()}release(){}}class ni{constructor(){this._curves=[],this.bounds=new Fe}get curves(){return this._curves}getCurveLengths(){return this._curves.map((t=>t.getLength()))}getPointAt(t){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}}const oi=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,ri={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},si=0,ai=1,li=2,hi=3,di=4,ci=5,ui=6,gi=7,pi=8;let fi,vi,bi,mi,yi,Ci;var wi,xi,_i,Si,Ai,Bi,Ti,Ri,ki;function Mi(t){const e=t[0],i=t[1],n=t[2],o=t[3],r=t[4],s=t[5],a=t[6],l=t[7],h=l*r,d=-a*s,c=a*r,u=l*s,g=Math.cos(n),p=Math.sin(n),f=Math.cos(o),v=Math.sin(o),b=.5*(o-n),m=Math.sin(.5*b),y=8/3*m*m/Math.sin(b),C=e+g-y*p,w=i+p+y*g,x=e+f,_=i+v,S=x+y*v,A=_-y*f;return[h*C+d*w,c*C+u*w,h*S+d*A,c*S+u*A,h*x+d*_,c*x+u*_]}function Li(t,e,i,n){const o=function(t,e,i,n,o,r,s,a,l){const h=be(s),d=Math.sin(h),c=Math.cos(h),u=c*(a-t)*.5+d*(l-e)*.5,g=c*(l-e)*.5-d*(a-t)*.5;let p=u*u/((i=Math.abs(i))*i)+g*g/((n=Math.abs(n))*n);p>1&&(p=Math.sqrt(p),i*=p,n*=p);const f=c/i,v=d/i,b=-d/n,m=c/n,y=f*a+v*l,C=b*a+m*l,w=f*t+v*e,x=b*t+m*e;let _=1/((w-y)*(w-y)+(x-C)*(x-C))-.25;_<0&&(_=0);let S=Math.sqrt(_);r===o&&(S=-S);const A=.5*(y+w)-S*(x-C),B=.5*(C+x)+S*(w-y),T=Math.atan2(C-B,y-A);let R=Math.atan2(x-B,w-A)-T;R<0&&1===r?R+=ne:R>0&&0===r&&(R-=ne);const k=Math.ceil(Math.abs(R/(ie+.001))),M=[];for(let t=0;t<k;++t){const e=T+t*R/k,o=T+(t+1)*R/k;M[t]=[A,B,e,o,i,n,d,c]}return M}(n[5],n[6],n[0],n[1],n[3],n[4],n[2],e,i);for(let e=0;e<o.length;++e){const i=Mi(o[e]);t.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5])}}!function(t){t[t.NONE=0]="NONE",t[t.UPDATE_BOUNDS=1]="UPDATE_BOUNDS",t[t.UPDATE_SHAPE=2]="UPDATE_SHAPE",t[t.CLEAR_SHAPE=253]="CLEAR_SHAPE",t[t.UPDATE_SHAPE_AND_BOUNDS=3]="UPDATE_SHAPE_AND_BOUNDS",t[t.INIT=179]="INIT",t[t.CLEAR_BOUNDS=254]="CLEAR_BOUNDS",t[t.UPDATE_GLOBAL_MATRIX=32]="UPDATE_GLOBAL_MATRIX",t[t.CLEAR_GLOBAL_MATRIX=223]="CLEAR_GLOBAL_MATRIX",t[t.UPDATE_LOCAL_MATRIX=16]="UPDATE_LOCAL_MATRIX",t[t.CLEAR_LOCAL_MATRIX=239]="CLEAR_LOCAL_MATRIX",t[t.UPDATE_GLOBAL_LOCAL_MATRIX=48]="UPDATE_GLOBAL_LOCAL_MATRIX",t[t.UPDATE_LAYOUT=128]="UPDATE_LAYOUT",t[t.CLEAR_LAYOUT=127]="CLEAR_LAYOUT"}(wi||(wi={})),function(t){t[t.GLOBAL=1]="GLOBAL",t[t.LOCAL=16]="LOCAL",t[t.GLOBAL_ACCURATE=3]="GLOBAL_ACCURATE",t[t.LOCAL_ACCURATE=48]="LOCAL_ACCURATE"}(xi||(xi={})),function(t){t[t.INIT=0]="INIT",t[t.DEFAULT=1]="DEFAULT",t[t.STATE=2]="STATE",t[t.ANIMATE_BIND=10]="ANIMATE_BIND",t[t.ANIMATE_PLAY=11]="ANIMATE_PLAY",t[t.ANIMATE_START=12]="ANIMATE_START",t[t.ANIMATE_UPDATE=13]="ANIMATE_UPDATE",t[t.ANIMATE_END=14]="ANIMATE_END",t[t.TRANSLATE=20]="TRANSLATE",t[t.TRANSLATE_TO=21]="TRANSLATE_TO",t[t.SCALE=22]="SCALE",t[t.SCALE_TO=23]="SCALE_TO",t[t.ROTATE=24]="ROTATE",t[t.ROTATE_TO=25]="ROTATE_TO"}(_i||(_i={})),function(t){t[t.INITIAL=0]="INITIAL",t[t.RUNNING=1]="RUNNING",t[t.PAUSED=2]="PAUSED",t[t.END=3]="END"}(Si||(Si={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.SET_ATTR_IMMEDIATELY=1]="SET_ATTR_IMMEDIATELY"}(Ai||(Ai={})),function(t){t.wait="wait",t.from="from",t.to="to",t.customAnimate="customAnimate"}(Bi||(Bi={})),function(t){t[t.ROW=1]="ROW",t[t.COLUMN=2]="COLUMN"}(Ti||(Ti={})),function(t){t[t.CubicBezierCurve=0]="CubicBezierCurve",t[t.QuadraticBezierCurve=1]="QuadraticBezierCurve",t[t.ArcCurve=2]="ArcCurve",t[t.LineCurve=3]="LineCurve",t[t.EllipseCurve=4]="EllipseCurve",t[t.MoveCurve=5]="MoveCurve"}(Ri||(Ri={})),function(t){t[t.beforeFillStroke=0]="beforeFillStroke",t[t.afterFillStroke=1]="afterFillStroke"}(ki||(ki={}));const Pi=[(t,e,i,n,o,r,s)=>e.arc(t[1]*o+i,t[2]*r+n,t[3]*(o+r)/2,t[4],t[5],t[6],s),(t,e,i,n,o,r,s)=>e.arcTo(t[1]*o+i,t[2]*r+n,t[3]*o+i,t[4]*r+n,t[5]*(o+r)/2,s),(t,e,i,n,o,r,s)=>e.bezierCurveTo(t[1]*o+i,t[2]*r+n,t[3]*o+i,t[4]*r+n,t[5]*o+i,t[6]*r+n,s),(t,e,i,n)=>e.closePath(),(t,e,i,n,o,r)=>e.ellipse(t[1]*o+i,t[2]*r+n,t[3]*o,t[4]*r,t[5],t[6],t[7],t[8]),(t,e,i,n,o,r,s)=>e.lineTo(t[1]*o+i,t[2]*r+n,s),(t,e,i,n,o,r,s)=>e.moveTo(t[1]*o+i,t[2]*r+n,s),(t,e,i,n,o,r,s)=>e.quadraticCurveTo(t[1]*o+i,t[2]*r+n,t[3]*o+i,t[4]*r+n,s),(t,e,i,n,o,r,s)=>e.rect(t[1]*o+i,t[2]*r+n,t[3]*o,t[4]*r,s)];function Ei(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6?arguments[6]:void 0;for(let a=0;a<t.length;a++){const l=t[a];Pi[l[0]](l,e,i,n,o,r,s)}}class Hi{getLength(t){return null!=t?this.calcProjLength(t):(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length)}}function Oi(t,e){let i=0;const n=t.length;for(let o=0;o<n;o++){const r=t[o],s=e[o],a=t[(o+1)%n],l=e[(o+1)%n];i+=ve.distanceNN(r,s,a,l)}return i/2}function Ii(t,e,i,n,o){const r=1-o;return r*r*r*t+3*e*o*r*r+3*i*o*o*r+n*o*o*o}function Fi(t,e,i,n,o){const r=Ii(t.x,e.x,i.x,n.x,o),s=Ii(t.y,e.y,i.y,n.y,o);return new fe(r,s)}function zi(t,e,i,n){const o=1-n;return o*o*t+2*o*n*e+n*n*i}function Di(t,e,i,n){const o=zi(t.x,e.x,i.x,n),r=zi(t.y,e.y,i.y,n);return new fe(o,r)}class Wi extends Hi{constructor(t,e,i){super(),this.type=Ri.QuadraticBezierCurve,this.p0=t,this.p1=e,this.p2=i}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y)}getPointAt(t){if(!1!==this.defined)return Di(this.p0,this.p1,this.p2,t);throw new Error("defined为false的点不能getPointAt")}calcLength(){return this._validPoint()?(t=this.p0,e=this.p1,i=this.p2,Oi([t.x,e.x,i.x],[t.y,e.y,i.y])):60;var t,e,i}calcProjLength(t){return t===Ti.ROW?re(this.p0.x-this.p2.x):t===Ti.COLUMN?re(this.p0.y-this.p2.y):0}getAngleAt(t){const e=le(t-.01,0),i=he(t+.01,1),n=this.getPointAt(e),o=this.getPointAt(i);return se(o.y-n.y,o.x-n.x)}draw(t,e,i,n,o,r){if(t.moveTo(this.p0.x*n+e,this.p0.y*o+i),r>=1)t.quadraticCurveTo(this.p1.x*n+e,this.p1.y*o+i,this.p2.x*n+e,this.p2.y*o+i);else if(r>0){const[s]=function(t,e){const{p0:i,p1:n,p2:o}=t,r=Di(i,n,o,e),s=ve.pointAtPP(i,n,e),a=ve.pointAtPP(n,o,e);return[new Wi(i,s,r),new Wi(r,a,o)]}(this,r);t.quadraticCurveTo(s.p1.x*n+e,s.p1.y*o+i,s.p2.x*n+e,s.p2.y*o+i)}}getYAt(t){throw new Error("QuadraticBezierCurve暂不支持getYAt")}includeX(t){throw new Error("QuadraticBezierCurve暂不支持includeX")}}function Ni(t,e){const{p0:i,p1:n,p2:o,p3:r}=t,s=Fi(i,n,o,r,e),a=ve.pointAtPP(i,n,e),l=ve.pointAtPP(n,o,e),h=ve.pointAtPP(o,r,e),d=ve.pointAtPP(a,l,e),c=ve.pointAtPP(l,h,e);return[new Gi(i,a,d,s),new Gi(s,c,h,r)]}class Gi extends Hi{constructor(t,e,i,n){super(),this.type=Ri.CubicBezierCurve,this.p0=t,this.p1=e,this.p2=i,this.p3=n}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(t){if(!1!==this.defined)return Fi(this.p0,this.p1,this.p2,this.p3,t);throw new Error("defined为false的点不能getPointAt")}calcLength(){return this._validPoint()?(t=this.p0,e=this.p1,i=this.p2,n=this.p3,Oi([t.x,e.x,i.x,n.x],[t.y,e.y,i.y,n.y])):60;var t,e,i,n}calcProjLength(t){return t===Ti.ROW?re(this.p0.x-this.p3.x):t===Ti.COLUMN?re(this.p0.y-this.p3.y):0}getAngleAt(t){const e=le(t-.01,0),i=he(t+.01,1),n=this.getPointAt(e),o=this.getPointAt(i);return se(o.y-n.y,o.x-n.x)}draw(t,e,i,n,o,r){if(t.moveTo(this.p0.x*n+e,this.p0.y*o+i),r>=1)t.bezierCurveTo(this.p1.x*n+e,this.p1.y*o+i,this.p2.x*n+e,this.p2.y*o+i,this.p3.x*n+e,this.p3.y*o+i);else if(r>0){const[s]=Ni(this,r);t.bezierCurveTo(s.p1.x*n+e,s.p1.y*o+i,s.p2.x*n+e,s.p2.y*o+i,s.p3.x*n+e,s.p3.y*o+i)}}includeX(t){const e=he(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=le(this.p0.x,this.p1.x,this.p2.x,this.p3.x);return t>=e&&t<=i}getYAt(t){const e=he(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=(t-e)/(le(this.p0.x,this.p1.x,this.p2.x,this.p3.x)-e);return this.getPointAt(i).y}}function ji(t,e){const{p0:i,p1:n}=t,o=ve.pointAtPP(i,n,e);return[new Vi(i,o),new Vi(o,n)]}class Vi extends Hi{constructor(t,e){super(),this.type=Ri.LineCurve,this.p0=t,this.p1=e}getPointAt(t){if(!1!==this.defined)return ve.pointAtPP(this.p0,this.p1,t);throw new Error("defined为false的点不能getPointAt")}getAngleAt(t){return null==this.angle&&(this.angle=se(this.p1.y-this.p0.y,this.p1.x-this.p0.x)),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?ve.distancePP(this.p0,this.p1):60}calcProjLength(t){return t===Ti.ROW?re(this.p0.x-this.p1.x):t===Ti.COLUMN?re(this.p0.y-this.p1.y):0}draw(t,e,i,n,o,r){if(t.moveTo(this.p0.x*n+e,this.p0.y*o+i),r>=1)t.lineTo(this.p1.x*n+e,this.p1.y*o+i);else if(r>0){const s=this.getPointAt(r);t.lineTo(s.x*n+e,s.y*o+i)}}includeX(t){return t>=this.p0.x&&t<=this.p1.x||t>=this.p1.x&&t<=this.p0.x}getYAt(t){if(this.includeX(t)){let e=this.p0,i=this.p1;this.p0.x>this.p1.x&&(e=this.p1,i=this.p0);const n=(t-e.x)/(i.x-e.x);return e.y+n*(i.y-e.y)}return 1/0}}class Ui{get endX(){return this._lastX}get endY(){return this._lastY}constructor(t,e){this.init(t,e)}init(t,e){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=t,this.direction=e,this.curves=[]}bezierCurveTo(t,e,i,n,o,r,s,a){const l=new Gi(new fe(this._lastX,this._lastY),new fe(t,e),new fe(i,n),new fe(o,r));l.originP1=this._lastOriginP,l.originP2=a,l.defined=s,this.curves.push(l),this._lastX=o,this._lastY=r,this._lastOriginP=a}closePath(){if(this.curves.length<2)return;const t=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,t.defined,this._startOriginP)}ellipse(){throw new Error("SegContext不支持调用ellipse")}lineTo(t,e,i,n){const o=this.addLinearCurve(t,e,i,this._lastOriginP,n);this.curves.push(o),this._lastX=t,this._lastY=e,this._lastOriginP=n}moveTo(t,e,i){return this._lastX=this._startX=t,this._lastY=this._startY=e,this._lastOriginP=i,this._startOriginP=i,this}quadraticCurveTo(t,e,i,n){throw new Error("SegContext不支持调用quadraticCurveTo")}clear(){this.curves=[],this.length=NaN}tryUpdateLength(t){return this.getLength(t)}addLinearCurve(t,e,i,n,o){const r=new Vi(new fe(this._lastX,this._lastY),new fe(t,e));return r.originP1=n,r.originP2=o,r.defined=i,r}getPointAt(t){throw new Error("暂未实现")}getCurveLengths(){return[]}getLength(t){var e,i;if(t===Ti.COLUMN){if(!this.curves.length)return 0;const t=this.curves[0],i=this.curves[this.curves.length-1],n=null!==(e=i.p3)&&void 0!==e?e:i.p1;return re(t.p0.y-n.y)}if(t===Ti.ROW){if(!this.curves.length)return 0;const t=this.curves[0],e=this.curves[this.curves.length-1],n=null!==(i=e.p3)&&void 0!==i?i:e.p1;return re(t.p0.x-n.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce(((t,e)=>t+e.getLength()),0)),this.length}}class Xi extends Ui{bezierCurveTo(t,e,i,n,o,r,s,a){return super.bezierCurveTo(e,t,n,i,r,o,s,a)}lineTo(t,e,i,n){return super.lineTo(e,t,i,n)}moveTo(t,e,i){return super.moveTo(e,t,i)}clear(){return super.clear()}}function $i(t,e){let i=!1;for(let n=0,o=e.length;n<=o;n++)n>=o===i&&((i=!i)?t.lineStart():t.lineEnd()),i&&t.point(e[n])}function Yi(t,e,i){const n=null!=e?e:re(i[i.length-1].x-i[0].x)>re(i[i.length-1].y-i[0].y)?Ti.ROW:Ti.COLUMN;return"monotoneY"===t?new Xi(t,n):new Ui(t,n)}class Ki{constructor(t,e){this.context=t,e&&(this.startPoint=e)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t)}this._lastDefined=t.defined}tryUpdateLength(){return this.context.tryUpdateLength()}}function qi(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:n}=e;if(t.length<2-Number(!!n))return null;const o=Yi("linear",i,t);return function(t,e){$i(t,e)}(new Ki(o,n),t),o}function Zi(t,e,i,n,o){t.context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+i)/6,n,t.lastPoint1)}class Ji{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){2===this._point&&Zi(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1),(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;break;default:Zi(this,e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}function Qi(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:n}=e;if(t.length<2-Number(!!n))return null;if(t.length<3-Number(!!n))return qi(t,e);const o=Yi("basis",i,t);return function(t,e){$i(t,e)}(new Ji(o,n),t),o}function tn(t){return t<0?-1:1}function en(t,e,i){const n=t._x1-t._x0,o=e-t._x1,r=(t._y1-t._y0)/(n||Number(o<0&&-0)),s=(i-t._y1)/(o||Number(n<0&&-0)),a=(r*o+s*n)/(n+o);return(tn(r)+tn(s))*Math.min(Math.abs(r),Math.abs(s),.5*Math.abs(a))||0}function nn(t,e){const i=t._x1-t._x0;return i?(3*(t._y1-t._y0)/i-e)/2:e}function on(t,e,i,n,o){const r=t._x0,s=t._y0,a=t._x1,l=t._y1,h=(a-r)/3;t.context.bezierCurveTo(r+h,s+h*e,a-h,l-h*i,a,l,n,t.lastPoint1)}class rn{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1);break;case 3:on(this,this._t0,nn(this,this._t0),!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1)}(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){let e=NaN;const i=t.x,n=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,n,!1!==this._lastDefined1&&!1!==this._lastDefined2,t):this.context.moveTo(i,n,t);break;case 1:this._point=2;break;case 2:this._point=3,on(this,nn(this,e=en(this,i,n)),e,!1!==this._lastDefined1&&!1!==this._lastDefined2);break;default:on(this,this._t0,e=en(this,i,n),!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=n,this._t0=e,this._lastDefined1=this._lastDefined2,this._lastDefined2=!1!==t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}class sn extends rn{constructor(t,e){super(t,e)}point(t){return super.point({y:t.x,x:t.y,defined:t.defined})}}function an(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:n}=e;if(t.length<2-Number(!!n))return null;if(t.length<3-Number(!!n))return qi(t,e);const o=Yi("monotoneX",i,t);return function(t,e){$i(t,e)}(new rn(o,n),t),o}function ln(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:n}=e;if(t.length<2-Number(!!n))return null;if(t.length<3-Number(!!n))return qi(t,e);const o=Yi("monotoneY",i,t);return function(t,e){$i(t,e)}(new sn(o,n),t),o}let hn=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2?arguments[2]:void 0;this.context=t,this._t=e,this.startPoint=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&2===this._point&&this.context.lineTo(this._x,this._y,!1!==this._lastDefined,this.lastPoint),(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,i,!1!==this._lastDefined&&!1!==t.defined,this.lastPoint),this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t);else{const n=this._x*(1-this._t)+e*this._t;.5===this._t?this.context.lineTo(n,this._y,!1!==this._lastDefined,this.lastPoint):this.context.lineTo(n,this._y,!1!==this._lastDefined&&!1!==t.defined,this.lastPoint),this.context.lineTo(n,i,!1!==this._lastDefined&&!1!==t.defined,t)}}this._lastDefined=t.defined,this._x=e,this._y=i,this.lastPoint=t}tryUpdateLength(){return this.context.tryUpdateLength()}};class dn extends hn{lineEnd(){this.context.closePath()}}function cn(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{direction:n,startPoint:o}=i;if(t.length<2-Number(!!o))return null;const r=new Ui("step",null!=n?n:re(t[t.length-1].x-t[0].x)>re(t[t.length-1].y-t[0].y)?Ti.ROW:Ti.COLUMN);return un(new hn(r,e,o),t),r}function un(t,e){return $i(t,e)}class gn extends Ki{lineEnd(){this.context.closePath()}}function pn(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:n}=e;if(t.length<2-Number(!!n))return null;const o=Yi("linear",i,t);return function(t,e){$i(t,e)}(new gn(o,n),t),o}function fn(t,e,i,n,o){let r=t._x1,s=t._y1,a=t._x2,l=t._y2;if(t._l01_a>te){const e=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,i=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*e-t._x0*t._l12_2a+t._x2*t._l01_2a)/i,s=(s*e-t._y0*t._l12_2a+t._y2*t._l01_2a)/i}if(t._l23_a>te){const n=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,o=3*t._l23_a*(t._l23_a+t._l12_a);a=(a*n+t._x1*t._l23_2a-e*t._l12_2a)/o,l=(l*n+t._y1*t._l23_2a-i*t._l12_2a)/o}t.context.bezierCurveTo(r,s,a,l,t._x2,t._y2,n,t.lastPoint1)}function vn(t,e){return function(i,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{direction:r,startPoint:s}=o;if(i.length<2-Number(!!s))return null;if(i.length<3-Number(!!s))return qi(i,o);const a=Yi(t,r,i);return $i(new e(a,n,s),i),a}}const bn=vn("catmullRom",class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2?arguments[2]:void 0;this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x2,this._y2,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1);break;case 3:this.point({x:this._x2,y:this._y2})}(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){const{x:e,y:i}=t;if(this._point){const t=this._x2-e,n=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(t*t+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2):this.context.moveTo(e,i);break;case 1:this._point=2;break;case 2:this._point=3;default:fn(this,e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}});const mn=vn("catmullRomClosed",class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2?arguments[2]:void 0;this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 1:this.context.moveTo(this._x3,this._y3,this.lastPoint1),this.context.closePath();break;case 2:this.context.lineTo(this._x3,this._y3,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1),this.context.closePath();break;case 3:this.point({x:this._x3,y:this._y3}),this.point({x:this._x4,y:this._y4}),this.point({x:this._x5,y:this._y5})}}point(t){const{x:e,y:i}=t;if(this._point){const t=this._x2-e,n=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(t*t+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=i;break;case 1:this._point=2,this.context.moveTo(this._x4=e,this._y4=i,t);break;case 2:this._point=3,this._x5=e,this._y5=i;break;default:fn(this,e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}});class yn{constructor(t){this.path=t,this._lastX=this._lastY=this._startX=this._startY=0}moveTo(t,e){return this._lastX=this._startX=t,this._lastY=this._startY=e,this}lineTo(t,e){const i=this.addLinearCurve(t,e);this.path.addCurve(i),this._lastX=t,this._lastY=e}addLinearCurve(t,e){return new Vi(new fe(this._lastX,this._lastY),new fe(t,e))}quadraticCurveTo(t,e,i,n){const o=new Wi(new fe(this._lastX,this._lastY),new fe(t,e),new fe(i,n));this.path.addCurve(o),this._lastX=i,this._lastY=n}bezierCurveTo(t,e,i,n,o,r){const s=new Gi(new fe(this._lastX,this._lastY),new fe(t,e),new fe(i,n),new fe(o,r));this.path.addCurve(s),this._lastX=o,this._lastY=r}arcTo(t,e,i,n,o){throw new Error("CurveContext不支持调用arcTo")}ellipse(t,e,i,n,o,r,s,a){throw new Error("CurveContext不支持调用ellipse")}rect(t,e,i,n){throw new Error("CurveContext不支持调用rect")}arc(t,e,i,n,o,r){throw new Error("CurveContext不支持调用arc")}closePath(){this.path.curves.length<2||this.lineTo(this._startX,this._startY)}}function Cn(t,e,i){var n,o;switch(e){case"linear":default:return qi(t,i);case"basis":return Qi(t,i);case"monotoneX":return an(t,i);case"monotoneY":return ln(t,i);case"step":return cn(t,.5,i);case"stepClosed":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{direction:n,startPoint:o}=i;if(t.length<2-Number(!!o))return null;const r=new Ui("step",null!=n?n:re(t[t.length-1].x-t[0].x)>re(t[t.length-1].y-t[0].y)?Ti.ROW:Ti.COLUMN);return un(new dn(r,e,o),t),r}(t,.5,i);case"stepBefore":return cn(t,0,i);case"stepAfter":return cn(t,1,i);case"catmullRom":return bn(t,null!==(n=null==i?void 0:i.curveTension)&&void 0!==n?n:.5,i);case"catmullRomClosed":return mn(t,null!==(o=null==i?void 0:i.curveTension)&&void 0!==o?o:.5,i);case"linearClosed":return pn(t,i)}}class wn extends ni{constructor(t){super(),this.commandList=[],t&&(this._ctx=t),this._boundsContext=new ii(this.bounds)}get curves(){return this.tryBuildCurves()}setCtx(t){this._ctx=t}moveTo(t,e){return this.commandList.push([ui,t,e]),this._ctx&&this._ctx.moveTo(t,e),this}lineTo(t,e){return this.commandList.push([ci,t,e]),this._ctx&&this._ctx.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.commandList.push([gi,t,e,i,n]),this._ctx&&this._ctx.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,o,r){return this.commandList.push([li,t,e,i,n,o,r]),this._ctx&&this._ctx.bezierCurveTo(t,e,i,n,o,r),this}arcTo(t,e,i,n,o){return this.commandList.push([ai,t,e,i,n,o]),this._ctx&&this._ctx.arcTo(t,e,i,n,o),this}ellipse(t,e,i,n,o,r,s,a){return this.commandList.push([di,t,e,i,n,o,r,s,a]),this._ctx&&this._ctx.ellipse(t,e,i,n,o,r,s,a),this}rect(t,e,i,n){return this.commandList.push([pi,t,e,i,n]),this._ctx&&this._ctx.rect(t,e,i,n),this}arc(t,e,i,n,o,r){return this.commandList.push([si,t,e,i,n,o,r]),this._ctx&&this._ctx.arc(t,e,i,n,o,r),this}closePath(){return this.commandList.push([hi]),this._ctx&&this._ctx.closePath(),this}addCurve(t){this._curves.push(t)}clear(){this.transformCbList=null,this.commandList.length=0,this._curves.length=0}beginPath(){this.clear()}tryBuildCurves(){if(!this._curves||!this._curves.length){const t=new yn(this);Ei(this.commandList,t,0,0,1,1)}return this._curves}toString(){if(!this.toStringCbList){const t=[];t[ui]=t=>`M${t[1]} ${t[2]}`,t[ci]=t=>`L${t[1]} ${t[2]}`,t[gi]=t=>`Q${t[1]} ${t[2]} ${t[3]} ${t[4]}`,t[li]=t=>`C${t[1]} ${t[2]} ${t[3]} ${t[4]} ${t[5]} ${t[6]}`,t[si]=t=>{const e=[];((t,e,i,n,o,r,s)=>{const a=Math.abs(i-e),l=a>.5*Math.PI?Math.ceil(2*a/Math.PI):1,h=(i-e)/l;for(let i=0;i<l;i++){const a=e+h*i,l=e+h*(i+1),d=4*Math.tan(Math.abs(h)/4)/3,c=l<a?-1:1,u=Math.cos(a),g=Math.sin(a),p=Math.cos(l),f=Math.sin(l),v=u*r+n,b=g*s+o,m=p*r+n,y=f*s+o,C=r*d*c,w=s*d*c;t.push(v-C*g,b+w*u,m+C*f,y-w*p,m,y)}})(e,t[4],t[5],t[1],t[2],t[3],t[3]);let i="";for(let t=0;t<e.length;t+=6)i+=`C${e[t]} ${e[t+1]} ${e[t+2]} ${e[t+3]} ${e[t+4]} ${e[t+5]}`;return i},t[pi]=t=>`M${t[1]} ${t[2]} h${t[3]} v${t[4]} H${t[1]}Z`,t[hi]=t=>"Z",this.toStringCbList=t}const t=this.toStringCbList;let e="";return this.commandList.forEach((i=>{e+=t[i[0]](i)})),e}fromString(t,e,i,n,o){this.clear();const r=function(t){if(!t)return[];const e=t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(null===e)return[];let i,n;const o=[];for(let t=0,r=e.length;t<r;t++)if(fi=e[t],vi=fi.slice(1),bi=fi[0],i=[bi],n=vi.match(oi),null!==n){for(let t=0,e=n.length;t<e;t++)mi=n[t],yi=parseFloat(mi),Number.isNaN(yi)||i.push(yi);if(Ci=ri[bi],i.length-1>Ci){let t,e=bi;for(let n=1,r=i.length;n<r;n+=Ci){t=[e];for(let e=n,o=n+Ci;e<o;e++)t.push(i[e]);o.push(t),"m"===e?e="l":"M"===e&&(e="L")}}else o.push(i)}else o.push(i);return o}(t);return this._runCommandStrList(r,e,i,n,o),this._updateBounds(),this}fromLine(t){const{points:e,curveType:i,clipRangeByDimension:n}=t.attribute;if(!e)return;const o=Cn(e,i);"x"===n?this.direction=Ti.ROW:"y"===n?this.direction=Ti.COLUMN:"auto"===n&&(this.direction=o.direction),this._curves=o.curves}fromCustomPath2D(t,e,i,n,o){return this.clear(),this._runCommandList(t.commandList,e,i,n,o),this._updateBounds(),this}transform(t,e,i,n){const o=this.commandList;if(!this.transformCbList){const t=[];t[ui]=this.moveToTransform,t[ci]=this.lineToTransform,t[gi]=this.quadraticCurveToTransform,t[li]=this.bezierCurveToTransform,t[ai]=this.arcToTransform,t[di]=this.ellipseTransform,t[pi]=this.rectTransform,t[si]=this.arcTransform,t[hi]=this.closePathTransform,this.transformCbList=t}o.forEach((o=>{this.transformCbList[o[0]](o,t,e,i,n)})),this._updateBounds()}moveToTransform(t,e,i,n,o){t[1]=t[1]*n+e,t[2]=t[2]*o+i}lineToTransform(t,e,i,n,o){t[1]=t[1]*n+e,t[2]=t[2]*o+i}quadraticCurveToTransform(t,e,i,n,o){t[1]=t[1]*n+e,t[2]=t[2]*o+i,t[3]=t[3]*n+e,t[4]=t[4]*o+i}bezierCurveToTransform(t,e,i,n,o){t[1]=t[1]*n+e,t[2]=t[2]*o+i,t[3]=t[3]*n+e,t[4]=t[4]*o+i,t[5]=t[5]*n+e,t[6]=t[6]*o+i}arcToTransform(t,e,i,n,o){t[1]=t[1]*n+e,t[2]=t[2]*o+i,t[3]=t[3]*n+e,t[4]=t[4]*o+i,t[5]=t[5]*(n+o)/2}ellipseTransform(t,e,i,n,o){t[1]=t[1]*n+e,t[2]=t[2]*o+i,t[3]=t[3]*n,t[4]=t[4]*o}rectTransform(t,e,i,n,o){t[1]=t[1]*n+e,t[2]=t[2]*o+i,t[3]=t[3]*n,t[4]=t[4]*o}arcTransform(t,e,i,n,o){t[1]=t[1]*n+e,t[2]=t[2]*o+i,t[3]=t[3]*(n+o)/2}closePathTransform(){}_runCommandStrList(t){let e,i,n,o,r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,d=null,c=0,u=0,g=0,p=0;for(let f=0,v=t.length;f<v;++f){switch(e=t[f],1===l&&1===h||(e=_n(e,l,h)),e[0]){case"l":c+=e[1],u+=e[2],this.lineTo(c+s,u+a);break;case"L":c=e[1],u=e[2],this.lineTo(c+s,u+a);break;case"h":c+=e[1],this.lineTo(c+s,u+a);break;case"H":c=e[1],this.lineTo(c+s,u+a);break;case"v":u+=e[1],this.lineTo(c+s,u+a);break;case"V":u=e[1],this.lineTo(c+s,u+a);break;case"m":c+=e[1],u+=e[2],this.moveTo(c+s,u+a);break;case"M":c=e[1],u=e[2],this.moveTo(c+s,u+a);break;case"c":i=c+e[5],n=u+e[6],g=c+e[3],p=u+e[4],this.bezierCurveTo(c+e[1]+s,u+e[2]+a,g+s,p+a,i+s,n+a),c=i,u=n;break;case"C":c=e[5],u=e[6],g=e[3],p=e[4],this.bezierCurveTo(e[1]+s,e[2]+a,g+s,p+a,c+s,u+a);break;case"s":i=c+e[3],n=u+e[4],null===d[0].match(/[CcSs]/)?(g=c,p=u):(g=2*c-g,p=2*u-p),o=c+e[1],r=u+e[2],this.bezierCurveTo(g+s,p+a,o+s,r+a,i+s,n+a),g=o,p=r,c=i,u=n;break;case"S":i=e[3],n=e[4],null===d[0].match(/[CcSs]/)?(g=c,p=u):(g=2*c-g,p=2*u-p),o=e[1],r=e[2],this.bezierCurveTo(g+s,p+a,o+s,r+a,i+s,n+a),g=o,p=r,c=i,u=n;break;case"q":i=c+e[3],n=u+e[4],g=c+e[1],p=u+e[2],this.quadraticCurveTo(g+s,p+a,i+s,n+a),c=i,u=n;break;case"Q":i=e[3],n=e[4],this.quadraticCurveTo(e[1]+s,e[2]+a,i+s,n+a),c=i,u=n,g=e[1],p=e[2];break;case"t":i=c+e[1],n=u+e[2],null===d[0].match(/[QqTt]/)?(g=c,p=u):"t"===d[0]?(g=2*c-o,p=2*u-r):"q"===d[0]&&(g=2*c-g,p=2*u-p),o=g,r=p,this.quadraticCurveTo(g+s,p+a,i+s,n+a),c=i,u=n,g=c+e[1],p=u+e[2];break;case"T":i=e[1],n=e[2],g=2*c-g,p=2*u-p,this.quadraticCurveTo(g+s,p+a,i+s,n+a),c=i,u=n;break;case"a":Li(this,c+s,u+a,[e[1],e[2],e[3],e[4],e[5],e[6]+c+s,e[7]+u+a]),c+=e[6],u+=e[7];break;case"A":Li(this,c+s,u+a,[e[1],e[2],e[3],e[4],e[5],e[6]+s,e[7]+a]),c=e[6],u=e[7];break;case"z":case"Z":this.closePath()}d=e}}_runCommandList(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(0!==e||0!==i||1!==n||1!==o)for(let r=0,s=t.length;r<s;++r){const s=t[r].slice();switch(s[0]){case ci:this.lineToTransform(s,e,i,n,o);break;case ui:this.moveToTransform(s,e,i,n,o);break;case li:this.bezierCurveToTransform(s,e,i,n,o);break;case gi:this.quadraticCurveToTransform(s,e,i,n,o);break;case si:this.arcToTransform(s,e,i,n,o);break;case di:this.ellipseTransform(s,e,i,n,o);break;case pi:this.rectTransform(s,e,i,n,o);break;case ai:this.arcToTransform(s,e,i,n,o);break;case hi:this.closePath()}}else this.commandList=t.map((t=>t.slice()))}_updateBounds(){this.bounds.clear(),Ei(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===Ti.COLUMN){if(!this._curves.length)return 0;const t=this._curves[0],e=this._curves[this._curves.length-1];return re(t.p0.y-e.p1.y)}if(this.direction===Ti.ROW){if(!this._curves.length)return 0;const t=this._curves[0],e=this._curves[this._curves.length-1];return re(t.p0.x-e.p1.x)}return this._curves.reduce(((t,e)=>t+e.getLength()),0)}getYAt(t){if(!this.curves)return 1/0;for(let e=0;e<this.curves.length;e++){const i=this.curves[e];if(i.includeX(t))return i.getYAt(t)}return 1/0}getAttrAt(t){if(!this._curves)return{pos:{x:0,y:0},angle:0};let e,i=0;for(let n=0;n<this._curves.length;n++){e=this._curves[n];const o=e.getLength(this.direction);if(i+o>=t)break;i+=o}const n=(t-i)/e.getLength(this.direction);return{pos:e.getPointAt(n),angle:e.getAngleAt(n)}}drawWithClipRange(t,e,i,n,o){this.tryBuildCurves();const r=this.getLength()*o;let s=0;for(let o=0;o<this._curves.length;o++){const a=this._curves[o],l=a.getLength(this.direction);if(!(s+l<=r)){const o=1-(s+l-r)/l;a.draw(t,i,n,e,e,o);break}a.draw(t,i,n,e,e,1),s+=l}}}const xn=["l",0,0,0,0,0,0,0];function _n(t,e,i){const n=xn[0]=t[0];if("a"===n||"A"===n)xn[1]=e*t[1],xn[2]=i*t[2],xn[3]=t[3],xn[4]=t[4],xn[5]=t[5],xn[6]=e*t[6],xn[7]=i*t[7];else if("h"===n||"H"===n)xn[1]=e*t[1];else if("v"===n||"V"===n)xn[1]=i*t[1];else for(let n=1,o=t.length;n<o;++n)xn[n]=(n%2==1?e:i)*t[n];return xn}const Sn={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new De},An={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0},Bn={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeBoundsBuffer:2,stroke:!1},Tn=Object.assign({outerBorder:Object.assign(Object.assign({},Bn),{distance:0}),innerBorder:Object.assign(Object.assign({},Bn),{distance:0})},Bn),Rn={text:"",maxLineWidth:1/0,maxWidth:1/0,textAlign:"left",textBaseline:"alphabetic",fontSize:16,fontFamily:"PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,\n    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",fontWeight:"",ellipsis:"…",fontVariant:"",fontStyle:"",lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:"horizontal",wordBreak:"break-all",ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:"no-wrap",heightLimit:1/0,lineClamp:1/0,suffixPosition:"end",underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0,measureMode:Z.fontBounding,keepCenterInLine:!1},kn=Object.assign(Object.assign(Object.assign(Object.assign({forceBoundsWidth:void 0,forceBoundsHeight:void 0,opacity:1,background:null,autoAnimateTexture:!1,textureRatio:1,textureOptions:null,backgroundOpacity:1,backgroundCornerRadius:0,texture:null,textureColor:"black",textureSize:10,texturePadding:2,backgroundMode:"no-repeat",backgroundFit:!0,backgroundKeepAspectRatio:!1,backgroundClip:!0,backgroundScale:1,backgroundOffsetX:0,backgroundOffsetY:0,blur:0,filter:"",cursor:null,html:null,react:null,vue:null},An),Tn),{alignSelf:"auto"}),{pickStrokeBuffer:0}),Mn={connectedType:"none",connectedStyle:{},connectedX:NaN,connectedY:NaN},Ln=Object.assign(Object.assign(Object.assign({strokeSeg:null,renderable:!0,pickable:!0,shadowGraphic:void 0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,fillStrokeOrder:0,renderStyle:"default",pickMode:"accurate",customPickShape:null,boundsMode:"accurate",keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:"",overflow:"hidden",shadowPickMode:"graphic",keepStrokeScale:!1,clipConfig:null},{_debug_bounds:!1}),kn),Sn),Pn=Object.assign(Object.assign({},Ln),{startAngle:0,endAngle:oe,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),En=Object.assign(Object.assign(Object.assign({},Ln),Mn),{points:[],segments:[],curveType:"linear",clipRange:1,closePath:!1,curveTension:1}),Hn=Object.assign(Object.assign({},Ln),{radius:1,startAngle:0,endAngle:oe}),On=Object.assign(Object.assign({},Ln),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:"relative",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"flex-start",baseOpacity:1,cornerType:"round"}),In=Object.assign(Object.assign({},Ln),{path:"",width:0,height:0,cornerRadius:0,clip:!1}),Fn=Object.assign(Object.assign(Object.assign({},Ln),Mn),{points:[],segments:[],curveType:"linear",clipRange:1,clipRangeByDimension:"default",closePath:!1,curveTension:1}),zn=Object.assign(Object.assign({},Ln),{path:new wn,fillStrokeOrder:1,clipRange:1,customPath:()=>{Vt.getInstance().warn("空函数")}}),Dn=Object.assign(Object.assign({},Ln),{points:[],cornerRadius:0,closePath:!0}),Wn=Object.assign(Object.assign({},Ln),{width:100,height:100,spikes:5,thickness:.5}),Nn=Object.assign(Object.assign({},Ln),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0,cornerType:"round"});Object.assign(Object.assign({},Ln),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0,cornerType:"round"});const Gn=Object.assign(Object.assign({},Ln),{symbolType:"circle",size:10,keepDirIn3d:!0,clipRange:1}),jn=Object.assign(Object.assign(Object.assign({},Ln),Rn),{strokeBoundsBuffer:0,keepDirIn3d:!0}),Vn=Object.assign(Object.assign(Object.assign({},Ln),Rn),{upgradeAttrs:null,editable:!1,editOptions:null,ascentDescentMode:"actual",width:300,height:300,ellipsis:!0,wordBreak:"break-word",verticalDirection:"top",textAlign:"left",textBaseline:"top",layoutDirection:"horizontal",textConfig:[],disableAutoWrapLine:!1,maxHeight:void 0,maxWidth:void 0,singleLine:!1}),Un=Object.assign(Object.assign({repeatX:"no-repeat",repeatY:"no-repeat",image:"",width:0,height:0,maxWidth:500,maxHeight:500},Ln),{fill:!0,cornerRadius:0,cornerType:"round"}),Xn=Object.assign(Object.assign({},Un),{backgroundShowMode:"never",backgroundWidth:0,backgroundHeight:0,textAlign:"left",textBaseline:"middle",direction:"horizontal",margin:0,id:"",width:20,height:20,backgroundFill:"rgba(101, 117, 168, 0.1)",backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1});const $n=new class{},Yn=function(){const t={linearGradient:/^(linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,fromAngleValue:/^from\s*(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/(^\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\(\d{1,3},\s*\d{1,3},\s*\d{1,3}\))/i,rgbaColor:/^(rgba\(\d{1,3},\s*\d{1,3},\s*\d{1,3},\s*((\d\.\d+)|\d{1,3})\))/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/};let e="";function i(t){const i=new Error(e+": "+t);throw i.source=e,i}function n(){return o("linear",t.linearGradient,r)||o("radial",t.radialGradient,a)||o("conic",t.conicGradient,s)}function o(e,n,o){return function(n,r){const s=b(n);if(s){b(t.startCall)||i("Missing (");const n=function(n){const r=o();return r&&(b(t.comma)||i("Missing comma before color stops")),{type:e,orientation:r,colorStops:u(g)}}();return b(t.endCall)||i("Missing )"),n}}(n)}function r(){return v("directional",t.sideOrCorner,1)||v("angular",t.angleValue,1)}function s(){return v("angular",t.fromAngleValue,1)}function a(){let i,n,o=l();return o&&(i=[],i.push(o),n=e,b(t.comma)&&(o=l(),o?i.push(o):e=n)),i}function l(){let t=function(){const t=v("shape",/^(circle)/i,0);return t&&(t.style=f()||h()),t}()||function(){const t=v("shape",/^(ellipse)/i,0);return t&&(t.style=p()||h()),t}();if(t)t.at=d();else{const e=h();if(e){t=e;const i=d();i&&(t.at=i)}else{const e=c();e&&(t={type:"default-radial",at:e})}}return t}function h(){return v("extent-keyword",t.extentKeywords,1)}function d(){if(v("position",/^at/,0)){const t=c();return t||i("Missing positioning value"),t}}function c(){const t={x:p(),y:p()};if(t.x||t.y)return{type:"position",value:t}}function u(e){let n=e();const o=[];if(n)for(o.push(n);b(t.comma);)n=e(),n?o.push(n):i("One extra comma");return o}function g(){const e=v("hex",t.hexColor,1)||v("rgba",t.rgbaColor,1)||v("rgb",t.rgbColor,1)||v("literal",t.literalColor,0);return e||i("Expected color definition"),e.length=p(),e}function p(){return v("%",t.percentageValue,1)||v("position-keyword",t.positionKeywords,1)||f()}function f(){return v("px",t.pixelValue,1)||v("em",t.emValue,1)}function v(t,e,i){const n=b(e);if(n)return{type:t,value:n[i]}}function b(t){const i=/^[\n\r\t\s]+/.exec(e);i&&m(i[0].length);const n=t.exec(e);return n&&m(n[0].length),n}function m(t){e=e.substr(t)}return function(t){return e=t.toString(),function(){const t=u(n);return e.length>0&&i("Invalid input not EOF"),t}()}}();class Kn{static IsGradient(t){return!("string"==typeof t&&!t.includes("gradient"))}static IsGradientStr(t){return"string"==typeof t&&t.includes("gradient")}static Parse(t){if(Kn.IsGradientStr(t))try{const e=Yn(t)[0];if(e){if("linear"===e.type)return Kn.ParseLinear(e);if("radial"===e.type)return Kn.ParseRadial(e);if("conic"===e.type)return Kn.ParseConic(e)}}catch(e){return t}return t}static ParseConic(t){const{orientation:e,colorStops:i=[]}=t,n=ee/2,o=parseFloat(e.value)/180*ee-n;return{gradient:"conical",x:.5,y:.5,startAngle:o,endAngle:o+oe,stops:i.map((t=>({color:t.value,offset:parseFloat(t.length.value)/100})))}}static ParseRadial(t){const{colorStops:e=[]}=t;return{gradient:"radial",x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:e.map((t=>({color:t.value,offset:parseFloat(t.length.value)/100})))}}static ParseLinear(t){const{orientation:e,colorStops:i=[]}=t,n=ee/2;let o="angular"===e.type?parseFloat(e.value)/180*ee:0;for(;o<0;)o+=oe;for(;o>=oe;)o-=oe;let r=0,s=0,a=0,l=0;return o<n?(r=0,s=1,a=Math.sin(o),l=s-Math.cos(o)):o<ee?(r=0,s=0,a=Math.cos(o-n),l=Math.sin(o-n)):o<ee+n?(r=1,s=0,a=r-Math.sin(o-ee),l=Math.cos(o-ee)):(r=1,a=r-Math.cos(o-n-ee),l-=Math.sin(o-n-ee)),{gradient:"linear",x0:r,y0:s,x1:a,y1:l,stops:i.map((t=>({color:t.value,offset:parseFloat(t.length.value)/100})))}}}function qn(t,e,i){let n=e;const{a:o,b:r,c:s,d:a}=t.currentMatrix,l=Math.sign(o)*Math.sqrt(o*o+r*r),h=Math.sign(a)*Math.sqrt(s*s+a*a);return l+h===0?0:(n=n/Math.abs(l+h)*2*i,n)}function Zn(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;var r,s,a,l;if(!e||!0===e)return"black";let h,d;if(ut(e))for(let t=0;t<e.length&&(d=e[t],!d);t++);else d=e;if(d=Kn.Parse(d),"string"==typeof d)return d;if(i.AABBBounds&&(!i.attribute||0!==i.attribute.scaleX||0!==i.attribute.scaleY)){const e=i.AABBBounds;let c=e.x2-e.x1,u=e.y2-e.y1,g=e.x1-n,p=e.y1-o;if(i.attribute){const{scaleX:t=1,scaleY:e=1,angle:n=0}=i.attribute;c/=t,u/=e,g/=t,p/=e,(n||1!==t||1!==e)&&(g=null!==(r=i.x1WithoutTransform)&&void 0!==r?r:0,p=null!==(s=i.y1WithoutTransform)&&void 0!==s?s:0,c=null!==(a=i.widthWithoutTransform)&&void 0!==a?a:c,u=null!==(l=i.heightWithoutTransform)&&void 0!==l?l:u)}"linear"===d.gradient?h=function(t,e,i,n,o,r){var s,a,l,h;const d=t.createLinearGradient(i+(null!==(s=e.x0)&&void 0!==s?s:0)*o,n+(null!==(a=e.y0)&&void 0!==a?a:0)*r,i+(null!==(l=e.x1)&&void 0!==l?l:1)*o,n+(null!==(h=e.y1)&&void 0!==h?h:0)*r);return e.stops.forEach((t=>{d.addColorStop(t.offset,t.color)})),d}(t,d,g,p,c,u):"conical"===d.gradient?h=function(t,e,i,n,o,r){var s,a;const l=t.createConicGradient(i+(null!==(s=e.x)&&void 0!==s?s:0)*o,n+(null!==(a=e.y)&&void 0!==a?a:0)*r,e.startAngle,e.endAngle);return e.stops.forEach((t=>{l.addColorStop(t.offset,t.color)})),l.GetPattern?l.GetPattern(o+i,r+n,void 0):l}(t,d,g,p,c,u):"radial"===d.gradient&&(h=function(t,e,i,n,o,r){var s,a,l,h,d,c;const u=t.createRadialGradient(i+(null!==(s=e.x0)&&void 0!==s?s:.5)*o,n+(null!==(a=e.y0)&&void 0!==a?a:.5)*r,Math.max(o,r)*(null!==(l=e.r0)&&void 0!==l?l:0),i+(null!==(h=e.x1)&&void 0!==h?h:.5)*o,n+(null!==(d=e.y1)&&void 0!==d?d:.5)*r,Math.max(o,r)*(null!==(c=e.r1)&&void 0!==c?c:.5));return e.stops.forEach((t=>{u.addColorStop(t.offset,t.color)})),u}(t,d,g,p,c,u))}return h||"orange"}const Jn={horizontal:{width:"width",height:"height",left:"left",top:"top",x:"x",y:"y",bottom:"bottom"},vertical:{width:"height",height:"width",left:"top",top:"left",x:"y",y:"x",bottom:"right"}},Qn=!0,to=!1,eo=/\w|\(|\)|-/,io=/[.?!,;:/，。？！、；：]/,no=/\S/,oo=(t,e)=>{let i=e.fontSize||16;switch(e.script){case"super":case"sub":i*=.8}t.setTextStyle({textAlign:"left",textBaseline:e.textBaseline||"alphabetic",fontStyle:e.fontStyle||"",fontWeight:e.fontWeight||"",fontSize:i,fontFamily:e.fontFamily})};function ro(t,e,i,n,o){if(t.length<=1)return 0;if(!e||e<=0)return 0;const r=$n.graphicUtil.textMeasure;let s=n,a=t.slice(0,s),l=Math.floor(r.measureText(a,i).width),h=t.slice(0,s+1),d=Math.floor(r.measureText(h,i).width);for(;l>e||d<=e;){if(l>e?s--:s++,s>t.length){s=t.length;break}if(s<0){s=0;break}a=t.slice(0,s),l=Math.floor(r.measureText(a,i).width),h=t.slice(0,s+1),d=Math.floor(r.measureText(h,i).width)}return o&&(s=so(t,s)),s}function so(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e;for(;eo.test(t[n-1])&&eo.test(t[n])||io.test(t[n]);)if(n--,n<=0)return i?ao(t,e):e;return n}function ao(t,e){let i=e;for(;eo.test(t[i+1])&&eo.test(t[i])||io.test(t[i]);)if(i++,i>=t.length)return i;return i+1}function lo(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"actual";var n;if(""===t)return{ascent:0,height:0,descent:0,width:0};const o=$n.graphicUtil.textMeasure.measureText(t,e),r={ascent:0,height:0,descent:0,width:0},s="actual"===i?o.actualBoundingBoxAscent:o.fontBoundingBoxAscent,a="actual"===i?o.actualBoundingBoxDescent:o.fontBoundingBoxDescent;"number"!=typeof s||"number"!=typeof a?(r.width=Math.floor(o.width),r.height=e.fontSize||0,r.ascent=r.height,r.descent=0):(r.width=Math.floor(o.width),r.height=Math.floor(s+a),r.ascent=Math.floor(s),r.descent=r.height-r.ascent);const l=null!==(n=e.space)&&void 0!==n?n:0;return r.width+=l,r}var ho=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let co=class{configure(t,e){this.canvas=t.canvas,this.context=t.context,t.bindTextMeasure(this)}_measureTextWithoutAlignBaseline(t,e,i){this.context.setTextStyleWithoutAlignBaseline(e);const n=this.context.measureText(t);return i?this.compatibleMetrics(n,e):n}_measureTextWithAlignBaseline(t,e,i){this.context.setTextStyle(e);const n=this.context.measureText(t);return i?this.compatibleMetrics(n,e):n}compatibleMetrics(t,e){if(null==t.actualBoundingBoxAscent||null==t.actualBoundingBoxDescent||null==t.fontBoundingBoxAscent||null==t.fontBoundingBoxDescent){t={width:t.width};const{ascent:i,descent:n}=this.measureTextBoundADscentEstimate(e);t.actualBoundingBoxAscent=i,t.actualBoundingBoxDescent=n,t.fontBoundingBoxAscent=i,t.fontBoundingBoxDescent=n}if(null==t.actualBoundingBoxLeft||null==t.actualBoundingBoxRight){t={width:t.width,actualBoundingBoxAscent:t.actualBoundingBoxAscent,actualBoundingBoxDescent:t.actualBoundingBoxDescent,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent};const{left:i,right:n}=this.measureTextBoundLeftRightEstimate(e);t.actualBoundingBoxLeft=i,t.actualBoundingBoxRight=n}return t}estimate(t,e){let{fontSize:i=jn.fontSize}=e,n=0,o=0;for(let e=0;e<t.length;e++)t.charCodeAt(e)<128?n++:o++;return{width:~~(.8*n*i+o*i),height:i}}measureTextWidth(t,e,i){return this.context?(i=null!=i?i:this._measureTextWithoutAlignBaseline(t,e)).width:this.estimate(t,e).width}measureTextBoundsWidth(t,e,i){return this.context?(i=null!=i?i:this._measureTextWithoutAlignBaseline(t,e)).width:this.estimate(t,e).width}measureTextBoundsLeftRight(t,e,i){return this.context?{left:(i=null!=i?i:this._measureTextWithAlignBaseline(t,e,!0)).actualBoundingBoxLeft,right:i.actualBoundingBoxRight}:this.measureTextBoundLeftRightEstimate(e)}measureTextPixelHeight(t,e,i){var n;return this.context?(i=null!=i?i:this._measureTextWithoutAlignBaseline(t,e,!0),Math.abs(i.actualBoundingBoxAscent-i.actualBoundingBoxDescent)):null!==(n=e.fontSize)&&void 0!==n?n:Rn.fontSize}measureTextPixelADscent(t,e,i){return this.context?{ascent:(i=null!=i?i:this._measureTextWithAlignBaseline(t,e,!0)).actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent}:this.measureTextBoundADscentEstimate(e)}measureTextBoundHieght(t,e,i){var n;return this.context?(i=null!=i?i:this._measureTextWithoutAlignBaseline(t,e,!0),Math.abs(i.fontBoundingBoxAscent-i.fontBoundingBoxDescent)):null!==(n=e.fontSize)&&void 0!==n?n:Rn.fontSize}measureTextBoundADscent(t,e,i){return this.context?{ascent:(i=null!=i?i:this._measureTextWithAlignBaseline(t,e,!0)).fontBoundingBoxAscent,descent:i.fontBoundingBoxDescent}:this.measureTextBoundADscentEstimate(e)}measureTextBoundADscentEstimate(t){var e;const i=null!==(e=t.fontSize)&&void 0!==e?e:Rn.fontSize;return{ascent:.79*i,descent:.21*i}}measureTextBoundLeftRightEstimate(t){var e;const i=null!==(e=t.fontSize)&&void 0!==e?e:Rn.fontSize,{textAlign:n}=t;return"center"===n?{left:i/2,right:i/2}:"right"===n||"end"===n?{left:i,right:0}:{left:0,right:i}}measureTextPixelADscentAndWidth(t,e,i){if(!this.context)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(e)),{width:this.estimate(t,e).width});const n=this._measureTextWithoutAlignBaseline(t,e,!0);if(i===Z.actualBounding)return{ascent:n.actualBoundingBoxAscent,descent:n.actualBoundingBoxDescent,width:n.width};if(i===Z.estimate)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(e)),{width:n.width});if(i===Z.fontBounding){let t=n.fontBoundingBoxAscent,e=n.fontBoundingBoxDescent;if(n.actualBoundingBoxDescent&&e<n.actualBoundingBoxDescent){const i=n.actualBoundingBoxDescent-e;e+=i,t-=i}else if(n.actualBoundingBoxAscent&&t<n.actualBoundingBoxAscent){const i=n.actualBoundingBoxAscent-t;t+=i,e-=i}return{ascent:t,descent:e,width:n.width}}return{ascent:n.actualBoundingBoxAscent,descent:n.actualBoundingBoxDescent,width:n.width}}measureText(t,e){return this.context?(this.context.setTextStyleWithoutAlignBaseline(e),this.context.measureText(t)):this.estimate(t,e)}clipTextVertical(t,e,i,n){if(0===t.length)return{verticalList:t,width:0};const{fontSize:o=12}=e;t.forEach((t=>{t.width=0===t.direction?o:this.measureTextWidth(t.text,e)}));const r=[];let s=0,a=0;for(;a<t.length&&s+t[a].width<i;a++)s+=t[a].width,r.push(t[a]);if(t[a]&&t[a].text.length>1){const o=this._clipText(t[a].text,e,i-s,0,t[a].text.length-1,"end",!1);if(n&&o.str!==t[a].text){let i="",n=0;for(let e=0;e<a;e++){const o=t[e];i+=o.text,n+=o.text.length}i+=t[a].text;let r=so(i,n+o.str.length);r-=n,r!==o.str.length-1&&(o.str=o.str.substring(0,r),o.width=this.measureTextWidth(o.str,e))}r.push(Object.assign(Object.assign({},t[a]),{text:o.str,width:o.width})),s+=o.width}return{verticalList:r,width:s}}clipText(t,e,i,n,o){if(0===t.length)return{str:"",width:0};let r=this.measureTextWidth(t,e);if(r<=i)return{str:t,width:r};if(r=this.measureTextWidth(t[0],e),r>i)return{str:"",width:0};const s=this._clipText(t,e,i,0,t.length-1,"end",!1);if(n&&s.str!==t){let i=so(t,s.str.length,o);i!==s.str.length&&(i>s.str.length&&(s.wordBreaked=i,i=s.str.length),s.str=t.substring(0,i),s.width=this.measureTextWidth(s.str,e))}return s}_clipText(t,e,i,n,o,r,s){let a;if("start"===r)a=this._clipTextStart(t,e,i,n,o),s&&(a.result=s+a.str);else if("middle"===r){const n=this._clipTextMiddle(t,e,i,"","",0,0,1);a={str:"none",width:n.width,result:n.left+s+n.right}}else a=this._clipTextEnd(t,e,i,n,o),s&&(a.result=a.str+s);return a}_clipTextEnd(t,e,i,n,o){if(n===o){Vt.getInstance().warn(`【_clipTextEnd】不应该走到这里${t}, ${n}, ${o}`);const i=t.substring(0,o+1);return{str:i,width:this.measureTextWidth(i,e)}}const r=Math.floor((n+o)/2),s=t.substring(0,r+1),a=this.measureTextWidth(s,e);let l;if(a>i){if(s.length<=1)return{str:"",width:0};const o=t.substring(0,r);return l=this.measureTextWidth(o,e),l<=i?{str:o,width:l}:this._clipTextEnd(t,e,i,n,r)}if(a<i){if(r>=t.length-1)return{str:t,width:this.measureTextWidth(t,e)};const n=t.substring(0,r+2);return l=this.measureTextWidth(n,e),l>=i?{str:s,width:a}:this._clipTextEnd(t,e,i,r,o)}return{str:s,width:a}}_clipTextStart(t,e,i,n,o){const r=Math.ceil((n+o)/2),s=t.substring(r-1,t.length),a=this.measureTextWidth(s,e);let l;if(a>i){if(s.length<=1)return{str:"",width:0};const n=t.substring(r,t.length);return l=this.measureTextWidth(n,e),l<=i?{str:n,width:l}:this._clipTextStart(t,e,i,r,t.length)}if(a<i){if(r<=0)return{str:t,width:this.measureTextWidth(t,e)};const o=t.substring(r-2,t.length);return l=this.measureTextWidth(o,e),l>=i?{str:s,width:a}:this._clipTextStart(t,e,i,n,r)}return{str:s,width:a}}_clipTextMiddle(t,e,i,n,o,r,s,a){const l=t.substring(0,a),h=this.measureTextWidth(l,e);if(h+s>i)return{left:n,right:o,width:r+s};const d=t.substring(t.length-a,t.length),c=this.measureTextWidth(d,e);return h+c>i?{left:l,right:o,width:h+s}:this._clipTextMiddle(t,e,i,l,d,h,c,a+1)}clipTextWithSuffixVertical(t,e,i,n,o,r){if(""===n)return this.clipTextVertical(t,e,i,o);if(0===t.length)return{verticalList:t,width:0};const s=this.clipTextVertical(t,e,i,o);if(s.verticalList.length===t.length&&s.verticalList[s.verticalList.length-1].width===t[t.length-1].width)return s;const a=this.measureTextWidth(n,e);if(a>i)return s;let l;if(i-=a,"start"===r){const r=this.revertVerticalList(t);l=this.clipTextVertical(r,e,i,o);const s=this.revertVerticalList(l.verticalList);s.unshift({text:n,direction:1,width:a}),l.verticalList=s}else if("middle"===r){const r=this.clipTextVertical(t,e,i/2,o),s=this.revertVerticalList(t),h=this.clipTextVertical(s,e,i/2,o);r.verticalList.push({text:n,direction:1,width:a}),this.revertVerticalList(h.verticalList).forEach((t=>r.verticalList.push(t))),l={verticalList:r.verticalList,width:r.width+h.width}}else l=this.clipTextVertical(t,e,i,o),l.verticalList.push({text:n,direction:1,width:a});return l.width+=a,l}revertVerticalList(t){return t.reverse().map((t=>{const e=t.text.split("").reverse().join("");return Object.assign(Object.assign({},t),{text:e})}))}clipTextWithSuffix(t,e,i,n,o,r){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(""===n)return this.clipText(t,e,i,o);if(0===t.length)return{str:"",width:0};const a=this.measureTextWidth(t,e);if(!s&&a<=i)return{str:t,width:a};const l=this.measureTextWidth(n,e);if(l>i)return{str:"",width:0};if(s&&a+l<=i)return{str:t+n,width:a+l};i-=l;const h=this._clipText(t,e,i,0,t.length-1,r,n);if(o&&h.str!==t){const i=so(t,h.str.length);i!==h.str.length&&(h.result=t.substring(0,i),h.width=this.measureTextWidth(h.str,e))}else s&&h.str===t&&(h.result=t+n);return h.str=h.result,h.width+=l,h}};co=ho([w()],co);var uo=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};const go=Symbol.for("TextMeasureContribution");let po=class extends co{};po=uo([w()],po);const fo=new class{constructor(t){const e=t||{};e.defaultScope=e.defaultScope||S,this.options=e,this.id=a.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new P}load(t){const e=this._getContainerModuleHelpersFactory()(t.id);t.registry(e.bindFunction,e.unbindFunction,e.isboundFunction,e.rebindFunction)}get(t){const e=this._getNotAllArgs(t,!1);return this._get(e)}getAll(t){const e=this._getAllArgs(t);return this._get(e)}getTagged(t,e,i){const n=this._getNotAllArgs(t,!1,e,i);return this._get(n)}getNamed(t,e){return this.getTagged(t,h,e)}isBound(t){return this._bindingDictionary.has(t)}bind(t){const e=this.options.defaultScope,i=new L(t,e),n=this._bindingDictionary.get(t)||[];return n.push(i),this._bindingDictionary.set(t,n),new I(i)}unbind(t){this._bindingDictionary.delete(t)}rebind(t){return this.unbind(t),this.bind(t)}_getContainerModuleHelpersFactory(){const t=(t,e)=>{t._binding.moduleId=e},e=e=>i=>{const n=this.bind(i);return t(n,e),n},i=()=>t=>this.unbind(t),n=()=>t=>this.isBound(t),o=e=>i=>{const n=this.rebind(i);return t(n,e),n};return t=>({bindFunction:e(t),isboundFunction:n(),rebindFunction:o(t),unbindFunction:i(),unbindAsyncFunction:t=>null})}_getNotAllArgs(t,e,i,n){return{avoidConstraints:!1,isMultiInject:e,serviceIdentifier:t,key:i,value:n}}_getAllArgs(t){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:t}}_get(t){const e=[];return this._bindingDictionary.get(t.serviceIdentifier).filter((e=>e.constraint(t))).forEach((t=>{e.push(this._resolveFromBinding(t))})),t.isMultiInject||1!==e.length?e:e[0]}_getChildRequest(t){const e=t.implementationType,{userGeneratedMetadata:i}=this._metadataReader.getConstructorMetadata(e),n=Object.keys(i),o=[];for(let t=0;t<n.length;t++){const e=i[t],n={};e.forEach((t=>{n[t.key]=t.value}));const r={inject:n[d],multiInject:n[c]},s=r.inject||r.multiInject,a={serviceIdentifier:s,constructorArgsMetadata:e},l=(this._bindingDictionary.get(s)||[]).filter((t=>t.constraint(a)));if(l.length){const t={injectIdentifier:s,metadata:e,bindings:l};o.push(t)}}return o}_resolveFromBinding(t){const e=this._getResolvedFromBinding(t);return this._saveToScope(t,e),e}_getResolvedFromBinding(t){let e;switch(t.type){case A:case R:e=t.cache;break;case k:e=this._resolveInstance(t,t.implementationType);break;default:e=t.dynamicValue({container:this})}return e}_resolveInstance(t,e){if(t.activated)return t.cache;const i=this._getChildRequest(t);return this._createInstance(e,i)}_createInstance(t,e){return e.length?new t(...this._resolveRequests(e)):new t}_resolveRequests(t){return t.map((t=>t.bindings.length>1?t.bindings.map((t=>this._resolveFromBinding(t))):this._resolveFromBinding(t.bindings[0])))}_saveToScope(t,e){t.scope===_&&(t.cache=e,t.activated=!0)}},vo=Symbol.for("CanvasFactory"),bo=Symbol.for("Context2dFactory");function mo(t){return fo.getNamed(vo,$n.global.env)(t)}const yo=new class{constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||(this._commonCanvas=this.allocate({width:100,height:100,dpr:2})),this._commonCanvas}allocate(t){if(!this.pools.length){const e=mo(Object.assign({nativeCanvas:$n.global.createCanvas(t)},t));return this.allocatedCanvas.push(e),e}const e=this.pools.pop();return e.resize(t.width,t.height),e.dpr=t.dpr,e}allocateByObj(t){if(!this.pools.length){const e={width:t.width/t.dpr,height:t.height/t.dpr,dpr:t.dpr},i=mo(Object.assign({nativeCanvas:$n.global.createCanvas(e)},e));return this.allocatedCanvas.push(i),i}const e=this.pools.pop();return e.width=t.width,e.height=t.height,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}};var Co=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},wo=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const xo=Symbol.for("VWindow"),_o=Symbol.for("WindowHandlerContribution");let So=class extends U{get width(){if(this._handler){const t=this._handler.getWH();return this._width=t.width}return this._width}get height(){if(this._handler){const t=this._handler.getWH();return this._height=t.height}return this._height}get dpr(){return this._handler.getDpr()}constructor(){super(),this.hooks={onChange:new G(["x","y","width","height"])},this.active=()=>{const t=this.global;t.env&&!this.actived&&(fo.getNamed(_o,t.env).configure(this,t),this.actived=!0)},this._uid=a.GenAutoIncrementId(),this.global=$n.global,this.postInit()}_nativeAddEventListener(t,e,i){return this._handler.addEventListener(t,e,i)}_nativeRemoveEventListener(t,e,i){return this._handler.removeEventListener(t,e,i)}_nativeDispatchEvent(t){return this._handler.dispatchEvent(t)}postInit(){this.global.hooks.onSetEnv.tap("window",this.active),this.active()}get style(){var t;return null!==(t=this._handler.getStyle())&&void 0!==t?t:{}}set style(t){this._handler.setStyle(t)}create(t){var e,i;this._handler.createWindow(t);const n=this._handler.getWH();this._width=n.width,this._height=n.height,t.viewBox?this.setViewBox(t.viewBox):!1!==t.canvasControled?this.setViewBox({x1:0,y1:0,x2:this._width,y2:this._height}):this.setViewBox({x1:0,y1:0,x2:null!==(e=t.width)&&void 0!==e?e:this._width,y2:null!==(i=t.height)&&void 0!==i?i:this._height}),this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(t){this._handler=t}setDpr(t){return this._handler.setDpr(t)}resize(t,e){return this._handler.resizeWindow(t,e)}configure(){throw new Error("暂不支持")}release(){return this.global.hooks.onSetEnv.unTap("window",this.active),this.clearAllEventListeners(),this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(t){return this._handler.getImageBuffer?this._handler.getImageBuffer(t):null}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(t){this._handler.clearViewBox(t)}setViewBox(t){this._handler.setViewBox(t)}setViewBoxTransform(t,e,i,n,o,r){this._handler.setViewBoxTransform(t,e,i,n,o,r)}getViewBox(){return this._handler.getViewBox()}getViewBoxTransform(){return this._handler.getViewBoxTransform()}pointTransform(t,e){const i=this._handler.getViewBox(),n={x:t,y:e};return this._handler.getViewBoxTransform().transformPoint({x:t,y:e},n),n.x-=i.x1,n.y-=i.y1,n}hasSubView(){const t=this._handler.getViewBox();return!(0===t.x1&&0===t.y1&&Ut(this.width,t.width())&&Ut(this.height,t.height()))}isVisible(t){return this._handler.isVisible(t)}onVisibleChange(t){return this._handler.onVisibleChange(t)}getTopLeft(t){return this._handler.getTopLeft(t)}};So=Co([w(),wo("design:paramtypes",[])],So);var Ao=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Bo=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},To=function(t,e){return function(i,n){e(i,n,t)}};let Ro=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(t){this.contributions=t,this.configured=!1,this.global=$n.global,this.global.hooks.onSetEnv.tap("graphic-util",((t,e,i)=>{this.configured=!1,this.configure(i,e)}))}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}configure(t,e){this.configured||(this.contributions.getContributions().forEach((t=>{t.configure(this,e)})),this.configured=!0)}tryInitCanvas(){if(!this._canvas){const t=yo.shareCanvas();this._canvas=t,this._context=t.getContext("2d")}}bindTextMeasure(t){this._textMeasure=t}measureText(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"native";var n;this.configure(this.global,this.global.env);const o=this.global.measureTextMethod;this.global.measureTextMethod=i;const r={width:this._textMeasure.measureTextWidth(t,e),height:null!==(n=e.fontSize)&&void 0!==n?n:Rn.fontSize};return this.global.measureTextMethod=o,r}createTextMeasureInstance(t,e,i){return this.configure(this.global,this.global.env),new Pe(Object.assign({defaultFontParams:{fontFamily:Rn.fontFamily,fontSize:Rn.fontSize},getCanvasForMeasure:i||(()=>this.canvas),getTextBounds:void 0,specialCharSet:"-/: .,@%'\"~"+Pe.ALPHABET_CHAR_SET+Pe.ALPHABET_CHAR_SET.toUpperCase()},null!=e?e:{}),t)}drawGraphicToCanvas(t,e,i){if(!e.defaultLayer)return null;const n=fo.get(xo),o=t.AABBBounds,r=o.width(),s=o.height(),a=-o.x1,l=-o.y1;n.create({viewBox:{x1:a,y1:l,x2:o.x2,y2:o.y2},width:r,height:s,canvas:i,dpr:e.window.dpr,canvasControled:!0,offscreen:!0,title:""});const h=e.params.optimize.disableCheckGraphicWidthOutRange;e.params.optimize.disableCheckGraphicWidthOutRange=!0,e.defaultLayer.getNativeHandler().drawTo(n,[t],{transMatrix:n.getViewBoxTransform(),viewBox:n.getViewBox(),stage:e,layer:e.defaultLayer,renderService:e.renderService,background:"transparent",clear:!0,updateBounds:!1}),e.params.optimize.disableCheckGraphicWidthOutRange=h;const d=n.getNativeHandler();return d.nativeCanvas?d.nativeCanvas:null}};var ko;Ro=Ao([w(),To(0,y(F)),To(0,x(go)),Bo("design:paramtypes",[Object])],Ro),function(t){t[t.transform=0]="transform",t[t.matrix=1]="matrix"}(ko||(ko={}));const Mo=new De;let Lo=class{constructor(){this.matrix=new De}init(t){return this.mode=ko.transform,this.originTransform=t,this.matrix.reset(),this}fromMatrix(t,e){return this.mode=ko.matrix,this.outSourceMatrix=t,this.outTargetMatrix=e,this}scaleMatrix(t,e,i){const n=this.outSourceMatrix;if(Mo.setValue(n.a,n.b,n.c,n.d,n.e,n.f),this.outTargetMatrix.reset(),i){const{x:n,y:o}=i;this.outTargetMatrix.translate(n,o),this.outTargetMatrix.scale(t,e),this.outTargetMatrix.translate(-n,-o)}else this.outTargetMatrix.scale(t,e);return this.outTargetMatrix.multiply(Mo.a,Mo.b,Mo.c,Mo.d,Mo.e,Mo.f),this}rotateMatrix(t,e){const i=this.outSourceMatrix;if(Mo.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),e){const{x:i,y:n}=e;this.outTargetMatrix.translate(i,n),this.outTargetMatrix.rotate(t),this.outTargetMatrix.translate(-i,-n)}else this.outTargetMatrix.rotate(t);return this.outTargetMatrix.multiply(Mo.a,Mo.b,Mo.c,Mo.d,Mo.e,Mo.f),this}scale(t,e,i){return this.mode===ko.matrix?this.scaleMatrix(t,e,i):this}rotate(t,e){return this.mode===ko.matrix?this.rotateMatrix(t,e):this}translateMatrix(t,e){const i=this.outSourceMatrix;return Mo.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(t,e),this.outTargetMatrix.multiply(Mo.a,Mo.b,Mo.c,Mo.d,Mo.e,Mo.f),this}translate(t,e){return this.mode===ko.matrix?this.translateMatrix(t,e):this}simplify(t){return this.mode===ko.matrix?this.simplifyMatrix(t):this}simplifyMatrix(t){return this}};Lo=Ao([w(),Bo("design:paramtypes",[])],Lo);const Po={arc:Pn,area:En,circle:Hn,line:Fn,path:zn,symbol:Gn,text:jn,rect:Nn,polygon:Dn,star:Wn,richtext:Vn,richtextIcon:Xn,image:Un,group:On,glyph:In},Eo=Object.keys(Po);function Ho(t,e){Object.keys(e).forEach((i=>{t[i]=e[i]}))}const Oo={arc:Object.assign({},Po.arc),area:Object.assign({},Po.area),circle:Object.assign({},Po.circle),line:Object.assign({},Po.line),path:Object.assign({},Po.path),symbol:Object.assign({},Po.symbol),text:Object.assign({},Po.text),rect:Object.assign({},Po.rect),polygon:Object.assign({},Po.polygon),star:Object.assign({},Po.star),richtext:Object.assign({},Po.richtext),richtextIcon:Object.assign({},Po.richtextIcon),image:Object.assign({},Po.image),group:Object.assign({},Po.group),glyph:Object.assign({},Po.glyph)};class Io{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},Eo.forEach((t=>{this._defaultTheme[t]=Object.create(Oo[t])})),this.combinedTheme=this._defaultTheme}getTheme(t){if(!t)return this.combinedTheme;if(!this.dirty)return this.combinedTheme;let e={};const i=this.getParentWithTheme(t);return i&&(e=i.theme),this.applyTheme(t,e),this.combinedTheme}getParentWithTheme(t){for(;t.parent;)if((t=t.parent).theme)return t;return null}applyTheme(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.dirty){const n=this.getParentWithTheme(t);if(n){const t=n.theme;(t.dirty||i)&&t.applyTheme(n,e,!0)}this.userTheme?this.doCombine(n&&n.theme.combinedTheme):(n?this.combinedTheme=n.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,Vt.getInstance().warn("未知错误，走到不应该走的区域里")),this.dirty=!1)}return this.combinedTheme}doCombine(t){const e=this.userTheme,i=this.combinedTheme;Eo.forEach((n=>{const o=Object.create(Oo[n]);t&&t[n]&&Ho(o,t[n]),i[n]&&Ho(o,i[n]),e[n]&&Ho(o,e[n]),this.combinedTheme[n]=o})),e.common&&Eo.forEach((t=>{Ho(this.combinedTheme[t],e.common)})),this.dirty=!1}setTheme(t,e){let i=this.userTheme;i?Object.keys(t).forEach((e=>{i[e]?Object.assign(i[e],t[e]):i[e]=Object.assign({},t[e])})):i=t,this.userTheme=i,this.dirty=!0,this.dirtyChildren(e)}resetTheme(t,e){this.userTheme=t,this.dirty=!0,this.dirtyChildren(e)}dirtyChildren(t){t.forEachChildren((t=>{t.isContainer&&(t.theme&&(t.theme.dirty=!0),this.dirtyChildren(t))}))}}const Fo=new Io;function zo(t,e){return t.glyphHost?zo(t.glyphHost):e?(t.isContainer,e):function(t){let e;if(e=t.isContainer?t:t.parent,e){for(;e&&!e.theme;)e=e.parent;return e?(e.theme||e.createTheme(),e.theme.getTheme(e)):Fo.getTheme()}return null}(t)||t.attachedThemeGraphic&&zo(t.attachedThemeGraphic)||Fo.getTheme()}var Do=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))};class Wo extends et{get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=a.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){let e=this._lastChild,i=0;for(;e;){if(t(e,i++))return;e=e._prev}}else{let e=this._firstChild,i=0;for(;e;){if(t(e,i++))return;e=e._next}}}forEachChildrenAsync(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Do(this,void 0,void 0,(function*(){if(e){let e=this._lastChild,i=0;for(;e;){let n=t(e,i++);if(n.then&&(n=yield n),n)return;e=e._prev}}else{let e=this._firstChild,i=0;for(;e;){let n=t(e,i++);if(n.then&&(n=yield n),n)return;e=e._next}}}))}forEach(t){return this.forEachChildren(t)}appendChild(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._uid===t._uid)return null;if(!e&&t.isAncestorsOf(this))throw new Error("【Node::appendChild】不能将父辈元素append为子元素");return t.parent&&t.parent.removeChild(t),t.parent=this,this._lastChild?(this._lastChild._next=t,t._prev=this._lastChild,this._lastChild=t):(this._firstChild=this._lastChild=t,t._prev=t._next=null),this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this.setCount(t.count),this._structEdit=!0,t}appendChildArrHighPerformance(t){return t}insertBefore(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,t._prev=e._prev,e._prev?e._prev._next=t:this._firstChild=t,e._prev=t,t._next=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertAfter(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertAfter】不能将父辈元素insert为子元素");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,e._next?(e._next._prev=t,t._next=e._next):this._lastChild=t,e._next=t,t._prev=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertInto(t,e){if(!this._ignoreWarn&&this._nodeList&&Vt.getInstance().warn("insertIntoKeepIdx和insertInto混用可能会存在错误"),e>=this.childrenCount)return this.appendChild(t);if(this===t)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");if(t.parent&&t.parent.removeChild(t),t.parent=this,0===e)t._next=this._firstChild,this._firstChild&&(this._firstChild._prev=t),t._prev=null,this._firstChild=t;else{let i=this._firstChild;for(let t=0;t<e;t++){if(!i)return null;t>0&&(i=i._next)}if(!i)return null;t._next=i._next,t._prev=i,i._next=t,t._next&&(t._next._prev=t)}return this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t}insertIntoKeepIdx(t,e){if(this._nodeList||(this._nodeList=this.children),this._nodeList[e]){const i=this._nodeList[e];return this._nodeList.splice(e,0,t),this.insertBefore(t,i)}let i;this._nodeList[e]=t;for(let t=e-1;t>=0&&(i=this._nodeList[t],!i);t--);if(i)return i._next?this.insertBefore(t,i._next):this.appendChild(t);this._ignoreWarn=!0;const n=this.insertInto(t,0);return this._ignoreWarn=!1,n}removeChild(t){if(!this._idMap)return null;if(!this._idMap.has(t._uid))return null;if(this._idMap.delete(t._uid),this._nodeList){const e=this._nodeList.findIndex((e=>e===t));e>=0&&this._nodeList.splice(e,1)}return t._prev?t._prev._next=t._next:this._firstChild=t._next,t._next?t._next._prev=t._prev:this._lastChild=t._prev,t.parent=null,t._prev=null,t._next=null,this._structEdit=!0,this.setCount(-t.count),t}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(t){if(!this._idMap)return;this._nodeList&&(this._nodeList.length=0);let e=this._firstChild;for(;e;){const t=e._next;e.parent=null,e._prev=null,e._next=null,e=e._next,e=t}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(t,e){throw new Error("暂不支持")}find(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null;return this.forEachChildren(((e,n)=>!(e===this||!t(e,n)||(i=e,0)))),e&&this.forEachChildren((e=>{if(e.isContainer){const n=e.find(t,!0);if(n)return i=n,!0}return!1})),i}findAll(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[];return this.forEachChildren(((e,n)=>{e!==this&&t(e,n)&&i.push(e)})),e&&this.forEachChildren((e=>{if(e.isContainer){const n=e.findAll(t,!0);n.length&&(i=i.concat(n))}})),i}getElementById(t){return this.find((e=>e.id===t),!0)}findChildById(t){return this.getElementById(t)}findChildByUid(t){return this._idMap&&this._idMap.get(t)||null}getElementsByName(t){return this.findAll((e=>e.name===t),!0)}findChildrenByName(t){return this.getElementsByName(t)}getElementsByType(t){return this.findAll((e=>e.type===t),!0)}getChildByName(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.find((e=>e.name===t),e)}getChildAt(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<t;i++){if(!e._next)return null;e=e._next}return e}at(t){return this.getChildAt(t)}containNode(t){if(!this._idMap)return!1;if(this._idMap.has(t._uid))return!0;let e=this._firstChild;for(;e;){if(e.containNode(t))return!0;e=e._next}return!1}getRootNode(){let t=this.parent;for(;null==t?void 0:t.parent;)t=t.parent;return t||this}hasChildNodes(){return null!==this._firstChild}addChild(t){return this.appendChild(t)}add(t){return this.appendChild(t)}getChildren(){const t=[];let e=this._firstChild;for(;e;)t.push(e),e=e._next;return t}isChildOf(t){return!!this.parent&&this.parent._uid===t._uid}isParentOf(t){return t.isChildOf(this)}isDescendantsOf(t){let e=this.parent;if(!e)return!1;do{if(e._uid===t._uid)return!0;e=e.parent}while(null!==e);return!1}isAncestorsOf(t){return t.isDescendantsOf(this)}getAncestor(t){throw new Error("暂不支持")}setAllDescendantsProps(t,e){let i=this._firstChild;for(;i;)i[t]=e,i.setAllDescendantsProps(t,e),i=i._next}setCount(t){this._count+=t;let e=this.parent;if(e)do{e._count+=t,e=e.parent}while(null!==e)}clone(){throw new Error("暂不支持")}cloneTo(t){throw new Error("暂不支持")}getParent(){return this.parent}del(t){return this.removeChild(t)}addEventListener(t,e,i){const n=nt(i,!0)&&i||at(i)&&i.capture,o=at(i)&&i.once,r=ot(e)?void 0:e;return t=n?`${t}capture`:t,e=ot(e)?e:e.handleEvent,o?super.once(t,e,r):super.on(t,e,r),this}on(t,e,i){return this.addEventListener(t,e,i)}removeEventListener(t,e,i){const n=nt(i,!0)&&i||at(i)&&i.capture,o=ot(e)?void 0:e;t=n?`${t}capture`:t,e=ot(e)?e:e.handleEvent;const r=at(i)&&i.once;return super.off(t,e,o,r),this}off(t,e,i){return this.removeEventListener(t,e,i)}once(t,e,i){return at(i)?(i.once=!0,this.addEventListener(t,e,i)):this.addEventListener(t,e,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return super.emit(t.type,t,...i),!t.defaultPrevented}emit(t,e){return this.dispatchEvent(t,e)}release(){this.removeAllListeners()}}class No{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=No.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.composedDetailPath(),this.path}composedDetailPath(){return this.pickParams&&this.pickParams.graphic?(this.detailPath=this.path.slice(),this._composedDetailPath(this.pickParams)):this.detailPath=this.path.slice(),this.detailPath}_composedDetailPath(t){if(t&&t.graphic){const e=t.graphic;if(e.stage){const i=e.stage.eventSystem.manager.propagationPath(e);this.detailPath.push(i),this._composedDetailPath(t.params)}}}preventDefault(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault()}catch(t){this.nativeEvent.preventDefault&&ot(this.nativeEvent.preventDefault)&&this.nativeEvent.preventDefault()}this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation()}catch(t){this.nativeEvent.stopPropagation&&ot(this.nativeEvent.stopPropagation)&&this.nativeEvent.stopPropagation()}this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw new Error("Method not implemented.")}}class Go extends No{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p){throw new Error("Method not implemented.")}}class jo extends Go{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}clone(){var t,e,i;const n=new jo(this.manager);n.eventPhase=n.NONE,n.currentTarget=null,n.path=[],n.detailPath=[],n.target=null,n.nativeEvent=this.nativeEvent,n.originalEvent=this.originalEvent,null===(t=this.manager)||void 0===t||t.copyPointerData(this,n),null===(e=this.manager)||void 0===e||e.copyMouseData(this,n),null===(i=this.manager)||void 0===i||i.copyData(this,n),n.target=this.target,n.path=this.composedPath().slice();const o=this.composedDetailPath();return n.detailPath=o&&o.slice(),n.type=this.type,n}}class Vo extends Go{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var t,e,i;const n=new Vo(this.manager);n.eventPhase=n.NONE,n.currentTarget=null,n.path=[],n.detailPath=[],n.target=null,n.nativeEvent=this.nativeEvent,n.originalEvent=this.originalEvent,null===(t=this.manager)||void 0===t||t.copyWheelData(this,n),null===(e=this.manager)||void 0===e||e.copyMouseData(this,n),null===(i=this.manager)||void 0===i||i.copyData(this,n),n.target=this.target,n.path=this.composedPath().slice();const o=this.composedDetailPath();return n.detailPath=o&&o.slice(),n.type=this.type,n}}Vo.DOM_DELTA_PIXEL=0,Vo.DOM_DELTA_LINE=1,Vo.DOM_DELTA_PAGE=2;class Uo extends No{constructor(t,e){super(),this.type=t,this.detail=e}}const Xo="object"==typeof performance&&performance.now?performance:Date;function $o(t){return"mouse"===t||"pen"===t}const Yo={dispatchEvent(t){var e;if(!(t instanceof No))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=[],t.detailPath&&(t.detailPath=[]),t.target=this,null===(e=null==t?void 0:t.manager)||void 0===e||e.dispatchEvent(t),!t.defaultPrevented},emit(t,e){return this.dispatchEvent(new Uo(t,e))}},Ko={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class qo{constructor(t){this.resolution=1,this.onPointerDown=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,i=e.length;t<i;t++){const i=e[t],n=this.bootstrapEvent(this.rootPointerEvent,i);this.manager.mapEvent(n)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerMove=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;if(this.isEventOutsideOfTargetElement(t))return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.manager.mapEvent(i)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerUp=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.isEventOutsideOfTargetViewPort(t)?"outside":"",i=this.normalizeToPointerData(t);for(let t=0,n=i.length;t<n;t++){const n=this.bootstrapEvent(this.rootPointerEvent,i[t]);n.type+=e,this.manager.mapEvent(n)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerOverOut=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.manager.mapEvent(i)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onWheel=t=>{const e=this.normalizeWheelEvent(t);this.manager.mapEvent(e)};const{targetElement:e,resolution:i,rootNode:n,global:o,autoPreventDefault:r=!1,clickInterval:s,supportsTouchEvents:a=o.supportsTouchEvents,supportsPointerEvents:l=o.supportsPointerEvents}=t;this.manager=new class{constructor(t,e){this.dispatch=new et,this.cursorTarget=null,this.pauseNotify=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(t,e)=>{if(!(t instanceof jo))return void Vt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const i=this.createPointerEvent(t,t.type,e);if(this.dispatchEvent(i,"pointerdown"),"touch"===i.pointerType)this.dispatchEvent(i,"touchstart");else if($o(i.pointerType)){const t=2===i.button;this.dispatchEvent(i,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=i.composedPath(),this.freeEvent(i)},this.onPointerMove=(t,e)=>{var i,n;if(!(t instanceof jo))return void Vt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.createPointerEvent(t,t.type,e),r=$o(o.pointerType),s=this.trackingData(t.pointerId),a=this.findMountedTarget(s.overTargets);if(s.overTargets&&a&&a!==this.rootTarget&&a!==o.target){const e="mousemove"===t.type?"mouseout":"pointerout",i=this.createPointerEvent(t,e,a||void 0);if(this.dispatchEvent(i,"pointerout"),r&&this.dispatchEvent(i,"mouseout"),!o.composedPath().includes(a)){const e=this.createPointerEvent(t,"pointerleave",a||void 0);for(e.eventPhase=e.AT_TARGET;e.target&&!o.composedPath().includes(e.target);)e.currentTarget=e.target,this.notifyTarget(e),r&&this.notifyTarget(e,"mouseleave"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(i)}if(a!==o.target){const e="mousemove"===t.type?"mouseover":"pointerover",i=this.clonePointerEvent(o,e);this.dispatchEvent(i,"pointerover"),r&&this.dispatchEvent(i,"mouseover");let n=null==a?void 0:a.parent;for(;n&&n!==this.rootTarget.parent&&n!==o.target;)n=n.parent;if(!n||n===this.rootTarget.parent){const t=this.clonePointerEvent(o,"pointerenter");t.eventPhase=t.AT_TARGET;let e=t.target;const i=new Set;let n=a;for(;n&&n!==this.rootTarget;)i.add(n),n=n.parent;for(;e&&e!==a&&e!==this.rootTarget.parent;)i.has(e)||(t.currentTarget=e,this.notifyTarget(t),r&&this.notifyTarget(t,"mouseenter")),e=e.parent;this.freeEvent(t)}this.freeEvent(i)}this.dispatchEvent(o,"pointermove"),"touch"===o.pointerType&&this.dispatchEvent(o,"touchmove"),r&&(this.dispatchEvent(o,"mousemove"),this.cursorTarget=o.target,this.cursor=(null===(n=null===(i=o.target)||void 0===i?void 0:i.attribute)||void 0===n?void 0:n.cursor)||this.rootTarget.getCursor()),s.overTargets=o.composedPath(),this.freeEvent(o)},this.onPointerOver=(t,e)=>{var i,n;if(!(t instanceof jo))return void Vt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.trackingData(t.pointerId),r=this.createPointerEvent(t,t.type,e),s=$o(r.pointerType);this.dispatchEvent(r,"pointerover"),s&&this.dispatchEvent(r,"mouseover"),"mouse"===r.pointerType&&(this.cursorTarget=r.target,this.cursor=(null===(n=null===(i=r.target)||void 0===i?void 0:i.attribute)||void 0===n?void 0:n.cursor)||this.rootTarget.getCursor());const a=this.clonePointerEvent(r,"pointerenter");for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),s&&this.notifyTarget(a,"mouseenter"),a.target=a.target.parent;o.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(a)},this.onPointerOut=(t,e)=>{if(!(t instanceof jo))return void Vt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const i=this.trackingData(t.pointerId);if(i.overTargets){const e=$o(t.pointerType),n=this.findMountedTarget(i.overTargets),o=this.createPointerEvent(t,"pointerout",n||void 0);this.dispatchEvent(o),e&&this.dispatchEvent(o,"mouseout");const r=this.createPointerEvent(t,"pointerleave",n||void 0);for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),e&&this.notifyTarget(r,"mouseleave"),r.target=r.target.parent;i.overTargets=[],this.freeEvent(o),this.freeEvent(r)}this.cursorTarget=null,this.cursor=""},this.onPointerUp=(t,e)=>{var i;if(!(t instanceof jo))return void Vt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const n=Xo.now(),o=this.createPointerEvent(t,t.type,e);if(this.dispatchEvent(o,"pointerup"),"touch"===o.pointerType)this.dispatchEvent(o,"touchend");else if($o(o.pointerType)){const t=2===o.button;this.dispatchEvent(o,t?"rightup":"mouseup")}const r=this.trackingData(t.pointerId),s=this.findMountedTarget(r.pressTargetsByButton[t.button]);let a=s;if(s&&!o.composedPath().includes(s)){let e=s;for(;e&&!o.composedPath().includes(e);){if(o.currentTarget=e,this.notifyTarget(o,"pointerupoutside"),"touch"===o.pointerType)this.notifyTarget(o,"touchendoutside");else if($o(o.pointerType)){const t=2===o.button;this.notifyTarget(o,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete r.pressTargetsByButton[t.button],a=e}if(a){const e=this.clonePointerEvent(o,"click");e.target=a,e.path=[],e.detailPath=[],r.clicksByButton[t.button]||(r.clicksByButton[t.button]={clickCount:0,target:e.target,timeStamp:n});const s=r.clicksByButton[t.button];s.target===e.target&&n-s.timeStamp<(null!==(i=this._config.clickInterval)&&void 0!==i?i:200)?++s.clickCount:s.clickCount=1,s.target=e.target,s.timeStamp=n,e.detail=s.clickCount,$o(e.pointerType)?(this.dispatchEvent(e,"click"),2===s.clickCount&&this.dispatchEvent(e,"dblclick")):"touch"===e.pointerType&&this._config.supportsTouchEvents&&(this.dispatchEvent(e,"tap"),2===s.clickCount&&this.dispatchEvent(e,"dbltap")),this.dispatchEvent(e,"pointertap"),this.freeEvent(e)}this.freeEvent(o)},this.onPointerUpOutside=(t,e)=>{if(!(t instanceof jo))return void Vt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const i=this.trackingData(t.pointerId),n=this.findMountedTarget(i.pressTargetsByButton[t.button]),o=this.createPointerEvent(t,t.type,e);if(n){let e=n;for(;e;)o.currentTarget=e,this.notifyTarget(o,"pointerupoutside"),"touch"===o.pointerType?this.notifyTarget(o,"touchendoutside"):$o(o.pointerType)&&this.notifyTarget(o,2===o.button?"rightupoutside":"mouseupoutside"),e=e.parent;delete i.pressTargetsByButton[t.button]}this.freeEvent(o)},this.onWheel=(t,e)=>{if(!(t instanceof Vo))return void Vt.getInstance().warn("EventManager cannot map a non-wheel event as a wheel event");const i=this.createWheelEvent(t,e);this.dispatchEvent(i),this.freeEvent(i)},this.rootTarget=t,this.mappingTable={},this._config=Object.assign({clickInterval:200},e),this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){var e,i,n,o,r,s,a;if(!this.rootTarget)return;const l=this.mappingTable[t.type];let h;const d=`${t.canvasX}-${t.canvasY}`;if((null===(e=this._prePointTargetCache)||void 0===e?void 0:e[d])&&(null===(n=null===(i=this._prePointTargetCache)||void 0===i?void 0:i[d])||void 0===n?void 0:n.stage)&&(null===(r=null===(o=this._prePointTargetCache)||void 0===o?void 0:o[d])||void 0===r?void 0:r.stage.renderCount)===(null===(s=this._prePointTargetCache)||void 0===s?void 0:s.stageRenderCount)?h=this._prePointTargetCache[d]:(h=this.pickTarget(t.viewX,t.viewY,t),t.pickParams||(this._prePointTargetCache={[d]:h,stageRenderCount:null!==(a=null==h?void 0:h.stage.renderCount)&&void 0!==a?a:-1})),l)for(let e=0,i=l.length;e<i;e++)l[e].fn(t,h);else Vt.getInstance().warn(`[EventManager]: Event mapping not defined for ${t.type}`)}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,o=i.length-1;n<o;n++)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}notifyTarget(t,e){if(this.pauseNotify)return;e=null!=e?e:t.type;const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){var n,o;const r=this.allocateEvent(jo);return this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=i||this.pickTarget(null!==(n=r.viewX)&&void 0!==n?n:r.global.x,null!==(o=r.viewY)&&void 0!==o?o:r.global.y,r),"string"==typeof e&&(r.type=e),r}createWheelEvent(t,e){var i,n;const o=this.allocateEvent(Vo);return this.copyWheelData(t,o),this.copyMouseData(t,o),this.copyData(t,o),o.nativeEvent=t.nativeEvent,o.originalEvent=t,o.target=e||this.pickTarget(null!==(i=o.viewX)&&void 0!==i?i:o.global.x,null!==(n=o.viewY)&&void 0!==n?n:o.global.y,o),o}clonePointerEvent(t,e){const i=this.allocateEvent(jo);i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice();const n=t.composedDetailPath();return i.detailPath=n&&n.slice(),i.type=null!=e?e:i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof jo&&e instanceof jo&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Go&&e instanceof Go&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.metaKey=t.metaKey,["client","movement","canvas","screen","global","offset","viewport"].forEach((i=>{e[i].x=t[i].x,e[i].y=t[i].y})))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=Xo.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.x=t.layer.x,e.layer.y=t.layer.y,e.page.x=t.page.x,e.page.y=t.page.y,e.pickParams=t.pickParams}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){var e;this.eventPool.has(t)||this.eventPool.set(t,[]);const i=(null===(e=this.eventPool.get(t))||void 0===e?void 0:e.pop())||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=[],i.detailPath=[],i.target=null,i}freeEvent(t){var e;if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventManager!");const i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),null===(e=this.eventPool.get(i))||void 0===e||e.push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.once&&t.currentTarget.removeEventListener(e,i.fn,{once:!0}),i.fn.call(i.context,t);else for(let n=0,o=i.length;n<o&&!t.propagationImmediatelyStopped;n++)i[n].once&&t.currentTarget.removeEventListener(e,i[n].fn,{once:!0}),i[n].fn.call(i[n].context,t);this.emitDelegation(t,e)}emitDelegation(t,e){const i=t.currentTarget._events["*"];if(i)if("fn"in i)i.fn.call(i.context,t,e);else for(let n=0,o=i.length;n<o&&!t.propagationImmediatelyStopped;n++)i[n].fn.call(i[n].context,t,e)}pickTarget(t,e,i){let n;const o=this.rootTarget.pick(t,e);return n=o&&o.graphic?o.graphic:o&&o.group?o.group:this.rootTarget.AABBBounds.contains(t,e)?this.rootTarget:null,i&&(i.pickParams=o.params),n}release(){this.dispatch.removeAllListeners(),this.eventPool.clear(),this.rootTarget=null,this.mappingTable=null,this.mappingState=null,this.cursorTarget=null}}(n,{clickInterval:s,supportsTouchEvents:a}),this.globalObj=o,this.supportsPointerEvents=l,this.supportsTouchEvents=a,this.supportsMouseEvents=o.supportsMouseEvents,this.applyStyles=o.applyStyles,this.autoPreventDefault=r,this.eventsAdded=!1,this.rootPointerEvent=new jo,this.rootWheelEvent=new Vo,this.cursorStyles={default:"inherit",pointer:"pointer"},this.resolution=i,this.setTargetElement(e)}release(){this.removeEvents(),this.manager&&this.manager.release(),this.domElement=null,this.manager=null,this.globalObj=null}setCursor(t,e){if(!e&&!this.manager.rootTarget.window._handler.canvas.controled)return;t||(t="default");const{applyStyles:i,domElement:n}=this;if(this.currentCursor===t)return;this.currentCursor=t;const o=this.cursorStyles[t];o?"string"==typeof o&&i?n.style.cursor=o:"function"==typeof o?o(t):"object"==typeof o&&i&&Object.assign(n.style,o):i&&ct(t)&&!Bt(this.cursorStyles,t)&&(n.style.cursor=t)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.addEventListener("pointermove",this.onPointerMove,!0),t.addEventListener("pointerup",this.onPointerUp,!0)):(e.addEventListener("pointermove",this.onPointerMove,!0),e.addEventListener("pointerup",this.onPointerUp,!0)),e.addEventListener("pointerdown",this.onPointerDown,!0),e.addEventListener("pointerleave",this.onPointerOverOut,!0),e.addEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.addEventListener("mousemove",this.onPointerMove,!0),t.addEventListener("mouseup",this.onPointerUp,!0)):(e.addEventListener("mousemove",this.onPointerMove,!0),e.addEventListener("mouseup",this.onPointerUp,!0)),e.addEventListener("mousedown",this.onPointerDown,!0),e.addEventListener("mouseout",this.onPointerOverOut,!0),e.addEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.addEventListener("touchstart",this.onPointerDown,!0),e.addEventListener("touchend",this.onPointerUp,!0),e.addEventListener("touchmove",this.onPointerMove,!0)),e.addEventListener("wheel",this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.removeEventListener("pointermove",this.onPointerMove,!0),t.removeEventListener("pointerup",this.onPointerUp,!0)):(e.removeEventListener("pointermove",this.onPointerMove,!0),e.removeEventListener("pointerup",this.onPointerUp,!0)),e.removeEventListener("pointerdown",this.onPointerDown,!0),e.removeEventListener("pointerleave",this.onPointerOverOut,!0),e.removeEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.removeEventListener("mousemove",this.onPointerMove,!0),t.removeEventListener("mouseup",this.onPointerUp,!0)):(e.removeEventListener("mousemove",this.onPointerMove,!0),e.removeEventListener("mouseup",this.onPointerUp,!0)),e.removeEventListener("mousedown",this.onPointerDown,!0),e.removeEventListener("mouseout",this.onPointerOverOut,!0),e.removeEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.removeEventListener("touchstart",this.onPointerDown,!0),e.removeEventListener("touchend",this.onPointerUp,!0),e.removeEventListener("touchmove",this.onPointerMove,!0)),e.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(t){return this.domElement.pointTransform?this.domElement.pointTransform(t.x,t.y):t}mapToCanvasPoint(t){var e,i;const n=null===(e=this.globalObj)||void 0===e?void 0:e.mapToCanvasPoint(t,this.domElement);if(n)return n;let o=0,r=0;if(t.changedTouches){const e=null!==(i=t.changedTouches[0])&&void 0!==i?i:{};o=e.clientX||0,r=e.clientY||0}else o=t.clientX||0,r=t.clientY||0;const s=this.domElement.getBoundingClientRect();return{x:o-s.left,y:r-s.top}}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t.changedTouches&&t.changedTouches.length)for(let i=0,n=t.changedTouches.length;i<n;i++){const n=t.changedTouches[i];dt(n.button)&&(n.button=0),dt(n.buttons)&&(n.buttons=1),dt(n.isPrimary)&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),dt(n.width)&&(n.width=n.radiusX||1),dt(n.height)&&(n.height=n.radiusY||1),dt(n.tiltX)&&(n.tiltX=0),dt(n.tiltY)&&(n.tiltY=0),dt(n.pointerType)&&(n.pointerType="touch"),dt(n.pointerId)&&(n.pointerId=n.identifier||0),dt(n.pressure)&&(n.pressure=n.force||.5),dt(n.twist)&&(n.twist=0),dt(n.tangentialPressure)&&(n.tangentialPressure=0),dt(n.layerX)&&(n.layerX=n.offsetX=n.clientX),dt(n.layerY)&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(!this.globalObj.supportsMouseEvents||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof PointerEvent)){const i=t;dt(i.isPrimary)&&(i.isPrimary=!0),dt(i.width)&&(i.width=1),dt(i.height)&&(i.height=1),dt(i.tiltX)&&(i.tiltX=0),dt(i.tiltY)&&(i.tiltY=0),dt(i.pointerType)&&(i.pointerType="mouse"),dt(i.pointerId)&&(i.pointerId=1),dt(i.pressure)&&(i.pressure=.5),dt(i.twist)&&(i.twist=0),dt(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;const{x:i,y:n}=this.mapToCanvasPoint(t);e.canvas.x=i,e.canvas.y=n,e.global.x=i,e.global.y=n,e.offset.x=i,e.offset.y=n;const{x:o,y:r}=this.mapToViewportPoint(e);return e.viewport.x=o,e.viewport.y=r,e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);const{x:i,y:n}=this.mapToCanvasPoint(e);t.canvas.x=i,t.canvas.y=n,t.global.x=i,t.global.y=n,t.offset.x=i,t.offset.y=n;const{x:o,y:r}=this.mapToViewportPoint(t);return t.viewport.x=o,t.viewport.y=r,t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Ko[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=Xo.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null}isEventOutsideOfTargetViewPort(t){if(this.isEventOutsideOfTargetElement(t))return!0;if(this.domElement.getViewBox){const e=this.mapToViewportPoint(this.mapToCanvasPoint(t)),i=this.domElement.getViewBox(),n=i.width(),o=i.height();return!(e.x<n&&e.y<o&&e.x>0&&e.y>0)}return!1}isEventOutsideOfTargetElement(t){let e=t.target;return t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]),e!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}pauseTriggerEvent(){this.manager.pauseNotify=!0}resumeTriggerEvent(){this.manager.pauseNotify=!1}}var Zo;!function(t){t[t.INITIAL=0]="INITIAL",t[t.RUNNING=1]="RUNNING",t[t.PAUSE=2]="PAUSE"}(Zo||(Zo={}));class Jo{static Avaliable(){return!!$n.global.getRequestAnimationFrame()}avaliable(){return Jo.Avaliable()}tick(t,e){$n.global.getRequestAnimationFrame()((()=>{this.released||e(this)}))}release(){this.released=!0}getTime(){return Date.now()}}class Qo{static Avaliable(){return!0}avaliable(){return Qo.Avaliable()}tick(t,e){this.timerId=setTimeout((()=>{e(this)}),t)}release(){this.timerId>0&&(clearTimeout(this.timerId),this.timerId=-1)}getTime(){return Date.now()}}class tr extends et{set mode(t){this._mode!==t&&(this._mode=t,this.setupTickHandler())}get mode(){return this._mode}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.handleTick=(t,e)=>{const{once:i=!1}=null!=e?e:{};this.ifCanStop()?this.stop():(this._handlerTick(),i||t.tick(this.interval,this.handleTick))},this._handlerTick=()=>{const t=this.tickerHandler.getTime();let e=0;this.lastFrameTime>=0&&(e=t-this.lastFrameTime),this.lastFrameTime=t,this.status===Zo.RUNNING&&(this.tickCounts++,this.timelines.forEach((t=>{t.tick(e)})),this.emit("tick"))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.timelines=t,this.autoStop=!0}init(){this.interval=NaN,this.status=Zo.INITIAL,$n.global.hooks.onSetEnv.tap("default-ticker",(()=>{this.initHandler()})),$n.global.env&&this.initHandler()}addTimeline(t){this.timelines.push(t)}remTimeline(t){this.timelines=this.timelines.filter((e=>e!==t))}getTimelines(){return this.timelines}initHandler(){if(this._mode)return null;const t=[{mode:"raf",cons:Jo},{mode:"timeout",cons:Qo}];for(let e=0;e<t.length;e++)if(t[e].cons.Avaliable()){this.mode=t[e].mode;break}return null}setupTickHandler(){let t;switch(this._mode){case"raf":t=new Jo;break;case"timeout":t=new Qo;break;default:Vt.getInstance().warn("非法的计时器模式"),t=new Jo}return!!t.avaliable()&&(this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=t,!0)}setInterval(t){this.interval=t}getInterval(){return this.interval}setFPS(t){this.setInterval(1e3/t)}getFPS(){return 1e3/this.interval}tick(t){this.tickerHandler.tick(t,(t=>{this.handleTick(t,{once:!0})}))}tickTo(t){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(t,(t=>{this.handleTick(t,{once:!0})}))}pause(){return this.status!==Zo.INITIAL&&(this.status=Zo.PAUSE,!0)}resume(){return this.status!==Zo.INITIAL&&(this.status=Zo.RUNNING,!0)}ifCanStop(){if(this.autoStop){if(!this.timelines.length)return!0;if(0===this.timelines.reduce(((t,e)=>t+e.animateCount),0))return!0}return!1}start(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.status===Zo.RUNNING)return!1;if(!this.tickerHandler)return!1;if(!t){if(this.status===Zo.PAUSE)return!1;if(!this.timelines.length)return!1;if(0===this.timelines.reduce(((t,e)=>t+e.animateCount),0))return!1}return this.status=Zo.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0}stop(){this.status=Zo.INITIAL,this.setupTickHandler(),this.lastFrameTime=-1}release(){this.stop(),this.timelines=[],this.tickerHandler.release(),this.emit("afterTick")}trySyncTickStatus(){this.status===Zo.RUNNING&&this._handlerTick()}}class er{constructor(){}static linear(t){return t}static none(){return this.linear}static get(t){return t<-1?t=-1:t>1&&(t=1),function(e){return 0===t?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}}static getPowIn(t){return function(e){return Math.pow(e,t)}}static getPowOut(t){return function(e){return 1-Math.pow(1-e,t)}}static getPowInOut(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}static getBackIn(t){return function(e){return e*e*((t+1)*e-t)}}static getBackOut(t){return function(e){return--e*e*((t+1)*e+t)+1}}static getBackInOut(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}static sineIn(t){return 1-Math.cos(t*Math.PI/2)}static sineOut(t){return Math.sin(t*Math.PI/2)}static sineInOut(t){return-(Math.cos(Math.PI*t)-1)/2}static expoIn(t){return 0===t?0:Math.pow(2,10*t-10)}static expoOut(t){return 1===t?1:1-Math.pow(2,-10*t)}static expoInOut(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}static circIn(t){return-(Math.sqrt(1-t*t)-1)}static circOut(t){return Math.sqrt(1- --t*t)}static circInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static bounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static bounceIn(t){return 1-er.bounceOut(1-t)}static bounceInOut(t){return t<.5?.5*er.bounceIn(2*t):.5*er.bounceOut(2*t-1)+.5}static getElasticIn(t,e){return function(i){if(0===i||1===i)return i;const n=e/oe*Math.asin(1/t);return-t*Math.pow(2,10*(i-=1))*Math.sin((i-n)*oe/e)}}static getElasticOut(t,e){return function(i){if(0===i||1===i)return i;const n=e/oe*Math.asin(1/t);return t*Math.pow(2,-10*i)*Math.sin((i-n)*oe/e)+1}}static getElasticInOut(t,e){return function(i){const n=e/oe*Math.asin(1/t);return(i*=2)<1?t*Math.pow(2,10*(i-=1))*Math.sin((i-n)*oe/e)*-.5:t*Math.pow(2,-10*(i-=1))*Math.sin((i-n)*oe/e)*.5+1}}static registerFunc(t,e){er[t]=e}}function ir(t,e){const i=1/e;let n=1;for(;t>i;)t-=i,n*=-1;const o=n*t/i;return o>0?o:1+o}er.quadIn=er.getPowIn(2),er.quadOut=er.getPowOut(2),er.quadInOut=er.getPowInOut(2),er.cubicIn=er.getPowIn(3),er.cubicOut=er.getPowOut(3),er.cubicInOut=er.getPowInOut(3),er.quartIn=er.getPowIn(4),er.quartOut=er.getPowOut(4),er.quartInOut=er.getPowInOut(4),er.quintIn=er.getPowIn(5),er.quintOut=er.getPowOut(5),er.quintInOut=er.getPowInOut(5),er.backIn=er.getBackIn(1.7),er.backOut=er.getBackOut(1.7),er.backInOut=er.getBackInOut(1.7),er.elasticIn=er.getElasticIn(1,.3),er.elasticOut=er.getElasticOut(1,.3),er.elasticInOut=er.getElasticInOut(1,.3*1.5),er.easeInOutQuad=t=>(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2),er.easeOutElastic=t=>{const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1},er.easeInOutElastic=t=>{const e=2*Math.PI/4.5;return 0===t?0:1===t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*e)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*e)/2+1};for(let t=0;t<10;t++)er[`flicker${t}`]=e=>ir(e,t);for(let t=2;t<10;t++)er[`aIn${t}`]=e=>t*e*e+(1-t)*e;class nr{constructor(){this.id=a.GenAutoIncrementId(),this.animateHead=null,this.animateTail=null,this.animateCount=0,this.paused=!1}addAnimate(t){this.animateTail?(this.animateTail.nextAnimate=t,t.prevAnimate=this.animateTail,this.animateTail=t,t.nextAnimate=null):(this.animateHead=t,this.animateTail=t),this.animateCount++}pause(){this.paused=!0}resume(){this.paused=!1}tick(t){if(this.paused)return;let e=this.animateHead;for(this.animateCount=0;e;)e.status===Si.END?this.removeAnimate(e):e.status===Si.RUNNING||e.status===Si.INITIAL?(this.animateCount++,e.advance(t)):e.status===Si.PAUSED&&this.animateCount++,e=e.nextAnimate}clear(){let t=this.animateHead;for(;t;)t.release(),t=t.nextAnimate;this.animateHead=null,this.animateTail=null,this.animateCount=0}removeAnimate(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t._onRemove&&t._onRemove.forEach((t=>t())),t===this.animateHead?(this.animateHead=t.nextAnimate,t===this.animateTail?this.animateTail=null:this.animateHead.prevAnimate=null):t===this.animateTail?(this.animateTail=t.prevAnimate,this.animateTail.nextAnimate=null):(t.prevAnimate.nextAnimate=t.nextAnimate,t.nextAnimate.prevAnimate=t.prevAnimate),e&&t.release()}}const or=new nr;class rr{constructor(t,e,i,n,o){this.from=t,this.to=e,this.duration=i,this.easing=n,this.params=o,this.updateCount=0}bind(t,e){this.target=t,this.subAnimate=e,this.onBind()}onBind(){}onFirstRun(){}onStart(){}onEnd(){}getEndProps(){return this.to}getFromProps(){return this.from}getMergedEndProps(){var t;const e=this.getEndProps();return e?this._endProps===e?this._mergedEndProps:(this._endProps=e,void(this._mergedEndProps=Object.assign({},null!==(t=this.step.prev.getLastProps())&&void 0!==t?t:{},e))):this.step.prev?this.step.prev.getLastProps():e}update(t,e,i){if(0===this.updateCount){this.onFirstRun();const t=this.step.getLastProps();Object.keys(t).forEach((e=>{this.subAnimate.animate.validAttr(e)&&(i[e]=t[e])}))}this.updateCount+=1,this.onUpdate(t,e,i),t&&this.onEnd()}}class sr extends rr{constructor(t){super(null,null,0,"linear"),this.cb=t}onUpdate(t,e,i){}onStart(){this.cb()}}class ar{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.GenAutoIncrementId(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:or,i=arguments.length>2?arguments[2]:void 0;this.id=t,this.timeline=e||or,this.status=Si.INITIAL,this.tailAnimate=new lr(this),this.subAnimates=[this.tailAnimate],this.timeScale=1,this.rawPosition=-1,this._startTime=0,this._duringTime=0,this.timeline.addAnimate(this),this.slience=i}setTimeline(t){t!==this.timeline&&(this.timeline.removeAnimate(this,!1),t.addAnimate(this))}getStartTime(){return this._startTime}getDuration(){return this.subAnimates.reduce(((t,e)=>t+e.totalDuration),0)}after(t){const e=t.getDuration();return this._startTime=e,this}afterAll(t){let e=-1/0;return t.forEach((t=>{e=le(t.getDuration(),e)})),this._startTime=e,this}parallel(t){return this._startTime=t.getStartTime(),this}static AddInterpolate(t,e){ar.interpolateMap.set(t,e)}play(t){if(this.tailAnimate.play(t),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return 1===this.subAnimates.length&&this.tailAnimate.totalDuration===t.duration&&this.trySetAttribute(t.getFromProps(),t.mode),this}trySetAttribute(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ar.mode;t&&e&Ai.SET_ATTR_IMMEDIATELY&&this.target.setAttributes&&this.target.setAttributes(t,!1,{type:_i.ANIMATE_PLAY})}runCb(t){const e=new sr((()=>{t(this,e.step.prev)}));return this.tailAnimate.play(e),this}customInterpolate(t,e,i,n,o,r){const s=ar.interpolateMap.get(t)||ar.interpolateMap.get("");return!!s&&s(t,e,i,n,o,r)}pause(){this.status===Si.RUNNING&&(this.status=Si.PAUSED)}resume(){this.status===Si.PAUSED&&(this.status=Si.RUNNING)}to(t,e,i,n){if(this.tailAnimate.to(t,e,i,n),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}from(t,e,i,n){if(this.tailAnimate.from(t,e,i,n),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}wait(t){if(this.tailAnimate.wait(t),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}startAt(t){if(this.tailAnimate.startAt(t),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}loop(t){if(this.tailAnimate.loop=t,this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}reversed(t){if(this.tailAnimate.reversed=t,this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}bounce(t){if(this.tailAnimate.bounce=t,this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}subAnimate(){const t=new lr(this,this.tailAnimate);return this.tailAnimate=t,this.subAnimates.push(t),t.bind(this.target),this}getStartProps(){return this.subAnimates[0].getStartProps()}getEndProps(){return this.tailAnimate.getEndProps()}depreventAttr(t){this._preventAttrs&&this._preventAttrs.delete(t)}preventAttr(t){this._preventAttrs||(this._preventAttrs=new Set),this._preventAttrs.add(t)}preventAttrs(t){t.forEach((t=>this.preventAttr(t)))}validAttr(t){return!this._preventAttrs||!this._preventAttrs.has(t)}bind(t){return this.target=t,this.target.onAnimateBind&&!this.slience&&this.target.onAnimateBind(this),this.subAnimates.forEach((e=>{e.bind(t)})),this}advance(t){if(this._duringTime<this._startTime){if(this._duringTime+t*this.timeScale<this._startTime)return void(this._duringTime+=t*this.timeScale);t=this._duringTime+t*this.timeScale-this._startTime,this._duringTime=this._startTime}this.status===Si.INITIAL&&(this.status=Si.RUNNING,this._onStart&&this._onStart.forEach((t=>t()))),this.setPosition(Math.max(this.rawPosition,0)+t*this.timeScale)&&this.status===Si.RUNNING&&(this.status=Si.END,this._onEnd&&this._onEnd.forEach((t=>t())))}setPosition(t){let e,i=0;const n=this.rawPosition,o=this.subAnimates.reduce(((t,e)=>t+e.totalDuration),0);t<0&&(t=0);const r=t>=o;if(r&&(t=o),t===n)return r;for(let n=0;n<this.subAnimates.length&&(e=this.subAnimates[n],!(i+e.totalDuration>=t));n++)i+=e.totalDuration,e=void 0;return this.rawPosition=t,e.setPosition(t-i),r}onStart(t){this._onStart||(this._onStart=[]),this._onStart.push(t)}onEnd(t){this._onEnd||(this._onEnd=[]),this._onEnd.push(t)}onRemove(t){this._onRemove||(this._onRemove=[]),this._onRemove.push(t)}onFrame(t){this._onFrame||(this._onFrame=[]),this._onFrame.push(t)}release(){this.status=Si.END}stop(t){t||this.target.onStop(),"start"===t?this.target.onStop(this.getStartProps()):"end"===t?this.target.onStop(this.getEndProps()):this.target.onStop(t),this.release()}}ar.mode=Ai.NORMAL,ar.interpolateMap=new Map;class lr{get totalDuration(){return this.calcAttr(),this._totalDuration+this._startAt}constructor(t,e){this.rawPosition=-1,this.position=0,this.loop=0,this.duration=0,this.animate=t,this.stepHead=new hr(0,0,e?Object.assign({},e.stepTail.props):{}),this.stepTail=this.stepHead,this.dirty=!0,this._startAt=0}calcAttr(){this.dirty&&(this._totalDuration=this.duration*(this.loop+1))}bind(t){return this.target=t,this}play(t){let e=t.duration;(null==e||e<0)&&(e=0);const i=t.easing,n="string"==typeof i?er[i]:i,o=this._addStep(e,null,n);return o.type=Bi.customAnimate,this._appendProps(t.getEndProps(),o,!1),this._appendCustomAnimate(t,o),this}to(t,e,i,n){(null==e||e<0)&&(e=0);const o="string"==typeof i?er[i]:i,r=this._addStep(e,null,o);return r.type=Bi.to,this._appendProps(t,r,!!n&&n.tempProps),r.propKeys||(r.propKeys=Object.keys(r.props)),n&&n.noPreventAttrs||this.target.animates&&this.target.animates.forEach((t=>{t.id!==this.animate.id&&t.preventAttrs(r.propKeys)})),this}from(t,e,i,n){this.to(t,0,i,n);const o={};this.stepTail.propKeys||(this.stepTail.propKeys=Object.keys(this.stepTail.props)),this.stepTail.propKeys.forEach((t=>{o[t]=this.getLastPropByName(t,this.stepTail)})),this.to(o,e,i,n),this.stepTail.type=Bi.from}startAt(t){return t<0&&(t=0),this._startAt=t,this}getStartProps(){var t;return null===(t=this.stepHead)||void 0===t?void 0:t.props}getEndProps(){return this.stepTail.props}getLastStep(){return this._lastStep}wait(t){if(t>0){const e=this._addStep(+t,null);e.type=Bi.wait,e.prev.customAnimate?e.props=e.prev.customAnimate.getEndProps():e.props=e.prev.props,this.target.onAddStep&&this.target.onAddStep(e)}return this}_addStep(t,e,i){const n=new hr(this.duration,t,e,i);return this.duration+=t,this.stepTail.append(n),this.stepTail=n,n}_appendProps(t,e,i){e.props=i?t:Object.assign({},t);let n=e.prev;const o=e.props;for(e.propKeys||(e.propKeys=Object.keys(e.props)),e.propKeys.forEach((t=>{void 0===e.props[t]&&(e.props[t]=this.target.getDefaultAttribute(t))}));n.prev;)n.props&&(n.propKeys||(n.propKeys=Object.keys(n.props)),n.propKeys.forEach((t=>{void 0===o[t]&&(o[t]=n.props[t])}))),e.propKeys=Object.keys(e.props),n=n.prev;const r=this.stepHead.props;e.propKeys||(e.propKeys=Object.keys(o)),e.propKeys.forEach((t=>{if(void 0===r[t]){const e=this.animate.getStartProps();r[t]=e[t]=this.target.getComputedAttribute(t)}})),this.target.onAddStep&&this.target.onAddStep(e)}_appendCustomAnimate(t,e){e.customAnimate=t,t.step=e,t.bind(this.target,this)}setPosition(t){var e;const i=this.duration,n=this.loop,o=this.rawPosition;let r,s,a=!1;const l=null!==(e=this._startAt)&&void 0!==e?e:0;if(t<0&&(t=0),t<l)return this.rawPosition=t,!1;if(t-=l,i<=0&&(a=!0,i<0))return a;if(r=Math.floor(t/i),s=t-r*i,a=t>=n*i+i,a&&(s=i,r=n,t=s*r+i),t===o)return a;const h=!this.reversed!=!(this.bounce&&r%2);return h&&(s=i-s),this._deltaPosition=s-this.position,this.position=s,this.rawPosition=t+l,this.updatePosition(a,h),a}updatePosition(t,e){if(!this.stepHead)return;let i=this.stepHead.next;const n=this.position,o=this.duration;if(this.target&&i){let r=i.next;for(;r&&r.position<=n;)i=r,r=i.next;let s=t?0===o?1:n/o:(n-i.position)/i.duration;i.easing&&(s=i.easing(s)),this.tryCallCustomAnimateLifeCycle(i,this._lastStep||(e?this.stepTail:this.stepHead),e),this.updateTarget(i,s,t),this._lastStep=i,this.animate._onFrame&&this.animate._onFrame.forEach((t=>t(i,s)))}}tryCallCustomAnimateLifeCycle(t,e,i){if(t!==e)if(i){let i=e.prev;for(;i&&i!==t;)i.customAnimate&&(i.customAnimate.onStart&&i.customAnimate.onStart(),i.customAnimate.onEnd&&i.customAnimate.onEnd()),i=t.prev;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}else{let i=e.next;for(;i&&i!==t;)i.customAnimate&&(i.customAnimate.onStart&&i.customAnimate.onStart(),i.customAnimate.onEnd&&i.customAnimate.onEnd()),i=i.next;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}}getLastPropByName(t,e){let i=e.prev;for(;i;){if(i.props&&void 0!==i.props[t])return i.props[t];if(i.customAnimate){const e=i.customAnimate.getEndProps()[t];if(void 0!==e)return e}i=i.prev}return Vt.getInstance().warn("未知错误，step中找不到属性"),e.props[t]}updateTarget(t,e,i){null==t.props&&null==t.customAnimate||this.target.onStep(this,this.animate,t,e,i)}}class hr{constructor(t,e,i,n){this.duration=e,this.position=t,this.props=i,this.easing=n}append(t){t.prev=this,t.next=this.next,this.next=t}getLastProps(){let t=this.prev;for(;t;){if(t.props)return t.props;if(t.customAnimate)return t.customAnimate.getMergedEndProps();t=t.prev}return null}}const dr=200,cr="cubicOut";var ur;!function(t){t[t.Top=1]="Top",t[t.Right=2]="Right",t[t.Bottom=4]="Bottom",t[t.Left=8]="Left",t[t.ALL=15]="ALL"}(ur||(ur={}));const gr=[!1,!1,!1,!1],pr=[0,0,0,0],fr=t=>t?ut(t)?0===t.length?0:1===t.length?t[0]:2===t.length?(pr[0]=t[0],pr[2]=t[0],pr[1]=t[1],pr[3]=t[1],pr):t:t:0,vr=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],br=[1,2,3,0,1,2,3,0];function mr(t,e,i,n){for(;t>=oe;)t-=oe;for(;t<0;)t+=oe;for(;t>e;)e+=oe;vr[0].x=i,vr[1].y=i,vr[2].x=-i,vr[3].y=-i;const o=Math.ceil(t/ie)%4,r=Math.ceil(e/ie)%4;if(n.add(ae(t)*i,de(t)*i),n.add(ae(e)*i,de(e)*i),o!==r||e-t>ee){let t=!1;for(let e=0;e<br.length;e++)if(t||o!==br[e]){if(t&&r===br[e])break;if(t){const t=vr[br[e]];n.add(t.x,t.y)}}else{t=!0;const e=vr[o];n.add(e.x,e.y)}}}function yr(t,e,i){const{x:n,y:o}=pe(t.x,t.y,e.x,e.y,i),{x:r,y:s}=pe(t.x1,t.y1,e.x1,e.y1,i),a=new fe(n,o,r,s);return a.defined=e.defined,a}function Cr(t,e,i){if(!t||!e)return[];Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]);let n=[];if(t.length>e.length){n=e.map((t=>{const e=new fe(t.x,t.y,t.x1,t.y1);return e.defined=t.defined,e}));for(let o=0;o<e.length;o++)n[o]=yr(t[o],e[o],i)}else{n=e.map((t=>{const e=new fe(t.x,t.y,t.x1,t.y1);return e.defined=t.defined,e}));for(let o=0;o<t.length;o++)n[o]=yr(t[o],e[o],i)}return n}function wr(t,e){if(ut(t)){let i;for(let n=0;n<t.length&&void 0===i;n++)i=t[n][e];return i}return t[e]}class xr{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xr.TimeOut;this.durations=[],this.timeout=t,this.lastDate=0,this.durationsListThreshold=30}call(t){return this.lastDate=Date.now(),setTimeout((()=>{this.appendDuration(Date.now()-this.lastDate),t(0)}),this.timeout,!0)}clear(t){clearTimeout(t)}appendDuration(t){this.durations.push(t),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce(((t,e)=>t+e),0)/this.durations.length,1e3/60),1e3/30)}}xr.TimeOut=1e3/60;const _r=new xr,Sr=(t,e)=>{const i=((t,e)=>ct(t)&&"%"===t[t.length-1]?e*(Number.parseFloat(t.substring(0,t.length-1))/100):t)(t,e);return isNaN(i)?i:Math.max(e,i)};var Ar;!function(t){t[t.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",t[t.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT",t[t.TOP_TO_BOTTOM=2]="TOP_TO_BOTTOM",t[t.BOTTOM_TO_TOP=3]="BOTTOM_TO_TOP",t[t.STROKE=4]="STROKE"}(Ar||(Ar={}));class Br extends rr{constructor(){super(...arguments),this.fromText="",this.toText=""}getEndProps(){return!1===this.valid?{}:{text:this.to}}onBind(){var t,e,i;this.fromText=null!==(e=null===(t=this.from)||void 0===t?void 0:t.text)&&void 0!==e?e:"",this.toText=(null===(i=this.to)||void 0===i?void 0:i.text)||"",(!this.toText||ut(this.toText)&&0===this.toText.length)&&(this.valid=!1),ut(this.toText)&&(this.toText=this.toText.map((t=>(t||"").toString())))}onEnd(){this.target.detachShadow()}onUpdate(t,e,i){if(!1===this.valid)return;const n=this.fromText.length,o=ut(this.toText),r=o?this.toText.reduce(((t,e)=>t+(e||"").length),0):this.toText.length,s=Math.ceil(n+(r-n)*e);if(o){i.text=[];let t=0;this.toText.forEach((e=>{t+e.length>s?(i.text.push(e.substr(0,s-t)),t=s):(i.text.push(e),t+=e.length)}))}else i.text=this.toText.substr(0,s)}}var Tr;!function(t){t[t.Color255=0]="Color255",t[t.Color1=1]="Color1"}(Tr||(Tr={}));class Rr{static Get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tr.Color1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0,1];if(e===Tr.Color1){const e=Rr.store1[t];if(e)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i;const n=Ze.parseColorString(t);if(n){const e=[n.r/255,n.g/255,n.b/255,n.opacity];Rr.store1[t]=e,Rr.store255[t]=[n.r,n.g,n.b,n.opacity],i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]}return i}const n=Rr.store255[t];if(n)return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i;const o=Ze.parseColorString(t);return o&&(Rr.store1[t]=[o.r/255,o.g/255,o.b/255,o.opacity],Rr.store255[t]=[o.r,o.g,o.b,o.opacity],i[0]=o.r,i[1]=o.g,i[2]=o.b,i[3]=o.opacity),i}static Set(t,e,i){if(e===Tr.Color1){if(Rr.store1[t])return;Rr.store1[t]=i,Rr.store255[t]=[Math.floor(255*i[0]),Math.floor(255*i[1]),Math.floor(255*i[2]),Math.floor(255*i[3])]}else{if(Rr.store255[t])return;Rr.store255[t]=i,Rr.store1[t]=[i[0]/255,i[1]/255,i[2]/255,i[3]]}}}function kr(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.isArray(t)&&ft(t[0])?e?`rgb(${Math.round(t[0])},${Math.round(t[1])},${Math.round(t[2])},${t[3].toFixed(2)})`:`rgb(${Math.round(t[0])},${Math.round(t[1])},${Math.round(t[2])})`:t}function Mr(t,e,i,n,o){return Array.isArray(t)&&!ft(t[0])||Array.isArray(e)&&!ft(e[0])?new Array(4).fill(0).map(((o,r)=>Lr(ut(t)?t[r]:t,ut(e)?e[r]:e,i,n))):Lr(t,e,i,n,o)}function Lr(t,e,i,n,o){if(!t||!e)return t&&kr(t)||e&&kr(e)||!1;let r,s,a=!1,l=!1;if(Array.isArray(t)?r=t:"string"==typeof t?r=Rr.Get(t,Tr.Color255):a=!0,Array.isArray(e)?s=e:"string"==typeof e?s=Rr.Get(e,Tr.Color255):l=!0,a!==l){const r=a?t:e,s=a?e:t,l=Object.assign(Object.assign({},r),{stops:r.stops.map((t=>Object.assign(Object.assign({},t),{color:kr(s)})))});return a?Mr(r,l,i,n,o):Mr(l,r,i,n,o)}if(a){if(t.gradient===e.gradient){const n=t,o=e,r=n.stops,s=o.stops;if(r.length!==s.length)return!1;if("linear"===n.gradient)return function(t,e,i){const n=t.stops,o=e.stops;return{gradient:"linear",x0:t.x0+(e.x0-t.x0)*i,x1:t.x1+(e.x1-t.x1)*i,y0:t.y0+(e.y0-t.y0)*i,y1:t.y1+(e.y1-t.y1)*i,stops:new Array(n.length).fill(0).map(((t,e)=>({color:Hr(n[e].color,o[e].color,i),offset:n[e].offset+(o[e].offset-n[e].offset)*i})))}}(n,o,i);if("radial"===n.gradient)return function(t,e,i){const n=t.stops,o=e.stops;return{gradient:"radial",x0:t.x0+(e.x0-t.x0)*i,x1:t.x1+(e.x1-t.x1)*i,y0:t.y0+(e.y0-t.y0)*i,y1:t.y1+(e.y1-t.y1)*i,r0:t.r0+(e.r0-t.r0)*i,r1:t.r1+(e.r1-t.r1)*i,stops:new Array(n.length).fill(0).map(((t,e)=>({color:Hr(n[e].color,o[e].color,i),offset:n[e].offset+(o[e].offset-n[e].offset)*i})))}}(n,o,i);if("conical"===n.gradient)return function(t,e,i){const n=t.stops,o=e.stops;return{gradient:"conical",startAngle:t.startAngle+(e.startAngle-t.startAngle)*i,endAngle:t.endAngle+(e.endAngle-t.endAngle)*i,x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i,stops:new Array(n.length).fill(0).map(((t,e)=>({color:Hr(n[e].color,o[e].color,i),offset:n[e].offset+(o[e].offset-n[e].offset)*i})))}}(n,o,i)}return!1}return o&&o(r,s),kr(function(t,e,i){return[t[0]+(e[0]-t[0])*i,t[1]+(e[1]-t[1])*i,t[2]+(e[2]-t[2])*i,t[3]+(e[3]-t[3])*i]}(r,s,i),n)}Rr.store255={},Rr.store1={};const Pr=[0,0,0,0],Er=[0,0,0,0];function Hr(t,e,i){return Rr.Get(t,Tr.Color255,Pr),Rr.Get(e,Tr.Color255,Er),`rgba(${Math.round(Pr[0]+(Er[0]-Pr[0])*i)},${Math.round(Pr[1]+(Er[1]-Pr[1])*i)},${Math.round(Pr[2]+(Er[2]-Pr[2])*i)},${Pr[3]+(Er[3]-Pr[3])*i})`}class Or{static GetImage(t,e){var i;const n=Or.cache.get(t);n?"fail"===n.loadState?$n.global.getRequestAnimationFrame()((()=>{e.imageLoadFail(t)})):"init"===n.loadState||"loading"===n.loadState?null===(i=n.waitingMark)||void 0===i||i.push(e):e&&e.imageLoadSuccess(t,n.data):Or.loadImage(t,e)}static GetSvg(t,e){var i;let n=Or.cache.get(t);n?"fail"===n.loadState?$n.global.getRequestAnimationFrame()((()=>{e.imageLoadFail(t)})):"init"===n.loadState||"loading"===n.loadState?null===(i=n.waitingMark)||void 0===i||i.push(e):e&&e.imageLoadSuccess(t,n.data):(n={type:"image",loadState:"init"},Or.cache.set(t,n),n.dataPromise=$n.global.loadSvg(t),n.dataPromise?(n.waitingMark=[e],n.dataPromise.then((e=>{var i;n.loadState=(null==e?void 0:e.data)?"success":"fail",n.data=null==e?void 0:e.data,null===(i=n.waitingMark)||void 0===i||i.map(((i,o)=>{(null==e?void 0:e.data)?(n.loadState="success",n.data=e.data,i.imageLoadSuccess(t,e.data)):(n.loadState="fail",i.imageLoadFail(t))})),n.waitingMark&&(n.waitingMark=[])}))):(n.loadState="fail",e.imageLoadFail(t)))}static GetFile(t,e){let i=Or.cache.get(t);return i?"fail"===i.loadState?Promise.reject():"init"===i.loadState||"loading"===i.loadState?i.dataPromise.then((t=>t.data)):Promise.resolve(i.data):(i={type:e,loadState:"init"},Or.cache.set(t,i),"arrayBuffer"===e?i.dataPromise=$n.global.loadArrayBuffer(t):"blob"===e?i.dataPromise=$n.global.loadBlob(t):"json"===e&&(i.dataPromise=$n.global.loadJson(t)),i.dataPromise.then((t=>t.data)))}static loading(){setTimeout((()=>{if(!Or.isLoading&&Or.toLoadAueue.length){Or.isLoading=!0;const t=Or.toLoadAueue.splice(0,10),e=[];t.forEach((t=>{const{url:i,marks:n}=t,o={type:"image",loadState:"init"};if(Or.cache.set(i,o),o.dataPromise=$n.global.loadImage(i),o.dataPromise){o.waitingMark=n;const t=o.dataPromise.then((t=>{var e;o.loadState=(null==t?void 0:t.data)?"success":"fail",o.data=null==t?void 0:t.data,null===(e=o.waitingMark)||void 0===e||e.map(((e,n)=>{(null==t?void 0:t.data)?(o.loadState="success",o.data=t.data,e.imageLoadSuccess(i,t.data)):(o.loadState="fail",e.imageLoadFail(i))})),o.waitingMark&&(o.waitingMark=[])}));e.push(t)}else o.loadState="fail",n.forEach((t=>t.imageLoadFail(i)))})),Promise.all(e).then((()=>{Or.isLoading=!1,this.onLoadSuccessCb.forEach((t=>t())),Or.loading()})).catch((t=>{Or.isLoading=!1,this.onLoadSuccessCb.forEach((t=>t())),Or.loading()}))}}),0)}static loadImage(t,e){const i=Ir(t,Or.toLoadAueue);if(-1!==i)return Or.toLoadAueue[i].marks.push(e),void Or.loading();Or.toLoadAueue.push({url:t,marks:[e]}),Or.loading()}static improveImageLoading(t){const e=Ir(t,Or.toLoadAueue);if(-1!==e){const t=Or.toLoadAueue.splice(e,1);Or.toLoadAueue.unshift(t[0])}}static onLoadSuccess(t){this.onLoadSuccessCb.push(t)}}function Ir(t,e){for(let i=0;i<e.length;i++)if(e[i].url===t)return i;return-1}Or.cache=new Map,Or.isLoading=!1,Or.toLoadAueue=[],Or.onLoadSuccessCb=[];class Fr{bounds(t,e){if(ft(t)){const i=t/2;e.x1=-i,e.x2=i,e.y1=-i,e.y2=i}else e.x1=-t[0]/2,e.x2=t[0]/2,e.y1=-t[1]/2,e.y2=t[1]/2}parseSize(t){return ft(t)?t:Math.min(t[0],t[1])}}function zr(t,e,i,n,o){return o?t.arc(i,n,e,0,ne,!1,o):t.arc(i,n,e,0,ne),!1}var Dr=new class extends Fr{constructor(){super(...arguments),this.type="circle",this.pathStr="M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0"}draw(t,e,i,n,o){return zr(t,this.parseSize(e)/2,i,n,o)}drawOffset(t,e,i,n,o,r){return zr(t,this.parseSize(e)/2+o,i,n,r)}drawToSvgPath(t,e,i,n){const o=this.parseSize(t)/2;return`M ${e-o}, ${i} a ${o},${o} 0 1,0 ${2*o},0 a ${o},${o} 0 1,0 -${2*o},0`}};var Wr=new class extends Fr{constructor(){super(...arguments),this.type="cross",this.pathStr="M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z"}draw(t,e,i,n,o){return function(t,e,i,n,o){return t.moveTo(-3*e+i,-e+n,o),t.lineTo(-e+i,-e+n,o),t.lineTo(-e+i,-3*e+n,o),t.lineTo(e+i,-3*e+n,o),t.lineTo(e+i,-e+n,o),t.lineTo(3*e+i,-e+n,o),t.lineTo(3*e+i,e+n,o),t.lineTo(e+i,e+n,o),t.lineTo(e+i,3*e+n,o),t.lineTo(-e+i,3*e+n,o),t.lineTo(-e+i,e+n,o),t.lineTo(-3*e+i,e+n,o),t.closePath(),!0}(t,this.parseSize(e)/6,i,n,o)}drawOffset(t,e,i,n,o,r){return function(t,e,i,n,o,r){return t.moveTo(-3*e+i-o,-e+n-o,r),t.lineTo(-e+i-o,-e+n-o,r),t.lineTo(-e+i-o,-3*e+n-o,r),t.lineTo(e+i+o,-3*e+n-o,r),t.lineTo(e+i+o,-e+n-o,r),t.lineTo(3*e+i+o,-e+n-o,r),t.lineTo(3*e+i+o,e+n+o,r),t.lineTo(e+i+o,e+n+o,r),t.lineTo(e+i+o,3*e+n+o,r),t.lineTo(-e+i-o,3*e+n+o,r),t.lineTo(-e+i-o,e+n+o,r),t.lineTo(-3*e+i-o,e+n+o,r),t.closePath(),!0}(t,this.parseSize(e)/6,i,n,o,r)}};function Nr(t,e,i,n,o){return t.moveTo(i,n-e,o),t.lineTo(e+i,n,o),t.lineTo(i,n+e,o),t.lineTo(i-e,n,o),t.closePath(),!0}var Gr=new class extends Fr{constructor(){super(...arguments),this.type="diamond",this.pathStr="M-0.5,0L0,-0.5L0.5,0L0,0.5Z"}draw(t,e,i,n,o){return Nr(t,this.parseSize(e)/2,i,n,o)}drawFitDir(t,e,i,n,o){return Nr(t,this.parseSize(e)/2,i,n,o)}drawOffset(t,e,i,n,o,r){return Nr(t,this.parseSize(e)/2+o,i,n,r)}};function jr(t,e,i,n){const o=2*e;return t.rect(i-e,n-e,o,o),!1}var Vr=new class extends Fr{constructor(){super(...arguments),this.type="square",this.pathStr="M-0.5,-0.5h1v1h-1Z"}draw(t,e,i,n){return jr(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,o){return jr(t,this.parseSize(e)/2+o,i,n)}};function Ur(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return t.moveTo(i+e+2*o,e+n+o),t.lineTo(i-e-2*o,e+n+o),t.lineTo(i,n-e-2*o),t.closePath(),!0}class Xr extends Fr{constructor(){super(...arguments),this.type="triangleUp",this.pathStr="M0.5,0.5 L-0.5,0.5 L0,-0.5 Z"}draw(t,e,i,n){return Ur(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,o){return Ur(t,this.parseSize(e)/2,i,n,o)}}var $r=new Xr;var Yr=new class extends Xr{constructor(){super(...arguments),this.type="triangle"}};const Kr=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),qr=Math.sin(ne/10)*Kr,Zr=-Math.cos(ne/10)*Kr;function Jr(t,e,i,n){const o=qr*e,r=Zr*e;t.moveTo(i,-e+n),t.lineTo(o+i,r+n);for(let s=1;s<5;++s){const a=ne*s/5,l=Math.cos(a),h=Math.sin(a);t.lineTo(h*e+i,-l*e+n),t.lineTo(l*o-h*r+i,h*o+l*r+n)}return t.closePath(),!0}var Qr=new class extends Fr{constructor(){super(...arguments),this.type="star",this.pathStr="M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z"}draw(t,e,i,n){return Jr(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,o){return Jr(t,this.parseSize(e)/2+o,i,n)}};const ts=ce(3);function es(t,e,i,n){const o=e,r=o/ts,s=r/5,a=e;return t.moveTo(0+i,-o+n),t.lineTo(r/2+i,n),t.lineTo(s/2+i,n),t.lineTo(s/2+i,a+n),t.lineTo(-s/2+i,a+n),t.lineTo(-s/2+i,n),t.lineTo(-r/2+i,n),t.closePath(),!0}var is=new class extends Fr{constructor(){super(...arguments),this.type="arrow",this.pathStr="M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z"}draw(t,e,i,n){return es(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,o){return es(t,this.parseSize(e)/2+o,i,n)}};function ns(t,e,i,n){const o=2*e;return t.moveTo(i,-e+n),t.lineTo(o/3/2+i,e+n),t.lineTo(-o/3/2+i,e+n),t.closePath(),!0}var os=new class extends Fr{constructor(){super(...arguments),this.type="wedge",this.pathStr="M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z"}draw(t,e,i,n){return ns(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,o){return ns(t,this.parseSize(e)/2+o,i,n)}};function rs(t,e,i,n){return t.moveTo(-e+i,n),t.lineTo(i,e+n),!1}var ss=new class extends Fr{constructor(){super(...arguments),this.type="stroke",this.pathStr=""}draw(t,e,i,n){return rs(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,o){return rs(t,this.parseSize(e)/2+o,i,n)}};const as=-.5,ls=ce(3)/2,hs=1/ce(12);function ds(t,e,i,n){const o=e/2,r=e*hs,s=o,a=e*hs+e,l=-s,h=a;return t.moveTo(o+i,r+n),t.lineTo(s+i,a+n),t.lineTo(l+i,h+n),t.lineTo(as*o-ls*r+i,ls*o+as*r+n),t.lineTo(as*s-ls*a+i,ls*s+as*a+n),t.lineTo(as*l-ls*h+i,ls*l+as*h+n),t.lineTo(as*o+ls*r+i,as*r-ls*o+n),t.lineTo(as*s+ls*a+i,as*a-ls*s+n),t.lineTo(as*l+ls*h+i,as*h-ls*l+n),t.closePath(),!1}var cs=new class extends Fr{constructor(){super(...arguments),this.type="wye",this.pathStr="M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z"}draw(t,e,i,n){return ds(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,o){return ds(t,this.parseSize(e)/2+o,i,n)}};function us(t,e,i,n,o){return t.moveTo(-e+i-2*o,n),t.lineTo(e+i+o,e+n+2*o),t.lineTo(e+i+o,n-e-2*o),t.closePath(),!0}var gs=new class extends Fr{constructor(){super(...arguments),this.type="triangleLeft",this.pathStr="M-0.5,0 L0.5,0.5 L0.5,-0.5 Z"}draw(t,e,i,n){return us(t,this.parseSize(e)/2,i,n,0)}drawOffset(t,e,i,n,o){return us(t,this.parseSize(e)/2,i,n,o)}};function ps(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return t.moveTo(i-e-o,e+n+2*o),t.lineTo(e+i+2*o,n),t.lineTo(i-e-o,n-e-2*o),t.closePath(),!0}var fs=new class extends Fr{constructor(){super(...arguments),this.type="triangleRight",this.pathStr="M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z"}draw(t,e,i,n){return ps(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,o){return ps(t,this.parseSize(e)/2,i,n,o)}};function vs(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return t.moveTo(i-e-2*o,n-e-o),t.lineTo(i+e+2*o,n-e-o),t.lineTo(i,n+e+2*o),t.closePath(),!0}var bs=new class extends Fr{constructor(){super(...arguments),this.type="triangleDown",this.pathStr="M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z"}draw(t,e,i,n){return vs(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,o){return vs(t,this.parseSize(e)/2,i,n,o)}};const ms=ce(3);function ys(t,e,i,n){const o=e*ms;return t.moveTo(i,n+-o/3*2),t.lineTo(e+i,n+o),t.lineTo(i-e,n+o),t.closePath(),!0}var Cs=new class extends Fr{constructor(){super(...arguments),this.type="thinTriangle",this.pathStr="M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z"}draw(t,e,i,n){return ys(t,this.parseSize(e)/2/ms,i,n)}drawOffset(t,e,i,n,o){return ys(t,this.parseSize(e)/2/ms+o,i,n)}};function ws(t,e,i,n){const o=2*e;return t.moveTo(e+i,n-o),t.lineTo(i-e,n),t.lineTo(e+i,o+n),!0}var xs=new class extends Fr{constructor(){super(...arguments),this.type="arrow2Left",this.pathStr="M 0.25 -0.5 L -0.25 0 l 0.25 0.5"}draw(t,e,i,n){return ws(t,this.parseSize(e)/4,i,n)}drawOffset(t,e,i,n,o){return ws(t,this.parseSize(e)/4+o,i,n)}};function _s(t,e,i,n){const o=2*e;return t.moveTo(i-e,n-o),t.lineTo(i+e,n),t.lineTo(i-e,o+n),!0}var Ss=new class extends Fr{constructor(){super(...arguments),this.type="arrow2Right",this.pathStr="M -0.25 -0.5 l 0.25 0 l -0.25 0.5"}draw(t,e,i,n){return _s(t,this.parseSize(e)/4,i,n)}drawOffset(t,e,i,n,o){return _s(t,this.parseSize(e)/4+o,i,n)}};function As(t,e,i,n){const o=2*e;return t.moveTo(i-o,n+e),t.lineTo(i,n-e),t.lineTo(i+o,n+e),!0}var Bs=new class extends Fr{constructor(){super(...arguments),this.type="arrow2Up",this.pathStr="M -0.5 0.25 L 0 -0.25 l 0.5 0.25"}draw(t,e,i,n){return As(t,this.parseSize(e)/4,i,n)}drawOffset(t,e,i,n,o){return As(t,this.parseSize(e)/4+o,i,n)}};function Ts(t,e,i,n){const o=2*e;return t.moveTo(i-o,n-e),t.lineTo(i,n+e),t.lineTo(i+o,n-e),!0}var Rs=new class extends Fr{constructor(){super(...arguments),this.type="arrow2Down",this.pathStr="M -0.5 -0.25 L 0 0.25 l 0.5 -0.25"}draw(t,e,i,n){return Ts(t,this.parseSize(e)/4,i,n)}drawOffset(t,e,i,n,o){return Ts(t,this.parseSize(e)/4+o,i,n)}};function ks(t,e,i,n,o){return t.moveTo(i,n-e),t.lineTo(i,n+e),!0}var Ms=new class extends Fr{constructor(){super(...arguments),this.type="lineV",this.pathStr="M0,-0.5L0,0.5"}draw(t,e,i,n,o){return ks(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,o,r){return ks(t,this.parseSize(e)/2+o,i,n)}drawToSvgPath(t,e,i,n){const o=this.parseSize(t)/2;return`M ${e}, ${i-o} L ${e},${i+o}`}};function Ls(t,e,i,n,o){return t.moveTo(i-e,n),t.lineTo(i+e,n),!0}var Ps=new class extends Fr{constructor(){super(...arguments),this.type="lineH",this.pathStr="M-0.5,0L0.5,0"}draw(t,e,i,n,o){return Ls(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,o,r){return Ls(t,this.parseSize(e)/2+o,i,n)}drawToSvgPath(t,e,i,n){const o=this.parseSize(t)/2;return`M ${e-o}, ${i} L ${e+o},${i}`}};function Es(t,e,i,n,o){return t.moveTo(i-e,n-e),t.lineTo(i+e,n+e),t.moveTo(i+e,n-e),t.lineTo(i-e,n+e),!0}var Hs=new class extends Fr{constructor(){super(...arguments),this.type="close",this.pathStr="M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5"}draw(t,e,i,n,o){return Es(t,this.parseSize(e)/2,i,n)}drawOffset(t,e,i,n,o,r){return Es(t,this.parseSize(e)/2+o,i,n)}drawToSvgPath(t,e,i,n){const o=this.parseSize(t)/2;return`M ${e-o}, ${i-o} L ${e+o},${i+o} M ${e+o}, ${i-o} L ${e-o},${i+o}`}};function Os(t,e,i,n){return t.rect(i-e[0]/2,n-e[1]/2,e[0],e[1]),!1}function Is(t,e,i,n){const o=e,r=e/2;return t.rect(i-o/2,n-r/2,o,r),!1}var Fs=new class extends Fr{constructor(){super(...arguments),this.type="rect",this.pathStr="M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z"}draw(t,e,i,n){return ft(e)?Is(t,e,i,n):Os(t,e,i,n)}drawWithClipRange(t,e,i,n,o,r,s){ft(e)&&(e=[e,e/2]);const a=2*(e[0]+e[1])*o,l=[{x:i+e[0]/2,y:n-e[1]/2},{x:i+e[0]/2,y:n+e[1]/2},{x:i-e[0]/2,y:n+e[1]/2},{x:i-e[0]/2,y:n-e[1]/2}];let h=0,d=l[3];t.moveTo(d.x,d.y);for(let e=0;e<l.length;e++){const i=l[e],n=Math.sqrt((i.x-d.x)*(i.x-d.x)+(i.y-d.y)*(i.y-d.y));if(h+n>a){const e=(i.x-d.x)*(a-h)/n,o=(i.y-d.y)*(a-h)/n;t.lineTo(d.x+e,d.y+o);break}t.lineTo(i.x,i.y),d=i,h+=n}return!1}drawOffset(t,e,i,n,o){return ft(e)?Is(t,e+2*o,i,n):Os(t,[e[0]+2*o,e[1]+2*o],i,n)}};const zs=new Fe;class Ds{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.pathStr="",this.type=t,ut(e)?this.svgCache=e:this.path=e,this.isSvg=i}drawOffset(t,e,i,n,o,r,s){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach((o=>{t.beginPath(),Ei(o.path.commandList,t,i,n,e,e),s&&s(o.path,o.attribute)})),!1):(Ei(this.path.commandList,t,i,n,e+o,e+o),!1)}draw(t,e,i,n,o,r){return e=this.parseSize(e),this.drawOffset(t,e,i,n,0,o,r)}parseSize(t){return ft(t)?t:Math.min(t[0],t[1])}drawWithClipRange(t,e,i,n,o,r,s){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach((r=>{r.path.drawWithClipRange(t,e,i,n,o),s&&s(r.path,r.attribute)})),!1):(this.path.drawWithClipRange(t,e,i,n,o),!1)}bounds(t,e){if(t=this.parseSize(t),this.isSvg){if(!this.svgCache)return;return e.clear(),void this.svgCache.forEach((i=>{let{path:n}=i;zs.x1=n.bounds.x1*t,zs.y1=n.bounds.y1*t,zs.x2=n.bounds.x2*t,zs.y2=n.bounds.y2*t,e.union(zs)}))}this.path.bounds&&(e.x1=this.path.bounds.x1*t,e.y1=this.path.bounds.y1*t,e.x2=this.path.bounds.x2*t,e.y2=this.path.bounds.y2*t)}}const Ws={};[Dr,Wr,Gr,Vr,Cs,Yr,Qr,is,os,ss,cs,gs,fs,$r,bs,xs,Ss,Bs,Rs,Fs,Ms,Ps,Hs].forEach((t=>{Ws[t.type]=t}));const Ns={arrowLeft:"M 0.25 -0.5 L -0.25 0 l 0.5 0.5",arrowRight:"M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5",rectRound:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",roundLine:"M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z"};class Gs{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){"__proto__"===t&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){"__proto__"===t.tagname&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}function js(t,e,i,n){const o=t.indexOf(e,i);if(-1===o)throw new Error(n);return o+e.length-1}function Vs(t,e,i){const n=function(t,e){let i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:">",o="";for(let r=e;r<t.length;r++){let e=t[r];if(i)e===i&&(i="");else if('"'===e||"'"===e)i=e;else if(e===n[0]){if(!n[1])return{data:o,index:r};if(t[r+1]===n[1])return{data:o,index:r}}else"\t"===e&&(e=" ");o+=e}}(t,e+1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:">");if(!n)return;let o=n.data;const r=n.index,s=o.search(/\s/);let a=o,l=!0;-1!==s&&(a=o.substr(0,s).replace(/\s\s*$/,""),o=o.substr(s+1));const h=a;if(i){const t=a.indexOf(":");-1!==t&&(a=a.substr(t+1),l=a!==n.data.substr(t+1))}return{tagName:a,tagExp:o,closeIndex:r,attrExpPresent:l,rawTagName:h}}const Us=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");class Xs{constructor(t){this.currentNode=null,this.options=t,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(t,e,i){const n=e.tagname;"string"==typeof n?(e.tagname=n,t.addChild(e)):t.addChild(e)}buildAttributesMap(t,e,i){const n={};if(!t)return;const o=function(t,e){const i=[];let n=e.exec(t);for(;n;){const o=[];o.startIndex=e.lastIndex-n[0].length;const r=n.length;for(let t=0;t<r;t++)o.push(n[t]);i.push(o),n=e.exec(t)}return i}(t,Us),r=o.length;for(let t=0;t<r;t++){const e=o[t][1],i=o[t][4];e&&(n[e]=void 0===i||(isNaN(i)?i:Number(i)))}return n}parseXml(t){t=t.replace(/\r\n?/g,"\n");const e=new Gs("!xml");let i=e,n="",o="";for(let r=0;r<t.length;r++)if("<"===t[r])if("/"===t[r+1]){const e=js(t,">",r,"Closing Tag is not closed."),s=o.lastIndexOf(".");o=o.substring(0,s),i=this.tagsNodeStack.pop(),i&&i.child&&n&&i.child[i.child.length-1][":@"]&&(i.child[i.child.length-1][":@"].text=n),n="",r=e}else if("?"===t[r+1])r=Vs(t,r,!1,"?>").closeIndex+1;else if("!--"===t.substr(r+1,3))r=js(t,"--\x3e",r+4,"Comment is not closed.");else{const s=Vs(t,r,!1);let a=s.tagName,l=s.tagExp;const h=s.attrExpPresent,d=s.closeIndex;if(a!==e.tagname&&(o+=o?"."+a:a),l.length>0&&l.lastIndexOf("/")===l.length-1){"/"===a[a.length-1]?(a=a.substr(0,a.length-1),o=o.substr(0,o.length-1),l=a):l=l.substr(0,l.length-1);const t=new Gs(a);a!==l&&h&&(t[":@"]=this.buildAttributesMap(l,o,a)),this.addChild(i,t,o),o=o.substr(0,o.lastIndexOf("."))}else{const t=new Gs(a);this.tagsNodeStack.push(i),a!==l&&h&&(t[":@"]=this.buildAttributesMap(l,o,a)),this.addChild(i,t,o),i=t}n="",r=d}else n+=t[r];return e.child}}function $s(t,e){return Ys(t)}function Ys(t,e){const i={};for(let e=0;e<t.length;e++){const n=t[e],o=Ks(n);if(void 0!==o&&n[o]){const t=Ys(n[o]);Zs(t),n[":@"]&&qs(t,n[":@"]),void 0!==i[o]&&i.hasOwnProperty(o)?(Array.isArray(i[o])||(i[o]=[i[o]]),i[o].push(t)):i[o]=t}}return i}function Ks(t){const e=Object.keys(t);for(let t=0;t<e.length;t++){const i=e[t];if(":@"!==i)return i}}function qs(t,e,i){if(e){const i=Object.keys(e),n=i.length;for(let o=0;o<n;o++){const n=i[o];t[n]=e[n]}}}function Zs(t){return 0===Object.keys(t).length}class Js{constructor(t){this.options=Object.assign({},Js.defaultOptions,t)}valid(t){return t.startsWith("<")}parse(t){if(!this.valid)return!1;return $s(new Xs(this.options).parseXml(t),this.options)}}function Qs(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return t.expand(e+(n/2+(i?function(t,e){return t?e:0}(i,e):0))),t}Js.defaultOptions={};let ta=0;function ea(){return ta++}var ia;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(ia||(ia={}));const na=new Map;["…","（","）","—","【","】","「","」","《","》"].forEach((t=>na.set(t,!0)));const oa=new Map;function ra(t){if(na.has(t))return!0;if(oa.has(t))return!1;let e=!1;return t.codePointAt(0)<256&&(e=!0),e}[""].forEach((t=>oa.set(t,!0)));const sa=ea(),aa=ea(),la=ea(),ha=ea();ea();const da=ea(),ca=ea(),ua=ea(),ga=ea(),pa=ea();ea();const fa=ea();ea();const va=ea();ea();const ba=ea(),ma=ea(),ya=Symbol.for("GraphicService"),Ca=Symbol.for("GraphicCreator"),wa={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity",stroke:"stroke",fill:"fill"},xa=Object.keys(wa),_a=new Fe,Sa=new De;new Fe;const Aa=["lineWidth","scaleX","scaleY","angle","anchor","visible"],Ba=["x","y"],Ta=["scaleX","scaleY"],Ra=["angle"],ka=new fe,Ma={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1};class La extends Wo{static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const n=e[i];Object.defineProperty(La.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get AABBBounds(){return this.tryUpdateAABBBounds()}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e;super(),this._AABBBounds=new Fe,this._updateTag=wi.INIT,this.attribute=t,this.valid=this.isValid(),this.updateAABBBoundsStamp=0,t.background?this.loadImage(null!==(e=t.background.background)&&void 0!==e?e:t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic)}setMode(t){"3d"===t?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var i,n;const{dx:o=t.dx,dy:r=t.dy}=this.attribute;if(e&&this.parent){const t=this.parent.attribute;ka.x=o+(null!==(i=t.scrollX)&&void 0!==i?i:0),ka.y=r+(null!==(n=t.scrollY)&&void 0!==n?n:0)}else ka.x=o,ka.y=r;return ka}onAnimateBind(t){this._emitCustomEvent("animate-bind",t)}tryUpdateAABBBounds(){const t="imprecise"===this.attribute.boundsMode;if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;$n.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const e=this.doUpdateAABBBounds(t);return $n.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),"empty"===this.attribute.boundsMode&&e.clear(),e}tryUpdateOBBBounds(){return this._OBBBounds||(this._OBBBounds=new ze),this.tryUpdateAABBBounds(),this.updateOBBBoundsStamp===this.updateAABBBoundsStamp?this._OBBBounds:(this.updateOBBBoundsStamp=this.updateAABBBoundsStamp,this.valid?this.doUpdateOBBBounds():(this._OBBBounds.clear(),this._OBBBounds))}combindShadowAABBBounds(t){if(this.shadowRoot){const e=this.shadowRoot.AABBBounds.clone();t.union(e)}}doUpdateOBBBounds(){return this._OBBBounds}getClipPath(){const{clipConfig:t}=this.attribute;if(!t)return null;this.clipPathMap||(this.clipPathMap=new Map);const{shape:e}=t;let i=this.clipPathMap.get(e)||null;return i||(this.clipPathMap.size>10&&this.clipPathMap.clear(),i=this.parsePath(e),i&&this.clipPathMap.set(e,i)),i}parsePath(t){if(!t)return null;let e=Ws[t];if(e)return e;if(e=La.userSymbolMap[t],e)return e;if(!0===function(t){return t.startsWith("<svg")||t.startsWith("<?xml")}(t=Ns[t]||t)){const e=new Js,{svg:i}=e.parse(t);if(!i)return null;const n=ut(i.path)?i.path:[i.path];_a.clear();const o=[];n.forEach((t=>{const e=(new wn).fromString(t.d),i={};xa.forEach((e=>{t[e]&&(i[wa[e]]=t[e])})),o.push({path:e,attribute:i}),_a.union(e.bounds)}));const r=_a.width(),s=_a.height(),a=1/le(r,s);o.forEach((t=>t.path.transform(0,0,a,a)));const l=new Ds(t,o,!0);return La.userSymbolMap[t]=l,l}const i=(new wn).fromString(t),n=i.bounds.width(),o=i.bounds.height(),r=1/le(n,o);i.transform(0,0,r,r);const s=new Ds(t,i);return La.userSymbolMap[t]=s,s}doUpdateAABBBounds(t){this.updateAABBBoundsStamp++;const e=this.getGraphicTheme();this._AABBBounds.clear();const i=this.attribute,n=this.updateAABBBounds(i,e,this._AABBBounds,t),{boundsPadding:o=e.boundsPadding}=i,r=fr(o);return r&&n.expand(r),this.clearUpdateBoundTag(),n}updatePathProxyAABBBounds(t){const e="function"==typeof this.pathProxy?this.pathProxy(this.attribute):this.pathProxy;if(!e)return!1;const i=new ii(t);return Ei(e.commandList,i,0,0),!0}tryUpdateGlobalAABBBounds(){const t=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(t.x1,t.y1,t.x2,t.y2):this._globalAABBBounds=t.clone(),this._globalAABBBounds.empty()||this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(){if(this._globalTransMatrix){if(this.parent){const t=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._transMatrix||(this._transMatrix=new De),this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),t&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?(!!(this._updateTag&wi.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds())&&$n.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this):!!(this._updateTag&wi.UPDATE_BOUNDS)&&$n.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&wi.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&wi.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&wi.UPDATE_LOCAL_MATRIX)}isValid(){var t,e;const i=this.attribute;return Number.isFinite((null!==(t=i.x)&&void 0!==t?t:0)+(null!==(e=i.y)&&void 0!==e?e:0))}_validNumber(t){return null==t||Number.isFinite(t)}shouldUpdateShape(){return!!(this._updateTag&wi.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=wi.CLEAR_SHAPE}containsPoint(t,e,i,n){if(!n)return!1;if(i===xi.GLOBAL){const i=new fe(t,e);this.parent&&this.parent.globalTransMatrix.transformPoint(i,i),t=i.x,e=i.y}return n.containsPoint(this,{x:t,y:e})}setWidthHeightWithoutTransform(t){this.widthWithoutTransform=t.x2-t.x1,this.heightWithoutTransform=t.y2-t.y1}setAttributes(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;(t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t).background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._setAttributes(t,e,i)}_setAttributes(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;const n=Object.keys(t);for(let e=0;e<n.length;e++){const i=n[e];this.attribute[i]=t[i]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(n)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i)}setAttribute(t,e,i,n){var o;const r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,n);r?this._setAttributes(r,i,n):rt(null===(o=this.normalAttrs)||void 0===o?void 0:o[t])?(this.attribute[t]=e,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n)):this.normalAttrs[t]=e,"background"===t?this.loadImage(e,!0):"shadowGraphic"===t&&this.setShadowGraphic(e)}needUpdateTags(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Aa;for(let i=0;i<e.length;i++){const n=e[i];if(-1!==t.indexOf(n))return!0}return!1}needUpdateTag(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Aa;for(let i=0;i<e.length;i++)if(t===e[i])return!0;return!1}initAttributes(t){const e={type:_i.INIT};t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,e)||t,this.attribute=t,t.background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._updateTag=wi.INIT,this.valid=this.isValid(),this.onAttributeUpdate(e)}translate(t,e){var i,n;if(0===t&&0===e)return this;const o={type:_i.TRANSLATE},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,Ba,o);r&&(t=r.x,e=r.y,delete r.x,delete r.y,this._setAttributes(r));const s=this.attribute,a=s.postMatrix;return a?$n.transformUtil.fromMatrix(a,a).translate(t,e):(s.x=(null!==(i=s.x)&&void 0!==i?i:Sn.x)+t,s.y=(null!==(n=s.y)&&void 0!==n?n:Sn.y)+e),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this}translateTo(t,e){const i=this.attribute;if(i.x===t&&i.y===e)return this;const n={type:_i.TRANSLATE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,Ba,n);return o?(this._setAttributes(o,!1,n),this):(i.x=t,i.y=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this)}scale(t,e,i){var n,o;if(1===t&&1===e)return this;const r={type:_i.SCALE},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e,scaleCenter:i},this.attribute,Ta,r);s&&(t=s.scaleX,e=s.scaleY,delete s.scaleX,delete s.scaleY,this._setAttributes(s));const a=this.attribute;if(i){let{postMatrix:n}=this.attribute;n||(n=new De,a.postMatrix=n),$n.transformUtil.fromMatrix(n,n).scale(t,e,i)}else a.scaleX=(null!==(n=a.scaleX)&&void 0!==n?n:Sn.scaleX)*t,a.scaleY=(null!==(o=a.scaleY)&&void 0!==o?o:Sn.scaleY)*e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this}scaleTo(t,e){const i=this.attribute;if(i.scaleX===t&&i.scaleY===e)return this;const n={type:_i.SCALE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e},this.attribute,Ta,n);return o?(this._setAttributes(o,!1,n),this):(i.scaleX=t,i.scaleY=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this)}rotate(t,e){var i;if(0===t)return this;const n={type:_i.ROTATE},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:t,rotateCenter:e},this.attribute,Ra,n);o&&(delete o.angle,this._setAttributes(o,!1,n));const r=this.attribute;if(e){let{postMatrix:i}=this.attribute;i||(i=new De,r.postMatrix=i),$n.transformUtil.fromMatrix(i,i).rotate(t,e)}else r.angle=(null!==(i=r.angle)&&void 0!==i?i:Sn.angle)+t;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this}rotateTo(t){const e=this.attribute;if(e.angle===t)return this;const i={type:_i.ROTATE_TO},n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,Ra,i);return n?(this._setAttributes(n,!1,i),this):(e.angle=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i),this)}skewTo(t,e){return this}animate(t){var e;this.animates||(this.animates=new Map);const i=new ar(null==t?void 0:t.id,null!==(e=null==t?void 0:t.timeline)&&void 0!==e?e:this.stage&&this.stage.getTimeline(),null==t?void 0:t.slience);if(i.bind(this),t){const{onStart:e,onFrame:n,onEnd:o,onRemove:r}=t;null!=e&&i.onStart(e),null!=n&&i.onFrame(n),null!=o&&i.onEnd(o),null!=r&&i.onRemove(r),i.interpolateFunc=t.interpolate}return this.animates.set(i.id,i),i.onRemove((()=>{i.stop(),this.animates.delete(i.id)})),i}onAttributeUpdate(t){t&&t.skipUpdateCallback||($n.graphicService.onAttributeUpdate(this),this._emitCustomEvent("afterAttributeUpdate",t))}update(t){t?(t.bounds&&this.tryUpdateAABBBounds(),t.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds(),this.tryUpdateLocalTransMatrix())}hasState(t){return!(!this.currentStates||!this.currentStates.length)&&(!!rt(t)||this.currentStates.includes(t))}getState(t){var e;return null===(e=this.states)||void 0===e?void 0:e[t]}applyStateAttrs(t,e,i,n){var o,r,s,a;if(i){const i=Object.keys(t),l=this.getNoWorkAnimateAttr(),h={};let d;i.forEach((e=>{l[e]?(d||(d={}),d[e]=t[e]):h[e]=n&&void 0===t[e]?this.getDefaultAttribute(e):t[e]}));const c=this.animate({slience:!0});c.stateNames=e,c.to(h,null!==(r=null===(o=this.stateAnimateConfig)||void 0===o?void 0:o.duration)&&void 0!==r?r:dr,null!==(a=null===(s=this.stateAnimateConfig)||void 0===s?void 0:s.easing)&&void 0!==a?a:cr),d&&this.setAttributes(d,!1,{type:_i.STATE})}else this.stopStateAnimates(),this.setAttributes(t,!1,{type:_i.STATE})}updateNormalAttrs(t){const e={};this.normalAttrs?(Object.keys(t).forEach((t=>{t in this.normalAttrs?(e[t]=this.normalAttrs[t],delete this.normalAttrs[t]):e[t]=this.getNormalAttribute(t)})),Object.keys(this.normalAttrs).forEach((e=>{t[e]=this.normalAttrs[e]}))):Object.keys(t).forEach((t=>{e[t]=this.getNormalAttribute(t)})),this.normalAttrs=e}stopStateAnimates(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"end";this.animates&&this.animates.forEach((e=>{e.stateNames&&(e.stop(t),this.animates.delete(e.id))}))}getNormalAttribute(t){let e=this.attribute[t];return this.animates&&this.animates.forEach((i=>{if(i.stateNames){const n=i.getEndProps();Bt(n,t)&&(e=n[t])}})),e}clearStates(t){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0)):this.currentStates=[],this.normalAttrs=null}removeState(t,e){if(this.currentStates){const i=ut(t)?e=>!t.includes(e):e=>e!==t,n=this.currentStates.filter(i);n.length!==this.currentStates.length&&this.useStates(n,e)}}toggleState(t,e){if(this.hasState(t))this.removeState(t,e);else if((this.currentStates?this.currentStates.indexOf(t):-1)<0){const i=this.currentStates?this.currentStates.slice():[];i.push(t),this.useStates(i,e)}}addState(t,e,i){var n;if(this.currentStates&&this.currentStates.includes(t)&&(e||1===this.currentStates.length))return;const o=e&&(null===(n=this.currentStates)||void 0===n?void 0:n.length)?this.currentStates.concat([t]):[t];this.useStates(o,i)}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if((null===(i=this.currentStates)||void 0===i?void 0:i.length)===t.length&&!t.some(((t,e)=>this.currentStates[e]!==t)))return;const n={};t.forEach((e=>{var i;const o=this.stateProxy?this.stateProxy(e,t):null===(i=this.states)||void 0===i?void 0:i[e];o&&Object.assign(n,o)})),this.updateNormalAttrs(n),this.currentStates=t,this.applyStateAttrs(n,t,e)}addUpdateBoundTag(){this._updateTag|=wi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=wi.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=wi.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&wi.UPDATE_SHAPE_AND_BOUNDS)===wi.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=wi.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=wi.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=wi.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=wi.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=wi.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=wi.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=wi.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&wi.UPDATE_LAYOUT)}getAnchor(t,e,i){const n=[0,0],o=()=>{if(e.b)return e.b;const t=this.clone();return t.attribute.angle=0,t.attribute.scaleCenter=null,i&&(t.attribute.scaleX=1,t.attribute.scaleY=1),e.b=t.AABBBounds,e.b};if("string"==typeof t[0]){const e=parseFloat(t[0])/100,i=o();n[0]=i.x1+(i.x2-i.x1)*e}else n[0]=t[0];if("string"==typeof t[1]){const e=parseFloat(t[1])/100,i=o();n[1]=i.y1+(i.y2-i.y1)*e}else n[1]=t[1];return n}doUpdateLocalMatrix(){const{x:t=Sn.x,y:e=Sn.y,scaleX:i=Sn.scaleX,scaleY:n=Sn.scaleY,angle:o=Sn.angle,scaleCenter:r,anchor:s,postMatrix:a}=this.attribute;let l=[0,0];const h={};if(s&&o&&(l=this.getAnchor(s,h)),!r||1===i&&1===n)!function(t,e,i,n,o,r,s,a){const l=e.a,h=e.b,d=e.c,c=e.d,u=e.e,g=e.f,p=ae(s),f=de(s);let v,b;a?(v=a[0],b=a[1]):(v=i,b=n);const m=v-i,y=b-n,C=l*p+d*f,w=h*p+c*f,x=d*p-l*f,_=c*p-h*f;t.a=o*C,t.b=o*w,t.c=r*x,t.d=r*_,t.e=u+l*v+d*b-C*m-x*y,t.f=g+h*v+c*b-w*m-_*y}(this._transMatrix,this._transMatrix.reset(),t,e,i,n,o,s&&l);else{const s=this._transMatrix;s.reset(),s.translate(l[0],l[1]),s.rotate(o),s.translate(-l[0],-l[1]),s.translate(t,e),l=this.getAnchor(r,h,!0),$n.transformUtil.fromMatrix(s,s).scale(i,n,{x:l[0],y:l[1]})}const d=this.getOffsetXY(Sn);if(this._transMatrix.e+=d.x,this._transMatrix.f+=d.y,a){const t=Sa.setValue(a.a,a.b,a.c,a.d,a.e,a.f),e=this._transMatrix;t.multiply(e.a,e.b,e.c,e.d,e.e,e.f),e.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);const{scrollX:t=0,scrollY:e=0}=this.parent.attribute;this._globalTransMatrix.translate(t,e)}}setStage(t,e){if(this.stage!==t){if(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this.animates&&this.animates.size){const e=t.getTimeline();this.animates.forEach((t=>{t.timeline===or&&t.setTimeline(e)}))}this._onSetStage&&this._onSetStage(this,t,e),$n.graphicService.onSetStage(this,t)}}setStageToShadowRoot(t,e){this.shadowRoot&&this.shadowRoot.setStage(t,e)}onAddStep(t){}onStop(t){t&&this.setAttributes(t,!1,{type:_i.ANIMATE_END})}onStep(t,e,i,n,o){const r={};if(i.customAnimate)i.customAnimate.update(o,n,r);else{const s=i.props,a=i.parsedProps,l=i.propKeys;this.stepInterpolate(t,e,r,i,n,o,s,void 0,a,l)}this.setAttributes(r,!1,{type:_i.ANIMATE_UPDATE,animationState:{ratio:n,end:o,step:i,isFirstFrameOfStep:t.getLastStep()!==i}}),this.stage&&this.stage.renderNextFrame()}stepInterpolate(t,e,i,n,o,r,s,a,l,h){h||(h=Object.keys(s),n.propKeys=h),r?n.propKeys.forEach((t=>{e.validAttr(t)&&(i[t]=s[t])})):h.forEach((r=>{var h;if(!e.validAttr(r))return;const d=s[r],c=null!==(h=a&&a[r])&&void 0!==h?h:t.getLastPropByName(r,n);if(null==d||null==c||d===c)return void(i[r]=d);let u;u=e.interpolateFunc&&e.interpolateFunc(r,o,c,d,i),u||(u=e.customInterpolate(r,o,c,d,this,i),u||this.defaultInterpolate(d,c,r,i,l,o)||this._interpolate(r,o,c,d,i))})),n.parsedProps=l}defaultInterpolate(t,e,i,n,o,r){if(Number.isFinite(t)&&Number.isFinite(e))return n[i]=e+(t-e)*r,!0;if("fill"===i){o||(o={});const s=o.fillColorArray,a=Mr(e,null!=s?s:t,r,!1,((t,e)=>{o.fillColorArray=e}));return a&&(n[i]=a),!0}if("stroke"===i){o||(o={});const s=o.strokeColorArray,a=Mr(e,null!=s?s:t,r,!1,((t,e)=>{o.strokeColorArray=e}));return a&&(n[i]=a),!0}if("shadowColor"===i){o||(o={});const s=o.shadowColorArray,a=Mr(e,null!=s?s:t,r,!0,((t,e)=>{o.shadowColorArray=e}));return a&&(n[i]=a),!0}if(Array.isArray(t)&&t.length===e.length){const o=[];let s=!0;for(let i=0;i<t.length;i++){const n=e[i],a=n+(t[i]-n)*r;if(!Number.isFinite(a)){s=!1;break}o.push(a)}s&&(n[i]=o)}return!1}_interpolate(t,e,i,n,o){}getDefaultAttribute(t){return this.getGraphicTheme()[t]}getComputedAttribute(t){var e;return null!==(e=this.attribute[t])&&void 0!==e?e:this.getDefaultAttribute(t)}onSetStage(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._onSetStage=t,e&&this.stage&&t(this,this.stage)}attachShadow(t){return t&&(t.shadowHost=this),this.shadowRoot=null!=t?t:$n.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&(this.addUpdateBoundTag(),this.shadowRoot.release(!0),this.shadowRoot=null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map((t=>t.toJson()))}}createPathProxy(t){return ct(t,!0)?this.pathProxy=(new wn).fromString(t):this.pathProxy=new wn,this.pathProxy}loadImage(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t||e&&function(t){return!(!t.fill&&!t.stroke)}(t))return;const i=t;this.resources||(this.resources=new Map);const n={data:"init",state:null};this.resources.set(i,n),"string"==typeof t?(n.state="loading",t.startsWith("<svg")?(Or.GetSvg(t,this),this.backgroundImg=this.backgroundImg||e):(bt(t)||t.includes("/")||mt(t))&&(Or.GetImage(t,this),this.backgroundImg=this.backgroundImg||e)):at(t)?(n.state="success",n.data=t,this.backgroundImg=this.backgroundImg||e):n.state="fail"}setShadowGraphic(t){t?this.attachShadow().add(t):this.detachShadow()}imageLoadSuccess(t,e,i){if(!this.resources)return;const n=this.resources.get(t);n&&(n.state="success",n.data=e,i&&i(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(t,e){if(!this.resources)return;const i=this.resources.get(t);i&&(i.state="fail",e&&e())}_stopAnimates(t){t&&t.forEach((t=>{t.stop()}))}stopAnimates(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&t&&this.forEachChildren((e=>{e.stopAnimates(t)}))}release(){this.releaseStatus="released",this.stopAnimates(),$n.graphicService.onRelease(this)}_emitCustomEvent(t,e){var i,n;if(this._events&&t in this._events){const o=new Uo(t,e);o.bubbles=!1,o.manager=null===(n=null===(i=this.stage)||void 0===i?void 0:i.eventSystem)||void 0===n?void 0:n.manager,this.dispatchEvent(o)}}}var Pa;La.userSymbolMap={},La.mixin(Yo),function(t){t[t.LESS_GROUP=0]="LESS_GROUP",t[t.MORE_GROUP=1]="MORE_GROUP"}(Pa||(Pa={}));let Ea=class t extends La{constructor(t){super(t),this.type="group",this.parent=null,this.isContainer=!0,this.numberType=da,this._childUpdateTag=wi.UPDATE_BOUNDS}setMode(t){"3d"===t?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(t){return this.theme||(this.theme=new Io),this.theme.setTheme(t,this)}createTheme(){this.theme||(this.theme=new Io)}visibleAll(t){this.setAttribute("visible",t),this.forEachChildren((e=>{e.isContainer&&e.visibleAll?e.visibleAll(t):e.setAttribute("visible",t)}))}hideAll(){this.visibleAll(!1)}showAll(){this.visibleAll(!0)}containsPoint(t,e,i){if(i===xi.GLOBAL){const i=new fe(t,e);return this.parent&&this.parent.globalTransMatrix.transformPoint(i,i),this.AABBBounds.contains(i.x,i.y)}return this.AABBBounds.contains(t,e)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&wi.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;$n.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),$n.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,t),"empty"===this.attribute.boundsMode&&e.clear(),e}doUpdateLocalMatrix(){const{x:t=Sn.x,y:e=Sn.y,dx:i=Sn.dx,dy:n=Sn.dy,scaleX:o=Sn.scaleX,scaleY:r=Sn.scaleY,angle:s=Sn.angle,postMatrix:a}=this.attribute;if(0!==t||0!==e||0!==i||0!==n||1!==o||1!==r||0!==s||a)return super.doUpdateLocalMatrix();this._transMatrix.reset()}getGraphicTheme(){return zo(this).group}updateAABBBounds(t,e,i){const n=i;i=i.clone();const{width:o,height:r,path:s,clip:a=e.clip}=t;if(s&&s.length?s.forEach((t=>{i.union(t.AABBBounds)})):null!=o&&null!=r&&i.set(0,0,Math.max(0,o),Math.max(0,r)),!a){this.forEachChildren((t=>{i.union(t.AABBBounds)}));const{scrollX:e=0,scrollY:n=0}=t;i.translate(e,n)}return $n.graphicService.updateTempAABBBounds(i),$n.graphicService.transformAABBBounds(t,i,e,!1,this),n.copy(i),n}doUpdateAABBBounds(){this.updateAABBBoundsStamp++;const t=super.doUpdateAABBBounds();return this.parent&&this.parent.addChildUpdateBoundTag(),this._emitCustomEvent("AAABBBoundsChange"),t}clearUpdateBoundTag(){this._updateTag&=wi.CLEAR_BOUNDS,this._childUpdateTag&=wi.CLEAR_BOUNDS}addUpdateBoundTag(){this._updateTag|=wi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&wi.UPDATE_BOUNDS||(this._childUpdateTag|=wi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(t){const e=super.appendChild(t);return this.stage&&e&&(e.stage=this.stage,e.layer=this.layer),this.addUpdateBoundTag(),$n.graphicService.onAddIncremental(t,this,this.stage),e}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),$n.graphicService.onClearIncremental(this,this.stage)}_updateChildToStage(t){return this.stage&&t&&t.setStage(this.stage,this.layer),this.addUpdateBoundTag(),t}appendChild(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=super.appendChild(t);return e&&this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertBefore(t,e){return this._updateChildToStage(super.insertBefore(t,e))}insertAfter(t,e){return this._updateChildToStage(super.insertAfter(t,e))}insertInto(t,e){return this._updateChildToStage(super.insertInto(t,e))}removeChild(t){const e=super.removeChild(t);return t.stage=null,$n.graphicService.onRemove(t),this.addUpdateBoundTag(),e}removeAllChild(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.forEachChildren((e=>{$n.graphicService.onRemove(e),t&&e.isContainer&&e.removeAllChild(t)})),super.removeAllChild(),this.addUpdateBoundTag()}setStage(t,e){this.stage!==t&&(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this._onSetStage&&this._onSetStage(this,t,e),$n.graphicService.onSetStage(this,t),this.forEachChildren((e=>{e.setStage(t,this.layer)})))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren((t=>{t.isContainer&&t.addUpdateGlobalPositionTag()}))}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren((t=>{t.isContainer&&t.addUpdateGlobalPositionTag()}))}tryUpdateGlobalTransMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){const t=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&wi.UPDATE_GLOBAL_MATRIX)}_getChildByName(t,e){return this.find((e=>e.name===t),e)}createOrUpdateChild(t,e,i){let n=this._getChildByName(t);return n?n.setAttributes(e):(n=$n.graphicService.creator[i](e),n.name=t,this.add(n)),n}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}release(t){t&&this.forEachChildren((e=>{e.release(t)})),super.release()}};function Ha(t){return new Ea(t)}Ea.NOWORK_ANIMATE_ATTR=Ma;class Oa extends Ea{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw new Error("暂不支持")}get dpr(){return this._dpr}constructor(t,e,i,n){var o;super({}),this.stage=t,this.global=e,this.window=i,this.main=n.main,this.layerHandler=n.layerHandler,this.layerHandler.init(this,i,{main:n.main,canvasId:n.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:null!==(o=n.zIndex)&&void 0!==o?o:0}),this.layer=this,this.subLayers=new Map,this.theme=new Io,this.background="rgba(0, 0, 0, 0)",this.afterDrawCbs=[]}combineSubLayer(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=Array.from(this.subLayers.values()).sort(((t,e)=>t.zIndex-e.zIndex));this.layerHandler.merge(e.map((e=>(e.layer.subLayers.size&&e.layer.combineSubLayer(t),e.layer.getNativeHandler())))),t&&e.forEach((t=>{t.group&&(t.group.incremental=0)})),e.forEach((t=>{$n.layerService.releaseLayer(this.stage,t.layer)})),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(t,e){super.setStage(t,this)}pick(t,e){throw new Error("暂不支持")}tryRenderSecondaryLayer(t,e){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach((i=>{i.layer.renderCount=this.renderCount,i.layer.render(t,e)}))}render(t,e){var i;this.layerHandler.render([this],{renderService:t.renderService,stage:this.stage,layer:this,viewBox:t.viewBox,transMatrix:t.transMatrix,background:null!==(i=t.background)&&void 0!==i?i:this.background,updateBounds:t.updateBounds},e),this.afterDrawCbs.forEach((t=>t(this))),this.tryRenderSecondaryLayer(t,e)}resize(t,e){this.layerHandler.resize(t,e)}resizeView(t,e){this.layerHandler.resizeView(t,e)}setDpr(t){this.layerHandler.setDpr(t)}afterDraw(t){this.afterDrawCbs.push(t)}startAnimate(t){throw new Error("暂不支持")}setToFrame(t){throw new Error("暂不支持")}prepare(t,e){}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach((t=>{$n.layerService.releaseLayer(this.stage,t.layer)}))}drawTo(t,e){var i;this.layerHandler.drawTo(t,[this],Object.assign({background:null!==(i=e.background)&&void 0!==i?i:this.background,renderService:e.renderService,viewBox:e.viewBox,transMatrix:e.transMatrix,stage:this.stage,layer:this},e)),this.afterDrawCbs.forEach((t=>t(this)))}}const Ia=Symbol.for("TransformUtil"),Fa=Symbol.for("GraphicUtil"),za=Symbol.for("LayerService"),Da=Symbol.for("StaticLayerHandlerContribution"),Wa=Symbol.for("DynamicLayerHandlerContribution"),Na=Symbol.for("VirtualLayerHandlerContribution");var Ga,ja=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Va=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Ua=Ga=class{static GenerateLayerId(){return`${Ga.idprefix}_${Ga.prefix_count++}`}constructor(){this.layerMap=new Map,this.global=$n.global}tryInit(){this.inited||(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),this.inited=!0)}getStageLayer(t){return this.layerMap.get(t)}getRecommendedLayerType(t){return t||(0!==this.staticLayerCountInEnv?"static":0!==this.dynamicLayerCountInEnv?"dynamic":"virtual")}getLayerHandler(t){let e;return e="static"===t?fo.get(Da):"dynamic"===t?fo.get(Wa):fo.get(Na),e}createLayer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{main:!1};var i;this.tryInit();let n=this.getRecommendedLayerType(e.layerMode);n=e.main||e.canvasId?"static":n;const o=this.getLayerHandler(n),r=new Oa(t,this.global,t.window,Object.assign(Object.assign({main:!1},e),{layerMode:n,canvasId:null!==(i=e.canvasId)&&void 0!==i?i:Ga.GenerateLayerId(),layerHandler:o})),s=this.layerMap.get(t)||[];return s.push(r),this.layerMap.set(t,s),this.staticLayerCountInEnv--,r}prepareStageLayer(t){let e;t.forEachChildren((t=>{const i=t.getNativeHandler();"virtual"===i.type?(i.mainHandler=e,e.secondaryHandlers.push(i)):(e=i,e.secondaryHandlers=[])}))}releaseLayer(t,e){e.release();const i=this.layerMap.get(t)||[];this.layerMap.set(t,i.filter((t=>t!==e)))}layerCount(t){return(this.layerMap.get(t)||[]).length}restLayerCount(t){return"browser"===this.global.env?10:0}releaseStage(t){this.layerMap.delete(t)}};Ua.idprefix="visactor_layer",Ua.prefix_count=0,Ua=Ga=ja([w(),Va("design:paramtypes",[])],Ua);var Xa=new l((t=>{t(V).to(q).inSingletonScope(),t(xo).to(So),t(Fa).to(Ro).inSingletonScope(),t(Ia).to(Lo).inSingletonScope(),t(za).to(Ua).inSingletonScope()}));function $a(t,e){return!(!t&&!e)}function Ya(t,e){let i;return i=ut(t)?t.some((t=>t||void 0===t)):!!t,i&&e>0}function Ka(t,e,i){return i&&t*e>0}function qa(t,e,i,n,o){return o&&t*e>0&&0!==i&&0!==n}function Za(t,e){return t*e>0}function Ja(t,e,i,n){return t*e>0&&0!==i&&0!==n}function Qa(t,e,i,n,o,r,s){const a=t-i,l=e-n,h=(s?r:-r)/Math.sqrt(a*a+l*l),d=h*l,c=-h*a,u=t+d,g=e+c,p=i+d,f=n+c,v=(u+p)/2,b=(g+f)/2,m=p-u,y=f-g,C=m*m+y*y,w=o-r,x=u*f-p*g,_=(y<0?-1:1)*Math.sqrt(Math.max(0,w*w*C-x*x));let S=(x*y-m*_)/C,A=(-x*m-y*_)/C;const B=(x*y+m*_)/C,T=(-x*m+y*_)/C,R=S-v,k=A-b,M=B-v,L=T-b;return R*R+k*k>M*M+L*L&&(S=B,A=T),{cx:S,cy:A,x01:-d,y01:-c,x11:S*(o/w-1),y11:A*(o/w-1)}}function tl(t,e,i,n,o){const r=re(i-e),s=t.getParsedCornerRadius(),a=ut(s),{outerDeltaAngle:l,innerDeltaAngle:h,outerStartAngle:d,outerEndAngle:c,innerEndAngle:u,innerStartAngle:g}=t.getParsePadAngle(e,i),p=a?s[0]:s,f=a?s[1]:s,v=a?s[2]:s,b=a?s[3]:s,m=Math.max(f,p),y=Math.max(v,b);let C=m,w=y;const x=o*ae(d),_=o*de(d),S=n*ae(u),A=n*de(u);let B,T,R,k;if((y>te||m>te)&&(B=o*ae(c),T=o*de(c),R=n*ae(g),k=n*de(g),r<ee)){const t=function(t,e,i,n,o,r,s,a){const l=i-t,h=n-e,d=s-o,c=a-r;let u=c*l-d*h;return u*u<te?[]:(u=(d*(e-r)-c*(t-o))/u,[t+u*l,e+u*h])}(x,_,R,k,B,T,S,A);if(t){const e=x-t[0],i=_-t[1],r=B-t[0],s=T-t[1],a=1/de(((M=(e*r+i*s)/(ce(e*e+i*i)*ce(r*r+s*s)))>1?0:M<-1?ee:Math.acos(M))/2),l=ce(t[0]*t[0]+t[1]*t[1]);w=he(y,(n-l)/(a-1)),C=he(m,(o-l)/(a+1))}}var M;return{outerDeltaAngle:l,xors:x,yors:_,xirs:R,yirs:k,xore:B,yore:T,xire:S,yire:A,limitedOcr:C,limitedIcr:w,outerCornerRadiusStart:p,outerCornerRadiusEnd:f,maxOuterCornerRadius:m,maxInnerCornerRadius:y,outerStartAngle:d,outerEndAngle:c,innerDeltaAngle:h,innerEndAngle:u,innerStartAngle:g,innerCornerRadiusStart:b,innerCornerRadiusEnd:v}}function el(t,e,i,n,o,r,s){const{startAngle:a,endAngle:l}=t.getParsedAngle(),h=re(l-a),d=l>a;let c=!1;if(o<r){const t=o;o=r,r=t}if(o<=te)e.moveTo(i,n);else if(h>=oe-te)e.moveTo(i+o*ae(a),n+o*de(a)),e.arc(i,n,o,a,l,!d),r>te&&(e.moveTo(i+r*ae(l),n+r*de(l)),e.arc(i,n,r,l,a,d));else{const{outerDeltaAngle:h,xors:u,yors:g,xirs:p,yirs:f,limitedOcr:v,outerCornerRadiusStart:b,outerCornerRadiusEnd:m,maxOuterCornerRadius:y,xore:C,yore:w,xire:x,yire:_,outerStartAngle:S,outerEndAngle:A,limitedIcr:B,innerDeltaAngle:T,innerEndAngle:R,innerStartAngle:k,innerCornerRadiusStart:M,innerCornerRadiusEnd:L,maxInnerCornerRadius:P}=tl(t,a,l,r,o);if(h<.001)s&&(s[3]||s[1])&&e.moveTo(i+u,n+g),c=!0;else if(v>te){const t=he(b,v),r=he(m,v),a=Qa(p,f,u,g,o,t,Number(d)),l=Qa(C,w,x,_,o,r,Number(d));v<y&&t===r?!s||s[0]?(e.moveTo(i+a.cx+a.x01,n+a.cy+a.y01),e.arc(i+a.cx,n+a.cy,v,se(a.y01,a.x01),se(l.y01,l.x01),!d)):e.moveTo(i+a.cx+v*ae(se(l.y01,l.x01)),n+a.cy+v*de(se(l.y01,l.x01))):!s||s[0]?(e.moveTo(i+a.cx+a.x01,n+a.cy+a.y01),t>0&&e.arc(i+a.cx,n+a.cy,t,se(a.y01,a.x01),se(a.y11,a.x11),!d),e.arc(i,n,o,se(a.cy+a.y11,a.cx+a.x11),se(l.cy+l.y11,l.cx+l.x11),!d),r>0&&e.arc(i+l.cx,n+l.cy,r,se(l.y11,l.x11),se(l.y01,l.x01),!d)):r>0?e.moveTo(i+l.cx+r*ae(se(l.y01,l.x01)),n+l.cy+r*de(se(l.y01,l.x01))):e.moveTo(i+C,n+o*de(A))}else!s||s[0]?(e.moveTo(i+u,n+g),e.arc(i,n,o,S,A,!d)):e.moveTo(i+o*ae(A),n+o*de(A));if(!(r>te)||T<.001)!s||s[1]?e.lineTo(i+x,n+_):e.moveTo(i+x,n+_),c=!0;else if(B>te){const t=he(M,B),o=he(L,B),a=Qa(x,_,C,w,r,-o,Number(d)),l=Qa(u,g,p,f,r,-t,Number(d));if(!s||s[1]?e.lineTo(i+a.cx+a.x01,n+a.cy+a.y01):e.moveTo(i+a.cx+a.x01,n+a.cy+a.y01),B<P&&t===o){const t=se(l.y01,l.x01);!s||s[2]?e.arc(i+a.cx,n+a.cy,B,se(a.y01,a.x01),t,!d):e.moveTo(i+a.cx+ae(t),n+a.cy+de(t))}else!s||s[2]?(o>0&&e.arc(i+a.cx,n+a.cy,o,se(a.y01,a.x01),se(a.y11,a.x11),!d),e.arc(i,n,r,se(a.cy+a.y11,a.cx+a.x11),se(l.cy+l.y11,l.cx+l.x11),d),t>0&&e.arc(i+l.cx,n+l.cy,t,se(l.y11,l.x11),se(l.y01,l.x01),!d)):t>0?e.moveTo(i+l.cx+t*ae(se(l.y01,l.x01)),n+l.cy+t*de(se(l.y01,l.x01))):e.moveTo(i+p,n+f)}else!s||s[1]?e.lineTo(i+x,n+_):e.moveTo(i+x,n+_),!s||s[2]?e.arc(i,n,r,R,k,d):e.moveTo(i+r*ae(k),n+r*de(k))}return s?s[3]&&e.lineTo(i+o*ae(a),n+o*de(a)):e.closePath(),c}class il{static GetCanvas(){try{return il.canvas||(il.canvas=$n.global.createCanvas({})),il.canvas}catch(t){return null}}static GetCtx(){if(!il.ctx){const t=il.GetCanvas();il.ctx=t.getContext("2d")}return il.ctx}}class nl extends We{static getInstance(){return nl._instance||(nl._instance=new nl),nl._instance}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;const i=il.GetCanvas(),n=il.GetCtx();if(i.width=e,i.height=1,!n)return;if(n.translate(0,0),!n)throw new Error("获取ctx发生错误");const o=n.createLinearGradient(0,0,e,0);t.forEach((t=>{o.addColorStop(t[0],t[1])})),n.fillStyle=o,n.fillRect(0,0,e,1),this.rgbaSet=n.getImageData(0,0,e,1).data}getColor(t){const e=this.rgbaSet.slice(4*t,4*t+4);return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`}GetOrCreate(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100,s=`${t}${e}${i}${n}`;o.forEach((t=>s+=t.join())),s+=r;let a=this.dataMap.get(s);return a||(a={data:new nl(o,r),timestamp:[]},this.addLimitedTimestamp(a,Date.now(),{}),this.dataMap.set(s,a)),this.clearCache(this.dataMap,this.cacheParams),a.data}}class ol{static GetSize(t){for(let e=0;e<ol.ImageSize.length;e++)if(ol.ImageSize[e]>=t)return ol.ImageSize[e];return t}static Get(t,e,i,n,o,r,s){const a=ol.GenKey(t,e,i,n,o),l=ol.cache[a];if(!l||0===l.length)return null;for(let t=0;t<l.length;t++)if(l[t].width>=r&&l[t].height>=s)return l[t].pattern;return null}static Set(t,e,i,n,o,r,s,a){const l=ol.GenKey(t,e,i,n,o);ol.cache[l]?ol.cache[l].push({width:s,height:a,pattern:r}):ol.cache[l]=[{width:s,height:a,pattern:r}]}static GenKey(t,e,i,n,o){return`${e},${i},${n},${o},${t.join()}`}}ol.cache={},ol.ImageSize=[20,40,80,160,320,640,1280,2560];const rl=Symbol.for("ArcRenderContribution"),sl=Symbol.for("AreaRenderContribution"),al=Symbol.for("CircleRenderContribution"),ll=Symbol.for("GroupRenderContribution"),hl=Symbol.for("ImageRenderContribution"),dl=Symbol.for("PathRenderContribution"),cl=Symbol.for("PolygonRenderContribution"),ul=Symbol.for("RectRenderContribution"),gl=Symbol.for("SymbolRenderContribution"),pl=Symbol.for("TextRenderContribution"),fl=Symbol.for("InteractiveSubRenderContribution");function vl(t,e){return"end"===t||"right"===t?-e:"center"===t?-e/2:0}function bl(t,e,i){return"middle"===t?-e/2:"top"===t?0:"bottom"===t?(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)-e:t&&"alphabetic"!==t?0:(i||(i=e),-(e-i)/2-.79*i)}function ml(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yl(t,e,i){const n=i[0],o=i[1],r=i[2];let s,a,l,h,d,c,u,g,p,f,v,b;return e===t?(t[12]=e[0]*n+e[4]*o+e[8]*r+e[12],t[13]=e[1]*n+e[5]*o+e[9]*r+e[13],t[14]=e[2]*n+e[6]*o+e[10]*r+e[14],t[15]=e[3]*n+e[7]*o+e[11]*r+e[15]):(s=e[0],a=e[1],l=e[2],h=e[3],d=e[4],c=e[5],u=e[6],g=e[7],p=e[8],f=e[9],v=e[10],b=e[11],t[0]=s,t[1]=a,t[2]=l,t[3]=h,t[4]=d,t[5]=c,t[6]=u,t[7]=g,t[8]=p,t[9]=f,t[10]=v,t[11]=b,t[12]=s*n+d*o+p*r+e[12],t[13]=a*n+c*o+f*r+e[13],t[14]=l*n+u*o+v*r+e[14],t[15]=h*n+g*o+b*r+e[15]),t}function Cl(t,e){t[0]=e.a,t[1]=e.b,t[2]=0,t[3]=0,t[4]=e.c,t[5]=e.d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e.e,t[13]=e.f,t[14]=0,t[15]=1}function wl(t,e,i){const n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],l=e[5],h=e[6],d=e[7],c=e[8],u=e[9],g=e[10],p=e[11],f=e[12],v=e[13],b=e[14],m=e[15];let y=i[0],C=i[1],w=i[2],x=i[3];return t[0]=y*n+C*a+w*c+x*f,t[1]=y*o+C*l+w*u+x*v,t[2]=y*r+C*h+w*g+x*b,t[3]=y*s+C*d+w*p+x*m,y=i[4],C=i[5],w=i[6],x=i[7],t[4]=y*n+C*a+w*c+x*f,t[5]=y*o+C*l+w*u+x*v,t[6]=y*r+C*h+w*g+x*b,t[7]=y*s+C*d+w*p+x*m,y=i[8],C=i[9],w=i[10],x=i[11],t[8]=y*n+C*a+w*c+x*f,t[9]=y*o+C*l+w*u+x*v,t[10]=y*r+C*h+w*g+x*b,t[11]=y*s+C*d+w*p+x*m,y=i[12],C=i[13],w=i[14],x=i[15],t[12]=y*n+C*a+w*c+x*f,t[13]=y*o+C*l+w*u+x*v,t[14]=y*r+C*h+w*g+x*b,t[15]=y*s+C*d+w*p+x*m,t}function xl(t,e,i){const n=e[0],o=e[1],r=e[2];let s=i[3]*n+i[7]*o+i[11]*r+i[15];return s=s||1,t[0]=(i[0]*n+i[4]*o+i[8]*r+i[12])/s,t[1]=(i[1]*n+i[5]*o+i[9]*r+i[13])/s,t[2]=(i[2]*n+i[6]*o+i[10]*r+i[14])/s,t}class _l{constructor(){this.pools=[]}static identity(t){return ml(t)}allocate(){if(!this.pools.length)return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const t=this.pools.pop();return _l.identity(t),t}allocateByObj(t){let e;e=this.pools.length?this.pools.pop():[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];for(let i=0;i<e.length;i++)e[i]=t[i];return e}free(t){t&&this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}}const Sl=new class{constructor(){this.pools=[]}allocate(t,e,i,n,o,r){if(!this.pools.length)return new De(t,e,i,n,o,r);const s=this.pools.pop();return s.a=t,s.b=e,s.c=i,s.d=n,s.e=o,s.f=r,s}allocateByObj(t){if(!this.pools.length)return new De(t.a,t.b,t.c,t.d,t.e,t.f);const e=this.pools.pop();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}},Al=new _l;var Bl=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Tl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Rl=function(t,e){return function(i,n){e(i,n,t)}};function kl(t,e,i){var n;const{x:o=i.x,y:r=i.y,z:s=i.z,dx:a=i.dx,dy:l=i.dy,dz:h=i.dz,scaleX:d=i.scaleX,scaleY:c=i.scaleY,scaleZ:u=i.scaleZ,alpha:g=i.alpha,beta:p=i.beta,angle:f=i.angle,anchor3d:v=e.attribute.anchor,anchor:b}=e.attribute,m=[0,0,0];if(v){if("string"==typeof v[0]){const t=parseFloat(v[0])/100,i=e.AABBBounds;m[0]=i.x1+(i.x2-i.x1)*t}else m[0]=v[0];if("string"==typeof v[1]){const t=parseFloat(v[1])/100,i=e.AABBBounds;m[1]=i.x1+(i.x2-i.x1)*t}else m[1]=v[1];m[2]=null!==(n=v[2])&&void 0!==n?n:0}if(ml(t),yl(t,t,[o+a,r+l,s+h]),yl(t,t,[m[0],m[1],m[2]]),function(t,e,i){const n=Math.sin(i),o=Math.cos(i),r=e[4],s=e[5],a=e[6],l=e[7],h=e[8],d=e[9],c=e[10],u=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*o+h*n,t[5]=s*o+d*n,t[6]=a*o+c*n,t[7]=l*o+u*n,t[8]=h*o-r*n,t[9]=d*o-s*n,t[10]=c*o-a*n,t[11]=u*o-l*n}(t,t,p),function(t,e,i){const n=Math.sin(i),o=Math.cos(i),r=e[0],s=e[1],a=e[2],l=e[3],h=e[8],d=e[9],c=e[10],u=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*o-h*n,t[1]=s*o-d*n,t[2]=a*o-c*n,t[3]=l*o-u*n,t[8]=r*n+h*o,t[9]=s*n+d*o,t[10]=a*n+c*o,t[11]=l*n+u*o}(t,t,g),yl(t,t,[-m[0],-m[1],m[2]]),function(t,e,i){const n=i[0],o=i[1],r=i[2];t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(t,t,[d,c,u]),f){const i=Al.allocate(),n=[0,0];if(b){if("string"==typeof v[0]){const t=parseFloat(v[0])/100,i=e.AABBBounds;n[0]=i.x1+(i.x2-i.x1)*t}else n[0]=v[0];if("string"==typeof v[1]){const t=parseFloat(v[1])/100,i=e.AABBBounds;n[1]=i.x1+(i.x2-i.x1)*t}else n[1]=v[1]}yl(i,i,[n[0],n[1],0]),function(t,e,i){const n=Math.sin(i),o=Math.cos(i),r=e[0],s=e[1],a=e[2],l=e[3],h=e[4],d=e[5],c=e[6],u=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*o+h*n,t[1]=s*o+d*n,t[2]=a*o+c*n,t[3]=l*o+u*n,t[4]=h*o-r*n,t[5]=d*o-s*n,t[6]=c*o-a*n,t[7]=u*o-l*n}(i,i,f),yl(i,i,[-n[0],-n[1],0]),wl(t,t,i)}}let Ml=class{constructor(t){this.creator=t,this.hooks={onAttributeUpdate:new G(["graphic"]),onSetStage:new G(["graphic","stage"]),onRemove:new G(["graphic"]),onRelease:new G(["graphic"]),onAddIncremental:new G(["graphic","group","stage"]),onClearIncremental:new G(["graphic","group","stage"]),beforeUpdateAABBBounds:new G(["graphic","stage","willUpdate","aabbBounds"]),afterUpdateAABBBounds:new G(["graphic","stage","aabbBounds","globalAABBBounds","selfChange"]),clearAABBBounds:new G(["graphic","stage","aabbBounds"])},this.tempAABBBounds1=new Fe,this.tempAABBBounds2=new Fe}onAttributeUpdate(t){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(t)}onSetStage(t,e){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(t,e)}onRemove(t){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(t)}onRelease(t){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(t)}onAddIncremental(t,e,i){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(t,e,i)}onClearIncremental(t,e){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(t,e)}beforeUpdateAABBBounds(t,e,i,n){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(t,e,i,n)}afterUpdateAABBBounds(t,e,i,n,o){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(t,e,i,n,o)}clearAABBBounds(t,e,i){this.hooks.clearAABBBounds.taps.length&&this.hooks.clearAABBBounds.call(t,e,i)}updatePathProxyAABBBounds(t,e){const i="function"==typeof e.pathProxy?e.pathProxy(e.attribute):e.pathProxy;if(!i)return!1;const n=new ii(t);return Ei(i.commandList,n,0,0),!0}updateHTMLTextAABBBounds(t,e,i,n){const{textAlign:o,textBaseline:r}=t;if(null!=t.forceBoundsHeight){const e=ft(t.forceBoundsHeight)?t.forceBoundsHeight:t.forceBoundsHeight(),n=bl(r,e,e);i.set(i.x1,n,i.x2,n+e)}if(null!=t.forceBoundsWidth){const e=ft(t.forceBoundsWidth)?t.forceBoundsWidth:t.forceBoundsWidth(),n=vl(o,e);i.set(n,i.y1,n+e,i.y2)}}combindShadowAABBBounds(t,e){if(e&&e.shadowRoot){const i=e.shadowRoot.AABBBounds;t.union(i)}}transformAABBBounds(t,e,i,n,o){if(!e.empty()){const{scaleX:o=i.scaleX,scaleY:r=i.scaleY,stroke:s=i.stroke,shadowBlur:a=i.shadowBlur,lineWidth:l=i.lineWidth,pickStrokeBuffer:h=i.pickStrokeBuffer,strokeBoundsBuffer:d=i.strokeBoundsBuffer}=t,c=this.tempAABBBounds1,u=this.tempAABBBounds2;if(s&&l){Qs(c,(l+h)/Math.abs(o+r),n,d),e.union(c),c.setValue(u.x1,u.y1,u.x2,u.y2)}if(a){const{shadowOffsetX:n=i.shadowOffsetX,shadowOffsetY:s=i.shadowOffsetY}=t;Qs(c,a/Math.abs(o+r)*2,!1,d+1),c.translate(n,s),e.union(c)}}if(this.combindShadowAABBBounds(e,o),e.empty())return;let r=!0;const s=o.transMatrix;o&&o.isContainer&&(r=!(1===s.a&&0===s.b&&0===s.c&&1===s.d&&0===s.e&&0===s.f)),r&&Oe(e,e,s)}validCheck(t,e,i,n){if(!n)return!0;if(null!=t.forceBoundsHeight||null!=t.forceBoundsWidth)return!0;if(n.shadowRoot||n.isContainer)return!0;const{visible:o=e.visible}=t;return!(!n.valid||!o)||(i.empty()||(n.parent&&i.transformWithMatrix(n.parent.globalTransMatrix),$n.graphicService.clearAABBBounds(n,n.stage,i),i.clear()),!1)}updateTempAABBBounds(t){const e=this.tempAABBBounds1,i=this.tempAABBBounds2;return e.setValue(t.x1,t.y1,t.x2,t.y2),i.setValue(t.x1,t.y1,t.x2,t.y2),{tb1:e,tb2:i}}};Ml=Bl([w(),Rl(0,y(Ca)),Tl("design:paramtypes",[Object])],Ml);const Ll=(t,e,i)=>{const{outerBorder:n,shadowBlur:o=e.shadowBlur}=t;if(n){const t=e.outerBorder,{distance:r=t.distance,lineWidth:s=t.lineWidth}=n;i.expand(r+(o+s)/2)}return i},Pl=["radius","startAngle","endAngle",...Aa];let El=class t extends La{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{radius:1}),this.type="circle",this.numberType=ha}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,radius:i}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)}getGraphicTheme(){return zo(this).circle}updateAABBBounds(t,e,i,n){this.updatePathProxyAABBBounds(i)||(n?this.updateCircleAABBBoundsImprecise(t,e,i):this.updateCircleAABBBoundsAccurate(t,e,i));const{tb1:o,tb2:r}=$n.graphicService.updateTempAABBBounds(i);return Ll(t,e,o),i.union(o),o.setValue(r.x1,r.y1,r.x2,r.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,$n.graphicService.transformAABBBounds(t,i,e,!1,this),i}updateCircleAABBBoundsImprecise(t,e,i){const{radius:n=e.radius}=t;return i.set(-n,-n,n,n),i}updateCircleAABBBoundsAccurate(t,e,i){const{startAngle:n=e.startAngle,endAngle:o=e.endAngle,radius:r=e.radius}=t;return o-n>oe-te?i.set(-r,-r,r,r):mr(n,o,r,i),i}needUpdateTags(t){return super.needUpdateTags(t,Pl)}needUpdateTag(t){return super.needUpdateTag(t,Pl)}toCustomPath(){var t,e,i;const n=this.attribute,o=null!==(t=n.radius)&&void 0!==t?t:this.getDefaultAttribute("radius"),r=null!==(e=n.startAngle)&&void 0!==e?e:this.getDefaultAttribute("startAngle"),s=null!==(i=n.endAngle)&&void 0!==i?i:this.getDefaultAttribute("endAngle"),a=new wn;return a.arc(0,0,o,r,s),a}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function Hl(t){return new El(t)}El.NOWORK_ANIMATE_ATTR=Ma;class Ol{constructor(t,e,i){this.fontFamily=t,this.textOptions=e,this.textMeasure=i}LayoutBBox(t,e,i,n){if(t.xOffset="left"===e||"start"===e?0:"center"===e?t.width/-2:"right"===e||"end"===e?-t.width:0,"top"===i)t.yOffset=0;else if("middle"===i)t.yOffset=t.height/-2;else if("alphabetic"===i){let e=.79;if(1===n.length){const t=n[0];e=t.ascent/(t.ascent+t.descent)}t.yOffset=t.height*-e}else t.yOffset=-t.height;return t}GetLayoutByLines(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",r=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;const{lineWidth:a,suffixPosition:l="end",measureMode:h=Z.actualBounding,keepCenterInLine:d=!1}=null!=s?s:{};t=t.map((t=>t.toString()));const c=[],u=[0,0];if("number"==typeof a&&a!==1/0){let e;for(let i=0,n=t.length;i<n;i++){const n=this.textMeasure.measureTextPixelADscentAndWidth(t[i],this.textOptions,h);let s=t[i].toString();if(n.width>a){const n=this.textMeasure.clipTextWithSuffix(t[i],this.textOptions,a,o,r,l);s=n.str,e=n.width}else e=n.width;c.push({str:s,width:e,ascent:n.ascent,descent:n.descent,keepCenterInLine:d})}u[0]=a}else{let e,i,n=0;for(let o=0,r=t.length;o<r;o++){i=t[o];const r=this.textMeasure.measureTextPixelADscentAndWidth(t[o],this.textOptions,h);e=r.width,n=Math.max(n,e),c.push({str:i,width:e,ascent:r.ascent,descent:r.descent,keepCenterInLine:d})}u[0]=n}u[1]=c.length*n,u[0]=c.reduce(((t,e)=>Math.max(t,e.width)),0);const g={xOffset:0,yOffset:0,width:u[0],height:u[1]};return this.LayoutBBox(g,e,i,c),this.layoutWithBBox(g,c,e,i,n)}layoutWithBBox(t,e,i,n,o){const r=[0,0],s=e.length*o;"top"===n||("middle"===n?r[1]=(t.height-s)/2:"bottom"===n&&(r[1]=t.height-s));for(let s=0;s<e.length;s++)this.lineOffset(t,e[s],i,n,o,r);return{bbox:t,lines:e,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:o,textAlign:i,textBaseline:n}}lineOffset(t,e,i,n,o,r){if("left"===i||"start"===i?e.leftOffset=0:"center"===i?e.leftOffset=(t.width-e.width)/2:"right"!==i&&"end"!==i||(e.leftOffset=t.width-e.width),e.topOffset=o/2+(e.ascent-e.descent)/2+r[1],!e.keepCenterInLine){const t=0,i=e.ascent+e.descent+t;if(i<o-t&&("bottom"===n?e.topOffset+=(o-i)/2:"top"===n&&(e.topOffset-=(o-i)/2)),"alphabetic"===n){const t=o/(e.ascent+e.descent);e.topOffset=o/2+(e.ascent-e.descent)/2*t+r[1]}}return r[1]+=o,e}}const Il=["text","maxLineWidth","maxWidth","textAlign","textBaseline","heightLimit","lineClamp","fontSize","fontFamily","fontWeight","ellipsis","lineHeight","direction","wordBreak","heightLimit","lineClamp",...Aa];let Fl=class t extends La{get font(){const t=this.getGraphicTheme();return this._font||(this._font=Le(this.attribute,t)),this._font}get clipedText(){var t;const e=this.attribute,i=this.getGraphicTheme(),n=this.getMaxWidth(i);return Number.isFinite(n)?(this.tryUpdateAABBBounds(),this.cache.clipedText):(null!==(t=e.text)&&void 0!==t?t:i.text).toString()}get clipedWidth(){return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){var t,e;const i=this.getGraphicTheme(),n=this.attribute,o=this.getMaxWidth(i);if(!Number.isFinite(o))return!1;const{text:r}=this.attribute;if(this.tryUpdateAABBBounds(),null===(e=null===(t=this.cache)||void 0===t?void 0:t.layoutData)||void 0===e?void 0:e.lines){let t="";return this.cache.layoutData.lines.forEach((e=>{t+=e.str})),(Array.isArray(r)?r.join(""):r)!==t}return"vertical"===n.direction&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map((t=>t.text)).join("")!==n.text.toString():null!=this.clipedText&&this.clipedText!==n.text.toString()}get multilineLayout(){return this.tryUpdateAABBBounds(),this.cache.layoutData}get isMultiLine(){return Array.isArray(this.attribute.text)||"normal"===this.attribute.whiteSpace}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{text:"",fontSize:16}),this.type="text",this.numberType=ma,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{text:t}=this.attribute;return ut(t)?!t.every((t=>null==t||""===t)):null!=t&&""!==t}getGraphicTheme(){return zo(this).text}doUpdateOBBBounds(){const e=this.getGraphicTheme();this._OBBBounds.clear();const i=this.attribute,{angle:n=e.angle}=i;if(!n){const t=this.AABBBounds;return this._OBBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._OBBBounds}this.obbText||(this.obbText=new t({})),this.obbText.setAttributes(Object.assign(Object.assign({},i),{angle:0}));const o=this.obbText.AABBBounds,{x:r,y:s}=i,a={x:(o.x1+o.x2)/2,y:(o.y1+o.y2)/2},l=Be(a,n,{x:r,y:s});return this._OBBBounds.copy(o),this._OBBBounds.translate(l.x-a.x,l.y-a.y),this._OBBBounds.angle=n,this._OBBBounds}updateAABBBounds(t,e,i){const{text:n=e.text}=this.attribute;Array.isArray(n)?this.updateMultilineAABBBounds(n):this.updateSingallineAABBBounds(n);const{tb1:o}=$n.graphicService.updateTempAABBBounds(i),{scaleX:r=e.scaleX,scaleY:s=e.scaleY,shadowBlur:a=e.shadowBlur,strokeBoundsBuffer:l=e.strokeBoundsBuffer}=t;if(a){Qs(o,a/Math.abs(r+s),!0,l),i.union(o)}return $n.graphicService.combindShadowAABBBounds(i,this),null==t.forceBoundsHeight&&null==t.forceBoundsWidth||$n.graphicService.updateHTMLTextAABBBounds(t,e,i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,Oe(i,i,this.transMatrix),i}updateSingallineAABBBounds(t){this.updateMultilineAABBBounds([t]);const e=this.cache.layoutData;if(e&&e.lines&&e.lines.length){const t=e.lines[0];this.cache.clipedText=t.str,this.cache.clipedWidth=t.width}return this._AABBBounds}updateMultilineAABBBounds(t){const e=this.getGraphicTheme(),{direction:i=e.direction,underlineOffset:n=e.underlineOffset}=this.attribute,o="horizontal"===i?this.updateHorizontalMultilineAABBBounds(t):this.updateVerticalMultilineAABBBounds(t);return"horizontal"===i&&n&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+n),o}guessLineHeightBuf(t){return t?.1*t:0}updateHorizontalMultilineAABBBounds(t){var e;const i=this.getGraphicTheme(),n=this.attribute,{fontFamily:o=i.fontFamily,textAlign:r=i.textAlign,textBaseline:s=i.textBaseline,fontSize:a=i.fontSize,fontWeight:l=i.fontWeight,ellipsis:h=i.ellipsis,maxLineWidth:d,stroke:c=i.stroke,wrap:u=i.wrap,measureMode:g=i.measureMode,lineWidth:p=i.lineWidth,whiteSpace:f=i.whiteSpace,suffixPosition:v=i.suffixPosition,ignoreBuf:b=i.ignoreBuf,keepCenterInLine:m=i.keepCenterInLine}=n,y=b?0:this.guessLineHeightBuf(a),C=this.getLineHeight(n,i,y);if("normal"===f||u)return this.updateWrapAABBBounds(t);if(!this.shouldUpdateShape()&&(null===(e=this.cache)||void 0===e?void 0:e.layoutData)){const t=this.cache.layoutData.bbox;return this._AABBBounds.set(t.xOffset,t.yOffset,t.xOffset+t.width,t.yOffset+t.height),c&&this._AABBBounds.expand(p/2),this._AABBBounds}const w=$n.graphicUtil.textMeasure,x=new Ol(o,{fontSize:a,fontWeight:l,fontFamily:o,lineHeight:C},w).GetLayoutByLines(t,r,s,C,!0===h?i.ellipsis:h||void 0,!1,{lineWidth:d,suffixPosition:v,measureMode:g,keepCenterInLine:m}),{bbox:_}=x;return this.cache.layoutData=x,this.clearUpdateShapeTag(),this._AABBBounds.set(_.xOffset,_.yOffset,_.xOffset+_.width,_.yOffset+_.height),c&&this._AABBBounds.expand(p/2),this._AABBBounds}updateWrapAABBBounds(t){var e,i,n;const o=this.getGraphicTheme(),{fontFamily:r=o.fontFamily,textAlign:s=o.textAlign,textBaseline:a=o.textBaseline,fontSize:l=o.fontSize,ellipsis:h=o.ellipsis,maxLineWidth:d,stroke:c=o.stroke,lineWidth:u=o.lineWidth,wordBreak:g=o.wordBreak,fontWeight:p=o.fontWeight,ignoreBuf:f=o.ignoreBuf,measureMode:v=o.measureMode,suffixPosition:b=o.suffixPosition,heightLimit:m=0,lineClamp:y,keepCenterInLine:C=o.keepCenterInLine}=this.attribute,w=f?0:this.guessLineHeightBuf(l),x=this.getLineHeight(this.attribute,o,w);if(!this.shouldUpdateShape()&&(null===(e=this.cache)||void 0===e?void 0:e.layoutData)){const t=this.cache.layoutData.bbox;return this._AABBBounds.set(t.xOffset,t.yOffset,t.xOffset+t.width,t.yOffset+t.height),c&&this._AABBBounds.expand(u/2),this._AABBBounds}const _=$n.graphicUtil.textMeasure,S={fontSize:l,fontWeight:p,fontFamily:r,lineHeight:x},A=new Ol(r,S,_),B=ut(t)?t.map((t=>t.toString())):[t.toString()],T=[],R=[0,0];let k=1/0;if(m>0&&(k=Math.max(Math.floor(m/x),1)),y&&(k=Math.min(k,y)),"number"==typeof d&&d!==1/0){if(d>0)for(let t=0;t<B.length;t++){const e=B[t];let o=!0;if(t===k-1){const i=_.clipTextWithSuffix(e,S,d,h,!1,b,t!==B.length-1),n=_.measureTextPixelADscentAndWidth(i.str,S,v);T.push({str:i.str,width:i.width,ascent:n.ascent,descent:n.descent,keepCenterInLine:C});break}const r=_.clipText(e,S,d,"break-all"!==g,"keep-all"===g);if(""!==e&&""===r.str||r.wordBreaked){if(h){const t=_.clipTextWithSuffix(e,S,d,h,!1,b);r.str=null!==(i=t.str)&&void 0!==i?i:"",r.width=null!==(n=t.width)&&void 0!==n?n:0}else r.str="",r.width=0;o=!1}const s=_.measureTextPixelADscentAndWidth(r.str,S,v);T.push({str:r.str,width:r.width,ascent:s.ascent,descent:s.descent,keepCenterInLine:C});let a=r.str.length;if(!r.wordBreaked||""!==e&&""===r.str||(o=!0,a=r.wordBreaked),r.str.length===e.length);else if(o){let i=e.substring(a);"keep-all"===g&&(i=i.replace(/^\s+/g,"")),B.splice(t+1,0,i)}}let t=0;T.forEach((e=>{t=Math.max(t,e.width)})),R[0]=t}else{let t,e,i=0;for(let n=0,o=B.length;n<o;n++){if(n===k-1){const t=_.clipTextWithSuffix(B[n],S,d,h,!1,b),e=_.measureTextPixelADscentAndWidth(t.str,S,v);T.push({str:t.str,width:t.width,ascent:e.ascent,descent:e.descent,keepCenterInLine:C}),i=Math.max(i,t.width);break}e=B[n],t=_.measureTextWidth(e,S),i=Math.max(i,t);const o=_.measureTextPixelADscentAndWidth(e,S,v);T.push({str:e,width:t,ascent:o.ascent,descent:o.descent,keepCenterInLine:C})}R[0]=i}R[1]=T.length*x;const M={xOffset:0,yOffset:0,width:R[0],height:R[1]};A.LayoutBBox(M,s,a,T);const L=A.layoutWithBBox(M,T,s,a,x);return this.cache.layoutData=L,this.clearUpdateShapeTag(),this._AABBBounds.set(M.xOffset,M.yOffset,M.xOffset+M.width,M.yOffset+M.height),c&&this._AABBBounds.expand(u/2),this._AABBBounds}updateVerticalMultilineAABBBounds(e){var i,n;const o=this.getGraphicTheme(),r=$n.graphicUtil.textMeasure;let s;const a=this.attribute,{maxLineWidth:l=o.maxLineWidth,ellipsis:h=o.ellipsis,fontFamily:d=o.fontFamily,fontSize:c=o.fontSize,fontWeight:u=o.fontWeight,stroke:g=o.stroke,lineWidth:p=o.lineWidth,verticalMode:f=o.verticalMode,suffixPosition:v=o.suffixPosition}=a,b=this.getLineHeight(a,o,0);let{textAlign:m=o.textAlign,textBaseline:y=o.textBaseline}=a;if(!f){const e=m;m=null!==(i=t.baselineMapAlign[y])&&void 0!==i?i:"left",y=null!==(n=t.alignMapBaseline[e])&&void 0!==n?n:"top"}if(s=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach((t=>{const e=t.reduce(((t,e)=>t+e.width),0);s=le(e,s)}));const t=vl(m,s),e=this.cache.verticalList.length*b,i=bl(y,e,c);return this._AABBBounds.set(i,t,i+e,t+s),g&&this._AABBBounds.expand(p/2),this._AABBBounds}const C=e.map((t=>function(t){const e=[];let i=0,n="";for(let o=0;o<t.length;o++)ra(t[o])?i?n+=t[o]:(i=1,n=t[o]):(i&&(e.push({text:n,direction:ia.VERTICAL}),n="",i=0),e.push({text:t[o],direction:ia.HORIZONTAL}));return n&&e.push({text:n,direction:ia.VERTICAL}),e}(t.toString())));C.forEach(((t,e)=>{if(Number.isFinite(l))if(h){const i=!0===h?o.ellipsis:h,n=r.clipTextWithSuffixVertical(t,{fontSize:c,fontWeight:u,fontFamily:d},l,i,!1,v);C[e]=n.verticalList,s=n.width}else{const i=r.clipTextVertical(t,{fontSize:c,fontWeight:u,fontFamily:d},l,!1);C[e]=i.verticalList,s=i.width}else s=0,t.forEach((t=>{const e=t.direction===ia.HORIZONTAL?c:r.measureTextWidth(t.text,{fontSize:c,fontWeight:u,fontFamily:d});s+=e,t.width=e}))})),this.cache.verticalList=C,this.clearUpdateShapeTag(),this.cache.verticalList.forEach((t=>{const e=t.reduce(((t,e)=>t+e.width),0);s=le(e,s)}));const w=vl(m,s),x=this.cache.verticalList.length*b,_=bl(y,x,c);return this._AABBBounds.set(_,w,_+x,w+s),g&&this._AABBBounds.expand(p/2),this._AABBBounds}getMaxWidth(t){var e,i;const n=this.attribute;return null!==(i=null!==(e=n.maxLineWidth)&&void 0!==e?e:n.maxWidth)&&void 0!==i?i:t.maxWidth}getLineHeight(t,e,i){var n;return null!==(n=Sr(t.lineHeight,t.fontSize||e.fontSize))&&void 0!==n?n:(t.fontSize||e.fontSize)+i}needUpdateTags(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Il;return super.needUpdateTags(t,e)}needUpdateTag(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Il;return super.needUpdateTag(t,e)}_interpolate(t,e,i,n,o){"text"===t&&(o.text=n)}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}getBaselineMapAlign(){return t.baselineMapAlign}getAlignMapBaseline(){return t.alignMapBaseline}};function zl(t){return new Fl(t)}Fl.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},Ma),Fl.baselineMapAlign={top:"left",bottom:"right",middle:"center"},Fl.alignMapBaseline={left:"top",right:"bottom",center:"middle"};const Dl=["heightLimit","lineClamp"];class Wl extends Fl{constructor(t){super(Object.assign(Object.assign({},t),{wrap:!0}))}_isValid(){const{text:t}=this.attribute;return ut(t)?!t.every((t=>null==t||""===t)):null!=t&&""!==t}updateMultilineAABBBounds(t){var e,i,n,o;const r=this.getGraphicTheme(),{fontFamily:s=r.fontFamily,textAlign:a=r.textAlign,textBaseline:l=r.textBaseline,fontSize:h=r.fontSize,ellipsis:d=r.ellipsis,maxLineWidth:c,stroke:u=r.stroke,lineWidth:g=r.lineWidth,wordBreak:p=r.wordBreak,fontWeight:f=r.fontWeight,ignoreBuf:v=r.ignoreBuf,heightLimit:b=0,suffixPosition:m=r.suffixPosition,lineClamp:y}=this.attribute,C=null!==(e=Sr(this.attribute.lineHeight,this.attribute.fontSize||r.fontSize))&&void 0!==e?e:this.attribute.fontSize||r.fontSize,w=v?0:2;if(!this.shouldUpdateShape()&&(null===(i=this.cache)||void 0===i?void 0:i.layoutData)){const t=this.cache.layoutData.bbox;return this._AABBBounds.set(t.xOffset,t.yOffset,t.xOffset+t.width,t.yOffset+t.height),u&&this._AABBBounds.expand(g/2),this._AABBBounds}const x=$n.graphicUtil.textMeasure,_=new Ol(s,{fontSize:h,fontWeight:f,fontFamily:s},x),S=t.map((t=>t.toString())),A=[],B=[0,0];let T=1/0;if(b>0&&(T=Math.max(Math.floor(b/C),1)),y&&(T=Math.min(T,y)),"number"==typeof c&&c!==1/0){if(c>0)for(let t=0;t<S.length;t++){const e=S[t];let i=!0;if(t===T-1){const t=_.textMeasure.clipTextWithSuffix(e,_.textOptions,c,d,!1,m);A.push({str:t.str,width:t.width,ascent:0,descent:0,keepCenterInLine:!1});break}const r=_.textMeasure.clipText(e,_.textOptions,c,"break-word"===p);if(""!==e&&""===r.str){if(d){const t=_.textMeasure.clipTextWithSuffix(e,_.textOptions,c,d,!1,m);r.str=null!==(n=t.str)&&void 0!==n?n:"",r.width=null!==(o=t.width)&&void 0!==o?o:0}else r.str="",r.width=0;i=!1}if(A.push({str:r.str,width:r.width,ascent:0,descent:0,keepCenterInLine:!1}),r.str.length===e.length);else if(i){const i=e.substring(r.str.length);S.splice(t+1,0,i)}}let t=0;A.forEach((e=>{t=Math.max(t,e.width)})),B[0]=t}else{let t,e,i=0;for(let n=0,o=S.length;n<o;n++){if(n===T-1){const t=_.textMeasure.clipTextWithSuffix(S[n],_.textOptions,c,d,!1,m);A.push({str:t.str,width:t.width,ascent:0,descent:0,keepCenterInLine:!1}),i=Math.max(i,t.width);break}e=S[n],t=_.textMeasure.measureTextWidth(e,_.textOptions,"break-word"===p),i=Math.max(i,t),A.push({str:e,width:t,ascent:0,descent:0,keepCenterInLine:!1})}B[0]=i}B[1]=A.length*(C+w);const R={xOffset:0,yOffset:0,width:B[0],height:B[1]};_.LayoutBBox(R,a,l);const k=_.layoutWithBBox(R,A,a,l,C);return this.cache.layoutData=k,this.clearUpdateShapeTag(),this._AABBBounds.set(R.xOffset,R.yOffset,R.xOffset+R.width,R.yOffset+R.height),u&&this._AABBBounds.expand(g/2),this._AABBBounds}needUpdateTags(t){for(let e=0;e<Dl.length;e++){const i=Dl[e];if(-1!==t.indexOf(i))return!0}return super.needUpdateTags(t)}needUpdateTag(t){for(let e=0;e<Dl.length;e++)if(t===Dl[e])return!0;return super.needUpdateTag(t)}getNoWorkAnimateAttr(){return Wl.NOWORK_ANIMATE_ATTR}}function Nl(t){return new Wl(t)}const Gl=["symbolType","size",...Aa];let jl=class t extends La{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{symbolType:"circle"}),this.type="symbol",this.numberType=ba}getParsedPath(){return this.shouldUpdateShape()&&(this._parsedPath=this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}getParsedPath2D(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=null;try{n=new Path2D}catch(t){return null}const o=this.getParsedPath();if(!o)return null;o.draw(n,i,t,e)}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{size:t}=this.attribute;return ut(t)?2===t.length&&t.every(this._validNumber):this._validNumber(t)}doUpdateParsedPath(){const{symbolType:t="circle"}=this.attribute;return super.parsePath(t)}getGraphicTheme(){return zo(this).symbol}updateAABBBounds(t,e,i,n){this.updatePathProxyAABBBounds(i)||(n?this.updateSymbolAABBBoundsImprecise(t,e,i):this.updateSymbolAABBBoundsAccurate(t,e,i));const{tb1:o,tb2:r}=$n.graphicService.updateTempAABBBounds(i);((t,e,i)=>{const{outerBorder:n,shadowBlur:o=e.shadowBlur,strokeBoundsBuffer:r=e.strokeBoundsBuffer}=t;if(n){const t=e.outerBorder,{distance:s=t.distance,lineWidth:a=t.lineWidth}=n;Qs(i,s+(o+a)/2,!0,r)}})(t,e,o),i.union(o),o.setValue(r.x1,r.y1,r.x2,r.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,this.x1WithoutTransform=i.x1,this.y1WithoutTransform=i.y1;const{lineJoin:s=e.lineJoin}=t;return $n.graphicService.transformAABBBounds(t,i,e,"miter"===s,this),i}updateSymbolAABBBoundsImprecise(t,e,i){const{size:n=e.size}=t;if(ut(n))i.set(-n[0]/2,-n[1]/2,n[0]/2,n[1]/2);else{const t=n/2;i.set(-t,-t,t,t)}return i}updateSymbolAABBBoundsAccurate(t,e,i){const{size:n=e.size}=t;return this.getParsedPath().bounds(n,i),i}needUpdateTags(t){return super.needUpdateTags(t,Gl)}needUpdateTag(t){return super.needUpdateTag(t,Gl)}toCustomPath(){const t=this.getParsedPath(),e=this.attribute.size,i=ut(e)?e:[e,e];return t.path?(new wn).fromCustomPath2D(t.path,0,0,i[0],i[1]):(new wn).fromString(t.pathStr,0,0,i[0],i[1])}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function Vl(t){return new jl(t)}jl.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},Ma);const Ul=["segments","points","curveType","curveTension",...Aa];let Xl=class t extends La{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.type="line",this.numberType=ua}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?0!==e.length:!(!t||t.length<=1)}_interpolate(t,e,i,n,o){"points"===t&&(o.points=Cr(i,n,e))}getGraphicTheme(){return zo(this).line}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateLineAABBBoundsBySegments(t,e,i):this.updateLineAABBBoundsByPoints(t,e,i)),$n.graphicService.updateTempAABBBounds(i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:n=e.lineJoin}=t;return $n.graphicService.transformAABBBounds(t,i,e,"miter"===n,this),i}updateLineAABBBoundsByPoints(t,e,i,n){const{points:o=e.points,connectedType:r}=t,s=i;return o.forEach((t=>{!1===t.defined&&"connect"!==r||s.add(t.x,t.y)})),s}updateLineAABBBoundsBySegments(t,e,i,n){const{segments:o=e.segments,connectedType:r}=t,s=i;return o.forEach((t=>{t.points.forEach((t=>{!1===t.defined&&"connect"!==r||s.add(t.x,t.y)}))})),s}needUpdateTags(t){return super.needUpdateTags(t,Ul)}needUpdateTag(t){return super.needUpdateTag(t,Ul)}toCustomPath(){const t=this.attribute,e=new wn,i=t.segments,n=t=>{if(t&&t.length){let i=!0;t.forEach((t=>{!1!==t.defined&&(i?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y),i=!1)}))}};return i&&i.length?i.forEach((t=>{n(t.points)})):t.points&&n(t.points),e}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function $l(t){return new Xl(t)}Xl.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},Ma);const Yl=["width","x1","y1","height","cornerRadius",...Aa];let Kl=class t extends La{constructor(t){super(t),this.type="rect",this.numberType=fa}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}getGraphicTheme(){return zo(this).rect}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){let{width:e,height:n}=t;const{x1:o,y1:r,x:s,y:a}=t;e=null!=e?e:o-s,n=null!=n?n:r-a,(isFinite(e)||isFinite(n)||isFinite(s)||isFinite(a))&&i.set(0,0,e||0,n||0)}const{tb1:n,tb2:o}=$n.graphicService.updateTempAABBBounds(i);return Ll(t,e,n),i.union(n),n.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,$n.graphicService.transformAABBBounds(t,i,e,!1,this),i}needUpdateTags(t){return super.needUpdateTags(t,Yl)}needUpdateTag(t){return super.needUpdateTag(t,Yl)}toCustomPath(){const t=this.attribute,{x:e,y:i,width:n,height:o}=(t=>{if(!t)return{x:0,y:0,width:0,height:0};let e=rt(t.width)?t.x1-t.x:t.width,i=rt(t.height)?t.y1-t.y:t.height,n=0,o=0;return e<0?(n=e,e=-e):Number.isNaN(e)&&(e=0),i<0?(o=i,i=-i):Number.isNaN(i)&&(i=0),{x:n,y:o,width:e,height:i}})(t),r=new wn;return r.moveTo(e,i),r.rect(e,i,n,o),r}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function ql(t){return new Kl(t)}Kl.NOWORK_ANIMATE_ATTR=Ma;class Zl{constructor(t,e,i,n,o,r,s,a,l,h,d,c,u,g){this.left=t,this.top=e,this.width=i,this.height=n,this.actualHeight=0,this.bottom=e+n,this.right=t+i,this.ellipsis=o,this.wordBreak=r,this.verticalDirection=s,this.lines=[],this.globalAlign=a,this.globalBaseline=l,this.layoutDirection=h,this.directionKey=Jn[this.layoutDirection],this.isWidthMax=d,this.isHeightMax=c,this.singleLine=u,g?(g.clear(),this.icons=g):this.icons=new Map}draw(t,e){const{width:i,height:n}=this.getActualSize(),o=this.isWidthMax?Math.min(this.width,i):this.width||i||0;let r=this.isHeightMax?Math.min(this.height,n):this.height||n||0;r=Math.min(r,n);let s=0;switch(this.globalBaseline){case"top":s=0;break;case"middle":s=-r/2;break;case"bottom":s=-r}let a=0;"right"===this.globalAlign||"end"===this.globalAlign?a=-o:"center"===this.globalAlign&&(a=-o/2);let l=this[this.directionKey.height];this.singleLine&&(l=this.lines[0].height+1);let h=!1;if("middle"===this.verticalDirection)if(this.actualHeight>=l&&0!==l)for(let i=0;i<this.lines.length;i++){const{top:n,height:o}=this.lines[i];if(n+o<this[this.directionKey.top]||n+o>this[this.directionKey.top]+l)return h;let r=!1;this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+l&&(r=!0,h=!0),this.lines[i].draw(t,r,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,this.ellipsis,e)}else{const i=Math.floor((l-this.actualHeight)/2);"vertical"===this.layoutDirection?a+=i:s+=i;for(let i=0;i<this.lines.length;i++)this.lines[i].draw(t,!1,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,this.ellipsis,e)}else if("bottom"===this.verticalDirection&&"vertical"!==this.layoutDirection)for(let i=0;i<this.lines.length;i++){const{top:n,height:o}=this.lines[i],r=l-this.lines[i].top-this.lines[i].height;if(0===l)this.lines[i].draw(t,!1,a,r+s,this.ellipsis,e);else{if(r+o>this[this.directionKey.top]+l||r<this[this.directionKey.top])return h;{let n=!1;this.ellipsis&&this.lines[i+1]&&r-this.lines[i+1].height<this[this.directionKey.top]&&(n=!0,h=!0),this.lines[i].draw(t,n,a,r+s,this.ellipsis,e)}}}else{"bottom"===this.verticalDirection&&"vertical"===this.layoutDirection&&this.singleLine&&this.isWidthMax&&(a+=this.lines[0].height+1);for(let i=0;i<this.lines.length;i++){"bottom"===this.verticalDirection&&"vertical"===this.layoutDirection&&(a-=this.lines[i].height+this.lines[i].top);const{top:n,height:o}=this.lines[i];if(0===l)this.lines[i].draw(t,!1,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,this.ellipsis,e);else{if(n+o<this[this.directionKey.top]||n+o>this[this.directionKey.top]+l)return h;{let n=!1;this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+l&&(n=!0,h=!0),this.lines[i].draw(t,n,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,this.ellipsis,e)}}}}return h}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let t=0,e=0;for(let i=0;i<this.lines.length;i++){const n=this.lines[i];n.actualWidth>t&&(t=n.actualWidth),e+=n.height}return{width:"vertical"===this.layoutDirection?e:t,height:"vertical"===this.layoutDirection?t:e}}getActualSizeWidthEllipsis(){let t=0,e=0;const{width:i,height:n}=this.getRawActualSize();this.width,this.height;let o=this[this.directionKey.height];if(this.singleLine&&(o=this.lines[0].height+1),"middle"===this.verticalDirection)if(this.actualHeight>=o&&0!==o)for(let i=0;i<this.lines.length;i++){const{top:n,height:r}=this.lines[i];if(n+r<this[this.directionKey.top]||n+r>this[this.directionKey.top]+o);else if(this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+o){const n=!0===this.ellipsis?"...":this.ellipsis||"",o=this.lines[i].getWidthWithEllips(n);o>t&&(t=o),e+=this.lines[i].height}else this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}else{Math.floor((o-this.actualHeight)/2);for(let i=0;i<this.lines.length;i++)this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}else if("bottom"===this.verticalDirection)for(let i=0;i<this.lines.length;i++){const{top:n,height:r}=this.lines[i],s=o-this.lines[i].top-this.lines[i].height;if(0===o)this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height;else if(s+r>this[this.directionKey.top]+o||s<this[this.directionKey.top]);else if(this.ellipsis&&this.lines[i+1]&&s-this.lines[i+1].height<this[this.directionKey.top]){const n=!0===this.ellipsis?"...":this.ellipsis||"",o=this.lines[i].getWidthWithEllips(n);o>t&&(t=o),e+=this.lines[i].height}else this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}else for(let i=0;i<this.lines.length;i++){const{top:n,height:r}=this.lines[i];if(0===o)this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height;else if(n+r<this[this.directionKey.top]||n+r>this[this.directionKey.top]+o);else if(this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+o){const n=!0===this.ellipsis?"...":this.ellipsis||"",o=this.lines[i].getWidthWithEllips(n);o>t&&(t=o),e+=this.lines[i].height}else this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}return{width:"vertical"===this.layoutDirection?e:t,height:"vertical"===this.layoutDirection?t:e}}}function Jl(t,e,i,n){const o=Math.round(t),r=Math.round(i),s=Math.round(e),a=Math.round(n);return{left:t>o?o:o-.5,top:i>r?r:r-.5,right:s>e?s:s+.5,bottom:a>n?a:a+.5}}class Ql{constructor(t,e,i,n){var o,r;this.fontSize=i.fontSize||16,this.textBaseline=i.textBaseline||"alphabetic",this.ascentDescentMode=n;const s=Sr(i.lineHeight,this.fontSize);this.lineHeight="number"==typeof s?s>this.fontSize?s:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;const{ascent:a,height:l,descent:h,width:d}=lo(t,i,this.ascentDescentMode);let c=0,u=0,g=0;this.height>l&&(c=(this.height-l)/2,u=Math.ceil(c),g=Math.floor(c)),"top"===this.textBaseline?(this.ascent=c,this.descent=l-c):"bottom"===this.textBaseline?(this.ascent=l-c,this.descent=c):"middle"===this.textBaseline?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=a+u,this.descent=h+g),this.length=t.length,this.width=d||0,this.text=t||"",this.newLine=e||!1,this.character=i,this.left=0,this.top=0,this.ellipsis="normal",this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,this.space=i.space,this.dx=null!==(o=i.dx)&&void 0!==o?o:0,this.dy=null!==(r=i.dy)&&void 0!==r?r:0,"vertical"===i.direction&&(this.direction=i.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height),this.ellipsisStr="..."}updateWidth(){const{width:t}=lo(this.text,this.character,this.ascentDescentMode);this.width=t,"vertical"===this.direction&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}drawBackground(t,e,i,n,o,r,s){if(""===this.text||"\n"===this.text||!this.character.background||this.character.backgroundOpacity&&!(this.character.backgroundOpacity>0))return;let a=e+i,l=this.text,h=this.left+n;a+=this.top;let d=this.direction;if(this.verticalEllipsis)l=this.ellipsisStr,d="vertical",a-=this.ellipsisWidth/2;else{if("hide"===this.ellipsis)return;if("add"===this.ellipsis)l+=this.ellipsisStr,"right"!==r&&"end"!==r||(h-=this.ellipsisWidth);else if("replace"===this.ellipsis){const t=ro(l,("vertical"===d?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,l.length-1);if(l=l.slice(0,t),l+=this.ellipsisStr,"right"===r||"end"===r)if("vertical"===d);else{const{width:e}=lo(this.text.slice(t),this.character,this.ascentDescentMode);h-=this.ellipsisWidth-e}}}const c=Jl(h,h+(this.widthOrigin||this.width),e,e+s);return Object.assign(Object.assign({},c),{fillStyle:this.character.background,globalAlpha:this.character.backgroundOpacity})}draw(t,e,i,n,o,r,s){var a;let l=e+i,h=this.text,d=this.left+n+(null!==(a=this.space)&&void 0!==a?a:0)/2;l+=this.top;let c=this.direction;if(this.verticalEllipsis)h=this.ellipsisStr,c="vertical",l-=this.ellipsisWidth/2;else{if("hide"===this.ellipsis)return;if("add"===this.ellipsis)h+=this.ellipsisStr,"right"!==r&&"end"!==r||(d-=this.ellipsisWidth);else if("replace"===this.ellipsis){const t=ro(h,("vertical"===c?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,h.length-1);if(h=h.slice(0,t),h+=this.ellipsisStr,"right"===r||"end"===r)if("vertical"===c);else{const{width:e}=lo(this.text.slice(t),this.character,this.ascentDescentMode);d-=this.ellipsisWidth-e}}}switch(this.character.script){case"super":l-=this.ascent*(1/3);break;case"sub":l+=this.descent/2}"vertical"===c&&(t.save(),t.rotateAbout(Math.PI/2,d,l),t.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),t.translate(d,l),d=0,l=0);const{lineWidth:u=1}=this.character;if(this.character.stroke&&u&&t.strokeText(h,d,l+this.dy),this.character.fill&&t.fillText(h,d,l+this.dy),this.character.fill)if(this.character.lineThrough||this.character.underline){if(this.character.underline){const e=1+l,i=Jl(d,d+(this.widthOrigin||this.width),e,e+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(i.left,1+l,i.right-i.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}if(this.character.lineThrough){const e=1+l-this.ascent/2,i=Jl(d,d+(this.widthOrigin||this.width),e,e+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(i.left,1+l-this.ascent/2,i.right-i.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}else if("underline"===this.character.textDecoration){const e=1+l,i=Jl(d,d+(this.widthOrigin||this.width),e,e+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(i.left,1+l,i.right-i.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}else if("line-through"===this.character.textDecoration){const e=1+l-this.ascent/2,i=Jl(d,d+(this.widthOrigin||this.width),e,e+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(i.left,1+l-this.ascent/2,i.right-i.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}"vertical"===c&&t.restore()}getWidthWithEllips(t){let e=this.text;const i="vertical"===t?this.height:this.width;if("hide"===this.ellipsis)return i;if("add"===this.ellipsis)return i+this.ellipsisWidth;if("replace"===this.ellipsis){const t=ro(e,i-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,e.length-1);e=e.slice(0,t),e+=this.ellipsisStr;const{width:n}=lo(this.text.slice(t),this.character,this.ascentDescentMode);return i+this.ellipsisWidth-n}return i}}const th=["width","height","image",...Aa];let eh=class t extends La{constructor(t){super(t),this.type="image",this.numberType=ca,this.loadImage(this.attribute.image)}getImageElement(){const{image:t}=this.attribute;if(!t||!this.resources)return null;const e=this.resources.get(t);return"success"!==e.state?null:e.data}get width(){return this.tryUpdateAABBBounds(),this._actualWidth}get height(){return this.tryUpdateAABBBounds(),this._actualHeight}get repeatX(){var t;return null!==(t=this.attribute.repeatX)&&void 0!==t?t:"no-repeat"}set repeatX(t){this.attribute.repeatX===t&&(this.attribute.repeatX=t)}get repeatY(){var t;return null!==(t=this.attribute.repeatY)&&void 0!==t?t:"no-repeat"}set repeatY(t){this.attribute.repeatY===t&&(this.attribute.repeatY=t)}get image(){return this.attribute.image}set image(t){t!==this.attribute.image&&(this.attribute.image=t,this.loadImage(this.attribute.image))}imageLoadSuccess(t,e,i){super.imageLoadSuccess(t,e,(()=>{this.successCallback&&this.successCallback()})),this.addUpdateBoundTag()}imageLoadFail(t,e){super.imageLoadFail(t,(()=>{this.failCallback&&this.failCallback()}))}setAttributes(t,e,i){return t.image&&this.loadImage(t.image),super.setAttributes(t,e,i)}setAttribute(t,e,i,n){return"image"===t&&this.loadImage(e),super.setAttribute(t,e,i,n)}getGraphicTheme(){return zo(this).image}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const{maxWidth:n=e.maxWidth,maxHeight:o=e.maxHeight}=t;let{width:r,height:s}=t;if(null==r||null==s){const t=this.getImageElement();if(t){const e=t.width,i=t.height;if(null!=r)s=r*(i/e);else if(null!=s)r=s*(e/i);else{const t=e/i;t>n/o?(r=n,s=n/t):(s=o,r=o*t)}}else r=n,s=o}this._actualWidth=r,this._actualHeight=s,i.set(0,0,r,s)}const{tb1:n,tb2:o}=$n.graphicService.updateTempAABBBounds(i);return Ll(t,e,n),i.union(n),n.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,$n.graphicService.transformAABBBounds(t,i,e,!1,this),i}getDefaultAttribute(t){return Un[t]}needUpdateTags(t){return super.needUpdateTags(t,th)}needUpdateTag(t){return super.needUpdateTag(t,th)}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function ih(t){return new eh(t)}eh.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},Ma);class nh extends eh{constructor(t){if(super(t),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],"always"===t.backgroundShowMode&&(this._hovered=!0),t.margin){const e=fr(t.margin);this._marginArray="number"==typeof e?[e,e,e,e]:e}this.onBeforeAttributeUpdate=(t,e,i)=>{if(ut(i)&&-1!==i.indexOf("margin")||"margin"===i)if(e.margin){const t=fr(e.margin);this._marginArray="number"==typeof t?[t,t,t,t]:t}else this._marginArray=[0,0,0,0]}}get width(){var t;return(null!==(t=this.attribute.width)&&void 0!==t?t:0)+this._marginArray[1]+this._marginArray[3]}get height(){var t;return(null!==(t=this.attribute.height)&&void 0!==t?t:0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();const{width:t=Un.width,height:e=Un.height}=this.attribute,{backgroundWidth:i=t,backgroundHeight:n=e}=this.attribute,o=(i-t)/2,r=(n-e)/2;return this._AABBBounds.expand([0,2*o,2*r,0]),this._AABBBounds}setHoverState(t){"hover"===this.attribute.backgroundShowMode&&this._hovered!==t&&(this._hovered=t)}}class oh{constructor(t,e,i,n,o,r,s,a){this.left=t,this.width=e,this.baseline=i,this.ascent=n,this.descent=o,this.top=i-n,this.paragraphs=r.map((t=>t)),this.textAlign=(this.paragraphs[0]instanceof nh?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||"left",this.direction=s,this.directionKey=Jn[this.direction],this.actualWidth=0;let l=0;this.paragraphs.forEach(((t,e)=>{if(0===e&&t instanceof Ql){const e=no.exec(t.text);0!==(null==e?void 0:e.index)&&(t.text=t.text.slice(null==e?void 0:e.index),t.updateWidth())}this.actualWidth+=t[this.directionKey.width],l=Math.max(t[this.directionKey.height],l)})),this.height=l,this.blankWidth=a?0:this.width-this.actualWidth,this.calcOffset(e,a)}calcOffset(t,e){const i=this.directionKey,n=this.height;let o=this.left,r=0;this.actualWidth<t&&!e&&("right"===this.textAlign||"end"===this.textAlign?o=t-this.actualWidth:"center"===this.textAlign?o=(t-this.actualWidth)/2:"justify"===this.textAlign&&(this.paragraphs.length<2?o=(t-this.actualWidth)/2:r=(t-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map((function(t){t instanceof nh?(t["_"+i.x]=o,o+=t[i.width]+r,t["_"+i.y]="top"===t.attribute.textBaseline?0:"bottom"===t.attribute.textBaseline?n-t.height:(n-t.height)/2):(t[i.left]=o,o+=t[i.width]+r)}))}draw(t,e,i,n,o,r){if(o&&(e||this.paragraphs.some((t=>t.overflow)))){let t=!0,i=!1;for(let e=this.paragraphs.length-1;e>=0;e--){const n=this.paragraphs[e];if(n.overflow)t=t&&""===n.text;else if(t){i=!0;break}}let n=0;if(!i)for(let t=this.paragraphs.length-1;t>=0;t--){const i=this.paragraphs[t];if(i.overflow){if(""===i.text)break;continue}if(i instanceof nh)break;if("vertical"===this.direction&&"vertical"!==i.direction){i.verticalEllipsis=!0;break}const r=!0===o?"...":o||"";i.ellipsisStr=r;const{width:s}=lo(r,i.character,i.ascentDescentMode),a=s||0;if(a<=this.blankWidth+n){e&&(i.ellipsis="add");break}if(a<=this.blankWidth+n+i.width){i.ellipsis="replace",i.ellipsisWidth=a,i.ellipsisOtherParagraphWidth=this.blankWidth+n;break}i.ellipsis="hide",n+=i.width}}let s="",a=-1,l=[];const h=[l];this.paragraphs.forEach(((e,o)=>{if(e instanceof nh)return;const r=e.drawBackground(t,n,this.ascent,i,0===o,this.textAlign,this.height);r&&(s===r.fillStyle&&a===r.globalAlpha||(l=[],h.push(l),s=r.fillStyle,a=r.globalAlpha),l.push(r))})),h.forEach((e=>{if(0===e.length)return;const i=e[0],n=e[e.length-1];t.fillStyle=i.fillStyle,t.globalAlpha=i.globalAlpha,t.fillRect(i.left,i.top,n.right-i.left,n.bottom-i.top)})),this.paragraphs.forEach(((e,o)=>{if(e instanceof nh)return e.setAttributes({x:i+e._x,y:n+e._y}),void r(e,t,i+e._x,n+e._y,this.ascent);const s={x1:this.left,y1:this.top,x2:this.left+this.actualWidth,y2:this.top+this.height};(function(t,e){const i=e&&e.stroke||to;if(!i)return void(t.globalAlpha=0);const{strokeOpacity:n=1,opacity:o=1}=e;t.globalAlpha=n*o,t.lineWidth=e&&"number"==typeof e.lineWidth?e.lineWidth:1,t.strokeStyle=i,oo(t,e)})(t,e.character),function(t,e,i){const n=e&&e.fill||Qn;if(!n)return void(t.globalAlpha=0);const{fillOpacity:o=1,opacity:r=1}=e;t.globalAlpha=o*r,t.fillStyle=i?Zn(t,n,{AABBBounds:i}):n,oo(t,e)}(t,e.character,s),e.draw(t,n,this.ascent,i,0===o,this.textAlign,this.height)}))}getWidthWithEllips(t){let e=0;for(let i=this.paragraphs.length-1;i>=0;i--){const n=this.paragraphs[i];if(n instanceof nh)break;const{width:o}=lo(t,n.character,n.ascentDescentMode),r=o||0;if(r<=this.blankWidth+e){n.ellipsis="add",n.ellipsisWidth=r;break}if(r<=this.blankWidth+e+n.width){n.ellipsis="replace",n.ellipsisWidth=r,n.ellipsisOtherParagraphWidth=this.blankWidth+e;break}n.ellipsis="hide",e+=n.width}let i=0;return this.paragraphs.forEach(((t,e)=>{i+=t instanceof nh?t.width:t.getWidthWithEllips(this.direction)})),i}}class rh{constructor(t){this.frame=t,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=t.layoutDirection,this.directionKey=Jn[this.direction]}store(t){if(t instanceof nh){this.frame.icons.set(t.richtextId,t),this.lineBuffer.push(t),this.lineWidth+=t[this.directionKey.width];let e=0,i=0;"top"===t.attribute.textBaseline?(e=0,i=t.height):"bottom"===t.attribute.textBaseline?(e=t.height,i=0):(e=t.height/2,i=t.height/2),this.maxAscent=Math.max(this.maxAscent,e),this.maxDescent=Math.max(this.maxDescent,i)}else this.lineBuffer.push(t),0!==t.text.length?(this.lineWidth+=t[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,t.ascent),this.maxDescent=Math.max(this.maxDescent,t.descent)):(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,t.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,t.descent))}send(){if(0===this.lineBuffer.length)return;const t=0===this.maxAscent?this.maxAscentForBlank:this.maxAscent,e=0===this.maxDescent?this.maxDescentForBlank:this.maxDescent,i=new oh(this.frame.left,this[this.directionKey.width],this.y+t,t,e,this.lineBuffer,this.direction,"horizontal"===this.direction?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(i),this.frame.actualHeight+=i.height,this.y+=i.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t instanceof nh?"horizontal"===this.direction&&0===this.width||"vertical"===this.direction&&0===this.height||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):0===this.lineBuffer.length?(this.store(t),this.send()):(this.send(),this.deal(t)):"number"!=typeof this.width||this.width<0||(t.newLine&&this.send(),(0!==t.text.length||this.newLine)&&("horizontal"===this.direction&&0===this.width||"vertical"===this.direction&&0===this.height||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(t)):this.cut(t,e)))}cut(t,e){const i=this[this.directionKey.width]-this.lineWidth||0,n=Math.ceil(i/t[this.directionKey.width]*t.length)||0,o=ro(t.text,i,t.character,n,"break-word"===this.frame.wordBreak);if(0!==o){const[i,n]=function(t,e){const i=t.text.slice(0,e),n=t.text.slice(e);return[new Ql(i,t.newLine,t.character,t.ascentDescentMode),new Ql(n,!0,t.character,t.ascentDescentMode)]}(t,o);this.store(i),e?this.send():this.deal(n)}else 0!==this.lineBuffer.length&&(this.send(),this.deal(t))}}let sh=!1;try{sh=Intl&&"function"==typeof Intl.Segmenter}catch(t){sh=!1}const ah=["width","height","ellipsis","wordBreak","verticalDirection","maxHeight","maxWidth","textAlign","textBaseline","textConfig","layoutDirection","fill","stroke","fontSize","fontFamily","fontStyle","fontWeight","lineWidth","opacity","fillOpacity","strokeOpacity",...Aa];class lh extends La{constructor(t){super(t),this.type="richtext",this._currentHoverIcon=null,this.numberType=va,this.onBeforeAttributeUpdate=(t,e,i)=>{for(const i in t)if("hoverIconId"===i){if(t[i]===e[i])continue;const n=this._frameCache.icons.get(t[i]);this.updateHoverIconState(n)}}}get width(){var t;return null!==(t=this.attribute.width)&&void 0!==t?t:Vn.width}set width(t){this.attribute.width!==t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return null!==(t=this.attribute.height)&&void 0!==t?t:Vn.height}set height(t){this.attribute.height!==t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(t){this.attribute.maxWidth!==t&&(this.attribute.maxWidth=t,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(t){this.attribute.maxHeight!==t&&(this.attribute.maxHeight=t,this.addUpdateShapeAndBoundsTag())}get ellipsis(){var t;return null!==(t=this.attribute.ellipsis)&&void 0!==t?t:Vn.ellipsis}set ellipsis(t){this.attribute.ellipsis!==t&&(this.attribute.ellipsis=t,this.addUpdateShapeAndBoundsTag())}get wordBreak(){var t;return null!==(t=this.attribute.wordBreak)&&void 0!==t?t:Vn.wordBreak}set wordBreak(t){this.attribute.wordBreak!==t&&(this.attribute.wordBreak=t,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){var t;return null!==(t=this.attribute.verticalDirection)&&void 0!==t?t:Vn.verticalDirection}set verticalDirection(t){this.attribute.verticalDirection!==t&&(this.attribute.verticalDirection=t,this.addUpdateShapeAndBoundsTag())}get textAlign(){var t;return null!==(t=this.attribute.textAlign)&&void 0!==t?t:Vn.textAlign}set textAlign(t){this.attribute.textAlign!==t&&(this.attribute.textAlign=t,this.addUpdateShapeAndBoundsTag())}get textBaseline(){var t;return null!==(t=this.attribute.textBaseline)&&void 0!==t?t:Vn.textBaseline}set textBaseline(t){this.attribute.textBaseline!==t&&(this.attribute.textBaseline=t,this.addUpdateShapeAndBoundsTag())}get textConfig(){var t;return null!==(t=this.attribute.textConfig)&&void 0!==t?t:Vn.textConfig}set textConfig(t){this.attribute.textConfig=t,this.addUpdateShapeAndBoundsTag()}getGraphicTheme(){return zo(this).richtext}static AllSingleCharacter(t){return t.lines?t.lines.every((t=>t.paragraphs.every((t=>!(t.text&&ct(t.text)&&lh.splitText(t.text).length>1))))):t.every((t=>t.isComposing||!(t.text&&ct(t.text)&&lh.splitText(t.text).length>1)))}static splitText(t){if(sh){const e=new Intl.Segmenter(void 0,{granularity:"grapheme"}),i=[];for(const{segment:n}of e.segment(t))i.push(n);return i}return Array.from(t)}static TransformTextConfig2SingleCharacter(t){const e=[];return t.forEach((t=>{const i=lh.splitText(t.text.toString());if(ct(t.text)&&i.length>1)for(let n=0;n<i.length;n++){const o=i[n];e.push(Object.assign(Object.assign({},t),{text:o}))}else e.push(t)})),e}updateAABBBounds(t,e,i){var n,o,r,s;const{width:a=e.width,height:l=e.height,maxWidth:h=e.maxWidth,maxHeight:d=e.maxHeight,textAlign:c=e.textAlign,textBaseline:u=(null!==(o=null!==(n=t.textBaseline)&&void 0!==n?n:e.textBaseline)&&void 0!==o?o:"top"),editOptions:g}=t;if(a>0&&l>0)i.set(0,0,a,l);else{const t=this.getFrameCache(),{width:e,height:n}=t.getActualSize();let o=a||e||0,r=l||n||0;r="number"==typeof d&&r>d?d:r||0,o="number"==typeof h&&o>h?h:o||0,i.set(0,0,o,r)}g&&g.keepHeightWhileEmpty&&!i.height()&&!(null===(r=t.textConfig)||void 0===r?void 0:r.length)&&(i.y2=i.y1+(null!==(s=t.fontSize)&&void 0!==s?s:12),i.x2=i.x1+2);let p=0;switch(u){case"top":p=0;break;case"middle":p=-i.height()/2;break;case"bottom":p=-i.height()}let f=0;switch(c){case"left":f=0;break;case"center":f=-i.width()/2;break;case"right":f=-i.width()}return i.translate(f,p),$n.graphicService.updateTempAABBBounds(i),null==t.forceBoundsHeight&&null==t.forceBoundsWidth||$n.graphicService.updateHTMLTextAABBBounds(t,e,i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,$n.graphicService.transformAABBBounds(t,i,e,!1,this),0===i.width()&&0===i.height()&&i.clear(),i}needUpdateTags(t){return super.needUpdateTags(t,ah)}needUpdateTag(t){return super.needUpdateTag(t,ah)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}get cliped(){const t=this.getFrameCache();if(t.actualHeight>t.height)return!0;const{disableAutoWrapLine:e}=this.attribute;if(e)for(let e=0;e<t.lines.length;e++){const i=t.lines[e];for(let t=0;t<i.paragraphs.length;t++){const e=i.paragraphs[t];if(e.overflow&&""!==e.text)return!0}}return!1}combinedStyleToCharacter(t){const{fill:e,stroke:i,fontSize:n,fontFamily:o,fontStyle:r,fontWeight:s,lineWidth:a,opacity:l,fillOpacity:h,lineHeight:d,strokeOpacity:c,upgradeAttrs:u}=this.attribute,g=Object.assign({fill:e,stroke:i,fontSize:n,fontFamily:o,fontStyle:r,fontWeight:s,lineWidth:a,opacity:l,fillOpacity:h,strokeOpacity:c},t);return(null==u?void 0:u.lineHeight)&&(g.lineHeight=d),g}doUpdateFrameCache(t){var e;const{maxWidth:i,maxHeight:n,width:o,height:r,ellipsis:s,wordBreak:a,verticalDirection:l,textAlign:h,textBaseline:d,layoutDirection:c,singleLine:u,disableAutoWrapLine:g,editable:p,ascentDescentMode:f,upgradeAttrs:v}=this.attribute,b=v&&v.multiBreakLine;let{textConfig:m=[]}=this.attribute;p&&m.length>0&&!lh.AllSingleCharacter(m)&&(m=lh.TransformTextConfig2SingleCharacter(m),this.attribute.textConfig=m);const y=[],C=null!=t?t:m;for(let t=0;t<C.length;t++)if("image"in C[t]){const e=this.combinedStyleToCharacter(C[t]);e.lineWidth=void 0;const i=e.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(e.id);if(i)y.push(i);else{const t=new nh(e);t.successCallback=()=>{var t;this.addUpdateBoundTag(),null===(t=this.stage)||void 0===t||t.renderNextFrame()},t.richtextId=e.id,y.push(t)}}else{const e=this.combinedStyleToCharacter(C[t]);if(ft(e.text)&&(e.text=`${e.text}`),e.text&&e.text.includes("\n")){const i=e.text.split("\n");for(let n=0;n<i.length;n++)if(0===n)y.push(new Ql(i[n],!1,e,f));else if(i[n]||t===C.length-1)y.push(new Ql(i[n],!0,e,f));else{const e=this.combinedStyleToCharacter(C[t+1]);y.push(new Ql(i[n],!0,e,f))}}else e.text&&y.push(new Ql(e.text,!1,e,f))}const w="number"==typeof i&&Number.isFinite(i)&&i>0,x="number"==typeof n&&Number.isFinite(n)&&n>0,_="number"==typeof o&&Number.isFinite(o)&&o>0&&(!w||o<=i),S="number"==typeof r&&Number.isFinite(r)&&r>0&&(!x||r<=n),A=new Zl(0,0,(_?o:w?i:0)||0,(S?r:x?n:0)||0,s,a,l,h,d,c||"horizontal",!_&&w,!S&&x,u||!1,null===(e=this._frameCache)||void 0===e?void 0:e.icons),B=new rh(A);if(B.newLine=b,g){let t=0,e=!1;for(let i=0;i<y.length;i++){const n=y[i];e?(n.overflow=!0,n.left=1/0,n.top=1/0,!n.newLine&&A.lines[A.lines.length-1].paragraphs.push(n)):B.deal(n,!0),A.lines.length!==t&&(t=A.lines.length,B.lineBuffer.length=0,n.overflow=!0,n.left=1e3,n.top=1e3,A.lines[A.lines.length-1].paragraphs.push(n),e=!0),n.newLine&&(e=!1,B.lineWidth=0),B.send()}}else for(let t=0;t<y.length;t++)B.deal(y[t]);if(B.send(),!("horizontal"===A.layoutDirection?_:S)){const t=A.getActualSizeWidthEllipsis();let e="horizontal"===A.layoutDirection?t.width:t.height;("horizontal"===A.layoutDirection?w:x)&&(e=Math.min(e,"horizontal"===A.layoutDirection?i:n)),A.lines.forEach((function(t){t.calcOffset(e,!1)}))}b&&A.lines.forEach((t=>{const e=t.paragraphs;t.paragraphs=t.paragraphs.filter((t=>""!==t.text)),0===t.paragraphs.length&&e.length&&(e[0].text="\n",t.paragraphs.push(e[0]))})),this._frameCache=A}clone(){return new lh(Object.assign({},this.attribute))}setStage(t,e){super.setStage(t,e),this.getFrameCache().icons.forEach((i=>{i.setStage(t,e)}))}bindIconEvent(){this.addEventListener("pointermove",(t=>{const e=this.pickIcon(t.global);e&&e===this._currentHoverIcon||(e?this.setAttribute("hoverIconId",e.richtextId):!e&&this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0))})),this.addEventListener("pointerleave",(t=>{this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0)}))}updateHoverIconState(t){var e,i,n,o,r;t?(null===(e=this._currentHoverIcon)||void 0===e||e.setHoverState(!1),this._currentHoverIcon=t,this._currentHoverIcon.setHoverState(!0),null===(i=this.stage)||void 0===i||i.setCursor(t.attribute.cursor),null===(n=this.stage)||void 0===n||n.renderNextFrame()):(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,null===(o=this.stage)||void 0===o||o.setCursor(),null===(r=this.stage)||void 0===r||r.renderNextFrame())}pickIcon(t){const e=this.getFrameCache(),{e:i,f:n}=this.globalTransMatrix;let o;return e.icons.forEach(((e,r)=>{var s,a;const l=e.AABBBounds.clone();l.translate(e._marginArray[3],e._marginArray[0]),l.containsPoint({x:t.x-i,y:t.y-n})&&(o=e,o.globalX=(null!==(s=o.attribute.x)&&void 0!==s?s:0)+i+e._marginArray[3],o.globalY=(null!==(a=o.attribute.y)&&void 0!==a?a:0)+n+e._marginArray[0])})),o}getNoWorkAnimateAttr(){return lh.NOWORK_ANIMATE_ATTR}}function hh(t){return new lh(t)}lh.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},Ma);const dh=["path","customPath",...Aa];class ch extends La{constructor(t){super(t),this.type="path",this.numberType=ga}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{path:t}=this.attribute;return null!=t&&""!==t}getParsedPathShape(){const t=this.getGraphicTheme();if(!this.valid)return t.path;const e=this.attribute;return e.path instanceof wn?e.path:(rt(this.cache)&&this.doUpdatePathShape(),this.cache instanceof wn?this.cache:t.path)}getGraphicTheme(){return zo(this).path}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const t=this.getParsedPathShape();i.union(t.getBounds())}const{tb1:n,tb2:o}=$n.graphicService.updateTempAABBBounds(i);Ll(t,e,n),i.union(n),n.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:r=e.lineJoin}=t;return $n.graphicService.transformAABBBounds(t,i,e,"miter"===r,this),i}doUpdateAABBBounds(t){return this.doUpdatePathShape(),super.doUpdateAABBBounds(t)}doUpdatePathShape(){const t=this.attribute;ct(t.path,!0)?this.cache=(new wn).fromString(t.path):t.customPath&&(this.cache=new wn,t.customPath(this.cache,this))}needUpdateTags(t){return super.needUpdateTags(t,dh)}needUpdateTag(t){return super.needUpdateTag(t,dh)}toCustomPath(){return(new wn).fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new ch(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return ch.NOWORK_ANIMATE_ATTR}}function uh(t){return new ch(t)}ch.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},Ma);const gh=["segments","points","curveType","curveTension",...Aa];class ph extends La{constructor(t){super(t),this.type="area",this.numberType=la}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?0!==e.length:!!t&&0!==t.length}getGraphicTheme(){return zo(this).area}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateAreaAABBBoundsBySegments(t,e,i):this.updateAreaAABBBoundsByPoints(t,e,i)),$n.graphicService.updateTempAABBBounds(i),this.setWidthHeightWithoutTransform(i);const{lineJoin:n=e.lineJoin}=t;return $n.graphicService.transformAABBBounds(t,i,e,"miter"===n,this),i}updateAreaAABBBoundsByPoints(t,e,i,n){const{points:o=e.points}=t,r=i;return o.forEach((t=>{var e,i;r.add(t.x,t.y),r.add(null!==(e=t.x1)&&void 0!==e?e:t.x,null!==(i=t.y1)&&void 0!==i?i:t.y)})),r}updateAreaAABBBoundsBySegments(t,e,i,n){const{segments:o=e.segments}=t,r=i;return o.forEach((t=>{t.points.forEach((t=>{var e,i;r.add(t.x,t.y),r.add(null!==(e=t.x1)&&void 0!==e?e:t.x,null!==(i=t.y1)&&void 0!==i?i:t.y)}))})),r}_interpolate(t,e,i,n,o){"points"===t&&(o.points=Cr(i,n,e))}needUpdateTags(t){return super.needUpdateTags(t,gh)}needUpdateTag(t){return super.needUpdateTag(t,gh)}toCustomPath(){const t=new wn,e=this.attribute,i=e.segments,n=e=>{if(e&&e.length){let i=!0;const n=[];if(e.forEach((e=>{var o,r;!1!==e.defined&&(i?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y),n.push({x:null!==(o=e.x1)&&void 0!==o?o:e.x,y:null!==(r=e.y1)&&void 0!==r?r:e.y}),i=!1)})),n.length){for(let e=n.length-1;e>=0;e--)t.lineTo(n[e].x,n[e].y);t.closePath()}}};return e.points?n(e.points):i&&i.length&&i.forEach((t=>{n(t.points)})),t}clone(){return new ph(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return ph.NOWORK_ANIMATE_ATTR}}ph.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},Ma);const fh=["innerRadius","outerRadius","startAngle","endAngle","cornerRadius","padAngle","padRadius","cap",...Aa];let vh=class t extends La{constructor(t){super(t),this.type="arc",this.numberType=sa}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,outerRadius:i,innerRadius:n}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)&&this._validNumber(n)}getParsedCornerRadius(){const t=this.getGraphicTheme(),{cornerRadius:e=t.cornerRadius,innerPadding:i=t.innerPadding,outerPadding:n=t.outerPadding}=this.attribute;let{outerRadius:o=t.outerRadius,innerRadius:r=t.innerRadius}=this.attribute;if(o+=n,r-=i,0===e||"0%"===e)return 0;const s=Math.abs(o-r),a=t=>Math.min(ft(t,!0)?t:s*parseFloat(t)/100,s/2);if(ut(e)){const t=e.map((t=>a(t)||0));return 0===t.length?[t[0],t[0],t[0],t[0]]:2===t.length?[t[0],t[1],t[0],t[1]]:(3===t.length&&t.push(0),t)}return a(e)}getParsedAngle(){const t=this.getGraphicTheme();let{startAngle:e=t.startAngle,endAngle:i=t.endAngle}=this.attribute;const{cap:n=t.cap}=this.attribute,o=i-e>=0?1:-1,r=i-e;if(e=me(e),i=e+r,n&&re(r)<oe-te){let r=1,s=1;n.length&&(r=Number(n[0]),s=Number(n[1]));let{outerRadius:a=t.outerRadius,innerRadius:l=t.innerRadius}=this.attribute;const{outerPadding:h=t.outerPadding,innerPadding:d=t.innerPadding}=this.attribute;a+=h,l-=d;const c=Math.abs(a-l)/2,u=c/a;if(c>te&&a>te)return{startAngle:e-o*u*r,endAngle:i+o*u*s,sc:o*u*r,ec:o*u*s}}return{startAngle:e,endAngle:i}}getParsePadAngle(t,e){const i=this.getGraphicTheme(),{innerPadding:n=i.innerPadding,outerPadding:o=i.outerPadding,padAngle:r=i.padAngle}=this.attribute;let{outerRadius:s=i.outerRadius,innerRadius:a=i.innerRadius}=this.attribute;s+=o,a-=n;const{padRadius:l=ce(s*s+a*a)}=this.attribute,h=re(e-t);let d=t,c=e,u=t,g=e;const p=r/2;let f=h,v=h;if(p>te&&l>te){const i=e>t?1:-1;let n=ge(Number(l)/a*de(p)),o=ge(Number(l)/s*de(p));return(f-=2*n)>te?(n*=i,u+=n,g-=n):(f=0,u=g=(t+e)/2),(v-=2*o)>te?(o*=i,d+=o,c-=o):(v=0,d=c=(t+e)/2),{outerStartAngle:d,outerEndAngle:c,innerStartAngle:u,innerEndAngle:g,innerDeltaAngle:f,outerDeltaAngle:v}}return{outerStartAngle:d,outerEndAngle:c,innerStartAngle:u,innerEndAngle:g,innerDeltaAngle:f,outerDeltaAngle:v}}getGraphicTheme(){return zo(this).arc}updateAABBBounds(t,e,i,n){this.updatePathProxyAABBBounds(i)||(n?this.updateArcAABBBoundsImprecise(t,e,i):this.updateArcAABBBoundsAccurate(t,e,i));const{tb1:o,tb2:r}=$n.graphicService.updateTempAABBBounds(i);Ll(t,e,o),i.union(o),o.setValue(r.x1,r.y1,r.x2,r.y2),this.setWidthHeightWithoutTransform(i);const{lineJoin:s=e.lineJoin}=t;return $n.graphicService.transformAABBBounds(t,i,e,"miter"===s,this),i}updateArcAABBBoundsImprecise(t,e,i){let{outerRadius:n=e.outerRadius,innerRadius:o=e.innerRadius}=t;const{outerPadding:r=e.outerPadding,innerPadding:s=e.innerPadding}=t;return n+=r,o-=s,n<o&&(n=o),i.set(-n,-n,n,n),i}updateArcAABBBoundsAccurate(t,e,i){let{outerRadius:n=e.outerRadius,innerRadius:o=e.innerRadius}=t;const{outerPadding:r=e.outerPadding,innerPadding:s=e.innerPadding}=t;if(n+=r,o-=s,n<o){const t=n;n=o,o=t}let{endAngle:a=e.endAngle,startAngle:l=e.startAngle}=t;if(l>a){const t=l;l=a,a=t}return n<=te?i.set(0,0,0,0):Math.abs(a-l)>oe-te?i.set(-n,-n,n,n):(mr(l,a,n,i),mr(l,a,o,i)),i}needUpdateTags(t){return super.needUpdateTags(t,fh)}needUpdateTag(t){return super.needUpdateTag(t,fh)}toCustomPath(){var t,e,i,n;const o=this.attribute,{startAngle:r,endAngle:s}=this.getParsedAngle();let a=(null!==(t=o.innerRadius)&&void 0!==t?t:0)-(null!==(e=o.innerPadding)&&void 0!==e?e:0),l=(null!==(i=o.outerRadius)&&void 0!==i?i:0)-(null!==(n=o.outerPadding)&&void 0!==n?n:0);const h=re(s-r),d=s>r;if(l<a){const t=l;l=a,a=t}const c=new wn;if(l<=te)c.moveTo(0,0);else if(h>=oe-te)c.moveTo(0+l*ae(r),0+l*de(r)),c.arc(0,0,l,r,s,!d),a>te&&(c.moveTo(0+a*ae(s),0+a*de(s)),c.arc(0,0,a,s,r,d));else{const t=l*ae(r),e=l*de(r),i=a*ae(s),n=a*de(s);c.moveTo(0+t,0+e),c.arc(0,0,l,r,s,!d),c.lineTo(0+i,0+n),c.arc(0,0,a,s,r,d),c.closePath()}return c}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function bh(t){return new vh(t)}vh.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},Ma);const mh=["points","cornerRadius",...Aa];class yh extends La{constructor(t){super(t),this.type="polygon",this.numberType=pa}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{points:t}=this.attribute;return t&&t.length>=2}getGraphicTheme(){return zo(this).polygon}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||this.updatePolygonAABBBoundsImprecise(t,e,i),$n.graphicService.updateTempAABBBounds(i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:n=e.lineJoin}=t;return $n.graphicService.transformAABBBounds(t,i,e,"miter"===n,this),i}updatePolygonAABBBoundsImprecise(t,e,i){const{points:n=e.points}=t;return n.forEach((t=>{i.add(t.x,t.y)})),i}_interpolate(t,e,i,n,o){"points"===t&&(o.points=Cr(i,n,e))}needUpdateTags(t){return super.needUpdateTags(t,mh)}needUpdateTag(t){return super.needUpdateTag(t,mh)}toCustomPath(){const t=this.attribute.points,e=new wn;return t.forEach(((t,i)=>{0===i?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)})),e.closePath(),e}clone(){return new yh(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return yh.NOWORK_ANIMATE_ATTR}}function Ch(t){return new yh(t)}yh.NOWORK_ANIMATE_ATTR=Ma;class wh extends Ea{constructor(t){super({x:0,y:0}),this.type="shadowroot",this.shadowHost=t}clearUpdateBoundTag(){super.clearUpdateBoundTag(),this.shadowHost&&this.shadowHost.clearUpdateBoundTag()}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.shouldUpdateGlobalMatrix()){const e=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f):this._globalTransMatrix=e.clone(),this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){const t=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}}function xh(t){return new wh(t)}const _h=new class{constructor(){this.store=new Map}RegisterGraphicCreator(t,e){this.store.set(t,e),this[t]=e}CreateGraphic(t,e){const i=this.store.get(t);return i?i(e):null}};let Sh;function Ah(t){return Sh||(Sh=_h.CreateGraphic("text",{})),Sh.initAttributes(t),Sh.AABBBounds}var Bh=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Th=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Rh=function(t,e){return function(i,n){e(i,n,t)}};class kh{constructor(){this.time=ki.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){var g;const{background:p,backgroundOpacity:f=(null!==(g=t.attribute.fillOpacity)&&void 0!==g?g:l.backgroundOpacity),opacity:v=l.opacity,backgroundMode:b=l.backgroundMode,backgroundFit:m=l.backgroundFit,backgroundKeepAspectRatio:y=l.backgroundKeepAspectRatio,backgroundScale:C=l.backgroundScale,backgroundOffsetX:w=l.backgroundOffsetX,backgroundOffsetY:x=l.backgroundOffsetY,backgroundClip:_=l.backgroundClip}=t.attribute;if(p)if(t.backgroundImg&&t.resources){const o=t.resources.get(p);if("success"!==o.state||!o.data)return;if(e.save(),t.parent&&!t.transMatrix.onlyTranslate()){const i=zo(t.parent).group,{scrollX:n=i.scrollX,scrollY:o=i.scrollY}=t.parent.attribute;e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.translate(n,o)}_&&e.clip();const r=t.AABBBounds;e.setCommonStyle(t,t.attribute,i,n,l),e.globalAlpha=f*v,this.doDrawImage(e,o.data,r,{backgroundMode:b,backgroundFit:m,backgroundKeepAspectRatio:y,backgroundScale:C,backgroundOffsetX:w,backgroundOffsetY:x}),e.restore(),t.transMatrix.onlyTranslate()||e.setTransformForCurrent()}else e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,n,l),e.globalAlpha=f*v,e.fillStyle=p,e.fill(),e.highPerformanceRestore()}doDrawImage(t,e,i,n){const{backgroundMode:o,backgroundFit:r,backgroundKeepAspectRatio:s,backgroundScale:a=1,backgroundOffsetX:l=0,backgroundOffsetY:h=0}=n,d=i.width(),c=i.height();let u=d,g=c;if("no-repeat"===o)if(r)if(s){const n=Math.max(d/e.width,c/e.height);t.drawImage(e,i.x1+l,i.y1+h,e.width*n*a,e.height*n*a)}else t.drawImage(e,i.x1,i.y1,i.width(),i.height());else{const n=e.width*a,o=e.height*a;t.drawImage(e,i.x1+l,i.y1+h,n,o)}else{if(r&&"repeat"!==o&&(e.width||e.height)){const i=e.width,n=e.height;"repeat-x"===o?(u=i*(c/n),g=c):"repeat-y"===o&&(g=n*(d/i),u=d);const r=t.dpr,s=yo.allocate({width:u,height:g,dpr:r}),a=s.getContext("2d");a&&(a.inuse=!0,a.clearMatrix(),a.setTransformForCurrent(!0),a.clearRect(0,0,u,g),a.drawImage(e,0,0,u,g),e=s.nativeCanvas),yo.free(s)}const n=t.dpr,s=t.createPattern(e,o);s.setTransform&&s.setTransform(new DOMMatrix([1/n,0,0,1/n,0,0])),t.fillStyle=s,t.translate(i.x1,i.y1),t.fillRect(0,0,d,c),t.translate(-i.x1,-i.y1)}}}const Mh=new kh;let Lh=class{constructor(t){this.subRenderContribitions=t,this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){this._subRenderContribitions||(this._subRenderContribitions=this.subRenderContribitions.getContributions()),this._subRenderContribitions.forEach((g=>{g.render(t,e,i,n,o,r,s,a,l,h,d,c,u)}))}};Lh=Bh([w(),Rh(0,y(F)),Rh(0,x(fl)),Th("design:paramtypes",[Object])],Lh);const Ph=new class{constructor(){this.time=ki.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){var g,p;const{clipConfig:f}=t.attribute;if(!f)return;const v=t.getClipPath();if(!v)return;const b=!(d||c),m=t.AABBBounds,y=null!==(g=t.attribute.width)&&void 0!==g?g:m.width(),C=null!==(p=t.attribute.height)&&void 0!==p?p:m.height();b&&e.save(),e.beginPath(),!1===v.draw(e,[y,C],i+y/2,n+C/2,0)&&e.closePath(),d&&d(e,t.attribute,l,!0),b&&e.clip()}};const Eh=new class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){const{clipConfig:g}=t.attribute;g&&t.getClipPath()&&(d||c||e.restore())}};class Hh{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=10,this._tempSymbolGraphic=null}createCommonPattern(t,e,i,n,o){const r=(t-2*e)/2,s=n.dpr,a=yo.allocate({width:t,height:t,dpr:s}),l=a.getContext("2d");if(!l)return null;l.inuse=!0,l.clearMatrix(),l.setTransformForCurrent(!0),l.clearRect(0,0,t,t),o(r,l);const h=n.createPattern(a.nativeCanvas,"repeat");return h.setTransform&&h.setTransform(new DOMMatrix([1/s,0,0,1/s,0,0])),yo.free(a),h}createCirclePattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,((t,e)=>{e.fillStyle=i,e.arc(t,t,t,0,oe),e.fill()}))}createDiamondPattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,((e,n)=>{const o=t/2,r=o;n.fillStyle=i,n.moveTo(o,r-e),n.lineTo(e+o,r),n.lineTo(o,r+e),n.lineTo(o-e,r),n.closePath(),n.fill()}))}createRectPattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,((t,n)=>{const o=e,r=o;n.fillStyle=i,n.fillRect(o,r,2*t,2*t)}))}createVerticalLinePattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,((n,o)=>{const r=e;o.fillStyle=i,o.fillRect(r,0,2*n,t)}))}createHorizontalLinePattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,((n,o)=>{const r=e;o.fillStyle=i,o.fillRect(0,r,t,2*n)}))}createBiasLRLinePattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,((e,n)=>{n.strokeStyle=i,n.lineWidth=e,n.moveTo(0,0),n.lineTo(t,t);const o=t/2,r=-o;n.moveTo(o,r),n.lineTo(o+t,r+t),n.moveTo(-o,-r),n.lineTo(-o+t,-r+t),n.stroke()}))}createBiasRLLinePattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,((e,n)=>{n.strokeStyle=i,n.lineWidth=e,n.moveTo(t,0),n.lineTo(0,t);const o=t/2,r=o;n.moveTo(t+o,r),n.lineTo(o,r+t),n.moveTo(t-o,-r),n.lineTo(-o,-r+t),n.stroke()}))}createGridPattern(t,e,i,n){return this.createCommonPattern(t,e,i,n,((t,n)=>{const o=e,r=o;n.fillStyle=i,n.fillRect(o,r,t,t),n.fillRect(o+t,r+t,t,t)}))}initTextureMap(t,e){this.textureMap=new Map}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){this.textureMap||this.initTextureMap(e,t.stage);const{texture:g=l.texture,textureColor:p=l.textureColor,textureSize:f=l.textureSize,texturePadding:v=l.texturePadding}=t.attribute;g&&this.drawTexture(g,t,e,i,n,l,p,f,v)}drawTexture(t,e,i,n,o,r,s,a,l){var h;const{textureRatio:d=r.textureRatio,textureOptions:c=null}=e.attribute;let u=this.textureMap.get(t);if(!u)switch(t){case"circle":u=this.createCirclePattern(a,l,s,i);break;case"diamond":u=this.createDiamondPattern(a,l,s,i);break;case"rect":u=this.createRectPattern(a,l,s,i);break;case"vertical-line":u=this.createVerticalLinePattern(a,l,s,i);break;case"horizontal-line":u=this.createHorizontalLinePattern(a,l,s,i);break;case"bias-lr":u=this.createBiasLRLinePattern(a,l,s,i);break;case"bias-rl":u=this.createBiasRLLinePattern(a,l,s,i);break;case"grid":u=this.createGridPattern(a,l,s,i)}if(c&&c.dynamicTexture){const{gridConfig:u={},useNewCanvas:g}=c,p=e.AABBBounds;n=p.x1,o=p.y1;const f=i;let v;if(g){v=yo.allocate({width:p.width(),height:p.height(),dpr:i.dpr});const t=v.getContext("2d");t.clearRect(0,0,p.width(),p.height()),n=0,o=0,i=t}if(f.save(),e.parent&&!e.transMatrix.onlyTranslate()){const{scrollX:t=0,scrollY:i=0}=e.parent.attribute;f.setTransformFromMatrix(e.parent.globalTransMatrix),f.translate(t,i,!0)}f.setCommonStyle(e,e.attribute,n,o,r),f.clip();const b=p.width(),m=p.height(),y=l,C=a,w=u.columns?u.columns:Math.ceil(b/C),x=u.rows?u.rows:Math.ceil(m/C),_=u.gutterColumn?u.gutterColumn:2*y,S=u.gutterRow?u.gutterRow:2*y;this._tempSymbolGraphic||(this._tempSymbolGraphic=Vl({}));const A=u.columns?b/u.columns:C,B=u.rows?m/u.rows:C;this._tempSymbolGraphic.setAttributes({size:[A-_,B-S],symbolType:t});const T=this._tempSymbolGraphic.getParsedPath();for(let t=0;t<x;t++)for(let r=0;r<w;r++){const a=n+C/2+r*C,l=o+C/2+t*C;null===(h=c.beforeDynamicTexture)||void 0===h||h.call(c,i,t,r,x,w,d,e,p.width(),p.height()),i.beginPath(),!1===T.draw(i,Math.min(A-_,B-S),a,l,0)&&i.closePath(),i.fillStyle=s,c.dynamicTexture(i,t,r,x,w,d,e,p.width(),p.height())}g&&(f.globalAlpha=1,f.drawImage(v.nativeCanvas,0,0,v.nativeCanvas.width,v.nativeCanvas.height,p.x1,p.y1,p.width()*f.dpr,p.height()*f.dpr)),f.restore()}else if(u)i.highPerformanceSave(),i.setCommonStyle(e,e.attribute,n,o,r),i.fillStyle=u,i.fill(),i.highPerformanceRestore();else if("wave"===t){i.save(),i.setCommonStyle(e,e.attribute,n,o,r),i.clip();const t=e.AABBBounds;(function(t,e,i,n,o,r,s){const{fill:a="orange",percent:l=.6,frequency:h=4,opacity:d,phi:c=0}=o;let{amplitude:u=10}=o;u*=function(t){return t<=.5?4*t-1:-4*t+3}(e);const g=n*(1-l),p=i,f=Math.max(Math.round(p/70),2);t.beginPath(),t.moveTo(0+r,n+s),t.lineTo(0+r,g+s);const v=p/h*e,b=p/Math.PI/(2*h);for(let e=0;e<p;e+=f){const i=u*Math.sin((e+v+c)/b+c);t.lineTo(e+r,g+i+s)}t.lineTo(p+r,n+s),t.closePath(),t.fillStyle=a,isFinite(d)&&(t.globalAlpha=d),t.fill()})(i,d,t.width(),t.height(),Object.assign(Object.assign({},c||{}),{fill:s}),n+t.x1-n,o+t.y1-o),i.restore()}}}const Oh=new Hh;const Ih=new class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){const{outerBorder:u,innerBorder:g}=t.attribute,p=u&&!1!==u.visible,f=g&&!1!==g.visible;if(!p&&!f)return;const{innerPadding:v=l.innerPadding,outerPadding:b=l.outerPadding,startAngle:m=l.startAngle,endAngle:y=l.endAngle,opacity:C=l.opacity,x:w=l.x,y:x=l.y,scaleX:_=l.scaleX,scaleY:S=l.scaleY,keepStrokeScale:A=l.keepStrokeScale}=t.attribute;let{innerRadius:B=l.innerRadius,outerRadius:T=l.outerRadius}=t.attribute;T+=b,B-=v;const R=(o,r)=>{const s=!(!o||!o.stroke),{distance:a=l[r].distance}=o,h=A?a:qn(e,a,e.dpr),d=a/T,u="outerBorder"===r?1:-1;if(t.setAttributes({outerRadius:T+u*h,innerRadius:B-u*h,startAngle:m-u*d,endAngle:y+u*d}),e.beginPath(),el(t,e,i,n,T+u*h,B-u*h),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),c)c(e,o,l[r]);else if(s){const s=l[r].opacity;l[r].opacity=C,e.setStrokeStyle(t,o,(w-i)/_,(x-n)/S,l[r]),l[r].opacity=s,e.stroke()}};p&&R(u,"outerBorder"),f&&R(g,"innerBorder"),t.setAttributes({outerRadius:T,innerRadius:B,startAngle:m,endAngle:y})}},Fh=Oh,zh=Mh;const Dh=new class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){const{outerBorder:u,innerBorder:g}=t.attribute,p=u&&!1!==u.visible,f=g&&!1!==g.visible;if(!p&&!f)return;const{radius:v=l.radius,startAngle:b=l.startAngle,endAngle:m=l.endAngle,opacity:y=l.opacity,x:C=l.x,y:w=l.y,scaleX:x=l.scaleX,scaleY:_=l.scaleY,keepStrokeScale:S=l.keepStrokeScale}=t.attribute,A=(o,r)=>{const s=!(!o||!o.stroke),{distance:a=l[r].distance}=o,h=S?a:qn(e,a,e.dpr),d="outerBorder"===r?1:-1;if(e.beginPath(),e.arc(i,n,v+d*h,b,m),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),c)c(e,o,l[r]);else if(s){const s=l[r].opacity;l[r].opacity=y,e.setStrokeStyle(t,o,(C-i)/x,(w-n)/_,l[r]),l[r].opacity=s,e.stroke()}};p&&A(u,"outerBorder"),f&&A(g,"innerBorder")}},Wh=Oh,Nh=Mh;const Gh=new class extends kh{constructor(){super(...arguments),this.time=ki.beforeFillStroke}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){const{background:u,backgroundMode:g=l.backgroundMode,backgroundFit:p=l.backgroundFit,backgroundKeepAspectRatio:f=l.backgroundKeepAspectRatio,backgroundScale:v=l.backgroundScale,backgroundOffsetX:b=l.backgroundOffsetX,backgroundOffsetY:m=l.backgroundOffsetY}=t.attribute;if(u)if(t.backgroundImg&&t.resources){const i=t.resources.get(u);if("success"!==i.state||!i.data)return;e.highPerformanceSave(),e.setTransformFromMatrix(t.parent.globalTransMatrix,!0);const n=t.AABBBounds;this.doDrawImage(e,i.data,n,{backgroundMode:g,backgroundFit:p,backgroundKeepAspectRatio:f,backgroundScale:v,backgroundOffsetX:b,backgroundOffsetY:m}),e.highPerformanceRestore(),e.setTransformForCurrent()}else e.highPerformanceSave(),e.fillStyle=u,e.fill(),e.highPerformanceRestore()}},jh=ee/2;function Vh(t,e,i,n,o,r){let s,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=arguments.length>7?arguments[7]:void 0;if(Array.isArray(a)&&(l=a,a=!0),n<0&&(e+=n,n=-n),o<0&&(i+=o,o=-o),ft(r,!0))s=[r=re(r),r,r,r];else if(Array.isArray(r)){const t=r;let e,i;switch(t.length){case 0:s=[0,0,0,0];break;case 1:e=re(t[0]),s=[e,e,e,e];break;case 2:case 3:e=re(t[0]),i=re(t[1]),s=[e,i,e,i];break;default:s=t,s[0]=re(s[0]),s[1]=re(s[1]),s[2]=re(s[2]),s[3]=re(s[3])}}else s=[0,0,0,0];if(n<0||s[0]+s[1]+s[2]+s[3]<1e-12)return t.rect(e,i,n,o);const[h,d,c,u]=[[e,i],[e+n,i],[e+n,i+o],[e,i+o]],g=Math.min(n/2,o/2),p=[Math.min(g,s[0]),Math.min(g,s[1]),Math.min(g,s[2]),Math.min(g,s[3])],f=[h[0]+p[0],h[1]],v=[h[0],h[1]+p[0]],b=[d[0]-p[1],d[1]],m=[d[0],d[1]+p[1]],y=[c[0]-p[2],c[1]],C=[c[0],c[1]-p[2]],w=[u[0]+p[3],u[1]],x=[u[0],u[1]-p[3]];if(t.moveTo(f[0],f[1]),a){if(l&&l[0]?l[0](f[0],f[1],b[0],b[1]):t.lineTo(b[0],b[1]),!Ft(b,m)){l&&l[0]&&t.moveTo(b[0],b[1]);const e=b[0],i=b[1]+p[1];t.arc(e,i,p[1],-jh,0,!1)}if(l&&l[1]?l[1](m[0],m[1],C[0],C[1]):t.lineTo(C[0],C[1]),!Ft(y,C)){const e=C[0]-p[2],i=C[1];l&&l[1]&&t.moveTo(C[0],C[1]),t.arc(e,i,p[2],0,jh,!1)}if(l&&l[2]?l[2](y[0],y[1],w[0],w[1]):t.lineTo(w[0],w[1]),!Ft(w,x)){const e=w[0],i=w[1]-p[3];l&&l[2]&&t.moveTo(w[0],w[1]),t.arc(e,i,p[3],jh,ee,!1)}if(l&&l[3]?l[3](x[0],x[1],v[0],v[1]):t.lineTo(v[0],v[1]),!Ft(f,v)){const e=f[0],i=f[1]+p[0];l&&l[3]&&t.moveTo(v[0],v[1]),t.arc(e,i,p[0],ee,ee+jh,!1)}}else l&&l[0]?l[0](f[0],f[1],b[0],b[1]):t.lineTo(b[0],b[1]),l&&l[1]?l[1](b[0],b[1],y[0],y[1]):t.lineTo(y[0],y[1]),l&&l[2]?l[2](y[0],y[1],w[0],w[1]):t.lineTo(w[0],w[1]),l&&l[2]?l[2](w[0],w[1],f[0],f[1]):t.lineTo(f[0],f[1]);return!l&&t.closePath(),t}var Uh=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};class Xh{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){const{outerBorder:u,innerBorder:g}=t.attribute,p=u&&!1!==u.visible,f=g&&!1!==g.visible;if(!p&&!f)return;const{cornerRadius:v=l.cornerRadius,cornerType:b=l.cornerType,opacity:m=l.opacity,x:y=l.x,y:C=l.y,scaleX:w=l.scaleX,scaleY:x=l.scaleY,x1:_,y1:S,keepStrokeScale:A=l.keepStrokeScale}=t.attribute;let{width:B,height:T}=t.attribute;B=(null!=B?B:_-i)||0,T=(null!=T?T:S-n)||0;const R=(o,r)=>{const s=!(!o||!o.stroke),a="outerBorder"===r?-1:1,{distance:h=l[r].distance}=o,d=A?h:qn(e,h,e.dpr),u=i+a*d,g=n+a*d,p=2*d;if(0===v||ut(v)&&v.every((t=>0===t))?(e.beginPath(),e.rect(u,g,B-a*p,T-a*p)):(e.beginPath(),Vh(e,u,g,B-a*p,T-a*p,v,"bevel"!==b)),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),c)c(e,o,l[r]);else if(s){const s=l[r].opacity;l[r].opacity=m,e.setStrokeStyle(t,o,(y-i)/w,(C-n)/x,l[r]),l[r].opacity=s,e.stroke()}};p&&R(u,"outerBorder"),f&&R(g,"innerBorder")}}let $h=class{constructor(){this.time=ki.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){const{stroke:g=l.stroke}=t.attribute;Array.isArray(g)&&g.some((t=>!1===t))&&(u.doStroke=!1)}};$h=Uh([w()],$h);let Yh=class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){const{x1:u,y1:g,x:p=l.x,y:f=l.y,stroke:v=l.stroke,cornerRadius:b=l.cornerRadius,cornerType:m=l.cornerType}=t.attribute;let{width:y,height:C}=t.attribute;if(y=(null!=y?y:u-p)||0,C=(null!=C?C:g-f)||0,Array.isArray(v)&&v.some((t=>!1===t))){if(e.setStrokeStyle(t,t.attribute,i,n,l),!(0===b||ut(b)&&b.every((t=>0===t)))){let o,r=0;return Vh(e,i,n,y,C,b,"bevel"!==m,new Array(4).fill(0).map(((s,a)=>(s,h,d,c)=>{v[a]&&(r===a-1&&v[a]===o||(e.setStrokeStyle(t,Object.assign(Object.assign({},t.attribute),{stroke:v[a]}),i,n,l),e.beginPath(),e.moveTo(s,h),o=v[a]),r=a,e.lineTo(d,c),e.stroke(),3===a&&e.beginPath())}))),void e.stroke()}if(e.beginPath(),e.moveTo(i,n),v[0]?e.lineTo(i+y,n):e.moveTo(i+y,n),v[1]?e.lineTo(i+y,n+C):e.moveTo(i+y,n+C),v[2]?e.lineTo(i,n+C):e.moveTo(i,n+C),v[3]){const t=v[0]?n-e.lineWidth/2:n;e.lineTo(i,t)}else e.moveTo(i,n);e.stroke()}}};Yh=Uh([w()],Yh);const Kh=new Xh,qh=Oh,Zh=Mh;const Jh=new class extends Xh{constructor(){super(...arguments),this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){return super.drawShape(t,e,i,n,o,r,s,a,l,h,d,c)}},Qh=Mh;const td=new class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){const u=t.getParsedPath();if(!u)return;const{outerBorder:g,innerBorder:p}=t.attribute,f=g&&!1!==g.visible,v=p&&!1!==p.visible;if(!f&&!v)return;const{size:b=l.size,opacity:m=l.opacity,x:y=l.x,y:C=l.y,scaleX:w=l.scaleX,scaleY:x=l.scaleY,keepStrokeScale:_=l.keepStrokeScale}=t.attribute,S=(o,r)=>{const s=!(!o||!o.stroke),{distance:a=l[r].distance}=o,h=_?a:qn(e,a,e.dpr),d="outerBorder"===r?1:-1;if(e.beginPath(),!1===u.drawOffset(e,b,i,n,d*h)&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),c)c(e,o,l[r]);else if(s){const s=l[r].opacity;l[r].opacity=m,e.setStrokeStyle(t,o,(y-i)/w,(C-n)/x,l[r]),l[r].opacity=s,e.stroke()}};f&&S(g,"outerBorder"),v&&S(p,"innerBorder")}},ed=new class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){const{clipRange:g=l.clipRange,x:p=l.x,y:f=l.y,z:v=l.z,size:b=l.size,scaleX:m=l.scaleX,scaleY:y=l.scaleY}=t.attribute,C=t.getParsedPath();C&&g<1&&g>0&&(e.beginPath(),C.drawWithClipRange&&C.drawWithClipRange(e,b,i,n,g,v,((o,r)=>{var s,h,d,u;if(t._parsedPath.svgCache){const e=Object.assign({},r);e.fill=null!==(s=r.fill)&&void 0!==s?s:t.attribute.fill,e.opacity=null!==(h=r.opacity)&&void 0!==h?h:t.attribute.opacity,e.fillOpacity=t.attribute.fillOpacity,e.stroke=null!==(d=r.stroke)&&void 0!==d?d:t.attribute.stroke,e.lineWidth=null!==(u=r.lineWidth)&&void 0!==u?u:t.attribute.lineWidth,r=e}r.stroke&&(c?c(e,t.attribute,l):a&&(e.setStrokeStyle(t,r,(p-i)/m,(f-n)/y,l),e.stroke()))})),r&&!C.isSvg&&(c?c(e,t.attribute,l):a&&(e.setStrokeStyle(t,t.attribute,(p-i)/m,(f-n)/y,l),e.stroke())))}},id=Oh,nd=Mh;const od={x:0,y:0,z:0,lastModelMatrix:null};class rd{init(t){t&&(this._renderContribitions=t.getContributions()),this._renderContribitions||(this._renderContribitions=[]),this.builtinContributions||(this.builtinContributions=[]),this.builtinContributions.push(Ph),this.builtinContributions.push(Eh),this.builtinContributions.forEach((t=>this._renderContribitions.push(t))),this._renderContribitions.length&&(this._renderContribitions.sort(((t,e)=>e.order-t.order)),this._beforeRenderContribitions=this._renderContribitions.filter((t=>t.time===ki.beforeFillStroke)),this._afterRenderContribitions=this._renderContribitions.filter((t=>t.time===ki.afterFillStroke)))}reInit(){this.init(this.graphicRenderContributions)}beforeRenderStep(t,e,i,n,o,r,s,a,l,h,d,c,u){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach((g=>{g.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(g.supportedAppName)?g.supportedAppName:[g.supportedAppName]).includes(t.stage.params.context.appName)||g.drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u)}))}afterRenderStep(t,e,i,n,o,r,s,a,l,h,d,c,u){this._afterRenderContribitions&&this._afterRenderContribitions.forEach((g=>{g.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(g.supportedAppName)?g.supportedAppName:[g.supportedAppName]).includes(t.stage.params.context.appName)||g.drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u)}))}drawPathProxy(t,e,i,n,o,r,s,a){if(!t.pathProxy)return!1;const l=zo(t,null==r?void 0:r.theme)[t.type.replace("3d","")],{fill:h=l.fill,stroke:d=l.stroke,opacity:c=l.opacity,fillOpacity:u=l.fillOpacity,lineWidth:g=l.lineWidth,strokeOpacity:p=l.strokeOpacity,visible:f=l.visible,x:v=l.x,y:b=l.y}=t.attribute,m=Ka(c,u,h),y=Za(c,p),C=$a(h),w=Ya(d,g);if(!f)return!0;if(!C&&!w)return!0;if(!(m||y||s||a))return!0;e.beginPath();return Ei(("function"==typeof t.pathProxy?t.pathProxy(t.attribute):t.pathProxy).commandList,e,i,n),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,n,C,w,m,y,l,o,s,a),w&&(a?a(e,t.attribute,l):y&&(e.setStrokeStyle(t,t.attribute,i-v,n-b,l),e.stroke())),C&&(s?s(e,t.attribute,l):m&&(e.setCommonStyle(t,t.attribute,i-v,n-b,l),e.fill())),this.afterRenderStep(t,e,i,n,C,w,m,y,l,o,s,a),!0}valid(t,e,i,n){const{fill:o=e.fill,background:r,stroke:s=e.stroke,opacity:a=e.opacity,fillOpacity:l=e.fillOpacity,lineWidth:h=e.lineWidth,strokeOpacity:d=e.strokeOpacity,visible:c=e.visible}=t.attribute,u=Ka(a,l,o),g=Za(a,d),p=$a(o,r),f=Ya(s,h);return!(!t.valid||!c)&&!(!p&&!f)&&!!(u||g||i||n||r)&&{fVisible:u,sVisible:g,doFill:p,doStroke:f}}transform(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{x:o=e.x,y:r=e.y,z:s=e.z,scaleX:a=e.scaleX,scaleY:l=e.scaleY,angle:h=e.angle,postMatrix:d}=t.attribute,c=i.modelMatrix,u=i.camera;od.x=o,od.y=r,od.z=s,od.lastModelMatrix=c;const g=u&&(n||function(t){const{alpha:e,beta:i}=t.attribute;return e||i}(t)),p=g?t.transMatrix.onlyTranslate()&&!d:1===a&&1===l&&0===h&&!d;if(g){const n=Al.allocate(),o=Al.allocate();kl(o,t,e),wl(n,c||n,o),od.x=0,od.y=0,od.z=0,i.modelMatrix=n,i.setTransform(1,0,0,1,0,0,!0),Al.free(o)}if(p&&!c){const n=t.getOffsetXY(e);od.x+=n.x,od.y+=n.y,od.z=s,i.setTransformForCurrent()}else if(g)od.x=0,od.y=0,od.z=0,i.setTransform(1,0,0,1,0,0,!0);else if(u&&i.project){const n=t.getOffsetXY(e);od.x+=n.x,od.y+=n.y,this.transformWithoutTranslate(i,od.x,od.y,od.z,a,l,h)}else i.transformFromMatrix(t.transMatrix,!0),od.x=0,od.y=0,od.z=0;return od}transformUseContext2d(t,e,i,n){const o=n.camera;if(this.camera=o,o){const e=t.AABBBounds,o=e.x2-e.x1,r=e.y2-e.y1,s=n.project(0,0,i),a=n.project(o,0,i),l=n.project(o,r,i),h={x:0,y:0},d={x:o,y:0},c={x:o,y:r};n.camera=null;const u=1/(h.x*(c.y-d.y)-d.x*c.y+c.x*d.y+(d.x-c.x)*h.y),g=-(h.y*(l.x-a.x)-d.y*l.x+c.y*a.x+(d.y-c.y)*s.x)*u,p=(d.y*l.y+h.y*(a.y-l.y)-c.y*a.y+(c.y-d.y)*s.y)*u,f=(h.x*(l.x-a.x)-d.x*l.x+c.x*a.x+(d.x-c.x)*s.x)*u,v=-(d.x*l.y+h.x*(a.y-l.y)-c.x*a.y+(c.x-d.x)*s.y)*u,b=(h.x*(c.y*a.x-d.y*l.x)+h.y*(d.x*l.x-c.x*a.x)+(c.x*d.y-d.x*c.y)*s.x)*u,m=(h.x*(c.y*a.y-d.y*l.y)+h.y*(d.x*l.y-c.x*a.y)+(c.x*d.y-d.x*c.y)*s.y)*u;n.setTransform(g,p,f,v,b,m,!0)}}restoreTransformUseContext2d(t,e,i,n){this.camera&&(n.camera=this.camera)}transformWithoutTranslate(t,e,i,n,o,r,s){const a=t.project(e,i,n);t.translate(a.x,a.y,!1),t.scale(o,r,!1),t.rotate(s,!1),t.translate(-a.x,-a.y,!1),t.setTransformForCurrent()}_draw(t,e,i,n,o){const{context:r}=n;if(!r)return;const{renderable:s}=t.attribute;if(!1===s)return;r.highPerformanceSave();const a=this.transform(t,e,r,i),{x:l,y:h,z:d,lastModelMatrix:c}=a;this.z=d,this.drawPathProxy(t,r,l,h,n,o)||(this.drawShape(t,r,l,h,n,o),this.z=0,r.modelMatrix!==c&&Al.free(r.modelMatrix),r.modelMatrix=c),r.highPerformanceRestore()}}var sd=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ad=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ld=function(t,e){return function(i,n){e(i,n,t)}};let hd=class extends rd{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=sa,this.builtinContributions=[Ih,zh,Fh],this.init(t)}drawArcTailCapPath(t,e,i,n,o,r,s,a){const l=a-s,h=t.getParsedAngle(),d=h.startAngle;let c=h.endAngle;c=a;const u=c>d;let g=!1;if(o<r){const t=o;o=r,r=t}const{outerDeltaAngle:p,xors:f,yors:v,xirs:b,yirs:m,limitedOcr:y,outerCornerRadiusStart:C,outerCornerRadiusEnd:w,maxOuterCornerRadius:x,xore:_,yore:S,xire:A,yire:B,limitedIcr:T,innerDeltaAngle:R,innerStartAngle:k,innerCornerRadiusStart:M,innerCornerRadiusEnd:L,maxInnerCornerRadius:P}=tl(t,d,c,r,o);if(y>te){const t=he(C,y),r=he(w,y),s=Qa(b,m,f,v,o,t,Number(u)),a=Qa(_,S,A,B,o,r,Number(u));if(y<x&&t===r)e.moveTo(i+s.cx+s.x01,n+s.cy+s.y01),e.arc(i+s.cx,n+s.cy,y,se(s.y01,s.x01),se(a.y01,a.x01),!u);else{const t=c-l-.03,s=se(a.y11,a.x11);e.arc(i,n,o,t,s,!u),r>0&&e.arc(i+a.cx,n+a.cy,r,se(a.y11,a.x11),se(a.y01,a.x01),!u)}}else e.moveTo(i+f,n+v);if(!(r>te)||R<.001)e.lineTo(i+A,n+B),g=!0;else if(T>te){const t=he(M,T),o=he(L,T),s=Qa(A,B,_,S,r,-o,Number(u)),a=Qa(f,v,b,m,r,-t,Number(u));if(e.lineTo(i+s.cx+s.x01,n+s.cy+s.y01),T<P&&t===o){const t=se(a.y01,a.x01);e.arc(i+s.cx,n+s.cy,T,se(s.y01,s.x01),t,!u)}else{o>0&&e.arc(i+s.cx,n+s.cy,o,se(s.y01,s.x01),se(s.y11,s.x11),!u);const t=se(s.cy+s.y11,s.cx+s.x11),a=c-l-.03;e.arc(i,n,r,t,a,u)}}else e.lineTo(i+r*ae(k),n+r*de(k));return g}drawShape(t,e,i,n,o,r,s,a){const l=zo(t,null==r?void 0:r.theme).arc,{fill:h=l.fill,stroke:d=l.stroke,x:c=l.x,y:u=l.y,fillStrokeOrder:g=l.fillStrokeOrder}=t.attribute,p=this.valid(t,l,s,a);if(!p)return;const{fVisible:f,sVisible:v,doFill:b,doStroke:m}=p,{outerPadding:y=l.outerPadding,innerPadding:C=l.innerPadding,cap:w=l.cap,forceShowCap:x=l.forceShowCap}=t.attribute;let{outerRadius:_=l.outerRadius,innerRadius:S=l.innerRadius}=t.attribute;_+=y,S-=C;let A=0;const B=(nt(w)&&w||w[0])&&"conical"===h.gradient;if(B){const{sc:e,startAngle:i,endAngle:n}=t.getParsedAngle();re(n-i)<oe-te&&(A=e||0,h.startAngle-=A,h.endAngle-=A)}let T=!1;const{isFullStroke:R,stroke:k}=(t=>{var e;let i=!0;if(nt(t,!0)){for(let n=0;n<4;n++)gr[n]=t,i&&(i=!(null!==(e=gr[n])&&void 0!==e&&!e));i=t}else if(Array.isArray(t))for(let e=0;e<4;e++)gr[e]=!!t[e],i&&(i=!!gr[e]);else gr[0]=!1,gr[1]=!1,gr[2]=!1,gr[3]=!1;return{isFullStroke:i,stroke:gr}})(d);if(b||R){e.beginPath(),el(t,e,i,n,_,S),T=!0,e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,n,b,m,f,v,l,o,s,a);const r=()=>{b&&(s?s(e,t.attribute,l):f&&(e.setCommonStyle(t,t.attribute,c-i,u-n,l),e.fill()))},h=()=>{m&&R&&(a?a(e,t.attribute,l):v&&(e.setStrokeStyle(t,t.attribute,c-i,u-n,l),e.stroke()))};g?(h(),r()):(r(),h())}if(!R&&m&&(e.beginPath(),el(t,e,i,n,_,S,k),T||this.beforeRenderStep(t,e,i,n,b,m,f,v,l,o,s,a),a?a(e,t.attribute,l):v&&(e.setStrokeStyle(t,t.attribute,i,n,l),e.stroke())),(nt(w)&&w||w[1])&&x){const{startAngle:r,endAngle:h}=t.getParsedAngle();if(re(h-r)>=oe-te){e.beginPath();const r=Math.abs(_-S)/2/_,{endAngle:h=l.endAngle,fill:d=l.fill}=t.attribute,c=h;this.drawArcTailCapPath(t,e,i,n,_,S,c,c+r),T||this.beforeRenderStep(t,e,i,n,b,m,f,v,l,o,s,a);const u=()=>{if(b){const o=d;if("conical"===o.gradient){const r=function(t,e,i,n){const{stops:o,startAngle:r,endAngle:s}=n;for(;i<0;)i+=oe;for(;i>oe;)i-=oe;if(i<r)return o[0].color;if(i>s)return o[0].color;let a,l,h=(i-r)/(s-r);for(let t=0;t<o.length;t++)if(o[t].offset>=h){a=o[t-1],l=o[t];break}return h=(h-a.offset)/(l.offset-a.offset),Mr(a.color,l.color,h,!1)}(0,0,h,o);s||Ka&&(e.setCommonStyle(t,t.attribute,i,n,l),e.fillStyle=r,e.fill())}}},g=()=>{m&&(a||v&&(e.setStrokeStyle(t,t.attribute,i,n,l),e.stroke()))};u(),g()}}this.afterRenderStep(t,e,i,n,b,m,f,v,l,o,s,a),B&&(h.startAngle+=A,h.endAngle+=A)}draw(t,e,i,n){const o=zo(t,null==n?void 0:n.theme).arc;this._draw(t,o,!1,i,n)}};hd=sd([w(),ld(0,y(F)),ld(0,x(rl)),ad("design:paramtypes",[Object])],hd);var dd=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},cd=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ud=function(t,e){return function(i,n){e(i,n,t)}};let gd=class extends rd{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=ha,this.builtinContributions=[Dh,Nh,Wh],this.init(t)}drawShape(t,e,i,n,o,r,s,a){const l=zo(t,null==r?void 0:r.theme).circle,{radius:h=l.radius,startAngle:d=l.startAngle,endAngle:c=l.endAngle,x:u=l.x,y:g=l.y,fillStrokeOrder:p=l.fillStrokeOrder}=t.attribute,f=this.valid(t,l,s,a);if(!f)return;const{fVisible:v,sVisible:b,doFill:m,doStroke:y}=f;e.beginPath(),e.arc(i,n,h,d,c),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,n,m,y,v,b,l,o,s,a);const C=()=>{m&&(s?s(e,t.attribute,l):v&&(e.setCommonStyle(t,t.attribute,u-i,g-n,l),e.fill()))},w=()=>{y&&(a?a(e,t.attribute,l):b&&(e.setStrokeStyle(t,t.attribute,u-i,g-n,l),e.stroke()))};p?(w(),C()):(C(),w()),this.afterRenderStep(t,e,i,n,m,y,v,b,l,o,s,a)}draw(t,e,i,n){const o=zo(t,null==n?void 0:n.theme).circle;this._draw(t,o,!1,i,n)}};function pd(t,e,i,n){if(!e.p1)return;const{offsetX:o=0,offsetY:r=0,offsetZ:s=0}=n||{};if(1===i)e.p2&&e.p3?t.bezierCurveTo(o+e.p1.x,r+e.p1.y,o+e.p2.x,r+e.p2.y,o+e.p3.x,r+e.p3.y,s):t.lineTo(o+e.p1.x,r+e.p1.y,s);else if(e.p2&&e.p3){const[n]=Ni(e,i);t.bezierCurveTo(o+n.p1.x,r+n.p1.y,o+n.p2.x,r+n.p2.y,o+n.p3.x,r+n.p3.y,s)}else{const n=e.getPointAt(i);t.lineTo(o+n.x,r+n.y,s)}}function fd(t,e,i,n,o,r,s){var a;let l=e.p0,h=n;if(i&&i.originP1===i.originP2&&(l=i.p0),e.defined)n||(t.lineTo(l.x+o,l.y+r,s),h=!n);else{const{originP1:d,originP2:c}=e;let u;if(d&&!1!==d.defined&&!i?u=l:d&&!1!==c.defined&&(u=null!==(a=e.p3)&&void 0!==a?a:e.p1),n){h=!n;const i=u?u.x:e.p0.x,a=u?u.y:e.p0.y;t.moveTo(i+o,a+r,s)}else u&&(h=!n,t.lineTo(u.x+o,u.y+r,s))}return h}function vd(t,e,i,n,o){const{offsetX:r=0,offsetY:s=0,offsetZ:a=0,mode:l="none",drawConnect:h=!1}=o||{};if(h&&"none"===l)return;if(!e)return;let d=!0;const{curves:c}=e;if(i>=1){if(h){let e,i=!0;c.forEach(((n,o)=>{n.originP1!==n.originP2?(i=fd(t,n,e,i,r,s,a),e=n):e=n}))}else c.forEach((e=>{e.defined?(d&&t.moveTo(e.p0.x+r,e.p0.y+s,a),pd(t,e,1,o),d=!1):d=!0}));return}if(i<=0)return;let u;"x"===n?u=Ti.ROW:"y"===n?u=Ti.COLUMN:"auto"===n&&(u=e.direction);const g=i*e.tryUpdateLength(u);let p=0,f=!0,v=null;for(let e=0,i=c.length;e<i;e++){const i=c[e],n=i.getLength(u),l=(g-p)/n;if(p+=n,l<0)break;if(h){if(i.originP1===i.originP2){v=i;continue}f=fd(t,i,v,f,r,s,a),v=i}else{if(!i.defined){d=!0;continue}d&&t.moveTo(i.p0.x+r,i.p0.y+s,a),pd(t,i,he(l,1),o),d=!1}}}gd=dd([w(),ud(0,y(F)),ud(0,x(al)),cd("design:paramtypes",[Object])],gd);var bd=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let md=class extends rd{constructor(){super(...arguments),this.numberType=ua}draw(t,e,i,n){const o=zo(t,null==n?void 0:n.theme).line;this._draw(t,o,!1,i,n)}drawSegmentItem(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p){var f;if(!e)return;t.beginPath();const v=null!==(f=this.z)&&void 0!==f?f:0;vd(t.camera?t:t.nativeContext,e,l,h,{offsetX:d,offsetY:c,offsetZ:v}),u.cache&&!ut(u.cache)&&u.cache.curves.every((t=>t.defined))&&u.attribute.curveType&&u.attribute.curveType.includes("Closed")&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(u,s,a);const{x:b=0,x:m=0}=s;return!1!==i&&(g?g(t,s,a):o&&(t.setCommonStyle(u,s,b-d,m-c,a),t.fill())),!1!==n&&(p?p(t,s,a):r&&(t.setStrokeStyle(u,s,b-d,m-c,a),t.stroke())),!1}drawLinearLineHighPerformance(t,e,i,n,o,r,s,a,l,h,d,c,u){var g;e.beginPath();const p=null!==(g=this.z)&&void 0!==g?g:0,{points:f}=t.attribute,v=f[0];e.moveTo(v.x+s,v.y+a,p);for(let t=1;t<f.length;t++){const i=f[t];e.lineTo(i.x+s,i.y+a,p)}e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l);const{x:b=0,x:m=0}=t.attribute;!1!==i&&(c?c(e,t.attribute,l):o&&(e.setCommonStyle(t,t.attribute,b-s,m-a,l),e.fill())),!1!==n&&(u?u(e,t.attribute,l):r&&(e.setStrokeStyle(t,t.attribute,b-s,m-a,l),e.stroke()))}drawShape(t,e,i,n,o,r,s,a){const l=zo(t,null==r?void 0:r.theme).line,{fill:h=l.fill,stroke:d=l.stroke,fillOpacity:c=l.fillOpacity,strokeOpacity:u=l.strokeOpacity,segments:g,points:p,closePath:f,curveTension:v=l.curveTension,connectedType:b=l.connectedType}=t.attribute;if(!this.valid(t,l,s,a))return;let{curveType:m=l.curveType}=t.attribute;f&&"linear"===m&&(m="linearClosed");const{clipRange:y=l.clipRange,clipRangeByDimension:C=l.clipRangeByDimension}=t.attribute;if(1===y&&!g&&!p.some((t=>!1===t.defined))&&"linear"===m)return this.drawLinearLineHighPerformance(t,e,!!h,!!d,c,u,i,n,l,o,r,s,a);function w(t,e){return"none"===e?t:t.filter((t=>!1!==t.defined))}if(t.shouldUpdateShape()){const{points:e,segments:i}=t.attribute,n=e;if(i&&i.length){let e,n;if(t.cache=i.map(((t,i)=>{if(t.points.length<=1&&0===i)return t.points[0]&&(n={endX:t.points[0].x,endY:t.points[0].y,curves:[{defined:!1!==t.points[0].defined}]}),null;1===i?e={x:n.endX,y:n.endY,defined:n.curves[n.curves.length-1].defined}:i>1&&(e.x=n.endX,e.y=n.endY,e.defined=n.curves[n.curves.length-1].defined);const o=Cn(w(t.points,b),m,{startPoint:e,curveTension:v});return n=o,o})).filter((t=>!!t)),"linearClosed"===m){let e;for(let i=0;i<t.cache.length;i++){const n=t.cache[i];for(let t=0;t<n.curves.length;t++)if(n.curves[t].defined){e=n.curves[t].p0;break}if(e)break}t.cache[t.cache.length-1]&&t.cache[t.cache.length-1].lineTo(e.x,e.y,!0)}}else{if(!e||!e.length)return t.cache=null,void t.clearUpdateShapeTag();t.cache=Cn(w(n,b),m,{curveTension:v})}t.clearUpdateShapeTag()}if(Array.isArray(t.cache)){const o=t.attribute.segments.filter((t=>t.points.length));if(1===o[0].points.length&&o.shift(),1===y){let r=!1;t.cache.forEach(((g,p)=>{r||(r=this.drawSegmentItem(e,g,!!h,!!d,c,u,o[p],[l,t.attribute],y,C,i,n,t,s,a))}))}else{const r=t.cache.reduce(((t,e)=>t+e.getLength()),0),g=y*r;let p=0,f=!1;t.cache.forEach(((r,v)=>{if(f)return;const b=r.getLength(),m=(g-p)/b;p+=b,m>0&&(f=this.drawSegmentItem(e,r,!!h,!!d,c,u,o[v],[l,t.attribute],he(m,1),C,i,n,t,s,a))}))}}else this.drawSegmentItem(e,t.cache,!!h,!!d,c,u,t.attribute,l,y,C,i,n,t,s,a)}};function yd(t,e,i,n){const{offsetX:o=0,offsetY:r=0,offsetZ:s=0}=n||{};let a=!0;e.forEach((e=>{e.defined?(a&&t.moveTo(e.p0.x+o,e.p0.y+r,s),pd(t,e,1,n),a=!1):a=!0})),a=!0;for(let e=i.length-1;e>=0;e--){const l=i[e];l.defined?(a&&t.lineTo(l.p0.x+o,l.p0.y+r,s),pd(t,l,1,n),a=!1):a=!0}t.closePath()}md=bd([w()],md);const Cd=new class extends Hh{constructor(){super(...arguments),this.time=ki.afterFillStroke}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){var g,p,f,v;this.textureMap||this.initTextureMap(e,t.stage);const{attribute:b=t.attribute}=u||{},{texture:m=(null!==(g=t.attribute.texture)&&void 0!==g?g:wr(l,"texture")),textureColor:y=(null!==(p=t.attribute.textureColor)&&void 0!==p?p:wr(l,"textureColor")),textureSize:C=(null!==(f=t.attribute.textureSize)&&void 0!==f?f:wr(l,"textureSize")),texturePadding:w=(null!==(v=t.attribute.texturePadding)&&void 0!==v?v:wr(l,"texturePadding"))}=b;m&&this.drawTexture(m,t,e,i,n,l,y,C,w)}},wd=Mh;var xd=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},_d=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Sd=function(t,e){return function(i,n){e(i,n,t)}};let Ad=class extends rd{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=la,this.builtinContributions=[Cd,wd],this.init(t)}drawLinearAreaHighPerformance(t,e,i,n,o,r,s,a,l,h,d,c,u){var g,p,f;const{points:v}=t.attribute;if(v.length<2)return;e.beginPath();const b=null!==(g=this.z)&&void 0!==g?g:0,m=v[0];e.moveTo(m.x+s,m.y+a,b);for(let t=1;t<v.length;t++){const i=v[t];e.lineTo(i.x+s,i.y+a,b)}for(let t=v.length-1;t>=0;t--){const i=v[t];e.lineTo((null!==(p=i.x1)&&void 0!==p?p:i.x)+s,(null!==(f=i.y1)&&void 0!==f?f:i.y)+a,b)}e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,s,a,!!o,!1,i,!1,l,h,c,null,{attribute:t.attribute});const{x:y=0,x:C=0}=t.attribute;!1!==i&&(c?c(e,t.attribute,l):o&&(e.setCommonStyle(t,t.attribute,y-s,C-a,l),e.fill())),this.afterRenderStep(t,e,s,a,!!o,!1,i,!1,l,h,c,null,{attribute:t.attribute}),(()=>{var i,o;if(n){const{stroke:n=l&&l.stroke}=t.attribute;if(ut(n)&&(n[0]||n[2])&&!1===n[1])if(e.beginPath(),n[0]){e.moveTo(m.x+s,m.y+a,b);for(let t=1;t<v.length;t++){const i=v[t];e.lineTo(i.x+s,i.y+a,b)}}else if(n[2]){const t=v[v.length-1];e.moveTo(t.x+s,t.y+a,b);for(let t=v.length-2;t>=0;t--){const n=v[t];e.lineTo((null!==(i=n.x1)&&void 0!==i?i:n.x)+s,(null!==(o=n.y1)&&void 0!==o?o:n.y)+a,b)}}u?u(e,t.attribute,l):(e.setStrokeStyle(t,t.attribute,y-s,C-a,l),e.stroke())}})()}drawShape(t,e,i,n,o,r,s,a){var l,h,d,c,u,g;const p=zo(t,null==r?void 0:r.theme).area,{fill:f=p.fill,stroke:v=p.stroke,fillOpacity:b=p.fillOpacity,z:m=p.z,strokeOpacity:y=p.strokeOpacity,curveTension:C=p.curveTension,connectedType:w=p.connectedType}=t.attribute,x=this.valid(t,p,s,a);if(!x)return;const{doFill:_}=x,S=x.doStroke&&x.sVisible,{clipRange:A=p.clipRange,closePath:B,points:T,segments:R}=t.attribute;let{curveType:k=p.curveType}=t.attribute;function M(t,e){return"connect"!==e?t:t.filter((t=>!1!==t.defined))}if(B&&"linear"===k&&(k="linearClosed"),1===A&&!R&&!T.some((t=>!1===t.defined))&&"linear"===k)return this.drawLinearAreaHighPerformance(t,e,!!f,S,b,y,i,n,p,o,r,s,a);if(t.shouldUpdateShape()){if(R&&R.length){let e,i;const n=R.map(((t,n)=>{if(t.points.length<=1&&0===n)return t.points[0]&&(i={endX:t.points[0].x,endY:t.points[0].y}),null;1===n?e={x:i.endX,y:i.endY}:n>1&&(e.x=i.endX,e.y=i.endY);const o=Cn(M(t.points,w),k,{startPoint:e,curveTension:C});return i=o,o})).filter((t=>!!t));let o;const r=[];for(let t=R.length-1;t>=0;t--){const e=R[t].points,i=[];for(let t=e.length-1;t>=0;t--)i.push({x:null!==(l=e[t].x1)&&void 0!==l?l:e[t].x,y:null!==(h=e[t].y1)&&void 0!==h?h:e[t].y});if(0!==t){const e=R[t-1].points,n=e[e.length-1];n&&i.push({x:null!==(d=n.x1)&&void 0!==d?d:n.x,y:null!==(c=n.y1)&&void 0!==c?c:n.y})}i.length>1&&(o=Cn(M(i,w),"stepBefore"===k?"stepAfter":"stepAfter"===k?"stepBefore":k,{curveTension:C}),r.unshift(o))}t.cacheArea=r.map(((t,e)=>({top:n[e],bottom:t})))}else{if(!T||!T.length)return t.cacheArea=null,void t.clearUpdateShapeTag();{const e=M(T,w),i=[];for(let t=e.length-1;t>=0;t--)i.push({x:null!==(u=e[t].x1)&&void 0!==u?u:e[t].x,y:null!==(g=e[t].y1)&&void 0!==g?g:e[t].y});const n=Cn(e,k,{curveTension:C}),o=Cn(i,"stepBefore"===k?"stepAfter":"stepAfter"===k?"stepBefore":k,{curveTension:C});t.cacheArea={top:n,bottom:o}}}t.clearUpdateShapeTag()}if(Array.isArray(t.cacheArea)){const r=t.attribute.segments.filter((t=>t.points.length));if(1===r[0].points.length&&r.shift(),1===A){let l=!1;t.cacheArea.forEach(((h,d)=>{l||(l=this.drawSegmentItem(e,h,_,b,S,y,r[d],[p,t.attribute],A,i,n,m,t,o,s,a))}))}else{const l=t.cacheArea.reduce(((t,e)=>t+e.top.getLength()),0),h=A*l;let d=0,c=!1;t.cacheArea.forEach(((l,u)=>{if(c)return;const g=l.top.getLength(),f=(h-d)/g;d+=g,f>0&&(c=this.drawSegmentItem(e,l,_,b,S,y,r[u],[p,t.attribute],he(f,1),i,n,m,t,o,s,a))}))}}else this.drawSegmentItem(e,t.cacheArea,_,b,S,y,t.attribute,p,A,i,n,m,t,o,s,a)}draw(t,e,i,n){const o=zo(t,null==n?void 0:n.theme).area;this._draw(t,o,!1,i,n)}drawSegmentItem(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f){return this._drawSegmentItem(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f)}_drawSegmentItem(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f){if(!(e&&e.top&&e.bottom&&e.top.curves&&e.top.curves.length&&e.bottom.curves&&e.bottom.curves.length))return;t.beginPath();const{points:v,segments:b}=u.attribute;let m,y,C=Ti.ROW;if(b){const t=b[b.length-1];y=b[0].points[0],m=t.points[t.points.length-1]}else y=v[0],m=v[v.length-1];const w=re(m.x-y.x),x=re(m.y-y.y);C=null==m.x1?Ti.ROW:null==m.y1?Ti.COLUMN:Number.isFinite(w+x)?w>x?Ti.ROW:Ti.COLUMN:Ti.ROW,function(t,e,i,n){var o;const{top:r,bottom:s}=e;if(r.curves.length!==s.curves.length)return;if(i>=1){const e=[],i=[];let o=!0;for(let a=0,l=r.curves.length;a<l;a++){const h=r.curves[a];o!==h.defined?(o?(yd(t,e,i,n),e.length=0,i.length=0):(e.push(h),i.push(s.curves[l-a-1])),o=!o):o&&(e.push(h),i.push(s.curves[l-a-1]))}return void yd(t,e,i,n)}if(i<=0)return;let{direction:a}=n||{};const{curves:l}=r,h=null!==(o=l[l.length-1].p3)&&void 0!==o?o:l[l.length-1].p1,d=re(h.x-l[0].p0.x),c=re(h.y-l[0].p0.y);a=null!=a?a:d>c?Ti.ROW:Ti.COLUMN,Number.isFinite(d)||(a=Ti.COLUMN),Number.isFinite(c)||(a=Ti.ROW);const u=i*(a===Ti.ROW?d:c);let g=0,p=!0;const f=[],v=[];for(let e=0,i=r.curves.length;e<i;e++){const o=r.curves[e],l=o.getLength(a),h=(u-g)/l;if(h<0)break;g+=l;let d=null,c=null;p!==o.defined?(p?(yd(t,f,v,n),f.length=0,v.length=0):(d=o,c=s.curves[i-e-1]),p=!p):p&&(d=o,c=s.curves[i-e-1]),d&&c&&(h<1&&(d=d.p2&&d.p3?Ni(d,h)[0]:ji(d,h)[0],c=c.p2&&c.p3?Ni(c,1-h)[1]:ji(c,1-h)[1]),d.defined=p,c.defined=p,f.push(d),v.push(c)),d=null,c=null}yd(t,f,v,n)}(t.camera?t:t.nativeContext,e,l,{offsetX:h,offsetY:d,offsetZ:c,direction:C}),this.beforeRenderStep(u,t,h,d,!!n,!1,i,!1,a,g,p,null,{attribute:s}),t.setShadowBlendStyle&&t.setShadowBlendStyle(u,s,a);const{x:_=0,x:S=0}=s;return!1!==i&&(p?p(t,s,a):n&&(t.setCommonStyle(u,s,_-h,S-d,a),t.fill())),this.afterRenderStep(u,t,h,d,!!n,!1,i,!1,a,g,p,null,{attribute:s}),(()=>{if(!1!==o)if(f)f(t,s,a);else{const{stroke:i=a&&a[1]&&a[1].stroke}=s;ut(i)&&(i[0]||i[2])&&!1===i[1]&&(t.beginPath(),vd(t.camera?t:t.nativeContext,i[0]?e.top:e.bottom,l,C===Ti.ROW?"x":"y",{offsetX:h,offsetY:d,offsetZ:c})),t.setStrokeStyle(u,s,_-h,S-d,a),t.stroke()}})(),!1}};Ad=xd([w(),Sd(0,y(F)),Sd(0,x(sl)),_d("design:paramtypes",[Object])],Ad);const Bd=Oh,Td=Mh;var Rd=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},kd=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Md=function(t,e){return function(i,n){e(i,n,t)}};let Ld=class extends rd{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=ga,this.builtinContributions=[Td,Bd],this.init(t)}drawShape(t,e,i,n,o,r,s,a){var l,h,d;const c=null!==(l=this.tempTheme)&&void 0!==l?l:zo(t,null==r?void 0:r.theme).path,{x:u=c.x,y:g=c.y,fillStrokeOrder:p=c.fillStrokeOrder}=t.attribute,f=null!==(h=this.z)&&void 0!==h?h:0,v=this.valid(t,c,s,a);if(!v)return;const{fVisible:b,sVisible:m,doFill:y,doStroke:C}=v;if(e.beginPath(),t.pathShape)Ei(t.pathShape.commandList,e,i,n,1,1,f);else{Ei((null!==(d=t.attribute.path)&&void 0!==d?d:c.path).commandList,e,i,n,1,1,f)}e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,c),this.beforeRenderStep(t,e,i,n,y,C,b,m,c,o,s,a);const w=()=>{C&&(a?a(e,t.attribute,c):m&&(e.setStrokeStyle(t,t.attribute,u-i,g-n,c),e.stroke()))},x=()=>{y&&(s?s(e,t.attribute,c):b&&(e.setCommonStyle(t,t.attribute,u-i,g-n,c),e.fill()))};p?(w(),x()):(x(),w()),this.afterRenderStep(t,e,i,n,y,C,b,m,c,o,s,a)}draw(t,e,i,n){const o=zo(t,null==n?void 0:n.theme).path;this.tempTheme=o,this._draw(t,o,!1,i,n),this.tempTheme=null}};Ld=Rd([w(),Md(0,y(F)),Md(0,x(dl)),kd("design:paramtypes",[Object])],Ld);var Pd=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ed=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Hd=function(t,e){return function(i,n){e(i,n,t)}};let Od=class extends rd{constructor(t){super(),this.graphicRenderContributions=t,this.type="rect",this.numberType=fa,this.builtinContributions=[Kh,Zh,qh],this.init(t)}drawShape(t,e,i,n,o,r,s,a){var l;const h=null!==(l=this.tempTheme)&&void 0!==l?l:zo(t,null==r?void 0:r.theme).rect,{fill:d=h.fill,background:c,stroke:u=h.stroke,cornerRadius:g=h.cornerRadius,cornerType:p=h.cornerType,opacity:f=h.opacity,fillOpacity:v=h.fillOpacity,lineWidth:b=h.lineWidth,strokeOpacity:m=h.strokeOpacity,visible:y=h.visible,x1:C,y1:w,x:x=h.x,y:_=h.y,fillStrokeOrder:S=h.fillStrokeOrder}=t.attribute;let{width:A,height:B}=t.attribute;A=(null!=A?A:C-x)||0,B=(null!=B?B:w-_)||0;const T=qa(f,v,A,B,d),R=Ja(f,m,A,B),k=$a(d,c),M=Ya(u,b);if(!t.valid||!y)return;if(!k&&!M)return;if(!(T||R||s||a||c))return;0===g||ut(g)&&g.every((t=>0===t))?(e.beginPath(),e.rect(i,n,A,B)):(e.beginPath(),Vh(e,i,n,A,B,g,"bevel"!==p));const L={doFill:k,doStroke:M};e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,n,k,M,T,R,h,o,s,a,L);const P=()=>{L.doFill&&(s?s(e,t.attribute,h):T&&(e.setCommonStyle(t,t.attribute,x-i,_-n,h),e.fill()))},E=()=>{L.doStroke&&(a?a(e,t.attribute,h):R&&(e.setStrokeStyle(t,t.attribute,x-i,_-n,h),e.stroke()))};S?(E(),P()):(P(),E()),this.afterRenderStep(t,e,i,n,k,M,T,R,h,o,s,a)}draw(t,e,i,n){const o=zo(t,null==n?void 0:n.theme).rect;this.tempTheme=o,this._draw(t,o,!1,i,n),this.tempTheme=null}};Od=Pd([w(),Hd(0,y(F)),Hd(0,x(ul)),Ed("design:paramtypes",[Object])],Od);var Id=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Fd=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},zd=function(t,e){return function(i,n){e(i,n,t)}};let Dd=class extends rd{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=ba,this.builtinContributions=[td,nd,id,ed],this.init(t)}drawShape(t,e,i,n,o,r,s,a){var l;const h=zo(t,null==r?void 0:r.theme).symbol,{size:d=h.size,x:c=h.x,y:u=h.y,scaleX:g=h.scaleX,scaleY:p=h.scaleY,fillStrokeOrder:f=h.fillStrokeOrder,clipRange:v=h.clipRange}=t.attribute,b=this.valid(t,h,s,a);if(!b)return;const{fVisible:m,sVisible:y,doFill:C,doStroke:w}=b,x=t.getParsedPath();if(!x)return;const{keepDirIn3d:_=h.keepDirIn3d}=t.attribute,S=null!==(l=this.z)&&void 0!==l?l:0;e.beginPath();let A=i,B=n,T=S;const R=e.camera;if(_&&R&&e.project){const t=e.project(i,n,S);e.camera=null,ut(d)&&(d[0],d[1]),A=t.x,B=t.y,T=void 0}!1===x.draw(e,d,A,B,T,((o,r)=>{var l,d,b,m;if(t._parsedPath.svgCache){const e=Object.assign({},r);e.fill=null!==(l=r.fill)&&void 0!==l?l:t.attribute.fill,e.opacity=null!==(d=r.opacity)&&void 0!==d?d:t.attribute.opacity,e.fillOpacity=t.attribute.fillOpacity,e.stroke=null!==(b=r.stroke)&&void 0!==b?b:t.attribute.stroke,e.lineWidth=null!==(m=r.lineWidth)&&void 0!==m?m:t.attribute.lineWidth,r=e}const C=()=>{r.fill&&(s?s(e,t.attribute,h):(e.setCommonStyle(t,r,c-i,u-n,h),e.fill()))},w=()=>{r.stroke&&(a?a(e,t.attribute,h):y&&v>=1&&(e.setStrokeStyle(t,r,(c-i)/g,(u-n)/p,h),e.stroke()))};f?(w(),C()):(C(),w())}))&&e.closePath(),e.camera=R,e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,n,C,w,m,y,h,o,s,a);const k=()=>{C&&!x.isSvg&&(s?s(e,t.attribute,h):m&&(e.setCommonStyle(t,t.attribute,c-i,u-n,h),e.fill()))},M=()=>{w&&!x.isSvg&&(a?a(e,t.attribute,h):y&&v>=1&&(e.setStrokeStyle(t,t.attribute,(c-i)/g,(u-n)/p,h),e.stroke()))};f?(M(),k()):(k(),M()),this.afterRenderStep(t,e,i,n,C,w,m,y,h,o,s,a)}draw(t,e,i,n){const o=zo(t,null==n?void 0:n.theme).symbol;this._draw(t,o,!1,i,n)}};Dd=Id([w(),zd(0,y(F)),zd(0,x(gl)),Fd("design:paramtypes",[Object])],Dd);const Wd=new class{constructor(){this.pools=[];for(let t=0;t<10;t++)this.pools.push(new Fe)}allocate(t,e,i,n){if(!this.pools.length)return(new Fe).setValue(t,e,i,n);const o=this.pools.pop();return o.x1=t,o.y1=e,o.x2=i,o.y2=n,o}allocateByObj(t){if(!this.pools.length)return new Fe(t);const e=this.pools.pop();return e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}};const Nd=new class extends kh{constructor(){super(...arguments),this.time=ki.beforeFillStroke}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){var u,g,p,f,v,b,m,y,C,w;const{backgroundMode:x=l.backgroundMode,backgroundFit:_=l.backgroundFit,backgroundKeepAspectRatio:S=l.backgroundKeepAspectRatio}=t.attribute;let A,{background:B}=t.attribute;if(!B)return;const T=()=>{"richtext"===t.type&&(e.restore(),e.save(),A&&e.setTransformFromMatrix(A,!0,1))};let R;"richtext"===t.type&&(A=e.currentMatrix.clone(),e.restore(),e.save(),e.setTransformForCurrent());const k=at(B)&&B.background,M=t.transMatrix.onlyTranslate();if(k){const e=t.AABBBounds,i=(null!==(u=B.x)&&void 0!==u?u:e.x1)+(null!==(g=B.dx)&&void 0!==g?g:0),n=(null!==(p=B.y)&&void 0!==p?p:e.y1)+(null!==(f=B.dy)&&void 0!==f?f:0),o=null!==(v=B.width)&&void 0!==v?v:e.width(),r=null!==(b=B.height)&&void 0!==b?b:e.height();if(R=Wd.allocate(i,n,i+o,n+r),B=B.background,!M){const t=R.width(),e=R.height();R.set((null!==(m=B.x)&&void 0!==m?m:0)+(null!==(y=B.dx)&&void 0!==y?y:0),(null!==(C=B.y)&&void 0!==C?C:0)+(null!==(w=B.dy)&&void 0!==w?w:0),t,e)}}else R=t.AABBBounds,M||(R=Ah(Object.assign(Object.assign({},t.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(t.backgroundImg&&t.resources){const o=t.resources.get(B);if("success"!==o.state||!o.data)return void T();e.highPerformanceSave(),M&&e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.setCommonStyle(t,t.attribute,i,n,l),this.doDrawImage(e,o.data,R,{backgroundMode:x,backgroundFit:_,backgroundKeepAspectRatio:S}),e.highPerformanceRestore(),e.setTransformForCurrent()}else{const{backgroundCornerRadius:o}=t.attribute;e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,n,l),e.fillStyle=B,o?(Vh(e,R.x1,R.y1,R.width(),R.height(),o,!0),e.fill()):e.fillRect(R.x1,R.y1,R.width(),R.height()),e.highPerformanceRestore()}k&&Wd.free(R),T()}};var Gd=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},jd=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Vd=function(t,e){return function(i,n){e(i,n,t)}};let Ud=class extends rd{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=ma,this.builtinContributions=[Nd],this.init(t)}drawShape(t,e,i,n,o,r,s,a){var l,h,d;const c=zo(t,null==r?void 0:r.theme).text,{text:u,underline:g=c.underline,lineThrough:p=c.lineThrough,keepDirIn3d:f=c.keepDirIn3d,direction:v=c.direction,fontSize:b=c.fontSize,verticalMode:m=c.verticalMode,x:y=c.x,y:C=c.y}=t.attribute,w=null!==(l=Sr(t.attribute.lineHeight,b))&&void 0!==l?l:b,x=this.valid(t,c,s,a);if(!x)return;const{fVisible:_,sVisible:S,doFill:A,doStroke:B}=x,T=!f,R=this.z||0;e.beginPath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,c),this.beforeRenderStep(t,e,i,n,A,B,_,S,c,o,s,a),T&&this.transformUseContext2d(t,c,R,e);const k=(o,r,l,h)=>{let d=i+r;const u=n+l;if(h){e.highPerformanceSave(),d+=b;const t=Sl.allocate(1,0,0,1,0,0);t.rotateByCenter(Math.PI/2,d,u),e.transformFromMatrix(t,!0),Sl.free(t)}B&&(a?a(e,t.attribute,c):S&&(e.setStrokeStyle(t,t.attribute,y-i,C-n,c),e.strokeText(o,d,u,R))),A&&(s?s(e,t.attribute,c):_&&(e.setCommonStyle(t,t.attribute,y-i,C-n,c),e.fillText(o,d,u,R))),h&&(e.highPerformanceRestore(),e.setTransformForCurrent())};if(e.setTextStyleWithoutAlignBaseline(t.attribute,c,R),"horizontal"===v){const{multilineLayout:o}=t;if(!o)return void e.highPerformanceRestore();const{xOffset:r,yOffset:l}=o.bbox;B&&(a?a(e,t.attribute,c):S&&(e.setStrokeStyle(t,t.attribute,y-i,C-n,c),o.lines.forEach((t=>{e.strokeText(t.str,(t.leftOffset||0)+r+i,(t.topOffset||0)+l+n,R)})))),A&&(s?s(e,t.attribute,c):_&&(e.setCommonStyle(t,t.attribute,y-i,C-n,c),o.lines.forEach((o=>{e.fillText(o.str,(o.leftOffset||0)+r+i,(o.topOffset||0)+l+n,R),this.drawUnderLine(g,p,t,(o.leftOffset||0)+r+i,(o.topOffset||0)+l+n,o.descent,(o.descent-o.ascent)/2,R,c,e,{width:o.width})}))))}else{let{textAlign:i=c.textAlign,textBaseline:n=c.textBaseline}=t.attribute;if(!m){const e=i;i=null!==(h=t.getBaselineMapAlign()[n])&&void 0!==h?h:"left",n=null!==(d=t.getAlignMapBaseline()[e])&&void 0!==d?d:"top"}t.tryUpdateAABBBounds();const o=t.cache,{verticalList:r}=o;e.textAlign="left",e.textBaseline="top";const s=w*r.length;let a=0;r.forEach((t=>{const e=t.reduce(((t,e)=>t+(e.width||0)),0);a=le(e,a)}));let l=0,u=0;"bottom"===n?u=-s:"middle"===n&&(u=-s/2),"center"===i?l-=a/2:"right"===i&&(l-=a),r.forEach(((t,e)=>{const n=t.reduce(((t,e)=>t+(e.width||0)),0),o=a-n;let r=l;"center"===i?r+=o/2:"right"===i&&(r+=o),t.forEach((t=>{const{text:i,width:n,direction:o}=t;k(i,s-(e+1)*w+u,r,o),r+=n}))}))}T&&this.restoreTransformUseContext2d(t,c,R,e),this.afterRenderStep(t,e,i,n,A,B,_,S,c,o,s,a)}draw(t,e,i,n){const o=zo(t,null==n?void 0:n.theme).text,{keepDirIn3d:r=o.keepDirIn3d}=t.attribute,s=!r;this._draw(t,o,s,i,n)}drawUnderLine(t,e,i,n,o,r,s,a,l,h,d){if(e+t<=0)return;const{textAlign:c=l.textAlign,fill:u=l.fill,opacity:g=l.opacity,underlineOffset:p=l.underlineOffset,underlineDash:f=l.underlineDash,fillOpacity:v=l.fillOpacity}=i.attribute,b=!rt(d),m=b?d.width:i.clipedWidth,y=b?0:vl(c,m),C={lineWidth:0,stroke:u,opacity:g,strokeOpacity:v};if(t){C.lineWidth=t,h.setStrokeStyle(i,C,n,o,l),f&&h.setLineDash(f),h.beginPath();const e=o+r+p;h.moveTo(n+y,e,a),h.lineTo(n+y+m,e,a),h.stroke()}if(e){C.lineWidth=e,h.setStrokeStyle(i,C,n,o,l),h.beginPath();const t=o+s;h.moveTo(n+y,t,a),h.lineTo(n+y+m,t,a),h.stroke()}}};function Xd(t,e,i,n){t.moveTo(e[0].x+i,e[0].y+n);for(let o=1;o<e.length;o++)t.lineTo(e[o].x+i,e[o].y+n)}function $d(t,e){return Math.sqrt(t*t+e*e)}function Yd(t,e,i,n,o){const r=e/i;return{x:t.x-n*r,y:t.y-o*r}}Ud=Gd([w(),Vd(0,y(F)),Vd(0,x(pl)),jd("design:paramtypes",[Object])],Ud);const Kd=Oh,qd=Mh;var Zd=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Jd=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Qd=function(t,e){return function(i,n){e(i,n,t)}};let tc=class extends rd{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=pa,this.builtinContributions=[qd,Kd],this.init(t)}drawShape(t,e,i,n,o,r,s,a){const l=zo(t,null==r?void 0:r.theme).polygon,{points:h=l.points,cornerRadius:d=l.cornerRadius,x:c=l.x,y:u=l.y,closePath:g=l.closePath,fillStrokeOrder:p=l.fillStrokeOrder}=t.attribute,f=this.valid(t,l,s,a);if(!f)return;const{fVisible:v,sVisible:b,doFill:m,doStroke:y}=f;e.beginPath(),d<=0||ut(d)&&d.every((t=>0===t))?Xd(e.camera?e:e.nativeContext,h,i,n):function(t,e,i,n,o){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];var s;if(e.length<3)return void Xd(t,e,i,n);let a=0,l=e.length-1;r||(a+=1,l-=1,t.moveTo(e[0].x+i,e[0].y+n));for(let r=a;r<=l;r++){const a=e[0===r?l:(r-1)%e.length],h=e[r%e.length],d=e[(r+1)%e.length],c=h.x-a.x,u=h.y-a.y,g=h.x-d.x,p=h.y-d.y,f=(Math.atan2(u,c)-Math.atan2(p,g))/2,v=Math.abs(Math.tan(f));let b=Array.isArray(o)?null!==(s=o[r%e.length])&&void 0!==s?s:0:o,m=b/v;const y=$d(c,u),C=$d(g,p),w=Math.min(y,C);m>w&&(m=w,b=w*v);const x=Yd(h,m,y,c,u),_=Yd(h,m,C,g,p),S=2*h.x-x.x-_.x,A=2*h.y-x.y-_.y,B=$d(S,A),T=Yd(h,$d(m,b),B,S,A);let R=Math.atan2(x.y-T.y,x.x-T.x);const k=Math.atan2(_.y-T.y,_.x-T.x);let M=k-R;M<0&&(R=k,M=-M),M>Math.PI&&(M-=Math.PI),0===r?t.moveTo(x.x+i,x.y+n):t.lineTo(x.x+i,x.y+n),M&&t.arcTo(h.x+i,h.y+n,_.x+i,_.y+n,b),t.lineTo(_.x+i,_.y+n)}r||t.lineTo(e[l+1].x+i,e[l+1].y+n)}(e.camera?e:e.nativeContext,h,i,n,d,g),g&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,n,m,y,v,b,l,o,s,a);const C=()=>{m&&(s?s(e,t.attribute,l):v&&(e.setCommonStyle(t,t.attribute,c-i,u-n,l),e.fill()))},w=()=>{y&&(a?a(e,t.attribute,l):b&&(e.setStrokeStyle(t,t.attribute,c-i,u-n,l),e.stroke()))};p?(w(),C()):(C(),w()),this.afterRenderStep(t,e,i,n,m,y,v,b,l,o,s,a)}draw(t,e,i,n){const o=zo(t,null==n?void 0:n.theme).polygon;this._draw(t,o,!1,i,n)}};tc=Zd([w(),Qd(0,y(F)),Qd(0,x(cl)),Jd("design:paramtypes",[Object])],tc);var ec=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ic=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},nc=function(t,e){return function(i,n){e(i,n,t)}};let oc=class{constructor(t){this.groupRenderContribitions=t,this.numberType=da}reInit(){this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(Gh)}drawShape(t,e,i,n,o,r,s,a){const l=zo(t,null==r?void 0:r.theme).group,{fill:h=l.fill,background:d,stroke:c=l.stroke,opacity:u=l.opacity,width:g=l.width,height:p=l.height,clip:f=l.clip,fillOpacity:v=l.fillOpacity,strokeOpacity:b=l.strokeOpacity,cornerRadius:m=l.cornerRadius,path:y=l.path,lineWidth:C=l.lineWidth,visible:w=l.visible,fillStrokeOrder:x=l.fillStrokeOrder,cornerType:_=l.cornerType,x:S=l.x,y:A=l.y}=t.attribute,B=qa(u,v,g,p,h),T=Ja(u,b,g,p),R=$a(h,d),k=Ya(c,C);if(!t.valid||!w)return;if(!f){if(!R&&!k)return;if(!(B||T||s||a||d))return}if(y&&y.length&&o.drawContribution){const t=e.disableFill,i=e.disableStroke,n=e.disableBeginPath;e.disableFill=!0,e.disableStroke=!0,e.disableBeginPath=!0,y.forEach((t=>{o.drawContribution.getRenderContribution(t).draw(t,o.renderService,o,r)})),e.disableFill=t,e.disableStroke=i,e.disableBeginPath=n}else 0===m||ut(m)&&m.every((t=>0===t))?(e.beginPath(),e.rect(i,n,g,p)):(e.beginPath(),Vh(e,i,n,g,p,m,"bevel"!==_));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(Gh));const M={doFill:R,doStroke:k};e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this._groupRenderContribitions.forEach((r=>{r.time===ki.beforeFillStroke&&r.drawShape(t,e,i,n,R,k,B,T,l,o,s,a,M)})),f&&e.clip();const L=()=>{M.doFill&&(s?s(e,t.attribute,l):B&&(e.setCommonStyle(t,t.attribute,S-i,A-n,l),e.fill()))},P=()=>{M.doStroke&&(a?a(e,t.attribute,l):T&&(e.setStrokeStyle(t,t.attribute,S-i,A-n,l),e.stroke()))};x?(P(),L()):(L(),P()),this._groupRenderContribitions.forEach((r=>{r.time===ki.afterFillStroke&&r.drawShape(t,e,i,n,R,k,B,T,l,o,s,a)}))}draw(t,e,i,n){const{context:o}=i;if(!o)return;const{clip:r,baseOpacity:s=1,drawMode:a,x:l,y:h,width:d,height:c}=t.attribute,u=o.nativeContext,g=o.canvas.nativeCanvas;if(a>0){const t=o.canvas,e=Pu.createCanvas({width:t.width,height:t.height,dpr:1}),i=e.getContext("2d"),n=o.nativeContext.getTransform();i.setTransform(n.a,n.b,n.c,n.d,n.e,n.f),1===a&&(i.save(),i.clearRect(0,0,t.width,t.height),i.beginPath(),i.rect(l,h,d,c),i.clip(),i.drawImage(t.nativeCanvas,0,0,t.width,t.height,0,0,t.displayWidth,t.displayHeight),i.restore()),o.nativeContext=i,t.nativeCanvas=e}r?o.save():o.highPerformanceSave();const p=o.baseGlobalAlpha;o.baseGlobalAlpha*=s;const f=zo(t,null==n?void 0:n.theme).group,v=o.modelMatrix;if(o.camera){const e=Al.allocate(),i=Al.allocate();kl(i,t,f),wl(e,v||e,i),o.modelMatrix=e,Al.free(i),o.setTransform(1,0,0,1,0,0,!0)}else o.transformFromMatrix(t.transMatrix,!0);o.beginPath(),n.skipDraw?this.drawShape(t,o,0,0,i,n,(()=>!1),(()=>!1)):this.drawShape(t,o,0,0,i);const{scrollX:b=f.scrollX,scrollY:m=f.scrollY}=t.attribute;let y;if((b||m)&&o.translate(b,m),n&&n.drawingCb&&(y=n.drawingCb()),o.modelMatrix!==v&&Al.free(o.modelMatrix),o.modelMatrix=v,o.baseGlobalAlpha=p,a>0){const t=o.nativeContext,e=o.canvas.nativeCanvas;u.save(),u.setTransform(o.dpr,0,0,o.dpr,0,0,!0),1===a&&t.rect(l,h,d,c),u.drawImage(e,0,0,e.width,e.height,0,0,o.canvas.displayWidth,o.canvas.displayHeight);const i=t.getTransform();u.setTransform(i.a,i.b,i.c,i.d,i.e,i.f),o.nativeContext=u,o.canvas.nativeCanvas=g,u.restore()}y&&y.then?y.then((()=>{r?o.restore():o.highPerformanceRestore()})):r?o.restore():o.highPerformanceRestore()}};oc=ec([w(),nc(0,y(F)),nc(0,x(ll)),ic("design:paramtypes",[Object])],oc);var rc=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},sc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ac=function(t,e){return function(i,n){e(i,n,t)}};const lc=["","repeat-x","repeat-y","repeat"];let hc=class extends rd{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=ca,this.builtinContributions=[Jh,Qh],this.init(t)}drawShape(t,e,i,n,o,r,s,a){const l=zo(t).image,{repeatX:h=l.repeatX,repeatY:d=l.repeatY,x:c=l.x,y:u=l.y,cornerRadius:g=l.cornerRadius,fillStrokeOrder:p=l.fillStrokeOrder,cornerType:f=l.cornerType,image:v}=t.attribute,b=this.valid(t,l,s);if(!b)return;const{fVisible:m,sVisible:y,doFill:C,doStroke:w}=b;if(!v||!t.resources)return;const x=t.resources.get(v);if("success"!==x.state)return;const _=t.width,S=t.height;e.beginPath();let A=!1;0===g||ut(g)&&g.every((t=>0===t))?e.rect(i,n,_,S):(Vh(e,i,n,_,S,g,"bevel"!==f),A=!0),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l);const B=()=>{if(C)if(s)s(e,t.attribute,l);else if(m){e.setCommonStyle(t,t.attribute,i,n,l);let o=0;if("repeat"===h&&(o|=1),"repeat"===d&&(o|=2),o){const t=e.createPattern(x.data,lc[o]);e.fillStyle=t,e.translate(i,n,!0),e.fillRect(0,0,_,S),e.translate(-i,-n,!0)}else e.drawImage(x.data,i,n,_,S)}},T=()=>{w&&(a?a(e,t.attribute,l):y&&(e.setStrokeStyle(t,t.attribute,c-i,u-n,l),e.stroke()))};p?(T(),A&&(e.save(),e.clip()),this.beforeRenderStep(t,e,i,n,C,!1,m,!1,l,o,s),B(),A&&e.restore()):(A&&(e.save(),e.clip()),this.beforeRenderStep(t,e,i,n,C,!1,m,!1,l,o,s),B(),A&&e.restore(),T()),this.afterRenderStep(t,e,i,n,C,!1,m,!1,l,o,s)}draw(t,e,i){const{image:n}=t.attribute;if(!n||!t.resources)return;const o=t.resources.get(n);if("loading"===o.state&&ct(n))return void Or.improveImageLoading(n);if("success"!==o.state)return;const{context:r}=e.drawParams;if(!r)return;const s=zo(t).image;this._draw(t,s,!1,i)}};hc=rc([w(),ac(0,y(F)),ac(0,x(hl)),sc("design:paramtypes",[Object])],hc);const dc=Symbol.for("IncrementalDrawContribution"),cc=Symbol.for("ArcRender"),uc=Symbol.for("CircleRender"),gc=Symbol.for("GraphicRender"),pc=Symbol.for("GroupRender"),fc=Symbol.for("LineRender"),vc=Symbol.for("PathRender"),bc=Symbol.for("PolygonRender"),mc=Symbol.for("RectRender"),yc=Symbol.for("SymbolRender"),Cc=Symbol.for("TextRender"),wc=Symbol.for("RichTextRender"),xc=Symbol.for("ImageRender"),_c=Symbol.for("DrawContribution"),Sc=(t,e,i,n)=>{let o,r=!1,s=!1;if(e.forEachChildren((t=>(r=t.numberType===aa,!r))),e.forEachChildren((t=>(s=!!t.findFace,!s))),r){const t=e.getChildren(),a=[...t];a.sort(((t,e)=>{var i,n,o,r;let s=(null!==(n=null!==(i=t.attribute.startAngle)&&void 0!==i?i:0+t.attribute.endAngle)&&void 0!==n?n:0)/2,a=(null!==(r=null!==(o=e.attribute.startAngle)&&void 0!==o?o:0+e.attribute.endAngle)&&void 0!==r?r:0)/2;for(;s<0;)s+=oe;for(;a<0;)a+=oe;return a-s})),a.forEach((t=>{t._next=null,t._prev=null})),e.removeAllChild(),e.update(),a.forEach((t=>{e.appendChild(t)})),n.hack_pieFace="outside",o=i(r,s),o&&o.graphic||(n.hack_pieFace="inside",o=i(r,s)),o&&o.graphic||(n.hack_pieFace="top",o=i(r,s)),e.removeAllChild(),t.forEach((t=>{t._next=null,t._prev=null})),t.forEach((t=>{e.appendChild(t)}))}else if(s){const n=e.getChildren(),a=n.map((e=>({ave_z:e.findFace().vertices.map((i=>{var n;return t.view(i[0],i[1],null!==(n=i[2]+e.attribute.z)&&void 0!==n?n:0)[2]})).reduce(((t,e)=>t+e),0),g:e})));a.sort(((t,e)=>e.ave_z-t.ave_z)),e.removeAllChild(),a.forEach((t=>{t.g._next=null,t.g._prev=null})),e.update(),a.forEach((t=>{e.add(t.g)})),o=i(r,s),e.removeAllChild(),n.forEach((t=>{t._next=null,t._prev=null})),e.update(),n.forEach((t=>{e.add(t)}))}else o=i(r,s);return o};var Ac=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Bc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const Tc=Symbol.for("DrawItemInterceptor"),Rc=new Fe,kc=new Fe;class Mc{constructor(){this.order=1}afterDrawItem(t,e,i,n,o){return null==t.attribute.shadowRootIdx&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0||(t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0)&&this.drawItem(t,e,i,n,o),!1}beforeDrawItem(t,e,i,n,o){return null==t.attribute.shadowRootIdx&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0||(t.attribute.shadowRootIdx<0||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0)&&this.drawItem(t,e,i,n,o),!1}drawItem(t,e,i,n,o){if(!t.shadowRoot)return!1;const{context:r}=i;if(r.highPerformanceSave(),r.transformFromMatrix(t.transMatrix,!0),n.dirtyBounds&&n.backupDirtyBounds){Rc.copy(n.dirtyBounds),kc.copy(n.backupDirtyBounds);const e=t.globalTransMatrix.getInverse();n.dirtyBounds.copy(n.backupDirtyBounds).transformWithMatrix(e),n.backupDirtyBounds.copy(n.dirtyBounds)}return n.renderGroup(t.shadowRoot,i,Sl.allocate(1,0,0,1,0,0)),r.highPerformanceRestore(),n.dirtyBounds&&n.backupDirtyBounds&&(n.dirtyBounds.copy(Rc),n.backupDirtyBounds.copy(kc)),!0}}class Lc{constructor(){this.order=1}afterDrawItem(t,e,i,n,o){return t.attribute._debug_bounds&&this.drawItem(t,e,i,n,o),!1}drawItem(t,e,i,n,o){if(!t.attribute._debug_bounds)return!1;const{context:r}=i;r.highPerformanceSave(),t.parent&&r.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&r.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const s=t.AABBBounds;return!0!==t.attribute._debug_bounds&&t.attribute._debug_bounds(r,t),r.strokeRect(s.x1,s.y1,s.width(),s.height()),r.highPerformanceRestore(),!0}}let Pc=class{constructor(){this.order=1,this.interceptors=[new Mc,new Hc,new Ec,new Lc]}afterDrawItem(t,e,i,n,o){for(let r=0;r<this.interceptors.length;r++)if(this.interceptors[r].afterDrawItem&&this.interceptors[r].afterDrawItem(t,e,i,n,o))return!0;return!1}beforeDrawItem(t,e,i,n,o){if((!t.in3dMode||i.in3dInterceptor)&&!t.shadowRoot&&!(t.baseGraphic||t.attribute.globalZIndex||t.interactiveGraphic))return!1;for(let r=0;r<this.interceptors.length;r++)if(this.interceptors[r].beforeDrawItem&&this.interceptors[r].beforeDrawItem(t,e,i,n,o))return!0;return!1}};Pc=Ac([w(),Bc("design:paramtypes",[])],Pc);class Ec{constructor(){this.order=1}beforeDrawItem(t,e,i,n,o){return!this.processing&&(t.baseGraphic?this.beforeDrawInteractive(t,e,i,n,o):this.beforeSetInteractive(t,e,i,n,o))}beforeSetInteractive(t,e,i,n,o){let r=t.interactiveGraphic;if(t.attribute.globalZIndex){r||(r=t.clone(),t.interactiveGraphic=r,r.baseGraphic=t),r.setAttributes({globalZIndex:0,zIndex:t.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),i.stage.tryInitInteractiveLayer();const e=i.stage.getLayer("_builtin_interactive");return e&&this.getShadowRoot(e).add(r),!0}if(r){i.stage.tryInitInteractiveLayer();const e=i.stage.getLayer("_builtin_interactive");e&&this.getShadowRoot(e).removeChild(r),t.interactiveGraphic=null,r.baseGraphic=null}return!1}beforeDrawInteractive(t,e,i,n,o){const r=t.baseGraphic;let s=!!r.stage,a=r.parent;for(;s&&a&&a.stage!==a;)s=!!a.stage,a=a.parent;if(!s){const e=i.stage.getLayer("_builtin_interactive");return e&&this.getShadowRoot(e).removeChild(t),!0}if(r){this.processing=!0;const{context:t}=i;return t.highPerformanceSave(),t.setTransformFromMatrix(r.parent.globalTransMatrix,!0),r.isContainer?n.renderGroup(r,i,r.parent.globalTransMatrix):n.renderItem(r,i),t.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(t){var e;let i=t.getElementById("_interactive_group");return i||(i=_h.CreateGraphic("group",{}),i.id="_interactive_group",t.add(i)),null!==(e=i.shadowRoot)&&void 0!==e?e:i.attachShadow()}}class Hc{constructor(){this.order=1}beforeDrawItem(t,e,i,n,o){if(!t.in3dMode||i.in3dInterceptor)return!1;i.in3dInterceptor=!0;const{context:r,stage:s}=e.drawParams;r.canvas,r.save(),this.initCanvasCtx(r),r.camera=s.camera;const a=r.currentMatrix;a.a/=r.dpr,a.b/=r.dpr,a.c/=r.dpr,a.d/=r.dpr,a.e/=r.dpr,a.f/=r.dpr;const l=Al.allocate();Cl(l,a);const h=r.modelMatrix;if(h){if(l){const t=Al.allocate();r.modelMatrix=wl(t,h,l)}}else r.modelMatrix=l;return r.setTransform(1,0,0,1,0,0,!0),t.isContainer?Sc(r,t,((e,o)=>n.renderGroup(t,i,t.parent.globalTransMatrix,!e&&o)),i):n.renderItem(t,i),r.camera=null,r.restore(),r.modelMatrix!==h&&Al.free(r.modelMatrix),r.modelMatrix=h,i.in3dInterceptor=!1,!0}initCanvasCtx(t){t.setTransformForCurrent()}}var Oc=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ic=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Fc=function(t,e){return function(i,n){e(i,n,t)}};const zc=Symbol.for("RenderService");let Dc=class{constructor(t){this.drawContribution=t}prepare(t){t&&this.renderTreeRoots.forEach((e=>{this._prepare(e,t)}))}_prepare(t,e){t.forEachChildren((t=>{this._prepare(t,e)})),t.update({bounds:e,trans:!0})}prepareRenderList(){}beforeDraw(t){}draw(t){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(t){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}reInit(){this.drawContribution.reInit()}render(t,e){this.renderTreeRoots=t,this.drawParams=e;const i=e.updateBounds;this.prepare(i),this.prepareRenderList(),this.beforeDraw(e),this.draw(e),this.afterDraw(e),this.drawParams=null}};Dc=Oc([w(),Fc(0,y(_c)),Ic("design:paramtypes",[Object])],Dc);var Wc=new l((t=>{t(zc).to(Dc)}));const Nc=Symbol.for("PickerService"),Gc=Symbol.for("GlobalPickerService"),jc=Symbol.for("PickItemInterceptor"),Vc=Symbol.for("PickServiceInterceptor");var Uc=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let Xc=class{constructor(){this.order=1}afterPickItem(t,e,i,n,o){if(t.graphic){let e=t.graphic;for(;e.parent;)e=e.parent;e.shadowHost&&(t.params={shadowTarget:t.graphic},t.graphic=e.shadowHost)}return t}};Xc=Uc([w()],Xc);let $c=class{constructor(){this.order=1}afterPickItem(t,e,i,n,o){return t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx?this._pickItem(t,e,i,n,o):null}beforePickItem(t,e,i,n,o){return t.attribute.shadowRootIdx<0?this._pickItem(t,e,i,n,o):null}_pickItem(t,e,i,n,o){var r;if(!t.shadowRoot)return null;const{parentMatrix:s}=o||{};if(!s)return null;const a=e.pickContext;a.highPerformanceSave();const l=null===(r=zo(t))||void 0===r?void 0:r[t.type],{shadowPickMode:h=(null==l?void 0:l.shadowPickMode)}=t.attribute,d=t.shadowRoot,c=Sl.allocateByObj(s),u=new fe(c.a*i.x+c.c*i.y+c.e,c.b*i.x+c.d*i.y+c.f),g=e.pickGroup(d,u,c,n);return a.highPerformanceRestore(),!g.graphic&&g.group&&"full"===h&&(g.graphic=g.group),g}};$c=Uc([w()],$c);let Yc=class{constructor(){this.order=1}beforePickItem(t,e,i,n,o){const r=t.baseGraphic;if(r&&r.parent){const t=new fe(i.x,i.y),o=e.pickContext;o.highPerformanceSave();const s=r.parent.globalTransMatrix;s.transformPoint(t,t);const a=r.isContainer?e.pickGroup(r,t.clone(),s,n):e.pickItem(r,t.clone(),s,n);return o.highPerformanceRestore(),a}return null}};Yc=Uc([w()],Yc);let Kc=class{constructor(){this.order=1}beforePickItem(t,e,i,n,o){if(!t.in3dMode||n.in3dInterceptor)return null;const r=e.pickContext,s=t.stage;if(!r||!s)return null;if(n.in3dInterceptor=!0,r.save(),this.initCanvasCtx(r),r.camera=s.camera,t.isContainer){const s=Sc(r,t,(()=>e.pickGroup(t,i,o.parentMatrix,n)),n);return r.camera=null,n.in3dInterceptor=!1,r.restore(),s}return r.restore(),null}initCanvasCtx(t){t.setTransformForCurrent()}};Kc=Uc([w()],Kc);var qc=new l(((t,e,i)=>{i(Nc)||(t(Gc).toSelf(),t(Nc).toService(Gc)),t(Kc).toSelf().inSingletonScope(),t(jc).toService(Kc),t($c).toSelf().inSingletonScope(),t(jc).toService($c),t(Yc).toSelf().inSingletonScope(),t(jc).toService(Yc),D(t,jc),t(Xc).toSelf().inSingletonScope(),t(Vc).toService(Xc),D(t,Vc)})),Zc=new l((t=>{t(ya).to(Ml).inSingletonScope(),t(Ca).toConstantValue(_h)}));const Jc=Symbol.for("AutoEnablePlugins"),Qc=Symbol.for("PluginService");var tu=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},eu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},iu=function(t,e){return function(i,n){e(i,n,t)}};let nu=class{constructor(t){this.autoEnablePlugins=t,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(t,e){this.stage=t,this.actived=!0;const{pluginList:i}=e;i&&fo.isBound(Jc)&&this.autoEnablePlugins.getContributions().forEach((t=>{i.includes(t.name)&&this.register(t)}))}findPluginsByName(t){const e=[];return this.onStartupFinishedPlugin.forEach((i=>{i.name===t&&e.push(i)})),this.onRegisterPlugin.forEach((i=>{i.name===t&&e.push(i)})),e}register(t){"onStartupFinished"===t.activeEvent?this.onStartupFinishedPlugin.push(t):"onRegister"===t.activeEvent&&(this.onRegisterPlugin.push(t),t.activate(this))}unRegister(t){"onStartupFinished"===t.activeEvent?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(t),1):"onRegister"===t.activeEvent&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(t),1),t.deactivate(this)}release(){this.onStartupFinishedPlugin.forEach((t=>{t.deactivate(this)})),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach((t=>{t.deactivate(this)})),this.onRegisterPlugin=[]}};nu=tu([w(),iu(0,y(F)),iu(0,x(Jc)),eu("design:paramtypes",[Object])],nu);var ou=new l((t=>{t(Qc).to(nu),function(t,e){t(F).toDynamicValue((t=>{let{container:i}=t;return new z(e,i)})).whenTargetNamed(e)}(t,Jc)})),ru=new l((t=>{D(t,j)})),su=new l((t=>{t(go).to(po).inSingletonScope(),D(t,go)})),au=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},lu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let hu=class{constructor(){this.type="static",this.offscreen=!1,this.global=$n.global}setDpr(t){this.canvas.dpr=t}init(t,e,i){if(this.layer=t,this.window=e,i.main)this.main=!0,this.context=e.getContext(),this.canvas=this.context.getCanvas();else{let t;this.main=!1,i.canvasId&&(t=this.global.getElementById(i.canvasId)),t||(t=this.global.createCanvas({width:e.width,height:e.height})),t.style&&(t.style["pointer-events"]="none");const n=e.getContext().getCanvas().nativeCanvas,o=mo({nativeCanvas:t,width:e.width,height:e.height,dpr:e.dpr,id:i.canvasId,canvasControled:!0,container:e.getContainer(),x:n.offsetLeft,y:n.offsetTop});o.applyPosition(),this.canvas=o,this.context=o.getContext()}}resize(t,e){this.canvas.resize(t,e)}resizeView(t,e){}render(t,e,i){var n;if(!this.main){const t=this.window.getContext().getCanvas().nativeCanvas;!t||this.canvas.x===t.offsetLeft&&this.canvas.y===t.offsetTop||(this.canvas.x=t.offsetLeft,this.canvas.y=t.offsetTop,this.canvas.applyPosition())}e.renderService.render(t,Object.assign(Object.assign({context:this.context,clear:null!==(n=e.background)&&void 0!==n?n:"#ffffff"},e),i))}merge(t){t.forEach((t=>{const e=t.getContext().canvas.nativeCanvas;this.context.drawImage(e,0,0)}))}prepare(t,e){}drawTo(t,e,i){var n;const o=t.getContext();i.renderService.render(e,Object.assign(Object.assign({context:o},i),{clear:i.clear?null!==(n=i.background)&&void 0!==n?n:"#fff":void 0}))}getContext(){return this.context}release(){this.canvas.release()}};hu=au([w(),lu("design:paramtypes",[])],hu);var du=new l((t=>{t(hu).toSelf(),t(Da).toService(hu)}));var cu=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))};function uu(t,e,i){const n={},o=[];return t.forEachChildren((t=>{const{zIndex:i=e}=t.attribute;n[i]?n[i].push(t):(n[i]=[t],o.push(i))}),i),o.sort(((t,e)=>i?e-t:t-e)),{childMap:n,zIdxArray:o}}function gu(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=!1;if(o)r=!0;else{let i;t.forEachChildren(((t,n)=>{const{zIndex:o=e}=t.attribute;if(0===n)i=o;else if(i!==o)return r=!0,!0;return!1}),n)}if(r){const{childMap:r,zIdxArray:s}=uu(t,e,n);let a=!1;for(let t=0;t<s.length&&!a;t++){const e=r[s[t]];o&&e.sort(((t,e)=>{var i,o;return(n?-1:1)*((null!==(i=e.attribute.z)&&void 0!==i?i:0)-(null!==(o=t.attribute.z)&&void 0!==o?o:0))}));for(let t=0;t<e.length;t++)if(i(e[t],t)){a=!0;break}}}else t.forEachChildren(i,n)}function pu(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return cu(this,void 0,void 0,(function*(){yield t.forEachChildrenAsync(i,n)}))}function fu(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!1;t.forEachChildren(((t,e)=>{const{zIndex:n=i}=t.attribute;if(0===e);else if(void 0!==n)return o=!0,!0;return!1}),n);let r=null,s=!1;if(o){const{childMap:o,zIdxArray:a}=uu(t,i,n);let l=!1;for(let t=0;t<a.length&&!l;t++){const i=o[a[t]];for(let t=0;t<i.length;t++){if(s){l=!0,r=i[t];break}i[t]._uid!==e||(s=!0)}}}else t.forEachChildren((t=>s?(r=t,!0):(t._uid===e&&(s=!0),!1)),n);return r}var vu=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},bu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},mu=function(t,e){return function(i,n){e(i,n,t)}};let yu=class{constructor(t,e){this.contributions=t,this.drawItemInterceptorContributions=e,this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new Ie,this.backupDirtyBounds=new Ie,this.global=$n.global,this.layerService=$n.layerService,ut(this.contributions)||(this.contributions=[this.contributions]),this.init()}reInit(){this.init(),this.contributions.forEach((t=>{t.reInit()}))}init(){this.contributions.forEach((t=>{if(t.style){const e=this.styleRenderMap.get(t.style)||new Map;e.set(t.numberType,t),this.styleRenderMap.set(t.style,e)}else this.defaultRenderMap.set(t.numberType,t)})),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort(((t,e)=>t.order-e.order))}prepareForDraw(t,e){e.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!e.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(t,e){this.prepareForDraw(t,e),e.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(e.renderStyle)||this.defaultRenderMap,this.currentRenderService=t;const{context:i,stage:n,viewBox:o,transMatrix:r}=e;if(!i)return;const s=this.dirtyBounds.setValue(0,0,o.width(),o.height());if(n.dirtyBounds&&!n.dirtyBounds.empty()){const t=Ce(s,n.dirtyBounds,!1);s.x1=Math.floor(t.x1),s.y1=Math.floor(t.y1),s.x2=Math.ceil(t.x2),s.y2=Math.ceil(t.y2)}const a=i.dpr%1;(a||.5!==a)&&(s.x1=Math.floor(s.x1*i.dpr)/i.dpr,s.y1=Math.floor(s.y1*i.dpr)/i.dpr,s.x2=Math.ceil(s.x2*i.dpr)/i.dpr,s.y2=Math.ceil(s.y2*i.dpr)/i.dpr),this.backupDirtyBounds.copy(s),i.inuse=!0,i.setClearMatrix(r.a,r.b,r.c,r.d,r.e,r.f),i.clearMatrix(),i.setTransformForCurrent(!0),i.translate(o.x1,o.y1,!0),i.beginPath(),i.rect(s.x1,s.y1,s.width(),s.height()),i.clip(),n.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(t,i,e),i.save(),t.renderTreeRoots.sort(((t,e)=>{var i,n;return(null!==(i=t.attribute.zIndex)&&void 0!==i?i:Ln.zIndex)-(null!==(n=e.attribute.zIndex)&&void 0!==n?n:Ln.zIndex)})).forEach((t=>{t.isContainer?this.renderGroup(t,e,Sl.allocate(1,0,0,1,0,0)):this.renderItem(t,e)})),i.restore(),i.setClearMatrix(1,0,0,1,0,0),i.inuse=!1,i.draw()}doRegister(){throw new Error("暂不支持")}_findNextGraphic(t){let e=t.parent,i=t._uid;for(;e;){const t=fu(e,i,Ln.zIndex);if(t)return t;i=e._uid,e=e.parent}return null}renderGroup(t,e,i,n){if(e.break||!1===t.attribute.visibleAll)return;if(t.incremental&&(null==e.startAtId||e.startAtId===t._uid))return e.break=!0,void this._increaseRender(t,e);if(this.useDirtyBounds&&!Se(t.AABBBounds,this.dirtyBounds,!1)&&"empty"!==t.attribute.boundsMode)return;let o,r=i;if(this.useDirtyBounds){o=Wd.allocateByObj(this.dirtyBounds);const e=t.transMatrix;r=Sl.allocateByObj(i).multiply(e.a,e.b,e.c,e.d,e.e,e.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(r.getInverse())}this.renderItem(t,e,{drawingCb:()=>{var i;n?t.forEachChildren((t=>{e.break||(t.isContainer?this.renderGroup(t,e,r):this.renderItem(t,e))})):gu(t,Ln.zIndex,(t=>{e.break||(t.isContainer?this.renderGroup(t,e,r):this.renderItem(t,e))}),!1,!!(null===(i=e.context)||void 0===i?void 0:i.camera))}}),this.useDirtyBounds&&(this.dirtyBounds.copy(o),Wd.free(o),Sl.free(r))}_increaseRender(t,e){const{layer:i,stage:n}=e,{subLayers:o}=i;let r=o.get(t._uid);r||(r={layer:this.layerService.createLayer(n),zIndex:o.size,group:t},o.set(t._uid,r));const s=r.layer.getNativeHandler().getContext(),a=r.drawContribution||fo.get(dc);a.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:a,clear:"transparent",layer:r.layer,context:s,startAtId:t._uid,break:!1})),r.drawContribution=a;const l=this._findNextGraphic(t);if(l)if(l.isContainer&&l.incremental)this._increaseRender(l,e);else{let t=o.get(l._uid);t||(t={layer:this.layerService.createLayer(n),zIndex:o.size},o.set(l._uid,t));const i=t.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:a,clear:"transparent",layer:t.layer,context:i,startAtId:l._uid,break:!1}))}}getRenderContribution(t){let e;return e||(e=this.selectRenderByNumberType(t.numberType,t)),e||(e=this.selectRenderByType(t.type)),e}renderItem(t,e,i){if(this.InterceptorContributions.length)for(let n=0;n<this.InterceptorContributions.length;n++){const o=this.InterceptorContributions[n];if(o.beforeDrawItem&&o.beforeDrawItem(t,this.currentRenderService,e,this,i))return}const n=this.getRenderContribution(t);if(!n)return;let o,r=this.scrollMatrix&&(0!==this.scrollMatrix.e||0!==this.scrollMatrix.f);if(t.parent){const{scrollX:e=0,scrollY:i=0}=t.parent.attribute;(e||i)&&(r=!0,this.scrollMatrix||(this.scrollMatrix=Sl.allocate(1,0,0,1,0,0)),this.scrollMatrix.translate(-e,-i))}if(r&&(o=this.dirtyBounds.clone().transformWithMatrix(this.scrollMatrix)),this.useDirtyBounds&&!t.isContainer&&"empty"!==t.attribute.boundsMode&&!Se(t.AABBBounds,null!=o?o:this.dirtyBounds,!1)){if(r&&t.parent){const{scrollX:e=0,scrollY:i=0}=t.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(e,i)}return}const s=null!=e.startAtId&&t._uid!==e.startAtId;if(t._uid===e.startAtId&&(e.startAtId=null),i&&(i.skipDraw=s),s?t.isContainer&&n.draw(t,this.currentRenderService,e,i):n.draw(t,this.currentRenderService,e,i),r&&t.parent){const{scrollX:e=0,scrollY:i=0}=t.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(e,i)}if(this.InterceptorContributions.length)for(let i=0;i<this.InterceptorContributions.length;i++){const n=this.InterceptorContributions[i];if(n.afterDrawItem&&n.afterDrawItem(t,this.currentRenderService,e,this))return}}selectRenderByType(t){return Vt.getInstance().warn("未知错误，不应该走到这里"),null}selectRenderByNumberType(t,e){let i;if(e.attribute.renderStyle){const n=this.styleRenderMap.get(e.attribute.renderStyle);i=n&&n.get(t)}return i||this.currentRenderMap.get(t)||this.defaultRenderMap.get(t)}clearScreen(t,e,i){var n,o;const{clear:r,viewBox:s}=i,a=s.width(),l=s.height();if(r){e.clearRect(0,0,a,l);const i=null===(n=t.drawParams)||void 0===n?void 0:n.stage;if(i&&(e.globalAlpha=null!==(o=i.attribute.opacity)&&void 0!==o?o:1),i&&i.backgroundImg&&i.resources){const t=i.resources.get(r);t&&"success"===t.state&&t.data&&e.drawImage(t.data,0,0,a,l)}else e.fillStyle=Zn(e,r,{AABBBounds:{x1:0,y1:0,x2:0+a,y2:0+l}},0,0),e.fillRect(0,0,a,l)}}afterDraw(t,e){}};yu=vu([w(),mu(0,C(gc)),mu(1,y(F)),mu(1,x(Tc)),bu("design:paramtypes",[Array,Object])],yu);var Cu=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let wu=class extends md{constructor(){super(...arguments),this.numberType=ua}drawShape(t,e,i,n,o,r,s,a){if(t.incremental&&o.multiGraphicOptions){const{startAtIdx:e,length:r}=o.multiGraphicOptions,{segments:l=[]}=t.attribute;if(e>l.length)return;const h=zo(t).line,{fill:d=h.fill,stroke:c=h.stroke,opacity:u=h.opacity,fillOpacity:g=h.fillOpacity,strokeOpacity:p=h.strokeOpacity,lineWidth:f=h.lineWidth,visible:v=h.visible}=t.attribute,b=Ka(u,g,d),m=Za(u,p),y=$a(d),C=Ya(c,f);if(!t.valid||!v)return;if(!y&&!C)return;if(!(b||m||s||a))return;const{context:w}=o;for(let o=e;o<e+r;o++)this.drawIncreaseSegment(t,w,l[o-1],l[o],t.attribute.segments[o],[h,t.attribute],i,n)}else super.drawShape(t,e,i,n,o,r,s,a)}drawIncreaseSegment(t,e,i,n,o,r,s,a){n&&(e.beginPath(),function(t,e,i,n){const{offsetX:o=0,offsetY:r=0}=n||{},s=e?e.points[e.points.length-1]:i.points[0];t.moveTo(s.x+o,s.y+r),i.points.forEach((e=>{!1!==e.defined?t.lineTo(e.x+o,e.y+r):t.moveTo(e.x+o,e.y+r)}))}(e.nativeContext,i,n,{offsetX:s,offsetY:a}),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,o,r),e.setStrokeStyle(t,o,s,a,r),e.stroke())}};wu=Cu([w()],wu);var xu=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let _u=class extends Ad{constructor(){super(...arguments),this.numberType=la}drawShape(t,e,i,n,o,r,s){if(t.incremental&&o.multiGraphicOptions){const{startAtIdx:r,length:a}=o.multiGraphicOptions,{segments:l=[]}=t.attribute;if(r>l.length)return;const h=zo(t).area,{fill:d=h.fill,fillOpacity:c=h.fillOpacity,opacity:u=h.opacity,visible:g=h.visible}=t.attribute,p=Ka(u,c,d),f=$a(d);if(!t.valid||!g)return;if(!f)return;if(!p&&!s)return;for(let o=r;o<r+a;o++)this.drawIncreaseSegment(t,e,l[o-1],l[o],t.attribute.segments[o],[h,t.attribute],i,n)}else super.drawShape(t,e,i,n,o,r,s)}drawIncreaseSegment(t,e,i,n,o,r,s,a){n&&(e.beginPath(),function(t,e,i,n){const{offsetX:o=0,offsetY:r=0}=n||{},{points:s}=i,a=[];for(let t=0;t<s.length;t++)s[t].defined;a.push(s),a.forEach(((i,n)=>{var s,a,l,h;const d=e&&0===n?e.points[e.points.length-1]:i[0];t.moveTo(d.x+o,d.y+r),i.forEach((e=>{!1!==e.defined?t.lineTo(e.x+o,e.y+r):t.moveTo(e.x+o,e.y+r)}));for(let e=i.length-1;e>=0;e--){const n=i[e];t.lineTo(null!==(s=n.x1)&&void 0!==s?s:n.x,null!==(a=n.y1)&&void 0!==a?a:n.y)}t.lineTo(null!==(l=d.x1)&&void 0!==l?l:d.x,null!==(h=d.y1)&&void 0!==h?h:d.y),t.closePath()}))}(e.camera?e:e.nativeContext,i,n,{offsetX:s,offsetY:a}),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,o,r),e.setCommonStyle(t,o,s,a,r),e.fill())}};_u=xu([w()],_u);var Su,Au=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Bu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Tu=function(t,e){return function(i,n){e(i,n,t)}},Ru=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))};!function(t){t[t.NORMAL=0]="NORMAL",t[t.STOP=1]="STOP"}(Su||(Su={}));let ku=class extends yu{constructor(t,e,i,n){super(t,n),this.contributions=t,this.lineRender=e,this.areaRender=i,this.drawItemInterceptorContributions=n,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=Su.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new G([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(t,e){return Ru(this,void 0,void 0,(function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=t,this.lastDrawContext=e,this.checkingForDrawPromise=this.checkForDraw(e);const i=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,i)return;this.currentRenderService=t;const{context:n,viewBox:o}=e;n&&(n.inuse=!0,n.clearMatrix(),n.setTransformForCurrent(!0),n.save(),e.restartIncremental&&this.clearScreen(this.currentRenderService,n,e),n.translate(o.x1,o.y1,!0),n.save(),t.renderTreeRoots.sort(((t,e)=>{var i,n;return(null!==(i=t.attribute.zIndex)&&void 0!==i?i:Ln.zIndex)-(null!==(n=e.attribute.zIndex)&&void 0!==n?n:Ln.zIndex)})).forEach((t=>{this.renderGroup(t,e)})),this.hooks.completeDraw.tap("top-draw",(()=>{n.restore(),n.restore(),n.draw(),n.inuse=!1,this.rendering=!1})))}))}_increaseRender(t,e){return Ru(this,void 0,void 0,(function*(){this.rendering=!0,yield this._renderIncrementalGroup(t,e)}))}_renderIncrementalGroup(t,e){return Ru(this,void 0,void 0,(function*(){this.count=t.count,yield new Promise((i=>{this.renderItem(t,e,{drawingCb:()=>Ru(this,void 0,void 0,(function*(){if(2!==t.count)yield pu(t,Ln.zIndex,((i,n)=>{if(this.status===Su.STOP)return!0;if(i.isContainer)return!1;if(n<this.currentIdx)return!1;const o=this.currFrameStartAt+t.incremental;return n<o&&(this.currentIdx=n+1,this.renderItem(i,e)),n===o-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())})),i(!1);else{const n=t.getChildAt(0);if(n.incremental&&n.attribute.segments)for(n.incrementalAt||(n.incrementalAt=0);n.incrementalAt<n.attribute.segments.length;)e.multiGraphicOptions={startAtIdx:n.incrementalAt,length:n.incremental},this.renderItem(n,e),n.incrementalAt+=n.incremental,yield this.waitToNextFrame();else this.renderItem(n,e);i(!1)}}))})})),this.hooks.completeDraw.call()}))}waitToNextFrame(){return Ru(this,void 0,void 0,(function*(){return new Promise((t=>{this.global.getRequestAnimationFrame()((()=>{t(!1)}))}))}))}checkForDraw(t){return Ru(this,void 0,void 0,(function*(){let e=this.rendering;return t.restartIncremental&&(e=!1,yield this.forceStop(),this.resetToInit()),e}))}forceStop(){return Ru(this,void 0,void 0,(function*(){this.rendering&&(this.status=Su.STOP,yield new Promise((t=>{this.hooks.completeDraw.tap("stopCb",(()=>{this.status=Su.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter((t=>"stopCb"!==t.name)),t(!1)}))})))}))}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(t,e){return Ru(this,void 0,void 0,(function*(){if(!e.break&&!1!==t.attribute.visibleAll)return t.incremental&&e.startAtId===t._uid?(yield this._increaseRender(t,e),void(e.break=!0)):void(yield new Promise((i=>{this.renderItem(t,e,{drawingCb:()=>Ru(this,void 0,void 0,(function*(){yield pu(t,Ln.zIndex,(t=>Ru(this,void 0,void 0,(function*(){e.break||t.isContainer&&(yield this.renderGroup(t,e))})))),i(!1)}))})})))}))}};ku=Au([w(),Tu(0,C(gc)),Tu(1,y(wu)),Tu(2,y(_u)),Tu(3,y(F)),Tu(3,x(Tc)),Bu("design:paramtypes",[Array,Object,Object,Object])],ku);var Mu=new l((t=>{t(kh).toSelf().inSingletonScope(),t(Hh).toSelf().inSingletonScope(),t(_c).to(yu),t(dc).to(ku),t(pc).to(oc).inSingletonScope(),t(gc).toService(pc),D(t,ll),t(Lh).toSelf().inSingletonScope(),D(t,fl),D(t,gc),t(Pc).toSelf().inSingletonScope(),t(Tc).toService(Pc),D(t,Tc)}));function Lu(){Lu.__loaded||(Lu.__loaded=!0,fo.load(Xa),fo.load(Zc),fo.load(Wc),fo.load(qc),fo.load(ou),function(t){t.load(ru),t.load(su),t.load(du)}(fo),function(t){t.load(Mu)}(fo))}Lu.__loaded=!1,Lu();const Pu=fo.get(V);$n.global=Pu;const Eu=fo.get(Fa);$n.graphicUtil=Eu;const Hu=fo.get(Ia);$n.transformUtil=Hu;const Ou=fo.get(ya);$n.graphicService=Ou;const Iu=fo.get(za);$n.layerService=Iu;class Fu{constructor(){this.name="AutoRenderPlugin",this.activeEvent="onRegister",this._uid=a.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&null!=t.stage&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,$n.graphicService.hooks.onAttributeUpdate.tap(this.key,this.handleChange),$n.graphicService.hooks.onSetStage.tap(this.key,this.handleChange),$n.graphicService.hooks.onRemove.tap(this.key,this.handleChange)}deactivate(t){const e=t=>t.filter((t=>t.name!==this.key));$n.graphicService.hooks.onAttributeUpdate.taps=e($n.graphicService.hooks.onAttributeUpdate.taps),$n.graphicService.hooks.onSetStage.taps=e($n.graphicService.hooks.onSetStage.taps),$n.graphicService.hooks.onRemove.taps=e($n.graphicService.hooks.onRemove.taps)}}class zu{constructor(){this.name="AutoRefreshPlugin",this.activeEvent="onRegister",this._uid=a.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&null!=t.stage&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,this.dpr=$n.global.devicePixelRatio,this.refresh()}refresh(){this._refreshByMediaQuery()||this._refreshByRaf()}_refreshByRaf(){const t=$n.global.getRequestAnimationFrame();this.rafId=t((()=>{$n.global.devicePixelRatio!==this.dpr&&(this.dpr=$n.global.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0)),this.refresh()}))}_refreshByMediaQuery(){try{const t=`(resolution: ${window.devicePixelRatio}dppx)`,e=()=>{window.devicePixelRatio!==this.dpr&&(this.dpr=window.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0))},i=matchMedia(t);i&&i.addEventListener("change",e),this.autoRefreshCbs||(this.autoRefreshCbs=[]),this.autoRefreshCbs.push((()=>{i&&i.removeEventListener("change",e)}))}catch(t){return!1}return!0}deactivate(t){var e;const i=$n.global.getCancelAnimationFrame();i&&this.rafId&&i(this.rafId),null===(e=this.autoRefreshCbs)||void 0===e||e.forEach((t=>{t()})),this.autoRefreshCbs=void 0}}class Du{constructor(){this.name="IncrementalAutoRenderPlugin",this.activeEvent="onRegister",this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=a.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,$n.graphicService.hooks.onAddIncremental.tap(this.key,((e,i,n)=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&null!=e.stage&&(this.nextUserParams.startAtId=i._uid,this.renderNextFrame(i))})),$n.graphicService.hooks.onClearIncremental.tap(this.key,((e,i)=>{e.stage===t.stage&&null!=e.stage&&(this.nextUserParams.startAtId=e._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(e))}))}deactivate(t){$n.graphicService.hooks.onAddIncremental.taps=$n.graphicService.hooks.onAddIncremental.taps.filter((t=>t.name!==this.key)),$n.graphicService.hooks.onClearIncremental.taps=$n.graphicService.hooks.onClearIncremental.taps.filter((t=>t.name!==this.key))}renderNextFrame(t){this.nextFrameRenderGroupSet.add(t),this.willNextFrameRender||(this.willNextFrameRender=!0,$n.global.getRequestAnimationFrame()((()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1})))}_doRenderInThisFrame(){const t=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach((e=>{const i=e.layer;if(!i||!e.layer.subLayers)return;const n=e.layer.subLayers.get(e._uid);n&&n.drawContribution&&n.drawContribution.draw(t.renderService,Object.assign({stage:t,layer:i,viewBox:t.window.getViewBox(),transMatrix:t.window.getViewBoxTransform(),clear:"transparent",renderService:t.renderService,updateBounds:!1,startAtId:e._uid,context:n.layer.getNativeHandler().getContext()},this.nextUserParams))})),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}}const Wu=new Fe;class Nu{constructor(){this.name="DirtyBoundsPlugin",this.activeEvent="onRegister",this._uid=a.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,(t=>{t&&t===this.pluginService.stage&&t.dirtyBounds.clear()})),$n.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,((t,e,i,n)=>{t.glyphHost&&(t=t.glyphHost),e&&e===this.pluginService.stage&&e.renderCount&&(t.isContainer&&!t.shouldSelfChangeUpdateAABBBounds()||i&&(Wu.setValue(n.x1,n.y1,n.x2,n.y2),e.dirty(Wu,t.parent&&t.parent.globalTransMatrix)))})),$n.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,((t,e,i,n,o)=>{e&&e===this.pluginService.stage&&e.renderCount&&(t.isContainer&&!o||e.dirty(n.globalAABBBounds))})),$n.graphicService.hooks.clearAABBBounds.tap(this.key,((t,e,i)=>{e&&e===this.pluginService.stage&&e.renderCount&&e&&e.dirty(i)})),$n.graphicService.hooks.onRemove.tap(this.key,(t=>{const e=t.stage;e&&e===this.pluginService.stage&&e.renderCount&&e&&e.dirty(t.globalAABBBounds)}))}deactivate(t){$n.graphicService.hooks.beforeUpdateAABBBounds.taps=$n.graphicService.hooks.beforeUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),$n.graphicService.hooks.afterUpdateAABBBounds.taps=$n.graphicService.hooks.afterUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),$n.graphicService.hooks.clearAABBBounds.taps=$n.graphicService.hooks.clearAABBBounds.taps.filter((t=>t.name!==this.key)),t.stage.hooks.afterRender.taps=t.stage.hooks.afterRender.taps.filter((t=>t.name!==this.key)),$n.graphicService.hooks.onRemove.taps=$n.graphicService.hooks.onRemove.taps.filter((t=>t.name!==this.key))}}const Gu=new tr;let ju;function Vu(){if(null==ju)try{const t=document.createElement("canvas"),e=t.getContext("2d");ju=!!(window&&t.getBoundingClientRect&&requestAnimationFrame&&window.devicePixelRatio&&e&&e.isPointInPath&&e.isPointInStroke),ju&&(ju=!!document.createElement)}catch(t){ju=!1}}function Uu(){Vu();const t=$n.global&&$n.global.env;return t?"browser"===t:ju}Gu.addTimeline(or),Gu.setFPS(60);let Xu=class t{static registerPlugin(e,i){t._pluginClasses[e]=i}static getPlugin(e){return t._pluginClasses[e]}};Xu._pluginClasses={};const $u="white";class Yu extends Ea{set viewBox(t){this.window.setViewBox(t)}get viewBox(){return this.window.getViewBox()}get x(){return this.window.getViewBox().x1}set x(t){const e=this.window.getViewBox();e.translate(t-e.x1,0),this.window.setViewBox(e)}get y(){return this.window.getViewBox().y1}set y(t){const e=this.window.getViewBox();e.translate(0,t-e.y1),this.window.setViewBox(e)}get width(){return this.window.width}set width(t){this.resize(t,this.height)}get viewWidth(){return this.window.getViewBox().width()}set viewWidth(t){this.resizeView(t,this.viewHeight)}get viewHeight(){return this.window.getViewBox().height()}set viewHeight(t){this.resizeView(this.viewWidth,t)}get height(){return this.window.height}set height(t){this.resize(this.width,t)}get dpr(){return this.window.dpr}set dpr(t){this.setDpr(t)}get background(){var t;return null!==(t=this._background)&&void 0!==t?t:$u}set background(t){this._background=t}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e;super({}),this.tickedBeforeRender=!0,this._onVisibleChange=t=>{if(!(this._skipRender<0))if(t){if(this.dirtyBounds){const t=this.window.getViewBox();this.dirtyBounds.setValue(t.x1,t.y1,t.width(),t.height())}this._skipRender>1&&this.renderNextFrame(),this._skipRender=0}else this._skipRender=1},this.beforeRender=t=>{this._beforeRender&&this._beforeRender(t)},this.afterRender=t=>{this.renderCount++,this._afterRender&&this._afterRender(t),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach((e=>e(t))),this._afterNextRenderCbs=null,this.tickedBeforeRender=!1},this.afterTickCb=()=>{var t;this.tickedBeforeRender=!0,"performance"===(null===(t=this.params.optimize)||void 0===t?void 0:t.tickRenderMode)||"rendering"!==this.state&&this.render()},this.params=t,this.theme=new Io,this.hooks={beforeRender:new G(["stage"]),afterRender:new G(["stage"])},this.global=$n.global,!this.global.env&&Uu()&&this.global.setEnv("browser"),this.window=fo.get(xo),this.renderService=fo.get(zc),this.pluginService=fo.get(Qc),this.layerService=fo.get(za),this.pluginService.active(this,t),this.window.create({width:t.width,height:t.height,viewBox:t.viewBox,container:t.container,dpr:t.dpr||this.global.devicePixelRatio,canvasControled:!1!==t.canvasControled,title:t.title||"",canvas:t.canvas}),this.state="normal",this.renderCount=0,this.tryInitEventSystem(),this._background=null!==(e=t.background)&&void 0!==e?e:$u,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=t.renderStyle,t.autoRender&&this.enableAutoRender(),t.autoRefresh&&this.enableAutoRefresh(),!1===t.disableDirtyBounds&&this.enableDirtyBounds(),t.enableHtmlAttribute&&this.enableHtmlAttribute(t.enableHtmlAttribute),t.ReactDOM&&this.enableReactAttribute(t.ReactDOM),t.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap("constructor",this.beforeRender),this.hooks.afterRender.tap("constructor",this.afterRender),this._beforeRender=t.beforeRender,this._afterRender=t.afterRender,this.ticker=t.ticker||Gu,this.supportInteractiveLayer=!1!==t.interactiveLayer,this.timeline=new nr,this.ticker.addTimeline(this.timeline),this.timeline.pause(),t.optimize||(t.optimize={}),this.optmize(t.optimize),t.background&&ct(this._background)&&this._background.includes("/")&&this.setAttributes({background:this._background}),this.ticker.on("afterTick",this.afterTickCb)}pauseRender(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._skipRender=t}resumeRender(){this._skipRender=0}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new qo(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents},this.params.event)))}preventRender(t){t?this._skipRender=-1/0:!1!==this.params.optimize.skipRenderWithOutRange?this._skipRender=this.window.isVisible()?0:1:this._skipRender=0}optmize(t){this.optmizeRender(t.skipRenderWithOutRange),this.params.optimize=t}optmizeRender(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(t){const{center:e={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:i={},alpha:n=0,beta:o=0,camera:r,fieldRatio:s=1,fieldDepth:a}=t;return Object.assign(Object.assign({},t),{center:e,light:i,alpha:n,beta:o,camera:r,fieldRatio:s,fieldDepth:a})}set3dOptions(t){var e,i,n,o,r,s;this.option3d=t;const a=this.get3dOptions(t),{light:l,center:h,camera:d,alpha:c,beta:u,fieldRatio:g,fieldDepth:p}=a,{dir:f=[1,1,-1],color:v="white",ambient:b}=l,m=(null!==(e=h.x)&&void 0!==e?e:this.width/2)+(null!==(i=h.dx)&&void 0!==i?i:0),y=(null!==(n=h.y)&&void 0!==n?n:this.height/2)+(null!==(o=h.dy)&&void 0!==o?o:0),C=[m,y,(null!==(r=h.z)&&void 0!==r?r:0)+(null!==(s=h.dz)&&void 0!==s?s:0)];let w=0,x=0,_=0;d||(w=Math.sin(c)+m,x=Math.sin(u)+y,_=Math.cos(c)*Math.cos(u)*1);const S=Xu.getPlugin("DirectionalLight");S&&(this.light=new S(f,v,b));const A={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:g,fieldDepth:p,viewParams:{pos:[w,x,_],center:C,up:[0,1,0]}};if(this.camera)this.camera.params=A;else{const t=Xu.getPlugin("OrthoCamera");t&&(this.camera=new t(A))}t.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(t){this._beforeRender=t}setAfterRender(t){this._afterRender=t}afterNextRender(t){this._afterNextRenderCbs||(this._afterNextRenderCbs=[]),this._afterNextRenderCbs.push(t)}enableView3dTransform(){if(this.view3dTranform)return;this.view3dTranform=!0;const t=Xu.getPlugin("ViewTransform3dPlugin");t&&this.pluginService.register(new t)}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName("ViewTransform3dPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new Fu))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName("AutoRenderPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableAutoRefresh(){this.autoRefresh||(this.autoRefresh=!0,this.pluginService.register(new zu))}disableAutoRefresh(){this.autoRefresh&&(this.autoRefresh=!1,this.pluginService.findPluginsByName("AutoRefreshPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new Du))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName("IncrementalAutoRenderPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new Ie;let t=this.pluginService.findPluginsByName("DirtyBoundsPlugin")[0];t?t.activate(this.pluginService):(t=new Nu,this.pluginService.register(t))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName("DirtyBoundsPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableLayout(){if(this._enableLayout)return;this._enableLayout=!0;const t=Xu.getPlugin("FlexLayoutPlugin");t&&this.pluginService.register(new t)}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName("FlexLayoutPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableHtmlAttribute(t){if(this.htmlAttribute)return;const e=Xu.getPlugin("HtmlAttributePlugin");e&&(this.htmlAttribute=t,this.pluginService.register(new e))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName("HtmlAttributePlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableReactAttribute(t){if(this.reactAttribute)return;const e=Xu.getPlugin("ReactAttributePlugin");e&&(this.reactAttribute=t,this.pluginService.register(new e))}disableReactAttribute(){this.reactAttribute&&(this.reactAttribute=!1,this.pluginService.findPluginsByName("ReactAttributePlugin").forEach((t=>{this.pluginService.unRegister(t)})))}getPluginsByName(t){return this.pluginService.findPluginsByName(t)}tryUpdateAABBBounds(){const t=this.window.getViewBox();return this._AABBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._AABBBounds}combineLayer(t,e){throw new Error("暂不支持")}createLayer(t,e){if("released"===this.releaseStatus)return;const i=this.layerService.createLayer(this,{main:!1,layerMode:e,canvasId:t});return this.appendChild(i),i}sortLayer(t){const e=this.children;e.sort(t),this.removeAllChild(),e.forEach((t=>{this.appendChild(t)}))}removeLayer(t){return this.removeChild(this.findChildByUid(t))}tryInitInteractiveLayer(){"released"!==this.releaseStatus&&this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name="_builtin_interactive",this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(t){this.window.clearViewBox(t)}render(t,e){if("released"===this.releaseStatus)return;this.ticker.start(),this.timeline.resume();const i=this.state;this.state="rendering",this.tickedBeforeRender||this.ticker.trySyncTickStatus(),this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=e,this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(this.children),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=i,this._skipRender&&this._skipRender++}combineLayersToWindow(){if("harmony"===this.global.env){const t=this.window.getContext().nativeContext;this.forEachChildren(((e,i)=>{if(i>0){const i=e.getNativeHandler().getContext().canvas.nativeCanvas.nativeCanvas._c.transferToImageBitmap();t.transferFromImageBitmap(i)}}))}}renderNextFrame(t,e){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(t||this).forEach((t=>{this.nextFrameRenderLayerSet.add(t)})),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getRequestAnimationFrame()((()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1})))}_doRenderInThisFrame(){if("released"===this.releaseStatus)return;this.timeline.resume(),this.ticker.start();const t=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=t,this._skipRender&&this._skipRender++}renderLayerList(t,e){const i=[];for(let e=0;e<t.length;e++){let n=t[e];"virtual"===n.layerMode&&(n=n.getNativeHandler().mainHandler.layer),i.includes(n)||i.push(n)}i.forEach((t=>{t.renderCount>this.renderCount||(t.renderCount=this.renderCount+1,t===this.interactiveLayer&&this.dirtyBounds&&this.dirtyBounds.clear(),t.render({renderService:this.renderService,background:t===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))})),this.interactiveLayer&&!t.includes(this.interactiveLayer)&&(this.dirtyBounds&&this.dirtyBounds.clear(),this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))}resizeWindow(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.window.resize(t,e),i&&this.render()}resize(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"released"!==this.releaseStatus&&(this.window.hasSubView()||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.window.resize(t,e),this.forEachChildren((i=>{i.resize(t,e)})),this.camera&&this.option3d&&this.set3dOptions(this.option3d),i&&this.render())}resizeView(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"released"!==this.releaseStatus&&(this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.forEachChildren((i=>{i.resizeView(t,e)})),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),i&&this.render())}setViewBox(t,e,i,n,o){let r=!0;"object"==typeof t?(this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2),!1===e&&(r=!1)):(this.viewBox.setValue(t,e,t+i,e+n),!1===o&&(r=!1)),this.forEachChildren((t=>{t.resizeView(this.viewBox.width(),this.viewBox.height())})),r&&this.render()}setDpr(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.forEachChildren((e=>{e.setDpr(t)})),e&&this.render()}setOrigin(t,e){throw new Error("暂不支持")}export(t){throw new Error("暂不支持")}pick(t,e){if("released"===this.releaseStatus)return;const i=this.getPickerService().pick(this.children,new fe(t,e),{bounds:this.AABBBounds});return!(!(null==i?void 0:i.graphic)&&!(null==i?void 0:i.group))&&i}startAnimate(t){throw new Error("暂不支持")}setToFrame(t){throw new Error("暂不支持")}release(){super.release(),this.hooks.beforeRender.unTap("constructor",this.beforeRender),this.hooks.afterRender.unTap("constructor",this.afterRender),this.eventSystem&&this.eventSystem.release(),this.layerService.releaseStage(this),this.pluginService.release(),this.forEach((t=>{t.release()})),this.interactiveLayer&&(this.interactiveLayer.forEachChildren((t=>{t.setStage&&t.setStage(null,null),this.interactiveLayer.removeChild(t)})),this.interactiveLayer.release()),this.window.release(),this.ticker.remTimeline(this.timeline),this.ticker.removeListener("afterTick",this.afterTickCb),this.renderService.renderTreeRoots=[]}setStage(t){}dirty(t,e){"released"!==this.releaseStatus&&(e&&t.transformWithMatrix(e),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(t.x1,t.y1,t.x2,t.y2),this.dirtyBounds.union(t))}getLayer(t){return this.children.filter((e=>e.name===t))[0]}renderTo(t){"released"!==this.releaseStatus&&this.forEachChildren(((e,i)=>{e.drawTo(t,{renderService:this.renderService,viewBox:t.getViewBox(),transMatrix:t.getViewBoxTransform(),background:e===this.defaultLayer?this.background:void 0,clear:0===i,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())})}))}renderToNewWindow(){let t=arguments.length>1?arguments[1]:void 0;if("released"===this.releaseStatus)return;const e=fo.get(xo),i=t?-t.x1:0,n=t?-t.y1:0,o=t?t.x2:this.viewWidth,r=t?t.y2:this.viewHeight,s=t?t.width():this.viewWidth,a=t?t.height():this.viewHeight;return e.create({viewBox:{x1:i,y1:n,x2:o,y2:r},width:s,height:a,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""}),this.renderTo(e),e}toCanvas(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;if("released"===this.releaseStatus)return;const i=this.renderToNewWindow(t,e).getNativeHandler();return i.nativeCanvas?i.nativeCanvas:null}setCursor(t){this._cursor=t,this.eventSystem.setCursor(t,"ignore")}getCursor(){return this._cursor}eventPointTransform(t){const e=this.global.mapToCanvasPoint(t,this.window.getContext().canvas.nativeCanvas);return this.stage.window.pointTransform(e.x,e.y)}pauseTriggerEvent(){this._eventSystem&&this._eventSystem.pauseTriggerEvent()}resumeTriggerEvent(){this._eventSystem&&this._eventSystem.resumeTriggerEvent()}getPickerService(){return this.pickerService||(this.pickerService=fo.get(Nc)),this.pickerService}reInit(){this.renderService.reInit(),this.pickerService.reInit()}}function Ku(t){return new Yu(t)}const qu={WIDTH:500,HEIGHT:500,DPR:1};class Zu{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get nativeCanvas(){return this._nativeCanvas}set nativeCanvas(t){this._nativeCanvas=t}get width(){return this._pixelWidth}set width(t){this._pixelWidth=t,this._displayWidth=t/(this._dpr||1)}get height(){return this._pixelHeight}set height(t){this._pixelHeight=t,this._displayHeight=t/(this._dpr||1)}getContext(t){return this._context}get visiable(){return this._visiable}set visiable(t){this._visiable=t,t?this.show():this.hide()}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this.resize(this._displayWidth,this._displayHeight)}constructor(t){var e;const{nativeCanvas:i,width:n=qu.WIDTH,height:o=qu.HEIGHT,dpr:r=qu.DPR,x:s,y:a,id:l,canvasControled:h=!0}=t;this._x=null!=s?s:0,this._y=null!=a?a:0,this._pixelWidth=n*r,this._pixelHeight=o*r,this._visiable=!1!==t.visiable,this.controled=h,this._displayWidth=n,this._displayHeight=o,this._dpr=r,this._nativeCanvas=i,this._id=null!==(e=i.id)&&void 0!==e?e:l,l&&(i.id=l),this.init(t)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(t){}resize(t,e){}toDataURL(t,e){return""}readPixels(t,e,i,n){return this._context.getImageData(t,e,i,n)}convertToBlob(t){throw new Error("暂未实现")}transferToImageBitmap(){throw new Error("暂未实现")}release(){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}}Zu.env="browser";var Ju=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Qu=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))};let tg=class{configure(t){t.env===this.type&&t.setActiveEnvContribution(this)}getNativeAABBBounds(t){return new Fe}removeDom(t){return!1}createDom(t){return null}updateDom(t,e){return!1}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(t){return document.getElementById(t)}getRootElement(){return document.body}loadJson(t){const e=fetch(t).then((t=>t.json()));return e.then((t=>({data:t,state:"success"}))).catch((()=>({data:null,state:"fail"}))),e}loadArrayBuffer(t){return fetch(t).then((t=>t.arrayBuffer())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadBlob(t){return fetch(t).then((t=>t.blob())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}getElementTop(t,e){return 0}getElementLeft(t,e){return 0}getElementTopLeft(t,e){return{top:0,left:0}}loadFont(t,e,i){return Qu(this,void 0,void 0,(function*(){return{loadState:"fail"}}))}isMacOS(){return!1}copyToClipBoard(t){return Promise.resolve(null)}};tg=Ju([w()],tg);var eg=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ig=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let ng=class{constructor(){this._uid=a.GenAutoIncrementId(),this.viewBox=new Fe,this.modelMatrix=new De(1,0,0,1,0,0)}onChange(t){this._onChangeCb=t}configure(t,e){e.env===this.type&&t.setWindowHandler(this)}release(){this.releaseWindow()}isVisible(t){return!0}onVisibleChange(t){}getTopLeft(t){return{top:0,left:0}}setViewBox(t){this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2)}getViewBox(){return this.viewBox}setViewBoxTransform(t,e,i,n,o,r){this.modelMatrix.setValue(t,e,i,n,o,r)}getViewBoxTransform(){return this.modelMatrix}};ng=eg([w(),ig("design:paramtypes",[])],ng);var og=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},rg=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},sg=function(t,e){return function(i,n){e(i,n,t)}};let ag=class{constructor(t,e){this.pickItemInterceptorContributions=t,this.pickServiceInterceptorContributions=e,this.type="default",this.global=$n.global}reInit(){this._init()}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort(((t,e)=>t.order-e.order)),this.pickerServiceInterceptorContributions=this.pickServiceInterceptorContributions.getContributions().sort(((t,e)=>t.order-e.order))}pick(t,e,i){let n={graphic:null,group:null};i.pickerService=this;const o=i.bounds.width(),r=i.bounds.height();if(!(new Fe).setValue(0,0,o,r).containsPoint(e))return n;this.pickContext&&(this.pickContext.inuse=!0),i.pickContext=this.pickContext,this.pickContext&&this.pickContext.clearMatrix(!0,1);const s=new De(1,0,0,1,0,0);let a;for(let o=t.length-1;o>=0&&(n=t[o].isContainer?this.pickGroup(t[o],e,s,i):this.pickItem(t[o],e,s,i),!n.graphic);o--)a||(a=n.group);if(n.graphic||(n.group=a),this.pickContext&&(this.pickContext.inuse=!1),this.pickerServiceInterceptorContributions.length)for(let t=0;t<this.pickerServiceInterceptorContributions.length;t++){const o=this.pickerServiceInterceptorContributions[t];o.afterPickItem&&(n=o.afterPickItem(n,this,e,i,{parentMatrix:s}))}return n}containsPoint(t,e,i){var n;return!!(null===(n=this.pickItem(t,e,null,null!=i?i:{pickContext:this.pickContext,pickerService:this}))||void 0===n?void 0:n.graphic)}pickGroup(t,e,i,n){let o={group:null,graphic:null};if(!1===t.attribute.visibleAll)return o;const r=n.pickContext,s=r.modelMatrix;if(r.camera){const e=t.transMatrix,i=Al.allocate();if(Cl(i,e),s){if(i){const t=Al.allocate();r.modelMatrix=wl(t,s,i),Al.free(i)}}else Cl(i,t.globalTransMatrix),r.modelMatrix=i}if(this.InterceptorContributions.length)for(let o=0;o<this.InterceptorContributions.length;o++){const a=this.InterceptorContributions[o];if(a.beforePickItem){const o=a.beforePickItem(t,this,e,n,{parentMatrix:i});if(o)return r.modelMatrix!==s&&Al.free(r.modelMatrix),r.modelMatrix=s,o}}const a=t.transMatrix,l=Sl.allocateByObj(i),h=new fe(e.x,e.y);l.transformPoint(h,h);const d=t.AABBBounds.containsPoint(h);if(!d&&!t.stage.camera)return o;const c=this.pickItem(t,h.clone(),i,n);c&&c.graphic&&(o.graphic=c.graphic,o.params=c.params);const u=!1!==t.attribute.pickable&&d;return l.multiply(a.a,a.b,a.c,a.d,a.e,a.f),!1===t.attribute.childrenPickable||c&&c.graphic||gu(t,Ln.zIndex,(r=>{if(r.isContainer){const i=new fe(e.x,e.y),s=zo(t).group,{scrollX:a=s.scrollX,scrollY:h=s.scrollY}=t.attribute;i.x-=a,i.y-=h,o=this.pickGroup(r,i,l,n)}else{const s=new fe(e.x,e.y);l.transformPoint(s,s);const a=zo(t).group,{scrollX:h=a.scrollX,scrollY:d=a.scrollY}=t.attribute;s.x-=h,s.y-=d;const c=this.pickItem(r,s,i,n);c&&c.graphic&&(o.graphic=c.graphic,o.params=c.params)}return!!o.graphic||!!o.group}),!0,!!r.camera),r.modelMatrix!==s&&Al.free(r.modelMatrix),r.modelMatrix=s,o.graphic||o.group||!u||t.stage.camera||(o.group=t),Sl.free(l),o}selectPicker(t){return this.pickerMap.get(t.numberType)||null}};ag=og([w(),sg(0,y(F)),sg(0,x(jc)),sg(1,y(F)),sg(1,x(Vc)),rg("design:paramtypes",[Object,Object])],ag);let lg=!1;const hg=new l((t=>{lg||(lg=!0,t(hd).toSelf().inSingletonScope(),t(cc).to(hd).inSingletonScope(),t(gc).toService(cc),t(rl).toService(Lh),D(t,rl))}));let dg=!1;const cg=new l((t=>{dg||(dg=!0,t(Od).toSelf().inSingletonScope(),t(mc).to(Od).inSingletonScope(),t(gc).toService(mc),t(Yh).toSelf(),t($h).toSelf(),t(ul).toService(Yh),t(ul).toService($h),t(ul).toService(Lh),D(t,ul))}));let ug=!1;const gg=new l((t=>{ug||(ug=!0,t(md).toSelf().inSingletonScope(),t(wu).toSelf().inSingletonScope(),t(fc).to(md).inSingletonScope(),t(gc).toService(fc))}));let pg=!1;const fg=new l((t=>{pg||(pg=!0,t(Dd).toSelf().inSingletonScope(),t(yc).to(Dd).inSingletonScope(),t(gc).toService(yc),t(gl).toService(Lh),D(t,gl))}));let vg=!1;const bg=new l((t=>{vg||(vg=!0,t(gd).toSelf().inSingletonScope(),t(uc).to(gd).inSingletonScope(),t(gc).toService(uc),t(al).toService(Lh),D(t,al))}));let mg=!1;const yg=new l((t=>{mg||(mg=!0,t(Cc).to(Ud).inSingletonScope(),t(gc).toService(Cc),t(pl).toService(Lh),D(t,pl))}));let Cg=!1;const wg=new l((t=>{Cg||(Cg=!0,t(Ld).toSelf().inSingletonScope(),t(vc).to(Ld).inSingletonScope(),t(gc).toService(vc),t(dl).toService(Lh),D(t,dl))}));let xg=!1;const _g=new l((t=>{xg||(xg=!0,t(bc).to(tc).inSingletonScope(),t(gc).toService(bc),t(cl).toService(Lh),D(t,cl))}));var Sg=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ag=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Bg=class extends rd{constructor(){super(),this.numberType=va,this.builtinContributions=[Nd],this.init()}drawShape(t,e,i,n,o){const r=zo(t).richtext,{strokeOpacity:s=r.strokeOpacity,opacity:a=r.opacity,fillOpacity:l=r.fillOpacity,visible:h=r.visible}=t.attribute;if(!t.valid||!h)return;const d=Ka(a,l,!0),c=Ka(a,s,!0);d&&(e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,r),e.translate(i,n),this.beforeRenderStep(t,e,i,n,d,c,d,c,r,o),t.getFrameCache().draw(e,this.drawIcon),this.afterRenderStep(t,e,i,n,d,c,d,c,r,o))}drawIcon(t,e,i,n,o){var r;const s=zo(t).richtextIcon,{width:a=s.width,height:l=s.height,opacity:h=s.opacity,image:d,backgroundFill:c=s.backgroundFill,backgroundFillOpacity:u=s.backgroundFillOpacity,backgroundStroke:g=s.backgroundStroke,backgroundStrokeOpacity:p=s.backgroundStrokeOpacity,backgroundRadius:f=s.backgroundRadius,margin:v}=t.attribute,{backgroundWidth:b=a,backgroundHeight:m=l}=t.attribute;if(v&&(i+=t._marginArray[3],n+=t._marginArray[0]),t._hovered){const t=(b-a)/2,o=(m-l)/2;0===f?(e.beginPath(),e.rect(i-t,n-o,b,m)):(e.beginPath(),Vh(e,i-t,n-o,b,m,f,!0)),c&&(e.globalAlpha=u,e.fillStyle=c,e.fill()),g&&(e.globalAlpha=p,e.strokeStyle=g,e.stroke())}const y=d&&(null===(r=null==t?void 0:t.resources)||void 0===r?void 0:r.get(d));y&&"success"===y.state&&(e.globalAlpha=h,e.drawImage(y.data,i,n,a,l))}draw(t,e,i){const n=zo(t).richtext;this._draw(t,n,!1,i)}};Bg=Sg([w(),Ag("design:paramtypes",[])],Bg);let Tg=!1;const Rg=new l((t=>{Tg||(Tg=!0,t(wc).to(Bg).inSingletonScope(),t(gc).toService(wc))}));let kg=!1;const Mg=new l((t=>{kg||(kg=!0,t(xc).to(hc).inSingletonScope(),t(gc).toService(xc),t(hl).toService(Lh),D(t,hl))}));const Lg=new Fe;class Pg{constructor(){this.name="FlexLayoutPlugin",this.activeEvent="onRegister",this.id=a.GenAutoIncrementId(),this.key=this.name+this.id,this.tempBounds=new Fe}pauseLayout(t){this.pause=t}tryLayoutChildren(t){t.firstChild&&this.tryLayout(t.firstChild)}tryLayout(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.pause)return;const i=t.parent;if(!(e||i&&t.needUpdateLayout()))return;const n=zo(i).group,{display:o=n.display}=i.attribute;if("flex"!==o)return;const{flexDirection:r=n.flexDirection,flexWrap:s=n.flexWrap,alignItems:a=n.alignItems,clip:l=n.clip}=i.attribute,{alignContent:h=(null!=a?a:n.alignContent)}=i.attribute;let{width:d,height:c,justifyContent:u=n.justifyContent}=i.attribute;const g=i.getChildren();if(null==d||null==c){let t=0,e=0,i=0;if(g.forEach((n=>{const o=this.getAABBBounds(n);o.empty()||("column"===r||"column-reverse"===r?(e+=o.height(),t=Math.max(t,o.width())):(t+=o.width(),e=Math.max(e,o.height())),i+=o.x1,i+=o.y1,i+=o.x2,i+=o.y2)})),!isFinite(i))return;d=t,c=e}null==i.attribute.width?i.attribute.width=d:d=i.attribute.width,null==i.attribute.height?i.attribute.height=c:c=i.attribute.height,this.tempBounds.copy(i._AABBBounds);const p={main:{len:d,field:"x"},cross:{len:c,field:"y"}},f=p.main,v=p.cross;"column"!==r&&"column-reverse"!==r||(f.len=c,v.len=d,f.field="y",v.field="x"),"row-reverse"!==r&&"column-reverse"!==r||("flex-start"===u?u="flex-end":"flex-end"===u?u="flex-start":g.reverse());let b=0,m=0;const y=[];g.forEach((t=>{const e=this.getAABBBounds(t);if(e.empty())return;const i="x"===f.field?e.width():e.height(),n="x"===v.field?e.width():e.height();y.push({mainLen:i,crossLen:n}),b+=i,m=Math.max(m,n)}));const C=[];if(b>f.len&&"wrap"===s){let t=0,e=0;y.forEach(((i,n)=>{let{mainLen:o,crossLen:r}=i;t+o>f.len?0===t?(C.push({idx:n,mainLen:t+o,crossLen:r}),t=0,e=0):(C.push({idx:n-1,mainLen:t,crossLen:e}),t=o,e=r):(t+=o,e=Math.max(e,r))})),C.push({idx:y.length-1,mainLen:t,crossLen:e})}else C.push({idx:y.length-1,mainLen:b,crossLen:m});let w=0;if(C.forEach((t=>{this.layoutMain(i,g,u,f,y,w,t),w=t.idx+1})),m=C.reduce(((t,e)=>t+e.crossLen),0),1===C.length){const t={"flex-start":0,"flex-end":v.len,center:v.len/2};this.layoutCross(g,a,v,t,y,C[0],0)}else if("flex-start"===h){w=0;let t=0;C.forEach(((e,i)=>{const n={"flex-start":t,"flex-end":t+e.crossLen,center:t+e.crossLen/2};this.layoutCross(g,"flex-start",v,n,y,C[i],w),w=e.idx+1,t+=e.crossLen}))}else if("center"===h){w=0;let t=Math.max(0,(v.len-m)/2);C.forEach(((e,i)=>{const n={"flex-start":t,"flex-end":t+e.crossLen,center:t+e.crossLen/2};this.layoutCross(g,"center",v,n,y,C[i],w),w=e.idx+1,t+=e.crossLen}))}else if("space-around"===h){w=0;const t=Math.max(0,(v.len-m)/C.length/2);let e=t;C.forEach(((i,n)=>{const o={"flex-start":e,"flex-end":e+i.crossLen,center:e+i.crossLen/2};this.layoutCross(g,"flex-start",v,o,y,C[n],w),w=i.idx+1,e+=i.crossLen+2*t}))}else if("space-between"===h){w=0;const t=Math.max(0,(v.len-m)/(2*C.length-2));let e=0;C.forEach(((i,n)=>{const o={"flex-start":e,"flex-end":e+i.crossLen,center:e+i.crossLen/2};this.layoutCross(g,"flex-start",v,o,y,C[n],w),w=i.idx+1,e+=i.crossLen+2*t}))}g.forEach(((t,e)=>{t.addUpdateBoundTag(),t.addUpdatePositionTag(),t.clearUpdateLayoutTag()})),i.addUpdateLayoutTag();const x=this.getAABBBounds(i);l||this.tempBounds.equals(x)||this.tryLayout(i,!1)}getAABBBounds(t){this.skipBoundsTrigger=!0;const e=t.AABBBounds;return this.skipBoundsTrigger=!1,e}updateChildPos(t,e,i){return t+(null!=e?e:0)-i}layoutMain(t,e,i,n,o,r,s){if("flex-start"===i){let t=0;for(let i=r;i<=s.idx;i++){const r=t+(e[i],n.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[n.field]=this.updateChildPos(r,e[i].attribute[n.field],s[`${n.field}1`])),t+=o[i].mainLen}}else if("flex-end"===i){let t=n.len;for(let i=s.idx;i>=r;i--){t-=o[i].mainLen;const r=t+(e[i],n.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[n.field]=this.updateChildPos(r,e[i].attribute[n.field],s[`${n.field}1`]))}}else if("space-around"===i)if(s.mainLen>=n.len){let t=0;for(let i=r;i<=s.idx;i++){const r=t+(e[i],n.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[n.field]=this.updateChildPos(r,e[i].attribute[n.field],s[`${n.field}1`])),t+=o[i].mainLen}}else{const t=s.idx-r+1,i=(n.len-s.mainLen)/t/2;let a=i;for(let t=r;t<=s.idx;t++){const r=a+(e[t],n.field,0),s=this.getAABBBounds(e[t]);!s.empty()&&(e[t].attribute[n.field]=this.updateChildPos(r,e[t].attribute[n.field],s[`${n.field}1`])),a+=o[t].mainLen+2*i}}else if("space-between"===i)if(s.mainLen>=n.len){let t=0;for(let i=r;i<=s.idx;i++){const r=t+(e[i],n.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[n.field]=this.updateChildPos(r,e[i].attribute[n.field],s[`${n.field}1`])),t+=o[i].mainLen}}else{const t=s.idx-r+1,i=(n.len-s.mainLen)/(2*t-2);let a=0;for(let t=r;t<=s.idx;t++){const r=a+(e[t],n.field,0),s=this.getAABBBounds(e[t]);!s.empty()&&(e[t].attribute[n.field]=this.updateChildPos(r,e[t].attribute[n.field],s[`${n.field}1`])),a+=o[t].mainLen+2*i}}else if("center"===i){let t=(n.len-s.mainLen)/2;for(let i=r;i<=s.idx;i++){const r=t+(e[i],n.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[n.field]=this.updateChildPos(r,e[i].attribute[n.field],s[`${n.field}1`])),t+=o[i].mainLen}}}layoutCross(t,e,i,n,o,r,s){var a;for(let l=s;l<=r.idx;l++){const r=t[l];let{alignSelf:s}=r.attribute;s&&"auto"!==s||(s=e);const h=this.getAABBBounds(r),d=null!==(a=n[s])&&void 0!==a?a:n["flex-start"];"flex-end"===s?!h.empty()&&(r.attribute[i.field]=this.updateChildPos(d-o[l].crossLen+(i.field,0),r.attribute[i.field],h[`${i.field}1`])):"center"===s?!h.empty()&&(r.attribute[i.field]=this.updateChildPos(d-o[l].crossLen/2+(i.field,0),r.attribute[i.field],h[`${i.field}1`])):!h.empty()&&(r.attribute[i.field]=this.updateChildPos(d+(i.field,0),r.attribute[i.field],h[`${i.field}1`]))}}activate(t){this.pluginService=t,$n.graphicService.hooks.onAttributeUpdate.tap(this.key,(t=>{t.glyphHost&&(t=t.glyphHost),t.stage&&t.stage===this.pluginService.stage&&this.tryLayout(t,!1)})),$n.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,((t,e,i,n)=>{t.glyphHost&&(t=t.glyphHost),e&&e===this.pluginService.stage&&t.isContainer&&!this.skipBoundsTrigger&&Lg.copy(n)})),$n.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,((t,e,i,n,o)=>{e&&e===this.pluginService.stage&&t.isContainer&&!this.skipBoundsTrigger&&(Lg.equals(i)||this.tryLayout(t,!1))})),$n.graphicService.hooks.onSetStage.tap(this.key,(t=>{t.glyphHost&&(t=t.glyphHost),this.tryLayout(t,!1)}))}deactivate(t){$n.graphicService.hooks.onAttributeUpdate.taps=$n.graphicService.hooks.onAttributeUpdate.taps.filter((t=>t.name!==this.key)),$n.graphicService.hooks.beforeUpdateAABBBounds.taps=$n.graphicService.hooks.beforeUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),$n.graphicService.hooks.afterUpdateAABBBounds.taps=$n.graphicService.hooks.afterUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),$n.graphicService.hooks.onSetStage.taps=$n.graphicService.hooks.onSetStage.taps.filter((t=>t.name!==this.key))}}const Eg=()=>{Xu.registerPlugin("FlexLayoutPlugin",Pg)},Hg=["x","y","dx","dy","scaleX","scaleY","angle","anchor","postMatrix","visible","clip","pickable","childrenPickable","zIndex","cursor"];class Og extends Ea{constructor(t,e){super(t),this._skipRenderAttributes=Hg,(null==e?void 0:e.mode)&&(this.mode=e.mode,this.setMode(e.mode)),(null==e?void 0:e.skipDefault)&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=t,this.onSetStage((()=>{this.render(),this.bindEvents()}))}setAttribute(t,e,i,n){const o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,n);if(o)return this._setAttributes(o,i);ht(this.attribute[t])&&ht(e)&&!ot(this.attribute[t])&&!ot(e)?Lt(this.attribute[t],e):this.attribute[t]=e,this._skipRenderAttributes.includes(t)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(t,e,i){return t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t,this._setAttributes(t,e)}_setAttributes(t,e){const i=Object.keys(t);this._mergeAttributes(t,i),i.every((t=>this._skipRenderAttributes.includes(t)))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(i)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(t,e){rt(e)&&(e=Object.keys(t));for(let i=0;i<e.length;i++){const n=e[i];!ht(this.attribute[n])||ot(this.attribute[n])||ot(t[n])?this.attribute[n]=t[n]:Lt(this.attribute[n],t[n])}}bindEvents(){}_getNodeId(t){var e;return`${null!==(e=this.id)&&void 0!==e?e:this._uid}-${this.name}-${t}`}_dispatchEvent(t,e){var i;const n=new Uo(t,e);n.manager=null===(i=this.stage)||void 0===i?void 0:i.eventSystem.manager,this.dispatchEvent(n)}eventPosToStagePos(t){var e,i;const n={x:0,y:0},o=null!==(i=null===(e=this.stage)||void 0===e?void 0:e.eventPointTransform(t))&&void 0!==i?i:{x:0,y:0};return this.globalTransMatrix.transformPoint(o,n),n}}const Ig=Symbol.for("MathPickerContribution"),Fg=Symbol.for("MathArcPicker"),zg=Symbol.for("MathCirclePicker"),Dg=Symbol.for("MathImagePicker"),Wg=Symbol.for("MathLinePicker"),Ng=Symbol.for("MathPathPicker"),Gg=Symbol.for("MathRectPicker"),jg=Symbol.for("MathSymbolPicker"),Vg=Symbol.for("MathTextPicker"),Ug=Symbol.for("MathPolygonPicker"),Xg=Symbol.for("CanvasArcPicker"),$g=Symbol.for("CanvasCirclePicker"),Yg=Symbol.for("CanvasImagePicker"),Kg=Symbol.for("CanvasLinePicker"),qg=Symbol.for("CanvasPathPicker"),Zg=Symbol.for("CanvasRectPicker"),Jg=Symbol.for("CanvasSymbolPicker"),Qg=Symbol.for("CanvasTextPicker"),tp=Symbol.for("CanvasPolygonPicker"),ep=Symbol.for("CanvasRichTextPicker"),ip=Symbol.for("CanvasGroupPicker"),np=Symbol.for("CanvasPickerContribution"),op={onPointerDown:"pointerdown",onPointerUp:"pointerup",onPointerUpOutside:"pointerupoutside",onPointerTap:"pointertap",onPointerOver:"pointerover",onPointerMove:"pointermove",onPointerEnter:"pointerenter",onPointerLeave:"pointerleave",onPointerOut:"pointerout",onMouseDown:"mousedown",onMouseUp:"mouseup",onMouseUpOutside:"mouseupoutside",onMouseMove:"mousemove",onMouseOver:"mouseover",onMouseOut:"mouseout",onMouseEnter:"mouseenter",onMouseLeave:"mouseleave",onPinch:"pinch",onPinchStart:"pinchstart",onPinchEnd:"pinchend",onPan:"pan",onPanStart:"panstart",onPanEnd:"panend",onDrag:"drag",onDragStart:"dragstart",onDragEnter:"dragenter",onDragLeave:"dragleave",onDragOver:"dragover",onDragEnd:"dragend",onRightDown:"rightdown",onRightUp:"rightup",onRightUpOutside:"rightupoutside",onTouchStart:"touchstart",onTouchEnd:"touchend",onTouchEndOutside:"touchendoutside",onTouchMove:"touchmove",onTouchCancel:"touchcancel",onPress:"press",onPressUp:"pressup",onPressEnd:"pressend",onSwipe:"swipe",onDrop:"drop",onWeel:"wheel",onClick:"click",onDblClick:"dblclick"},rp=(t,e)=>{const i=e.x-t.x,n=e.y-t.y;return Math.abs(i)>Math.abs(n)?i>0?"right":"left":n>0?"down":"up"},sp=(t,e)=>{const i=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return Math.sqrt(i*i+n*n)};class ap extends et{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,n,o,r,s,a,l,h,d,c;super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=t=>{this.startTime=Xo.now();const{cachedEvents:e,startPoints:i}=this;t&&e.push(t.clone()),i.length=e.length;for(let t=0;t<e.length;t++){const{x:n,y:o}=e[t],r={x:n,y:o};i[t]=r}if(1!==i.length)this.startDistance=sp(i[0],i[1]),this.center=(t=>{const e=t.length;if(1===e)return{x:Math.round(t[0].x),y:Math.round(t[0].y)};let i=0,n=0,o=0;for(;o<e;)i+=t[o].x,n+=t[o].y,o++;return{x:Math.round(i/e),y:Math.round(n/e)}})([i[0],i[1]]);else{const t=e[0];this.pressTimeout=setTimeout((()=>{t.direction="none",t.deltaX=0,t.deltaY=0,t.points=i,this.triggerStartEvent("press",t),this.triggerEvent("press",t),this.eventType="press",this.direction="none",this.pressTimeout=null}),this.config.press.time)}},this.onMove=t=>{this.clearPressTimeout();const{startPoints:e,cachedEvents:i}=this;if(!e.length)return;const n=t.clone(),{x:o,y:r,pointerId:s}=n;for(let t=0,e=i.length;t<e;t++)if(s===i[t].pointerId){i[t]=n;break}const a={x:o,y:r},l=i.map((t=>({x:t.x,y:t.y}))),h=Xo.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=h,this.lastMovePoint=a,1===e.length){const t=e[0],i=o-t.x,s=r-t.y,h=this.direction||rp(t,a);this.direction=h;const d=this.getEventType(a);return n.direction=h,n.deltaX=i,n.deltaY=s,n.points=l,this.triggerStartEvent(d,n),void this.triggerEvent(d,n)}const{startDistance:d}=this,c=sp(l[0],l[1]);n.scale=c/d,n.center=this.center,n.points=l,this.triggerStartEvent("pinch",n),this.triggerEvent("pinch",n)},this.onEnd=t=>{const e=t.clone(),{cachedEvents:i,startPoints:n}=this,o=i.map((t=>({x:t.x,y:t.y})));if(e.points=o,this.triggerEndEvent(e),1===i.length){const i=Xo.now(),o=this.lastMoveTime;if(i-o<100){const t=o-(this.prevMoveTime||this.startTime);if(t>0){const i=this.prevMovePoint||n[0],o=this.lastMovePoint||n[0],r=sp(i,o),s=r/t;if(s>this.config.swipe.velocity&&r>this.config.swipe.threshold)return e.velocity=s,e.direction=rp(i,o),this.triggerEvent("swipe",e),this.cachedEvents=[],this.startPoints=[],void this.reset()}}i-this.startTime<this.config.press.time&&(i-this.lastTapTime<this.config.tap.interval&&t.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=i,this.lastTapTarget=t.target,1===this.tapCount?this.triggerEvent("tap",e):2===this.tapCount&&(this.triggerEvent("doubletap",e),this.tapCount=0))}for(let t=0,o=i.length;t<o;t++)if(i[t].pointerId===e.pointerId){i.splice(t,1),n.splice(t,1);break}this.reset(),i.length>0&&this.onStart()},this.element=t,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:null!==(n=null===(i=null==e?void 0:e.press)||void 0===i?void 0:i.time)&&void 0!==n?n:251,threshold:null!==(r=null===(o=null==e?void 0:e.press)||void 0===o?void 0:o.threshold)&&void 0!==r?r:9},swipe:{threshold:null!==(a=null===(s=null==e?void 0:e.swipe)||void 0===s?void 0:s.threshold)&&void 0!==a?a:10,velocity:null!==(h=null===(l=null==e?void 0:e.swipe)||void 0===l?void 0:l.velocity)&&void 0!==h?h:.3},tap:{interval:null!==(c=null===(d=null==e?void 0:e.tap)||void 0===d?void 0:d.interval)&&void 0!==c?c:300}},this.initEvents()}initEvents(){const{element:t}=this;t&&(t.addEventListener("pointerdown",this.onStart),t.addEventListener("pointermove",this.onMove),t.addEventListener("pointerup",this.onEnd),t.addEventListener("pointerleave",this.onEnd),t.addEventListener("pointerupoutside",this.onEnd))}removeEvents(){const{element:t}=this;t&&(t.removeEventListener("pointerdown",this.onStart),t.removeEventListener("pointermove",this.onMove),t.removeEventListener("pointerup",this.onEnd),t.removeEventListener("pointerleave",this.onEnd),t.removeEventListener("pointerupoutside",this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(t){const{eventType:e,startTime:i,startPoints:n}=this;if("press"===e)return e;let o;return o=Xo.now()-i>this.config.press.time&&sp(n[0],t)<this.config.press.threshold?"press":"pan",this.eventType=o,o}enable(t){this.processEvent[t]=!0}isProcess(t){return this.processEvent[t]}pushEvent(t,e){const{emitThrottles:i}=this,n={type:t,ev:e};for(let e=0,o=i.length;e<o;e++)if(i[e].type===t)return void i.splice(e,1,n);i.push(n)}clearPressTimeout(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(t,e){this.pushEvent(t,e);const{throttleTimer:i,emitThrottles:n}=this;i||(this.throttleTimer=$n.global.getRequestAnimationFrame()((()=>{$n.global.getCancelAnimationFrame()(this.throttleTimer),this.throttleTimer=null;for(let t=0,e=n.length;t<e;t++){const{type:e,ev:i}=n[t];this.emitEvent(e,i)}this.emitThrottles.length=0})))}triggerStartEvent(t,e){this.isProcess(t)||(this.enable(t),this.triggerEvent(`${t}start`,e))}triggerEndEvent(t){const e=this.processEvent;Object.keys(e).forEach((i=>{this.triggerEvent(`${i}end`,t),"press"===i&&this.triggerEvent(`${i}up`,t),delete e[i]}))}emitEvent(t,e){if(!this.element)return;const i=this.element._events["*"];if(i)if("fn"in i)i.fn.call(i.context,e,t);else for(let n=0,o=i.length;n<o&&!e.propagationImmediatelyStopped;n++)i[n].fn.call(i[n].context,e,t);this.emit(t,e)}}var lp=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},hp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const dp=[0,0,0];let cp=class{set fillStyle(t){this.nativeContext.fillStyle=t}get fillStyle(){return this.nativeContext.fillStyle}set font(t){this.nativeContext.font=t}get font(){return this.nativeContext.font}set globalAlpha(t){this.nativeContext.globalAlpha=t*this.baseGlobalAlpha}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(t){this.nativeContext.lineCap=t}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(t){this.nativeContext.lineDashOffset=t}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(t){this.nativeContext.lineJoin=t}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(t){this.nativeContext.lineWidth=t}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(t){this.nativeContext.miterLimit=t}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(t){this.nativeContext.shadowBlur=t}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(t){this.nativeContext.shadowColor=t}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(t){this.nativeContext.shadowOffsetX=t}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(t){this.nativeContext.shadowOffsetY=t}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(t){this.nativeContext.strokeStyle=t}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(t){this.nativeContext.textAlign=t}get textAlign(){return this.nativeContext.textAlign}set textBaseline(t){this.nativeContext.textBaseline=t}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(t){t!==!!this._inuse&&(this._inuse=t,t?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(t,e){this.fillAttributes=Object.assign(Object.assign({},An),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},Tn),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},Rn),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;const i=t.nativeCanvas.getContext("2d");if(!i)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=i,this.canvas=t,this.matrix=new De(1,0,0,1,0,0),this.stack=[],this.dpr=e,this.applyedMatrix=new De(1,0,0,1,0,0),this._clearMatrix=new De(1,0,0,1,0,0),this.baseGlobalAlpha=1}reset(){this.stack.length&&Vt.getInstance().warn("可能存在bug，matrix没有清空"),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new De(1,0,0,1,0,0),this.stack.length=0,this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(t){return Sl.allocateByObj(t)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(Sl.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0))}highPerformanceRestore(){this.stack.length>0&&(Sl.free(this.matrix),this.matrix=this.stack.pop())}rotate(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.matrix.rotate(t),e&&this.setTransformForCurrent()}save(){const t=this.cloneMatrix(this.matrix);this.stack.push(t),this.nativeContext.save()}highPerformanceSave(){const t=this.cloneMatrix(this.matrix);this.stack.push(t)}scale(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.matrix.scale(t,e),i&&this.setTransformForCurrent()}setScale(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.matrix.setScale(t,e),i&&this.setTransformForCurrent()}scalePoint(t,e,i,n){let o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.translate(i,n,!1),this.scale(t,e,!1),this.translate(-i,-n,!1),o&&this.setTransformForCurrent()}setTransform(t,e,i,n,o,r){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:this.dpr;this.matrix.setValue(a*t,a*e,a*i,a*n,a*o,a*r),s&&this.setTransformForCurrent()}setTransformFromMatrix(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.dpr;this.matrix.setValue(t.a*i,t.b*i,t.c*i,t.d*i,t.e*i,t.f*i),e&&this.setTransformForCurrent()}resetTransform(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.dpr;this.setTransform(e,0,0,e,0,0),t&&this.setTransformForCurrent()}transform(t,e,i,n,o,r){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];this.matrix.multiply(t,e,i,n,o,r),s&&this.setTransformForCurrent()}transformFromMatrix(t,e){this.matrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f),e&&this.setTransformForCurrent()}translate(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.matrix.translate(t,e),i&&this.setTransformForCurrent()}rotateDegrees(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=t*Math.PI/180;this.rotate(i,e)}rotateAbout(t,e,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.translate(e,i,!1),this.rotate(t,!1),this.translate(-e,-i,!1),n&&this.setTransformForCurrent()}rotateDegreesAbout(t,e,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.translate(e,i,!1),this.rotateDegrees(t,!1),this.translate(-e,-i,!1),n&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(t,e){t?"string"==typeof t?this.nativeContext.clip(t):this.nativeContext.clip(t,e):this.nativeContext.clip()}arc(t,e,i,n,o,r,s){if(s=s||0,this.camera){const a=[];((t,e,i,n,o,r,s,a)=>{if(a)for(;i>e;)i-=oe;else for(;i<e;)i+=oe;const l=ee/3*(i>e?1:-1);let h=e,d=h;for(;d!==i;){d=l>0?Math.min(d+l,i):Math.max(d+l,i);const e=Math.abs(d-h),a=4*Math.tan(e/4)/3,c=d<h?-1:1,u=Math.cos(h),g=Math.sin(h),p=Math.cos(d),f=Math.sin(d),v=u*r+n,b=g*s+o,m=p*r+n,y=f*s+o,C=r*a*c,w=s*a*c;t.push([v-C*g,b+w*u,m+C*f,y-w*p,m,y]),h=d}})(a,n,o,t,e,i,i,r);for(let t=0;t<a.length;++t){const e=a[t];this.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5],s)}}else this.nativeContext.arc(t,e,Math.max(0,i),n,o,r)}arcTo(t,e,i,n,o){this.nativeContext.arcTo(t,e,i,n,o)}bezierCurveTo(t,e,i,n,o,r,s){if(s=s||0,this.camera){let a=s,l=s;this.modelMatrix&&(xl(dp,[t,e,s],this.modelMatrix),t=dp[0],e=dp[1],a=dp[2],xl(dp,[i,n,s],this.modelMatrix),i=dp[0],n=dp[1],l=dp[2],xl(dp,[o,r,s],this.modelMatrix),o=dp[0],r=dp[1],s=dp[2]);let h=this.camera.vp(o,r,s);o=h.x,r=h.y,h=this.camera.vp(t,e,a),t=h.x,e=h.y,h=this.camera.vp(i,n,l),i=h.x,n=h.y}this.nativeContext.bezierCurveTo(t,e,i,n,o,r)}closePath(){this.nativeContext.closePath()}ellipse(t,e,i,n,o,r,s,a){null==a?this.nativeContext.ellipse(t,e,i,n,o,r,s):this.nativeContext.ellipse(t,e,i,n,o,r,s,a)}lineTo(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(xl(dp,[t,e,i],this.modelMatrix),t=dp[0],e=dp[1],i=dp[2]);const n=this.camera.vp(t,e,i);t=n.x,e=n.y}this.nativeContext.lineTo(t,e)}moveTo(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(xl(dp,[t,e,i],this.modelMatrix),t=dp[0],e=dp[1],i=dp[2]);const n=this.camera.vp(t,e,i);t=n.x,e=n.y}this.nativeContext.moveTo(t,e)}quadraticCurveTo(t,e,i,n,o){if(o=o||0,this.camera){let r=o;this.modelMatrix&&(xl(dp,[t,e,o],this.modelMatrix),t=dp[0],e=dp[1],r=dp[2],xl(dp,[i,n,o],this.modelMatrix),i=dp[0],n=dp[1],o=dp[2]);let s=this.camera.vp(i,n,o);i=s.x,n=s.y,s=this.camera.vp(t,e,r),t=s.x,e=s.y}this.nativeContext.quadraticCurveTo(t,e,i,n)}rect(t,e,i,n,o){o=o||0,this.camera?(this.moveTo(t,e,o),this.lineTo(t+i,e,o),this.lineTo(t+i,e+n,o),this.lineTo(t,e+n,o),this.closePath()):this.nativeContext.rect(t,e,i,n)}createImageData(){const t=arguments;return 2===t.length?this.nativeContext.createImageData(t[0],t[1]):1===t.length?this.nativeContext.createImageData(t[0]):null}createLinearGradient(t,e,i,n){return isFinite(t+e+i+n)||(t=0,e=0,i=0,n=0),this.nativeContext.createLinearGradient(t,e,i,n)}createPattern(t,e){return 0===t.width||0===t.height?null:this.nativeContext.createPattern(t,e)}createRadialGradient(t,e,i,n,o,r){return this.nativeContext.createRadialGradient(t,e,i,n,o,r)}createConicGradient(t,e,i,n){if(this.nativeContext.createConicGradient&&Math.abs(n-i-2*Math.PI)<.001)return this.nativeContext.createConicGradient(i,t,e);let o,r=!1;const s=this;return{stops:[],addColorStop(t,e){this.stops.push([t,e]),r=!0},GetPattern(a,l,h){return r&&(h||(h=n-i),o=function(t,e,i,n,o,r,s,a,l){const h=Math.floor(180*o/Math.PI),d=il.GetCanvas(),c=il.GetCtx();if(!c)return null;const u=ol.GetSize(a),g=ol.GetSize(l);let p=ol.Get(e,i,n,r,s,u,g);if(p)return p;const f=Math.sqrt(Math.max(Math.max(Math.pow(i,2)+Math.pow(n,2),Math.pow(u-i,2)+Math.pow(n,2)),Math.max(Math.pow(u-i,2)+Math.pow(g-n,2),Math.pow(i,2)+Math.pow(g-n,2)))),v=h+1,b=o/Math.max(1,v-1),m=nl.getInstance().GetOrCreate(i,n,u,g,e,v),y=2*Math.PI*f/360;d.width=u,d.height=g,c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,u,g),c.translate(i,n),c.rotate(r);for(let t=0,e=v-1;t<e&&!(r+t*b>s);t++){const e=m.getColor(t);c.beginPath(),c.rotate(b),c.moveTo(0,0),c.lineTo(f,-2*y),c.lineTo(f,0),c.fillStyle=e,c.closePath(),c.fill()}const C=c.getImageData(0,0,u,g);return d.width=C.width,d.height=C.height,c.putImageData(C,0,0),p=t.createPattern(d,"no-repeat"),p&&ol.Set(e,i,n,r,s,p,u,g),p}(s,this.stops,t,e,h,i,n,a,l),r=!1),o}}}fill(t,e){this.disableFill||(t?this.nativeContext.fill(t):this.nativeContext.fill())}fillRect(t,e,i,n){this.nativeContext.fillRect(t,e,i,n)}clearRect(t,e,i,n){this.nativeContext.clearRect(t,e,i,n)}project(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(xl(dp,[t,e,i],this.modelMatrix),t=dp[0],e=dp[1],i=dp[2]);const n=this.camera.vp(t,e,i);t=n.x,e=n.y}return{x:t,y:e}}view(t,e,i){return i=i||0,this.camera?(this.modelMatrix&&(xl(dp,[t,e,i],this.modelMatrix),t=dp[0],e=dp[1],i=dp[2]),this.camera.view(t,e,i)):[t,e,i]}fillText(t,e,i,n){if(n=n||0,this.camera){this.modelMatrix&&(xl(dp,[e,i,n],this.modelMatrix),e=dp[0],i=dp[1],n=dp[2]);const t=this.camera.vp(e,i,n);e=t.x,i=t.y}this.nativeContext.fillText(t,e,i)}getImageData(t,e,i,n){return this.nativeContext.getImageData(t,e,i,n)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(t,e){return this.nativeContext.isPointInPath(t,e)}isPointInStroke(t,e){return this.nativeContext.isPointInStroke(t,e)}measureText(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$n.global.measureTextMethod;var i,n;if(!e||"native"===e)return this.nativeContext.measureText(t);this.mathTextMeasure||(this.mathTextMeasure=$n.graphicUtil.createTextMeasureInstance({},{},(()=>this.canvas.nativeCanvas)));const o=null!==(i=this.fontFamily)&&void 0!==i?i:Rn.fontFamily,r=null!==(n=this.fontSize)&&void 0!==n?n:Rn.fontSize;return this.mathTextMeasure.textSpec.fontFamily===o&&this.mathTextMeasure.textSpec.fontSize===r||(this.mathTextMeasure.textSpec.fontFamily=o,this.mathTextMeasure.textSpec.fontSize=r,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(t,e)}putImageData(t,e,i){this.nativeContext.putImageData(t,e,i)}setLineDash(t){const e=arguments,i=this.nativeContext;this.nativeContext.setLineDash?e[0]&&i.setLineDash(e[0]):"mozDash"in i?i.mozDash=e[0]:"webkitLineDash"in i&&(i.webkitLineDash=e[0])}stroke(t){this.disableStroke||(t?this.nativeContext.stroke(t):this.nativeContext.stroke())}strokeRect(t,e,i,n){this.nativeContext.strokeRect(t,e,i,n)}strokeText(t,e,i,n){if(n=n||0,this.camera){this.modelMatrix&&(xl(dp,[e,i,n],this.modelMatrix),e=dp[0],i=dp[1],n=dp[2]);const t=this.camera.vp(e,i,n);e=t.x,i=t.y}this.nativeContext.strokeText(t,e,i)}drawImage(){const t=this.nativeContext,e=arguments;3===e.length?t.drawImage(e[0],e[1],e[2]):5===e.length?t.drawImage(e[0],e[1],e[2],e[3],e[4]):9===e.length&&t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}setCommonStyle(t,e,i,n,o){if(Array.isArray(o)){if(o.length<=1)return this._setCommonStyle(t,e,i,n,o[0]);const r=Object.create(o[0]);return o.forEach(((t,e)=>{0!==e&&Object.assign(r,t)})),this._setCommonStyle(t,e,i,n,r)}return this._setCommonStyle(t,e,i,n,o)}_setCommonStyle(t,e,i,n,o){const r=this.nativeContext;o||(o=this.fillAttributes);const{fillOpacity:s=o.fillOpacity,opacity:a=o.opacity,fill:l=o.fill}=e;r.globalAlpha=s*a*this.baseGlobalAlpha,s>1e-12&&a>1e-12&&(r.fillStyle=Zn(this,l,t,i,n))}setShadowBlendStyle(t,e,i){if(Array.isArray(i)){if(i.length<=1)return this._setShadowBlendStyle(t,i[0]);const n=Object.create(i[0]);return i.forEach(((t,e)=>{0!==e&&Object.assign(n,t)})),this._setShadowBlendStyle(t,e,n)}return this._setShadowBlendStyle(t,e,i)}_setShadowBlendStyle(t,e,i){const n=this.nativeContext;i||(i=this.fillAttributes);const{opacity:o=i.opacity,shadowBlur:r=i.shadowBlur,shadowColor:s=i.shadowColor,shadowOffsetX:a=i.shadowOffsetX,shadowOffsetY:l=i.shadowOffsetY,blur:h=i.blur,filter:d=i.filter,globalCompositeOperation:c=i.globalCompositeOperation}=e;o<=1e-12||(r||a||l?(n.shadowBlur=r*this.dpr,n.shadowColor=s,n.shadowOffsetX=a*this.dpr,n.shadowOffsetY=l*this.dpr,this._clearShadowStyle=!0):this._clearShadowStyle&&(n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0),h?(n.filter=`blur(${h}px)`,this._clearFilterStyle=!0):d?(n.filter=d,this._clearFilterStyle=!0):this._clearFilterStyle&&(n.filter="blur(0px)",this._clearFilterStyle=!1),c?(n.globalCompositeOperation=c,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&(n.globalCompositeOperation="source-over",this._clearGlobalCompositeOperationStyle=!1))}setStrokeStyle(t,e,i,n,o){if(Array.isArray(o)){if(o.length<=1)return this._setStrokeStyle(t,e,i,n,o[0]);const r=Object.create(o[0]);return o.forEach(((t,e)=>{0!==e&&Object.assign(r,t)})),this._setStrokeStyle(t,e,i,n,r)}return this._setStrokeStyle(t,e,i,n,o)}_setStrokeStyle(t,e,i,n,o){const r=this.nativeContext;o||(o=this.strokeAttributes);const{strokeOpacity:s=o.strokeOpacity,opacity:a=o.opacity}=e;if(r.globalAlpha=s*a*this.baseGlobalAlpha,s>1e-12&&a>1e-12){const{lineWidth:s=o.lineWidth,stroke:a=o.stroke,lineJoin:l=o.lineJoin,lineDash:h=o.lineDash,lineDashOffset:d=o.lineDashOffset,lineCap:c=o.lineCap,miterLimit:u=o.miterLimit,keepStrokeScale:g=o.keepStrokeScale}=e;r.lineWidth=g?s:qn(this,s,this.dpr),r.strokeStyle=Zn(this,a,t,i,n),r.lineJoin=l,h&&(r.setLineDash(h),r.lineDashOffset=d),r.lineCap=c,r.miterLimit=u}}setTextStyleWithoutAlignBaseline(t,e,i){const n=this.nativeContext;e||(e=this.textAttributes);const{scaleIn3d:o=e.scaleIn3d}=t;t.font?n.font=t.font:n.font=Le(t,e,o&&this.camera&&this.camera.getProjectionScale(i));const{fontFamily:r=e.fontFamily,fontSize:s=e.fontSize}=t;this.fontFamily=r,this.fontSize=s,n.textAlign="left",n.textBaseline="alphabetic"}setTextStyle(t,e,i){var n,o;const r=this.nativeContext;e||(e=this.textAttributes),t.font?r.font=t.font:r.font=Le(t,e,this.camera&&this.camera.getProjectionScale(i));const{fontFamily:s=e.fontFamily,fontSize:a=e.fontSize}=t;this.fontFamily=s,this.fontSize=a,r.textAlign=null!==(n=t.textAlign)&&void 0!==n?n:e.textAlign,r.textBaseline=null!==(o=t.textBaseline)&&void 0!==o?o:e.textBaseline}draw(){}clearMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.dpr;this.setTransformFromMatrix(this._clearMatrix,t,e)}setClearMatrix(t,e,i,n,o,r){this._clearMatrix.setValue(t,e,i,n,o,r)}onlyTranslate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.dpr;return this.matrix.a===t&&0===this.matrix.b&&0===this.matrix.c&&this.matrix.d===t}release(){this.stack.forEach((t=>Sl.free(t))),this.stack.length=0}};cp.env="browser",cp=lp([w(),hp("design:paramtypes",[Object,Number])],cp);var up=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},gp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let pp=class extends Zu{constructor(t){super(t)}init(t){const{container:e}=t;if("string"==typeof e){const t=$n.global.getElementById(e);t&&(this._container=t)}else this._container=e;this._context=new cp(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;const{nativeCanvas:t}=this;t.width=this._pixelWidth,t.height=this._pixelHeight,!t.style||this.setCanvasStyle(t,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(t),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display="none")}show(){this._nativeCanvas&&(this._nativeCanvas.style.display="block")}applyPosition(){const t=this._nativeCanvas;t.style.position="absolute",t.style.top=`${this._y}px`,t.style.left=`${this._x}px`}resetStyle(t){if(!this.controled)return;const{width:e=this._displayWidth,height:i=this._displayHeight,dpr:n=this._dpr,x:o=this._x,y:r=this._y}=t,{nativeCanvas:s}=this;s.width=e*n,s.height=i*n,!s.style||this.setCanvasStyle(s,o,r,e,i),t.id&&(s.id=t.id),this.visiable||this.hide()}setCanvasStyle(t,e,i,n,o){this.controled&&(t.style.width=`${n}px`,t.style.height=`${o}px`)}toDataURL(t,e){return"image/jpeg"===t?this._nativeCanvas.toDataURL(t,e):"image/png"===t?this._nativeCanvas.toDataURL(t):this._nativeCanvas.toDataURL(t,e)}resize(t,e){this.controled&&(this._pixelWidth=t*this._dpr,this._pixelHeight=e*this._dpr,this._displayWidth=t,this._displayHeight=e,this._nativeCanvas.style&&(this._nativeCanvas.style.width=`${t}px`,this._nativeCanvas.style.height=`${e}px`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};function fp(t,e){return new l((i=>{i(vo).toDynamicValue((()=>e=>new t(e))).whenTargetNamed(t.env),i(bo).toDynamicValue((()=>(t,i)=>new e(t,i))).whenTargetNamed(e.env)}))}pp.env="browser",pp=up([w(),gp("design:paramtypes",[Object])],pp);const vp=fp(pp,cp);var bp=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},mp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},yp=function(t,e){return function(i,n){e(i,n,t)}};let Cp=class extends ag{constructor(t,e,i,n){super(i,n),this.contributions=t,this.drawContribution=e,this.pickItemInterceptorContributions=i,this.pickServiceInterceptorContributions=n,this.global.hooks.onSetEnv.tap("canvas-picker-service",((t,e,i)=>{this.configure(i,e)})),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach((t=>{this.pickerMap.set(t.numberType,t)})),super._init()}configure(t,e){this.pickCanvas=yo.shareCanvas(),this.pickContext=this.pickCanvas.getContext("2d")}pickItem(t,e,i,n){if(!1===t.attribute.pickable)return null;if(this.InterceptorContributions.length)for(let o=0;o<this.InterceptorContributions.length;o++){const r=this.InterceptorContributions[o];if(r.beforePickItem){const o=r.beforePickItem(t,this,e,n,{parentMatrix:i});if(o)return o}}const o=this.pickerMap.get(t.numberType);if(!o)return null;const r=o.contains(t,e,n),s=r?t:null,a={graphic:s,params:r};if(s)return a;if(this.InterceptorContributions.length)for(let o=0;o<this.InterceptorContributions.length;o++){const r=this.InterceptorContributions[o];if(r.afterPickItem){const o=r.afterPickItem(t,this,e,n,{parentMatrix:i});if(o)return o}}return a}};Cp=bp([w(),yp(0,y(F)),yp(0,x(np)),yp(1,y(_c)),yp(2,y(F)),yp(2,x(jc)),yp(3,y(F)),yp(3,x(Vc)),mp("design:paramtypes",[Object,Object,Object,Object])],Cp);var wp=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let xp=class{constructor(){this.type="group",this.numberType=da}contains(t,e,i){return!1}};xp=wp([w()],xp);const _p=new l(((t,e,i,n)=>{_p.__vloaded||(_p.__vloaded=!0,t(ip).to(xp).inSingletonScope(),t(np).toService(ip),D(t,np))}));_p.__vloaded=!1;var Sp=_p;const Ap=new l(((t,e,i,n)=>{i(Cp)||t(Cp).toSelf().inSingletonScope(),i(Nc)?n(Nc).toService(Cp):t(Nc).toService(Cp)}));var Bp,Tp=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Rp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let kp=Bp=class extends ng{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return`${Bp.idprefix}_${Bp.prefix_count++}`}constructor(){super(),this.type="browser",this._canvasIsIntersecting=!0,this.global=$n.global,this.viewBox=new Fe,this.modelMatrix=new De(1,0,0,1,0,0)}getTitle(){return this.canvas.id&&this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(t){t.canvas?this.createWindowByCanvas(t):this.createWindowByConfig(t),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch(t){}}isElementVisible(t){const e=t.getBoundingClientRect(),i=window.innerWidth||document.documentElement.clientWidth,n=window.innerHeight||document.documentElement.clientHeight;return!(e.right<0||e.bottom<0||e.left>i||e.top>n)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);const t=new IntersectionObserver(((t,e)=>{t.forEach((t=>{this._canvasIsIntersecting!==t.isIntersecting?(this._canvasIsIntersecting=t.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(t.isIntersecting)):this._canvasIsIntersecting=t.isIntersecting}))}));t&&t.observe(this.canvas.nativeCanvas)}createWindowByConfig(t){const e=this.global.createCanvas({width:t.width,height:t.height});let i;if(i="string"==typeof t.container?this.global.getElementById(t.container):t.container?t.container:this.global.getRootElement(),!i)throw new Error("发生错误，containerId可能传入有误");t.offscreen?i=null:i.appendChild(e);const n={width:t.width,height:t.height,dpr:t.dpr,nativeCanvas:e,container:i,id:Bp.GenerateCanvasId(),canvasControled:!0};this.canvas=new pp(n)}createWindowByCanvas(t){var e;let i;if("string"==typeof t.canvas){if(i=this.global.getElementById(t.canvas),!i)throw new Error("canvasId 参数不正确，请确认canvas存在并插入dom")}else i=t.canvas;if(!i)throw new Error("发生错误，传入的canvas不正确");let n=t.width,o=t.height;if(null==n||null==o||!t.canvasControled){const t=i.getBoundingClientRect();n=t.width,o=t.height}let r=t.dpr;null==r&&(r=null!==(e=i.getContext("2d").pixelRatio)&&void 0!==e?e:i.width/n),this.canvas=new pp({width:n,height:o,dpr:r,nativeCanvas:i,canvasControled:t.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(t,e){this.canvas.resize(t,e)}setDpr(t){this.canvas.dpr=t}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(t,e,i){return this.canvas.nativeCanvas.addEventListener(t,e,i)}removeEventListener(t,e,i){return this.canvas.nativeCanvas.removeEventListener(t,e,i)}dispatchEvent(t){return this.canvas.nativeCanvas.dispatchEvent(t)}getStyle(){var t;return null!==(t=this.canvas.nativeCanvas.style)&&void 0!==t?t:{}}setStyle(t){this.canvas.nativeCanvas.style=t}getBoundingClientRect(){const t=this.canvas.nativeCanvas,e=this.getWH();return t.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:e.width,height:e.height,left:0,top:0,right:0,bottom:0}}clearViewBox(t){const e=this.viewBox,i=this.getContext(),n=this.getDpr();i.nativeContext.save(),i.nativeContext.setTransform(n,0,0,n,0,0),i.clearRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),t&&(i.fillStyle=t,i.fillRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1)),i.nativeContext.restore()}isVisible(t){return this._canvasIsIntersecting}onVisibleChange(t){this._onVisibleChangeCb=t}getTopLeft(t){return this.global.getElementTopLeft(this.canvas.nativeCanvas,t)}};kp.env="browser",kp.idprefix="visactor_window",kp.prefix_count=0,kp=Bp=Tp([w(),Rp("design:paramtypes",[])],kp);const Mp=new l((t=>{t(kp).toSelf(),t(_o).toDynamicValue((t=>t.container.get(kp))).whenTargetNamed(kp.env)}));var Lp=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Pp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ep=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))};class Hp{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(t){this.dom=t}}function Op(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=document.createElement("img");if($n.global.isImageAnonymous&&(i.crossOrigin="anonymous"),e){const e=new Blob([t],{type:"image/svg+xml"});t=window.URL.createObjectURL(e)}return i.src=t,i.complete?Promise.resolve(i):new Promise(((t,e)=>{i.onload=()=>{t(i)},i.onerror=()=>{e(new Error("加载失败"))}}))}let Ip=class extends tg{constructor(){super(),this.type="browser",this.supportEvent=!0;try{this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch(t){this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(t,e){var i,n;let o=0,r=0,s=0,a=0;if(t.changedTouches){const e=null!==(i=t.changedTouches[0])&&void 0!==i?i:{};o=e.clientX||0,r=e.clientY||0,s=o,a=r}else o=t.clientX||0,r=t.clientY||0,s=t.offsetX||0,a=t.offsetY||0;if(e){const t=o,i=r,s=e.getBoundingClientRect(),a=null===(n=e.getNativeHandler)||void 0===n?void 0:n.call(e).nativeCanvas;let l,h;return a&&(l=s.width/a.offsetWidth,h=s.height/a.offsetHeight),{x:(t-s.left)/(vt(l)?l:1),y:(i-s.top)/(vt(h)?h:1)}}return{x:s,y:a}}getNativeAABBBounds(t){let e=t;if("string"==typeof t&&(e=(new DOMParser).parseFromString(t,"text/html").firstChild,e.lastChild&&(e=e.lastChild.firstChild)),e.getBoundingClientRect){const t=e.getBoundingClientRect();return new Hp(t)}return new Fe}removeDom(t){return t.parentElement.removeChild(t),!0}updateDom(t,e){const{width:i,height:n,style:o}=e;return o&&(ct(o)?t.setAttribute("style",o):Object.keys(o).forEach((e=>{t.style[e]=o[e]}))),null!=i&&(t.style.width=`${i}px`),null!=n&&(t.style.height=`${n}px`),!0}createDom(t){const{tagName:e="div",parent:i}=t,n=document.createElement(e);if(this.updateDom(n,t),i){const t=ct(i)?this.getElementById(i):i;t&&t.appendChild&&t.appendChild(n)}return n}loadImage(t){return Op(t,!1).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadSvg(t){return Op(t,!0).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}createCanvas(t){var e,i;const n=document.createElement("canvas");t.id&&(n.id=null!==(e=t.id)&&void 0!==e?e:a.GenAutoIncrementId().toString());const o=null!==(i=t.dpr)&&void 0!==i?i:window.devicePixelRatio;return t.width&&t.height&&(n.style.width=`${t.width}px`,n.style.height=`${t.height}px`,n.width=t.width*o,n.height=t.height*o),n}createOffscreenCanvas(t){var e;const i=null!==(e=t.dpr)&&void 0!==e?e:window.devicePixelRatio;return new OffscreenCanvas(t.width*i,t.height*i)}releaseCanvas(t){let e;e="string"==typeof t?document.getElementById(t):t,e&&e.parentElement&&e.parentElement.removeChild(e)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(t,e,i){return document.addEventListener(t,e,i)}removeEventListener(t,e,i){return document.removeEventListener(t,e,i)}dispatchEvent(t){return document.dispatchEvent(t)}getElementById(t){return document.getElementById(t)}getRootElement(){return document.body}getDocument(){return document}release(){}getElementTop(t,e){let i=t.offsetTop,n=t.offsetParent;for(;null!==n;)i+=n.offsetTop,n=n.offsetParent;return i}getElementLeft(t,e){let i=t.offsetLeft,n=t.offsetParent;for(;null!==n;)i+=n.offsetLeft,n=n.offsetParent;return i}getElementTopLeft(t,e){let i=t.offsetTop,n=t.offsetLeft,o=t.offsetParent;for(;null!==o;)i+=o.offsetTop,n+=o.offsetLeft,o=o.offsetParent;return{top:i,left:n}}loadFont(t,e,i){return Ep(this,void 0,void 0,(function*(){return new FontFace(t,ct(e)?`url(${e})`:e,i).load().then((function(t){return document.fonts.add(t),{loadState:"success"}})).catch((function(t){return{loadState:"fail"}}))}))}isMacOS(){if(void 0===this._isMacOS)try{this._isMacOS=navigator.platform.toUpperCase().indexOf("MAC")>=0}catch(t){this._isMacOS=!1}return this._isMacOS}copyToClipBoard(t){return navigator.clipboard.writeText(t).then((()=>{})).catch((t=>{}))}};Ip=Lp([w(),Pp("design:paramtypes",[])],Ip);const Fp=new l((t=>{Fp.isBrowserBound||(Fp.isBrowserBound=!0,t(Ip).toSelf().inSingletonScope(),t(j).toService(Ip))}));function zp(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];zp.__loaded||(zp.__loaded=!0,t.load(Fp),t.load(vp),t.load(Mp),e&&function(t){t.load(Sp),t.load(Ap)}(t))}Fp.isBrowserBound=!1,zp.__loaded=!1;class Dp{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;if(!this.canvasRenderer)return!0;const{pickContext:n}=null!=i?i:{};if(!n)return!1;const o=t.getGraphicTheme();n.highPerformanceSave();let{x:r=o.x,y:s=o.y}=t.attribute;if(t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);r+=e.x,s+=e.y,n.setTransformForCurrent()}else r=0,s=0,n.transformFromMatrix(t.transMatrix,!0);let a=!1,l=!1;return this.canvasRenderer.drawShape(t,n,r,s,{},null,((t,i,n,o)=>!(!a&&!l)||(a=t.isPointInPath(e.x,e.y),l=o||l,a)),((t,i,o,r)=>{if(a||l)return!0;const s=i.lineWidth||o.lineWidth,h=i.pickStrokeBuffer||o.pickStrokeBuffer,d=i.keepStrokeScale||o.keepStrokeScale;return n.lineWidth=d?s+h:qn(n,s+h,n.dpr),a=t.isPointInStroke(e.x,e.y),l=r||l,a})),n.highPerformanceRestore(),a}}var Wp=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Np=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Gp=function(t,e){return function(i,n){e(i,n,t)}};let jp=class extends Dp{constructor(t){super(),this.canvasRenderer=t,this.type="arc",this.numberType=sa}};jp=Wp([w(),Gp(0,y(cc)),Np("design:paramtypes",[Object])],jp);let Vp=!1;const Up=new l(((t,e,i,n)=>{Vp||(Vp=!0,t(Fg).to(jp).inSingletonScope(),t(Ig).toService(Fg))}));var Xp=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},$p=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Yp=function(t,e){return function(i,n){e(i,n,t)}};let Kp=class extends Dp{constructor(t){super(),this.canvasRenderer=t,this.type="circle",this.numberType=ha}};Kp=Xp([w(),Yp(0,y(uc)),$p("design:paramtypes",[Object])],Kp);let qp=!1;const Zp=new l(((t,e,i,n)=>{qp||(qp=!0,t(zg).to(Kp).inSingletonScope(),t(Ig).toService(zg))}));var Jp=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let Qp=class{constructor(){this.type="image",this.numberType=ca}contains(t,e,i){const{pickContext:n}=null!=i?i:{};return!!n&&!!t.AABBBounds.containsPoint(e)}};Qp=Jp([w()],Qp);let tf=!1;const ef=new l(((t,e,i,n)=>{tf||(tf=!0,t(Dg).to(Qp).inSingletonScope(),t(Qp).toService(Dg))}));var nf=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},of=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},rf=function(t,e){return function(i,n){e(i,n,t)}};let sf=class extends Dp{constructor(t){super(),this.canvasRenderer=t,this.type="line",this.numberType=ua}};sf=nf([w(),rf(0,y(fc)),of("design:paramtypes",[Object])],sf);let af=!1;const lf=new l(((t,e,i,n)=>{af||(af=!0,t(Wg).to(sf).inSingletonScope(),t(Ig).toService(Wg))}));var hf=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},df=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},cf=function(t,e){return function(i,n){e(i,n,t)}};let uf=class extends Dp{constructor(t){super(),this.canvasRenderer=t,this.type="polygon",this.numberType=pa}};uf=hf([w(),cf(0,y(bc)),df("design:paramtypes",[Object])],uf);let gf=!1;const pf=new l(((t,e,i,n)=>{gf||(gf=!0,t(Ug).to(uf).inSingletonScope(),t(Ig).toService(Ug))}));var ff=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},vf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},bf=function(t,e){return function(i,n){e(i,n,t)}};let mf=class extends Dp{constructor(t){super(),this.canvasRenderer=t,this.type="path",this.numberType=ga}};mf=ff([w(),bf(0,y(vc)),vf("design:paramtypes",[Object])],mf);let yf=!1;const Cf=new l(((t,e,i,n)=>{yf||(yf=!0,t(Ng).to(mf).inSingletonScope(),t(Ig).toService(Ng))})),wf=new Fe;class xf{constructor(){this.type="rect",this.numberType=fa}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:n}=null!=i?i:{};if(!n)return!1;const o=t.getGraphicTheme(),{cornerRadius:r=o.cornerRadius}=t.attribute;let{x:s=o.x,y:a=o.y}=t.attribute;n.highPerformanceSave();let l=!0;if(t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);s+=e.x,a+=e.y,n.setTransformForCurrent()}else s=0,a=0,l=!1,n.transformFromMatrix(t.transMatrix,!0);let h=!0;if(!l||t.shadowRoot||ft(r,!0)&&0!==r||ut(r)&&r.some((t=>0!==t)))h=!1,this.canvasRenderer.drawShape(t,n,s,a,{},null,((t,i,n)=>!!h||(h=t.isPointInPath(e.x,e.y),h)),((t,i,o)=>{if(h)return!0;const r=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer,a=i.keepStrokeScale||o.keepStrokeScale;return n.lineWidth=a?r+s:qn(n,r+s,n.dpr),h=t.isPointInStroke(e.x,e.y),h}));else{const{fill:i=o.fill,stroke:n=o.stroke,lineWidth:r=o.lineWidth}=t.attribute;if(i)h=!0;else if(n){const i=t.AABBBounds;wf.setValue(i.x1,i.y1,i.x2,i.y2),wf.expand(-r/2),h=!wf.containsPoint(e)}}return n.highPerformanceRestore(),h}}var _f=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Sf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Af=function(t,e){return function(i,n){e(i,n,t)}};let Bf=class extends xf{constructor(t){super(),this.canvasRenderer=t}};Bf=_f([w(),Af(0,y(mc)),Sf("design:paramtypes",[Object])],Bf);let Tf=!1;const Rf=new l(((t,e,i,n)=>{Tf||(Tf=!0,t(Gg).to(Bf).inSingletonScope(),t(Ig).toService(Gg))}));let kf=!1;const Mf=new l(((t,e,i,n)=>{kf||(kf=!0,t(Dg).to(Qp).inSingletonScope(),t(Qp).toService(Dg))}));var Lf=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Pf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ef=function(t,e){return function(i,n){e(i,n,t)}};let Hf=class extends Dp{constructor(t){super(),this.canvasRenderer=t,this.type="symbol",this.numberType=ba}};Hf=Lf([w(),Ef(0,y(yc)),Pf("design:paramtypes",[Object])],Hf);let Of=!1;const If=new l(((t,e,i,n)=>{Of||(Of=!0,t(jg).to(Hf).inSingletonScope(),t(Ig).toService(jg))}));var Ff=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let zf=class{constructor(){this.type="text",this.numberType=ma}contains(t,e,i){return!!t.AABBBounds.containsPoint(e)}};zf=Ff([w()],zf);let Df=!1;const Wf=new l(((t,e,i,n)=>{Df||(Df=!0,t(Vg).to(zf).inSingletonScope(),t(Ig).toService(Vg))}));var Nf=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Gf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let jf=class extends cp{constructor(t,e){super(t,e);const i=t.nativeCanvas.getContext("2d");if(!i)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=i,this.canvas=t,this.matrix=new De(1,0,0,1,0,0),this.stack=[],this.dpr=null!=e?e:1}release(){}};jf.env="node",jf=Nf([w(),Gf("design:paramtypes",[Object,Number])],jf);var Vf=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Uf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Xf=class extends Zu{constructor(t){super(t)}init(){this._context=new jf(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(){this._nativeCanvas.release&&ot(this._nativeCanvas.release)&&this._nativeCanvas.release()}};Xf.env="node",Xf=Vf([w(),Uf("design:paramtypes",[Object])],Xf);const $f=fp(Xf,jf);var Yf=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Kf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},qf=function(t,e){return function(i,n){e(i,n,t)}};let Zf=class extends ng{get container(){return null}constructor(t){super(),this.global=t,this.type="node"}getTitle(){return""}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(t){t.canvas?this.createWindowByCanvas(t):this.createWindowByConfig(t)}createWindowByConfig(t){const e=this.global.createCanvas({width:t.width,height:t.height}),i={width:t.width,height:t.height,dpr:t.dpr,nativeCanvas:e,id:a.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new Xf(i)}createWindowByCanvas(t){var e;const i=t.canvas,n=null!==(e=t.dpr)&&void 0!==e?e:1;let o=t.width,r=t.height;null!=o&&null!=r&&t.canvasControled||(o=i.width/n,r=i.height/n),this.canvas=new Xf({width:o,height:r,dpr:n,nativeCanvas:i,canvasControled:t.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(t,e){this.canvas.resize(t,e)}setDpr(t){this.canvas.dpr=t}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png";return this.canvas.nativeCanvas.toBuffer(t)}addEventListener(t,e,i){}dispatchEvent(t){return!0}removeEventListener(t,e,i){}getStyle(){}setStyle(t){}getBoundingClientRect(){return null}clearViewBox(t){}};Zf.env="node",Zf=Yf([w(),qf(0,y(V)),Kf("design:paramtypes",[Object])],Zf);const Jf=new l((t=>{t(Zf).toSelf(),t(_o).toDynamicValue((t=>t.container.get(Zf))).whenTargetNamed(Zf.env)}));var Qf=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let tv=class extends tg{constructor(){super(...arguments),this.type="node",this._lastTime=0,this.supportEvent=!1}configure(t,e){t.env===this.type&&(t.setActiveEnvContribution(this),this.pkg=e)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(t){const e=fetch(t).then((t=>t.json()));return e.then((t=>({data:t,state:"success"}))).catch((()=>({data:null,state:"fail"}))),e}loadArrayBuffer(t){return fetch(t).then((t=>t.arrayBuffer())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadImage(t){const{loadImage:e}=this.pkg;return e?e(t).then((t=>({loadState:t?"success":"fail",data:t}))).catch((()=>({loadState:"fail",data:null}))):Promise.reject(new Error("node-canvas loadImage could not be found!"))}loadSvg(t){const e=this.pkg.Resvg;if(!e)return Promise.reject(new Error("@resvg/resvg-js svgParser could not be found!"));const i=new e(t).render().asPng();return this.loadImage(i)}createCanvas(t){return this.pkg.createCanvas(t.width,t.height)}releaseCanvas(t){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(t){return _r.call(t)}}getCancelAnimationFrame(){return t=>{_r.clear(t)}}addEventListener(t,e,i){}removeEventListener(t,e,i){}getElementById(t){return null}getRootElement(){return null}dispatchEvent(t){}release(){}createOffscreenCanvas(t){}};tv=Qf([w()],tv);const ev=new l((t=>{ev.isNodeBound||(ev.isNodeBound=!0,t(tv).toSelf().inSingletonScope(),t(j).toService(tv))}));function iv(t){iv.__loaded||(iv.__loaded=!0,t.load(ev),t.load($f),t.load(Jf))}ev.isNodeBound=!1,iv.__loaded=!1;var nv=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ov=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},rv=function(t,e){return function(i,n){e(i,n,t)}};let sv=class extends Dp{constructor(t){super(),this.canvasRenderer=t,this.type="arc",this.numberType=sa}};sv=nv([w(),rv(0,y(cc)),ov("design:paramtypes",[Object])],sv);let av=!1;const lv=new l(((t,e,i,n)=>{av||(av=!0,t(Xg).to(sv).inSingletonScope(),t(np).toService(Xg))}));var hv=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},dv=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},cv=function(t,e){return function(i,n){e(i,n,t)}};let uv=class extends xf{constructor(t){super(),this.canvasRenderer=t}};uv=hv([w(),cv(0,y(mc)),dv("design:paramtypes",[Object])],uv);let gv=!1;const pv=new l(((t,e,i,n)=>{gv||(gv=!0,t(Zg).to(uv).inSingletonScope(),t(np).toService(Zg))}));class fv extends rd{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:n}=null!=i?i:{};if(!n)return!1;n.highPerformanceSave();const o=t.getGraphicTheme(),r=this.transform(t,o,n),{x:s,y:a,z:l,lastModelMatrix:h}=r;let d=e;if(n.camera){d=e.clone();const i=t.parent.globalTransMatrix;d.x=i.a*e.x+i.c*e.y+i.e,d.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=l;let c=!1;return this.canvasRenderer.drawShape(t,n,s,a,{},null,(t=>!!c||(c=t.isPointInPath(d.x,d.y),c)),((t,e,i)=>{if(c)return!0;const o=e.lineWidth||i.lineWidth,r=e.pickStrokeBuffer||i.pickStrokeBuffer,s=e.keepStrokeScale||i.keepStrokeScale;return n.lineWidth=s?o+r:qn(n,o+r,n.dpr),c=t.isPointInStroke(d.x,d.y),c})),this.canvasRenderer.z=0,n.modelMatrix!==h&&Al.free(n.modelMatrix),n.modelMatrix=h,n.highPerformanceRestore(),c}}var vv=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},bv=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},mv=function(t,e){return function(i,n){e(i,n,t)}};let yv=class extends fv{constructor(t){super(),this.canvasRenderer=t,this.type="line",this.numberType=ua}};yv=vv([w(),mv(0,y(fc)),bv("design:paramtypes",[Object])],yv);let Cv=!1;const wv=new l(((t,e,i,n)=>{Cv||(Cv=!0,t(Kg).to(yv).inSingletonScope(),t(np).toService(Kg))}));class xv extends rd{contains(t,e,i){const{pickContext:n}=null!=i?i:{};if(!n)return!1;const o=t.getGraphicTheme();n.highPerformanceSave();const r=this.transform(t,o,n),{x:s,y:a,z:l,lastModelMatrix:h}=r;let d=e;if(n.camera){d=e.clone();const i=t.parent.globalTransMatrix;d.x=i.a*e.x+i.c*e.y+i.e,d.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=l;let c=!1;return this.canvasRenderer.drawShape(t,n,s,a,i,null,((t,e,i)=>!!c||(c=t.isPointInPath(d.x,d.y),c))),this.canvasRenderer.z=0,n.modelMatrix!==h&&Al.free(n.modelMatrix),n.modelMatrix=h,n.highPerformanceRestore(),c}}var _v=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Sv=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Av=function(t,e){return function(i,n){e(i,n,t)}};let Bv=class extends xv{constructor(t){super(),this.canvasRenderer=t,this.type="symbol",this.numberType=ba}contains(t,e,i){const{pickContext:n}=null!=i?i:{};if(!n)return!1;const o=t.getParsedPath();if(!n.camera){if(!t.AABBBounds.containsPoint(e))return!1;if(o.isSvg||"imprecise"===t.attribute.pickMode)return!0}n.highPerformanceSave();const r=t.getGraphicTheme(),s=this.transform(t,r,n),{x:a,y:l,z:h,lastModelMatrix:d}=s;let c=e;if(n.camera){c=e.clone();const i=t.parent.globalTransMatrix;c.x=i.a*e.x+i.c*e.y+i.e,c.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=h;let u=!1;return this.canvasRenderer.drawShape(t,n,a,l,{},null,((t,e,i)=>!!u||(u=t.isPointInPath(c.x,c.y),u)),((t,e,i)=>{if(u)return!0;const o=e.lineWidth||i.lineWidth,r=e.pickStrokeBuffer||i.pickStrokeBuffer,s=e.keepStrokeScale||i.keepStrokeScale;return n.lineWidth=s?o+r:qn(n,o+r,n.dpr),u=t.isPointInStroke(c.x,c.y),u})),this.canvasRenderer.z=0,n.modelMatrix!==d&&Al.free(n.modelMatrix),n.modelMatrix=d,n.highPerformanceRestore(),u}};Bv=_v([w(),Av(0,y(yc)),Sv("design:paramtypes",[Object])],Bv);let Tv=!1;const Rv=new l(((t,e,i,n)=>{Tv||(Tv=!0,t(Jg).to(Bv).inSingletonScope(),t(np).toService(Jg))}));var kv=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Mv=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Lv=function(t,e){return function(i,n){e(i,n,t)}};let Pv=class extends Dp{constructor(t){super(),this.canvasRenderer=t,this.type="circle",this.numberType=ha}};Pv=kv([w(),Lv(0,y(uc)),Mv("design:paramtypes",[Object])],Pv);let Ev=!1;const Hv=new l(((t,e,i,n)=>{Ev||(Ev=!0,t($g).to(Pv).inSingletonScope(),t(np).toService($g))}));var Ov=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Iv=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Fv=function(t,e){return function(i,n){e(i,n,t)}};let zv=class extends xv{constructor(t){super(),this.canvasRenderer=t,this.type="text",this.numberType=ma}contains(t,e,i){const{pickContext:n}=null!=i?i:{};if(!n)return!1;const o=t.AABBBounds;if(!n.camera)return!!o.containsPoint(e);n.highPerformanceSave();const r=t.getGraphicTheme(),{keepDirIn3d:s=r.keepDirIn3d}=t.attribute,a=!s,l=this.transform(t,r,n,a),{x:h,y:d,z:c,lastModelMatrix:u}=l;this.canvasRenderer.z=c;let g=e;if(n.camera){g=e.clone();const i=t.parent.globalTransMatrix;g.x=i.a*e.x+i.c*e.y+i.e,g.y=i.b*e.x+i.d*e.y+i.f}let p=!1;return this.canvasRenderer.drawShape(t,n,h,d,{},null,((e,i,n)=>{if(p)return!0;const{fontSize:o=r.fontSize,textBaseline:s=r.textBaseline,textAlign:a=r.textAlign}=t.attribute,l=t.AABBBounds,u=l.height(),f=l.width(),v=bl(s,u,o),b=vl(a,f);return e.rect(b+h,v+d,f,u,c),p=e.isPointInPath(g.x,g.y),p}),((t,e,i)=>p)),this.canvasRenderer.z=0,n.modelMatrix!==u&&Al.free(n.modelMatrix),n.modelMatrix=u,n.highPerformanceRestore(),p}};zv=Ov([w(),Fv(0,y(Cc)),Iv("design:paramtypes",[Object])],zv);let Dv=!1;const Wv=new l(((t,e,i,n)=>{Dv||(Dv=!0,t(Qg).to(zv).inSingletonScope(),t(np).toService(Qg))}));var Nv=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Gv=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},jv=function(t,e){return function(i,n){e(i,n,t)}};let Vv=class extends fv{constructor(t){super(),this.canvasRenderer=t,this.type="path",this.numberType=ga}};Vv=Nv([w(),jv(0,y(vc)),Gv("design:paramtypes",[Object])],Vv);let Uv=!1;const Xv=new l(((t,e,i,n)=>{Uv||(Uv=!0,t(qg).to(Vv).inSingletonScope(),t(np).toService(qg))}));var $v=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Yv=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Kv=function(t,e){return function(i,n){e(i,n,t)}};let qv=class extends Dp{constructor(t){super(),this.canvasRenderer=t,this.type="polygon",this.numberType=pa}};qv=$v([w(),Kv(0,y(bc)),Yv("design:paramtypes",[Object])],qv);let Zv=!1;const Jv=new l(((t,e,i,n)=>{Zv||(Zv=!0,t(tp).to(qv).inSingletonScope(),t(np).toService(tp))}));var Qv=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},tb=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},eb=function(t,e){return function(i,n){e(i,n,t)}};let ib=class{constructor(t){this.canvasRenderer=t,this.type="richtext",this.numberType=va}contains(t,e,i){return!!t.AABBBounds.containsPoint(e)}};ib=Qv([w(),eb(0,y(wc)),tb("design:paramtypes",[Object])],ib);let nb=!1;const ob=new l(((t,e,i,n)=>{nb||(nb=!0,t(ep).to(ib).inSingletonScope(),t(np).toService(ep))}));var rb=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},sb=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ab=function(t,e){return function(i,n){e(i,n,t)}};let lb=class extends Dp{constructor(t){super(),this.canvasRenderer=t,this.type="image",this.numberType=ca}};lb=rb([w(),ab(0,y(xc)),sb("design:paramtypes",[Object])],lb);let hb=!1;const db=new l(((t,e,i,n)=>{hb||(hb=!0,t(Yg).to(lb).inSingletonScope(),t(np).toService(Yg))}));var cb={},ub={},gb={};Object.defineProperty(gb,"__esModule",{value:!0}),gb.loop=gb.conditional=gb.parse=void 0;gb.parse=function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if(Array.isArray(i))i.forEach((function(i){return t(e,i,n,o)}));else if("function"==typeof i)i(e,n,o,t);else{var r=Object.keys(i)[0];Array.isArray(i[r])?(o[r]={},t(e,i[r],n,o[r])):o[r]=i[r](e,n,o,t)}return n};gb.conditional=function(t,e){return function(i,n,o,r){e(i,n,o)&&r(i,t,n,o)}};gb.loop=function(t,e){return function(i,n,o,r){for(var s=[],a=i.pos;e(i,n,o);){var l={};if(r(i,t,n,l),i.pos===a)break;a=i.pos,s.push(l)}return s}};var pb={};Object.defineProperty(pb,"__esModule",{value:!0}),pb.readBits=pb.readArray=pb.readUnsigned=pb.readString=pb.peekBytes=pb.readBytes=pb.peekByte=pb.readByte=pb.buildStream=void 0;pb.buildStream=function(t){return{data:t,pos:0}};var fb=function(){return function(t){return t.data[t.pos++]}};pb.readByte=fb;pb.peekByte=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(e){return e.data[e.pos+t]}};var vb=function(t){return function(e){return e.data.subarray(e.pos,e.pos+=t)}};pb.readBytes=vb;pb.peekBytes=function(t){return function(e){return e.data.subarray(e.pos,e.pos+t)}};pb.readString=function(t){return function(e){return Array.from(vb(t)(e)).map((function(t){return String.fromCharCode(t)})).join("")}};pb.readUnsigned=function(t){return function(e){var i=vb(2)(e);return t?(i[1]<<8)+i[0]:(i[0]<<8)+i[1]}};pb.readArray=function(t,e){return function(i,n,o){for(var r="function"==typeof e?e(i,n,o):e,s=vb(t),a=new Array(r),l=0;l<r;l++)a[l]=s(i);return a}};pb.readBits=function(t){return function(e){for(var i=function(t){return t.data[t.pos++]}(e),n=new Array(8),o=0;o<8;o++)n[7-o]=!!(i&1<<o);return Object.keys(t).reduce((function(e,i){var o=t[i];return o.length?e[i]=function(t,e,i){for(var n=0,o=0;o<i;o++)n+=t[e+o]&&Math.pow(2,i-o-1);return n}(n,o.index,o.length):e[i]=n[o.index],e}),{})}},function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=gb,i=pb,n={blocks:function(t){for(var e=[],n=t.data.length,o=0,r=(0,i.readByte)()(t);0!==r&&r;r=(0,i.readByte)()(t)){if(t.pos+r>=n){var s=n-t.pos;e.push((0,i.readBytes)(s)(t)),o+=s;break}e.push((0,i.readBytes)(r)(t)),o+=r}for(var a=new Uint8Array(o),l=0,h=0;h<e.length;h++)a.set(e[h],l),l+=e[h].length;return a}},o=(0,e.conditional)({gce:[{codes:(0,i.readBytes)(2)},{byteSize:(0,i.readByte)()},{extras:(0,i.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,i.readUnsigned)(!0)},{transparentColorIndex:(0,i.readByte)()},{terminator:(0,i.readByte)()}]},(function(t){var e=(0,i.peekBytes)(2)(t);return 33===e[0]&&249===e[1]})),r=(0,e.conditional)({image:[{code:(0,i.readByte)()},{descriptor:[{left:(0,i.readUnsigned)(!0)},{top:(0,i.readUnsigned)(!0)},{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{lct:(0,i.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,e.conditional)({lct:(0,i.readArray)(3,(function(t,e,i){return Math.pow(2,i.descriptor.lct.size+1)}))},(function(t,e,i){return i.descriptor.lct.exists})),{data:[{minCodeSize:(0,i.readByte)()},n]}]},(function(t){return 44===(0,i.peekByte)()(t)})),s=(0,e.conditional)({text:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{preData:function(t,e,n){return(0,i.readBytes)(n.text.blockSize)(t)}},n]},(function(t){var e=(0,i.peekBytes)(2)(t);return 33===e[0]&&1===e[1]})),a=(0,e.conditional)({application:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{id:function(t,e,n){return(0,i.readString)(n.blockSize)(t)}},n]},(function(t){var e=(0,i.peekBytes)(2)(t);return 33===e[0]&&255===e[1]})),l=(0,e.conditional)({comment:[{codes:(0,i.readBytes)(2)},n]},(function(t){var e=(0,i.peekBytes)(2)(t);return 33===e[0]&&254===e[1]})),h=[{header:[{signature:(0,i.readString)(3)},{version:(0,i.readString)(3)}]},{lsd:[{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{gct:(0,i.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,i.readByte)()},{pixelAspectRatio:(0,i.readByte)()}]},(0,e.conditional)({gct:(0,i.readArray)(3,(function(t,e){return Math.pow(2,e.lsd.gct.size+1)}))},(function(t,e){return e.lsd.gct.exists})),{frames:(0,e.loop)([o,a,l,r,s],(function(t){var e=(0,i.peekByte)()(t);return 33===e||44===e}))}],d=h;t.default=d}(ub);var bb={};Object.defineProperty(bb,"__esModule",{value:!0}),bb.deinterlace=void 0;bb.deinterlace=function(t,e){for(var i=new Array(t.length),n=t.length/e,o=function(n,o){var r=t.slice(o*e,(o+1)*e);i.splice.apply(i,[n*e,e].concat(r))},r=[0,4,2,1],s=[8,8,4,2],a=0,l=0;l<4;l++)for(var h=r[l];h<n;h+=s[l])o(h,a),a++;return i};var mb={};Object.defineProperty(mb,"__esModule",{value:!0}),mb.lzw=void 0;mb.lzw=function(t,e,i){var n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y=4096,C=i,w=new Array(i),x=new Array(y),_=new Array(y),S=new Array(4097);for(a=(o=1<<(u=t))+1,n=o+2,h=-1,r=(1<<(s=u+1))-1,d=0;d<o;d++)x[d]=0,_[d]=d;for(g=p=f=v=b=m=0,c=0;c<C;){if(0===v){if(p<s){g+=e[m]<<p,p+=8,m++;continue}if(d=g&r,g>>=s,p-=s,d>n||d==a)break;if(d==o){r=(1<<(s=u+1))-1,n=o+2,h=-1;continue}if(-1==h){S[v++]=_[d],h=d,f=d;continue}for(l=d,d==n&&(S[v++]=f,d=h);d>o;)S[v++]=_[d],d=x[d];f=255&_[d],S[v++]=f,n<y&&(x[n]=h,_[n]=f,0==(++n&r)&&n<y&&(s++,r+=n)),h=l}v--,w[b++]=S[v],c++}for(c=b;c<C;c++)w[c]=0;return w},Object.defineProperty(cb,"__esModule",{value:!0});var yb=cb.decompressFrames=cb.decompressFrame=Ab=cb.parseGIF=void 0,Cb=function(t){return t&&t.__esModule?t:{default:t}}(ub),wb=gb,xb=pb,_b=bb,Sb=mb;var Ab=cb.parseGIF=function(t){var e=new Uint8Array(t);return(0,wb.parse)((0,xb.buildStream)(e),Cb.default)},Bb=function(t,e,i){if(t.image){var n=t.image,o=n.descriptor.width*n.descriptor.height,r=(0,Sb.lzw)(n.data.minCodeSize,n.data.blocks,o);n.descriptor.lct.interlaced&&(r=(0,_b.deinterlace)(r,n.descriptor.width));var s={pixels:r,dims:{top:t.image.descriptor.top,left:t.image.descriptor.left,width:t.image.descriptor.width,height:t.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?s.colorTable=n.lct:s.colorTable=e,t.gce&&(s.delay=10*(t.gce.delay||10),s.disposalType=t.gce.extras.disposal,t.gce.extras.transparentColorGiven&&(s.transparentIndex=t.gce.transparentColorIndex)),i&&(s.patch=function(t){for(var e=t.pixels.length,i=new Uint8ClampedArray(4*e),n=0;n<e;n++){var o=4*n,r=t.pixels[n],s=t.colorTable[r]||[0,0,0];i[o]=s[0],i[o+1]=s[1],i[o+2]=s[2],i[o+3]=r!==t.transparentIndex?255:0}return i}(s)),s}};cb.decompressFrame=Bb;yb=cb.decompressFrames=function(t,e){return t.frames.filter((function(t){return t.image})).map((function(i){return Bb(i,t.gct,e)}))};const Tb=Uu();function Rb(){Rb.__loaded||(Rb.__loaded=!0,_h.RegisterGraphicCreator("arc",bh),fo.load(hg),fo.load(Tb?lv:Up))}Rb.__loaded=!1;const kb=Rb;function Mb(){Mb.__loaded||(Mb.__loaded=!0,_h.RegisterGraphicCreator("circle",Hl),fo.load(bg),fo.load(Tb?Hv:Zp))}Mb.__loaded=!1;const Lb=Mb;function Pb(){Pb.__loaded||(Pb.__loaded=!0,_h.RegisterGraphicCreator("group",Ha))}Pb.__loaded=!1;const Eb=Pb;function Hb(){Hb.__loaded||(Hb.__loaded=!0,_h.RegisterGraphicCreator("image",ih),fo.load(Mg),fo.load(Tb?db:ef))}Hb.__loaded=!1;const Ob=Hb;function Ib(){Ib.__loaded||(Ib.__loaded=!0,_h.RegisterGraphicCreator("line",$l),fo.load(gg),fo.load(Tb?wv:lf))}Ib.__loaded=!1;const Fb=Ib;function zb(){zb.__loaded||(zb.__loaded=!0,_h.RegisterGraphicCreator("path",uh),fo.load(wg),fo.load(Tb?Xv:Cf))}zb.__loaded=!1;const Db=zb;function Wb(){Wb.__loaded||(Wb.__loaded=!0,_h.RegisterGraphicCreator("polygon",Ch),fo.load(_g),fo.load(Tb?Jv:pf))}Wb.__loaded=!1;const Nb=Wb;function Gb(){Gb.__loaded||(Gb.__loaded=!0,_h.RegisterGraphicCreator("rect",ql),fo.load(cg),fo.load(Tb?pv:Rf))}Gb.__loaded=!1;const jb=Gb;function Vb(){Vb.__loaded||(Vb.__loaded=!0,_h.RegisterGraphicCreator("richtext",hh),fo.load(Rg),fo.load(Tb?ob:Mf))}Vb.__loaded=!1;const Ub=Vb;function Xb(){Xb.__loaded||(Xb.__loaded=!0,_h.RegisterGraphicCreator("shadowRoot",xh))}Xb.__loaded=!1;const $b=Xb;function Yb(){Yb.__loaded||(Yb.__loaded=!0,_h.RegisterGraphicCreator("symbol",Vl),fo.load(fg),fo.load(Tb?Rv:If))}Yb.__loaded=!1;const Kb=Yb;function qb(){qb.__loaded||(qb.__loaded=!0,_h.RegisterGraphicCreator("text",zl),fo.load(yg),fo.load(Tb?Wv:Wf))}qb.__loaded=!1;const Zb=qb;function Jb(){Jb.__loaded||(Jb.__loaded=!0,_h.RegisterGraphicCreator("wrapText",Nl))}Jb.__loaded=!1;const Qb=Jb;function tm(){Eb(),jb()}const em="PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol";var im;!function(t){t.selected="selected",t.selectedReverse="selected_reverse",t.hover="hover",t.hoverReverse="hover_reverse"}(im||(im={}));const nm={[im.selectedReverse]:{},[im.selected]:{},[im.hover]:{},[im.hoverReverse]:{}},om={container:"",width:30,height:30,style:{}};function rm(){return"browser"===Pu.env?["pointerup","pointerleave","pointercancel"]:["pointerup","pointerleave","pointerupoutside"]}const sm={debounce:qt,throttle:Zt};tm();class am extends Og{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Lt({},am.defaultAttributes,t)),this.name="scrollbar",this._handleTouchMove=t=>{st(this._prePos)&&t.preventDefault()},this._onRailPointerDown=t=>{const{viewX:e,viewY:i}=t,{direction:n,width:o,height:r,range:s}=this.attribute,a=this._sliderSize,[l,h]=this._getScrollRange();let d;if("vertical"===n){const t=i-this._viewPosition.y,e=$t(t-a/2,l,h);d=t/r,this._slider.setAttribute("y",e,!0)}else{const t=e-this._viewPosition.x,i=$t(t-a/2,l,h);d=t/o,this._slider.setAttribute("x",i,!0)}this.setScrollRange([d-(s[1]-s[0])/2,d+(s[1]-s[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=t=>{this._clearDragEvents();const{stopSliderDownPropagation:e=!0}=this.attribute;e&&t.stopPropagation();const{direction:i}=this.attribute,{x:n,y:o}=this.stage.eventPointTransform(t);this._prePos="horizontal"===i?n:o,this._dispatchEvent("scrollDown",{pos:this._prePos,event:t});const r=rm(),s="browser"===Pu.env?Pu:this.stage;s.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),r.forEach((t=>{s.addEventListener(t,this._onSliderPointerUp)}))},this._computeScrollValue=t=>{const{direction:e}=this.attribute,{x:i,y:n}=this.stage.eventPointTransform(t);let o,r,s=0;const{width:a,height:l}=this.getSliderRenderBounds();return"vertical"===e?(r=n,s=r-this._prePos,o=s/l):(r=i,s=r-this._prePos,o=s/a),[r,o]},this._onSliderPointerMove=t=>{const{stopSliderMovePropagation:e=!0}=this.attribute;e&&t.stopPropagation();const i=this.getScrollRange(),[n,o]=this._computeScrollValue(t);this.setScrollRange([i[0]+o,i[1]+o],!0),this._prePos=n},this._onSliderPointerMoveWithDelay=0===this.attribute.delayTime?this._onSliderPointerMove:sm[this.attribute.delayType](this._onSliderPointerMove,this.attribute.delayTime),this._onSliderPointerUp=t=>{const{range:e,limitRange:i=[0,1]}=this.attribute,n=this.getScrollRange(),[o,r]=this._computeScrollValue(t),s=[n[0]+r,n[1]+r];this._prePos=null,this._dispatchEvent("scrollUp",{pre:e,value:Yt(s,i[0],i[1])}),this._clearDragEvents()}}setScrollRange(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{direction:i="horizontal",limitRange:n=[0,1],range:o,realTime:r=!0}=this.attribute,s=Yt(t,n[0],n[1]);if(e){const t=this._getSliderPos(s);if(this._slider){const e=t[1]-t[0];this._sliderSize=e,"horizontal"===i?this._slider.setAttributes({x:t[0],width:e},!0):this._slider.setAttributes({y:t[0],height:e},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=s,r&&this._dispatchEvent("scrollDrag",{pre:o,value:s})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;const{delayType:t="throttle",delayTime:e=0}=this.attribute;this._rail&&this._rail.addEventListener("pointerdown",sm[t](this._onRailPointerDown,e)),this._slider&&this._slider.addEventListener("pointerdown",this._onSliderPointerDown),("browser"===Pu.env?Pu:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1})}render(){this._reset();const{direction:t="horizontal",width:e,height:i,range:n,limitRange:o=[0,1],railStyle:r,sliderStyle:s,padding:a=2}=this.attribute,l=this.createOrUpdateChild("scrollbar-container",{},"group"),h=l.createOrUpdateChild("scrollbar-rail",Object.assign({x:0,y:0,width:e,height:i},r),"rect");this._rail=h;const d=this.getSliderRenderBounds(),c=this._getSliderPos(Yt(n,o[0],o[1])),u=c[1]-c[0];let g;this._sliderSize=u,g="horizontal"===t?{x:c[0],y:d.y1,width:u,height:d.height}:{x:d.x1,y:c[0],width:d.width,height:u};const p=l.createOrUpdateChild("slider",Object.assign(Object.assign(Object.assign(Object.assign({},g),{cornerRadius:this._getDefaultSliderCornerRadius()}),s),{boundsPadding:ti(a),pickMode:"imprecise"}),"rect");this._slider=p,this._container=l;const f=this._container.AABBBounds;this._viewPosition={x:f.x1,y:f.y1}}getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;const{width:t,height:e,padding:i=2}=this.attribute,[n,o,r,s]=ti(i),a={x1:s,y1:n,x2:t-o,y2:e-r,width:Math.max(0,t-(s+o)),height:Math.max(0,e-(n+r))};return this._sliderRenderBounds=a,a}_getDefaultSliderCornerRadius(){const{direction:t,round:e}=this.attribute;if(e){const{width:e,height:i}=this.getSliderRenderBounds();return"horizontal"===t?i:e}return 0}_getSliderPos(t){const{direction:e}=this.attribute,{width:i,height:n,x1:o,y1:r}=this.getSliderRenderBounds();return"horizontal"===e?[i*t[0]+o,i*t[1]+o]:[n*t[0]+r,n*t[1]+r]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;const{limitRange:t=[0,1],direction:e}=this.attribute,[i,n]=Yt(t,0,1),{width:o,height:r,x1:s,y1:a}=this.getSliderRenderBounds(),l=this._sliderSize;return"horizontal"===e?Yt([s+i*o,s+n*o],s,o-l):Yt([a+i*r,a+n*r],a,r-l)}_clearDragEvents(){const t=rm(),e="browser"===Pu.env?Pu:this.stage;e.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),t.forEach((t=>{e.removeEventListener(t,this._onSliderPointerUp)}))}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}release(t){super.release(t),("browser"===Pu.env?Pu:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._clearDragEvents()}}function lm(t,e){t.forEachChildren((t=>{const i=e(t);t.isContainer&&!i&&lm(t,e)}))}function hm(t,e){return[t[0]*e,t[1]*e]}function dm(t){const[e,i]=t;return Math.sqrt(e*e+i*i)}function cm(t,e,i){const n=function(t,e){const[i,n]=t,[o,r]=e,s=Math.sqrt((i*i+n*n)*(o*o+r*r)),a=s&&(i*o+n*r)/s;return Math.acos(Math.min(Math.max(a,-1),1))}(t,e),o=(s=e,(r=t)[0]*s[1]-r[1]*s[0]>=0);var r,s;return i?o?2*Math.PI-n:n:o?n:2*Math.PI-n}am.defaultAttributes={direction:"horizontal",round:!0,sliderSize:20,sliderStyle:{fill:"rgba(0, 0, 0, .5)"},railStyle:{fill:"rgba(0, 0, 0, .0)"},padding:2,scrollRange:[0,1],delayType:"throttle",delayTime:0,realTime:!0};const um=(t,e,i,n)=>new Pe(Object.assign({defaultFontParams:Object.assign({fontFamily:em,fontSize:14},n),getTextBounds:i?void 0:Ah,specialCharSet:"-/: .,@%'\"~"+Pe.ALPHABET_CHAR_SET+Pe.ALPHABET_CHAR_SET.toUpperCase()},null!=e?e:{}),t);function gm(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)return{width:0,height:0};const n=Ah({text:t,fontFamily:e.fontFamily||i.fontFamily||em,fontSize:e.fontSize||i.fontSize||12,fontWeight:e.fontWeight||i.fontWeight,textAlign:e.textAlign||"center",textBaseline:e.textBaseline,ellipsis:!!e.ellipsis,maxLineWidth:e.maxLineWidth||1/0,lineHeight:e.fontSize||i.fontSize||12});return{width:n.width(),height:n.height()}}function pm(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"type";var i,n;return at(t.text)&&"type"in t.text?null!==(i=t.text.type)&&void 0!==i?i:"text":e in t&&null!==(n=t[e])&&void 0!==n?n:"text"}function fm(t){var e,i;return st(t.maxLineWidth)&&(t.maxWidth=t.maxLineWidth,delete t.maxLineWidth),t.width=null!==(e=t.width)&&void 0!==e?e:0,t.height=null!==(i=t.height)&&void 0!==i?i:0,t.textConfig=t.text.text||t.text,t}function vm(t){const e=pm(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"type");return"rich"===e?_h.richtext(fm(t)):("html"===e?t=function(t){const{text:e,_originText:i}=t,{text:n}=e;return t.html=n,t.text=i,t.renderable=!1,t}(t):"react"===e&&(t=function(t){const{text:e,_originText:i}=t,{text:n}=e;return t.react=n,t.text=i,t.renderable=!1,t}(t)),_h.text(t))}function bm(){Eb(),jb(),Kb(),Ub(),Zb()}var mm=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i};bm();let ym=class t extends Og{getBgRect(){return this._bgRect}getTextShape(){return this._textShape}constructor(e,i){super((null==i?void 0:i.skipDefault)?e:Lt({},t.defaultAttributes,e)),this.name="tag",this._tagStates=[],this._rectStates=[],this._symbolStates=[],this._textStates=[]}render(){var t,e,i;this.cacheStates();const{text:n="",textStyle:o={},shape:r={},panel:s={},space:a=4,minWidth:l,maxWidth:h,padding:d=4,visible:c,state:u,type:g,textAlwaysCenter:p,containerTextAlign:f}=this.attribute,v=ti(d),b=this.createOrUpdateChild("tag-content",{x:0,y:0,zIndex:1},"group");let m,y=-v[3],C=-v[0],w=v[1]+v[3],x=v[0]+v[2],_=0,S=0;const{visible:A}=r,B=mm(r,["visible"]);if(nt(A)){const t=(null==B?void 0:B.size)||10,e=ft(t)?t:Math.max(t[0],t[1]);m=b.createOrUpdateChild("tag-shape",Object.assign(Object.assign({symbolType:"circle",size:t,strokeBoundsBuffer:0},B),{visible:A,x:e/2,y:e/2}),"symbol"),_t(null==u?void 0:u.shape)||(m.states=u.shape),A&&(S=e+a)}let T,R,k;if(w+=S,_+=S,function(t){return"rich"===pm(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"type")}({text:n})||"rich"===g){const t=Object.assign(Object.assign(Object.assign({},fm(Object.assign({type:g,text:n},o))),o),{visible:st(n)&&!1!==c,x:_,y:0});rt(t.lineHeight)&&(t.lineHeight=o.fontSize),T=b.createOrUpdateChild("tag-text",t,"richtext"),R=T.AABBBounds.width(),k=T.AABBBounds.height()}else{const i=Object.assign(Object.assign({text:at(n)&&"type"in n&&"text"===n.type?n.text:n,visible:st(n)&&!1!==c,lineHeight:null==o?void 0:o.fontSize},o),{x:_,y:0});rt(i.lineHeight)&&(i.lineHeight=o.fontSize),T=b.createOrUpdateChild("tag-text",i,"text");const r=gm(i.text,o,null===(e=null===(t=this.stage)||void 0===t?void 0:t.getTheme())||void 0===e?void 0:e.text);R=r.width,k=r.height}w+=R;const M=null!==(i=r.size)&&void 0!==i?i:10,L=ft(M)?M:Math.max(M[0],M[1]);x+=Math.max(k,r.visible?L:0);const{textAlign:P,textBaseline:E}=o;(st(l)||st(h))&&(st(l)&&w<l&&(w=l),st(h)&&w>h&&(w=h,T.setAttribute("maxLineWidth",h-v[1]-v[2]))),y=0,C=0;let H=0;"left"===P||"start"===P?H=1:"right"===P||"end"===P?H=-1:"center"===P&&(H=0),H?H<0?(y-=w,m&&m.setAttribute("x",(m.attribute.x||0)-R),b.setAttribute("x",-v[1]-S)):H>0&&b.setAttribute("x",v[3]):(y-=w/2,m&&m.setAttribute("x",(m.attribute.x||0)-R/2),b.setAttribute("x",-S/2));const O="right"===f||"end"===f,I="left"===f||"start"===f,F=(t,e)=>{"richtext"===T.type?T.setAttributes({x:t,textAlign:e,textConfig:Et(T.attribute.textConfig).map((t=>Object.assign(Object.assign({},t),{textAlign:e})))}):T.setAttributes({x:t,textAlign:e})};if((f?"center"===f:p)&&H){const t=w-v[1]-v[3],e=R+S,i=1===H?(t-e)/2+S+R/2:v[0]+S-(w/2+e/2-S)+R/2;if(F(i,"center"),m){const t=i-R/2-S+L/2;m.setAttributes({x:t})}}if(I&&1!==H){const t=w-v[1]-v[3],e=0===H?-t/2+S/2:-w+v[3]+v[1]+S;if(F(e+S,"left"),m){const t=e+L/2;m.setAttributes({x:t})}}if(O&&-1!==H){const t=w-v[1]-v[3],e=0===H?t/2+S/2:t;if(F(e,"right"),m){const t=e-R-S+L/2;m.setAttributes({x:t})}}"middle"===E?(C-=x/2,m&&m.setAttribute("y",0)):"bottom"===E?(C-=x,m&&m.setAttribute("y",-k/2),b.setAttribute("y",-v[2])):"top"===E&&(b.setAttribute("y",v[0]),m&&m.setAttribute("y",k/2)),_t(null==u?void 0:u.text)||(T.states=u.text);const{visible:z}=s,D=mm(s,["visible"]);if(c&&nt(z)){const t=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},D),{visible:z&&!!n,width:w,height:x,x:y,y:C}),"rect");if(_t(null==u?void 0:u.panel)||(t.states=u.panel),D.customShape){const e=D.customShape;t.pathProxy=t=>e(this,t,new wn)}this._bgRect=t}this._textShape=T,this._symbol=m,this.resetStates()}initAttributes(e,i){e=(null==i?void 0:i.skipDefault)?e:Lt({},t.defaultAttributes,e),super.initAttributes(e),this.render()}addState(t,e,i){super.addState(t,e,i),this._textShape&&this._textShape.addState(t,e,i),this._bgRect&&this._bgRect.addState(t,e,i),this._symbol&&this._symbol.addState(t,e,i)}removeState(t,e){super.removeState(t,e),this._textShape&&this._textShape.removeState(t,e),this._bgRect&&this._bgRect.removeState(t,e),this._symbol&&this._symbol.removeState(t,e)}cacheStates(){var t,e,i,n,o,r,s,a,l,h,d,c,u,g;this._tagStates=null!==(e=null===(t=this.currentStates)||void 0===t?void 0:t.slice())&&void 0!==e?e:[],this._rectStates=null!==(o=null===(n=null===(i=this._bgRect)||void 0===i?void 0:i.currentStates)||void 0===n?void 0:n.slice())&&void 0!==o?o:[],this._symbolStates=null!==(a=null===(s=null===(r=this._symbol)||void 0===r?void 0:r.currentStates)||void 0===s?void 0:s.slice())&&void 0!==a?a:[],this._textStates=null!==(d=null===(h=null===(l=this._textShape)||void 0===l?void 0:l.currentStates)||void 0===h?void 0:h.slice())&&void 0!==d?d:[],this.clearStates(),null===(c=this._bgRect)||void 0===c||c.clearStates(),null===(u=this._symbol)||void 0===u||u.clearStates(),null===(g=this._textShape)||void 0===g||g.clearStates()}resetStates(){var t,e,i;this._tagStates.length&&this.useStates(this._tagStates),this._rectStates.length&&(null===(t=this._bgRect)||void 0===t||t.useStates(this._rectStates)),this._symbolStates.length&&(null===(e=this._symbol)||void 0===e||e.useStates(this._symbolStates)),this._textStates.length&&(null===(i=this._textShape)||void 0===i||i.useStates(this._textStates))}};ym.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},space:4,padding:4,shape:{fill:"#000"}};const Cm={visible:!0,position:"auto",titleStyle:{fontSize:16,fill:"#08979c"},contentStyle:{fontSize:12,fill:"green"},panel:{visible:!0,fill:"#e6fffb",size:12,space:0,stroke:"#87e8de",lineWidth:1,cornerRadius:4}},wm={poptip:Lt({},Cm)};var xm=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i};const _m=new Fe;Eb(),Zb(),Kb(),jb();const Sm="M -0.5 -0.5, L -0.5 0.5, L 0.5 -0.5, Z",Am="M -0.5 -0.5, L -0.5 0.5, L 0.5 0.5, Z",Bm="M -0.5 -0.5, L 0.5 -0.5, L 0.5 0.5, Z",Tm="M 0.5 -0.5, L 0.5 0.5, L -0.5 0.5, Z",Rm={tl:Sm,tr:Bm,bl:Am,br:Tm,lt:Sm,lb:Am,rt:Bm,rb:Tm};class km extends Og{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Lt({},km.defaultAttributes,t)),this.name="poptip",this.positionList=["top","tl","tr","bottom","bl","br","left","lt","lb","right","rt","rb"]}render(){var t,e,i,n,o,r,s,a,l;const{titleStyle:h={},position:d,contentStyle:c={},panel:u,logoSymbol:g,poptipAnchor:p="position",logoText:f,logoTextStyle:v={},triangleMode:b="default",space:m=4,minWidth:y=0,maxWidth:C=1/0,padding:w=4,maxWidthPercent:x,visible:_,state:S,dx:A=0,dy:B=0,positionBounds:T}=this.attribute;let{title:R="",content:k=""}=this.attribute;R=this.attribute.titleFormatMethod?this.attribute.titleFormatMethod(R):R,k=this.attribute.contentFormatMethod?this.attribute.contentFormatMethod(k):k;const M=ti(w),L=this.createOrUpdateChild("poptip-content",{x:0,y:0,zIndex:1},"group");this.group=L;const P=C-M[1]-M[3],E=st(R)&&!1!==_,H=Object.assign(Object.assign({text:ut(R)?R:[R],visible:E,wrap:!0},h),{x:M[3],y:M[0],maxLineWidth:P,textAlign:"left",textBaseline:"top"}),O=L.createOrUpdateChild("poptip-title",H,"text");_t(null==S?void 0:S.title)||(O.states=S.title);const I=O.AABBBounds,F=I.height(),z=I.width();let D=F+m;E||(D=0);const W=st(k)&&!1!==_,N=Object.assign(Object.assign({text:ut(k)?k:[k],visible:W,wrap:!0},c),{x:M[3],y:M[0]+D,maxLineWidth:P,textAlign:"left",textBaseline:"top"}),G=L.createOrUpdateChild("poptip-content",N,"text");_t(null==S?void 0:S.content)||(G.states=S.content);const j=G.AABBBounds,V=j.height(),U=j.width();W&&(D+=V),this.titleShape=O,this.contentShape=G;let X=le(z+M[1]+M[3],U+M[1]+M[3]);X>C?X=C:X<y&&(X=y);let $=M[0]+M[2]+D;const{visible:Y,square:K}=u,q=xm(u,["visible","square"]);if(K){const t=le(X,$);X=t;const e=t-$;$=t,O.setAttributes({dy:e/2}),G.setAttributes({dy:e/2})}const Z=null!==(t=q.size)&&void 0!==t?t:12,J=ut(Z)?[Z[0]+(null!==(e=q.space)&&void 0!==e?e:0),Z[1]+(null!==(i=q.space)&&void 0!==i?i:0)]:Z+(null!==(n=q.space)&&void 0!==n?n:0),Q=null!==(o=q.lineWidth)&&void 0!==o?o:1,tt=this.stage?[null!==(r=this.stage.viewWidth)&&void 0!==r?r:this.stage.width,null!==(s=this.stage.viewHeight)&&void 0!==s?s:this.stage.height]:void 0;if(tt){const t=this.AABBBounds,e=null!==(a=this.attribute.x)&&void 0!==a?a:t.x1,i=tt[0]-t.x1;let n=Math.max(e,i);const o=(ut(Z)?Z[0]:12)+3;if(n=Math.min(n-o,n*x),n<X){X=n;const t=M[1]+M[3];O.setAttribute("maxLineWidth",n-t),G.setAttribute("maxLineWidth",n-t),$=M[0]+M[2],E&&($+=O.AABBBounds.height()+m),$+=G.AABBBounds.height()}}const et="auto"===d||ut(d),it=ut(d)?d:this.positionList;let ot,rt=-1/0;for(let t=0;t<it.length+1;t++){const e=et?it[t===it.length?ot:t]:d;let i="arrow2Left",n=(ut(Z)?Z[0]:Z)/4,o=0;"top"===e||"bottom"===e||"left"===e||"right"===e?i="arrow2Left":"concise"===b&&(i=Rm[e],n=["tl","bl","rt","rb"].includes(e)?(ut(Z)?Z[0]:Z)/2:-(ut(Z)?Z[0]:Z)/2,o=["tl","tr","lb","rb"].includes(e)?-(ut(Z)?Z[1]:Z)/2:(ut(Z)?Z[1]:Z)/2);const{angle:r,offset:s}=this.getAngleAndOffset(e,X,$,ut(J)?J:[J,J-Q],i);let a,h={x:0,y:0};if("bounds"===p&&T&&(h=this.calculateAnchorPoint(e,T)),nt(Y)){let t;a=L.createOrUpdateChild("poptip-symbol-panel",Object.assign(Object.assign({},q),{visible:Y&&(W||E),x:n,y:o,strokeBoundsBuffer:-1,boundsPadding:-2,anchor:[0,0],symbolType:i,angle:r,dx:s[0],dy:s[1]-(null!==(l=q.space)&&void 0!==l?l:0),size:Z,zIndex:9}),"symbol"),_t(null==S?void 0:S.panel)||(a.states=S.panel),t=u.panelSymbolType?L.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},q),{visible:Y&&(W||E),x:0,y:0,symbolType:"rect",size:[X,$],zIndex:-8}),"symbol"):L.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},q),{visible:Y&&(W||E),x:0,y:0,width:X,height:$,zIndex:-8}),"rect"),_t(null==S?void 0:S.panel)||(t.states=S.panel)}if(L.setAttributes({x:-s[0]+A+h.x,y:-s[1]+B+h.y,anchor:[n,o]}),g){const{size:t=12}=g,e=ut(t)?t:[t,t];"auto"===e[1]&&(e[1]=$),"auto"===e[0]&&(e[0]=$);const i=e[0];L.createOrUpdateChild("poptip-logo",Object.assign(Object.assign({},g),{x:0,y:$/2,visible:Y&&(W||E),zIndex:10,size:e}),"symbol"),L.setAttributes({x:-s[0]+A+i/2,y:-s[1]+B}),f&&L.createOrUpdateChild("poptip-logo-text",Object.assign(Object.assign({},v),{x:0,y:$/2,visible:Y&&(W||E),text:f,textAlign:"center",textBaseline:"middle",zIndex:10}),"text")}if(!tt)break;{_m.setValue(0,0,X,$).transformWithMatrix(L.globalTransMatrix);const i=_m,n=(new Ie).setValue(0,0,tt[0],tt[1]);if(et){if(_e(i,n,!1))break;{const e=Ce(i,n,!1),o=(e.x2-e.x1)*(e.y2-e.y1);o>rt&&(rt=o,ot=t)}}if(["top","bottom","left","right"].includes(e)){const t="top"===e||"bottom"===e,o="left"===e||"right"===e;let r=!1;if(t?r="top"===e&&i.y1<0||"bottom"===e&&i.y2>n.y2:o&&(r="left"===e&&i.x1<0||"right"===e&&i.x2>n.x2),!r){let e=0;const r=(ut(Z)?Z[1]:Z)/2;t?(i.x1<0?e=-i.x1:i.x2>n.x2&&(e=n.x2-i.x2),L.setAttribute("x",L.attribute.x+e),a.setAttribute("dx",he(le(a.attribute.dx-e,r),i.width()-r))):o&&(i.y1<0?e=-i.y1:i.y2>n.y2&&(e=n.y2-i.y2),L.setAttribute("y",L.attribute.y+e),a.setAttribute("dy",he(le(a.attribute.dy-e,r),i.height()-r)));break}}if(!et)break}}}calculateAnchorPoint(t,e){if(!e)return{x:0,y:0};const{x:i,y:n}=this.attribute,{x1:o,y1:r,x2:s,y2:a}=e,l=s-o,h=a-r;switch(t){case"top":case"tl":case"tr":return{x:o+l/2-i,y:r-n};case"bottom":case"bl":case"br":return{x:o+l/2-i,y:a-n};case"left":case"lt":case"lb":return{x:o-i,y:r+h/2-n};case"right":case"rt":case"rb":return{x:s-i,y:r+h/2-n};default:return{x:0,y:0}}}getAngleAndOffset(t,e,i,n,o){const r="arrow2Left"===o?n[1]/2:n[1];switch(t){case"tl":return{angle:"arrow2Left"===o?ee/2*3:0,offset:"arrow2Left"===o?[e/4,i+r]:[0,i+r]};case"top":return{angle:ee/2*3,offset:[e/2,i+r]};case"tr":return{angle:"arrow2Left"===o?ee/2*3:0,offset:"arrow2Left"===o?[e/4*3,i+r]:[e,i+r]};case"rt":return{angle:0,offset:"arrow2Left"===o?[-r,i/5]:[-r,0]};case"right":return{angle:0,offset:[-r,i/2]};case"rb":return{angle:0,offset:"arrow2Left"===o?[-r,i/5*4]:[-r,i]};case"bl":return{angle:"arrow2Left"===o?ee/2:0,offset:"arrow2Left"===o?[e/4,-r]:[0,-r]};case"bottom":return{angle:ee/2,offset:[e/2,-r]};case"br":return{angle:"arrow2Left"===o?ee/2:0,offset:"arrow2Left"===o?[e/4*3,-r]:[e,-r]};case"lt":return{angle:"arrow2Left"===o?ee:0,offset:"arrow2Left"===o?[e+r,i/5]:[e+r,0]};case"left":return{angle:ee,offset:[e+r,i/2]};case"lb":return{angle:"arrow2Left"===o?ee:0,offset:"arrow2Left"===o?[e+r,i/5*4]:[e+r,i]}}}appearAnimate(t){const{duration:e=1e3,easing:i="quadOut"}=t;if(this.setAttributes({scaleX:0,scaleY:0}),this.animate().to({scaleX:1,scaleY:1},e/3*2,i),this.titleShape&&this.titleShape.animate().play(new Br({text:""},{text:this.titleShape.attribute.text},e,i)),this.contentShape&&this.contentShape.animate().play(new Br({text:""},{text:this.contentShape.attribute.text},e,i)),t.wave){const n=e/6;this.group.animate().to({angle:t.wave},n,i).to({angle:-t.wave},2*n,i).to({angle:t.wave},2*n,i).to({angle:0},n,i)}}disappearAnimate(t){const{duration:e=1e3,easing:i="quadOut"}=t;this.animate().to({scaleX:0,scaleY:0},e,i)}}km.defaultAttributes={position:"rt",visible:!0,title:null,content:null,titleStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},contentStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},panel:{},maxWidthPercent:.8,space:8,padding:10};var Mm=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let Lm=class{render(t,e,i,n,o,r,s,a,l,h,d,c,u){var g,p;if(1===t._showPoptip){const{visible:e,visibleCb:i}=t.attribute.poptip||{};if(!1===e||i&&!1===i(t))return;const n={};Lt(n,km.defaultAttributes,t.attribute.poptip?t.attribute.poptip:{}),this.poptipComponent?this.poptipComponent.initAttributes(n):this.poptipComponent=new km(n);let o=t.attribute.poptip||{};if("text"===t.type&&null==o.title&&null==o.content){const e={};Lt(e,wm.poptip,o),o=e,o.content=null!==(g=o.content)&&void 0!==g?g:t.attribute.text}const r=t.globalTransMatrix;this.poptipComponent.setAttributes(Object.assign(Object.assign({visibleAll:!0,pickable:!1,childrenPickable:!1,poptipAnchor:"bounds"},o),{x:r.e,y:r.f,positionBounds:t.globalAABBBounds})),h.stage.tryInitInteractiveLayer();const s=h.stage.getLayer("_builtin_interactive");s&&s.add(this.poptipComponent)}else 2===t._showPoptip&&(t._showPoptip=0,this.poptipComponent&&(this.poptipComponent.setAttributes({visibleAll:!1}),null===(p=this.poptipComponent.parent)||void 0===p||p.removeChild(this.poptipComponent),this.poptipComponent=null))}};Lm=Mm([w()],Lm);var Pm=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};class Em{constructor(){this.activeEvent="onRegister",this._uid=a.GenAutoIncrementId(),this.poptip=t=>{const e=t.target;this.needHide(e)?this.unpoptip(t):e!==this.activeGraphic&&(this.needShow(e)&&(e.setAttributes({}),e._showPoptip=1),this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2),this.setActiveGraphic(e,!0))},this.unpoptip=t=>{this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2,this.setActiveGraphic(null,!0))}}activate(t){this.pluginService=t;const{stage:e}=this.pluginService;e.addEventListener("pointerover",this.poptip)}needHide(t){return t.isContainer||!t.attribute}needShow(t){return!!t.attribute.poptip}setActiveGraphic(t,e){this.activeGraphic=t,this.pluginService.stage.renderNextFrame()}deactivate(t){const{stage:e}=this.pluginService;e.removeEventListener("pointerover",this.poptip)}}let Hm=class extends Em{constructor(){super(...arguments),this.name="poptip",this.key=this.name+this._uid}};Hm=Pm([w()],Hm);let Om=class extends Em{constructor(){super(...arguments),this.name="poptipForText",this.key=this.name+this._uid,this.pointerlave=t=>{const{stage:e}=this.pluginService;t.target===e&&this.unpoptip(t)}}activate(t){super.activate(t);const{stage:e}=this.pluginService;e.addEventListener("pointerleave",this.pointerlave)}needHide(t){return"text"!==t.type||!t.cliped||t.isContainer||!t.attribute||t.attribute.disableAutoClipedPoptip}needShow(t){return!0}deactivate(t){const{stage:e}=this.pluginService;super.deactivate(t),e.removeEventListener("pointerleave",this.pointerlave)}};Om=Pm([w()],Om);const Im=new l(((t,e,i,n)=>{i(Lm)||(t(Lm).toSelf().inSingletonScope(),t(fl).toService(Lm)),i(Hm)||(t(Hm).toSelf(),t(Jc).toService(Hm)),i(Om)||(t(Om).toSelf(),t(Jc).toService(Om))}));Eb(),Fb(),Nb(),Kb();class Fm extends Og{getStartAngle(){return ye(this._startAngle)}getEndAngle(){return ye(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Lt({},Fm.defaultAttributes,t)),this.name="segment",this.key="segment",this.lines=[]}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:n,visible:o=!0,multiSegment:r,mainSegmentIndex:s}=this.attribute;if(!o)return;this._computeLineAngle();const a=this._getMainSegmentPoints(),l=this._renderSymbol(t,a,"start"),h=this._renderSymbol(e,a,"end");if(this.startSymbol=l,this.endSymbol=h,r){const t=[...this.attribute.points];if(vt(s))t[s]=this._clipPoints(t[s]);else{const e=this._clipPoints(zt(t));t[0][0]=e[0],t[t.length-1][t[t.length-1].length-1]=e[e.length-1]}t.forEach(((t,e)=>{var o,r;const s=_h.line(Object.assign(Object.assign({points:t},ut(i)?null!==(o=i[e])&&void 0!==o?o:i[i.length-1]:i),{fill:!1}));s.name=`${this.name}-line`,s.id=this._getNodeId("line"+e),_t(null==n?void 0:n.line)||(s.states=ut(n.line)?null!==(r=n.line[e])&&void 0!==r?r:n.line[n.line.length-1]:n.line),this.add(s),this.lines.push(s)}))}else{let t=_h.line;Et(i)[0].cornerRadius&&(t=_h.polygon);const e=t(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},Et(i)[0]),{fill:!1,closePath:!1}));e.name=`${this.name}-line`,e.id=this._getNodeId("line"),_t(null==n?void 0:n.line)||(e.states=[].concat(n.line)[0]),this.add(e),this.lines.push(e)}}_computeStartRotate(t){return t+Math.PI/2}_computeEndRotate(t){return t+Math.PI/2}_renderSymbol(t,e,i){if(!e.length)return;const{autoRotate:n=!0}=t;let o;if(t&&t.visible){const r=this.getStartAngle(),s=this.getEndAngle(),{state:a}=this.attribute,l=e[0],h=e[e.length-1],{refX:d=0,refY:c=0,refAngle:u=0,style:g,symbolType:p,size:f=12}=t;let v,b;"start"===i?(v={x:l.x+(vt(r)?d*Math.cos(r)+c*Math.cos(r-Math.PI/2):0),y:l.y+(vt(r)?d*Math.sin(r)+c*Math.sin(r-Math.PI/2):0)},b=this._computeStartRotate(this._startAngle)):(v={x:h.x+(vt(s)?d*Math.cos(s)+c*Math.cos(s-Math.PI/2):0),y:h.y+(vt(s)?d*Math.sin(s)+c*Math.sin(s-Math.PI/2):0)},b=this._computeEndRotate(this._endAngle)),o=_h.symbol(Object.assign(Object.assign(Object.assign({},v),{symbolType:p,size:f,angle:n?b+u:0,strokeBoundsBuffer:0}),g)),o.name=`${this.name}-${i}-symbol`,o.id=this._getNodeId(`${i}-symbol`),_t(null==a?void 0:a.symbol)||(o.states=a.symbol),"start"===i?_t(null==a?void 0:a.startSymbol)||(o.states=a.startSymbol):_t(null==a?void 0:a.endSymbol)||(o.states=a.endSymbol),this.add(o)}return o}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:t,multiSegment:e,mainSegmentIndex:i}=this.attribute;let n;return n=e?vt(i)?t[i]:zt(t):t,this._mainSegmentPoints=n,n}_clipPoints(t){const{startSymbol:e={},endSymbol:i={}}=this.attribute;let n=t;if(e.visible){const i=e.clip?e.size||10:0;n=[{x:t[0].x-i/2*(Math.cos(this._startAngle)||0),y:t[0].y-i/2*(Math.sin(this._startAngle)||0)},...n.slice(1)]}if(i.visible){const e=i.clip?i.size||10:0,o={x:t[t.length-1].x-e/2*(Math.cos(this._endAngle)||0),y:t[t.length-1].y-e/2*(Math.sin(this._endAngle)||0)};n=[...n.slice(0,n.length-1),o]}return n}_computeLineAngle(){const t=this._getMainSegmentPoints();if(t.length<=1)return;const e=t[0],i=t[1],n=t[t.length-2],o=t[t.length-1],r=[e.x-i.x,e.y-i.y],s=Math.atan2(r[1],r[0]),a=[o.x-n.x,o.y-n.y],l=Math.atan2(a[1],a[0]);this._startAngle=s,this._endAngle=l}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}var zm,Dm;Fm.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}},function(t){t.innerView="inner-view",t.axisContainer="axis-container",t.labelContainer="axis-label-container",t.tickContainer="axis-tick-container",t.tick="axis-tick",t.subTick="axis-sub-tick",t.label="axis-label",t.title="axis-title",t.gridContainer="axis-grid-container",t.grid="axis-grid",t.gridRegion="axis-grid-region",t.line="axis-line",t.background="axis-background",t.axisLabelBackground="axis-label-background",t.axisBreak="axis-break",t.axisBreakSymbol="axis-break-symbol"}(zm||(zm={})),function(t){t.selected="selected",t.selectedReverse="selected_reverse",t.hover="hover",t.hoverReverse="hover_reverse"}(Dm||(Dm={}));const Wm={[Dm.selectedReverse]:{},[Dm.selected]:{},[Dm.hover]:{},[Dm.hoverReverse]:{}},Nm={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}},Gm={size:8,stroke:"#000",lineWidth:1,zIndex:1};const jm=Math.sin(Math.PI/10);function Vm(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jm;const i=!rt(t)&&0!==t,n=i?Math.cos(t):1;return i&&Math.abs(n)<=e}function Um(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jm;const i=!rt(t)&&0!==t,n=i?Math.sin(t):0;return!i||Math.abs(n)<=e}function Xm(t,e){return{x:t.x+e[0],y:t.y+e[1]}}function $m(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=[e.x-i.x,e.y-i.y];return hm(r,(n?-1:1)*(o?-1:1)*t/dm(r))}function Ym(t,e,i,n,o){const r=function(t,e,i){return e?{x:t.x+e*Math.cos(i),y:t.y+e*Math.sin(i)}:{x:t.x,y:t.y}}({x:0,y:0},i,t),s=Xm(r,$m(n,r,e,o));return a=s,l=$m(n||1,s,e,o),{x:a.x+l[0],y:a.y+l[1]};var a,l}function Km(t,e,i){var n;if(Um(null===(n=t.attribute)||void 0===n?void 0:n.angle,Number.EPSILON))return i>Ee(t.AABBBounds,e.AABBBounds);const o=t.OBBBounds,r=e.OBBBounds;return!o||!r||o.empty()||r.empty()?i>Ee(t.AABBBounds,e.AABBBounds):o.intersects(r)||i>He(o,r)}function qm(t,e){for(let i,n=1,o=t.length,r=t[0];n<o;r=i,++n)if(i=t[n],Km(r,i,e))return!0;return!1}class Zm extends Og{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=t=>{this._lastHover=((t,e,i)=>{const n=t.target;return n!==i&&n.name&&!_t(n.states)?(n.addState(im.hover,!0),lm(e,(t=>{t!==n&&t.name&&!_t(t.states)&&t.addState(im.hoverReverse,!0)})),n):i})(t,this.axisContainer,this._lastHover)},this._onUnHover=t=>{this._lastHover=((t,e,i)=>i?(lm(e,(t=>{t.name&&!_t(t.states)&&(t.removeState(im.hoverReverse),t.removeState(im.hover))})),null):i)(0,this.axisContainer,this._lastHover)},this._onClick=t=>{this._lastSelect=((t,e,i)=>{const n=t.target;return i===n&&n.hasState(im.selected)?(lm(e,(t=>{t.name&&!_t(t.states)&&(t.removeState(im.selectedReverse),t.removeState(im.selected))})),null):n.name&&!_t(n.states)?(n.addState(im.selected,!0),lm(e,(t=>{t!==n&&t.name&&!_t(t.states)&&t.addState(im.selectedReverse,!0)})),n):i})(t,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(t){const e=Tt(this.attribute);Lt(this.attribute,t);const i=_h.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=e,i.AABBBounds}render(){this._prevInnerView=this._innerView&&function(t){const e={};return lm(t,(t=>{"group"!==t.type&&t.id&&(e[t.id]=t)})),e}(this._innerView),this.removeAllChild(!0),this._innerView=_h.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:t,select:e}=this.attribute;t&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),e&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(t){const{title:e,label:i,tick:n,line:o,items:r}=this.attribute,s=_h.group({x:0,y:0,zIndex:1,pickable:!1});if(s.name=zm.axisContainer,s.id=this._getNodeId("container"),s.setMode(this.mode),this.axisContainer=s,t.add(s),o&&o.visible&&this.renderLine(s),r&&r.length&&(this.data=this._transformItems(r[0]),n&&n.visible&&this.renderTicks(s),i&&i.visible)){const t=_h.group({x:0,y:0,pickable:!1});t.name=zm.labelContainer,t.id=this._getNodeId("label-container"),this.axisLabelsContainer=t,s.add(t),r.forEach(((e,i)=>{const n=this.renderLabels(t,e,i),o=n.getChildren();this.beforeLabelsOverlap(o,e,n,i,r.length),this.handleLabelsOverlap(o,e,n,i,r.length),this.afterLabelsOverlap(o,e,n,i,r.length);let s=0,a=0,l="center",h="middle",d=0;o.forEach(((t,e)=>{var i;const n=t.attribute,o=null!==(i=n.angle)&&void 0!==i?i:0,r=t.AABBBounds;let c=r.width(),u=r.height();o&&(c=Math.abs(c*Math.cos(o)),u=Math.abs(u*Math.sin(o))),s=Math.max(s,c),a=Math.max(a,u),l=n.textAlign,h=n.textBaseline,0===e&&(d=n.x)})),this.axisLabelLayerSize[i]={width:s,height:a,labelPos:d,textAlign:l,textBaseline:h}}))}e&&e.visible&&this.renderTitle(s)}renderTicks(t){const e=this.getTickLineItems(),i=_h.group({x:0,y:0,pickable:!1});i.name=zm.tickContainer,i.id=this._getNodeId("tick-container"),t.add(i),e.forEach(((t,n)=>{var o;const r=_h.line(Object.assign({},this._getTickLineAttribute("tick",t,n,e)));if(r.name=zm.tick,r.id=this._getNodeId(t.id),_t(null===(o=this.attribute.tick)||void 0===o?void 0:o.state))r.states=nm;else{const t=this.data[n],e=Lt({},nm,this.attribute.tick.state);Object.keys(e).forEach((i=>{ot(e[i])&&(e[i]=e[i](t.rawValue,n,t,this.data))})),r.states=e}i.add(r)})),this.tickLineItems=e;const{subTick:n}=this.attribute;if(n&&n.visible){const t=this.getSubTickLineItems();t.length&&t.forEach(((t,o)=>{const r=_h.line(Object.assign({},this._getTickLineAttribute("subTick",t,o,e)));if(r.name=zm.subTick,r.id=this._getNodeId(`${o}`),_t(n.state))r.states=nm;else{const i=Lt({},nm,n.state);Object.keys(i).forEach((n=>{ot(i[n])&&(i[n]=i[n](t.value,o,t,e))})),r.states=i}i.add(r)})),this.subTickLineItems=t}}renderLabels(t,e,i){const{dataFilter:n}=this.attribute.label;n&&ot(n)&&(e=n(e,i));const o=this._transformItems(e),r=_h.group({x:0,y:0,pickable:!1});return r.name=`${zm.labelContainer}-layer-${i}`,r.id=this._getNodeId(`label-container-layer-${i}`),t.add(r),o.forEach(((t,e)=>{var n;const s=vm(this._getLabelAttribute(t,e,o,i));if(s.name=zm.label,s.id=this._getNodeId(`layer${i}-label-${t.id}`),_t(null===(n=this.attribute.label)||void 0===n?void 0:n.state))s.states=nm;else{const n=Lt({},nm,this.attribute.label.state);Object.keys(n).forEach((r=>{ot(n[r])&&(n[r]=n[r](t,e,o,i))})),s.states=n}s.data=Object.assign(Object.assign({},t),{index:e,layer:i}),r.add(s)})),r}renderTitle(t){const e=this.getTitleAttribute(),i=new ym(Object.assign({},e));i.name=zm.title,i.id=this._getNodeId("title"),t.add(i)}getVerticalCoord(t,e,i){return Xm(t,this.getVerticalVector(e,i,t))}getTickLineItems(){const{tick:t}=this.attribute,e=this.data,i=[],{alignWithLabel:n,inside:o=!1,length:r,dataFilter:s}=t;let a=1;return e.length>=2&&(a=e[1].value-e[0].value),(s&&ot(s)?s(e):e).forEach((t=>{let e=t.point,s=t.value;if(!n){const i=t.value-a/2;if(this.isInValidValue(i))return;e=this.getTickCoord(i),s=i}const l=this.getVerticalCoord(e,r,o);if("3d"===this.mode){const n=this.getVerticalVector(r,o,e);let a=0,h=0;re(n[0])>re(n[1])?a=ee/2*(l.x>e.x?1:-1):h=ee/2*(l.y>e.y?-1:1),i.push({start:e,end:l,value:s,id:`tick-${t.id}`,anchor:[e.x,e.y],alpha:a,beta:h})}else i.push({start:e,end:l,value:s,id:`tick-${t.id}`})})),i}getSubTickLineItems(){const{subTick:t}=this.attribute,e=[],{count:i=4,inside:n=!1,length:o=2}=t,r=this.tickLineItems,s=r.length;if(s>=2)for(let t=0;t<s-1;t++){const s=r[t],a=r[t+1];for(let t=0;t<i;t++){const r=(t+1)/(i+1),l=(1-r)*s.value+r*a.value,h=this.getTickCoord(l),d=this.getVerticalCoord(h,o,n);e.push({start:h,end:d,value:l,id:`sub-tick-${l}`})}}return e}_getTickLineAttribute(t,e,i,n){let o=St(this.attribute,`${t}.style`);const r=this.data[i];o=ot(o)?Lt({},St(Nm,`${t}.style`),"tick"===t?o(r.rawValue,i,r,this.data):o(e.value,i,e,n)):o;const{start:s,end:a,anchor:l,alpha:h,beta:d}=e;return Object.assign({points:[s,a],anchor:l,alpha:h,beta:d},o)}_getLabelAttribute(t,e,i,n){var o,r;const{space:s=4,inside:a=!1,formatMethod:l,type:h="text",text:d}=this.attribute.label;let c=s,u=0;(null===(o=this.attribute.tick)||void 0===o?void 0:o.visible)&&this.attribute.tick.inside===a&&(u=this.attribute.tick.length||4),(null===(r=this.attribute.subTick)||void 0===r?void 0:r.visible)&&this.attribute.subTick.inside===a&&(u=Math.max(u,this.attribute.subTick.length||2)),c+=u;const g=this.getRelativeVector(t.point);n>0&&(0===g[1]?c+=(this.axisLabelLayerSize[n-1].height+St(this.attribute,"label.space",4))*n:c+=(this.axisLabelLayerSize[n-1].width+St(this.attribute,"label.space",4))*n);const p=this.getVerticalCoord(t.point,c,a),f=this.getVerticalVector(c||1,a,p),v=l?l(`${t.label}`,t,e,i,n):t.label;let{style:b}=this.attribute.label;b=ot(b)?Lt({},Nm.label.style,b(t,e,i,n)):b;return b=Lt(this.getLabelAlign(f,a,b.angle),b),ot(b.text)&&(b.text=b.text({label:t.label,value:t.rawValue,index:t.index,layer:n})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(p,f,v,b)),{text:null!=d?d:v,_originText:t.label,lineHeight:null==b?void 0:b.fontSize,type:h}),b)}getLabelPosition(t,e,i,n){return t}_transformItems(t){const e=[];return t.forEach((t=>{var i;e.push(Object.assign(Object.assign({},t),{point:this.getTickCoord(t.value),id:null!==(i=t.id)&&void 0!==i?i:t.label}))})),e}release(){super.release(),this._prevInnerView=null,this._innerView=null}}const Jm={parity:function(t){return t.filter(((t,e)=>e%2?t.setAttribute("opacity",0):1))},greedy:function(t,e){let i;return t.filter(((t,n)=>n&&Km(i,t,e)?t.setAttribute("opacity",0):(i=t,1)))}};function Qm(t){let e;return e=t.OBBBounds.empty()?t.AABBBounds:t.OBBBounds,e.width()>1&&e.height()>1}function ty(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(i&&!t.attribute.opacity){const i=e.length;if(i>1){t.setAttribute("opacity",1);for(let t=0;t<i;t++){const r=o?e[i-1-t]:e[t];if(!n(r))break;r.setAttribute("opacity",0)}}}}function ey(t){for(let r=1;r<t.length;r++)if(e=t[r-1],i=t[r],n=void 0,o=void 0,(null===(n=e.OBBBounds)||void 0===n?void 0:n.empty())||(null===(o=i.OBBBounds)||void 0===o?void 0:o.empty())?Se(e.AABBBounds,i.AABBBounds,!1)&&(!e.rotatedBounds||!i.rotatedBounds||ke(e.rotatedBounds,i.rotatedBounds,!0)):e.OBBBounds.intersects(i.OBBBounds))return!0;var e,i,n,o;return!1}function iy(t,e){"bottom"!==t&&"top"!==t||function(t,e){e.forEach((e=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},oy(t,e.attribute.angle)),{angle:ny(e.attribute.angle)}))}))}(t,e),"left"!==t&&"right"!==t||function(t,e){e.forEach(((e,i)=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},ry(t,e.attribute.angle)),{angle:ny(e.attribute.angle)}))}))}(t,e),function(t){t.forEach((t=>{if(t.rotatedBounds||!t.attribute.angle)return;const e=function(t){const e=t.AABBBounds;return{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,centerX:t.attribute.x,centerY:t.attribute.y,angle:t.attribute.angle}}(t),i=Be({x:t.attribute.x,y:t.attribute.y},e.angle,{x:e.centerX,y:e.centerY}),n=i.x-e.centerX,o=i.y-e.centerY;e.x1+=n,e.x2+=n,e.y1+=o,e.y2+=o,e.centerX+=n,e.centerY+=o,t.rotatedBounds=e}))}(e)}function ny(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t<0)for(;t<0;)t+=2*Math.PI;if(t>0)for(;t>=2*Math.PI;)t-=2*Math.PI;return t}function oy(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=["center","left","left","left","center","right","right","right","left"],n=["top","top","middle","bottom","bottom","bottom","middle","top","top"];"top"===t&&(i=["center","right","right","right","center","left","left","left","right"],n=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const o=(e=ny(e))/(.5*Math.PI);let r;return r=o===Math.floor(o)?2*Math.floor(o):2*Math.floor(o)+1,{textAlign:i[r],textBaseline:n[r]}}function ry(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=["right","right","center","left","left","left","center","right","right"],n=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];"right"===t&&(i=["left","left","center","right","right","right","center","left","left"],n=["middle","middle","bottom","bottom","middle","middle","top","middle","middle"]);const o=(e=ny(e))/(.5*Math.PI);let r;return r=o===Math.floor(o)?2*Math.floor(o):2*Math.floor(o)+1,{textAlign:i[r],textBaseline:n[r]}}function sy(t,e){const{limitLength:i,verticalLimitLength:n,ellipsis:o="...",orient:r,axisLength:s}=e;if(_t(t)||!vt(i))return;const a=function(t){return vt(t)?{left:t,right:t}:at(t)?{left:t.left||0,right:t.right||0}:{left:0,right:0}}(e.overflowLimitLength),l=t[0],h=l.attribute.angle,d=!rt(h),c=d?Math.cos(h):1,u=d?Math.sin(h):0,g=Um(h),p=Vm(h),f="top"===r||"bottom"===r,v=l.attribute.direction,b=!g&&!p&&f&&(t.length<2||t.some((t=>Math.abs(t.AABBBounds.width()-l.AABBBounds.width())>=2)))&&l.AABBBounds.width()>Math.abs(i/u);t.forEach((t=>{var e;if(f){if(p&&Math.floor(t.AABBBounds.height())<=i)return;if(g&&Math.floor(t.AABBBounds.width())<=n)return}if(!f){if("vertical"===v&&Math.floor(t.AABBBounds.height())<=n)return;if("vertical"!==v){if(g&&Math.floor(t.AABBBounds.width())<=i)return;if(p&&Math.floor(t.AABBBounds.height())<=n)return}}let r=null;if(g||p)r=f?g?n:i:"vertical"===v||p?n:i;else if(f){const{x1:e,x2:n}=t.AABBBounds,o=u/c,l=Math.abs(i/u);if(b&&o>0&&e<=s+a.right&&i/o+e>s+a.right){const t=(s-e+a.right)/Math.abs(c);r=Math.min(t,l)}else if(b&&o<0&&n>=-a.left&&i/o+n<-a.left){const t=(n+a.left)/Math.abs(c);r=Math.min(t,l)}else r=l}else r=Math.abs(i/c);vt(t.attribute.maxLineWidth)&&(r=vt(r)?Math.min(t.attribute.maxLineWidth,r):t.attribute.maxLineWidth),t.setAttributes({maxLineWidth:r,ellipsis:null!==(e=t.attribute.ellipsis)&&void 0!==e?e:o})}))}function ay(t,e,i){let n;return vt(e)&&(n=Math.abs(e-t)),vt(i)&&(n=vt(n)?Math.min(Math.abs(t-i),n):Math.abs(t-i)),n}var ly=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i};Eb(),Fb(),Ub(),Zb(),jb();class hy extends Zm{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Lt({},hy.defaultAttributes,t),e)}_renderInner(t){var e;if(this._breaks=null,this.attribute.breaks&&this.attribute.breaks.length){const t=[];for(let e=0;e<this.attribute.breaks.length;e++){const i=this.attribute.breaks[e],{range:n,breakSymbol:o,rawRange:r}=i;t.push({startPoint:this.getTickCoord(n[0]),endPoint:this.getTickCoord(n[1]),range:n,breakSymbol:o,rawRange:r})}this._breaks=t}super._renderInner(t),this._breaks&&this._breaks.length&&this._breaks.forEach(((e,i)=>{const{startPoint:n,endPoint:o,breakSymbol:r,rawRange:s}=e;if(!1!==(null==r?void 0:r.visible)){const e=_h.group({zIndex:999});e.name=zm.axisBreak,e.id=this._getNodeId(`${zm.axisBreak}-${i}`),e.data=s;const a=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e,i;const{style:n={},angle:o=.5*Math.PI}=t,r=Lt({},Gm,n),s=null!==(e=r.size)&&void 0!==e?e:Gm.size;return Object.assign(Object.assign({},r),{symbolType:null!==(i=r.symbolType)&&void 0!==i?i:`M ${-s/2} ${s*Math.sin(o)} L ${s/2} ${-s*Math.sin(o)}`,symbolSize:s})}(r),l=_h.symbol(Object.assign({x:n.x,y:n.y},a));l.name=zm.axisBreakSymbol;const h=_h.symbol(Object.assign({x:o.x,y:o.y},a));h.name=zm.axisBreakSymbol,e.add(l),e.add(h),t.add(e)}}));const{panel:i}=this.attribute;if(i&&i.visible){const t=this.axisContainer,n=t.AABBBounds,o=_h.rect(Object.assign({x:n.x1,y:n.y1,width:n.width(),height:n.height()},i.style));o.name=zm.background,o.id=this._getNodeId("background"),o.states=Lt({},Wm,null!==(e=i.state)&&void 0!==e?e:{}),t.insertBefore(o,t.firstChild)}}renderLine(t){const{start:e,end:i,line:n}=this.attribute,o=n,{startSymbol:r,endSymbol:s,style:a,state:l}=o,h=ly(o,["startSymbol","endSymbol","style","state"]),d=Object.assign({startSymbol:r,endSymbol:s,lineStyle:a},h);if(this._breaks&&this._breaks.length){const t=[];let n=e;this._breaks.forEach((e=>{const{startPoint:i,endPoint:o}=e;t.push([n,i]),n=o})),t.push([n,i]),d.points=t,d.multiSegment=!0}else d.points=[e,i];_t(l)||(d.state={line:Lt({},Wm,l),symbol:Lt({},Wm,l)});const c=new Fm(d);c.name=zm.line,c.id=this._getNodeId("line"),t.add(c)}getTextAlign(t){let e="center";return Ut(t[0],0)?Ut(t[1],0)?Object.is(t[1],-0)?e="start":Object.is(t[0],-0)&&(e="end"):e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e}getTitleAttribute(){var t,e,i;const n=this.attribute.title,{position:o="middle",space:r=4,textStyle:s={},autoRotate:a=!0,shape:l,background:h,state:d={},maxWidth:c}=n,u=ly(n,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]);let g=.5;"start"===o?g=0:"end"===o&&(g=1);const{verticalFactor:p=1}=this.attribute,f=-1*p,v=this.getTickCoord(g),b=this.getRelativeVector();let m=0;if((null===(t=this.attribute.label)||void 0===t?void 0:t.visible)&&!1===this.attribute.label.inside){const t=+St(this.attribute,"label.space",4);m+=t;const e=Object.keys(this.axisLabelLayerSize).length;if(0===b[1]){const i=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(i)?m+=i+(e-1)*t:m=0}else if(0===b[0])if(this.axisLabelsContainer&&this.axisLabelsContainer.AABBBounds&&!this.axisLabelsContainer.AABBBounds.empty()){const i=this.axisLabelLayerSize[0].labelPos,n=this.axisLabelsContainer.AABBBounds;m+=(1===f?n.x2>i?Math.min(n.x2-i,n.width()):0:n.x1<i?Math.min(i-n.x1,n.width()):0)+(e-1)*t}else m=0;else Object.keys(this.axisLabelLayerSize).forEach(((e,i)=>{m+=this.axisLabelLayerSize[e].width+(i>0?t:0)}))}let y=0;(null===(e=this.attribute.tick)||void 0===e?void 0:e.visible)&&!1===this.attribute.tick.inside&&(y=this.attribute.tick.length||4),(null===(i=this.attribute.subTick)||void 0===i?void 0:i.visible)&&!1===this.attribute.subTick.inside&&(y=Math.max(y,this.attribute.subTick.length||2));const C=y+m+r,w=this.getVerticalCoord(v,C,!1),x=this.getVerticalVector(C,!1,{x:0,y:0});let _,S,{angle:A}=u;if(_="start"===o?"start":"end"===o?"end":"center",rt(A)&&a){A=cm(b,[1,0],!0);const{verticalFactor:t=1}=this.attribute;S=1==-1*t?"bottom":"top"}else _=this.getTextAlign(x),S=this.getTextBaseline(x,!1);let B=c;if(rt(B)){const{verticalLimitSize:t,verticalMinSize:e,orient:i}=this.attribute,n=Math.min(t||1/0,e||1/0);if(vt(n))if("bottom"===i||"top"===i)if(A!==Math.PI/2){const t=Math.abs(Math.cos(null!=A?A:0));B=t<1e-6?1/0:this.attribute.end.x/t}else B=n-C;else if(A&&0!==A){const t=Math.abs(Math.sin(A));B=t<1e-6?1/0:this.attribute.end.y/t}else B=n-C}const T=Object.assign(Object.assign(Object.assign({},w),u),{maxWidth:B,textStyle:Object.assign({textAlign:_,textBaseline:S},s),state:{text:Lt({},Wm,d.text),shape:Lt({},Wm,d.shape),panel:Lt({},Wm,d.background)}});return T.angle=A,l&&l.visible&&(T.shape=Object.assign({visible:!0},l.style),l.space&&(T.space=l.space)),h&&h.visible&&(T.panel=Object.assign({visible:!0},h.style)),T}getTextBaseline(t,e){let i="middle";const{verticalFactor:n=1}=this.attribute,o=(e?1:-1)*n;return Ut(t[1],0)?i=!Ut(t[0],0)||Object.is(t[0],-0)||Object.is(t[1],-0)?"middle":1===o?"bottom":"top":t[1]>0?i="top":t[1]<0&&(i="bottom"),i}getLabelAlign(t,e,i){const n=this.attribute.orient;if(["top","bottom","right","left"].includes(n)||0===t[0]&&0===t[1]){if("top"===n||"bottom"===n)return oy(e?"bottom"===n?"top":"bottom":n,i);if("left"===n||"right"===n)return ry(e?"left"===n?"right":"left":n,i)}return{textAlign:this.getTextAlign(t),textBaseline:this.getTextBaseline(t,e)}}beforeLabelsOverlap(t,e,i,n,o){var r,s,a,l;const{flush:h=!1}=this.attribute.label||{};if(h&&t.length){const{orient:e,start:i,end:n}=this.attribute,o="bottom"===e||"top"===e,h=t[0],d=Ht(t),c=o?h.attribute.x>d.attribute.x:h.attribute.y<d.attribute.y;if(o){const t=c?d:h,e=c?h:d,o=i.x,a=n.x,l=t.AABBBounds.x1,u=e.AABBBounds.x2;l<o&&(t.attribute.angle?t.setAttributes({dx:(null!==(r=t.attribute.dx)&&void 0!==r?r:0)+o-l}):t.setAttributes({x:o,textAlign:"left"})),u>a&&(e.attribute.angle?e.setAttributes({dx:(null!==(s=e.attribute.dx)&&void 0!==s?s:0)+a-u}):e.setAttributes({x:a,textAlign:"right"}))}else{const t=c?d:h,e=c?h:d,o=t.AABBBounds.y2,r=e.AABBBounds.y1,s=i.y,u=n.y;r<s&&(e.attribute.angle?e.setAttributes({dy:(null!==(a=e.attribute.dy)&&void 0!==a?a:0)+s-r}):e.setAttributes({y:s,textBaseline:"top"})),o>u&&(t.attribute.angle?t.setAttributes({dy:(null!==(l=t.attribute.dy)&&void 0!==l?l:0)+u-o}):t.setAttributes({y:u,textBaseline:"bottom"}))}}}handleLabelsOverlap(t,e,i,n,o){if(_t(t))return;const{verticalLimitSize:r,label:s,orient:a}=this.attribute,l=this._getAxisLabelLimitLength(r,o),{layoutFunc:h,autoRotate:d,autoRotateAngle:c,autoLimit:u,limitEllipsis:g,autoHide:p,autoHideMethod:f,autoHideSeparation:v,lastVisible:b,firstVisible:m,autoWrap:y,overflowLimitLength:C}=s;if(ot(h))h(t,e,n,this);else{if(d)!function(t,e){if(_t(t))return;const{orient:i,labelRotateAngle:n=[0,45,90]}=e;if(0===n.length||t.some((t=>!!t.attribute.angle)))return;let o=0,r=0;for(n&&n.length>0&&(r=n.length);o<r;){const e=n[o++];if(t.forEach((t=>{t.attribute.angle=be(e)})),iy(i,t),!ey(t))break}}(t,{labelRotateAngle:c,orient:a});else if(y){!function(t,e){const{limitLength:i,axisLength:n,ellipsis:o="...",orient:r}=e;if(_t(t)||!vt(i))return;const s=t[0].attribute.angle,a=Um(s),l=Vm(s),h="top"===r||"bottom"===r;let d=n/t.length;t.forEach(((e,n)=>{var r,s,c,u,g;if(h){if(l&&Math.floor(e.AABBBounds.height())<=i)return;if(a){const i=ay(e.attribute.x,null===(r=t[n+1])||void 0===r?void 0:r.attribute.x,null===(s=t[n-1])||void 0===s?void 0:s.attribute.x);vt(i)&&(d=he(d,i))}}else{if(l){const i=ay(e.attribute.y,null===(c=t[n+1])||void 0===c?void 0:c.attribute.y,null===(u=t[n-1])||void 0===u?void 0:u.attribute.y);vt(i)&&(d=he(d,i))}if(a&&Math.floor(e.AABBBounds.width())<=i)return}let p=null,f=null;h?l?(p=i,f=d):(p=d,f=i):l?(p=d,f=i):(p=i,f=d),e.setAttributes({maxLineWidth:p,ellipsis:null!==(g=e.attribute.ellipsis)&&void 0!==g?g:o,whiteSpace:"normal",heightLimit:f})}))}(t,{orient:a,limitLength:l,axisLength:"left"===a||"right"===a?Math.abs(this.attribute.start.y-this.attribute.end.y):Math.abs(this.attribute.start.x-this.attribute.end.x),ellipsis:g})}if(!y&&u&&vt(l)&&l>0){const e="left"===a||"right"===a,i=e?Math.abs(this.attribute.start.y-this.attribute.end.y):Math.abs(this.attribute.start.x-this.attribute.end.x);sy(t,{limitLength:l,verticalLimitLength:e?i/t.length:p||d?1/0:i/t.length,ellipsis:g,orient:a,axisLength:i,overflowLimitLength:C})}p&&function(t,e){if(_t(t))return;const i=t.filter(Qm);if(_t(i))return;let n;n=function(t){return t.forEach((t=>t.setAttribute("opacity",1))),t}(i);const{method:o="parity",separation:r=0}=e,s=ot(o)?o:Jm[o]||Jm.parity;if(n.length>=3&&qm(n,r)){do{n=s(n,r)}while(n.length>=3&&qm(n,r));const t=function(t,e){return(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&t<3||e},o=t(n.length,e.firstVisible,!1);let a=t(n.length,e.lastVisible);const l=i[0],h=Ht(i);Km(l,h,r)&&o&&a&&(h.setAttribute("opacity",0),a=!1),ty(l,n,o,(t=>Km(t,l,r))),ty(h,n,a,(t=>Km(t,h,r)||!(!o||t===l)&&Km(t,l,r)),!0)}i.forEach((t=>{t.setAttribute("visible",!!t.attribute.opacity)}))}(t,{orient:a,method:f,separation:v,lastVisible:b,firstVisible:m})}}afterLabelsOverlap(t,e,i,n,o){const{verticalLimitSize:r,orient:s}=this.attribute,a="bottom"===s||"top"===s,l=i.AABBBounds;let h=a?l.height():l.width();const{verticalMinSize:d}=this.attribute;if(vt(d)&&(!vt(r)||d<=r)){const t=this._getAxisLabelLimitLength(d,o);let e,n;h=Math.max(h,t),"left"===s?(e=l.x2-h,n=l.y1):"right"===s?(e=l.x1,n=l.y1):"top"===s?(e=l.x1,n=l.y2-h):"bottom"===s&&(e=l.x1,n=l.y1);const r=_h.rect({x:e,y:n,width:a?l.width():h,height:a?h:l.height(),pickable:!1});r.name=zm.axisLabelBackground,r.id=this._getNodeId("axis-label-background"),i.insertBefore(r,i.firstChild)}if(st(this.attribute.label.containerAlign)){let e;"left"===s?e=l.x2-h:"right"===s?e=l.x1:"top"===s?e=l.y2-h:"bottom"===s&&(e=l.y1),function(t,e,i,n,o){"left"===n||"right"===n?"left"===o?t.forEach((t=>{var i;t.setAttributes({dx:(null!==(i=t.attribute.dx)&&void 0!==i?i:0)+e-t.AABBBounds.x1})})):"right"===o?t.forEach((t=>{var n;t.setAttributes({dx:(null!==(n=t.attribute.dx)&&void 0!==n?n:0)+e+i-t.AABBBounds.x2})})):"center"===o&&t.forEach((t=>{var n;t.setAttributes({dx:(null!==(n=t.attribute.dx)&&void 0!==n?n:0)+e+i/2-(t.AABBBounds.x1+t.AABBBounds.x2)/2})})):"bottom"!==n&&"top"!==n||("top"===o?t.forEach((t=>{var i;t.setAttributes({dy:(null!==(i=t.attribute.dy)&&void 0!==i?i:0)+e-t.AABBBounds.y1})})):"bottom"===o?t.forEach((t=>{var n;t.setAttributes({dy:(null!==(n=t.attribute.dy)&&void 0!==n?n:0)+e+i-t.AABBBounds.y2})})):"middle"===o&&t.forEach((t=>{var n;t.setAttributes({dy:(null!==(n=t.attribute.dy)&&void 0!==n?n:0)+e+i/2-(t.AABBBounds.y1+t.AABBBounds.y2)/2})})))}(t,e,h,s,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(t,e){var i,n,o,r,s;const{label:a,title:l,line:h,tick:d}=this.attribute,c=null!==(i=a.space)&&void 0!==i?i:4;let u=t,g=0,p=0;const f=h&&h.visible?null!==(n=h.style.lineWidth)&&void 0!==n?n:1:0,v=d&&d.visible?null!==(o=d.length)&&void 0!==o?o:4:0;if(l&&l.visible&&"string"==typeof l.text){g=gm(l.text,l.textStyle,null===(s=null===(r=this.stage)||void 0===r?void 0:r.getTheme())||void 0===s?void 0:s.text).height;const t=ti(l.padding);p=l.space+t[0]+t[2]}return u&&(u=(u-c-p-g-f-v)/e),u}release(){super.release(),this._breaks=null}}hy.defaultAttributes=Nm,function(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t="prototype"in t?t.prototype:t,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames){const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o++){const r=n[o];"constructor"!==r&&(i?null!=e[r]:null==t[r])&&(t[r]=e[r])}}else Pt(t,e,i)}(hy,class{isInValidValue(t){return t<0||t>1}getTickCoord(t){const{start:e}=this.attribute,i=this.getRelativeVector();return{x:e.x+i[0]*t,y:e.y+i[1]*t}}getRelativeVector(t){const{start:e,end:i}=this.attribute;return[i.x-e.x,i.y-e.y]}getVerticalVector(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{verticalFactor:i=1}=this.attribute,n=function(t){let e=dm(t);return e>0&&(e=1/e),[t[0]*e,t[1]*e]}(this.getRelativeVector());return hm([n[1],-1*n[0]],t*(e?1:-1)*i)}});const dy=t=>t.map(((t,e)=>({index:e,value:t}))),cy=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=new Fe(t).expand(i/2),o=new Fe(e).expand(i/2);return n.intersects(o)},uy=(t,e,i,n)=>i<t?Math.max(t-e/2,i):i>t?Math.min(t-e/2,i-e):i<n?i:i-e,gy=(t,e,i)=>{var n,o,r;const{labelStyle:s,axisOrientType:a,labelFlush:l,labelFormatter:h,startAngle:d=0}=i;let c=null!==(n=s.angle)&&void 0!==n?n:0;"vertical"===s.direction&&(c+=be(90));const u=["bottom","top"].includes(a),g=["left","right"].includes(a);let p=1,f=0;u||(g?(p=0,f=1):d&&(p=Math.cos(d),f=-Math.sin(d)));const v=um(s),b=t.range();let m=[];for(let i=0;i<e.length;i++){const n=e[i],a=h?h(n):`${n}`;if(ht(a)){m=void 0;break}const{width:d,height:y}=v.quickMeasure(a),C=Math.max(d,12),w=Math.max(y,12),x=t.scale(n),_=p*x,S=f*x;let A,B,T=_,R=S;l&&u&&0===i?T=uy(_,C,b[0],b[b.length-1]):l&&u&&i===e.length-1?T=uy(_,C,b[b.length-1],b[0]):A=null!==(o=s.textAlign)&&void 0!==o?o:"center","right"===A?T-=C:"center"===A&&(T-=C/2),l&&g&&0===i?R=uy(S,w,b[0],b[b.length-1]):l&&g&&i===e.length-1?R=uy(S,w,b[b.length-1],b[0]):B=null!==(r=s.textBaseline)&&void 0!==r?r:"middle","bottom"===B?R-=w:"middle"===B&&(R-=w/2);const k=(new Fe).set(T,R,T+C,R+w);c&&k.rotate(c,_,S),m.push(k)}return m};var py;function fy(t){switch(t){case py.Linear:case py.Log:case py.Pow:case py.Sqrt:case py.Symlog:case py.Time:return!0;default:return!1}}function vy(t){return t}function by(t,e){if(t=Number(t),e=Number(e),e-=t)return i=>(i-t)/e;const i=Number.isNaN(e)?NaN:.5;return()=>i}function my(t,e,i){const n=t[0],o=t[1],r=e[0],s=e[1];let a,l;return o<n?(a=by(o,n),l=i(s,r)):(a=by(n,o),l=i(r,s)),t=>l(a(t))}function yy(t,e,i){const n=Math.min(t.length,e.length)-1,o=new Array(n),r=new Array(n);let s=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<n;)o[s]=by(t[s],t[s+1]),r[s]=i(e[s],e[s+1]);return function(e){const i=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;for(rt(n)&&(n=t.length);i<n;){const o=i+n>>>1;Dt(t[o],e)>0?n=o:i=o+1}return i}(t,e,1,n)-1;return r[i](o[i](e))}}!function(t){t.Identity="identity",t.Linear="linear",t.Log="log",t.Pow="pow",t.Sqrt="sqrt",t.Symlog="symlog",t.Time="time",t.Quantile="quantile",t.Quantize="quantize",t.Threshold="threshold",t.Ordinal="ordinal",t.Point="point",t.Band="band"}(py||(py={})),Object.values(py).forEach((t=>{}));let Cy=class{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:st(this._rangeFactorStart)&&st(this._rangeFactorEnd)&&2===t.length?(this._wholeRange=function(t,e){const i=(t[1]-t[0])/(e[1]-e[0]),n=t[0]-i*e[0];return[n,i+n]}(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(2===t.length&&t.every((t=>t>=0&&t<=1))&&(this._wholeRange=null,0===t[0]&&1===t[1]?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):st(this._rangeFactorStart)&&st(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return rt(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!rt(this._rangeFactorEnd)&&1!==this._rangeFactorEnd?(this._rangeFactorStart=t,this._rangeFactorEnd=null!==(i=this._rangeFactorEnd)&&void 0!==i?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return rt(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!rt(this._rangeFactorStart)&&0!==this._rangeFactorStart?(this._rangeFactorEnd=t,this._rangeFactorStart=null!==(i=this._rangeFactorStart)&&void 0!==i?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:n}=this._fishEyeOptions,o=this.range(),r=o[0],s=o[o.length-1],a=Math.min(r,s),l=Math.max(r,s),h=$t(null!==(t=this._fishEyeOptions.focus)&&void 0!==t?t:0,a,l),d=rt(n)?(l-a)*i:n;let c=Math.exp(e);c=c/(c-1)*d;const u=e/d;this._fishEyeTransform=t=>{const e=Math.abs(t-h);if(e>=d)return t;if(e<=1e-6)return h;const i=c*(1-Math.exp(-e*u))/e*.75+.25;return h+(t-h)*i}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return null!==(i=null==this?void 0:this[t])&&void 0!==i?i:e}};const{interpolateRgb:wy}=Qe;function xy(t,e){const i=typeof e;let n;if(rt(e)||"boolean"===i)return()=>e;if("number"===i)return Jt(t,e);if("string"===i){if(n=Ze.parseColorString(e)){const e=wy(Ze.parseColorString(t),n);return t=>e(t).formatRgb()}return Jt(Number(t),Number(e))}return e instanceof Je?wy(t,e):e instanceof Ze?wy(t.color,e.color):e instanceof Date?function(t,e){const i=t.valueOf(),n=e.valueOf(),o=new Date;return t=>(o.setTime(i*(1-t)+n*t),o)}(t,e):Jt(Number(t),Number(e))}let _y=class extends Cy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vy,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vy;super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=vy,this._piecewise=my,this._interpolate=xy}calculateVisibleDomain(t){var e;return st(this._rangeFactorStart)&&st(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:null!==(e=this._niceDomain)&&void 0!==e?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),Jt)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return(null!==(i=this._niceDomain)&&void 0!==i?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const n=Array.from(t,Wt);return this._domain=n,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=Qt,this.rescale(e)}rescale(t){var e;if(t)return this;const i=null!==(e=this._niceDomain)&&void 0!==e?e:this._domain,n=i.length,o=this._range.length;let r=Math.min(n,o);if(n&&n<o&&this._forceAlign){const t=o-n+1,e=i[n-1],s=n>=2?(e-i[n-2])/t:0;for(let o=1;o<=t;o++)i[n-2+o]=e-s*(t-o);r=o}return this._autoClamp&&(this._clamp=function(t,e){let i;return t>e&&(i=t,t=e,e=i),i=>Math.max(t,Math.min(e,i))}(i[0],i[r-1])),this._piecewise=r>2?yy:my,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:vy),this.rescale(i)):this._clamp!==vy}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(){return[]}tickData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.ticks(t);return(null!=e?e:[]).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0])/(this._range[1]-this._range[0])})))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return rt(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return rt(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}};const Sy=Math.sqrt(50),Ay=Math.sqrt(10),By=Math.sqrt(2),Ty=[1,2,5,10],Ry=(t,e,i)=>{let n=1,o=t;const r=Math.floor((e-1)/2),s=Math.abs(t);return t>=0&&t<=Number.MIN_VALUE?o=0:t<0&&t>=-Number.MIN_VALUE?o=-(e-1):!i&&s<1?n=Py(s).step:(i||s>1)&&(o=Math.floor(t)-r*n),n>0?(t>0?o=Math.max(o,0):t<0&&(o=Math.min(o,-(e-1)*n)),function(t,e,i){st(e)||(e=t,t=0),st(i)||(i=1);let n=-1;const o=0|Math.max(0,Math.ceil((e-t)/i)),r=new Array(o);for(;++n<o;)r[n]=t+n*i;return r}(0,e).map((t=>o+t*n))):t>0?My(0,-(e-1)/n,n):My((e-1)/n,0,n)},ky=Xt(((t,e,i,n)=>{let o,r,s,a,l=-1;if(i=+i,(t=+t)==(e=+e))return[t];if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return[t];if((o=e<t)&&(r=t,t=e,e=r),a=Ey(t,e,i).step,!isFinite(a))return[];if(a>0){let i=Math.round(t/a),n=Math.round(e/a);for(i*a<t&&++i,n*a>e&&--n,s=new Array(r=n-i+1);++l<r;)s[l]=(i+l)*a}else if(a<0&&(null==n?void 0:n.noDecimals)){a=1;const i=Math.ceil(t),n=Math.floor(e);if(!(i<=n))return[];for(s=new Array(r=n-i+1);++l<r;)s[l]=i+l}else{a=-a;let i=Math.round(t*a),n=Math.round(e*a);for(i/a<t&&++i,n/a>e&&--n,s=new Array(r=n-i+1);++l<r;)s[l]=(i+l)/a}return o&&s.reverse(),s})),My=(t,e,i)=>{let n,o,r=-1;if(i>0){let s=Math.floor(t/i),a=Math.ceil(e/i);for((s+1)*i<t&&++s,(a-1)*i>e&&--a,o=new Array(n=a-s+1);++r<n;)o[r]=(s+r)*i}else{i=-i;let s=Math.floor(t*i),a=Math.ceil(e*i);for((s+1)/i<t&&++s,(a-1)/i>e&&--a,o=new Array(n=a-s+1);++r<n;)o[r]=(s+r)/i}return o},Ly=Xt(((t,e,i,n)=>{let o,r,s;if(i=+i,(t=+t)==(e=+e))return Ry(t,i,null==n?void 0:n.noDecimals);if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return Ry(t,i,null==n?void 0:n.noDecimals);(o=e<t)&&(s=t,t=e,e=s);const a=Ey(t,e,i);let l=a.step;if(!isFinite(l))return[];if(l>0){let n=1;const{power:o,gap:s}=a,h=10===s?2*10**o:1*10**o;for(;n<=5&&(r=My(t,e,l),r.length>i+1)&&i>2;)l+=h,n+=1;i>2&&r.length<i-1&&(r=((t,e,i)=>{let n;const o=t[0],r=t[t.length-1],s=e-t.length;if(r<=0){const e=[];for(n=s;n>=1;n--)e.push(o-n*i);return e.concat(t)}if(o>=0){for(n=1;n<=s;n++)t.push(r+n*i);return t}let a=[];const l=[];for(n=1;n<=s;n++)n%2==0?a=[o-Math.floor(n/2)*i].concat(a):l.push(r+Math.ceil(n/2)*i);return a.concat(t).concat(l)})(r,i,l))}else(null==n?void 0:n.noDecimals)&&l<0&&(l=1),r=My(t,e,l);return o&&r.reverse(),r})),Py=t=>{const e=Math.floor(Math.log(t)/Math.LN10),i=t/10**e;let n=Ty[0];return i>=Sy?n=Ty[3]:i>=Ay?n=Ty[2]:i>=By&&(n=Ty[1]),e>=0?{step:n*10**e,gap:n,power:e}:{step:-(10**-e)/n,gap:n,power:e}};function Ey(t,e,i){const n=(e-t)/Math.max(0,i);return Py(n)}function Hy(t,e,i){let n;if(i=+i,(t=+t)==(e=+e)&&i>0)return[t];if(i<=0||0===(n=function(t,e,i){return(e-t)/Math.max(1,i-1)}(t,e,i))||!isFinite(n))return[];const o=new Array(i);for(let e=0;e<i;e++)o[e]=t+e*n;return o}function Oy(t){let e,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,o=0,r=t.length-1,s=t[o],a=t[r],l=10;for(a<s&&(i=s,s=a,a=i,i=o,o=r,r=i);l-- >0;){if(i=Ey(s,a,n).step,i===e)return t[o]=s,t[r]=a,t;if(i>0)s=Math.floor(s/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;s=Math.ceil(s*i)/i,a=Math.floor(a*i)/i}e=i}}let Iy=class t extends _y{constructor(){super(...arguments),this.type=py.Linear}clone(){var e;const i=new t;return i.domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate),this._niceType&&(i._niceType=this._niceType,i._domainValidator=this._domainValidator,i._niceDomain=null===(e=this._niceDomain)||void 0===e?void 0:e.slice()),i}tickFormat(){return()=>{}}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.calculateVisibleDomain(this._range);return ky(i[0],i[i.length-1],t,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i;if(ot(null==e?void 0:e.customTicks))return e.customTicks(this,t);if(st(this._rangeFactorStart)&&st(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&2===this._range.length||!this._niceType)return this.d3Ticks(t,e);const n=null!==(i=this._niceDomain)&&void 0!==i?i:this._domain,o=this._domain,r=n[0],s=n[n.length-1];let a=Ly(o[0],o[o.length-1],t,e);if(!a.length)return a;if(this._domainValidator)a=a.filter(this._domainValidator);else if((a[0]!==r||a[a.length-1]!==s)&&this._niceType){const t=n.slice();if("all"===this._niceType?(t[0]=a[0],t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()):"min"===this._niceType&&a[0]!==r?(t[0]=a[0],this._niceDomain=t,this.rescale()):"max"===this._niceType&&a[a.length-1]!==s&&(t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()),"all"!==this._niceType){const e=Math.min(t[0],t[t.length-1]),i=Math.max(t[0],t[t.length-1]);a=a.filter((t=>t>=e&&t<=i))}}return a}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return Hy(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){let n,o,r=-1;if(i=+i,(o=(e=+e)<(t=+t))&&(n=t,t=e,e=n),!isFinite(i)||e-t<=i)return[t];const s=Math.floor((e-t)/i+1),a=new Array(s);for(;++r<s;)a[r]=t+r*i;return o&&a.reverse(),a}(e[0],e[e.length-1],t)}nice(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i,n;const o=this._domain;let r=[];if(e){const t=function(t,e){const i=ft(e.forceMin),n=ft(e.forceMax);let o=null;const r=[];let s=null;const a=i&&n?t=>t>=e.forceMin&&t<=e.forceMax:i?t=>t>=e.forceMin:n?t=>t<=e.forceMax:null;return i?r[0]=e.forceMin:ft(e.min)&&e.min<=Math.min(t[0],t[t.length-1])&&(r[0]=e.min),n?r[1]=e.forceMax:ft(e.max)&&e.max>=Math.max(t[0],t[t.length-1])&&(r[1]=e.max),ft(r[0])&&ft(r[1])?(s=t.slice(),s[0]=r[0],s[s.length-1]=r[1]):o=ft(r[0])||ft(r[1])?ft(r[0])?"max":"min":"all",{niceType:o,niceDomain:s,niceMinMax:r,domainValidator:a}}(o,e);if(r=t.niceMinMax,this._domainValidator=t.domainValidator,this._niceType=t.niceType,t.niceDomain)return this._niceDomain=t.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const e=Oy(o.slice(),t);"min"===this._niceType?e[e.length-1]=null!==(i=r[1])&&void 0!==i?i:e[e.length-1]:"max"===this._niceType&&(e[0]=null!==(n=r[0])&&void 0!==n?n:e[0]),this._niceDomain=e,this.rescale()}return this}niceMin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="min";const e=this._domain[this._domain.length-1],i=Oy(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="max";const e=this._domain[0],i=Oy(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}};function Fy(t,e,i,n){let o;const{breakData:r}=t;if(r&&r()){const{breakDomains:t}=r(),s=e.domain();o=[];for(let e=0;e<s.length-1;e++)n(i,[s[e],s[e+1]]).forEach((e=>{t.some((t=>e>=t[0]&&e<=t[1]))||o.push(e)}));e.domain(s)}else o=n(i);return o}function zy(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(i&&!e.includes(t)){let i=e.length;if(i>1){o?e.push(t):e.unshift(t);for(let t=0;t<i;t++){const r=o?i-1-t:t;if(!n(e[r]))break;e.splice(r,1),t--,i--}}}}const Dy={parity:function(t){return t.filter(((t,e)=>e%2==0))},greedy:function(t,e){let i;return t.filter(((t,n)=>!(n&&Km(i,t,e)||(i=t,0))))}},Wy=(t,e,i,n)=>{const o=gy(t,e,i);return o&&o.map((t=>n?[t.x1,t.x2,t.width()]:[t.y1,t.y2,t.height()]))},Ny=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.max(t[0],e[0])-i/2<=Math.min(t[1],e[1])+i/2},Gy=(t,e)=>t[1]<e[0]?e[0]-t[1]:e[1]<t[0]?t[0]-e[1]:0,jy=(t,e,i,n,o,r)=>{let s=0,a=0,l=-1,h=Number.MAX_VALUE;const d=n=>{let o=!0,r=0;do{r+n<t.length&&Ny(e[r],e[r+n],i)&&(o=!1),r+=n}while(o&&r<t.length);return o},c=((t,e,i)=>{let n=t,o=e;for(;n<o;){const t=Math.floor((n+o)/2);i(t)>=0?o=t:n=t+1}return n})(o,t.length,(t=>d(t)?1:-1));let u=c;do{if(u>c&&!r&&!d(u))u++;else{if(!n){a=u;break}{const n=t.length-1;let o,r=0;o=t.length%u>0?t.length-t.length%u+u:t.length;do{if(o-=u,o!==n&&!Ny(e[o],e[n],i))break;r++}while(o>0);if(o===n){a=u,s=r;break}{const i=Math.floor(t.length/u)-r+1;if(i<l)break;{l=i;const t=Gy(e[o],e[n]),d=o-u>=0?Gy(e[o-u],e[o]):t,c=Math.abs(t-d);if(c<h&&(h=c,a=u,s=r),t<=d)break}}}u++}}while(u<=t.length);return{step:a,delCount:s}},Vy=(t,e)=>{const{tickCount:i,forceTickCount:n,tickStep:o,getRadius:r,labelOffset:s,labelGap:a=0,labelStyle:l}=e,h=null==r?void 0:r();if(!h)return dy(t.domain());let d;if(st(o))d=t.stepTicks(o);else if(st(n))d=t.forceTicks(n);else if(st(i)){const e=t.range(),n=Math.abs(e[e.length-1]-e[0]),o=ot(i)?i({axisLength:n,labelStyle:l}):i;d=t.ticks(o)}else if(e.sampling){const i=t.domain(),n=t.range(),o=((t,e,i)=>{var n;const{labelStyle:o,getRadius:r,labelOffset:s,labelFormatter:a,inside:l}=i,h=null==r?void 0:r(),d=null!==(n=o.angle)&&void 0!==n?n:0,c=um(o);return e.map((e=>{const i=a?a(e):`${e}`,{width:n,height:r}=c.quickMeasure(i),u=Math.max(n,12),g=Math.max(r,12),p=t.scale(e),f={x:0,y:0};let v=0,b=0;const m={align:o.textAlign,baseline:o.textBaseline},{x:y,y:C}=Ym(p,f,h,s,l);return m.align||(Ut(y,f.x)?m.baseline||(m.baseline=C>f.y?"top":"bottom"):y>f.x?m.align="left":y<f.x&&(m.align="right")),v=y+("right"===m.align?-u:"left"===m.align?0:-u/2),b=C+("bottom"===m.baseline?-g:"top"===m.baseline?0:-g/2),(new Fe).set(v,b,v+u,b+g).rotate(d,v+u/2,b+g/2)}))})(t,i,e),r=It(n),l=Ot(n),c=Math.abs(l-r)*(h+s)/i.length,{step:u,delCount:g}=Uy(i,o,a,Math.floor(o.reduce(((t,e)=>Math.min(t,e.width(),e.height())),Number.MAX_VALUE)/c));d=t.stepTicks(u),d=d.slice(0,d.length-g)}else d=t.domain();return dy(d)},Uy=(t,e,i,n)=>{let o=n;do{let n=!0;o++;let r=0;do{r+o<t.length&&cy(e[r],e[r+o],i)&&(n=!1),r+=o}while(n&&r<t.length);if(n)break}while(o<=t.length);let r=0;if(t.length>2){let i=t.length-t.length%o;for(i>=t.length&&(i-=o);i>0&&cy(e[0],e[i]);)r++,i-=o}return{step:o,delCount:r}},Xy=(t,e)=>{if(fy(t.type))return((t,e)=>{var i,n,o,r;if(!fy(t.type))return dy(t.domain());const s=t.range(),a=Math.abs(s[s.length-1]-s[0]);if(a<2)return dy([t.domain()[0]]);const{tickCount:l,forceTickCount:h,tickStep:d,noDecimals:c=!1,labelStyle:u,breakData:g}=e;let p;if(st(d))f=t.stepTicks(d),v=g&&g()?g().breakDomains:null,p=v&&v.length?f.filter((t=>v.every((e=>t<e[0]||t>e[1])))):f;else if(st(h))p=Fy(e,t,h,((e,i)=>i&&i.length?t.domain(i,!0).forceTicks(e):t.forceTicks(e)));else if("d3"===e.tickMode){const n=null!==(i=ot(l)?l({axisLength:a,labelStyle:u}):l)&&void 0!==i?i:5;p=Fy(e,t,n,((e,i)=>i&&i.length?t.domain(i,!0).d3Ticks(e,{noDecimals:c}):t.d3Ticks(e,{noDecimals:c})))}else{const i=null!==(n=ot(l)?l({axisLength:a,labelStyle:u}):l)&&void 0!==n?n:5,o=ot(e.tickMode)?e.tickMode:void 0;p=Fy(e,t,i,((e,i)=>i&&i.length?t.domain(i,!0).ticks(e,{noDecimals:c,customTicks:o}):t.ticks(e,{noDecimals:c,customTicks:o})))}var f,v;const b=t.domain();if(e.labelFirstVisible&&b[0]!==p[0]&&!p.includes(b[0])&&p.unshift(b[0]),e.labelLastVisible&&b[b.length-1]!==p[p.length-1]&&!p.includes(b[b.length-1])&&p.push(b[b.length-1]),e.sampling&&p.length>1&&("cartesian"===e.coordinateType||"polar"===e.coordinateType&&"radius"===e.axisOrientType)){const{labelGap:i=4,labelFlush:n}=e,s=6;let l;if(p.length*s>a){const i=[],n=Math.floor(p.length*s/a);p.forEach(((t,e)=>{e%n!=0&&e!==p.length-1||i.push(t)})),l=null===(o=gy(t,i,e))||void 0===o?void 0:o.map(((t,e)=>({AABBBounds:t,value:i[e]})))}else l=null===(r=gy(t,p,e))||void 0===r?void 0:r.map(((t,e)=>({AABBBounds:t,value:p[e]})));if(l){const t=l[0],o=Ht(l),r=g&&g()?Dy.greedy:Dy.parity;for(;l.length>=3&&qm(l,i);)l=r(l,i);const s=e.labelFirstVisible;let a=e.labelLastVisible;Km(t,o,i)&&l.includes(o)&&l.length>1&&s&&a&&(l.splice(l.indexOf(o),1),a=!1),zy(t,l,s,(e=>Km(e,t,i))),zy(o,l,a,(e=>Km(e,o,i)||!(!s||e===t)&&Km(e,t,i)),!0);const h=l.map((t=>t.value));h.length<3&&n&&(h.length>1&&h.pop(),Ht(h)!==Ht(p)&&h.push(Ht(p))),p=h}}return dy(p)})(t,e);if(function(t){switch(t){case py.Ordinal:case py.Point:case py.Band:return!0;default:return!1}}(t.type)){if("cartesian"===e.coordinateType)return((t,e)=>{var i;const n=t.domain();if(!n.length)return[];const{tickCount:o,forceTickCount:r,tickStep:s,labelGap:a=4,axisOrientType:l,labelStyle:h}=e,d=(t=>["bottom","top","z"].includes(t))(l),c=t.range(),u=t.calculateWholeRangeSize();if(u<2)return e.labelLastVisible?dy([n[n.length-1]]):dy([n[0]]);let g;if(st(s))g=t.stepTicks(s);else if(st(r))g=t.forceTicks(r);else if(st(o)){const e=ot(o)?o({axisLength:u,labelStyle:h}):o;g=t.ticks(e)}else if(e.sampling){const o=(null!==(i=e.labelStyle.fontSize)&&void 0!==i?i:12)+2,r=It(c),s=Ot(c);if(n.length<=u/o){const i=Wy(t,n,e,d);if(i){const o=Math.min(...i.map((t=>t[2]))),l=(s-r)/n.length,h=jy(n,i,a,e.labelLastVisible,Math.floor(o/l),!1);g=t.stepTicks(h.step),e.labelLastVisible&&(h.delCount&&(g=g.slice(0,g.length-h.delCount)),g.push(n[n.length-1]))}}else{const i=[n[0],n[Math.floor(n.length/2)],n[n.length-1]],o=Wy(t,i,e,d);if(o){let i=null;o.forEach((t=>{i?i[2]<t[2]&&(i=t):i=t}));const l=s-r-a>0?Math.ceil(n.length*(a+i[2])/(s-r-a)):n.length-1;g=t.stepTicks(l),!e.labelLastVisible||g.length&&g[g.length-1]===n[n.length-1]||(g.length&&Math.abs(t.scale(g[g.length-1])-t.scale(n[n.length-1]))<i[2]&&(g=g.slice(0,-1)),g.push(n[n.length-1]))}}}return rt(g)&&(g=t.domain()),dy(g)})(t,e);if("polar"===e.coordinateType&&"angle"===e.axisOrientType)return Vy(t,e)}return dy(t.domain())};function $y(){Eb(),Kb(),Zb()}const Yy={space:8,style:{fill:"rgb(47, 69, 84)",cursor:"pointer",size:15},state:{disable:{fill:"rgb(170, 170, 170)",cursor:"not-allowed"},hover:{}}};$y();class Ky extends Og{getCurrent(){return this._current}constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Lt({},Ky.defaultAttributes,t)),this.name="pager",this._current=1,this._onHover=t=>{const e=t.target;e.hasState("disable")||e.addState("hover")},this._onUnHover=t=>{t.target.removeState("hover")},this._onClick=t=>{const e=t.target;if("preHandler"===e.name){if(1===this._current)return;this._current-=1,1===this._current?e.addState("disable"):e.removeState("disable"),this._dispatchEvent("toPrev",{current:this._current,total:this._total,direction:"pre",event:t})}if("nextHandler"===e.name){if(this._current===this._total)return;this._current+=1,this._current===this._total?e.addState("disable"):e.removeState("disable"),this._dispatchEvent("toNext",{current:this._current,total:this._total,direction:"next",event:t})}this._current>1&&this.preHandler.removeState("disable"),this._current<this._total&&this.nextHandler.removeState("disable"),this.text.setAttribute("text",this._getPageText(this._current))}}render(){var t,e,i;this._reset();const{layout:n="horizontal",handler:o=Yy,total:r,defaultCurrent:s=1,textStyle:a,padding:l=0}=this.attribute;this._current=s;const h=ti(l),d="horizontal"===n,c=_h.group({x:0,y:0}),u=o.style||{},g=u.size||15,p=null!==(t=o.space)&&void 0!==t?t:8,f=o.state||{};let{preShape:v,nextShape:b}=o;v||(v=d?"triangleLeft":"triangleUp"),b||(b=d?"triangleRight":"triangleDown");const m=_h.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},u),{x:0,y:0,symbolType:v,size:g}));m.states=f,m.name="preHandler",this.preHandler=m,c.add(m);const{width:y,height:C}=gm(this._getPageText(r),Object.assign({textAlign:"center",textBaseline:"middle"},a),null===(i=null===(e=this.stage)||void 0===e?void 0:e.getTheme())||void 0===i?void 0:i.text),w=ft(g)?g:g[0],x=ft(g)?g:g[1],_=_h.text(Object.assign({x:d?w/2+p+y/2:0,y:d?0:x/2+p+C/2,text:this._getPageText(s),textAlign:"center",textBaseline:"middle",lineHeight:null==a?void 0:a.fontSize},a));this.text=_,c.add(_);const S=_h.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},u),{x:d?w+2*p+y:0,y:d?0:x+2*p+C,symbolType:b,size:g}));S.name="nextHandler",S.states=f,this.nextHandler=S,c.add(S),1===this._total?(m.addState("disable"),S.addState("disable")):1===this._current?m.addState("disable"):this._current===r&&S.addState("disable");const A=c.AABBBounds,B=A.width(),T=A.height();c.translateTo(0-A.x1+h[3],0-A.y1+h[0]),this.add(c),this.attribute.width=B+h[1]+h[3],this.attribute.height=T+h[0]+h[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener("pointerenter",this._onHover),this.preHandler.addEventListener("pointerleave",this._onUnHover),this.preHandler.addEventListener("pointerdown",this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener("pointerenter",this._onHover),this.nextHandler.addEventListener("pointerleave",this._onUnHover),this.nextHandler.addEventListener("pointerdown",this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(t){const{pageFormatter:e}=this.attribute;return e?ot(e)?e(t,this._total):`${e}`.replace("{current}",`${t}`).replace("{total}",`${this._total}`):`${t}/${this._total}`}setTotal(t){t!==this.attribute.total&&(this._total=t,1!==this._current&&this._current<=t?this.setAttributes({total:t,defaultCurrent:this._current}):this.setAttribute("total",t))}}Ky.defaultAttributes={handler:Yy,textStyle:{fill:"rgb(51, 51, 51)",fontSize:12}};const qy=16,Zy=8,Jy=12;var Qy,tC,eC;!function(t){t.selected="selected",t.unSelected="unSelected",t.selectedHover="selectedHover",t.unSelectedHover="unSelectedHover",t.focus="focus"}(Qy||(Qy={})),function(t){t.legendItemHover="legendItemHover",t.legendItemUnHover="legendItemUnHover",t.legendItemClick="legendItemClick",t.legendItemAttributeUpdate="legendItemAttributeUpdate"}(tC||(tC={})),function(t){t.innerView="innerView",t.title="legendTitle",t.item="legendItem",t.itemShape="legendItemShape",t.itemLabel="legendItemLabel",t.itemValue="legendItemValue",t.focus="legendItemFocus"}(eC||(eC={}));class iC extends Og{constructor(){super(...arguments),this.name="legend",this._title=null}render(){this.removeAllChild(!0);const{interactive:t=!0,title:e,padding:i=0}=this.attribute;this._parsedPadding=ti(i);const n=_h.group({x:this._parsedPadding[3],y:this._parsedPadding[0],pickable:t,childrenPickable:t});n.name=eC.innerView,this.add(n),this._innerView=n,(null==e?void 0:e.visible)&&this._renderTitle(e),this._renderContent(),this._adjustLayout(),t&&this._bindEvents();const o=this._innerView.AABBBounds;this.attribute.width=o.width()+this._parsedPadding[1]+this._parsedPadding[3],this.attribute.height=o.height()+this._parsedPadding[0]+this._parsedPadding[2]}_renderTitle(t){const{text:e="",textStyle:i,padding:n=0,background:o,minWidth:r,maxWidth:s,shape:a}=t,l={x:0,y:0,text:e,textStyle:i,padding:ti(n),minWidth:r,maxWidth:s};a&&a.visible&&(l.shape=Object.assign({visible:!0},a.style),st(a.space)&&(l.space=a.space)),o&&o.visible&&(l.panel=Object.assign({visible:!0},o.style));const h=new ym(l);h.name=eC.title,this._title=h,this._innerView.add(h)}_adjustLayout(){var t;if(this._title){const e=this._innerView.AABBBounds.width(),i=this._title.AABBBounds.width(),n=null===(t=this.attribute.title)||void 0===t?void 0:t.align;"center"===n?this._title.setAttribute("x",(e-i)/2):"end"===n&&this._title.setAttribute("x",e-i)}}}function nC(){Eb(),Zb(),jb(),Kb()}function oC(){Eb(),bm()}var rC=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i};const sC={[Qy.focus]:{},[Qy.selected]:{},[Qy.selectedHover]:{},[Qy.unSelected]:{},[Qy.unSelectedHover]:{}};oC(),$y(),tm();class aC extends iC{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Lt({},aC.defaultAttributes,t)),this.name="discreteLegend",this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._contentMaxHeight=0,this._onHover=t=>{const e=t.target;if(e&&e.name&&e.name.startsWith(eC.item)){const i=e.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===i.id)return;this._unHover(this._lastActiveItem,t)}this._hover(i,t)}else this._lastActiveItem&&(this._unHover(this._lastActiveItem,t),this._lastActiveItem=null)},this._onUnHover=t=>{this._lastActiveItem&&(this._unHover(this._lastActiveItem,t),this._lastActiveItem=null)},this._onClick=t=>{var e,i,n,o;const r=t.target;if(r&&r.name&&r.name.startsWith(eC.item)){const s=r.delegate,{selectMode:a="multiple"}=this.attribute;if(r.name===eC.focus||"focus"===a){const n=s.hasState(Qy.focus);s.toggleState(Qy.focus),n?null===(e=this._itemsContainer)||void 0===e||e.getChildren().forEach((e=>{this._removeLegendItemState(e,[Qy.unSelected,Qy.unSelectedHover,Qy.focus],t),this._setLegendItemState(e,Qy.selected,t)})):(this._setLegendItemState(s,Qy.selected,t),this._removeLegendItemState(s,[Qy.unSelected,Qy.unSelectedHover],t),null===(i=this._itemsContainer)||void 0===i||i.getChildren().forEach((e=>{s!==e&&(this._removeLegendItemState(e,[Qy.selected,Qy.selectedHover,Qy.focus],t),this._setLegendItemState(e,Qy.unSelected,t))})))}else{null===(n=this._itemsContainer)||void 0===n||n.getChildren().forEach((t=>{t.removeState(Qy.focus)}));const{allowAllCanceled:e=!0}=this.attribute,i=s.hasState(Qy.selected),r=this._getSelectedLegends();if("multiple"===a){if(!1===e&&i&&1===r.length)return void this._dispatchLegendEvent(tC.legendItemClick,s,t);i?(this._removeLegendItemState(s,[Qy.selected,Qy.selectedHover],t),this._setLegendItemState(s,Qy.unSelected,t)):(this._setLegendItemState(s,Qy.selected,t),this._removeLegendItemState(s,[Qy.unSelected,Qy.unSelectedHover],t))}else this._setLegendItemState(s,Qy.selected,t),this._removeLegendItemState(s,[Qy.unSelected,Qy.unSelectedHover],t),null===(o=this._itemsContainer)||void 0===o||o.getChildren().forEach((e=>{s!==e&&(this._removeLegendItemState(e,[Qy.selected,Qy.selectedHover],t),this._setLegendItemState(e,Qy.unSelected,t))}))}this._dispatchLegendEvent(tC.legendItemClick,s,t)}}}render(){super.render(),this._lastActiveItem=null}setSelected(t){var e;(null===(e=this._itemsContainer)||void 0===e?void 0:e.getChildren()).forEach((e=>{const i=e.data;t.includes(i.label)?(this._setLegendItemState(e,Qy.selected),this._removeLegendItemState(e,[Qy.unSelected,Qy.unSelectedHover])):(this._removeLegendItemState(e,[Qy.selected,Qy.selectedHover]),this._setLegendItemState(e,Qy.unSelected))}))}_renderItems(){const{item:t={},maxCol:e=1,maxRow:i=2,maxWidth:n,defaultSelected:o,lazyload:r,autoPage:s}=this.attribute,{spaceCol:a=qy,spaceRow:l=Zy,verticalAlign:h="middle"}=t,d=this._itemsContainer,{items:c,isHorizontal:u,startIndex:g,isScrollbar:p}=this._itemContext,f=p?1:u?i:e,v=this._contentMaxHeight;let b,{doWrap:m,maxWidthInCol:y,startX:C,startY:w,pages:x}=this._itemContext,_=0,S=0;const A=[];for(let t=g,e=c.length;t<e&&!(r&&x>this._itemContext.currentPage*f);t++){r&&(this._itemContext.startIndex=t+1),b=c[t],b.id||(b.id=b.label),b.index=t;let e=!0;ut(o)&&(e=o.includes(b.label));const i=this._renderEachItem(b,e,t,c),g=i.attribute.width,f=i.attribute.height;this._itemHeight=Math.max(this._itemHeight,f),y=Math.max(g,y),this._itemMaxWidth=Math.max(g,this._itemMaxWidth),u?(st(n)&&(p&&s?(x=Math.ceil((C+g)/n),m=x>1):C+g>n&&(m=!0,C>0&&("middle"!==h&&"bottom"!==h||A.forEach((t=>{t.setAttributes({y:t.attribute.y+(S-t.attribute.height)/("middle"===h?2:1)})})),x+=1,C=0,w+=S+l,S=0,A.length=0))),0===C&&0===w||i.setAttributes({x:C,y:w}),C+=a+g,S=Math.max(S,f),A.push(i)):(st(v)&&(p&&s?(x=Math.ceil((w+f)/v),m=x>1):v<=f?(x+=1,m=!0,w=0,t>0&&(C+=_+a)):v<w+f&&(x+=1,m=!0,w=0,C+=y+a,y=0)),0===C&&0===w||i.setAttributes({x:C,y:w}),w+=l+f),d.add(i),_=g}return!u||"middle"!==h&&"bottom"!==h||A.forEach((t=>{t.setAttributes({y:t.attribute.y+(S-t.attribute.height)/("middle"===h?2:1)})})),this._itemContext.doWrap=m,this._itemContext.startX=C,this._itemContext.startY=w,this._itemContext.maxWidthInCol=y,this._itemContext.pages=x,this._itemContext.maxPages=f,p&&(this._itemContext.totalPage=x),r||(this._itemContext.startIndex=c.length),this._itemContext}_renderContent(){const{item:t={},items:e,reversed:i,maxWidth:n,maxHeight:o}=this.attribute;if(!1===t.visible||_t(e))return;let r=e;i&&(r=null==e?void 0:e.reverse()),this._contentMaxHeight=Math.max(0,o-this._parsedPadding[0]-this._parsedPadding[2]);const s=_h.group({x:0,y:0});this._itemsContainer=s;const{layout:a,autoPage:l}=this.attribute,h="horizontal"===a,{maxWidth:d,width:c,height:u}=t,g=[];st(d)&&g.push(d),st(c)&&g.push(c),g.length&&(st(n)&&g.push(n),this._itemWidthByUser=It(g)),st(u)&&(this._itemHeightByUser=u);const p=this.attribute.pager;this._itemContext={currentPage:p&&p.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:r,isHorizontal:h,totalPage:1/0,isScrollbar:p&&"scrollbar"===p.type,clipContainer:void 0},this._itemContext=this._renderItems();let f=!1;this._itemContext.doWrap&&l&&this._itemContext.pages>this._itemContext.maxPages&&(f=this._renderPagerComponent()),f||(s.setAttribute("y",this._title?this._title.AABBBounds.height()+St(this.attribute,"title.space",8):0),this._innerView.add(s))}_bindEvents(){if(this.attribute.disableTriggerEvent)return;if(!this._itemsContainer)return;const{hover:t=!0,select:e=!0}=this.attribute;if(t){let e="pointermove",i="pointerleave";at(t)&&(t.trigger&&(e=t.trigger),t.triggerOff&&(i=t.triggerOff)),this._itemsContainer.addEventListener(e,this._onHover),this._itemsContainer.addEventListener(i,this._onUnHover)}if(e){let t="pointerdown";at(e)&&e.trigger&&(t=e.trigger),this._itemsContainer.addEventListener(t,this._onClick)}}_autoEllipsis(t,e,i,n){var o,r;const{label:s,value:a}=this.attribute.item,l=n.AABBBounds,h=i.AABBBounds,d=l.width(),c=h.width();let u=!1;"labelFirst"===t?c>e?u=!0:n.setAttribute("maxLineWidth",e-c):"valueFirst"===t?d>e?u=!0:i.setAttribute("maxLineWidth",e-d):d+c>e&&(u=!0),u&&(n.setAttribute("maxLineWidth",Math.max(e*(null!==(o=s.widthRatio)&&void 0!==o?o:.5),e-c)),i.setAttribute("maxLineWidth",Math.max(e*(null!==(r=a.widthRatio)&&void 0!==r?r:.5),e-d)))}_renderEachItem(t,e,i,n){var o,r;const{id:s,label:a,value:l,shape:h}=t,{padding:d=0,focus:c,focusIconStyle:u,align:g,autoEllipsisStrategy:p}=this.attribute.item,{shape:f,label:v,value:b,background:m}=this.attribute.item,y=this._handleStyle(f,t,e,i,n),C=this._handleStyle(v,t,e,i,n),w=this._handleStyle(b,t,e,i,n),x=this._handleStyle(m,t,e,i,n),_=ti(d);let S;!1===m.visible?(S=_h.group({x:0,y:0,cursor:null===(o=x.style)||void 0===o?void 0:o.cursor}),this._appendDataToShape(S,eC.item,t,S)):(S=_h.group(Object.assign({x:0,y:0},x.style)),this._appendDataToShape(S,eC.item,t,S,x.state)),S.id=`${null!=s?s:a}-${i}`,S.addState(e?Qy.selected:Qy.unSelected);const A=_h.group({x:0,y:0,pickable:!1});S.add(A);let B,T=0,R=0,k=0;if(f&&!1!==f.visible){const i=St(y,"style.size",10);R=ut(i)?i[0]||0:i,k=St(f,"space",8);const n=_h.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:"circle",strokeBoundsBuffer:0},h),y.style));Object.keys(y.state||{}).forEach((t=>{const e=y.state[t].fill||y.state[t].stroke;h.fill&&rt(y.state[t].fill)&&e&&(y.state[t].fill=e),h.stroke&&rt(y.state[t].stroke)&&e&&(y.state[t].stroke=e)})),this._appendDataToShape(n,eC.itemShape,t,S,y.state),n.addState(e?Qy.selected:Qy.unSelected),A.add(n)}let M=0;if(c){const e=St(u,"size",10);B=_h.symbol(Object.assign(Object.assign({x:0,y:-e/2-1,strokeBoundsBuffer:0,boundsPadding:_},u),{visible:!0,pickMode:"imprecise"})),this._appendDataToShape(B,eC.focus,t,S),M=e}const L=v.formatMethod?v.formatMethod(a,t,i):a,P=vm(Object.assign(Object.assign({x:R/2+k,y:0,textAlign:"start",textBaseline:"middle",lineHeight:null===(r=C.style)||void 0===r?void 0:r.fontSize},C.style),{text:L,_originText:v.formatMethod?a:void 0}));this._appendDataToShape(P,eC.itemLabel,t,S,C.state),P.addState(e?Qy.selected:Qy.unSelected),A.add(P);const E=St(v,"space",8);if(st(l)){const n=St(b,"space",c?8:0),o=b.formatMethod?b.formatMethod(l,t,i):l,r=vm(Object.assign(Object.assign({x:0,y:0,textAlign:"start",textBaseline:"middle",lineHeight:w.style.fontSize},w.style),{text:o,_originText:b.formatMethod?l:void 0}));if(this._appendDataToShape(r,eC.itemValue,t,S,w.state),r.addState(e?Qy.selected:Qy.unSelected),this._itemWidthByUser){const t=this._itemWidthByUser-_[1]-_[3]-R-k-E-M-n;this._autoEllipsis(p,t,P,r),b.alignRight?r.setAttributes({textAlign:"right",x:this._itemWidthByUser-R/2-_[1]-_[3]-M-n}):r.setAttribute("x",E+(P.AABBBounds.empty()?0:P.AABBBounds.x2))}else r.setAttribute("x",E+(P.AABBBounds.empty()?0:P.AABBBounds.x2));T=n+(r.AABBBounds.empty()?0:r.AABBBounds.x2),A.add(r)}else this._itemWidthByUser?(P.setAttribute("maxLineWidth",this._itemWidthByUser-_[1]-_[3]-R-k-M),T=E+(P.AABBBounds.empty()?0:P.AABBBounds.x2)):T=E+(P.AABBBounds.empty()?0:P.AABBBounds.x2);B&&(B.setAttribute("x",T),A.add(B));const H=A.AABBBounds,O=H.width();if("right"===g){const t=H.x2,e=H.x1;A.forEachChildren(((i,n)=>{"symbol"!==i.type&&"right"!==i.attribute.textAlign||i===B?i.setAttribute("x",e+t-i.attribute.x-i.AABBBounds.width()):"symbol"!==i.type?i.setAttributes({x:e+t-i.attribute.x,textAlign:"left"}):i.setAttribute("x",e+t-i.attribute.x)}))}const I=H.height(),F=st(this.attribute.item.width)?this.attribute.item.width:O+_[1]+_[3],z=this._itemHeightByUser||I+_[0]+_[2];return S.attribute.width=F,S.attribute.height=z,B&&B.setAttribute("visible",!1),A.translateTo(-H.x1+_[3],-H.y1+_[0]),S}_createPager(t){var e,i;const{disableTriggerEvent:n,maxRow:o}=this.attribute,r=t=>t<=99?99:t<=999?999:9999;return this._itemContext.isHorizontal?new Ky(Object.assign(Object.assign({layout:1===o?"horizontal":"vertical",total:r(this._itemContext.pages)},Lt({handler:{preShape:"triangleUp",nextShape:"triangleDown"}},t)),{defaultCurrent:null===(e=this.attribute.pager)||void 0===e?void 0:e.defaultCurrent,disableTriggerEvent:n})):new Ky(Object.assign({layout:"horizontal",total:r(this._itemContext.pages),disableTriggerEvent:n,defaultCurrent:null===(i=this.attribute.pager)||void 0===i?void 0:i.defaultCurrent},t))}_createScrollbar(t,e){const{disableTriggerEvent:i}=this.attribute;return this._itemContext.isHorizontal?new am(Object.assign(Object.assign({direction:"horizontal",disableTriggerEvent:i,range:[0,.5],height:!1===t.visible?0:12},t),{width:e})):new am(Object.assign(Object.assign({direction:"vertical",width:!1===t.visible?0:12,range:[0,.5]},t),{height:e,disableTriggerEvent:i}))}_updatePositionOfPager(t,e,i){const{pager:n}=this.attribute,{totalPage:o,isHorizontal:r}=this._itemContext,s=n&&n.position||"middle";if(this._pagerComponent.setTotal(o),r){let n;n="start"===s?t:"end"===s?t+i-this._pagerComponent.AABBBounds.height()/2:t+i/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:e-this._pagerComponent.AABBBounds.width(),y:n})}else{let t;t="start"===s?0:"end"===s?e-this._pagerComponent.AABBBounds.width():(e-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:t,y:i-this._pagerComponent.AABBBounds.height()})}}_computeScrollbarDelta(){const{isHorizontal:t,clipContainer:e}=this._itemContext,i=this._itemsContainer.AABBBounds,n=e.AABBBounds;let o,r;return t?(r=n.width(),o=r/i.width()):(r=n.height(),o=r/i.height()),o}_updatePositionOfScrollbar(t,e,i){const{isHorizontal:n,currentPage:o,totalPage:r}=this._itemContext,s=(o-1)/r;this._pagerComponent.setScrollRange([s,s+this._computeScrollbarDelta()]),n?this._pagerComponent.setAttributes({x:0,y:i+e}):this._pagerComponent.setAttributes({x:t,y:i})}_bindEventsOfPager(t,e){const i=this.attribute.pager||{},{animation:n=!0,animationDuration:o=450,animationEasing:r="quadIn"}=i,s=this._itemContext.isScrollbar?t=>{const{value:e}=t.detail;let i;return i=0===e[0]?1:1===e[1]?this._itemContext.totalPage:e[0]*this._itemContext.totalPage+1,i}:t=>t.detail.current,a=t=>{const e=this._pagerComponent,i=e.getScrollRange(),{direction:n}=e.attribute,{width:o,height:r}=e.getSliderRenderBounds(),s="vertical"===n?t.deltaY/r:t.deltaX/o;e.setScrollRange([i[0]+s,i[1]+s],!0),this.updateScrollMask()},l=i=>{const a=s(i);if(a!==this._itemContext.currentPage){if(this._itemContext.currentPage=a,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();const t=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);if(this._itemContext.totalPage=t,this._itemContext.isScrollbar&&this._pagerComponent){const t=this._computeScrollbarDelta(),[e]=this._pagerComponent.getScrollRange();this._pagerComponent.setScrollRange([e,e+t])}}if(this._itemContext.isScrollbar){const[t]=this._pagerComponent.getScrollRange();let i;i=this._itemContext.isHorizontal?this._itemsContainer.AABBBounds.width():this._itemsContainer.AABBBounds.height();const s=i*t;this.updateScrollMask(),n?this._itemsContainer.animate().to({[e]:-s},o,r):this._itemsContainer.setAttribute(e,-s)}else n?this._itemsContainer.animate().to({[e]:-(a-1)*t},o,r):this._itemsContainer.setAttribute(e,-(a-1)*t)}};if(this._itemContext.isScrollbar){if(this._pagerComponent.addEventListener("scrollDrag",l),this._pagerComponent.addEventListener("scrollUp",l),this.attribute.pager.roamScroll){const t=50;this.addEventListener("wheel",(t=>t.nativeEvent.preventDefault())),this.addEventListener("wheel",Zt(a,t))}}else this._pagerComponent.addEventListener("toPrev",l),this._pagerComponent.addEventListener("toNext",l)}_renderPager(){const t=this._title?this._title.AABBBounds.height()+St(this.attribute,"title.space",8):0,{maxWidth:e,maxCol:i=1,maxRow:n=2,item:o={},pager:r={}}=this.attribute,{spaceCol:s=qy,spaceRow:a=Zy}=o,l=this._itemsContainer,{space:h=Jy,defaultCurrent:d=1}=r,c=rC(r,["space","defaultCurrent"]),{isHorizontal:u}=this._itemContext,g=this._contentMaxHeight;let p,f=0,v=0,b=0,m=0,y=0,C=0,w=1;if(u){if(v=(n-1)*a+this._itemHeight*n,f=e,p=this._createPager(c),this._pagerComponent=p,this._innerView.add(p),b=e-p.AABBBounds.width()-h,b<=0)return this._innerView.removeChild(p),!1;l.getChildren().forEach(((t,e)=>{const{width:i,height:n}=t.attribute;b<y+i&&(y=0,C+=n+a,w+=1),e>0&&t.setAttributes({x:y,y:C}),y+=s+i})),this._itemContext.startX=y,this._itemContext.startY=C,this._itemContext.pages=w;const i=Math.ceil(w/n);this._itemContext.totalPage=i,this._updatePositionOfPager(t,f,v)}else{if(f=this._itemMaxWidth*i+(i-1)*s,v=g,b=f,p=this._createPager(c),this._pagerComponent=p,this._innerView.add(p),m=g-p.AABBBounds.height()-h-t,m<=0)return this._innerView.removeChild(p),!1;l.getChildren().forEach(((t,e)=>{const{height:i}=t.attribute;m<C+i&&(C=0,y+=this._itemMaxWidth+s,w+=1),e>0&&t.setAttributes({x:y,y:C}),C+=a+i}));const e=Math.ceil(w/i);this._itemContext.totalPage=e,this._updatePositionOfPager(t,f,v)}d>1&&(u?l.setAttribute("y",-(d-1)*(v+a)):l.setAttribute("x",-(d-1)*(f+s)));const x=_h.group({x:0,y:t,width:u?b:f,height:u?v:m,clip:!0,pickable:!1});return x.add(l),this._innerView.add(x),this._itemContext.clipContainer=x,this._bindEventsOfPager(u?v+a:f+s,u?"y":"x"),!0}_renderScrollbar(){var t;const e=this._title?this._title.AABBBounds.height()+St(this.attribute,"title.space",8):0,{maxWidth:i,item:n={},pager:o={}}=this.attribute,{spaceCol:r=qy,spaceRow:s=Zy}=n,a=this._itemsContainer,{space:l=Jy,defaultCurrent:h=1}=o,d=rC(o,["space","defaultCurrent"]),{isHorizontal:c}=this._itemContext,u=this._contentMaxHeight;let g,p=0,f=0,v=0,b=1;if(c)p=i,f=this._itemHeight,g=this._createScrollbar(d,p),this._pagerComponent=g,this._innerView.add(g);else{if(f=u-e,p=this._itemMaxWidth,g=this._createScrollbar(d,f),this._pagerComponent=g,this._innerView.add(g),f<=0)return this._innerView.removeChild(g),!1;const t=a.getChildren(),i=t.map((t=>t.attribute.height));if(1===i.length||i.every((t=>t===i[0]))){const e=i[0],n=f,o=Math.floor(n/(s+e));f=o*(s+e),b=Math.ceil(t.length/o)}else t.forEach(((t,e)=>{const{height:i}=t.attribute,n=b,o=v;b=Math.floor((v+i)/f)+1,v+=s+i,n!==b&&e===a.getChildren().length-1&&v-f>=1/3*i&&(f=o+i,b-=1)}));this._itemContext.totalPage=b,this._itemContext.pages=b}if(h>1)if(c){const t=this._itemsContainer.AABBBounds.width()-p;a.setAttribute("x",-Math.min((h-1)*(p+r),t))}else{const t=this._itemsContainer.AABBBounds.height()-f;a.setAttribute("y",-Math.min((h-1)*(f+s),t))}const m=_h.group({x:0,y:e,width:p,height:f,clip:!0,pickable:!1});return m.add(a),this._innerView.add(m),this._itemContext.clipContainer=m,this._updatePositionOfScrollbar(p,f,e),(null===(t=o.scrollMask)||void 0===t?void 0:t.visible)&&this.renderScrollMask(m),this._bindEventsOfPager(c?p:f,c?"x":"y"),!0}renderScrollMask(t){const{scrollMask:e={}}=this.attribute.pager,{visible:i=!0,gradientLength:n=16,gradientStops:o}=e;if(!i||!o)return;const r=t.AABBBounds.width(),s=t.AABBBounds.height(),a=this._itemContext.isHorizontal?r:s,l=o.map((t=>({offset:n*t.offset/a,color:t.color}))),h=o.map((t=>({offset:(a-n*t.offset)/a,color:t.color}))),d=_h.rect({x:0,y:0,width:r,height:s});this._scrollMask=d,this._scrollMaskContext={startStops:l,endStops:h},this.updateScrollMask(),t.add(d)}updateScrollMask(){if(!this._scrollMask||!this._pagerComponent)return;if(!this._itemContext.isScrollbar)return;const[t,e]=this._pagerComponent.getScrollRange(),i=[];Ut($t(e,0,1),1)||i.push(...this._scrollMaskContext.endStops),Ut($t(t,0,1),0)||i.push(...this._scrollMaskContext.startStops),i.length&&(this._itemContext.isHorizontal?this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:i}}):this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:0,y1:1,stops:i}}))}_renderPagerComponent(){return this._itemContext.isScrollbar?this._renderScrollbar():this._renderPager(),!0}_hover(t,e){this._lastActiveItem=t,t.hasState(Qy.selected)?this._setLegendItemState(t,Qy.selectedHover,e):this._setLegendItemState(t,Qy.unSelectedHover,e);const i=t.getChildren()[0].find((t=>t.name===eC.focus),!1);i&&i.setAttribute("visible",!0),this._dispatchLegendEvent(tC.legendItemHover,t,e)}_unHover(t,e){let i=!1;(t.hasState(Qy.unSelectedHover)||t.hasState(Qy.selectedHover))&&(i=!0),t.removeState(Qy.unSelectedHover),t.removeState(Qy.selectedHover),t.getChildren()[0].getChildren().forEach((t=>{i||!t.hasState(Qy.unSelectedHover)&&!t.hasState(Qy.selectedHover)||(i=!0),t.removeState(Qy.unSelectedHover),t.removeState(Qy.selectedHover)}));const n=t.getChildren()[0].find((t=>t.name===eC.focus),!1);n&&n.setAttribute("visible",!1),i&&this._dispatchLegendEvent(tC.legendItemAttributeUpdate,t,e),this._dispatchLegendEvent(tC.legendItemUnHover,t,e)}_setLegendItemState(t,e,i){let n=!1;t.hasState(e)||(n=!0),t.addState(e,!0),t.getChildren()[0].getChildren().forEach((t=>{t.name!==eC.focus&&(n||t.hasState(e)||(n=!0),t.addState(e,!0))})),n&&this._dispatchLegendEvent(tC.legendItemAttributeUpdate,t,i)}_removeLegendItemState(t,e,i){let n=!1;e.forEach((e=>{!n&&t.hasState(e)&&(n=!0),t.removeState(e)})),t.getChildren()[0].getChildren().forEach((t=>{t.name!==eC.focus&&e.forEach((e=>{!n&&t.hasState(e)&&(n=!0),t.removeState(e)}))})),n&&this._dispatchLegendEvent(tC.legendItemAttributeUpdate,t,i)}_getSelectedLegends(){var t;const e=[];return null===(t=this._itemsContainer)||void 0===t||t.getChildren().forEach((t=>{t.hasState(Qy.selected)&&e.push(t.data)})),e}_appendDataToShape(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};t.name=e,t.data=i,t.delegate=n,t.states=Lt({},sC,o)}_dispatchLegendEvent(t,e,i){const n=this._getSelectedLegends();n.sort(((t,e)=>t.index-e.index));const o=n.map((t=>t.label));this._dispatchEvent(t,{item:e,data:e.data,selected:e.hasState(Qy.selected),currentSelectedItems:n,currentSelected:o,event:i})}_handleStyle(t,e,i,n,o){const r={};return t.style&&(ot(t.style)?r.style=t.style(e,i,n,o):r.style=t.style),t.state&&(r.state={},Object.keys(t.state).forEach((s=>{t.state[s]&&(ot(t.state[s])?r.state[s]=t.state[s](e,i,n,o):r.state[s]=t.state[s])}))),r}release(){super.release(),this.removeAllEventListeners()}}var lC;function hC(t){return ut(t)?t:[t,t]}function dC(t){return t?"ew-resize":"ns-resize"}aC.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:qy,spaceRow:Zy,shape:{space:8,style:{size:10,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:8,style:{fontSize:12,fill:"#2C3542",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"}},focus:!1,focusIconStyle:{size:10,symbolType:"M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z",fill:"#333",cursor:"pointer"}},autoPage:!0,pager:{space:Jy,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!0},function(t){t.innerView="innerView",t.railContainer="sliderRailContainer",t.rail="sliderRail",t.startText="sliderStartText",t.endText="sliderEndText",t.startHandler="sliderStartHandler",t.startHandlerText="startHandlerText",t.endHandler="sliderEndHandler",t.endHandlerText="sliderEndHandlerText",t.track="sliderTrack",t.trackContainer="sliderTrackContainer"}(lC||(lC={})),nC();class cC extends Og{get track(){return this._track}get currentValue(){return this._currentValue}get startHandler(){return this._startHandler}get endHandler(){return this._endHandler}get tooltipShape(){return this._tooltipShape}constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Lt({},cC.defaultAttributes,t)),this.name="slider",this._isHorizontal=!0,this._startHandler=null,this._endHandler=null,this._startHandlerText=null,this._endHandlerText=null,this._currentHandler=null,this._currentValue={},this._onTooltipShow=t=>{this._isChanging||this._tooltipState&&this._tooltipState.isActive||(this._tooltipState?this._tooltipState.isActive=!0:this._tooltipState={isActive:!0},this._onTooltipUpdate(t),this._dispatchTooltipEvent("sliderTooltipShow"))},this._onTooltipUpdate=t=>{if(this._isChanging||!this._tooltipState||!this._tooltipState.isActive)return;const e=this._isHorizontal?this._rail.globalAABBBounds.width():this._rail.globalAABBBounds.height(),i=$t(this._isHorizontal?(t.viewX-this._rail.globalAABBBounds.x1)/e:(t.viewY-this._rail.globalAABBBounds.y1)/e,0,1);i!==this._tooltipState.pos&&(this._tooltipState.pos=i,this._tooltipState.value=this.calculateValueByPos(i*e),this._updateTooltip(),this._dispatchTooltipEvent("sliderTooltipUpdate"))},this._onTooltipHide=()=>{const{tooltip:t}=this.attribute;t&&t.alwaysShow||(this._tooltipState=null,this._tooltipShape&&this._tooltipShape.setAttribute("visible",!1),this._tooltipText&&this._tooltipText.setAttribute("visible",!1),this._dispatchTooltipEvent("sliderTooltipHide"))},this._onHandlerPointerdown=t=>{this._clearAllDragEvents(),this._isChanging=!0;const{x:e,y:i}=this.stage.eventPointTransform(t);this._currentHandler=t.target,this._prePos=this._isHorizontal?e:i;const n=rm(),o="browser"===Pu.env?Pu:this.stage;o.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),n.forEach((t=>{o.addEventListener(t,this._onHandlerPointerUp)}))},this._onHandlerPointerMove=t=>{var e,i;this._isChanging=!0;const{railWidth:n,railHeight:o,min:r,max:s}=this.attribute;if(s===r)return;const{x:a,y:l}=this.stage.eventPointTransform(t);let h,d,c,u=0;this._isHorizontal?(h=a,u=h-this._prePos,d=null===(i=this._currentHandler)||void 0===i?void 0:i.attribute.x,c=n):(h=l,u=h-this._prePos,d=null===(e=this._currentHandler)||void 0===e?void 0:e.attribute.y,c=o);const g=$t(d+u,0,c),p=this.calculateValueByPos(g);"text"===this._currentHandler.type?this._updateHandlerText(this._currentHandler,g,p):this._updateHandler(this._currentHandler,g,p),this._updateTrack(),this._prePos=h,this._dispatchChangeEvent()},this._onHandlerPointerUp=t=>{this._isChanging=!1,this._currentHandler=null,this._clearAllDragEvents()},this._handleTouchMove=t=>{this._isChanging&&t.preventDefault()},this._onTrackPointerdown=t=>{this._clearAllDragEvents(),this._isChanging=!0;const{x:e,y:i}=this.stage.eventPointTransform(t);this._prePos=this._isHorizontal?e:i;const n=rm(),o="browser"===Pu.env?Pu:this.stage;o.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),n.forEach((t=>{o.addEventListener(t,this._onTrackPointerUp)}))},this._onTrackPointerMove=t=>{this._isChanging=!0;const{railWidth:e,railHeight:i,min:n,max:o,inverse:r}=this.attribute;if(o===n)return;const{startHandler:s,endHandler:a}=this._getHandlers();let l,h,d;const{x:c,y:u}=this.stage.eventPointTransform(t);this._isHorizontal?(l=c,h=this._track.attribute.width,d=e):(l=u,h=this._track.attribute.height,d=i);const g=l-this._prePos;if(s){const t=this._isHorizontal?s.attribute.x:s.attribute.y,e=r?$t(t+g,h,d):$t(t+g,0,d-h),i=this.calculateValueByPos(e);this._updateHandler(s,e,i)}if(a){const t=this._isHorizontal?a.attribute.x:a.attribute.y,e=r?$t(t+g,0,d-h):$t(t+g,h,d),i=this.calculateValueByPos(e),n=null==s?void 0:s.attribute;this._updateHandler(a,e,i),this._track.setAttributes(this._isHorizontal?{x:Math.min(n.x,a.attribute.x),width:Math.abs(n.x-a.attribute.x)}:{y:Math.min(n.y,a.attribute.y),height:Math.abs(n.y-a.attribute.y)})}this._prePos=l,this._dispatchChangeEvent()},this._onTrackPointerUp=t=>{this._isChanging=!1,this._clearAllDragEvents()},this._onRailPointerDown=t=>{this._clearAllDragEvents(),this._isChanging=!0;const{railWidth:e,railHeight:i,min:n,max:o}=this.attribute;if(o===n)return;const r=this._startHandler,s=this._endHandler;let a,l,h;this._isHorizontal?(a=t.viewX-this._rail.globalAABBBounds.x1,l=null==r?void 0:r.attribute.x,h=null==s?void 0:s.attribute.x):(a=t.viewY-this._rail.globalAABBBounds.y1,l=null==r?void 0:r.attribute.y,h=null==s?void 0:s.attribute.y);const d=this.calculateValueByPos(a);if(st(h)){const t=Math.abs(a-l)>Math.abs(a-h)?s:r;this._updateHandler(t,a,d)}else this._updateHandler(r,a,d);this._updateTrack(),this._dispatchChangeEvent()}}calculatePosByValue(t,e){const{layout:i,railWidth:n,railHeight:o,min:r,max:s,inverse:a}=this.attribute;let l=0;return l=r===s?"start"===e?0:"end"===e?1:0:(t-r)/(s-r),(a?1-l:l)*("vertical"===i?o:n)}calculateValueByPos(t){const{layout:e,railWidth:i,railHeight:n,min:o,max:r,inverse:s}=this.attribute,a="vertical"===e?n:i;return o+(r-o)*(s?1-t/a:t/a)}setValue(t){const{min:e,max:i}=this.attribute;if(i===e)return;const[n,o]=Et(t),{startHandler:r,endHandler:s}=this._getHandlers();r&&this._updateHandler(r,this.calculatePosByValue(n),n),s&&this._updateHandler(s,this.calculatePosByValue(o),o),this._updateTrack()}render(){var t,e;this.removeAllChild(!0);const{layout:i="horizontal",railWidth:n,railHeight:o,startText:r,endText:s,min:a,max:l,showHandler:h=!0,showTooltip:d}=this.attribute;let{value:c}=this.attribute;rt(c)&&(c=[a,l]),this._currentValue={startValue:hC(c)[0],endValue:hC(c)[1]};const u="horizontal"===i;this._isHorizontal=u;const g=_h.group({x:0,y:0});g.name=lC.innerView,this.add(g),this._innerView=g;let p,f=0;if(r&&r.visible){p=_h.text(Object.assign({x:u?0:n/2,y:u?o/2:0,textAlign:u?"start":"center",textBaseline:u?"middle":"top",text:r.text,lineHeight:null===(t=r.style)||void 0===t?void 0:t.fontSize},r.style)),p.name=lC.startText,g.add(p);const e=st(r.space)?r.space:0;f+=(u?p.AABBBounds.width():p.AABBBounds.height())+e}const v=_h.group({x:u?f:0,y:u?0:f});g.add(v);const b=_h.group({x:0,y:0});let m;if(b.name=lC.railContainer,this._railContainer=b,v.add(b),this._mainContainer=v,this._renderRail(b),f+=u?n:o,s&&s.visible){const t=st(s.space)?s.space:0;m=_h.text(Object.assign({x:u?f+t:n/2,y:u?o/2:f+t,textAlign:u?"start":"center",textBaseline:u?"middle":"top",text:s.text,lineHeight:null===(e=s.style)||void 0===e?void 0:e.fontSize},s.style)),m.name=lC.endText,g.add(m)}this._renderTrack(b),h&&(this._renderHandlers(v),this._bindEvents()),d&&(this._renderTooltip(),this._bindTooltipEvents())}_renderRail(t){const{railWidth:e,railHeight:i,railStyle:n,slidable:o}=this.attribute;let r="default";!1!==o&&(r="pointer");const s=_h.rect(Object.assign({x:0,y:0,width:e,height:i,cursor:r},n));return s.name=lC.rail,t.add(s),this._rail=s,s}_renderHandlers(t){const{range:e,min:i,max:n,handlerSize:o=14,handlerStyle:r,handlerText:s,railHeight:a,railWidth:l,slidable:h}=this.attribute;let{value:d}=this.attribute;rt(d)&&(d=[i,n]);const c=s&&s.visible,u=this._isHorizontal,[g,p]=hC(d),f=this.calculatePosByValue(g,e?"start":"end"),v=this._renderHandler(Object.assign({x:u?f:l/2,y:u?a/2:f,size:o,strokeBoundsBuffer:0,cursor:!1===h?"default":dC(u)},r));if(v.name=lC.startHandler,this._startHandler=v,t.add(v),this._currentValue.startPos=f,c){const i=this._renderHandlerText(g,e?"start":"end");i.name=lC.startHandlerText,t.add(i),this._startHandlerText=i}if(e){const e=this.calculatePosByValue(p,"end"),i=this._renderHandler(Object.assign({x:u?e:l/2,y:u?a/2:e,size:o,strokeBoundsBuffer:0,cursor:!1===h?"default":dC(u)},r));if(i.name=lC.endHandler,this._endHandler=i,t.add(i),this._currentValue.endPos=e,c){const e=this._renderHandlerText(p,"end");e.name=lC.endHandlerText,t.add(e),this._endHandlerText=e}}}_renderTrack(t){const{range:e,min:i,max:n,railHeight:o,railWidth:r,trackStyle:s,railStyle:a,slidable:l,value:h}=this.attribute;let d,c;if(rt(h))e?(d=i,c=n):d=c=i;else if(e){const t=Yt(h,i,n);d=t[0],c=t[1]}else d=i,c=$t(h,i,n);const u=this._isHorizontal;e||(d=i);const g=_h.group({x:0,y:0,width:r,height:o,cornerRadius:null==a?void 0:a.cornerRadius,clip:!0,pickable:!1});g.name=lC.trackContainer;const p=at(e)&&!0===e.draggableTrack;let f;f=!1===l?"default":!1===e||!1===p?"pointer":dC(u);const v=this.calculatePosByValue(d,"start"),b=this.calculatePosByValue(c,e?"end":"start"),m=_h.rect(Object.assign({x:u?Math.min(v,b):0,y:u?0:Math.min(v,b),width:u?Math.abs(b-v):r,height:u?o:Math.abs(b-v),cursor:f},s));m.name=lC.track,this._track=m,g.add(m),t.add(g)}_renderHandler(t){return _h.symbol(t)}_renderHandlerText(t,e){var i,n,o;const{align:r,handlerSize:s=14,handlerText:a={},railHeight:l,railWidth:h,slidable:d}=this.attribute,c=this._isHorizontal,u=this.calculatePosByValue(t,e),g=null!==(i=a.space)&&void 0!==i?i:4,p={text:a.formatter?a.formatter(t):t.toFixed(null!==(n=a.precision)&&void 0!==n?n:0),lineHeight:null===(o=a.style)||void 0===o?void 0:o.lineHeight,cursor:!1===d?"default":dC(c)};return c?"top"===r?(p.textBaseline="bottom",p.textAlign="center",p.x=u,p.y=(l-s)/2-g):(p.textBaseline="top",p.textAlign="center",p.x=u,p.y=(l+s)/2+g):"left"===r?(p.textBaseline="middle",p.textAlign="end",p.x=(h-s)/2-g,p.y=u):(p.textBaseline="middle",p.textAlign="start",p.x=(h+s)/2+g,p.y=u),_h.text(Object.assign(Object.assign({},p),a.style))}_renderTooltip(){var t;const{tooltip:e,railHeight:i,railWidth:n,align:o}=this.attribute;e&&e.alwaysShow?this._tooltipState={value:this._currentValue.startValue,pos:this._currentValue.startPos}:this._tooltipState=null;const r=this._isHorizontal?0:n/2,s=this._isHorizontal?i/2:0;if(e&&e.shape){const t=_h.symbol(Object.assign({pickable:!1,visible:!!this._tooltipState,x:r,y:s,symbolType:"circle"},e.shapeStyle));this._tooltipShape=t,this._mainContainer.add(t)}const a=e&&e.text||{},l=null!==(t=a.space)&&void 0!==t?t:6,h={pickable:!1,visible:!!this._tooltipState,text:""};this._isHorizontal?(h.x=r,h.y="top"===o?s-i/2-l:s+i/2+l,h.textAlign="center",h.textBaseline="top"===o?"bottom":"top"):(h.y=s,h.x="left"===o?r-n/2-l:s+n/2+l,h.textAlign="left"===o?"end":"start",h.textBaseline="middle");const d=_h.text(Object.assign(Object.assign({},h),a.style));this._mainContainer.add(d),this._tooltipText=d,this._tooltipState&&this._updateTooltip()}_updateTooltip(){var t,e;if(!this._tooltipShape&&!this._tooltipText||!this._tooltipState)return;const{railWidth:i,railHeight:n}=this.attribute,o=this._isHorizontal?i:n,r=this._tooltipState.pos*o,s=this._isHorizontal?"x":"y";this._tooltipShape&&this._tooltipShape.setAttributes({visible:!0,[s]:r});const{align:a}=this.attribute;if(this._tooltipText){const i=this.attribute.tooltip&&this.attribute.tooltip.text||{};this._tooltipText.setAttributes({visible:!0,[s]:r,text:i.formatter?i.formatter(this._tooltipState.value):this._isHorizontal||"left"!==a?`≈ ${this._tooltipState.value.toFixed(null!==(e=i.precision)&&void 0!==e?e:0)}`:`${this._tooltipState.value.toFixed(null!==(t=i.precision)&&void 0!==t?t:0)} ≈`})}}_bindEvents(){if(this.attribute.disableTriggerEvent)return;const{slidable:t,range:e}=this.attribute;t&&(this._startHandler&&this._startHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._startHandlerText&&this._startHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandler&&this._endHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandlerText&&this._endHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),at(e)&&e.draggableTrack&&this._track.addEventListener("pointerdown",this._onTrackPointerdown),this._railContainer.addEventListener("pointerdown",this._onRailPointerDown),("browser"===Pu.env?Pu:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}))}_bindTooltipEvents(){this.attribute.disableTriggerEvent||(this._mainContainer.addEventListener("pointerenter",this._onTooltipShow),this._mainContainer.addEventListener("pointermove",this._onTooltipUpdate),this._mainContainer.addEventListener("pointerleave",this._onTooltipHide))}_clearAllDragEvents(){const t=rm(),e="browser"===Pu.env?Pu:this.stage;e.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),t.forEach((t=>{e.removeEventListener(t,this._onHandlerPointerUp)})),e.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),t.forEach((t=>{e.removeEventListener(t,this._onTrackPointerUp)}))}_updateTrack(){const{inverse:t,railWidth:e,railHeight:i}=this.attribute,n=this._startHandler,o=this._endHandler;if(this._isHorizontal){const i=null==n?void 0:n.attribute.x;if(o){const t=null==o?void 0:o.attribute.x;this._track.setAttributes({x:Math.min(i,t),width:Math.abs(i-t)})}else t?this._track.setAttributes({x:i,width:e-i}):this._track.setAttributes({width:i})}else{const e=null==n?void 0:n.attribute.y;if(o){const t=null==o?void 0:o.attribute.y;this._track.setAttributes({y:Math.min(e,t),height:Math.abs(e-t)})}else t?this._track.setAttributes({y:e,height:i-e}):this._track.setAttributes({height:e})}}_updateHandler(t,e,i){var n;const o=this._isHorizontal;t.setAttribute(o?"x":"y",e);const r=t.name===lC.startHandler?this._startHandlerText:this._endHandlerText;if(r){const{handlerText:t={}}=this.attribute;r.setAttributes({text:t.formatter?t.formatter(i):i.toFixed(null!==(n=t.precision)&&void 0!==n?n:0),[o?"x":"y"]:e})}t.name===lC.startHandler?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_updateHandlerText(t,e,i){var n;const o=this._isHorizontal,{handlerText:r={}}=this.attribute;t.setAttributes({[o?"x":"y"]:e,text:r.formatter?r.formatter(i):i.toFixed(null!==(n=r.precision)&&void 0!==n?n:0)});const s=t.name===lC.startHandlerText?this._startHandler:this._endHandler;s&&s.setAttributes({[o?"x":"y"]:e}),t.name===lC.startHandlerText?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_dispatchChangeEvent(){const t=!!this.attribute.range,e=this._currentValue;this._dispatchEvent("change",{value:t?[Math.min(e.endValue,e.startValue),Math.max(e.endValue,e.startValue)]:e.startValue,position:t?[Math.min(e.endPos,e.startPos),Math.max(e.endPos,e.startPos)]:e.startPos})}_dispatchTooltipEvent(t){this._dispatchEvent("sliderTooltip",{type:t,position:this._tooltipState&&this._tooltipState.pos,value:this._tooltipState&&this._tooltipState.value})}_getHandlers(){const{inverse:t}=this.attribute;let e=this._startHandler,i=this._endHandler;return i?(this._isHorizontal?(!t&&i.attribute.x<(null==e?void 0:e.attribute.x)||t&&i.attribute.x>(null==e?void 0:e.attribute.x))&&([e,i]=[i,e]):(!t&&i.attribute.y<(null==e?void 0:e.attribute.y)||t&&i.attribute.y>(null==e?void 0:e.attribute.y))&&([e,i]=[i,e]),{startHandler:e,endHandler:i}):{startHandler:e,endHandler:i}}release(t){super.release(t),("browser"===Pu.env?Pu:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._clearAllDragEvents()}}cC.defaultAttributes={slidable:!0,layout:"horizontal",align:"bottom",height:8,showHandler:!0,handlerSize:14,handlerStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},tooltip:{shapeStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},text:{style:{fill:"#2C3542",fontSize:12}}},railStyle:{fill:"rgba(0,0,0,.04)"},trackStyle:{fill:"#91caff"},showValue:!0,valueStyle:{fill:"#2C3542",fontSize:12},startText:{style:{fill:"#2C3542",fontSize:12}},endText:{style:{fill:"#2C3542",fontSize:12}},handlerText:{visible:!0,space:4,precision:0,style:{fill:"#2C3542",fontSize:12}}},oC(),nC();class uC extends iC{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Lt({},uC.defaultAttributes,t)),this.name="colorLegend",this._onSliderToolipChange=t=>{const e=this._slider.tooltipShape;if(e&&t.detail&&!rt(t.detail.value)){const i=this._colorScale.scale(t.detail.value);e.setAttribute("fill",i)}this.dispatchEvent(t)},this._onSliderChange=t=>{this._updateColor(),this.dispatchEvent(t)}}setSelected(t){this._slider&&(this._slider.setValue(t),this._updateColor())}_renderContent(){const{colors:t,slidable:e,layout:i,align:n,min:o,max:r,value:s,railWidth:a,railHeight:l,showHandler:h=!0,handlerSize:d,handlerStyle:c,railStyle:u,trackStyle:g,startText:p,endText:f,handlerText:v,showTooltip:b,tooltip:m,inverse:y,disableTriggerEvent:C}=this.attribute,w=[],x=(r-o)/(t.length-1);for(let e=0;e<t.length;e++)w.push(o+x*e);this._colorScale=(new Iy).domain(w,!0).range(t),this._color=this._getTrackColor();const _=new cC({x:0,y:0,range:{draggableTrack:!0},slidable:e,layout:i,align:n,min:o,max:r,value:s,railWidth:a,railHeight:l,showHandler:h,handlerSize:d,handlerStyle:c,railStyle:u,trackStyle:Object.assign({fill:this._color},g),startText:p,endText:f,handlerText:v,showTooltip:b,tooltip:m,disableTriggerEvent:C,inverse:y});this._innerView.add(_),this._slider=_,_.translateTo(0-_.AABBBounds.x1,(this._title?this._title.AABBBounds.height()+St(this.attribute,"title.space",12):0)-_.AABBBounds.y1),this._updateColor()}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}_getTrackColor(){const{colors:t,layout:e,inverse:i}=this.attribute;if(_t(t))return;const n=t.length;if(1===n)return t[0];const o=[];for(let e=0;e<n;e++){const i=e/(n-1);o.push({offset:i,color:t[e]})}const r="horizontal"===e,s={gradient:"linear",stops:o,x0:0,y0:0,x1:r?1:0,y1:r?0:1};return i&&(r?(s.x0=1,s.x1=0):(s.y0=1,s.y1=0)),s}_updateColor(){var t;const{layout:e="horizontal",colors:i,railWidth:n,railHeight:o}=this.attribute,{startHandler:r,endHandler:s,track:a,attribute:l}=this._slider,{startValue:h,endValue:d,startPos:c,endPos:u}=this._slider.currentValue,g=null===(t=l.handlerStyle)||void 0===t?void 0:t.fill;if(r&&!g){const t=this._colorScale.scale(h);r.setAttribute("fill",t)}if(s&&!g){const t=this._colorScale.scale(d);s.setAttribute("fill",t)}const p="horizontal"===e?n:o;if(Math.abs(c-u)!==p&&i&&i.length>1){const t=this._color.stops,e=Math.min(c,u),i=Math.max(c,u),n=e/p,o=i/p,r=o-n,s=t.filter((t=>t.offset>n&&t.offset<o)),l=Math.min(h,d),g=Math.max(h,d),f=this._colorScale.scale(l),v=this._colorScale.scale(g),b=[{offset:0,color:f}];s.forEach((t=>{b.push({offset:(t.offset-n)/r,color:t.color})})),b.push({offset:1,color:v}),a.setAttribute("fill",Object.assign(Object.assign({},this._color),{stops:b}))}}}function gC(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bottom",e=0;return"top"===t?`\n    M${e},-6L${e-3.5},-2.5\n    v5\n    h7\n    v-5\n    Z\n`:"left"===t?(e=1,`\n    M${e-6},0L${e-6+2.5},-3.5\n    h5\n    v7\n    h-5\n    Z\n`):"right"===t?(e=-1,`\n    M${e+6},0L${e+6-2.5},-3.5\n    h-5\n    v7\n    h5\n    Z\n  `):`\n    M${e},6L${e-3.5},2.5\n    v-5\n    h7\n    v5\n    Z\n`}uC.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{fill:null,lineWidth:4,stroke:"#fff",outerBorder:{distance:2,lineWidth:1,stroke:"#ccc"}},tooltip:{shapeStyle:{lineWidth:4,stroke:"#fff"}}},oC(),nC(),Db();class pC extends iC{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Lt({},pC.defaultAttributes,t)),this.name="sizeLegend",this._onSliderChange=t=>{this.dispatchEvent(t)},this._onSliderToolipChange=t=>{this.dispatchEvent(t)}}setSelected(t){this._slider&&this._slider.setValue(t)}_renderContent(){const{slidable:t,layout:e,align:i,min:n,max:o,value:r,railWidth:s,railHeight:a,showHandler:l=!0,handlerSize:h,handlerStyle:d,railStyle:c,trackStyle:u,startText:g,endText:p,handlerText:f,showTooltip:v,tooltip:b,sizeBackground:m,disableTriggerEvent:y,inverse:C}=this.attribute,w=_h.group({x:0,y:0});this._innerView.add(w);const x=new cC({x:0,y:0,zIndex:1,range:{draggableTrack:!0},slidable:t,layout:e,align:i,min:n,max:o,value:r,railWidth:s,railHeight:a,showHandler:l,handlerSize:h,handlerStyle:Object.assign({symbolType:gC(i)},d),railStyle:c,trackStyle:u,startText:g,endText:p,handlerText:f,showTooltip:v,tooltip:b,disableTriggerEvent:y,inverse:C});w.add(x);let _,S=0;"horizontal"===e?"top"===i?(_=`M0,0L${s},0L${C?0:s},12Z`,S=a):(_=`M0,12L${s},12L${C?0:s},0Z`,x.setAttribute("y",12)):"left"===i?_=`M${s},0L${s+12},${C?0:a}L${s},${a}Z`:(_=`M0,${C?0:a}L12,${a}L12,0Z`,x.setAttribute("x",12));const A=_h.path(Object.assign(Object.assign({x:0,y:S,path:_},m),{zIndex:0}));w.add(A);const B=this._title?this._title.AABBBounds.height()+St(this.attribute,"title.space",12):0;w.translate(0-w.AABBBounds.x1,B-w.AABBBounds.y1),this._slider=x}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}}pC.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:1,stroke:"#ccc",fill:"#fff"},sizeBackground:{fill:"rgba(20,20,20,0.1)"}},Eb(),Zb(),Ub();let fC=class t extends Og{constructor(e,i){super((null==i?void 0:i.skipDefault)?e:Lt({},t.defaultAttributes,e)),this.name="title"}render(){var t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y;const{textType:C,text:w,subtextType:x,textStyle:_={},subtext:S,subtextStyle:A={},width:B,height:T,minWidth:R,maxWidth:k,minHeight:M,maxHeight:L,align:P,verticalAlign:E,padding:H=0}=this.attribute,O=ti(H),I=this.createOrUpdateChild("title-container",{x:O[3],y:O[0],zIndex:1},"group"),F=null!==(t=_.height)&&void 0!==t?t:T;if(!1!==this.attribute.visible&&!1!==_.visible){const{width:t,maxHeight:a,maxWidth:l,x:h=0,y:d=0,ellipsis:c=!0,wordBreak:u="break-word",maxWidth:g,lineClamp:p}=_;if("rich"===C||st(_.character)){const n=Object.assign({x:h,y:d,width:null!==(e=null!=t?t:B)&&void 0!==e?e:0,height:null!=F?F:0,ellipsis:null==c||c,wordBreak:null!=u?u:"break-word",maxHeight:null!=a?a:L,maxWidth:null!=l?l:g,textConfig:null!==(i=_.character)&&void 0!==i?i:w},_);this._mainTitle=I.createOrUpdateChild("mainTitle",n,"richtext")}else if("html"===C){const e=Object.assign({html:Object.assign(Object.assign({dom:w},om),_),x:h,y:d,width:null!==(n=null!=t?t:B)&&void 0!==n?n:0,height:null!=F?F:0,ellipsis:c,wordBreak:u,maxHeight:null!=a?a:L,maxWidth:null!=l?l:g,textConfig:[]},_);this._mainTitle=I.createOrUpdateChild("mainTitle",e,"richtext")}else st(w)&&(this._mainTitle=I.createOrUpdateChild("mainTitle",Object.assign(Object.assign({text:ut(w)?w:[w],whiteSpace:"normal"},_),{maxLineWidth:null!==(r=null!==(o=_.maxLineWidth)&&void 0!==o?o:t)&&void 0!==r?r:B,heightLimit:null!==(s=_.height)&&void 0!==s?s:L,lineClamp:p,ellipsis:c,x:h,y:d}),"text"))}const z=this._mainTitle?this._mainTitle.AABBBounds.height():0,D=this._mainTitle?this._mainTitle.AABBBounds.width():0;if(!1!==this.attribute.visible&&!1!==A.visible){const{width:t,height:e,maxWidth:i,maxHeight:n,x:o=0,y:r=0,ellipsis:s=!0,wordBreak:p="break-word",lineClamp:f}=A,v=Math.max(Number.MIN_VALUE,L-z);if("rich"===x||st(A.character)){const d=Object.assign({x:o,y:r,width:null!==(a=null!=t?t:B)&&void 0!==a?a:0,height:null!==(l=null!=e?e:T)&&void 0!==l?l:0,ellipsis:s,wordBreak:p,maxHeight:null!=n?n:v,maxWidth:null!=i?i:k,textConfig:null!==(h=A.character)&&void 0!==h?h:S},A);this._subTitle=I.createOrUpdateChild("subTitle",d,"richtext")}else if("html"===x){const a=Object.assign({html:Object.assign(Object.assign({dom:S},om),A),x:o,y:r,width:null!==(d=null!=t?t:B)&&void 0!==d?d:0,height:null!==(c=null!=e?e:T)&&void 0!==c?c:0,ellipsis:s,wordBreak:p,maxHeight:null!=n?n:v,maxWidth:null!=i?i:k,textConfig:[]},A);this._subTitle=I.createOrUpdateChild("subTitle",a,"richtext")}else st(S)&&(this._subTitle=I.createOrUpdateChild("subTitle",Object.assign(Object.assign({text:ut(S)?S:[S],whiteSpace:"normal"},A),{maxLineWidth:null!==(u=A.maxLineWidth)&&void 0!==u?u:B,heightLimit:null!==(g=A.heightLimit)&&void 0!==g?g:v,lineClamp:f,ellipsis:s,x:0,y:z}),"text"))}const W=this._subTitle?this._subTitle.AABBBounds.height():0,N=this._subTitle?this._subTitle.AABBBounds.width():0;let G=Math.max(D,N),j=z+(null!==(p=A.height)&&void 0!==p?p:W);if(st(B)&&(G=B),st(T)&&(j=T),st(R)&&G<R&&(G=R),st(k)&&G>k&&(G=k),st(M)&&j<M&&(j=M),st(L)&&j>L&&(j=L),I.attribute.width=G,I.attribute.height=j,I.attribute.boundsPadding=O,this._mainTitle){if(st(P)||st(_.align)){const t=_.align?_.align:P,e=null!==(f=_.width)&&void 0!==f?f:G;"center"===t?(this._mainTitle.setAttribute("x",e/2),this._mainTitle.setAttribute("textAlign","center")):"right"===t?(this._mainTitle.setAttribute("x",e),this._mainTitle.setAttribute("textAlign","right")):(this._mainTitle.setAttribute("x",0),this._mainTitle.setAttribute("textAlign","left"))}const t=_.verticalAlign?_.verticalAlign:E,e=null!=F?F:this._mainTitle.AABBBounds.empty()?0:this._mainTitle.AABBBounds.height();"middle"===t?(this._mainTitle.setAttribute("y",e/2),this._mainTitle.setAttribute("textBaseline","middle")):"bottom"===t?(this._mainTitle.setAttribute("y",e),this._mainTitle.setAttribute("textBaseline","bottom")):(this._mainTitle.setAttribute("y",0),this._mainTitle.setAttribute("textBaseline","top"))}if(this._subTitle){if(st(P)||st(A.align)){const t=A.align?A.align:P,e=null!==(b=null!==(v=A.width)&&void 0!==v?v:_.width)&&void 0!==b?b:G;"center"===t?(this._subTitle.setAttribute("x",e/2),this._subTitle.setAttribute("textAlign","center")):"right"===t?(this._subTitle.setAttribute("x",e),this._subTitle.setAttribute("textAlign","right")):(this._subTitle.setAttribute("x",0),this._subTitle.setAttribute("textAlign","left"))}const t=A.verticalAlign?A.verticalAlign:E,e=this._mainTitle?st(F)?this._mainTitle.AABBBounds.y1+Math.max(this._mainTitle.AABBBounds.empty()?0:this._mainTitle.AABBBounds.height(),F):this._mainTitle.AABBBounds.y2:0,i=null!==(y=null!==(m=A.height)&&void 0!==m?m:T)&&void 0!==y?y:this._subTitle.AABBBounds.empty()?0:this._subTitle.AABBBounds.height();"middle"===t?(this._subTitle.setAttribute("y",e+i/2),this._subTitle.setAttribute("textBaseline","middle")):"bottom"===t?(this._subTitle.setAttribute("y",e+i),this._subTitle.setAttribute("textBaseline","bottom")):(this._subTitle.setAttribute("y",e),this._subTitle.setAttribute("textBaseline","top"))}}};fC.defaultAttributes={textStyle:{ellipsis:"...",fill:"#333",fontSize:20,fontWeight:"bold",textAlign:"left",textBaseline:"top"},subtextStyle:{ellipsis:"...",fill:"#6F6F6F",fontSize:16,fontWeight:"normal",textAlign:"left",textBaseline:"top"}};Eb(),jb(),Zb(),Ob();class vC extends Og{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Lt({},vC.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?(this.setAttribute("checked",!1),this.setAttribute("indeterminate",!1)):(this.setAttribute("checked",!0),this.setAttribute("indeterminate",!1)),this._dispatchEvent("checkbox_state_change",{eventType:"checkbox_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(t,e,i)=>{"interactive"in t&&this.setAttribute("pickable",t.interactive),"disabled"in t&&this.setAttribute("cursor",t.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderIcon(),this.renderText(),this.layout()}renderBox(){this._box=new Kl(Lt({},this.attribute.box));const t=this.attribute.checked||this.attribute.indeterminate;t&&this.attribute.disabled?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill,stroke:this.attribute.box.disableCheckedStroke}):t?this._box.setAttributes({fill:this.attribute.box.checkedFill,stroke:this.attribute.box.checkedStroke}):this.attribute.disabled&&this._box.setAttributes({fill:this.attribute.box.disableFill}),this.appendChild(this._box)}renderIcon(){this._checkIcon=new eh(Lt({image:this.attribute.icon.checkIconImage},this.attribute.icon)),this.appendChild(this._checkIcon),this._indeterminateIcon=new eh(Lt({image:this.attribute.icon.indeterminateIconImage},this.attribute.icon)),this.appendChild(this._indeterminateIcon),this.attribute.checked?(this._checkIcon.setAttribute("visible",!0),this._indeterminateIcon.setAttribute("visible",!1)):this.attribute.indeterminate?(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!0)):(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!1))}renderText(){this._text=new Fl(Lt({wrap:!0},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=this.attribute.box.height,e=this.attribute.icon.height,i=this._text.AABBBounds.height(),n=Math.max(t,e,i),o=n/2-t/2,r=n/2-e/2,s=n/2-i/2,a=this.attribute.box.width,l=this.attribute.icon.width,h=Math.max(a,l),d=h/2-a/2,c=h/2-l/2,u=h+this.attribute.spaceBetweenTextAndIcon;this._box.setAttributes({x:d,y:o}),this._checkIcon.setAttributes({x:c,y:r}),this._indeterminateIcon.setAttributes({x:c,y:r}),this._text.setAttributes({x:u,y:s})}initAttributes(t,e){t=(null==e?void 0:e.skipDefault)?t:Lt({},vC.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}vC.defaultAttributes={interactive:!0,disabled:!1,checked:!1,indeterminate:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},icon:{checkIconImage:'<svg width="200" height="200" viewBox="0 0 1024 1024" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M877.44815445 206.10060629a64.72691371 64.72691371 0 0 0-95.14856334 4.01306852L380.73381888 685.46812814 235.22771741 533.48933518a64.72691371 64.72691371 0 0 0-92.43003222-1.03563036l-45.82665557 45.82665443a64.72691371 64.72691371 0 0 0-0.90617629 90.61767965l239.61903446 250.10479331a64.72691371 64.72691371 0 0 0 71.19960405 15.14609778 64.33855261 64.33855261 0 0 0 35.08198741-21.23042702l36.24707186-42.71976334 40.5190474-40.77795556-3.36579926-3.49525333 411.40426297-486.74638962a64.72691371 64.72691371 0 0 0-3.88361443-87.64024149l-45.3088404-45.43829334z"></path></svg>',indeterminateIconImage:'<svg width="200" height="200" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="5" d="M5 12h14"/></svg>',width:10,height:10,pickable:!1},box:{width:14,height:14,cornerRadius:2,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}},Eb(),jb(),Qb(),Ob();class bC extends Og{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Lt({},bC.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||this.attribute.checked||(this.setAttribute("checked",!0),this._dispatchEvent("radio_checked",{eventType:"radio_checked",target:this}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(t,e,i)=>{"interactive"in t&&this.setAttribute("pickable",t.interactive),"disabled"in t&&this.setAttribute("cursor",t.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderCircle(),this.renderText(),this.layout()}renderCircle(){this._circle=new vh(Lt({},this.attribute.circle));const t=this.attribute.checked;t&&this.attribute.disabled?this._circle.setAttributes({fill:this.attribute.circle.disableCheckedFill,stroke:this.attribute.circle.disableCheckedStroke}):t?this._circle.setAttributes({fill:this.attribute.circle.checkedFill,stroke:this.attribute.circle.checkedStroke}):this.attribute.disabled&&this._circle.setAttributes({fill:this.attribute.circle.disableFill}),this.appendChild(this._circle)}renderText(){this._text=new Fl(Lt({},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),e=this._text.AABBBounds.height(),i=Math.max(t,e),n=i/2-t/2+this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,o=i/2-e/2,r=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),s=this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,a=r+this.attribute.spaceBetweenTextAndIcon;this._circle.setAttributes({x:s,y:n}),this._text.setAttributes({x:a,y:o})}initAttributes(t,e){t=(null==e?void 0:e.skipDefault)?t:Lt({},bC.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}bC.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},circle:{outerRadius:7,innerRadius:3,startAngle:0,endAngle:2*Math.PI,lineWidth:1,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}};Eb(),Zb(),Ob();let mC=class t extends Og{constructor(e,i){super((null==i?void 0:i.skipDefault)?e:Lt({},t.defaultAttributes,e))}render(){this.removeAllChild(!0),this.renderIcon(),this.renderText(),this.layout()}renderIcon(){this._emptyTipIcon=new eh(Lt({image:this.attribute.icon.image},this.attribute.icon)),this.appendChild(this._emptyTipIcon)}renderText(){this._text=new Fl(Lt({wrap:!0},this.attribute.text)),this.appendChild(this._text)}layout(){const t=this.attribute.icon.height,e=this._text.AABBBounds.height(),i=this.attribute.icon.width,{width:n,height:o,spaceBetweenTextAndIcon:r}=this.attribute;this._emptyTipIcon.setAttribute("x",n/2-i/2),this._emptyTipIcon.setAttribute("y",o/2-t/2-e/2-r/2),this._text.setAttribute("x",n/2),this._text.setAttribute("textAlign","center"),this._text.setAttribute("y",o/2+t/2+r/2),this._text.setAttribute("textBaseline","middle")}};mC.defaultAttributes={spaceBetweenTextAndIcon:20,text:{text:"no data",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",pickable:!1},icon:{image:'<svg t="1716726614852" class="icon" viewBox="0 0 1194 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2621" width="200" height="200"><path d="M1038.694079 367.237067c13.265507 23.342857-16.633865-40.004445-63.05621-40.004446H219.018794c-26.558738 0-46.46393 13.334815-63.05621 40.004446S0.006238 607.277601 0.006238 650.608819V940.647979a82.351494 82.351494 0 0 0 82.961402 83.349526H1111.702885a82.337632 82.337632 0 0 0 82.975264-83.349526V650.608819c0-43.331218-155.970208-283.371753-155.970208-283.371752zM730.066575 667.284269a136.328386 136.328386 0 0 1-132.738243 133.33429 133.417459 133.417459 0 0 1-132.738243-133.33429v-6.681269a40.6698 40.6698 0 0 0-36.497473-26.66963H73.015044l119.458874-220.02445s23.231965-40.004445 53.103614-40.004446h713.481918c26.544876 0 29.871649 10.008042 46.436207 40.004446L1128.33675 633.947231H769.904682c-26.184476 0-39.838107 7.623855-39.838107 33.337038zM338.505391 210.559919l-89.601086-86.69016a22.178487 22.178487 0 0 1 0-33.26773 21.984425 21.984425 0 0 1 33.170699 0l89.601087 86.676299a22.317102 22.317102 0 0 1 0 33.26773 24.950798 24.950798 0 0 1-33.1707 0z m252.197118-40.059891a25.532983 25.532983 0 0 1-6.639685-16.633865l-3.326773-126.694606A28.263709 28.263709 0 0 1 603.995739 0.515788c13.251646-3.326773 23.204242 10.021904 26.544877 23.342858V153.866163a28.249847 28.249847 0 0 1-23.259688 26.66963c-6.611961-3.312911-13.279369-3.312911-16.578419-10.035765z m235.646421 33.337038a22.372548 22.372548 0 0 1 0-33.337038l86.288175-90.030795a22.039871 22.039871 0 0 1 33.170699 0 22.289379 22.289379 0 0 1 0 33.364761l-82.961401 90.003072a25.962691 25.962691 0 0 1-36.483611 0z" fill="#8a8a8a" p-id="2622"></path></svg>',width:100,height:100,pickable:!1}},Eb(),jb(),Zb(),Lb();class yC extends Og{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Lt({},yC.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?this.setAttribute("checked",!1):this.setAttribute("checked",!0),this._dispatchEvent("switch_state_change",{eventType:"switch_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(t,e,i)=>{"interactive"in t&&this.setAttribute("pickable",t.interactive),"disabled"in t&&this.setAttribute("cursor",t.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderCircle(),this.renderText(),this.layout()}renderBox(){this._box=new Kl(Lt({},this.attribute.box)),this.attribute.disabled&&this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill}):this.attribute.disabled&&!this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.disableUncheckedFill}):this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.checkedFill}):this._box.setAttributes({fill:this.attribute.box.uncheckedFill}),this.appendChild(this._box)}renderCircle(){this._circle=new El(Lt({},this.attribute.circle)),this.appendChild(this._circle)}renderText(){var t,e,i;this._text=new Fl(Lt({},null!==(t=this.attribute.text)&&void 0!==t?t:{})),this.attribute.checked&&(null===(e=this.attribute.text)||void 0===e?void 0:e.checkedText)?this._text.setAttributes({text:this.attribute.text.checkedText}):(null===(i=this.attribute.text)||void 0===i?void 0:i.uncheckedText)&&this._text.setAttributes({text:this.attribute.text.uncheckedText}),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){var t,e,i,n,o,r,s,a,l,h;const d=this.attribute.spaceBetweenTextAndCircle,c=this.attribute.circle.radius,u=this.attribute.box.height,g=2*c,p=this._text.AABBBounds.height(),f=Math.max(u,g,p),v=f/2-g/2+c,b=f/2-p/2,m=this.attribute.box.width,y=2*c,C=gm((null!==(i=null===(e=null===(t=this.attribute.text)||void 0===t?void 0:t.checkedText)||void 0===e?void 0:e.length)&&void 0!==i?i:0)>(null!==(r=null===(o=null===(n=this.attribute.text)||void 0===n?void 0:n.uncheckedText)||void 0===o?void 0:o.length)&&void 0!==r?r:0)?null!==(a=null===(s=this.attribute.text)||void 0===s?void 0:s.checkedText)&&void 0!==a?a:"":null!==(h=null===(l=this.attribute.text)||void 0===l?void 0:l.uncheckedText)&&void 0!==h?h:"",this._text.attribute).width,w=Math.max(m,y+C+3*d),x=u/2-y/2+c,_=x+c+d;this._box.setAttributes({width:w,height:f}),this._circle.setAttributes({y:v,x:this.attribute.checked?w-x:x}),this._text.setAttributes({x:this.attribute.checked?w-_-C:_,y:b})}initAttributes(t,e){t=(null==e?void 0:e.skipDefault)?t:Lt({},yC.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}yC.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",circle:{radius:8,fill:"#FFF",pickable:!1},box:{width:40,height:24,cornerRadius:12,uncheckedFill:"rgb(201,205,212)",checkedFill:"#165DFF",disableUncheckedFill:"rgb(242,243,245)",disableCheckedFill:"rgb(148,191,255)",pickable:!1},text:{textAlign:"left",textBaseline:"top",pickable:!1},spaceBetweenTextAndCircle:6};let CC=!1;function wC(){CC||(CC=!0,Lu(),Uu()?zp(fo):function(){Vu();const t=$n.global&&$n.global.env;return t?"node"===t:!ju}()&&iv(fo),kb(),Lb(),Eb(),Ob(),Fb(),jb(),Ub(),$b(),Kb(),Zb(),Eg(),fo.load(Im),Eg())}function xC(t,e){let i=null;return function(...n){i||(t.apply(this,n),i=setTimeout((()=>{i=null}),e))}}function _C(t,e){const i=t.getFullYear().toString(),n=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");if((e=(e=(e=e.replace("yyyy",i)).replace("mm",n)).replace("dd",o)).length>10){const i=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0"),o=t.getSeconds().toString().padStart(2,"0");e=(e=(e=e.replace("hh",i)).replace("mm",n)).replace("ss",o)}return e}function SC(t,e){const i=e.indexOf("yyyy"),n=e.indexOf("mm"),o=e.indexOf("dd"),r=n<i?n<o?0:1:n<o?1:2,s=o<i?o<n?0:1:o<n?1:2,a=parseInt(t[i<n?i<o?0:1:n<o?1:2],10),l=parseInt(t[r],10)-1,h=parseInt(t[s],10);if(isNaN(a)||a<1)return!1;if(isNaN(l)||l<0||l>11)return!1;const d=[31,BC(a)?29:28,31,30,31,30,31,31,30,31,30,31];return!(isNaN(h)||h<1||h>d[l])}function AC(t,e){if(e.includes("hh")||e.includes("mm")||e.includes("ss")){const i=e.indexOf("hh")>-1?e.indexOf("hh"):e.indexOf("HH"),n=parseInt(t[i],10),o=parseInt(t[i+1],10),r=t.length>i+2?parseInt(t[i+2],10):0;if(isNaN(n)||n<0||n>23)return!1;if(isNaN(o)||o<0||o>59)return!1;if(isNaN(r)||r<0||r>59)return!1}return!0}function BC(t){return t%4==0&&t%100!=0||t%400==0}function TC(t){const e=["yyyy-mm-dd","dd-mm-yyyy","mm/dd/yyyy","yyyy/mm/dd","dd/mm/yyyy","yyyy.mm.dd","mm.dd.yyyy","dd.mm.yyyy"],i=["hh:mm:ss","hh:mm"],n=(t=t.trim()).split(" "),o=n[0],r=n[1];let s,a;if(o)for(let t=0;t<e.length;t++){const i=e[t],n=o.split(RC(i)),r=SC(n,i);if(3===n.length&&r){s=i;break}}if(s&&r)for(let t=0;t<i.length;t++){const e=i[t],n=r.split(RC(e)),o=e.split(RC(e));if(AC(n,e)&&n.length===o.length){a=e;break}}return o&&r&&s&&a?s+" "+a:o&&!r?s:"yyyy-mm-dd hh:mm:ss"}function RC(t){const e=t.match(/[^\w]/g);if(e){const t=e.map((t=>"\\"+t)).join("|");return new RegExp(t,"g")}return/[^\w]/}function kC(t,e){const i=t.replace(/\{([^}]+)\}/g,((t,i)=>{const n=i.split(".");let o=e;for(const e of n){if(!o.hasOwnProperty(e)){o=t;break}o=o[e]}return o}));return i}function MC(t){return Array.isArray(t)?3===t.length?[t[0],t[1],t[2],t[1]]:2===t.length?[t[0],t[1],t[0],t[1]]:1===t.length?[t[0],t[0],t[0],t[0]]:[t[0],t[1],t[2],t[3]]:[t,t,t,t]}function LC(t){const e=new Date(t.getFullYear(),0,1);return Math.ceil(((t.getTime()+1-e.getTime())/864e5+1)/7)}function PC(t,e=!1){let i;if(t){if(i=new Date(t),"string"==typeof t){if(t.length>10)return e&&i.setHours(0,0,0,0),i;i.setHours(0,0,0,0)}}else i=new Date;return e&&i.setHours(0,0,0,0),i}function EC(t,e=!1){let i;if(t){if(i=new Date(t),"string"==typeof t){if(t.length>10)return e&&i.setMinutes(59,59,999),i;i.setMinutes(59,59,999)}}else i=new Date;return e&&i.setMinutes(59,59,999),i}function HC(t,e=!1){let i;if(t){if(i=new Date(t),"string"==typeof t){if(t.length>10)return e&&i.setSeconds(59,999),i;i.setSeconds(59,999)}}else i=new Date;return e&&i.setSeconds(59,999),i}function OC(t,e=!1){let i;if(t){if(i=new Date(t),"string"==typeof t){if(t.length>10)return e&&i.setMilliseconds(999),i;i.setMilliseconds(999)}}else i=new Date;return e&&i.setMilliseconds(999),i}function IC(t,e=!1){let i;if(t){if(i=new Date(t),"string"==typeof t){if(t.length>10)return e&&i.setHours(23,59,59,999),i;i.setHours(23,59,59,999)}}else i=new Date;return e&&i.setHours(23,59,59,999),i}function FC(t,e,i,n){let o=new Date(e);switch(i){case"second":o.setMilliseconds(999);break;case"minute":o.setSeconds(59,999);break;case"hour":o.setMinutes(59,59,999);break;case"day":o.setHours(23,59,59,999);break;case"week":const t=6-o.getDay();o.setDate(o.getDate()+t),o.setHours(23,59,59,999);break;case"month":const e=new Date(o.getFullYear(),o.getMonth()+1,0).getDate();o.setDate(e),o.setHours(23,59,59,999);break;case"quarter":const i=o.getMonth(),n=i-i%3+2,r=new Date(o.getFullYear(),n+1,0).getDate();o.setMonth(n,r),o.setHours(23,59,59,999);break;case"year":o.setMonth(11,31),o.setHours(23,59,59,999);break;default:throw new Error("Invalid time scale")}const r=DC(o,t,i,n,1),s=Math.ceil(r);if(s>r){const t=(s-r)*n,e=1e3,a=60*e,l=60*a,h=24*l,d=7*h;switch(new Date(o.getTime()+1),i){case"second":o.setTime(o.getTime()+t*e);break;case"minute":o.setTime(o.getTime()+t*a);break;case"hour":o.setTime(o.getTime()+t*l);break;case"day":o.setTime(o.getTime()+t*h);break;case"week":o.setTime(o.getTime()+t*d);break;case"month":o=new Date(o.getFullYear(),o.getMonth()+1+Math.round(t),0),o.setHours(23,59,59,999);break;case"quarter":const i=o.getMonth(),n=i-i%3+2;o=new Date(o.getFullYear(),n+Math.round(3*t)+1,0),o.setHours(23,59,59,999);break;case"year":o.setFullYear(o.getFullYear()+Math.floor(t)),o.setHours(23,59,59,999);break;default:throw new Error("Invalid time scale")}}return o}function zC(t,e,i="monday"){const n=new Date(t);switch(e){case"second":n.setMilliseconds(0);break;case"minute":n.setSeconds(0,0);break;case"hour":n.setMinutes(0,0,0);break;case"day":n.setHours(0,0,0,0);break;case"week":const t=n.getDay();let e=t;e="monday"===i?0===t?-6:1-t:-t,n.setDate(n.getDate()+e),n.setHours(0,0,0,0);break;case"month":n.setDate(1),n.setHours(0,0,0,0);break;case"quarter":const o=n.getMonth(),r=o-o%3;n.setMonth(r,1),n.setHours(0,0,0,0);break;case"year":n.setMonth(0,1),n.setHours(0,0,0,0);break;default:throw new Error("Invalid time scale")}return n}function DC(t,e,i,n,o=0){const r=36e5,s=864e5;let a;const l=new Date(t.getTime()+o);switch(i){case"second":a=(l.getTime()-e.getTime())/1e3;break;case"minute":a=(l.getTime()-e.getTime())/6e4;break;case"hour":a=(l.getTime()-e.getTime())/r;break;case"day":a=(l.getTime()-e.getTime())/s;break;case"week":a=(l.getTime()-e.getTime())/6048e5;break;case"month":a=12*(l.getFullYear()-e.getFullYear())+(l.getMonth()-e.getMonth()),a+=(l.getDate()-e.getDate())/new Date(l.getFullYear(),l.getMonth()+1,0).getDate();break;case"quarter":a=4*(l.getFullYear()-e.getFullYear())+(l.getMonth()-e.getMonth())/3,a+=(l.getDate()-e.getDate())/(3*new Date(l.getFullYear(),l.getMonth()+1,0).getDate());break;case"year":a=l.getFullYear()-e.getFullYear(),a+=(l.getMonth()-e.getMonth())/12;break;default:throw new Error("Invalid time scale")}return a/n}class WC{gridStyle;scrollLeft;scrollTop;x;y;width;height;rowHeight;rowCount;group;verticalLineGroup;horizontalLineGroup;verticalBackgroundRectsGroup;horizontalBackgroundRectsGroup;allGridHeight;allGridWidth;_scene;constructor(t){this._scene=t,this.scrollLeft=0,this.scrollTop=0,this.x=0,this.y=t._gantt.getAllHeaderRowsHeight(),this.width=t.ganttGroup.attribute.width,this.height=t.ganttGroup.attribute.height-t.timelineHeader.group.attribute.height,this.rowHeight=t._gantt.parsedOptions.rowHeight,this.rowCount=t._gantt.itemCount,this.allGridWidth=t._gantt.getAllDateColsWidth(),this.allGridHeight=t._gantt.getAllTaskBarsHeight(),this.group=new Ea({x:this.x,y:this.y,width:this.width,height:this.height,clip:!0,fill:t._gantt.parsedOptions.grid?.backgroundColor}),this.group.name="grid-container",t.ganttGroup.addChild(this.group),this.createVerticalBackgroundRects(),this.createHorizontalBackgroundRects(),this.createVerticalLines(),this.createHorizontalLines(),this.createTimeLineHeaderBottomLine()}createTimeLineHeaderBottomLine(){const t=this._scene._gantt.parsedOptions,e=t.horizontalSplitLine?.lineWidth??t.timelineHeaderHorizontalLineStyle?.lineWidth,i=(1&e?-.5:0)+e/2,n=$l({pickable:!1,stroke:t.horizontalSplitLine?.lineColor??t.timelineHeaderHorizontalLineStyle?.lineColor,lineWidth:e+(1&e?1:0),points:[{x:0,y:i},{x:this._scene._gantt.getAllDateColsWidth(),y:i}]});n.name="timeLine-header-bottom-line",this.group.addChild(n)}createVerticalLines(){const t=this._scene._gantt.parsedOptions.grid,e=t.verticalLineDependenceOnTimeScale??this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0].unit;if(t.verticalLine){this.verticalLineGroup=new Ea({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.verticalLineGroup.name="grid-vertical",this.group.appendChild(this.verticalLineGroup);const i=this._scene._gantt.parsedOptions.reverseSortedTimelineScales.find((t=>t.unit===e))??this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],{unit:n,step:o}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],{timelineDates:r}=i,s=this._scene._gantt.parsedOptions.timelineColWidth;if("function"==typeof t.verticalLine)for(let e=0;e<r?.length-1;e++){const{endDate:i}=r[e],a=t.verticalLine({index:e,dateIndex:r[e].dateIndex,date:r[e].endDate,ganttInstance:this._scene._gantt}),l=Math.ceil(DC(i,this._scene._gantt.parsedOptions.minDate,n,o,1)*s)+(1&a.lineWidth?.5:0),h=$l({pickable:!1,stroke:a.lineColor,lineWidth:a.lineWidth,points:[{x:l,y:0},{x:l,y:this.allGridHeight}]});this.verticalLineGroup.appendChild(h)}else{const e=t.verticalLine;for(let t=0;t<r?.length-1;t++){const{endDate:i}=r[t],a=Math.ceil(DC(i,this._scene._gantt.parsedOptions.minDate,n,o,1)*s)+(1&e.lineWidth?.5:0),l=$l({pickable:!1,stroke:e.lineColor,lineWidth:e.lineWidth,points:[{x:a,y:0},{x:a,y:this.allGridHeight}]});this.verticalLineGroup.appendChild(l)}}}}createHorizontalLines(){const t=this._scene._gantt.parsedOptions.grid;if(t.horizontalLine)if(this.horizontalLineGroup=new Ea({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.horizontalLineGroup.name="grid-horizontal",this.group.appendChild(this.horizontalLineGroup),"function"==typeof t.horizontalLine){let e=.5;for(let i=0;i<this.rowCount-1;i++){const n=t.horizontalLine({index:i,ganttInstance:this._scene._gantt});e+=this._scene._gantt.getRowHeightByIndex(i);const o=$l({pickable:!1,stroke:n.lineColor,lineWidth:n.lineWidth,points:[{x:0,y:e},{x:this.allGridWidth,y:e}]});this.horizontalLineGroup.appendChild(o)}}else{const e=t.horizontalLine;let i=0;1&e.lineWidth&&(i+=.5);for(let t=0;t<this.rowCount-1;t++){i+=this._scene._gantt.getRowHeightByIndex(t);const n=$l({pickable:!1,stroke:e.lineColor,lineWidth:e.lineWidth,points:[{x:0,y:i},{x:this.allGridWidth,y:i}]});this.horizontalLineGroup.appendChild(n)}}}createVerticalBackgroundRects(){const t=this._scene._gantt.parsedOptions.grid.verticalBackgroundColor,e=this._scene._gantt.parsedOptions.grid.weekendBackgroundColor;if(t||e){this.verticalBackgroundRectsGroup=new Ea({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.verticalBackgroundRectsGroup.name="grid-vertical-background",this.group.appendChild(this.verticalBackgroundRectsGroup);const{timelineDates:i,unit:n,step:o}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],r=this._scene._gantt.parsedOptions.timelineColWidth;if(t||e)for(let s=0;s<=i?.length-1;s++){let a;if(!e||"day"!==n||1!==o||0!==i[s].startDate.getDay()&&6!==i[s].startDate.getDay()?"function"==typeof t?a=t({index:s,dateIndex:i[s].dateIndex,date:i[s].endDate,ganttInstance:this._scene._gantt}):t&&(a=t[s%t.length]):a=e,a){const t=ql({pickable:!1,fill:a,x:Math.ceil(r*s),y:0,width:r,height:this.allGridHeight});this.verticalBackgroundRectsGroup.appendChild(t)}}}}createHorizontalBackgroundRects(){const t=this._scene._gantt.parsedOptions.grid.horizontalBackgroundColor;if(t){this.horizontalBackgroundRectsGroup=new Ea({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.horizontalBackgroundRectsGroup.name="grid-horizontal-background",this.group.appendChild(this.horizontalBackgroundRectsGroup);let e=0;for(let i=0;i<=this.rowCount-1;i++){let n;n="function"==typeof t?t({index:i,ganttInstance:this._scene._gantt}):t[i%t.length];const o=ql({pickable:!1,fill:n,x:0,y:e,width:this.allGridWidth,height:this._scene._gantt.getRowHeightByIndex(i)});this.horizontalBackgroundRectsGroup.appendChild(o),e+=this._scene._gantt.getRowHeightByIndex(i)}}}refresh(){this.width=this._scene.ganttGroup.attribute.width,this.height=this._scene.ganttGroup.attribute.height-this._scene.timelineHeader.group.attribute.height,this.group.setAttributes({width:this.width,height:this.height,y:this._scene._gantt.getAllHeaderRowsHeight()}),this.rowCount=this._scene._gantt.itemCount,this.allGridWidth=this._scene._gantt.getAllDateColsWidth(),this.allGridHeight=this._scene._gantt.getAllTaskBarsHeight(),this.group.removeAllChild(),this.createVerticalBackgroundRects(),this.createHorizontalBackgroundRects(),this.createVerticalLines(),this.createHorizontalLines(),this.createTimeLineHeaderBottomLine()}setX(t){this.verticalLineGroup?.setAttribute("x",t),this.horizontalLineGroup?.setAttribute("x",t),this.verticalBackgroundRectsGroup?.setAttribute("x",t),this.horizontalBackgroundRectsGroup?.setAttribute("x",t)}setY(t){this.verticalLineGroup?.setAttribute("y",t),this.horizontalLineGroup?.setAttribute("y",t),this.verticalBackgroundRectsGroup?.setAttribute("y",t),this.horizontalBackgroundRectsGroup?.setAttribute("y",t)}resize(){this.width=this._scene.ganttGroup.attribute.width,this.height=this._scene.ganttGroup.attribute.height-this._scene.timelineHeader.group.attribute.height,this.group.setAttribute("width",this.width),this.group.setAttribute("height",this.height)}}let NC=class t{static _mode;static get mode(){return t._mode||(t._mode=function(){let t="browser";try{"node"===window.type?t="node":"undefined"==typeof window||window.performance?"undefined"==typeof window&&(t="node"):t="miniApp"}catch(e){t="node"}return t}()),t._mode}static set mode(e){t._mode=e}static dpr=0;static CreateCanvas;static LoadImage;static RequestAnimationFrame;static CancelAnimationFrame;static RegisterCreateCanvas(e){t.CreateCanvas=e}static RegisterLoadImage(e){t.LoadImage=e}static GetCreateCanvasFunc(){return t.CreateCanvas?t.CreateCanvas:"worker"===t.mode?(t=200,e=200)=>new OffscreenCanvas(t,e):void 0}static RegisterRequestAnimationFrame(e){t.RequestAnimationFrame=e()}static GetRequestAnimationFrame(){if(t.RequestAnimationFrame)return t.RequestAnimationFrame}static RegisterCancelAnimationFrame(e){t.CancelAnimationFrame=e()}static GetCancelAnimationFrame(){if(t.CancelAnimationFrame)return t.CancelAnimationFrame}};var GC=(t,e)=>Object.prototype.toString.call(t)===`[object ${e}]`;var jC=function(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"boolean"==typeof t:!0===t||!1===t||GC(t,"Boolean")};var VC=t=>"function"==typeof t;var UC=t=>null==t;var XC=t=>null!=t;var $C=t=>{const e=typeof t;return null!==t&&"object"===e||"function"===e};var YC=t=>"object"==typeof t&&null!==t;var KC=function(t){if(!YC(t)||!GC(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};var qC=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"string"===e:"string"===e||GC(t,"String")};var ZC=t=>Array.isArray?Array.isArray(t):GC(t,"Array");var JC=function(t){return null!==t&&"function"!=typeof t&&Number.isFinite(t.length)};var QC=t=>GC(t,"Date");var tw=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"number"===e:"number"===e||GC(t,"Number")};var ew=t=>tw(t)&&Number.isFinite(t);var iw=t=>({}.toString.call(t).replace(/^\[object /,"").replace(/]$/,""));const nw=Object.prototype;var ow=function(t){const e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||nw)};const rw=Object.prototype.hasOwnProperty;function sw(t){if(UC(t))return!0;if(JC(t))return!t.length;const e=iw(t);if("Map"===e||"Set"===e)return!t.size;if(ow(t))return!Object.keys(t).length;for(const e in t)if(rw.call(t,e))return!1;return!0}var aw=(t,e,i)=>{const n=qC(e)?e.split("."):e;for(let e=0;e<n.length;e++)t=t?t[n[e]]:void 0;return void 0===t?i:t};function lw(t,e,i){let n;if(!XC(t)||"object"!=typeof t||e&&e(t))return t;const o=ZC(t),r=t.length;n=o?new Array(r):"object"==typeof t?{}:jC(t)||tw(t)||qC(t)?t:QC(t)?new Date(+t):void 0;const s=o?void 0:Object.keys(Object(t));let a=-1;if(n)for(;++a<(s||t).length;){const o=s?s[a]:a,r=t[o];i&&i.includes(o.toString())?n[o]=r:n[o]=lw(r,e,i)}return n}function hw(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e){if(t===e)return;if(XC(e)&&"object"==typeof e){const o=Object(e),r=[];for(const t in o)r.push(t);let{length:s}=r,a=-1;for(;s--;){const s=r[++a];!XC(o[s])||"object"!=typeof o[s]||n&&ZC(t[s])?cw(t,s,o[s]):dw(t,e,s,i,n)}}}}function dw(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=t[i],s=e[i];let a=e[i],l=!0;if(ZC(s)){if(n)a=[];else if(ZC(r))a=r;else if(JC(r)){a=new Array(r.length);let t=-1;const e=r.length;for(;++t<e;)a[t]=r[t]}}else KC(s)?(a=null!=r?r:{},"function"!=typeof r&&"object"==typeof r||(a={})):l=!1;l&&hw(a,s,n,o),cw(t,i,a)}function cw(t,e,i){(void 0!==i&&!function(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}(t[e],i)||void 0===i&&!(e in t))&&(t[e]=i)}function uw(t){let e=-1;const i=arguments.length<=1?0:arguments.length-1;for(;++e<i;)hw(t,e+1<1||arguments.length<=e+1?void 0:arguments[e+1],!0);return t}function gw(t){return Object.prototype.toString.call(t)}function pw(t){return Object.keys(t)}function fw(t,e,i){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(null==t||null==e)return!1;if(Number.isNaN(t)&&Number.isNaN(e))return!0;if(gw(t)!==gw(e))return!1;if(VC(t))return!!(null==i?void 0:i.skipFunction);if("object"!=typeof t)return!1;if(ZC(t)){if(t.length!==e.length)return!1;for(let n=t.length-1;n>=0;n--)if(!fw(t[n],e[n],i))return!1;return!0}if(!KC(t))return!1;const n=pw(t),o=pw(e);if(n.length!==o.length)return!1;n.sort(),o.sort();for(let t=n.length-1;t>=0;t--)if(n[t]!=o[t])return!1;for(let o=n.length-1;o>=0;o--){const r=n[o];if(!fw(t[r],e[r],i))return!1}return!0}function vw(t){return t*(Math.PI/180)}const bw=t=>{let e=t.charCodeAt(0),i=2===t.length?t.charCodeAt(1):0,n=e;return 55296<=e&&e<=56319&&56320<=i&&i<=57343&&(e&=1023,i&=1023,n=e<<10|i,n+=65536),12288===n||65281<=n&&n<=65376||65504<=n&&n<=65510?"F":8361===n||65377<=n&&n<=65470||65474<=n&&n<=65479||65482<=n&&n<=65487||65490<=n&&n<=65495||65498<=n&&n<=65500||65512<=n&&n<=65518?"H":4352<=n&&n<=4447||4515<=n&&n<=4519||4602<=n&&n<=4607||9001<=n&&n<=9002||11904<=n&&n<=11929||11931<=n&&n<=12019||12032<=n&&n<=12245||12272<=n&&n<=12283||12289<=n&&n<=12350||12353<=n&&n<=12438||12441<=n&&n<=12543||12549<=n&&n<=12589||12593<=n&&n<=12686||12688<=n&&n<=12730||12736<=n&&n<=12771||12784<=n&&n<=12830||12832<=n&&n<=12871||12880<=n&&n<=13054||13056<=n&&n<=19903||19968<=n&&n<=42124||42128<=n&&n<=42182||43360<=n&&n<=43388||44032<=n&&n<=55203||55216<=n&&n<=55238||55243<=n&&n<=55291||63744<=n&&n<=64255||65040<=n&&n<=65049||65072<=n&&n<=65106||65108<=n&&n<=65126||65128<=n&&n<=65131||110592<=n&&n<=110593||127488<=n&&n<=127490||127504<=n&&n<=127546||127552<=n&&n<=127560||127568<=n&&n<=127569||131072<=n&&n<=194367||177984<=n&&n<=196605||196608<=n&&n<=262141?"W":32<=n&&n<=126||162<=n&&n<=163||165<=n&&n<=166||172===n||175===n||10214<=n&&n<=10221||10629<=n&&n<=10630?"Na":161===n||164===n||167<=n&&n<=168||170===n||173<=n&&n<=174||176<=n&&n<=180||182<=n&&n<=186||188<=n&&n<=191||198===n||208===n||215<=n&&n<=216||222<=n&&n<=225||230===n||232<=n&&n<=234||236<=n&&n<=237||240===n||242<=n&&n<=243||247<=n&&n<=250||252===n||254===n||257===n||273===n||275===n||283===n||294<=n&&n<=295||299===n||305<=n&&n<=307||312===n||319<=n&&n<=322||324===n||328<=n&&n<=331||333===n||338<=n&&n<=339||358<=n&&n<=359||363===n||462===n||464===n||466===n||468===n||470===n||472===n||474===n||476===n||593===n||609===n||708===n||711===n||713<=n&&n<=715||717===n||720===n||728<=n&&n<=731||733===n||735===n||768<=n&&n<=879||913<=n&&n<=929||931<=n&&n<=937||945<=n&&n<=961||963<=n&&n<=969||1025===n||1040<=n&&n<=1103||1105===n||8208===n||8211<=n&&n<=8214||8216<=n&&n<=8217||8220<=n&&n<=8221||8224<=n&&n<=8226||8228<=n&&n<=8231||8240===n||8242<=n&&n<=8243||8245===n||8251===n||8254===n||8308===n||8319===n||8321<=n&&n<=8324||8364===n||8451===n||8453===n||8457===n||8467===n||8470===n||8481<=n&&n<=8482||8486===n||8491===n||8531<=n&&n<=8532||8539<=n&&n<=8542||8544<=n&&n<=8555||8560<=n&&n<=8569||8585===n||8592<=n&&n<=8601||8632<=n&&n<=8633||8658===n||8660===n||8679===n||8704===n||8706<=n&&n<=8707||8711<=n&&n<=8712||8715===n||8719===n||8721===n||8725===n||8730===n||8733<=n&&n<=8736||8739===n||8741===n||8743<=n&&n<=8748||8750===n||8756<=n&&n<=8759||8764<=n&&n<=8765||8776===n||8780===n||8786===n||8800<=n&&n<=8801||8804<=n&&n<=8807||8810<=n&&n<=8811||8814<=n&&n<=8815||8834<=n&&n<=8835||8838<=n&&n<=8839||8853===n||8857===n||8869===n||8895===n||8978===n||9312<=n&&n<=9449||9451<=n&&n<=9547||9552<=n&&n<=9587||9600<=n&&n<=9615||9618<=n&&n<=9621||9632<=n&&n<=9633||9635<=n&&n<=9641||9650<=n&&n<=9651||9654<=n&&n<=9655||9660<=n&&n<=9661||9664<=n&&n<=9665||9670<=n&&n<=9672||9675===n||9678<=n&&n<=9681||9698<=n&&n<=9701||9711===n||9733<=n&&n<=9734||9737===n||9742<=n&&n<=9743||9748<=n&&n<=9749||9756===n||9758===n||9792===n||9794===n||9824<=n&&n<=9825||9827<=n&&n<=9829||9831<=n&&n<=9834||9836<=n&&n<=9837||9839===n||9886<=n&&n<=9887||9918<=n&&n<=9919||9924<=n&&n<=9933||9935<=n&&n<=9953||9955===n||9960<=n&&n<=9983||10045===n||10071===n||10102<=n&&n<=10111||11093<=n&&n<=11097||12872<=n&&n<=12879||57344<=n&&n<=63743||65024<=n&&n<=65039||65533===n||127232<=n&&n<=127242||127248<=n&&n<=127277||127280<=n&&n<=127337||127344<=n&&n<=127386||917760<=n&&n<=917999||983040<=n&&n<=1048573||1048576<=n&&n<=1114109?"A":"N"};class mw{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet="-/: .,@%'\"~",this._option=t,this._userSpec=null!=e?e:{},this.textSpec=this._initSpec(),XC(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=XC(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(UC(this._canvas)&&(XC(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),UC(this._canvas)&&"undefined"!=typeof window&&void 0!==window.document&&globalThis&&XC(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),UC(this._context)&&XC(this._canvas)){const t=this._canvas.getContext("2d");XC(t)&&(t.save(),t.font=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;i||(i=1);const{fontStyle:n=e.fontStyle,fontVariant:o=e.fontVariant,fontWeight:r=e.fontWeight,fontSize:s=e.fontSize,fontFamily:a=e.fontFamily}=t;return(n?n+" ":"")+(o?o+" ":"")+(r?r+" ":"")+s*i+"px "+(a||"sans-serif")}(this.textSpec),this._contextSaved=!0,this._context=t)}return!UC(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:n={}}=this._option,{fontStyle:o=n.fontStyle,fontVariant:r=n.fontVariant,fontWeight:s=(null!==(t=n.fontWeight)&&void 0!==t?t:"normal"),fontSize:a=(null!==(e=n.fontSize)&&void 0!==e?e:12),fontFamily:l=(null!==(i=n.fontFamily)&&void 0!==i?i:"sans-serif"),align:h,textAlign:d=(null!=h?h:"center"),baseline:c,textBaseline:u=(null!=c?c:"middle"),ellipsis:g,limit:p}=this._userSpec;let{lineHeight:f=a}=this._userSpec;if(qC(f)&&"%"===f[f.length-1]){const t=Number.parseFloat(f.substring(0,f.length-1))/100;f=a*t}return{fontStyle:o,fontVariant:r,fontFamily:l,fontSize:a,fontWeight:s,textAlign:d,textBaseline:u,ellipsis:g,limit:p,lineHeight:f}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(UC(t))return{width:0,height:0};if(UC(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:n,textAlign:o,textBaseline:r,ellipsis:s,limit:a,lineHeight:l}=this.textSpec;let h;try{const d=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:n,textAlign:o,textBaseline:r,ellipsis:!!s,maxLineWidth:a||1/0,lineHeight:l});h={width:d.width(),height:d.height()}}catch(e){this._notSupportVRender=!0,h=this.measureWithNaiveCanvas(t)}return h}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:n,lineHeight:o}=this.textSpec;return{width:i.width,height:null!==(e=o)&&void 0!==e?e:n,fontBoundingBoxAscent:i.fontBoundingBoxAscent,fontBoundingBoxDescent:i.fontBoundingBoxDescent}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(t){const e={width:0,height:0};for(let i=0;i<t.length;i++){const n=t[i];let o=this._measureSpecialChar(n);UC(o)&&mw.NUMBERS_CHAR_SET.includes(n)&&(o=this._measureNumberChar()),UC(o)&&["F","W"].includes(bw(n))&&(o=this._measureFullSizeChar()),UC(o)&&(o=this._measureLetterChar()),e.width+=o.width,e.height=Math.max(e.height,o.height),!UC(o.fontBoundingBoxAscent)&&(e.fontBoundingBoxAscent=o.fontBoundingBoxAscent),!UC(o.fontBoundingBoxDescent)&&(e.fontBoundingBoxDescent=o.fontBoundingBoxDescent)}return e}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:n,lineHeight:o}=this.textSpec;for(let e=0;e<t.length;e++){const o=t[e],r=["F","W"].includes(bw(o))?1:.53;i.width+=r*n}return i.height=null!==(e=o)&&void 0!==e?e:n,i}_measureReduce(t,e){var i;const{fontSize:n,lineHeight:o}=this.textSpec,r={width:0,height:0};if(UC(t))return r;if(ZC(t)){const s=t.filter(XC).map((t=>t.toString()));return 0===s.length?r:1===s.length?e(s[0]):{width:s.reduce(((t,i)=>Math.max(t,e(i).width)),0),height:s.length*((null!==(i=o)&&void 0!==i?i:n)+1)+1}}return e(t.toString())}_measureNumberChar(){if(UC(this._numberCharSize)){const t=this._standardMethod(mw.NUMBERS_CHAR_SET);this._numberCharSize={width:t.width/mw.NUMBERS_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return UC(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(mw.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(UC(this._letterCharSize)){const t=this._standardMethod(mw.ALPHABET_CHAR_SET);this._letterCharSize={width:t.width/mw.ALPHABET_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(t){return XC(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){XC(this._canvas)&&(this._canvas=null),XC(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}}mw.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",mw.NUMBERS_CHAR_SET="0123456789",mw.FULL_SIZE_CHAR="字";class yw{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new yw(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.x1=t,this.y1=e,this.x2=i,this.y2=n,this}set(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),n<e?(this.y2=e,this.y1=n):(this.y1=e,this.y2=n),this}add(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return ZC(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=this.rotatedPoints(t,e,i);return this.clear().add(n[0],n[1]).add(n[2],n[3]).add(n[4],n[5]).add(n[6],n[7])}scale(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=this.scalePoints(t,e,i,n);return this.clear().add(o[0],o[1]).add(o[2],o[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.x1*=t,this.x2*=t,this}scaleY(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return function(t,e,i){const{x1:n,y1:o,x2:r,y2:s}=e;i.onlyTranslate()?(t!==e&&t.setValue(e.x1,e.y1,e.x2,e.y2),t.translate(i.e,i.f)):(t.clear(),t.add(i.a*n+i.c*o+i.e,i.b*n+i.d*o+i.f),t.add(i.a*r+i.c*o+i.e,i.b*r+i.d*o+i.f),t.add(i.a*r+i.c*s+i.e,i.b*r+i.d*s+i.f),t.add(i.a*n+i.c*s+i.e,i.b*n+i.d*s+i.f))}(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:n,y1:o,x2:r,y2:s}=this,a=Math.cos(t),l=Math.sin(t),h=e-e*a+i*l,d=i-e*l-i*a;return[a*n-l*o+h,l*n+a*o+d,a*n-l*s+h,l*n+a*s+d,a*r-l*o+h,l*r+a*o+d,a*r-l*s+h,l*r+a*s+d]}scalePoints(t,e,i,n){const{x1:o,y1:r,x2:s,y2:a}=this;return[t*o+(1-t)*i,e*r+(1-e)*n,t*s+(1-t)*i,e*a+(1-e)*n]}}class Cw extends yw{}class ww{hScrollBar;vScrollBar;_gantt;_clearHorizontalScrollBar;_clearVerticalScrollBar;constructor(t){this._gantt=t,this.createScrollBar(t.tableNoFrameWidth,t.tableNoFrameHeight-t.getAllHeaderRowsHeight())}createScrollBar(t,e){const i=this._gantt.parsedOptions.scrollStyle.scrollRailColor,n=this._gantt.parsedOptions.scrollStyle.scrollSliderColor,o=this._gantt.parsedOptions.scrollStyle.scrollSliderCornerRadius,r=this._gantt.parsedOptions.scrollStyle.width;let s;s=XC(o)?{cornerRadius:o,fill:n}:{fill:n},this._gantt.parsedOptions.scrollStyle?.visible,this._gantt.parsedOptions.scrollStyle?.hoverOn,this.hScrollBar=new am({direction:"horizontal",x:2*-t,y:2*-e,width:t,height:r,padding:0,railStyle:{fill:i},sliderStyle:s,range:[0,.1],visible:!1}),this.hScrollBar.render(),this.hScrollBar.hideAll(),this.vScrollBar=new am({direction:"vertical",x:2*-t,y:2*-e,width:r,height:e,padding:0,railStyle:{fill:i},sliderStyle:s,range:[0,.1],visible:!1}),this.vScrollBar.render(),this.vScrollBar.hideAll()}refresh(){}hideVerticalScrollBar(){const t=this._gantt.parsedOptions.scrollStyle.visible;"focus"!==t&&"scrolling"!==t||(this.vScrollBar.setAttribute("visible",!1),this.vScrollBar.hideAll(),this._gantt.scenegraph.updateNextFrame())}showVerticalScrollBar(t){const e=this._gantt.parsedOptions.scrollStyle.visible;"focus"!==e&&"scrolling"!==e||(this.vScrollBar.setAttribute("visible",!0),this.vScrollBar.showAll(),this._gantt.scenegraph.updateNextFrame(),t&&(clearTimeout(this._clearVerticalScrollBar),this._clearVerticalScrollBar=setTimeout((()=>{this.hideVerticalScrollBar()}),1e3)))}hideHorizontalScrollBar(){const t=this._gantt.parsedOptions.scrollStyle.visible;"focus"!==t&&"scrolling"!==t||(this.hScrollBar.setAttribute("visible",!1),this.hScrollBar.hideAll(),this._gantt.scenegraph.updateNextFrame())}showHorizontalScrollBar(t){const e=this._gantt.parsedOptions.scrollStyle.visible;"focus"!==e&&"scrolling"!==e||(this.hScrollBar.setAttribute("visible",!0),this.hScrollBar.showAll(),this._gantt.scenegraph.updateNextFrame(),t&&(clearTimeout(this._clearHorizontalScrollBar),this._clearHorizontalScrollBar=setTimeout((()=>{this.hideHorizontalScrollBar()}),1e3)))}updateVerticalScrollBarPos(t){const e=this.vScrollBar.attribute.range,i=e[1]-e[0],n=t*(1-i);this.vScrollBar.setAttribute("range",[n,n+i]);const o=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:o.x1,y:o.y1}}updateHorizontalScrollBarPos(t){const e=this.hScrollBar.attribute.range,i=e[1]-e[0],n=t*(1-i);this.hScrollBar.setAttribute("range",[n,n+i]);const o=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:o.x1,y:o.y1}}updateScrollBar(){const t=this._gantt.stateManager.scroll.horizontalBarPos,e=this._gantt.stateManager.scroll.verticalBarPos,i=this._gantt.parsedOptions.scrollStyle,n=i?.width,o=i?.visible,r=Math.ceil(this._gantt.scenegraph.ganttGroup.attribute.width),s=Math.ceil(this._gantt.scenegraph.ganttGroup.attribute.height),a=this._gantt.getAllRowsHeight(),l=this._gantt.getAllDateColsWidth(),h=this._gantt.getAllHeaderRowsHeight();if(l>r){const t=Math.min(s,a),e=Math.max(.05,r/l),h=i.hoverOn;let d=0;d=i.barToSide?this._gantt.tableNoFrameHeight-(h?n:-this._gantt.scenegraph.ganttGroup.attribute.y)+this._gantt.tableY:t-(h?n:-this._gantt.scenegraph.ganttGroup.attribute.y)+this._gantt.tableY,this.hScrollBar.setAttributes({x:this._gantt.scenegraph.ganttGroup.attribute.x,y:d,width:r,range:[0,e],visible:"always"===o});const c=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:c.x1,y:c.y1},"always"===o&&this.hScrollBar.showAll()}else this.hScrollBar.setAttributes({x:2*-this._gantt.tableNoFrameWidth,y:2*-this._gantt.tableNoFrameHeight,width:0,visible:!1});if(a>s){const t=Math.min(r,l)+this._gantt.scenegraph.ganttGroup.attribute.x,e=Math.max(.05,(s-h)/(a-h));let i=0;const d=this._gantt.parsedOptions.scrollStyle.hoverOn;i=this._gantt.parsedOptions.scrollStyle.barToSide?this._gantt.tableNoFrameWidth-(d?n:-this._gantt.scenegraph.ganttGroup.attribute.x):t-(d?n:-this._gantt.scenegraph.ganttGroup.attribute.x),this.vScrollBar.setAttributes({x:i,y:h+(d?0:this._gantt.scenegraph.ganttGroup.attribute.y)+this._gantt.tableY,height:s-h,range:[0,e],visible:"always"===o});const c=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:c.x1,y:c.y1},"always"===o&&this.vScrollBar.showAll()}else this.vScrollBar.setAttributes({x:2*-this._gantt.tableNoFrameWidth,y:2*-this._gantt.tableNoFrameHeight,height:0,visible:!1});this._gantt.stateManager.setScrollLeft(t),this._gantt.stateManager.setScrollTop(e)}}function xw(t,e,i,n=!0){let{deltaX:o,deltaY:r}=t;t.shiftKey&&t.deltaY&&(o=r,r=0);const[s,a]=function(t,e,i){const n=2,o=Math.abs(t/e),r=o<=1/n?0:t,s=o>n?0:e;return[Math.ceil(r*(i.horizontal??0)),Math.ceil(s*(i.vertical??0))]}(o,r,{horizontal:1,vertical:1});s&&(e.setScrollLeft(e.scroll.horizontalBarPos+s),i.scenegraph.scrollbarComponent.showHorizontalScrollBar(!0)),a&&(e.setScrollTop(e.scroll.verticalBarPos+a),i.scenegraph.scrollbarComponent.showVerticalScrollBar(!0)),n&&e.resetInteractionState(),t.nativeEvent?.cancelable&&("none"===e._gantt.parsedOptions.overscrollBehavior||Math.abs(r)>=Math.abs(o)&&0!==r&&_w(r,e)||Math.abs(r)<=Math.abs(o)&&0!==o&&Sw(o,e))&&t.preventDefault()}function _w(t,e){return 0!=e._gantt.getAllRowsHeight()-e._gantt.scenegraph.height&&(!function(t,e){const i=e._gantt.getAllRowsHeight()-e._gantt.scenegraph.height;return 0!==i&&t<=0&&e.scroll.verticalBarPos<1}(t,e)&&!function(t,e){const i=e._gantt.getAllRowsHeight()-e._gantt.scenegraph.height;return 0!==i&&t>=0&&Math.abs(e.scroll.verticalBarPos-i)<1}(t,e))}function Sw(t,e){return 0!=e._gantt.getAllDateColsWidth()-e._gantt.scenegraph.width&&(!function(t,e){const i=e._gantt.getAllDateColsWidth()-e._gantt.scenegraph.width;return 0!==i&&t<=0&&e.scroll.horizontalBarPos<1}(t,e)&&!function(t,e){const i=e._gantt.getAllDateColsWidth()-e._gantt.scenegraph.width;return 0!==i&&t>=0&&Math.abs(e.scroll.horizontalBarPos-i)<1}(t,e))}const Aw={barColor:"blue",completedBarColor:"gray",width:30,cornerRadius:3,borderWidth:0,fontFamily:"Arial",fontSize:14};const Bw="undefined"==typeof window||void 0===window.window,Tw=864e5;function Rw(t,e){const i=t+e.stateManager.scroll.horizontalBarPos,n=e.getDateColWidth(0);return Math.floor((i-n)/e.parsedOptions.timelineColWidth)+1}function kw(t){return t?!0===t?[{date:PC().toLocaleDateString(),content:"",scrollToMarkLine:!0,position:"left",style:{lineColor:"red",lineWidth:1}}]:Array.isArray(t)?t.map(((t,e)=>({...t,date:t.date,scrollToMarkLine:t.scrollToMarkLine,position:t.position??"left",style:{lineColor:t.style?.lineColor||"red",lineWidth:t.style?.lineWidth||1,lineDash:t.style?.lineDash}}))):[{...t,date:t.date,scrollToMarkLine:t.scrollToMarkLine??!0,position:t.position??"left",style:{lineColor:t.style?.lineColor||"red",lineWidth:t.style?.lineWidth||1,lineDash:t.style?.lineDash}}]:[]}function Mw(t){const e=t.options;t.parsedOptions.tasksShowMode=e?.tasksShowMode??n.Tasks_Separate,t.parsedOptions.pixelRatio=e?.pixelRatio??1,t.parsedOptions.rowHeight=e?.rowHeight??40,t.parsedOptions.timelineColWidth=e?.timelineHeader?.colWidth??60,t.parsedOptions.startDateField=e.taskBar?.startDateField??"startDate",t.parsedOptions.endDateField=e.taskBar?.endDateField??"endDate",t.parsedOptions.progressField=e.taskBar?.progressField??"progress",t.parsedOptions.projectSubTasksExpandable=e?.projectSubTasksExpandable??!0;const{unit:i,startOfWeek:o,step:r}=t.parsedOptions.reverseSortedTimelineScales[0];t.parsedOptions.minDate=e?.minDate?zC(new Date(e.minDate),i,o):void 0,t.parsedOptions.maxDate=e?.maxDate&&t.parsedOptions?.minDate?FC(t.parsedOptions?.minDate,new Date(e.maxDate),i,r):void 0,t.parsedOptions._minDateTime=t.parsedOptions.minDate?.getTime(),t.parsedOptions._maxDateTime=t.parsedOptions.maxDate?.getTime(),t.parsedOptions.overscrollBehavior=e?.overscrollBehavior??"auto",t.parsedOptions.underlayBackgroundColor=e?.underlayBackgroundColor??"#FFF",t.parsedOptions.scrollStyle=Object.assign({},{scrollRailColor:"rgba(100, 100, 100, 0.2)",scrollSliderColor:"rgba(100, 100, 100, 0.5)",scrollSliderCornerRadius:4,width:10,visible:"always",hoverOn:!0,barToSide:!1},e?.scrollStyle),t.parsedOptions.timelineHeaderHorizontalLineStyle=e?.timelineHeader?.horizontalLine,t.parsedOptions.timelineHeaderVerticalLineStyle=e?.timelineHeader?.verticalLine,t.parsedOptions.timelineHeaderBackgroundColor=e?.timelineHeader?.backgroundColor,t.parsedOptions.timeLineHeaderRowHeights=[],t.parsedOptions.timelineHeaderStyles=[];for(let i=0;i<t.parsedOptions.sortedTimelineScales.length;i++){const n=t.parsedOptions.sortedTimelineScales[i].style;t.parsedOptions.timelineHeaderStyles.push(Object.assign({fontSize:20,fontWeight:"bold",textAlign:"center",textBaseline:"middle",color:"#000",backgroundColor:"#fff"},n)),t.parsedOptions.timeLineHeaderRowHeights.push(t.parsedOptions.sortedTimelineScales[i].rowHeight??e?.headerRowHeight??40)}var s;t.parsedOptions.grid=Object.assign({},e?.grid),s=3*t.parsedOptions.rowHeight/4,Aw.width=s,t.parsedOptions.taskBarStyle=e?.taskBar?.barStyle&&"function"==typeof e?.taskBar?.barStyle?e.taskBar.barStyle:Object.assign({},Aw,e?.taskBar?.barStyle),t.parsedOptions.projectBarStyle=e?.taskBar?.projectStyle&&"function"==typeof e?.taskBar?.projectStyle?e.taskBar.projectStyle:e?.taskBar?.projectStyle?Object.assign({},Aw,e?.taskBar?.projectStyle):t.parsedOptions.taskBarStyle;t.parsedOptions.taskBarMilestoneStyle=Object.assign("function"==typeof t.parsedOptions.taskBarStyle?{}:{width:t.parsedOptions.taskBarStyle.width,borderColor:t.parsedOptions.taskBarStyle.borderColor,borderLineWidth:t.parsedOptions.taskBarStyle.borderLineWidth??1,fillColor:t.parsedOptions.taskBarStyle.barColor,cornerRadius:0},{labelTextStyle:{fontSize:16,color:"red",fontFamily:"Arial",padding:4}},e?.taskBar?.milestoneStyle),t.parsedOptions.taskBarMilestoneHypotenuse=t.parsedOptions.taskBarMilestoneStyle.width*Math.sqrt(2),t.parsedOptions.dateFormat=e?.dateFormat,t.parsedOptions.taskBarHoverStyle=Object.assign({barOverlayColor:"rgba(99, 144, 0, 0.4)"},e?.taskBar?.hoverBarStyle),t.parsedOptions.taskBarSelectable=e?.taskBar?.selectable??!0,t.parsedOptions.taskBarSelectedStyle=Object.assign("function"==typeof t.parsedOptions.taskBarStyle?{shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,borderLineWidth:1}:{shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:t.parsedOptions.taskBarStyle.barColor,borderColor:t.parsedOptions.taskBarStyle.barColor,borderLineWidth:1},e?.taskBar?.selectedBarStyle),t.parsedOptions.taskBarLabelText=e?.taskBar?.labelText??"",t.parsedOptions.taskBarMoveable=e?.taskBar?.moveable??!0,t.parsedOptions.moveTaskBarToExtendDateRange=e?.taskBar?.moveToExtendDateRange??!0,t.parsedOptions.taskBarResizable=e?.taskBar?.resizable??!0,t.parsedOptions.taskBarDragOrder=e?.taskBar?.dragOrder??!0,t.parsedOptions.taskBarLabelStyle={fontFamily:e?.taskBar?.labelTextStyle?.fontFamily??"Arial",fontSize:e?.taskBar?.labelTextStyle?.fontSize??20,color:e?.taskBar?.labelTextStyle?.color??"#F01",outsideColor:e?.taskBar?.labelTextStyle?.outsideColor??"#333333",textAlign:e?.taskBar?.labelTextStyle?.textAlign??"left",textBaseline:e?.taskBar?.labelTextStyle?.textBaseline??"middle",padding:e?.taskBar?.labelTextStyle?.padding??[0,0,0,10],textOverflow:e?.taskBar?.labelTextStyle?.textOverflow,orient:e?.taskBar?.labelTextStyle?.orient,orientHandleWithOverflow:e?.taskBar?.labelTextStyle?.orientHandleWithOverflow},t.parsedOptions.taskBarCustomLayout=e?.taskBar?.customLayout,t.parsedOptions.taskBarCreatable=e?.taskBar?.scheduleCreatable??!(t.parsedOptions.tasksShowMode!==n.Sub_Tasks_Separate&&t.parsedOptions.tasksShowMode!==n.Tasks_Separate),t.parsedOptions.taskBarCreationButtonStyle=Object.assign({lineColor:"rgb(99, 144, 0)",lineWidth:1,lineDash:[5,5],cornerRadius:4,backgroundColor:"#FFF"},e?.taskBar?.scheduleCreation?.buttonStyle),t.parsedOptions.taskBarCreationCustomLayout=e?.taskBar?.scheduleCreation?.customLayout,t.parsedOptions.taskBarCreationMaxWidth=e?.taskBar?.scheduleCreation?.maxWidth,t.parsedOptions.taskBarCreationMinWidth=e?.taskBar?.scheduleCreation?.minWidth,t.parsedOptions.outerFrameStyle=Object.assign({borderColor:"#e1e4e8",borderLineWidth:1,cornerRadius:4},e.frame?.outerFrameStyle),t.parsedOptions.markLine=kw(e?.markLine),t.parsedOptions.markLine?.length&&(t.parsedOptions.markLine?.every((t=>void 0===t.scrollToMarkLine))&&(t.parsedOptions.markLine[0].scrollToMarkLine=!0),t.parsedOptions.markLine?.find((t=>t.scrollToMarkLine))&&(t.parsedOptions.scrollToMarkLineDate=zC(new Date(t.parsedOptions.markLine?.find((t=>t.scrollToMarkLine)).date),i,o))),t.parsedOptions.verticalSplitLineHighlight=e.frame?.verticalSplitLineHighlight,t.parsedOptions.verticalSplitLine=Object.assign({lineColor:t.parsedOptions.outerFrameStyle?.borderColor,lineWidth:t.parsedOptions.outerFrameStyle?.borderLineWidth},e.frame?.verticalSplitLine),t.parsedOptions.horizontalSplitLine=e.frame?.horizontalSplitLine,t.parsedOptions.verticalSplitLineMoveable=e.frame?.verticalSplitLineMoveable,t.parsedOptions.taskKeyField=e.taskKeyField??"id",t.parsedOptions.dependencyLinks=e.dependency?.links??[],t.parsedOptions.dependencyLinkCreatable=e.dependency?.linkCreatable??!1,t.parsedOptions.dependencyLinkSelectable=e.dependency?.linkSelectable??!0,t.parsedOptions.dependencyLinkDeletable=e.dependency?.linkDeletable??!1,t.parsedOptions.dependencyLinkLineStyle=Object.assign({lineColor:"red",lineWidth:1},e.dependency?.linkLineStyle),t.parsedOptions.dependencyLinkSelectedLineStyle=Object.assign({shadowBlur:4,shadowOffset:0,shadowColor:t.parsedOptions.dependencyLinkLineStyle.lineColor,lineColor:t.parsedOptions.dependencyLinkLineStyle.lineColor,lineWidth:t.parsedOptions.dependencyLinkLineStyle.lineWidth},e?.dependency?.linkSelectedLineStyle),t.parsedOptions.dependencyLinkLineCreatePointStyle=Object.assign({strokeColor:"red",fillColor:"white",radius:5,strokeWidth:1},e?.dependency?.linkCreatePointStyle),t.parsedOptions.dependencyLinkLineCreatingPointStyle=Object.assign({strokeColor:"red",fillColor:"red",radius:5,strokeWidth:1},e?.dependency?.linkCreatingPointStyle),t.parsedOptions.dependencyLinkLineCreatingStyle=Object.assign({lineColor:"red",lineWidth:1,lineDash:[5,5]},e?.dependency?.linkCreatingLineStyle),t.parsedOptions.eventOptions=e?.eventOptions,t.parsedOptions.keyboardOptions=e?.keyboardOptions,t.parsedOptions.markLineCreateOptions=e?.markLineCreateOptions}function Lw(t,e,i){const{unit:n,step:o,format:r}=i,s=[];for(;t<e;)if("day"===n){const i=t.getFullYear(),n=t.getMonth(),a=t.getDate(),l=IC(new Date(i,n,a+o-1),!0);l.getTime()>e.getTime()&&l.setTime(e.getTime());const h=t,d=r?.({dateIndex:a,startDate:h,endDate:l}),c=d||a.toString(),u={days:Math.abs(l.getTime()-t.getTime()+1)/Tw,startDate:h,endDate:l,step:o,unit:"day",title:c,dateIndex:a};s.push(u),t=new Date(i,n,a+o)}else if("month"===n){const i=t.getFullYear(),n=t.getMonth(),a=IC(new Date(i,n+o,0),!0);a.getTime()>e.getTime()&&a.setTime(e.getTime());const l=t,h=r?.({dateIndex:n+1,startDate:l,endDate:a}),d=h||(n+1).toString(),c={days:Math.abs(a.getTime()-t.getTime()+1)/Tw,startDate:l,step:o,unit:"month",endDate:a,title:d,dateIndex:n+1};s.push(c),t=new Date(i,n+o,1)}else if("quarter"===n){const i=t.getFullYear(),n=Math.floor(t.getMonth()/3),a=IC(new Date(i,3*(n+o),0),!0);a.getTime()>e.getTime()&&a.setTime(e.getTime());const l=t,h=r?.({dateIndex:n+1,startDate:l,endDate:a}),d=h||(n+1).toString(),c={days:Math.abs(a.getTime()-t.getTime()+1)/864e5,startDate:l,step:o,unit:"quarter",endDate:a,title:d,dateIndex:n+1};s.push(c),t=new Date(i,3*(n+o),1)}else if("year"===n){const i=t.getFullYear(),n=IC(new Date(i+o-1,11,31),!0);n.getTime()>e.getTime()&&n.setTime(e.getTime());const a=t,l=r?.({dateIndex:i,startDate:a,endDate:n}),h=l||i.toString(),d={days:Math.abs(n.getTime()-t.getTime()+1)/Tw,startDate:a,endDate:n,step:o,unit:"year",title:h,dateIndex:i};s.push(d),t=new Date(i+o,0,1)}else if("week"===n){const n=i.startOfWeek??"monday";let a=t.getDay();"monday"===n&&(a=0===a?6:a-1);const l=PC(t),h=IC(t.getTime()+24*(7*o-a)*60*60*1e3-1,!0);h>e&&h.setTime(e.getTime());const d=LC(l),c=r?.({dateIndex:d,startDate:l,endDate:h})||d.toString(),u={days:(h.getTime()-l.getTime()+1)/Tw,startDate:l,endDate:h,step:o,unit:"week",title:c,dateIndex:d};s.push(u),t.setTime(PC(t.getTime()+24*(7*o-a)*60*60*1e3,!0).getTime())}else if("hour"===n){const i=t.getFullYear(),n=t.getMonth(),a=t.getDate(),l=t.getHours(),h=EC(new Date(i,n,a,l+o-1),!0);h.getTime()>e.getTime()&&h.setTime(e.getTime());const d=t,c=r?.({dateIndex:l,startDate:d,endDate:h}),u=c||l.toString(),g={days:Math.abs(h.getTime()-t.getTime()+1)/Tw,startDate:d,endDate:h,step:o,unit:"hour",title:u,dateIndex:t.getHours()};s.push(g),t=new Date(i,n,a,l+o)}else if("minute"===n){const i=t.getFullYear(),n=t.getMonth(),a=t.getDate(),l=t.getHours(),h=t.getMinutes(),d=HC(new Date(i,n,a,l,h+o-1),!0);d.getTime()>e.getTime()&&d.setTime(e.getTime());const c=t,u=r?.({dateIndex:h,startDate:c,endDate:d}),g=u||h.toString(),p={days:Math.abs(d.getTime()-t.getTime()+1)/Tw,startDate:c,endDate:d,step:o,unit:"minute",title:g,dateIndex:t.getMinutes()};s.push(p),t=new Date(i,n,a,l,h+o)}else if("second"===n){const i=t.getFullYear(),n=t.getMonth(),a=t.getDate(),l=t.getHours(),h=t.getMinutes(),d=t.getSeconds(),c=OC(new Date(i,n,a,l,h,d+o-1),!0);c.getTime()>e.getTime()&&c.setTime(e.getTime());const u=t,g=r?.({dateIndex:d,startDate:u,endDate:c}),p=g||d.toString(),f={days:Math.abs(c.getTime()-t.getTime()+1)/Tw,startDate:u,endDate:c,step:o,unit:"second",title:p,dateIndex:t.getSeconds()};s.push(f),t=new Date(i,n,a,l,h,d+o)}return s}function Pw(t,e,i,n,o){let r=t[3]??10;"right"===e||"end"===e?r=n-0-(t[1]??10):"center"===e&&(r=0+(n-0+(t[3]??10)-(t[1]??10))/2);let s=0+(t[0]??10);return"bottom"===i||"alphabetic"===i||"ideographic"===i?s=o-0-(t[2]??10):"middle"===i&&(s=0+(o-0-(t[0]??10)-(t[2]??10))/2+(t[0]??10)),{x:r,y:s}}function Ew(t){if(t.verticalSplitResizeLine){t.verticalSplitResizeLine.style.position="absolute",t.verticalSplitResizeLine.style.top=t.tableY+"px",t.verticalSplitResizeLine.style.left=t.taskTableWidth?t.taskTableWidth-7+t.parsedOptions.verticalSplitLine.lineWidth/2+"px":"0px",t.verticalSplitResizeLine.style.width="14px",t.verticalSplitResizeLine.style.height=t.drawHeight+"px",t.verticalSplitResizeLine.style.backgroundColor="rgba(0,0,0,0)",t.verticalSplitResizeLine.style.zIndex="100",t.parsedOptions.verticalSplitLineMoveable&&(t.verticalSplitResizeLine.style.cursor="col-resize"),t.verticalSplitResizeLine.style.userSelect="none",t.verticalSplitResizeLine.style.opacity="1";const e=t.verticalSplitResizeLine.childNodes[0];if(e.style.position="absolute",e.style.top="0px",e.style.left=(14-t.parsedOptions.verticalSplitLine.lineWidth)/2+"px",e.style.width=t.parsedOptions.verticalSplitLine.lineWidth+"px",e.style.height="100%",e.style.backgroundColor=t.parsedOptions.verticalSplitLine.lineColor,e.style.zIndex="100",e.style.userSelect="none",e.style.pointerEvents="none",e.style.transition="background-color 0.3s",t.verticalSplitResizeLine.childNodes[1]){const e=t.verticalSplitResizeLine.childNodes[1];e.style.position="absolute",e.style.top="0px",e.style.left=(14-t.parsedOptions.verticalSplitLineHighlight.lineWidth)/2+"px",e.style.width=t.parsedOptions.verticalSplitLineHighlight.lineWidth+"px",e.style.height="100%",e.style.backgroundColor=t.parsedOptions.verticalSplitLineHighlight.lineColor,e.style.zIndex="100",e.style.cursor="col-resize",e.style.userSelect="none",e.style.pointerEvents="none",e.style.opacity="0",e.style.transition="background-color 0.3s"}}}function Hw(t,e,i,n="children"){for(let o=0;o<t.length;o++){if(Array.isArray(i)&&1===i.length&&t[o][e]===i[0]||t[o][e]===i)return{record:t[o],index:[o]};if(t[o][n]?.length)if(Array.isArray(i)&&i[0]===t[o][e]){const r=Hw(t[o][n],e,i.slice(1));if(r)return r.index.unshift(o),r}else if(!Array.isArray(i)){const r=Hw(t[o][n],e,i);if(r)return r.index.unshift(o),r}}}function Ow(t,e="children"){for(let i=0;i<t.length;i++)t[i][e]?.length?Ow(t[i][e],e):(delete t[i].vtable_gantt_linkedTo,delete t[i].vtable_gantt_linkedFrom)}function Iw(t,e="children"){for(let i=0;i<t.length;i++)t[i][e]?.length?Iw(t[i][e],e):delete t[i].vtable_gantt_showIndex}function Fw(t,e){let i,r;if(e.taskListTableInstance){const s=e.taskListTableInstance.getTargetRowAt(t+e.headerHeight);if(s){const{row:a}=s;i=a-e.taskListTableInstance.columnHeaderLevelCount;const l=e.getRowsHeightByIndex(0,i-1);if(e.parsedOptions.tasksShowMode===n.Sub_Tasks_Inline||e.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||e.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact||e.parsedOptions.tasksShowMode===n.Sub_Tasks_Separate)r=Math.floor((t-l)/e.parsedOptions.rowHeight);else if(e.parsedOptions.tasksShowMode===n.Project_Sub_Tasks_Inline){const n=e.getRecordByIndex(i);if(n&&n.type===o.PROJECT&&n.children?.length>0){"expand"===n.hierarchyState||!1===e.parsedOptions.projectSubTasksExpandable||(r=Math.floor((t-l)/e.parsedOptions.rowHeight))}}}}else i=Math.floor(t/e.parsedOptions.rowHeight);return{task_index:i,sub_task_index:r}}function zw(t,e,i,n){return i.some((i=>{const{startDate:o,endDate:r}=Dw(n,i);return t<=r&&o<=e}))}function Dw(t,e){const{timeScaleIncludeHour:i,startDateField:n,endDateField:o}=t.parsedOptions,r=e[n],s=e[o];return i?{startDate:PC(r),endDate:IC(s)}:{startDate:PC(r,!0),endDate:IC(s,!0)}}function Ww(t){const e=t.options;t.parsedOptions.markLine=kw(e?.markLine)}function Nw(t,e){return{left:t.globalTransMatrix.e+e.taskListTableInstance.tableNoFrameWidth+e.taskListTableInstance.tableX+e.tableX,top:t.globalTransMatrix.f,width:t.attribute.width,height:t.attribute.height}}class Gw{group;_scene;constructor(t){this._scene=t,this.initNodes()}initNodes(){const{_scene:t}=this,e=new Ea({x:0,y:0,width:t._gantt.getAllDateColsWidth(),height:t._gantt.getAllHeaderRowsHeight(),clip:!0,pickable:!1});this.group=e,e.name="date-header-container",t.ganttGroup.addChild(this.group);const{unit:i,step:n}=t._gantt.parsedOptions.reverseSortedTimelineScales[0];let o=0;for(let r=0;r<t._gantt.timeLineHeaderLevel;r++){const{timelineDates:s,customLayout:a,visible:l}=t._gantt.parsedOptions.sortedTimelineScales[r];if(!1===l)continue;const h=new Ea({x:0,y:o,width:t._gantt.getAllDateColsWidth(),height:t._gantt.parsedOptions.timeLineHeaderRowHeights[r],clip:!1});o+=h.attribute.height,h.name="row-header",e.addChild(h);for(let e=0;e<s?.length;e++){const{days:o,endDate:l,startDate:d,title:c,dateIndex:u,unit:g}=s[e],p=Math.ceil(DC(d,t._gantt.parsedOptions.minDate,i,n)*t._gantt.parsedOptions.timelineColWidth),f=Math.ceil(DC(l,t._gantt.parsedOptions.minDate,i,n,1)*t._gantt.parsedOptions.timelineColWidth)-p,v=new Ea({x:p,y:0,width:f,height:h.attribute.height,clip:!1,fill:t._gantt.parsedOptions.timelineHeaderBackgroundColor});let b;v.name="date-header-cell";let m=!0;const y=h.attribute.height;if(a){let t;if("function"==typeof a){t=a({width:f,height:y,index:e,startDate:d,endDate:l,days:o,dateIndex:u,title:c,ganttInstance:this._scene._gantt})}else t=a;t&&(b=t.rootContainer,m=t.renderDefaultText??!1,b.name="task-bar-custom-render"),b&&v.appendChild(b)}if(m){const{padding:e,textAlign:i,textBaseline:n,textOverflow:o,fontSize:s,fontWeight:a,color:l,strokeColor:h,textStick:d}=t._gantt.parsedOptions.timelineHeaderStyles[r],u=Pw(MC(e),i,n,f,y),g=new Fl({x:u.x,y:u.y,maxLineWidth:f,heightLimit:y,pickable:!0,text:c.toLocaleString(),fontSize:s,fontWeight:a,fill:l,stroke:h,lineWidth:2,textAlign:i,textBaseline:n,ellipsis:"clip"===o?"":"ellipsis"===o?"...":XC(o)?o:void 0});g.attribute.textStick=d,v.appendChild(g),g.name="date-header-cell-text"}if(r===t._gantt.timeLineHeaderLevel-1&&t._gantt.parsedOptions.markLineCreateOptions&&t._gantt.parsedOptions.markLineCreateOptions.markLineCreatable){const i=t._gantt.parsedOptions.markLineCreateOptions.markLineCreationStyle||{},n=i.size||24,o=i.iconSize||18,r=i.svg||'<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1471" width="24" height="24"> <path d="M840.05 153.35a27.61875 27.61875 0 0 0-22.95-4.95c-56.25 13.05-218.25 39.6-289.8 2.25-115.65-60.75-241.65-31.95-299.7-13.05V95.75a27.05625 27.05625 0 0 0-27-27 27.05625 27.05625 0 0 0-27 27v834.75c0 14.85 12.15 27 27 27s27-12.15 27-27V611.9c44.1-13.95 199.35-56.25 293.85 1.8 45.9 28.35 96.75 37.8 143.55 37.8 89.1 0 164.7-34.2 169.65-36.45a27.9 27.9 0 0 0 15.75-24.75V174.5a27.5625 27.5625 0 0 0-10.35-21.15z" fill="#f54319" p-id="1472"></path></svg>',a=new Ea({x:f/2-n/2,y:y/2-n/2,width:n,height:n,visiable:!0});a.name="markline-hover-group",a.data=s[e];const l=new Ea({x:0,y:0,width:n,height:n,cornerRadius:n/2,fill:i.fill||"#ccc",cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",visibleAll:!1});l.name="markline-hover-inner-group",a.add(l);const h=new eh({width:o,height:o,image:r,cursor:"pointer",pickable:!0});h.name="markline-hover-icon",l.appendChild(h),v.add(a)}if(h.addChild(v),e>0){const e=$l({pickable:!1,stroke:t._gantt.parsedOptions.timelineHeaderVerticalLineStyle?.lineColor,lineWidth:t._gantt.parsedOptions.timelineHeaderVerticalLineStyle?.lineWidth,points:[{x:1&t._gantt.parsedOptions.timelineHeaderVerticalLineStyle?.lineWidth?.5:0,y:0},{x:1&t._gantt.parsedOptions.timelineHeaderVerticalLineStyle?.lineWidth?.5:0,y:h.attribute.height}]});v.appendChild(e)}}if(r>0){const e=$l({pickable:!1,stroke:t._gantt.parsedOptions.timelineHeaderHorizontalLineStyle?.lineColor,lineWidth:t._gantt.parsedOptions.timelineHeaderHorizontalLineStyle?.lineWidth,points:[{x:0,y:1&t._gantt.parsedOptions.timelineHeaderHorizontalLineStyle?.lineWidth?.5:0},{x:t._gantt.getAllDateColsWidth(),y:1&t._gantt.parsedOptions.timelineHeaderHorizontalLineStyle?.lineWidth?.5:0}]});h.addChild(e)}}}setX(t){this.group.setAttribute("x",t)}setY(t){this.group.setAttribute("y",t)}resize(){this.group.setAttribute("width",this.group.attribute?.width??0),this.group.setAttribute("height",this.group.attribute?.height??0)}refresh(){this.group?.parent.removeChild(this.group),this.initNodes()}showMarklineIcon(t){let e;return t.children.forEach((t=>{"date-header-cell-text"===t.name&&t.setAttribute("visible",!1),"markline-hover-group"===t.name&&(e=t.firstChild,e.setAttribute("visibleAll",!0))})),e}hideMarklineIconHover(t){let e;return t.children.forEach((t=>{"date-header-cell-text"===t.name&&t.setAttribute("visible",!0),"markline-hover-group"===t.name&&(e=t.firstChild,e.setAttribute("visibleAll",!1))})),e}}var jw,Vw;!function(t){t.default="default",t.grabing="grabing",t.scrolling="scrolling"}(jw||(jw={})),function(t){t.single="single",t.column="column",t.row="row",t.cross="cross",t.none="none"}(Vw||(Vw={}));const Uw=["bgColor","color","strokeColor","borderColor","linkColor"];var Xw,$w,Yw,Kw,qw,Zw,Jw;!function(t){t.RECORD="RECORD",t.NONE="NONE",t.SUM="SUM",t.MIN="MIN",t.MAX="MAX",t.AVG="AVG",t.COUNT="COUNT",t.CUSTOM="CUSTOM",t.RECALCULATE="RECALCULATE"}(Xw||(Xw={})),function(t){t.ASC="ASC",t.DESC="DESC",t.NORMAL="NORMAL",t.desc="desc",t.asc="asc",t.normal="normal"}($w||($w={})),function(t){t.top="top",t.bottom="bottom",t.left="left",t.right="right"}(Yw||(Yw={})),function(t){t.expand="expand",t.collapse="collapse",t.none="none",t.loading="loading"}(Kw||(Kw={})),function(t){t.inlineFront="inlineFront",t.inlineEnd="inlineEnd",t.left="left",t.right="right",t.absoluteRight="absoluteRight",t.contentLeft="contentLeft",t.contentRight="contentRight",t.absolute="absolute"}(qw||(qw={})),function(t){t.frozen="frozen",t.sort="sort",t.dropDown="dropDown",t.dropDownState="dropDownState",t.play="play",t.damagePic="damagePic",t.expand="expand",t.collapse="collapse",t.drillDown="drillDown",t.drillUp="drillUp",t.dragReorder="dragReorder"}(Zw||(Zw={})),function(t){t.upwardIconName="sort_upward",t.downwardIconName="sort_downward",t.normalIconName="sort_normal",t.freezeIconName="freeze",t.frozenIconName="frozen",t.frozenCurrentIconName="frozenCurrent",t.dropdownIconName="dropdownIcon",t.expandIconName="expand",t.collapseIconName="collapse",t.dragReorderIconName="dragReorder",t.loadingIconName="loading"}(Jw||(Jw={}));const Qw={};class tx{constructor(t){var e;this.isAggregator=!0,this.isRecord=!0,this.records=[],this.key=t.key,this.field=t.field,this.formatFun=t.formatFun,this.isRecord=null!==(e=t.isRecord)&&void 0!==e?e:this.isRecord}clearCacheValue(){this._formatedValue=void 0}formatValue(t,e,i){return this._formatedValue||(this.formatFun?this._formatedValue=this.formatFun(this.value(),t,e,i):this._formatedValue=this.value()),this._formatedValue}reset(){this.records=[],this.clearCacheValue()}}class ex extends tx{constructor(){super(...arguments),this.type=Xw.RECORD,this.isRecord=!0}push(t){t&&this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),this.clearCacheValue()}deleteRecord(t){t&&this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),this.clearCacheValue())}value(){return this.records}reset(){this.records=[]}recalculate(){}}class ix extends tx{constructor(){super(...arguments),this.type=Xw.NONE,this.isRecord=!0}push(t){t&&(this.isRecord&&(this.records=[t]),this.field&&(this.fieldValue=t[this.field])),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),this.field&&this.records.length&&(this.fieldValue=this.records[this.records.length-1][this.field])),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),this.field&&this.records.length&&(this.fieldValue=this.records[this.records.length-1][this.field]),this.clearCacheValue())}value(){return this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){}}class nx extends tx{constructor(t){super(t),this.type=Xw.CUSTOM,this.isRecord=!0,this.values=[],this.aggregationFun=t.aggregationFun}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),this.field&&this.values.push(t[this.field])),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),this.field&&this.records.length&&(this.values=this.records.map((t=>t[this.field]))),this.clearCacheValue())}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),this.field&&this.records.length&&(this.values=this.records.map((t=>t[this.field])))),this.clearCacheValue()}value(){var t;return this.fieldValue||(this.fieldValue=null===(t=this.aggregationFun)||void 0===t?void 0:t.call(this,this.values,this.records,this.field)),this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){this.fieldValue=void 0,this._formatedValue=void 0}}class ox extends tx{constructor(t){var e;super(t),this.type=Xw.SUM,this.sum=0,this.positiveSum=0,this.nagetiveSum=0,this.needSplitPositiveAndNegativeForSum=!1,this.needSplitPositiveAndNegativeForSum=null!==(e=t.needSplitPositiveAndNegative)&&void 0!==e&&e}push(t){if(t)if(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator){const e=t.value();this.sum+=null!=e?e:0,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const e=parseFloat(t[this.field]);this.sum+=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}this.clearCacheValue()}deleteRecord(t){if(t)if(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator){const e=t.value();this.sum-=null!=e?e:0,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum-=e:e<0&&(this.nagetiveSum-=e))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const e=parseFloat(t[this.field]);this.sum-=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum-=e:e<0&&(this.nagetiveSum-=e))}this.clearCacheValue()}updateRecord(t,e){if(t&&e){if(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator){const i=t.value(),n=e.value();this.sum+=n-i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum-=i:i<0&&(this.nagetiveSum-=i),n>0?this.positiveSum+=n:n<0&&(this.nagetiveSum+=n))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const i=parseFloat(t[this.field]),n=parseFloat(e[this.field]);this.sum+=n-i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum-=i:i<0&&(this.nagetiveSum-=i),n>0?this.positiveSum+=n:n<0&&(this.nagetiveSum+=n))}this.clearCacheValue()}}value(){var t;return(null===(t=this.records)||void 0===t?void 0:t.length)>=1?this.sum:void 0}positiveValue(){return this.positiveSum}negativeValue(){return this.nagetiveSum}reset(){super.reset(),this.records=[],this.sum=0}recalculate(){if(this.sum=0,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];if(e.isAggregator){const t=e.value();this.sum+=null!=t?t:0,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum+=t:t<0&&(this.nagetiveSum+=t))}else if(this.field&&!isNaN(parseFloat(e[this.field]))){const t=parseFloat(e[this.field]);this.sum+=t,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum+=t:t<0&&(this.nagetiveSum+=t))}}}}class rx extends tx{constructor(){super(...arguments),this.type=Xw.COUNT,this.count=0}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?this.count+=t.value():this.count++),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator?this.count-=t.value():this.count--),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&(this.count+=e.value()-t.value()))}value(){return this.count}reset(){this.records=[],this.count=0}recalculate(){if(this.count=0,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.count+=e.value():this.count++}}}class sx extends tx{constructor(){super(...arguments),this.type=Xw.AVG,this.sum=0,this.count=0}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator&&t.type===Xw.AVG?(this.sum+=t.sum,this.count+=t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum+=parseFloat(t[this.field]),this.count++)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&t.type===Xw.AVG?(this.sum-=t.sum,this.count-=t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum-=parseFloat(t[this.field]),this.count--)),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&t.type===Xw.AVG?(this.sum+=e.sum-t.sum,this.count+=e.count-t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum+=parseFloat(e[this.field])-parseFloat(t[this.field])),this.clearCacheValue())}value(){var t;return(null===(t=this.records)||void 0===t?void 0:t.length)>=1?this.sum/this.count:void 0}reset(){this.records=[],this.sum=0,this.count=0}recalculate(){if(this.sum=0,this.count=0,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator&&e.type===Xw.AVG?(this.sum+=e.sum,this.count+=e.count):this.field&&!isNaN(parseFloat(e[this.field]))&&(this.sum+=parseFloat(e[this.field]),this.count++)}}}class ax extends tx{constructor(){super(...arguments),this.type=Xw.MAX,this.max=Number.MIN_SAFE_INTEGER}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?this.max=t.max>this.max?t.max:this.max:"number"==typeof t?this.max=t>this.max?t:this.max:this.field&&"number"==typeof t[this.field]?this.max=t[this.field]>this.max?t[this.field]:this.max:this.field&&!isNaN(t[this.field])&&(this.max=parseFloat(t[this.field])>this.max?parseFloat(t[this.field]):this.max)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),this.recalculate())}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),this.recalculate())}value(){var t;return(null===(t=this.records)||void 0===t?void 0:t.length)>=1?this.max:void 0}reset(){this.records=[],this.max=Number.MIN_SAFE_INTEGER}recalculate(){if(this.max=Number.MIN_SAFE_INTEGER,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.max=e.max>this.max?e.max:this.max:"number"==typeof e?this.max=e>this.max?e:this.max:this.field&&"number"==typeof e[this.field]?this.max=e[this.field]>this.max?e[this.field]:this.max:this.field&&!isNaN(e[this.field])&&(this.max=parseFloat(e[this.field])>this.max?parseFloat(e[this.field]):this.max)}}}class lx extends tx{constructor(){super(...arguments),this.type=Xw.MIN,this.min=Number.MAX_SAFE_INTEGER}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?this.min=t.min<this.min?t.min:this.min:"number"==typeof t?this.min=t<this.min?t:this.min:this.field&&"number"==typeof t[this.field]?this.min=t[this.field]<this.min?t[this.field]:this.min:this.field&&!isNaN(t[this.field])&&(this.min=parseFloat(t[this.field])<this.min?parseFloat(t[this.field]):this.min)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),this.recalculate())}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),this.recalculate())}value(){var t;return(null===(t=this.records)||void 0===t?void 0:t.length)>=1?this.min:void 0}reset(){this.records=[],this.min=Number.MAX_SAFE_INTEGER}recalculate(){if(this.min=Number.MAX_SAFE_INTEGER,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.min=e.min<this.min?e.min:this.min:"number"==typeof e?this.min=e<this.min?e:this.min:this.field&&"number"==typeof e[this.field]?this.min=e[this.field]<this.min?e[this.field]:this.min:this.field&&!isNaN(e[this.field])&&(this.min=parseFloat(e[this.field])<this.min?parseFloat(e[this.field]):this.min)}}}function hx(t,e,i){if(i===$w.NORMAL||i===$w.normal)return 0;const n=/(\d+)|(\D+)/g,o=/\d/,r=/^0/;let s,a,l,h,d=0,c=0;const u=i===$w.DESC||i===$w.desc?-1:1;if(null!==e&&null===t)return-1*u;if(null!==t&&null===e)return 1*u;if("number"==typeof t&&isNaN(t))return-1*u;if("number"==typeof e&&isNaN(e))return 1*u;if(d=+t,c=+e,d<c)return-1*u;if(d>c)return 1*u;if("number"==typeof t&&"number"!=typeof e)return-1*u;if("number"==typeof e&&"number"!=typeof t)return 1*u;if("number"==typeof t&&"number"==typeof e)return 0;if(isNaN(c)&&!isNaN(d))return-1*u;if(isNaN(d)&&!isNaN(c))return 1*u;if(s=String(t),l=String(e),s===l)return 0;if(!o.test(s)||!o.test(l))return(s>l?1:-1)*u;for(s=s.match(n),l=l.match(n);s.length&&l.length;)if(a=s.shift(),h=l.shift(),a!==h)return o.test(a)&&o.test(h)?(a.replace(r,".0")-h.replace(r,".0"))*u:(a>h?1:-1)*u;return(s.length-l.length)*u}var dx=Object.freeze({__proto__:null,get AggregationType(){return Xw},Aggregator:tx,AvgAggregator:sx,CountAggregator:rx,CustomAggregator:nx,get HierarchyState(){return Kw},get HighlightScope(){return Vw},get IconFuncTypeEnum(){return Zw},get IconPosition(){return qw},get InteractionState(){return jw},get InternalIconName(){return Jw},MaxAggregator:ax,MinAggregator:lx,NoneAggregator:ix,get Placement(){return Yw},RecalculateAggregator:class extends tx{constructor(t){super(t),this.type=Xw.RECALCULATE,this.isRecord=!0,this.calculateFun=t.calculateFun,this.dependAggregators=t.dependAggregators,this.dependIndicatorKeys=t.dependIndicatorKeys}push(t){t&&this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),this.clearCacheValue()}deleteRecord(t){t&&this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),this.clearCacheValue())}value(){var t;if(!this.fieldValue){const e=function(t,e){const i={};for(let n=0;n<(null==e?void 0:e.length);n++){const o=t.find((t=>(null==t?void 0:t.key)===e[n]));o&&(i[o.key]=null==o?void 0:o.value())}return i}(this.dependAggregators,this.dependIndicatorKeys);this.fieldValue=null===(t=this.calculateFun)||void 0===t?void 0:t.call(this,e,this.records,this.field)}return this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){}},RecordAggregator:ex,get SortType(){return $w},SumAggregator:ox,cellStyleKeys:Uw,indicatorSort:function(t,e){return t&&e?t.toString().localeCompare(e.toString(),"zh"):t?1:-1},naturalSort:hx,registeredAggregators:Qw,sortBy:function(t){let e;const i={},n={};for(let o=0;o<t.length;o++)e=t[o],i[e]=o,"string"==typeof e&&(n[e.toLowerCase()]=o);return function(t,e,o){if(o===$w.NORMAL||o===$w.normal)return 0;const r=o===$w.DESC||o===$w.desc?-1:1;let s;return null!==i[t]&&void 0!==i[t]&&null!==i[e]&&void 0!==i[e]?s=i[t]-i[e]:null!==i[t]&&void 0!==i[t]?s=-1:null!==i[e]&&void 0!==i[e]?s=1:null!==n[t]&&void 0!==i[t]&&null!==n[e]&&void 0!==i[e]?s=n[t]-n[e]:null===n[t]||void 0===i[t]||null===n[e]||void 0===i[e]?s=0:null!==n[t]&&void 0!==i[t]?s=-1:null!==n[e]&&void 0!==i[e]&&(s=1),XC(s)?s*r:hx(t,e,o)}},typeSort:function(t,e,i){if(i===$w.NORMAL||i===$w.normal)return 0;const n=i===$w.DESC||i===$w.desc?-1:1;return t&&e?t.toString().localeCompare(e.toString(),"zh")*n:t?1*n:-1*n}});let cx,ux=1,gx=class{constructor(){this.listenersData={listeners:{},listenerData:{}}}on(t,e){const i=this.listenersData.listeners[t]||(this.listenersData.listeners[t]=[]);i.push(e);const n=ux++;return this.listenersData.listenerData[n]={type:t,listener:e,remove:()=>{delete this.listenersData.listenerData[n];const o=i.indexOf(e);i.splice(o,1),this.listenersData.listeners[t].length||delete this.listenersData.listeners[t]}},n}off(t,e){var i;if(e){const i=t;this.removeEventListener(i,e)}else{const e=t;if(!this.listenersData)return;null===(i=this.listenersData.listenerData[e])||void 0===i||i.remove()}}addEventListener(t,e,i){this.on(t,e)}removeEventListener(t,e){if(this.listenersData)for(const i in this.listenersData.listenerData){const n=this.listenersData.listenerData[i];n.type===t&&n.listener===e&&this.off(i)}}hasListeners(t){return!!this.listenersData&&!!this.listenersData.listeners[t]}fireListeners(t,e){if(!this.listenersData)return[];const i=this.listenersData.listeners[t];return i?i.map((t=>t.call(this,e))).filter((t=>XC(t))):[]}release(){delete this.listenersData}};const px={CHANGE_STYLE:"change_style"};let fx,vx,bx,mx=class t extends gx{static get EVENT_TYPE(){return px}static get DEFAULT(){return cx||(cx=new t)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B,T,R,k,M,L,P;super(),this._defaultPadding=[10,16,10,16],this._textAlign=null!==(i=null==t?void 0:t.textAlign)&&void 0!==i?i:null==e?void 0:e.textAlign,this._textBaseline=null!==(n=null==t?void 0:t.textBaseline)&&void 0!==n?n:null==e?void 0:e.textBaseline,this._color=null!==(o=null==t?void 0:t.color)&&void 0!==o?o:null==e?void 0:e.color,this._strokeColor=null!==(r=null==t?void 0:t.strokeColor)&&void 0!==r?r:null==e?void 0:e.strokeColor,this._fontSize=null!==(s=t.fontSize)&&void 0!==s?s:null==e?void 0:e.fontSize,this._fontFamily=null!==(a=t.fontFamily)&&void 0!==a?a:null==e?void 0:e.fontFamily,this._fontWeight=null!==(l=t.fontWeight)&&void 0!==l?l:null==e?void 0:e.fontWeight,this._fontVariant=null!==(h=t.fontVariant)&&void 0!==h?h:null==e?void 0:e.fontVariant,this._fontStyle=null!==(d=t.fontStyle)&&void 0!==d?d:null==e?void 0:e.fontStyle,this._padding=null!==(u=null!==(c=null==t?void 0:t.padding)&&void 0!==c?c:null==e?void 0:e.padding)&&void 0!==u?u:this._defaultPadding,this._borderColor=null!==(g=null==t?void 0:t.borderColor)&&void 0!==g?g:null==e?void 0:e.borderColor,this._textOverflow=null!==(p=null==t?void 0:t.textOverflow)&&void 0!==p?p:null==e?void 0:e.textOverflow,this._textStick=null!==(v=null!==(f=t.textStick)&&void 0!==f?f:null==e?void 0:e.textStick)&&void 0!==v&&v,this._textStickBaseOnAlign=null!==(m=null!==(b=t.textStickBaseOnAlign)&&void 0!==b?b:null==e?void 0:e.textStickBaseOnAlign)&&void 0!==m&&m,this._bgColor=null!==(y=null==t?void 0:t.bgColor)&&void 0!==y?y:null==e?void 0:e.bgColor,this._lineHeight=null!==(C=null==t?void 0:t.lineHeight)&&void 0!==C?C:null==e?void 0:e.lineHeight,this._underline=null!==(w=null==t?void 0:t.underline)&&void 0!==w?w:null==e?void 0:e.underline,this._underlineColor=null!==(x=null==t?void 0:t.underlineColor)&&void 0!==x?x:null==e?void 0:e.underlineColor,this._underlineDash=null!==(_=null==t?void 0:t.underlineDash)&&void 0!==_?_:null==e?void 0:e.underlineDash,this._underlineOffset=null!==(S=null==t?void 0:t.underlineOffset)&&void 0!==S?S:null==e?void 0:e.underlineOffset,this._lineThrough=null!==(A=null==t?void 0:t.lineThrough)&&void 0!==A?A:null==e?void 0:e.lineThrough,this._lineThroughColor=null!==(B=null==t?void 0:t.lineThroughColor)&&void 0!==B?B:null==e?void 0:e.lineThroughColor,this._lineThroughDash=null!==(T=null==t?void 0:t.lineThroughDash)&&void 0!==T?T:null==e?void 0:e.lineThroughDash,this._linkColor=null!==(R=null==t?void 0:t.linkColor)&&void 0!==R?R:null==e?void 0:e.linkColor,this._cursor=null!==(k=t.cursor)&&void 0!==k?k:null==e?void 0:e.cursor,this._borderLineWidth=null!==(M=t.borderLineWidth)&&void 0!==M?M:null==e?void 0:e.borderLineWidth,this._borderLineDash=null!==(L=t.borderLineDash)&&void 0!==L?L:null==e?void 0:e.borderLineDash,this._marked=null!==(P=t.marked)&&void 0!==P?P:null==e?void 0:e.marked}get color(){return this._color}set color(t){this._color=t}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get padding(){return this._padding}set padding(t){this._padding=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(t){this._textStickBaseOnAlign=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}get marked(){return this._marked}set marked(t){this._marked=t}clone(){return new t(this,null)}},yx=class t extends mx{static get DEFAULT(){return fx||(fx=new t)}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}clone(){return new t(this,null)}};class Cx extends mx{static get DEFAULT(){return vx||(vx=new Cx)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,n;super(t,e),this._autoWrapText=null!==(i=null==t?void 0:t.autoWrapText)&&void 0!==i?i:null==e?void 0:e.autoWrapText,this._lineClamp=null!==(n=null==t?void 0:t.lineClamp)&&void 0!==n?n:null==e?void 0:e.lineClamp}clone(){return new Cx(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}let wx,xx,_x,Sx=class t extends mx{static get DEFAULT(){return bx||(bx=new t)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S;super(t,e),this._size=(null!==(o=null!==(n=null==t?void 0:t.size)&&void 0!==n?n:null==e?void 0:e.size)&&void 0!==o?o:null==i?void 0:i.size)||14,this._spaceBetweenTextAndIcon=(null!==(s=null!==(r=null==t?void 0:t.spaceBetweenTextAndIcon)&&void 0!==r?r:null==e?void 0:e.spaceBetweenTextAndIcon)&&void 0!==s?s:null==i?void 0:i.spaceBetweenTextAndIcon)||8,this._defaultFill=null!==(l=null===(a=null==t?void 0:t.checkboxStyle)||void 0===a?void 0:a.defaultFill)&&void 0!==l?l:null==i?void 0:i.defaultFill,this._defaultStroke=null!==(d=null===(h=null==t?void 0:t.checkboxStyle)||void 0===h?void 0:h.defaultStroke)&&void 0!==d?d:null==i?void 0:i.defaultStroke,this._disableFill=null!==(u=null===(c=null==t?void 0:t.checkboxStyle)||void 0===c?void 0:c.disableFill)&&void 0!==u?u:null==i?void 0:i.disableFill,this._checkedFill=null!==(p=null===(g=null==t?void 0:t.checkboxStyle)||void 0===g?void 0:g.checkedFill)&&void 0!==p?p:null==i?void 0:i.checkedFill,this._checkedStroke=null!==(v=null===(f=null==t?void 0:t.checkboxStyle)||void 0===f?void 0:f.checkedStroke)&&void 0!==v?v:null==i?void 0:i.checkedStroke,this._disableCheckedFill=null!==(m=null===(b=null==t?void 0:t.checkboxStyle)||void 0===b?void 0:b.disableCheckedFill)&&void 0!==m?m:null==i?void 0:i.disableCheckedFill,this._disableCheckedStroke=null!==(C=null===(y=null==t?void 0:t.checkboxStyle)||void 0===y?void 0:y.disableCheckedStroke)&&void 0!==C?C:null==i?void 0:i.disableCheckedStroke,this._checkIconImage=null!==(x=null===(w=null==t?void 0:t.checkboxStyle)||void 0===w?void 0:w.checkIconImage)&&void 0!==x?x:null==i?void 0:i.checkIconImage,this._indeterminateIconImage=null!==(S=null===(_=null==t?void 0:t.checkboxStyle)||void 0===_?void 0:_.indeterminateIconImage)&&void 0!==S?S:null==i?void 0:i.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(e){return new t(e,this)}clone(){return new t(this)}};class Ax extends mx{static get DEFAULT(){return wx||(wx=new Ax)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B;super(t,e),this._size=(null!==(o=null!==(n=null==t?void 0:t.size)&&void 0!==n?n:null==e?void 0:e.size)&&void 0!==o?o:null==i?void 0:i.size)||14,this._spaceBetweenTextAndIcon=(null!==(s=null!==(r=null==t?void 0:t.spaceBetweenTextAndIcon)&&void 0!==r?r:null==e?void 0:e.spaceBetweenTextAndIcon)&&void 0!==s?s:null==i?void 0:i.spaceBetweenTextAndIcon)||8,this._spaceBetweenRadio=(null!==(l=null!==(a=null==t?void 0:t.spaceBetweenRadio)&&void 0!==a?a:null==e?void 0:e.spaceBetweenRadio)&&void 0!==l?l:null==i?void 0:i.spaceBetweenRadio)||2,this._innerRadius=null!==(d=null===(h=null==t?void 0:t.radioStyle)||void 0===h?void 0:h.innerRadius)&&void 0!==d?d:null==i?void 0:i.innerRadius,this._outerRadius=null!==(u=null===(c=null==t?void 0:t.radioStyle)||void 0===c?void 0:c.outerRadius)&&void 0!==u?u:null==i?void 0:i.outerRadius,this._defaultFill=null!==(p=null===(g=null==t?void 0:t.radioStyle)||void 0===g?void 0:g.defaultFill)&&void 0!==p?p:null==i?void 0:i.defaultFill,this._defaultStroke=null!==(v=null===(f=null==t?void 0:t.radioStyle)||void 0===f?void 0:f.defaultStroke)&&void 0!==v?v:null==i?void 0:i.defaultStroke,this._disableFill=null!==(m=null===(b=null==t?void 0:t.radioStyle)||void 0===b?void 0:b.disableFill)&&void 0!==m?m:null==i?void 0:i.disableFill,this._checkedFill=null!==(C=null===(y=null==t?void 0:t.radioStyle)||void 0===y?void 0:y.checkedFill)&&void 0!==C?C:null==i?void 0:i.checkedFill,this._checkedStroke=null!==(x=null===(w=null==t?void 0:t.radioStyle)||void 0===w?void 0:w.checkedStroke)&&void 0!==x?x:null==i?void 0:i.checkedStroke,this._disableCheckedFill=null!==(S=null===(_=null==t?void 0:t.radioStyle)||void 0===_?void 0:_.disableCheckedFill)&&void 0!==S?S:null==i?void 0:i.disableCheckedFill,this._disableCheckedStroke=null!==(B=null===(A=null==t?void 0:t.radioStyle)||void 0===A?void 0:A.disableCheckedStroke)&&void 0!==B?B:null==i?void 0:i.disableCheckedStroke}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get spaceBetweenRadio(){return this._spaceBetweenRadio}set spaceBetweenRadio(t){this._spaceBetweenRadio=t}get innerRadius(){return this._innerRadius}set innerRadius(t){this._innerRadius=t}get outerRadius(){return this._outerRadius}set outerRadius(t){this._outerRadius=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}getStyle(t){return new Ax(t,this)}clone(){return new Ax(this)}}class Bx extends mx{static get DEFAULT(){return xx||(xx=new Bx)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C;super(t,e),this._spaceBetweenTextAndCircle=(null!==(o=null!==(n=null==t?void 0:t.spaceBetweenTextAndCircle)&&void 0!==n?n:null==e?void 0:e.spaceBetweenTextAndCircle)&&void 0!==o?o:null==i?void 0:i.spaceBetweenTextAndCircle)||6,this._circleRadius=(null!==(s=null===(r=null==t?void 0:t.switchStyle)||void 0===r?void 0:r.circleRadius)&&void 0!==s?s:null==i?void 0:i.circleRadius)||8,this._boxWidth=(null!==(l=null===(a=null==t?void 0:t.switchStyle)||void 0===a?void 0:a.boxWidth)&&void 0!==l?l:null==i?void 0:i.boxWidth)||40,this._boxHeight=(null!==(d=null===(h=null==t?void 0:t.switchStyle)||void 0===h?void 0:h.boxHeight)&&void 0!==d?d:null==i?void 0:i.boxHeight)||24,this._checkedFill=(null!==(u=null===(c=null==t?void 0:t.switchStyle)||void 0===c?void 0:c.checkedFill)&&void 0!==u?u:null==i?void 0:i.checkedFill)||"#165DFF",this._uncheckedFill=(null!==(p=null===(g=null==t?void 0:t.switchStyle)||void 0===g?void 0:g.uncheckedFill)&&void 0!==p?p:null==i?void 0:i.uncheckedFill)||"#c9cdd4",this._disableCheckedFill=(null!==(v=null===(f=null==t?void 0:t.switchStyle)||void 0===f?void 0:f.disableCheckedFill)&&void 0!==v?v:null==i?void 0:i.disableCheckedFill)||"#94bfff",this._disableUncheckedFill=(null!==(m=null===(b=null==t?void 0:t.switchStyle)||void 0===b?void 0:b.disableUncheckedFill)&&void 0!==m?m:null==i?void 0:i.disableUncheckedFill)||"#f2f3f5",this._circleFill=(null!==(C=null===(y=null==t?void 0:t.switchStyle)||void 0===y?void 0:y.circleFill)&&void 0!==C?C:null==i?void 0:i.circleFill)||"#FFF"}get spaceBetweenTextAndCircle(){return this._spaceBetweenTextAndCircle}set spaceBetweenTextAndCircle(t){this._spaceBetweenTextAndCircle=t}get circleRadius(){return this._circleRadius}set circleRadius(t){this._circleRadius=t}get boxWidth(){return this._boxWidth}set boxWidth(t){this._boxWidth=t}get boxHeight(){return this._boxHeight}set boxHeight(t){this._boxHeight=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get uncheckedFill(){return this._uncheckedFill}set uncheckedFill(t){this._uncheckedFill=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableUncheckedFill(){return this._disableUncheckedFill}set disableUncheckedFill(t){this._disableUncheckedFill=t}get circleFill(){return this._circleFill}set circleFill(t){this._circleFill=t}getStyle(t){return new Bx(t,this)}clone(){return new Bx(this)}}class Tx extends mx{static get DEFAULT(){return _x||(_x=new Tx)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_;super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this._buttonColor=(null!==(n=null===(i=null==t?void 0:t.buttonStyle)||void 0===i?void 0:i.buttonColor)&&void 0!==n?n:null==e?void 0:e.buttonColor)||"#165DFF",this._buttonBorderColor=(null!==(r=null===(o=null==t?void 0:t.buttonStyle)||void 0===o?void 0:o.buttonBorderColor)&&void 0!==r?r:null==e?void 0:e.buttonBorderColor)||"#165DFF",this._buttonLineWidth=(null!==(a=null===(s=null==t?void 0:t.buttonStyle)||void 0===s?void 0:s.buttonLineWidth)&&void 0!==a?a:null==e?void 0:e.buttonLineWidth)||1,this._buttonBorderRadius=(null!==(h=null===(l=null==t?void 0:t.buttonStyle)||void 0===l?void 0:l.buttonBorderRadius)&&void 0!==h?h:null==e?void 0:e.buttonBorderRadius)||2,this._buttonHoverColor=(null!==(c=null===(d=null==t?void 0:t.buttonStyle)||void 0===d?void 0:d.buttonHoverColor)&&void 0!==c?c:null==e?void 0:e.buttonHoverColor)||"#4080FF",this._buttonHoverBorderColor=(null!==(g=null===(u=null==t?void 0:t.buttonStyle)||void 0===u?void 0:u.buttonHoverBorderColor)&&void 0!==g?g:null==e?void 0:e.buttonHoverBorderColor)||"#4080FF",this._buttonTextHoverColor=null!==(f=null===(p=null==t?void 0:t.buttonStyle)||void 0===p?void 0:p.buttonTextHoverColor)&&void 0!==f?f:null==e?void 0:e.buttonTextHoverColor,this._buttonDisableColor=(null!==(b=null===(v=null==t?void 0:t.buttonStyle)||void 0===v?void 0:v.buttonDisableColor)&&void 0!==b?b:null==e?void 0:e.buttonDisableColor)||"#94bfff",this._buttonDisableBorderColor=(null!==(y=null===(m=null==t?void 0:t.buttonStyle)||void 0===m?void 0:m.buttonDisableBorderColor)&&void 0!==y?y:null==e?void 0:e.buttonDisableBorderColor)||"#94bfff",this._buttonTextDisableColor=null!==(w=null===(C=null==t?void 0:t.buttonStyle)||void 0===C?void 0:C.buttonTextDisableColor)&&void 0!==w?w:null==e?void 0:e.buttonTextDisableColor,this._buttonPadding=(null!==(_=null===(x=null==t?void 0:t.buttonStyle)||void 0===x?void 0:x.buttonPadding)&&void 0!==_?_:null==e?void 0:e.buttonPadding)||10}get buttonColor(){return this._buttonColor}set buttonColor(t){this._buttonColor=t}get buttonBorderColor(){return this._buttonBorderColor}set buttonBorderColor(t){this._buttonBorderColor=t}get buttonLineWidth(){return this._buttonLineWidth}set buttonLineWidth(t){this._buttonLineWidth=t}get buttonBorderRadius(){return this._buttonBorderRadius}set buttonBorderRadius(t){this._buttonBorderRadius=t}get buttonHoverColor(){return this._buttonHoverColor}set buttonHoverColor(t){this._buttonHoverColor=t}get buttonHoverBorderColor(){return this._buttonHoverBorderColor}set buttonHoverBorderColor(t){this._buttonHoverBorderColor=t}get buttonTextHoverColor(){return this._buttonTextHoverColor}set buttonTextHoverColor(t){this._buttonTextHoverColor=t}get buttonDisableColor(){return this._buttonDisableColor}set buttonDisableColor(t){this._buttonDisableColor=t}get buttonDisableBorderColor(){return this._buttonDisableBorderColor}set buttonDisableBorderColor(t){this._buttonDisableBorderColor=t}get buttonTextDisableColor(){return this._buttonTextDisableColor}set buttonTextDisableColor(t){this._buttonTextDisableColor=t}get buttonTextHoverBorderColor(){return this._buttonTextHoverBorderColor}set buttonTextHoverBorderColor(t){this._buttonTextHoverBorderColor=t}get buttonPadding(){return this._buttonPadding}set buttonPadding(t){this._buttonPadding=t}getStyle(t){return new Tx(t,this)}clone(){return new Tx(this)}}function Rx(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:mx,o=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;var s,a,l,h;return t||e?t instanceof mx?t:"function"==typeof t?Rx(t(i),e,i,n,o,r):(t||(t={}),o&&!XC(t.autoWrapText)&&(t.autoWrapText=!0),n===Sx?new Sx(null!=t?t:{},null!=e?e:{},null!==(s=r.checkboxStyle)&&void 0!==s?s:{}):n===Ax?new Ax(null!=t?t:{},null!=e?e:{},null!==(a=r.radioStyle)&&void 0!==a?a:{}):n===Bx?new Bx(null!=t?t:{},null!=e?e:{},null!==(l=r.switchStyle)&&void 0!==l?l:{}):n===Tx?new Tx(null!=t?t:{},null!=e?e:{},null!==(h=r.buttonStyle)&&void 0!==h?h:{}):new n(null!=t?t:{},null!=e?e:{})):n.DEFAULT}class kx{static get mode(){return kx._mode||(kx._mode=function(){let t="browser";try{"node"===window.type?t="node":"undefined"==typeof window||window.performance?"undefined"==typeof window&&(t="node"):t="miniApp"}catch(e){t="node"}return t}()),kx._mode}static set mode(t){kx._mode=t}static RegisterCreateCanvas(t){kx.CreateCanvas=t}static RegisterLoadImage(t){kx.LoadImage=t}static GetCreateCanvasFunc(){return kx.CreateCanvas?kx.CreateCanvas:"worker"===kx.mode?function(){return new OffscreenCanvas(arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,arguments.length>1&&void 0!==arguments[1]?arguments[1]:200)}:void 0}static RegisterRequestAnimationFrame(t){kx.RequestAnimationFrame=t()}static GetRequestAnimationFrame(){if(kx.RequestAnimationFrame)return kx.RequestAnimationFrame}static RegisterCancelAnimationFrame(t){kx.CancelAnimationFrame=t()}static GetCancelAnimationFrame(){if(kx.CancelAnimationFrame)return kx.CancelAnimationFrame}}kx.dpr=0;const Mx=(t,e)=>(t=>{switch(Object.prototype.toString.call(t)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}})(t)===e,Lx=t=>Mx(t,"object"),Px=t=>Mx(t,"string"),Ex=t=>Mx(t,"number"),Hx=t=>Mx(t,"boolean");function Ox(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];if(!i.length)return t||{};const o=i.shift();if(Lx(t)&&Lx(o))for(const e in o)Lx(o[e])?(t[e]||Object.assign(t,{[e]:{}}),Lx(t[e])||Object.assign(t,{[e]:o[e]}),Ox(t[e],o[e])):null!==o[e]&&void 0!==o[e]&&Object.assign(t,{[e]:o[e]});return Ox(t,...i)}function Ix(t){return"function"==typeof t&&(t=t()),XC(t)?`${t}`:""}function Fx(t,e){let i=null;return function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];i||(t.apply(this,o),i=setTimeout((()=>{i=null}),e))}}function zx(t,e){for(t=`${t}`;t.length<e;)t="0"+t;return t}function Dx(t,e,i){t=(t=t.replace(/^\s*|\s*$/,"")).replace(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i,"#$1$1$2$2$3$3");const n=Math.round(256*e)*(i?-1:1),o=t.match(new RegExp("^rgba?\\(\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])(?:\\s*,\\s*(0|1|0?\\.\\d+))?\\s*\\)$","i")),r=o&&XC(o[4])?o[4]:null,s=o?[o[1],o[2],o[3]]:t.replace(/^#?([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])/i,(function(){return`${parseInt(arguments[1],16)},${parseInt(arguments[2],16)},${parseInt(arguments[3],16)}`})).split(/,/);return o?`rgb${null!==r?"a":""}(${Math[i?"max":"min"](parseInt(s[0],10)+n,i?0:255)}, ${Math[i?"max":"min"](parseInt(s[1],10)+n,i?0:255)}, ${Math[i?"max":"min"](parseInt(s[2],10)+n,i?0:255)}${null!==r?`, ${r}`:""})`:["#",zx(Math[i?"max":"min"](parseInt(s[0],10)+n,i?0:255).toString(16),2),zx(Math[i?"max":"min"](parseInt(s[1],10)+n,i?0:255).toString(16),2),zx(Math[i?"max":"min"](parseInt(s[2],10)+n,i?0:255).toString(16),2)].join("")}function Wx(t){return Px(t)||Ex(t)||Hx(t)?t.toString():""}function Nx(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}function Gx(t,e,i){return"desc"!==i?t===e?0:t>e?1:-1:t===e?0:t<e?1:-1}function jx(t){const e=[];for(let i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e}function Vx(t,e,i){i(t),(null==t?void 0:t[e])&&Array.isArray(null==t?void 0:t[e])&&t[e].forEach((t=>Vx(t,e,i)))}const Ux="undefined"==typeof window||void 0===window.window;let Xx,$x;const Yx={get find(){return Xx||(Xx=Array.prototype.find?(t,e)=>Array.prototype.find.call(t,e):(t,e)=>{const i=Yx.findIndex(t,e);return i>=0?t[i]:void 0},Xx)},get findIndex(){return $x||($x=Array.prototype.findIndex?(t,e)=>Array.prototype.findIndex.call(t,e):(t,e)=>{const{length:i}=t;for(let n=0;n<i;n++)if(e(t[n],n,t))return n;return-1},$x)}};const{IE:Kx,Chrome:qx,Firefox:Zx,Edge:Jx,Safari:Qx}=function(){if(Ux)return{IE:!1,Edge:!1,Chrome:!1,Firefox:!1,Safari:!1};const t=window.navigator.userAgent.toLowerCase();return{IE:!!/(msie|trident)/.exec(t),Edge:t.indexOf("edge")>-1,Chrome:t.indexOf("chrome")>-1&&-1===t.indexOf("edge"),Firefox:t.indexOf("firefox")>-1,Safari:t.indexOf("safari")>-1&&-1===t.indexOf("edge")}}();function t_(){const t={};for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return i.forEach((e=>{for(const i in e)Object.defineProperty(t,i,{get:()=>e[i],set(t){e[i]=t},configurable:!0,enumerable:!0})})),t}function e_(t,e){let i=t;for(let t=0;t<(arguments.length<=2?0:arguments.length-2)&&null!=i;t++)i=e(i,t+2<2||arguments.length<=t+2?void 0:arguments[t+2]);return i}function i_(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return e_(t,((t,e)=>t[e]),...i)}function n_(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return"function"==typeof t?t(...i):t}function o_(t){return Boolean(t&&"function"==typeof t.then)}function r_(t,e){o_(t)?t.then((t=>{e(t)})).catch((t=>{})):e(t)}function s_(t){return Array.isArray(t)?3===t.length?[t[0],t[1],t[2],t[1]]:2===t.length?[t[0],t[1],t[0],t[1]]:1===t.length?[t[0],t[0],t[0],t[0]]:[t[0],t[1],t[2],t[3]]:[t,t,t,t]}function a_(t,e,i){return t.start.col<=e&&e<=t.end.col&&t.start.row<=i&&i<=t.end.row||t.end.col<=e&&e<=t.start.col&&t.end.row<=i&&i<=t.start.row||t.end.col<=e&&e<=t.start.col&&t.start.row<=i&&i<=t.end.row||t.start.col<=e&&e<=t.end.col&&t.end.row<=i&&i<=t.start.row}function l_(t){return{start:{col:Math.min(t.start.col,t.end.col),row:Math.min(t.start.row,t.end.row)},end:{col:Math.max(t.start.col,t.end.col),row:Math.max(t.start.row,t.end.row)}}}function h_(t,e){const i=l_(t),n=l_(e);return Math.max(i.start.col,n.start.col)<=Math.min(i.end.col,n.end.col)&&Math.max(i.start.row,n.start.row)<=Math.min(i.end.row,n.end.row)}const d_=Kx,c_={isObject:function(t){return t===Object(t)}},u_={endsWith:function(t,e,i){const n=Wx(t);("number"!=typeof i||!isFinite(i)||Math.floor(i)!==i||i>n.length)&&(i=n.length),i-=e.length;const o=n.lastIndexOf(e,i);return-1!==o&&o===i}},g_={isTouchEvent:function(t){return!!t.changedTouches}},p_={toBoxArray:s_},f_=Function.prototype,v_={CLICK_CELL:"click_cell",DBLCLICK_CELL:"dblclick_cell",MOUSEDOWN_CELL:"mousedown_cell",MOUSEUP_CELL:"mouseup_cell",SELECTED_CELL:"selected_cell",SELECTED_CLEAR:"selected_clear",BEFORE_KEYDOWN:"before_keydown",KEYDOWN:"keydown",MOUSEENTER_TABLE:"mouseenter_table",MOUSELEAVE_TABLE:"mouseleave_table",MOUSEDOWN_TABLE:"mousedown_table",MOUSEMOVE_TABLE:"mousemove_table",MOUSEMOVE_CELL:"mousemove_cell",MOUSEENTER_CELL:"mouseenter_cell",MOUSELEAVE_CELL:"mouseleave_cell",CONTEXTMENU_CELL:"contextmenu_cell",RESIZE_COLUMN:"resize_column",RESIZE_COLUMN_END:"resize_column_end",RESIZE_ROW:"resize_row",RESIZE_ROW_END:"resize_row_end",CHANGE_HEADER_POSITION_START:"change_header_position_start",CHANGE_HEADER_POSITION:"change_header_position",CHANGING_HEADER_POSITION:"changing_header_position",CHANGE_HEADER_POSITION_FAIL:"change_header_position_fail",SORT_CLICK:"sort_click",AFTER_SORT:"after_sort",FREEZE_CLICK:"freeze_click",SCROLL:"scroll",CAN_SCROLL:"can_scroll",SCROLL_HORIZONTAL_END:"scroll_horizontal_end",SCROLL_VERTICAL_END:"scroll_vertical_end",DROPDOWN_MENU_CLICK:"dropdown_menu_click",MOUSEOVER_CHART_SYMBOL:"mouseover_chart_symbol",DRAG_SELECT_END:"drag_select_end",COPY_DATA:"copy_data",DROPDOWN_ICON_CLICK:"dropdown_icon_click",DROPDOWN_MENU_CLEAR:"dropdown_menu_clear",TREE_HIERARCHY_STATE_CHANGE:"tree_hierarchy_state_change",SHOW_MENU:"show_menu",HIDE_MENU:"hide_menu",ICON_CLICK:"icon_click",LEGEND_ITEM_CLICK:"legend_item_click",LEGEND_ITEM_HOVER:"legend_item_hover",LEGEND_ITEM_UNHOVER:"legend_item_unHover",LEGEND_CHANGE:"legend_change",MOUSEENTER_AXIS:"mouseenter_axis",MOUSELEAVE_AXIS:"mouseleave_axis",CHECKBOX_STATE_CHANGE:"checkbox_state_change",RADIO_STATE_CHANGE:"radio_state_change",SWITCH_STATE_CHANGE:"switch_state_change",BEFORE_SET_SIZE:"before_set_size",BEFORE_INIT:"before_init",AFTER_RENDER:"after_render",INITIALIZED:"initialized",CHANGE_CELL_VALUE:"change_cell_value",DRAG_FILL_HANDLE_END:"drag_fill_handle_end",MOUSEDOWN_FILL_HANDLE:"mousedown_fill_handle",DBLCLICK_FILL_HANDLE:"dblclick_fill_handle",EMPTY_TIP_CLICK:"empty_tip_click",EMPTY_TIP_DBLCLICK:"empty_tip_dblclick",BUTTON_CLICK:"button_click",BEFORE_CACHE_CHART_IMAGE:"before_cache_chart_image",PASTED_DATA:"pasted_data"},b_=(t,e)=>(t=>{switch(Object.prototype.toString.call(t)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}})(t)===e;function m_(t,e,i){let n,o,r,s,a,l,h=0,d=!1,c=!1,u=!0;const g=!e&&0!==e&&"function"==typeof requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){const i=n,r=o;return o=void 0,n=void 0,h=e,s=t.apply(r,i),s}function f(t,e){return g?requestAnimationFrame(t):setTimeout(t,e)}function v(t){const i=t-l;return void 0===l||i>=e||i<0||d&&t-h>=r}function b(){const t=Date.now();if(v(t))return function(t){return a=void 0,u&&n?p(t):(o=void 0,n=void 0,s)}(t);a=f(b,function(t){const i=t-h,n=e&&-(t-l);return d?Math.min(n,r-i):n}(t))}return e=+e||0,b_(i,"object")&&(c=!!i.leading,d="maxWait"in i,d&&(r=Math.max(+i.maxWait||0,e)),u="trailing"in i?!!i.trailing:u),function(){const t=Date.now(),i=v(t);for(var r=arguments.length,u=new Array(r),g=0;g<r;g++)u[g]=arguments[g];if(n=u,o=this,l=t,i){if(void 0===a)return function(t){return h=t,a=f(b,e),c?p(t):s}(l);if(d)return a=f(b,e),p(l)}return void 0===a&&(a=f(b,e)),s}}let y_=1,C_=class{constructor(){this.listeners={},this.reseizeListeners={}}on(t,e,i){if("node"===kx.mode)return-1;const n=y_++;for(var o=arguments.length,r=new Array(o>3?o-3:0),s=3;s<o;s++)r[s-3]=arguments[s];if(null==t?void 0:t.addEventListener)if("resize"!==e||t===window)null==t||t.addEventListener(e,i,...r);else{const e=new class{constructor(t,e,i){var n;if(this.resizeTime=100,this.lastSize={width:0,height:0},this.mutationResize=()=>{this.onResize()},this.callBack=()=>{const t=this.getSize();let e=!1;t.width===this.lastSize.width&&t.height===this.lastSize.height&&(e=!0),this.lastSize=t,this.cb&&this.cb(Object.assign(Object.assign({},this.lastSize),{windowSizeNotChange:e}))},this.onResize=()=>{this.callBackDebounce()},this.element=t,this.cb=e,this.lastSize=this.getSize(),i&&(this.resizeTime=Math.max(i,16)),this.callBackDebounce=m_(this.callBack,this.resizeTime),null===window||void 0===window||window.addEventListener("resize",this.onResize),"ResizeObserver"in window){const t=window.ResizeObserver;this.observer=new t(this.mutationResize),null===(n=this.observer)||void 0===n||n.observe(this.element)}else"MutationObserver"in window&&(this.observer=new MutationObserver(this.mutationResize),this.observer.observe(this.element,{attributes:!0,attributeFilter:["style"]}))}disConnect(){window.removeEventListener("resize",this.onResize),this.observer&&(this.observer.disconnect(),this.observer=void 0)}setSize(t){this.lastSize=t}checkSize(){const t=this.getSize();return t.width!==this.lastSize.width||t.height!==this.lastSize.height}getSize(){return this.element?{width:Math.floor(this.element.clientWidth),height:Math.floor(this.element.clientHeight)}:Object.assign({},this.lastSize)}}(t,i,this.resizeTime);this.reseizeListeners[n]=e}const a={target:t,type:e,listener:i,options:r};return this.listeners[n]=a,n}once(t,e,i){var n=this;if("node"===kx.mode)return-1;for(var o=arguments.length,r=new Array(o>3?o-3:0),s=3;s<o;s++)r[s-3]=arguments[s];const a=this.on(t,e,(function(){n.off(a),i(...arguments)}),...r);return a}off(t){var e;if("node"===kx.mode)return;if(null===t)return;const i=null===(e=this.listeners)||void 0===e?void 0:e[t];i&&(delete this.listeners[t],i.target.removeEventListener&&i.target.removeEventListener(i.type,i.listener,...i.options))}fire(t,e){if("node"!==kx.mode){for(var i=arguments.length,n=new Array(i>2?i-2:0),o=2;o<i;o++)n[o-2]=arguments[o];for(const i in this.listeners){const o=this.listeners[i];o.target===t&&o.type===e&&o.listener.call(o.target,...n)}}}hasListener(t,e){if("node"===kx.mode)return!1;let i=!1;for(const n in this.listeners){const o=this.listeners[n];o.target===t&&o.type===e&&(i=!0)}return i}clear(){if("node"!==kx.mode){for(const t in this.listeners){const e=this.listeners[t];e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options)}for(const t in this.reseizeListeners){const e=this.reseizeListeners[t];null==e||e.disConnect()}this.listeners={}}}release(){"node"!==kx.mode&&(this.clear(),this.listeners={})}};const w_=(t,e)=>{let i=0,n=t.length-1;for(;i<=n;){const o=Math.floor((i+n)/2);if(t[o]===e)return o;t[o]>e?n=o-1:i=o+1}return n<0?0:n};class x_{constructor(){this._keys=[],this._vals={},this._sorted=!1}count(){return this._keys.length}values(){return this._vals}valueArr(){return Object.values(this._vals)}adjustOrder(t,e,i){const{_keys:n}=this;if(this._sorted||(n.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0),t>e){const o=[];for(let r=w_(n,t+i-1);r>=0;r--){const s=n[r];if(s>=t)o.push(this.get(s));else if(e<=s&&s<t)this.put(s+i,this.get(s));else if(s<e)break}for(let t=0;t<i;t++)this.put(e+t,o[i-1-t])}const{length:o}=n;if(t<e){const r=[];for(let s=w_(n,t);s<o;s++){const o=n[s];if(o>=t&&o<t+i)r.push(this.get(o));else if(t+i<=o&&o<=e)this.put(o-i,this.get(o));else if(o>e)break}for(let t=0;t<i;t++)this.put(e+t,r[t])}}exchangeOrder(t,e,i,n,o){const{_keys:r}=this;if(this._sorted||(r.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0),t>i){const n=[],s=[];for(let o=w_(r,i);o<w_(r,t)+e;o++){const i=r[o];i>=t&&i<t+e?s.push(this.get(i)):n.push(this.get(i))}for(let t=0;t<e;t++)this.put(o+t,s[t]);for(let t=0;t<n.length;t++)this.put(o+e+t,n[t])}else{const s=[],a=[];for(let o=w_(r,t);o<w_(r,i)+n;o++){const i=r[o];i>=t&&i<t+e?a.push(this.get(i)):s.push(this.get(i))}for(let t=0;t<e;t++)this.put(o+t,a[t]);for(let e=0;e<s.length;e++)this.put(t+e,s[e])}}del(t){delete this._vals[t];const e=this._keys.indexOf(t);-1!==e&&this._keys.splice(e,1)}put(t,e){t in this._vals||(this._keys.push(t),this._sorted=!1),this._vals[t]=e}get(t){return this._vals[t]}has(t){return XC(this._vals[t])}contain(t){return Object.values(this._vals).indexOf(t)>=0}each(t,e,i){const{_keys:n}=this,{length:o}=n;this._sorted||(n.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0);for(let r=w_(n,t);r<o;r++){const o=n[r];if(t<=o&&o<=e){if(!1===i(this.get(o),o))break}else if(e<o)return}}clear(){this._keys.length=0,this._vals={},this._sorted=!1}getLastIndex(){return this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.del(t)}delAndReorder(t){if(!this.has(t))return;const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}addAndReorder(t,e){if(XC(e)){const i=this.getLastIndex();this.adjustOrder(t,t+1,i-t),this.put(t,e)}}}let __=class t{constructor(t,e,i,n){this.bounds=new yw,this.bounds.set(t,e,t+i,e+n)}static bounds(e,i,n,o){return new t(e,i,Math.round(n-e),Math.round(o-i))}get left(){return this.bounds.x1}set left(t){this.bounds.x1=t}get top(){return this.bounds.y1}set top(t){this.bounds.y1=t}get right(){return this.bounds.x2}set right(t){this.bounds.x2=t}get bottom(){return this.bounds.y2}set bottom(t){this.bounds.y2=t}get width(){return this.bounds.width()}set width(t){this.bounds.x2=this.bounds.x1+t}get height(){return this.bounds.height()}set height(t){this.bounds.y2=this.bounds.y1+t}offsetLeft(t){this.bounds.translate(t,0)}offsetTop(t){this.bounds.translate(0,t)}copy(){return new t(this.left,this.top,this.width,this.height)}contains(t){return this.bounds.encloses(t.bounds)}inPoint(t,e){return this.bounds.contains(t,e)}};var S_={name:"DARK",underlayBackgroundColor:"transparent",defaultStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},headerStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},rowHeaderStyle:{},cornerHeaderStyle:{},bodyStyle:{color:"#e5e7ea",bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#282a2e":"#2d3137"},fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#29364D"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:10,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)",visible:"always"}},selectionStyle:{cellBgColor:"rgba(255, 255, 255, 0.1)",cellBorderColor:"#4284FF",cellBorderLineWidth:2},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"},functionalIconsStyle:{sort_color:"#FFFFFF",sort_color_opacity:"0.75",sort_color_2:"#416EFF",sort_color_opacity_2:"1",frozen_color:"#FFFFFF",frozen_color_opacity:"0.75",collapse_color:"#FFF",collapse_color_opacity:"0.75",expand_color:"#FFF",expand_color_opacity:"0.75",dragReorder_color:"#FFF",dragReorder_color_opacity:"0.75"}};var A_={name:"BRIGHT",underlayBackgroundColor:"#FFF",defaultStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#5286FA",hover:{cellBgColor:"#2E67E3"}},headerStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#A1C1FF",hover:{cellBgColor:"#2E67E3"}},bodyStyle:{color:"#000",bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#FFF":"#F4F8FF"},borderColor:"#E0EAFE",hover:{cellBgColor:"#E9EFFD"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"#CBDCFE",endColor:"#CBDCFE",visible:"always"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var B_={name:"ARCO",underlayBackgroundColor:"#FFF",defaultStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12]},headerStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},rowHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},cornerHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},bodyStyle:{padding:[8,12,8,12],color:"#141414",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:400,textAlign:"left",bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#fbfbfc":"#FFF"},borderColor:"#e1e4e8",lineHeight:14,hover:{cellBgColor:"#F7F8FA",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:4,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)",visible:"always"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#3073f2"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var T_={name:"DEFAULT",underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:"#E1E4E8",color:"#000",bgColor:"#ECF1F5"},headerStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},rowHeaderStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},cornerHeaderStyle:{fontSize:16,fontWeight:"bold"},bodyStyle:{fontSize:14,bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#FDFDFD":"#FAF9FB"},hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"rgba(225, 228, 232, 0.6)",endColor:"rgba(225, 228, 232, 0.6)",visible:"always"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#0000ff"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var R_={name:"SIMPLIFY",underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:function(t){const{col:e,table:i}=t,{colCount:n,frozenColCount:o}=i,r="#ccc7c7";return o-1===e||n-1===e?[r,"#f2f2f2","#ccc7c7",null]:[r,null,"#ccc7c7",null]},hover:{cellBorderColor:"#0000FF",cellBgColor:"#D0E0E3"},bgColor:"#FFF"},headerStyle:{color:"rgba(0, 0, 0, 0.87)",borderColor:function(t){const{row:e,table:{frozenRowCount:i}}=t;return i-1===e?["#f2f2f2","#f2f2f2","#ccc7c7","#f2f2f2"]:["#f2f2f2"]}},bodyStyle:{color:"rgba(0, 0, 0, 0.87)"},frameStyle:{borderColor:"#f2f2f2",borderLineWidth:1},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF"},selectionStyle:{cellBorderColor:"#FD5",cellBgColor:"rgba(111, 168, 220, 0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};const k_={},M_="Arial,sans-serif",L_=[],P_=/^(https?|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/,E_="$$indicator$$",H_={type:"line"};function O_(t){return t||{}}const I_={visible:!0,position:"auto",padding:8,titleStyle:{fontSize:12,fontWeight:"bold",fill:"#4E5969"},contentStyle:{fontSize:12,fill:"#4E5969"},panel:{visible:!0,fill:"#fff",stroke:"#ffffff",lineWidth:0,cornerRadius:3,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:"rgba(0, 0, 0, 0.1)",size:0,space:12}};function F_(t,e,i,n){var o,r,s;return null!==(s=null!==(r=null!==(o=i_(t,...i))&&void 0!==o?o:i_(e,...i))&&void 0!==r?r:n&&i_(t,...n))&&void 0!==s?s:n&&i_(e,...n)}class z_{constructor(t,e){this._defaultStyle=null,this._header=null,this._cornerHeader=null,this._cornerRightTopCell=null,this._cornerLeftBottomCell=null,this._cornerRightBottomCell=null,this._rightFrozen=null,this._bottomFrozen=null,this._rowHeader=null,this._body=null,this._groupTitle=null,this._scroll=null,this._tooltip=null,this._frameStyle=null,this._columnResize=null,this._dragHeaderSplitLine=null,this._frozenColumnLine=null,this._selectionStyle=null,this._axisStyle=null,this._checkboxStyle=null,this._radioStyle=null,this._switchStyle=null,this._buttonStyle=null,this._textPopTipStyle=null,this._internalIconsStyle=null,this.isPivot=!1,this.name="",this.internalTheme={obj:t,superTheme:e},this.name=F_(t,e,["name"])}getExtendTheme(){return this.internalTheme.obj}clearBodyStyleCache(){this._body=null}get font(){const{obj:t,superTheme:e}=this.internalTheme;return F_(t,e,["font"],["bodyStyle","font"])}get underlayBackgroundColor(){const{obj:t,superTheme:e}=this.internalTheme;return F_(t,e,["underlayBackgroundColor"])}get cellInnerBorder(){var t;const{obj:e,superTheme:i}=this.internalTheme;return null===(t=F_(e,i,["cellInnerBorder"]))||void 0===t||t}get cellBorderClipDirection(){var t;const{obj:e,superTheme:i}=this.internalTheme;return null!==(t=F_(e,i,["cellBorderClipDirection"]))&&void 0!==t?t:"top-left"}get _contentOffset(){var t;const{obj:e,superTheme:i}=this.internalTheme;return null!==(t=F_(e,i,["_contentOffset"]))&&void 0!==t?t:0}get defaultStyle(){const t=this;if(!this._defaultStyle){const{obj:e,superTheme:i}=this.internalTheme,n=Ox({},i.defaultStyle,e.defaultStyle);this._defaultStyle={get fontSize(){var t;return null!==(t=n.fontSize)&&void 0!==t?t:16},get fontFamily(){var t;return null!==(t=n.fontFamily)&&void 0!==t?t:M_},get fontWeight(){return n.fontWeight},get fontVariant(){return n.fontVariant},get fontStyle(){return n.fontStyle},get bgColor(){var t;return null!==(t=n.bgColor)&&void 0!==t?t:"#FFF"},get color(){var t;return null!==(t=n.color)&&void 0!==t?t:"#000"},get borderColor(){var t;return null!==(t=n.borderColor)&&void 0!==t?t:"#000"},get borderLineWidth(){var t;return null!==(t=n.borderLineWidth)&&void 0!==t?t:1},get borderLineDash(){var t;return null!==(t=n.borderLineDash)&&void 0!==t?t:L_},get hover(){if(n.hover)return{get cellBgColor(){var t,e;return null!==(e=null===(t=n.hover)||void 0===t?void 0:t.cellBgColor)&&void 0!==e?e:void 0},get inlineColumnBgColor(){var t,e,i,o,r,s;return null!==(s=null!==(e=null===(t=n.hover)||void 0===t?void 0:t.inlineColumnBgColor)&&void 0!==e?e:(null===(i=n.hover)||void 0===i?void 0:i.cellBgColor)&&"string"==typeof(null===(o=n.hover)||void 0===o?void 0:o.cellBgColor)?Dx(null===(r=n.hover)||void 0===r?void 0:r.cellBgColor,.1,!1):void 0)&&void 0!==s?s:void 0},get inlineRowBgColor(){var t,e,i,o,r,s;return null!==(s=null!==(e=null===(t=n.hover)||void 0===t?void 0:t.inlineRowBgColor)&&void 0!==e?e:(null===(i=n.hover)||void 0===i?void 0:i.cellBgColor)&&"string"==typeof(null===(o=n.hover)||void 0===o?void 0:o.cellBgColor)?Dx(null===(r=n.hover)||void 0===r?void 0:r.cellBgColor,.1,!1):void 0)&&void 0!==s?s:void 0}}},get select(){if(n.select)return{get inlineColumnBgColor(){var e,i,o,r,s,a;return null!==(a=null!==(r=null!==(i=null===(e=n.select)||void 0===e?void 0:e.inlineColumnBgColor)&&void 0!==i?i:null===(o=t.selectionStyle)||void 0===o?void 0:o.inlineColumnBgColor)&&void 0!==r?r:(null===(s=t.selectionStyle)||void 0===s?void 0:s.cellBgColor)&&"string"==typeof t.selectionStyle.cellBgColor?Dx(t.selectionStyle.cellBgColor,.1,!1):void 0)&&void 0!==a?a:void 0},get inlineRowBgColor(){var e,i,o,r,s;return null!==(s=null!==(o=null!==(i=null===(e=n.select)||void 0===e?void 0:e.inlineRowBgColor)&&void 0!==i?i:t.selectionStyle.inlineRowBgColor)&&void 0!==o?o:(null===(r=t.selectionStyle)||void 0===r?void 0:r.cellBgColor)&&"string"==typeof t.selectionStyle.cellBgColor?Dx(t.selectionStyle.cellBgColor,.1,!1):void 0)&&void 0!==s?s:void 0}}},get padding(){var t;return null!==(t=n.padding)&&void 0!==t?t:[10,16,10,16]},get textAlign(){var t;return null!==(t=n.textAlign)&&void 0!==t?t:"left"},get textBaseline(){var t;return null!==(t=n.textBaseline)&&void 0!==t?t:"middle"},get textOverflow(){var t;return null!==(t=n.textOverflow)&&void 0!==t?t:"ellipsis"},get lineHeight(){return n.lineHeight},get autoWrapText(){var t;return null!==(t=n.autoWrapText)&&void 0!==t&&t},get lineClamp(){var t;return null!==(t=n.lineClamp)&&void 0!==t?t:"auto"},get linkColor(){var t;return null!==(t=n.linkColor)&&void 0!==t?t:"#3772ff"},get cursor(){var t;return null!==(t=n.cursor)&&void 0!==t?t:"auto"},get marked(){var t;return null!==(t=n.marked)&&void 0!==t&&t},get underline(){var t;return null!==(t=n.underline)&&void 0!==t&&t},get underlineColor(){return n.underlineColor},get underlineDash(){return n.underlineDash},get underlineOffset(){return n.underlineOffset},get lineThrough(){var t;return null!==(t=n.lineThrough)&&void 0!==t&&t},get lineThroughColor(){return n.lineThroughColor},get lineThroughDash(){return n.lineThroughDash}}}return this._defaultStyle}get cornerHeaderStyle(){if(!this._cornerHeader){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},this.defaultStyle,e.cornerHeaderStyle,t.cornerHeaderStyle);this._cornerHeader=this.getStyle(i)}return this._cornerHeader}get cornerRightTopCellStyle(){if(!this._cornerRightTopCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightTopCellStyle&&!t.cornerRightTopCellStyle)return this._cornerRightTopCell;const i=Ox({},this.defaultStyle,e.cornerRightTopCellStyle,t.cornerRightTopCellStyle);this._cornerRightTopCell=this.getStyle(i)}return this._cornerRightTopCell}get cornerLeftBottomCellStyle(){if(!this._cornerLeftBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerLeftBottomCellStyle&&!t.cornerLeftBottomCellStyle)return this._cornerLeftBottomCell;const i=Ox({},this.defaultStyle,e.cornerLeftBottomCellStyle,t.cornerLeftBottomCellStyle);this._cornerLeftBottomCell=this.getStyle(i)}return this._cornerLeftBottomCell}get cornerRightBottomCellStyle(){if(!this._cornerRightBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightBottomCellStyle&&!t.cornerRightBottomCellStyle)return this._cornerRightBottomCell;const i=Ox({},this.defaultStyle,e.cornerRightBottomCellStyle,t.cornerRightBottomCellStyle);this._cornerRightBottomCell=this.getStyle(i)}return this._cornerRightBottomCell}get rightFrozenStyle(){if(!this._rightFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.rightFrozenStyle&&!t.rightFrozenStyle)return this._rightFrozen;const i=Ox({},this.defaultStyle,this.rowHeaderStyle,e.rightFrozenStyle,t.rightFrozenStyle);this._rightFrozen=this.getStyle(i)}return this._rightFrozen}get bottomFrozenStyle(){if(!this._bottomFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.bottomFrozenStyle&&!t.bottomFrozenStyle)return this._bottomFrozen;const i=Ox({},this.defaultStyle,this.headerStyle,e.bottomFrozenStyle,t.bottomFrozenStyle);this._bottomFrozen=this.getStyle(i)}return this._bottomFrozen}get rowHeaderStyle(){var t;if(!this._rowHeader){const{obj:e,superTheme:i}=this.internalTheme,n=Ox({},this.defaultStyle,i.rowHeaderStyle,null!==(t=e.rowHeaderStyle)&&void 0!==t?t:this.isPivot?null:e.headerStyle);this._rowHeader=this.getStyle(n)}return this._rowHeader}get headerStyle(){if(!this._header){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},this.defaultStyle,e.headerStyle,t.headerStyle);this._header=this.getStyle(i)}return this._header}get bodyStyle(){if(!this._body){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},this.defaultStyle,e.bodyStyle,t.bodyStyle);this._body=this.getStyle(i)}return this._body}get groupTitleStyle(){if(!this._groupTitle){const{obj:t,superTheme:e}=this.internalTheme;if(!e.groupTitleStyle&&!t.groupTitleStyle)return this._groupTitle;const i=Ox({},this.defaultStyle,e.groupTitleStyle,t.groupTitleStyle);this._groupTitle=this.getStyle(i)}return this._groupTitle}get frameStyle(){if(!this._frameStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.frameStyle,t.frameStyle);this._frameStyle={get borderColor(){return i.borderColor},get borderLineWidth(){return i.borderLineWidth},get borderLineDash(){return i.borderLineDash},get innerBorder(){return i.innerBorder},get shadowBlur(){return i.shadowBlur},get shadowColor(){return i.shadowColor},get shadowOffsetX(){return i.shadowOffsetX},get shadowOffsetY(){return i.shadowOffsetY},get cornerRadius(){return i.cornerRadius}}}return this._frameStyle}get scrollStyle(){if(!this._scroll){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.scrollStyle,t.scrollStyle);this._scroll={get scrollSliderColor(){var t;return null!==(t=i.scrollSliderColor)&&void 0!==t?t:"#C0C0C0"},get scrollSliderCornerRadius(){return i.scrollSliderCornerRadius},get scrollRailColor(){return i.scrollRailColor},get visible(){var t;return null!==(t=i.visible)&&void 0!==t?t:"scrolling"},get verticalVisible(){return i.verticalVisible},get horizontalVisible(){return i.horizontalVisible},get width(){var t;return null!==(t=i.width)&&void 0!==t?t:7},get hoverOn(){var t;return null===(t=i.hoverOn)||void 0===t||t},get barToSide(){var t;return null!==(t=i.barToSide)&&void 0!==t&&t},get horizontalPadding(){var t;return null!==(t=i.horizontalPadding)&&void 0!==t?t:0},get verticalPadding(){var t;return null!==(t=i.verticalPadding)&&void 0!==t?t:0}}}return this._scroll}get tooltipStyle(){if(!this._tooltip){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.tooltipStyle,t.tooltipStyle);this._tooltip={get fontFamily(){var t;return null!==(t=i.fontFamily)&&void 0!==t?t:M_},get fontSize(){var t;return null!==(t=i.fontSize)&&void 0!==t?t:16},get bgColor(){var t;return null!==(t=i.bgColor)&&void 0!==t?t:"#000"},get padding(){var t;return null!==(t=i.padding)&&void 0!==t?t:[6,8]},get color(){var t;return null!==(t=i.color)&&void 0!==t?t:"#FFF"},get maxWidth(){return i.maxWidth},get maxHeight(){return i.maxHeight}}}return this._tooltip}get columnResize(){if(!this._columnResize){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.columnResize,t.columnResize);this._columnResize={get lineColor(){var t;return null!==(t=i.lineColor)&&void 0!==t?t:"#416EFF"},get bgColor(){var t;return null!==(t=i.bgColor)&&void 0!==t?t:"#D9E2FF"},get lineWidth(){var t;return null!==(t=i.lineWidth)&&void 0!==t?t:1},get width(){var t;return null!==(t=i.width)&&void 0!==t?t:i.lineWidth+2},get resizeHotSpotSize(){var t;return null!==(t=i.resizeHotSpotSize)&&void 0!==t?t:16},get labelColor(){var t;return null!==(t=i.labelColor)&&void 0!==t?t:"#FFF"},get labelFontSize(){var t;return null!==(t=i.labelFontSize)&&void 0!==t?t:10},get labelFontFamily(){var t;return null!==(t=i.labelFontFamily)&&void 0!==t?t:"sans-serif"},get labelBackgroundFill(){var t;return null!==(t=i.labelBackgroundFill)&&void 0!==t?t:"#3073F2"},get labelBackgroundCornerRadius(){var t;return null!==(t=i.labelBackgroundCornerRadius)&&void 0!==t?t:5},get labelVisible(){var t;return null===(t=i.labelVisible)||void 0===t||t},get visibleOnHover(){var t;return null!==(t=i.visibleOnHover)&&void 0!==t&&t}}}return this._columnResize}get dragHeaderSplitLine(){if(!this._dragHeaderSplitLine){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.dragHeaderSplitLine,t.dragHeaderSplitLine);this._dragHeaderSplitLine={get lineColor(){var t;return null!==(t=i.lineColor)&&void 0!==t?t:"blue"},get lineWidth(){var t;return null!==(t=i.lineWidth)&&void 0!==t?t:2},get shadowBlockColor(){var t;return null!==(t=i.shadowBlockColor)&&void 0!==t?t:"rgba(204,204,204,0.3)"}}}return this._dragHeaderSplitLine}get frozenColumnLine(){if(!this._frozenColumnLine){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.frozenColumnLine,t.frozenColumnLine);this._frozenColumnLine={get shadow(){if(i.shadow)return{get width(){var t,e;return null!==(e=null===(t=i.shadow)||void 0===t?void 0:t.width)&&void 0!==e?e:24},get startColor(){var t,e;return null!==(e=null===(t=i.shadow)||void 0===t?void 0:t.startColor)&&void 0!==e?e:"rgba(00, 24, 47, 0.06)"},get endColor(){var t,e;return null!==(e=null===(t=i.shadow)||void 0===t?void 0:t.endColor)&&void 0!==e?e:"rgba(00, 24, 47, 0)"},get visible(){var t,e;return null!==(e=null===(t=i.shadow)||void 0===t?void 0:t.visible)&&void 0!==e?e:"always"}}},get border(){if(i.border)return{get lineColor(){var t,e;return null!==(e=null===(t=i.border)||void 0===t?void 0:t.lineColor)&&void 0!==e?e:"rgba(00, 24, 47, 0.06)"},get bgColor(){var t,e,n,o;return null!==(o=null!==(e=null===(t=i.border)||void 0===t?void 0:t.bgColor)&&void 0!==e?e:null===(n=i.border)||void 0===n?void 0:n.lineColor)&&void 0!==o?o:"rgba(00, 24, 47, 0.06)"},get lineWidth(){var t,e;return null!==(e=null===(t=i.border)||void 0===t?void 0:t.lineWidth)&&void 0!==e?e:4},get width(){var t,e,n,o;return null!==(o=null!==(e=null===(t=i.border)||void 0===t?void 0:t.width)&&void 0!==e?e:null===(n=i.border)||void 0===n?void 0:n.lineWidth)&&void 0!==o?o:4}}}}}return this._frozenColumnLine}get selectionStyle(){if(!this._selectionStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.selectionStyle,t.selectionStyle);this._selectionStyle={get cellBgColor(){var t;return null!==(t=null==i?void 0:i.cellBgColor)&&void 0!==t?t:"rgba(0, 0, 255,0.1)"},get cellBorderColor(){var t;return null!==(t=null==i?void 0:i.cellBorderColor)&&void 0!==t?t:"#3073f2"},get cellBorderLineWidth(){var t;return null!==(t=null==i?void 0:i.cellBorderLineWidth)&&void 0!==t?t:2},get inlineColumnBgColor(){return null==i?void 0:i.inlineColumnBgColor},get inlineRowBgColor(){return null==i?void 0:i.inlineRowBgColor},get selectionFillMode(){var t;return null!==(t=null==i?void 0:i.selectionFillMode)&&void 0!==t?t:"overlay"},get dynamicUpdateSelectionSize(){var t;return null!==(t=null==i?void 0:i.dynamicUpdateSelectionSize)&&void 0!==t&&t}}}return this._selectionStyle}get axisStyle(){if(!this._axisStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.axisStyle,t.axisStyle);this._axisStyle=function(t){return{defaultAxisStyle:O_(t.defaultAxisStyle),leftAxisStyle:O_(t.leftAxisStyle),rightAxisStyle:O_(t.rightAxisStyle),topAxisStyle:O_(t.topAxisStyle),bottomAxisStyle:O_(t.bottomAxisStyle)}}(i)}return this._axisStyle}get checkboxStyle(){if(!this._checkboxStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.checkboxStyle,t.checkboxStyle);this._checkboxStyle=i}return this._checkboxStyle}get radioStyle(){if(!this._radioStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.radioStyle,t.radioStyle);this._radioStyle=i}return this._radioStyle}get switchStyle(){if(!this._switchStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.switchStyle,t.switchStyle);this._switchStyle=i}return this._switchStyle}get buttonStyle(){if(!this._buttonStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.buttonStyle,t.buttonStyle);this._buttonStyle=i}return this._buttonStyle}get textPopTipStyle(){if(!this._textPopTipStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},I_,e.textPopTipStyle,t.textPopTipStyle);this._textPopTipStyle=i}return this._textPopTipStyle}get functionalIconsStyle(){if(!this._internalIconsStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ox({},e.functionalIconsStyle,t.functionalIconsStyle);this._internalIconsStyle=i}return this._internalIconsStyle}hasProperty(t){const{obj:e,superTheme:i}=this.internalTheme;return D_(e,t)||D_(i,t)}extends(t){return new z_(Ox({},t),Ox(this.internalTheme.superTheme,this.internalTheme.obj))}getStyle(t){const e=this;return{get fontSize(){return t.fontSize},get fontFamily(){return t.fontFamily},get fontWeight(){return t.fontWeight},get fontVariant(){return t.fontVariant},get fontStyle(){return t.fontStyle},get bgColor(){return t.bgColor},get color(){return t.color},get strokeColor(){return t.strokeColor},get borderColor(){return t.borderColor},get borderLineWidth(){return t.borderLineWidth},get borderLineDash(){return t.borderLineDash},get hover(){if(t.hover)return{get cellBgColor(){var e,i;return null!==(i=null===(e=t.hover)||void 0===e?void 0:e.cellBgColor)&&void 0!==i?i:void 0},get inlineColumnBgColor(){var e,i,n,o,r,s;return null!==(s=null!==(i=null===(e=t.hover)||void 0===e?void 0:e.inlineColumnBgColor)&&void 0!==i?i:(null===(n=t.hover)||void 0===n?void 0:n.cellBgColor)&&"string"==typeof(null===(o=t.hover)||void 0===o?void 0:o.cellBgColor)?Dx(null===(r=t.hover)||void 0===r?void 0:r.cellBgColor,.1,!1):void 0)&&void 0!==s?s:void 0},get inlineRowBgColor(){var e,i,n,o,r,s;return null!==(s=null!==(i=null===(e=t.hover)||void 0===e?void 0:e.inlineRowBgColor)&&void 0!==i?i:(null===(n=t.hover)||void 0===n?void 0:n.cellBgColor)&&"string"==typeof(null===(o=t.hover)||void 0===o?void 0:o.cellBgColor)?Dx(null===(r=t.hover)||void 0===r?void 0:r.cellBgColor,.1,!1):void 0)&&void 0!==s?s:void 0}}},get select(){return{get inlineColumnBgColor(){var i,n,o,r,s,a;return null!==(a=null!==(r=null!==(n=null===(i=t.select)||void 0===i?void 0:i.inlineColumnBgColor)&&void 0!==n?n:null===(o=e.selectionStyle)||void 0===o?void 0:o.inlineColumnBgColor)&&void 0!==r?r:(null===(s=e.selectionStyle)||void 0===s?void 0:s.cellBgColor)&&"string"==typeof e.selectionStyle.cellBgColor?Dx(e.selectionStyle.cellBgColor,.1,!1):void 0)&&void 0!==a?a:void 0},get inlineRowBgColor(){var i,n,o,r,s;return null!==(s=null!==(o=null!==(n=null===(i=t.select)||void 0===i?void 0:i.inlineRowBgColor)&&void 0!==n?n:e.selectionStyle.inlineRowBgColor)&&void 0!==o?o:(null===(r=e.selectionStyle)||void 0===r?void 0:r.cellBgColor)&&"string"==typeof e.selectionStyle.cellBgColor?Dx(e.selectionStyle.cellBgColor,.1,!1):void 0)&&void 0!==s?s:void 0},get cellBgColor(){var i,n,o;if("replace"===e.selectionStyle.selectionFillMode)return null!==(o=null!==(n=null===(i=t.select)||void 0===i?void 0:i.cellBgColor)&&void 0!==n?n:e.selectionStyle.cellBgColor)&&void 0!==o?o:void 0}}},get frameStyle(){if(t.frameStyle)return{get borderColor(){var e,i;return null!==(i=null===(e=t.frameStyle)||void 0===e?void 0:e.borderColor)&&void 0!==i?i:void 0},get borderLineWidth(){var e,i;return null!==(i=null===(e=t.frameStyle)||void 0===e?void 0:e.borderLineWidth)&&void 0!==i?i:void 0},get borderLineDash(){var e,i;return null!==(i=null===(e=t.frameStyle)||void 0===e?void 0:e.borderLineDash)&&void 0!==i?i:void 0}}},get padding(){return t.padding},get textAlign(){return t.textAlign},get textBaseline(){return t.textBaseline},get textOverflow(){return t.textOverflow},get lineHeight(){return t.lineHeight},get autoWrapText(){return t.autoWrapText},get lineClamp(){return t.lineClamp},get linkColor(){return t.linkColor},get cursor(){return t.cursor},get textStick(){return t.textStick},get marked(){return t.marked},get underline(){var e;return null!==(e=t.underline)&&void 0!==e&&e},get underlineColor(){return t.underlineColor},get underlineDash(){return t.underlineDash},get underlineOffset(){return t.underlineOffset},get lineThrough(){var e;return null!==(e=t.lineThrough)&&void 0!==e&&e},get lineThroughColor(){return t.lineThroughColor},get lineThroughDash(){return t.lineThroughDash}}}}function D_(t,e){if(t instanceof z_)return t.hasProperty(e);let i=t;if(!i)return!1;for(let t=0;t<e.length;t++)if(i=i[e[t]],!i)return!1;return!!i}const W_=new z_(S_,S_),N_=new z_(A_,A_),G_=new z_(B_,B_),j_=new z_(T_,T_),V_=new z_(R_,R_),U_={DEFAULT:j_,SIMPLIFY:V_,ARCO:G_,DARK:W_,BRIGHT:N_},X_={TableTheme:z_};function $_(t){if(!t)return null;if("string"==typeof t){const e=function(t,e){if(t[e])return t[e];const i=e.toLowerCase();if(t[i])return t[i];const n=e.toLowerCase();if(t[n])return t[n];for(const e in t)if(e.toLowerCase()===i)return t[e]}(Y_(),t);return e?e instanceof z_?e:new z_(e,e):null}return t instanceof z_?t:new z_(t,t)}function Y_(){return t_(U_,k_)}var K_={DARK:W_,BRIGHT:N_,ARCO:G_,DEFAULT:j_,SIMPLIFY:V_,theme:X_,of:$_,get:Y_},q_=Object.freeze({__proto__:null,ARCO:G_,BRIGHT:N_,DARK:W_,DEFAULT:j_,SIMPLIFY:V_,TableTheme:z_,default:K_,get:Y_,of:$_,theme:X_});function Z_(t,e,i){var n;if(t.internalProps.customMergeCell){const n=t.getCustomMerge(e,i);if(n)return n.range}if(!t.internalProps.enableTreeNodeMerge&&!t.isHeader(e,i)&&!(null===(n=t.getBodyColumnDefine(e,i))||void 0===n?void 0:n.mergeCell))return!1;const o=t.getCellRange(e,i);return!(o.start.col===o.end.col&&o.start.row===o.end.row)&&o}class J_{static registerComponent(t,e){J_._components[t]=e}static getComponent(t){return J_._components[t]}static registerFunction(t,e){J_._functions[t]=e}static getFunction(t){return J_._functions[t]}static registerCellType(t,e){J_._cellTypes[t]=e}static getCellType(t){return J_._cellTypes[t]}}function Q_(t,e,i,n,o,r){const s=function(t,e){const i=new Array(e);for(let n=0;n<e;n++)i[n]=t(n);return i}(t,i);s.sort(((t,e)=>n(r(t),r(e),o)));for(let t=0;t<i;t++)e(t,s[t])}J_._components={},J_._functions={},J_._cellTypes={};const tS={SOURCE_LENGTH_UPDATE:"source_length_update",CHANGE_ORDER:"change_order"};function eS(t,e){const i=n_(t);if(o_(i)){const t=i.then((t=>(e(t),t)));return e(t),t}return i}function iS(t,e,i,n,o,r){if(null==t)return;if(o_(t))return t.then((t=>iS(t,e,i,n,o,r)));const s=function(t){if(c_.isObject(t)){const e=t;if(XC(e.get)&&XC(e.set))return!0}return!1}(e)?e.get:e;if((void 0===s||""===s)&&Array.isArray(t))return t[i-o.leftRowSeriesNumberCount];if($C(t)&&s in t)return eS(t[s],r);if("function"==typeof s)return eS(s(t,i,n,o),r);if(Array.isArray(s))return eS(function(t,e){let i,n=t;for(;(i=e.shift())&&(n=n[i],n););return n}(t,[...s]),r);const a=`${s}`.split(".");return a.length<=1?eS(t[s],r):eS(e_(t,((t,e)=>iS(t,e,i,n,o,f_)),...a),r)}function nS(t,e){if(!t)return e;const i=t[e];return XC(i)?i:e}let oS=class extends gx{static get EVENT_TYPE(){return tS}constructor(t,e,i,n,o,r){var s;super(),this.currentIndexedData=[],this.hierarchyExpandLevel=0,this.hasHierarchyStateExpand=!1,this.beforeChangedRecordsMap=new Map,this.registedAggregators={},this.rowHierarchyType="grid",this.fieldAggregators=[],this.registerAggregators(),this.dataSourceObj=t,this.dataConfig=e,this._get=null==t?void 0:t.get,this.columns=n,this._source=(null==t?void 0:t.records)?this.processRecords(null==t?void 0:t.records):t,this._sourceLength=(null===(s=this._source)||void 0===s?void 0:s.length)||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=i,this.pagination=i||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},r>=1&&(this.hierarchyExpandLevel=r),this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),"tree"===o&&this.initTreeHierarchyState(),this.rowHierarchyType=o,this.updatePagerData()}initTreeHierarchyState(){var t;this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e));let e=this._sourceLength;for(let i=0;i<e;i++){const n=this.currentIndexedData[i],o=this.getOriginalRecord(n),r=null!==(t=o.filteredChildren)&&void 0!==t?t:o.children;if((null==r?void 0:r.length)>0){if(this.hierarchyExpandLevel>1?!o.hierarchyState&&(o.hierarchyState=Kw.expand):!o.hierarchyState&&(o.hierarchyState=Kw.collapse),this.hasHierarchyStateExpand=!0,o.hierarchyState===Kw.collapse)continue;const t=this.initChildrenNodeHierarchy(n,this.hierarchyExpandLevel,2,o);i+=t,e+=t}else!0===o.children&&!o.hierarchyState&&(o.hierarchyState=Kw.collapse)}}supplementConfig(t,e,i,n){var o;this.columns=e,this._sourceLength=(null===(o=this._source)||void 0===o?void 0:o.length)||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=t,this.pagination=t||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},n>=1&&(this.hierarchyExpandLevel=n),this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),"tree"===i&&this.initTreeHierarchyState(),this.rowHierarchyType=i,this.updatePagerData()}registerAggregator(t,e){this.registedAggregators[t]=e}registerAggregators(){this.registerAggregator(Xw.RECORD,ex),this.registerAggregator(Xw.SUM,ox),this.registerAggregator(Xw.COUNT,rx),this.registerAggregator(Xw.MAX,ax),this.registerAggregator(Xw.MIN,lx),this.registerAggregator(Xw.AVG,sx),this.registerAggregator(Xw.NONE,ix),this.registerAggregator(Xw.CUSTOM,nx)}updateColumns(t){this.columns=t}_generateFieldAggragations(){const t=this.columns;this.fieldAggregators=[];const e=t=>{delete t.vtable_aggregator;const e=t.field,i=t.aggregation;if(i)if(Array.isArray(i))for(const n of i){const i=new this.registedAggregators[n.aggregationType]({field:e,formatFun:n.formatFun,isRecord:!0,aggregationFun:n.aggregationFun});this.fieldAggregators.push(i),t.vtable_aggregator||(t.vtable_aggregator=[]),t.vtable_aggregator.push(i)}else{const n=new this.registedAggregators[i.aggregationType]({field:e,formatFun:i.formatFun,isRecord:!0,aggregationFun:i.aggregationFun});this.fieldAggregators.push(n),t.vtable_aggregator=n}},i=t=>{if(t&&0!==t.length)for(const n of t)e(n),n.columns&&i(n.columns)};i(t)}processRecords(t){var e,i,n,o,r,s,a,l;this._generateFieldAggragations();const h=[],d=this.fieldAggregators.length>=1;if((null===(i=null===(e=this.dataConfig)||void 0===e?void 0:e.filterRules)||void 0===i?void 0:i.length)>=1||(null===(n=this.lastFilterRules)||void 0===n?void 0:n.length)>=1||d){for(let e=0,i=t.length;e<i;e++){const i=t[e];(null===(r=null===(o=this.dataConfig)||void 0===o?void 0:o.filterRules)||void 0===r?void 0:r.length)>=1?this.filterRecord(i)&&(h.push(i),"tree"===this.rowHierarchyType&&i.children&&(i.filteredChildren=this.filteredChildren(i.children)),d&&this.processRecord(i)):(null===(s=this.lastFilterRules)||void 0===s?void 0:s.length)>=1?(this.clearFilteredChildren(i),d&&this.processRecord(i)):d&&this.processRecord(i)}if((null===(l=null===(a=this.dataConfig)||void 0===a?void 0:a.filterRules)||void 0===l?void 0:l.length)>=1)return h}return t}filteredChildren(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];this.filterRecord(n)&&(e.push(n),n.children&&(n.filteredChildren=this.filteredChildren(n.children)))}return e}processRecord(t){for(let e=0;e<this.fieldAggregators.length;e++)this.fieldAggregators[e].push(t)}initChildrenNodeHierarchy(t,e,i,n){var o,r,s;let a=0;const l=n.filteredChildren?n.filteredChildren.length:null!==(r=null===(o=n.children)||void 0===o?void 0:o.length)&&void 0!==r?r:0;for(let o=0;o<l;o++){(i<=e||n.hierarchyState===Kw.expand)&&(a+=1);const r=n.filteredChildren?n.filteredChildren[o]:n.children[o],l=Array.isArray(t)?t.concat(o):[t,o];(i<=e||n.hierarchyState===Kw.expand)&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+a,0,l),(r.filteredChildren?r.filteredChildren.length>0:(null===(s=r.children)||void 0===s?void 0:s.length)>0)&&(i<e||r.hierarchyState===Kw.expand?(!r.hierarchyState&&(r.hierarchyState=Kw.expand),this.hasHierarchyStateExpand=!0):!r.hierarchyState&&(r.hierarchyState=Kw.collapse)),r.hierarchyState===Kw.expand&&(a+=this.initChildrenNodeHierarchy(l,e,i+1,r)),!0===r.children&&!r.hierarchyState&&(r.hierarchyState=Kw.collapse)}return a}updatePagination(t){this.pagination=t||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},this.updatePagerData()}updatePagerData(){const{currentIndexedData:t}=this,{perPageCount:e,currentPage:i}=this.pagination,n=e*(i||0),o=n+e;if(this._currentPagerIndexedData.length=0,t&&t.length>0){let e=-1;for(let i=0;i<t.length;i++)if((Array.isArray(t[i])&&1===t[i].length||!Array.isArray(t[i]))&&e++,e>=n&&e<o)this._currentPagerIndexedData.push(t[i]);else if(e>=o)break}else if(this._sourceLength>0)throw new Error("currentIndexedData should has values!")}getRecordIndexPaths(t){return this._currentPagerIndexedData[t]}get records(){return Array.isArray(this._source)?this._source:[]}get source(){return this._source}get(t){return this.getOriginalRecord(nS(this.currentPagerIndexedData,t))}getRaw(t){return this.getRawRecord(nS(this.currentPagerIndexedData,t))}getIndexKey(t){return nS(this.currentPagerIndexedData,t)}getTableIndex(t){return Array.isArray(t)?"tree"===this.rowHierarchyType?this.currentPagerIndexedData.findIndex((e=>function(t,e){if(!ZC(t)||!ZC(e))return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}(e,t))):this.currentPagerIndexedData.findIndex((e=>e===t[0])):this.currentPagerIndexedData.findIndex((e=>e===t))}getField(t,e,i,n,o){return this.getOriginalField(nS(this.currentPagerIndexedData,t),e,i,n,o)}getRawField(t,e,i,n,o){return this.getRawFieldData(nS(this.currentPagerIndexedData,t),e,i,n,o)}hasField(t,e){return this.hasOriginalField(nS(this.currentPagerIndexedData,t),e)}getHierarchyState(t){var e;const i=this.getOriginalRecord(this.currentPagerIndexedData[t]);if(null==i?void 0:i.hierarchyState){const t=i.hierarchyState;if((null===(e=i.children)||void 0===e?void 0:e.length)>0||!0===i.children)return t}return null}toggleHierarchyState(t,e,i){const n=this.currentIndexedData.slice(0),o=this.getIndexKey(t),r=this.getHierarchyState(t),s=this.getOriginalRecord(o);if(this.clearSortedIndexMap(),r===Kw.collapse)s.hierarchyState=Kw.expand,this.pushChildrenNode(o,Kw.expand,s),this.hasHierarchyStateExpand=!0;else if(r===Kw.expand){let t=0;const e=(i,n,o)=>{if(!n||n===Kw.collapse||n===Kw.none)return;const r=o.filteredChildren?o.filteredChildren:o.children;if(r)for(let n=0;n<r.length;n++){t+=1;const o=Array.isArray(i)?i.concat([n]):[i,n];e(o,r[n].hierarchyState,r[n])}};e(o,r,s),this.currentIndexedData.splice(this.currentIndexedData.indexOf(o)+1,t),s.hierarchyState=Kw.collapse}this.updatePagerData();const a=[],l=[];if(r===Kw.collapse){const e=this.currentIndexedData.length-n.length;for(let i=0;i<e;i++)a.push(t+i+1)}else if(r===Kw.expand){const e=n.length-this.currentIndexedData.length;for(let i=0;i<e;i++)l.push(t+i+1)}return{add:a,remove:l}}pushChildrenNode(t,e,i){var n,o;if(!e||e===Kw.collapse||e===Kw.none)return 0;let r=0;const s=i.filteredChildren?i.filteredChildren:i.children;if(s){const e=Array.from({length:s.length},((t,e)=>e));null===(n=this.lastSortStates)||void 0===n||n.forEach((i=>{"normal"!==i.order&&Q_((t=>XC(e[t])?e[t]:e[t]=t),((t,i)=>{e[t]=i}),s.length,i.orderFn,i.order,(e=>this.getOriginalField(Array.isArray(t)?t.concat([e]):[t,e],i.field)))}));for(let i=0;i<e.length;i++){r+=1;const n=Array.isArray(t)?t.concat([e[i]]):[t,e[i]];this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+r,0,n);const a=this.getOriginalRecord(n);!a.hierarchyState&&(null!==(o=a.filteredChildren)&&void 0!==o?o:a.children)&&(a.hierarchyState=Kw.collapse),r+=this.pushChildrenNode(n,a.hierarchyState,s[e[i]])}}return r}changeFieldValue(t,e,i,n,o,r){var s;if(null!==i&&e>=0){const o=this.getIndexKey(e);if(this.cacheBeforeChangedRecord(o,r),void 0!==i&&""!==i||(i=n-r.leftRowSeriesNumberCount),"string"==typeof i||"number"==typeof i){const e=null===(s=this.beforeChangedRecordsMap.get(o.toString()))||void 0===s?void 0:s[i],n=this.getOriginalRecord(o);let r=t;"number"==typeof e&&function(t){return/^-?\d+(\.\d+)?$/.test(t)}(t)&&(r=parseFloat(t)),o_(n)?n.then((t=>{t[i]=r})).catch((t=>{})):n?n[i]=r:(this.records[o]={},this.records[o][i]=r)}}}cacheBeforeChangedRecord(t,e){var i;if(!this.beforeChangedRecordsMap.has(t.toString())){const e=this.getOriginalRecord(t);this.beforeChangedRecordsMap.set(t.toString(),null!==(i=lw(e,void 0,["vtable_gantt_linkedFrom","vtable_gantt_linkedTo"]))&&void 0!==i?i:{})}}setRecord(t,e){var i,n;let o=!0;if((null===(n=null===(i=this.dataConfig)||void 0===i?void 0:i.filterRules)||void 0===n?void 0:n.length)>=1&&(this.filterRecord(t)?"tree"===this.rowHierarchyType&&t.children&&(t.filteredChildren=this.filteredChildren(t.children)):o=!1),o&&Array.isArray(this.records)){const i=this.getIndexKey(e);Array.isArray(i)||this.records.splice(i,1,t)}}addRecord(t,e){var i;if(Array.isArray(this.records)){this.records.splice(e,0,t),this.adjustBeforeChangedRecordsMap(e,1),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1;for(let e=0;e<this.fieldAggregators.length;e++)this.fieldAggregators[e].push(t);if("tree"===this.rowHierarchyType&&this.initTreeHierarchyState(),this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:t,currentPage:i}=this.pagination;e<t*(i||0)+t&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();(null===(i=this.dataSourceObj)||void 0===i?void 0:i.added)&&this.dataSourceObj.added(e,1)}}addRecords(t,e){var i;if(Array.isArray(this.records)){if(Array.isArray(t)){this.records.splice(e,0,...t),this.adjustBeforeChangedRecordsMap(e,t.length);for(let e=0;e<t.length;e++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length;for(let e=0;e<this.fieldAggregators.length;e++)for(let i=0;i<t.length;i++)this.fieldAggregators[e].push(t[i])}if(this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:t,currentPage:i}=this.pagination;e<t*(i||0)+t&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();(null===(i=this.dataSourceObj)||void 0===i?void 0:i.added)&&this.dataSourceObj.added(e,t.length)}}addRecordForSorted(t){Array.isArray(this.records)&&(this.beforeChangedRecordsMap.clear(),this.records.push(t),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1,this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength))}addRecordsForSorted(t){if(Array.isArray(this.records)){if(this.beforeChangedRecordsMap.clear(),Array.isArray(t)){this.records.push(...t);for(let e=0;e<t.length;e++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length,this.sortedIndexMap.clear()}this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}}adjustBeforeChangedRecordsMap(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"add";for(let n=this.beforeChangedRecordsMap.size-1;n>=t;n--){const t=this.beforeChangedRecordsMap.get(n.toString());this.beforeChangedRecordsMap.delete(n.toString()),this.beforeChangedRecordsMap.set((n+("add"===i?e:-e)).toString(),t)}}deleteRecords(t){var e;if(Array.isArray(this.records)){const i=[],n=t.sort(((t,e)=>e-t));for(let t=0;t<n.length;t++){const e=n[t];if(e>=this._sourceLength||e<0)continue;this.adjustBeforeChangedRecordsMap(e,1,"delete"),i.push(e);const o=this.records[e];for(let t=0;t<this.fieldAggregators.length;t++)this.fieldAggregators[t].deleteRecord(o);this.records.splice(e,1),this.currentIndexedData.pop(),this._sourceLength-=1}return this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.updatePagerData(),(null===(e=this.dataSourceObj)||void 0===e?void 0:e.deleted)&&this.dataSourceObj.deleted(i),i}return[]}deleteRecordsForSorted(t){if(Array.isArray(this.records)){const e=t.sort(((t,e)=>e-t));for(let t=0;t<e.length;t++){const i=e[t];if(i>=this._sourceLength||i<0)continue;const n=this.currentIndexedData[i];this.records.splice(n,1),this._sourceLength-=1}this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.beforeChangedRecordsMap.clear()}}updateRecords(t,e){const i=[];for(let n=0;n<e.length;n++){const o=e[n];if(Array.isArray(o))this.beforeChangedRecordsMap.delete(o.toString()),i.push(o),o.slice(0,-1).reduce(((t,e)=>(void 0===t[e]&&(t[e]={}),t[e].children)),this.records)[o[o.length-1]]=t[n];else{if(o>=this._sourceLength||o<0)continue;this.beforeChangedRecordsMap.delete(o.toString()),i.push(o);for(let e=0;e<this.fieldAggregators.length;e++)this.fieldAggregators[e].updateRecord(this.records[o],t[n]);this.records[o]=t[n]}}return this.userPagination&&this.updatePagerData(),i}updateRecordsForSorted(t,e){for(let i=0;i<e.length;i++){const n=e[i];if(n>=this._sourceLength||n<0)continue;const o=this.currentIndexedData[n];if("number"!=typeof o)return;this.beforeChangedRecordsMap.delete(o.toString()),this.records[o]=t[i]}this.sortedIndexMap.clear()}sort(t){t=(Array.isArray(t)?t:[t]).filter((t=>{const e=this.columns.find((e=>e.field===t.field));return!1!==(null==e?void 0:e.sort)&&"normal"!==t.order})),this.lastSortStates=t;let e=t.map((t=>this.sortedIndexMap.get(null==t?void 0:t.field)||{asc:[],desc:[],normal:[]})),i=null;if(e.length>0&&(i=t.reduce(((t,i,n)=>{var o;const r=null===(o=e[n])||void 0===o?void 0:o[i.order];return r&&r.length>0?r:t}),null),i&&i.length>0))return this.currentIndexedData=i,this.updatePagerData(),void this.fireListeners(tS.CHANGE_ORDER,null);const n=Array.from({length:this._sourceLength},((t,e)=>e));if(n.sort(((e,i)=>t.reduce(((t,n)=>0!==t?t:(n.orderFn||("desc"!==n.order?(t,e)=>t===e?0:t>e?1:-1:(t,e)=>t===e?0:t<e?1:-1))(this.getOriginalField(e,n.field),this.getOriginalField(i,n.field),n.order)),0))),this.currentIndexedData=n,this.hierarchyExpandLevel){let t=n.length;for(let e=0;e<t;e++){const i=this.getOriginalRecord(n[e]),o=this.pushChildrenNode(n[e],i.hierarchyState,this.getOriginalRecord(n[e]));t+=o,e+=o}}if(!e.length){e=t.map((()=>({asc:[],desc:[],normal:[]})));for(let i=0;i<t.length;i++)this.sortedIndexMap.set(t[i].field,e[i])}t.forEach(((t,i)=>{e[i][t.order]=n.slice()})),this.updatePagerData(),this.fireListeners(tS.CHANGE_ORDER,null)}setSortedIndexMap(t,e){this.sortedIndexMap.set(t,e)}clearFilteredChildren(t){var e,i;t.filteredChildren=void 0;for(let n=0;n<(null!==(i=null===(e=t.children)||void 0===e?void 0:e.length)&&void 0!==i?i:0);n++)this.clearFilteredChildren(t.children[n])}filterRecord(t){var e,i,n;let o=!0;for(let r=0;r<(null===(e=this.dataConfig.filterRules)||void 0===e?void 0:e.length);r++){const e=null===(i=this.dataConfig)||void 0===i?void 0:i.filterRules[r];if(e.filterKey){const i=t[e.filterKey];if(-1===e.filteredValues.indexOf(i)){o=!1;break}}else if(!(null===(n=e.filterFunc)||void 0===n?void 0:n.call(e,t))){o=!1;break}}return o}updateFilterRulesForSorted(t){var e,i,n;this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=t,this._source=this.processRecords(null!==(i=null===(e=this.dataSourceObj)||void 0===e?void 0:e.records)&&void 0!==i?i:this.dataSourceObj),this._sourceLength=(null===(n=this._source)||void 0===n?void 0:n.length)||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),"tree"===this.rowHierarchyType&&this.initTreeHierarchyState(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}updateFilterRules(t){var e,i,n;this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=t,this._source=this.processRecords(null!==(i=null===(e=this.dataSourceObj)||void 0===e?void 0:e.records)&&void 0!==i?i:this.dataSourceObj),this._sourceLength=(null===(n=this._source)||void 0===n?void 0:n.length)||0,this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,"tree"===this.rowHierarchyType&&this.initTreeHierarchyState()),this.updatePagerData()}clearSortedIndexMap(){this.lastSortStates&&this.lastSortStates.length>0&&this.sortedIndexMap.forEach(((t,e)=>{this.lastSortStates.some((t=>t.field===e))?this.lastSortStates.forEach((e=>{"asc"===e.order?(t.desc=[],t.normal=[]):"desc"===e.order?(t.asc=[],t.normal=[]):(t.asc=[],t.desc=[])})):this.sortedIndexMap.delete(e)}))}get sourceLength(){return this._sourceLength}set sourceLength(t){this._sourceLength!==t&&(this._sourceLength=t,this.fireListeners(tS.SOURCE_LENGTH_UPDATE,this._sourceLength))}get length(){return this.currentPagerIndexedData.length}get dataSource(){return this}get currentPagerIndexedData(){return this._currentPagerIndexedData.length>0?this._currentPagerIndexedData:[]}release(){var t;null===(t=super.release)||void 0===t||t.call(this),this.lastFilterRules=null,this.clearSortedMap(),this.clearCurrentIndexedData(),this.currentPagerIndexedData.length=0}clearSortedMap(){this.currentIndexedData&&(this.currentIndexedData.length=0),this.currentIndexedData=null,this.sortedIndexMap.forEach((t=>{t.asc&&(t.asc.length=0),t.desc&&(t.desc.length=0)})),this.sortedIndexMap.clear()}clearCurrentIndexedData(){this.currentIndexedData=null,this.currentPagerIndexedData.length=0}getOriginalRecord(t){let e;return e=this.dataSourceObj.records?Array.isArray(t)?rS(this.records,t):this.records[t]:this._get(t),eS(e,(e=>{this.recordPromiseCallBack(t,e)}))}getRawRecord(t){var e,i;if(null===(e=this.beforeChangedRecordsMap)||void 0===e?void 0:e.has(t.toString()))return null===(i=this.beforeChangedRecordsMap)||void 0===i?void 0:i.get(t.toString());let n;return n=this.dataSourceObj.records?Array.isArray(t)?rS(this.records,t):this.records[t]:this._get(t),eS(n,(e=>{this.recordPromiseCallBack(t,e)}))}getOriginalField(t,e,i,n,o){if(null!==e)return iS(this.getOriginalRecord(t),e,i,n,o,(i=>{this.fieldPromiseCallBack(t,e,i)}))}getRawFieldData(t,e,i,n,o){if(null!==e)return iS(this.getRawRecord(t),e,i,n,o,(i=>{this.fieldPromiseCallBack(t,e,i)}))}hasOriginalField(t,e){if(null===e)return!1;if("function"==typeof e)return!0;const i=this.getOriginalRecord(t);return Boolean(i&&e in i)}fieldPromiseCallBack(t,e,i){}recordPromiseCallBack(t,e){}canChangeOrder(t,e){var i;if(null===(i=this.dataSourceObj)||void 0===i?void 0:i.canChangeOrder)return this.dataSourceObj.canChangeOrder(t,e);if(this.hasHierarchyStateExpand){let i=this.currentPagerIndexedData[t],n=this.currentPagerIndexedData[e];if(i=Array.isArray(i)?[...i]:[i],n=Array.isArray(n)?[...n]:[n],e>t&&n.length>i.length){let t=this.currentPagerIndexedData[e+1];t=Array.isArray(t)?[...t]:[t],t.length<n.length&&n.splice(n.length-1,1)}if(i.length===n.length){for(let t=0;t<=i.length-2;t++)if(i[t]!==n[t])return!1;return!0}return!1}return!0}changeOrder(t,e){var i,n,o;if(null===(i=this.dataSourceObj)||void 0===i?void 0:i.changeOrder)this.dataSourceObj.changeOrder(t,e);else if(!(null===(n=this.lastSortStates)||void 0===n?void 0:n.some((t=>"asc"===t.order||"desc"===t.order)))&&this.canChangeOrder(t,e))if(this.hasHierarchyStateExpand){let i,n,r=this.currentPagerIndexedData[t],s=this.currentPagerIndexedData[e];if(r=Array.isArray(r)?[...r]:[r],s=Array.isArray(s)?[...s]:[s],r.length>1||s.length>1){if(e>t&&s.length>r.length){let t=this.currentPagerIndexedData[e+1];t=Array.isArray(t)?[...t]:[t],t.length<s.length&&s.splice(s.length-1,1)}if(i=r.splice(r.length-1,1)[0],n=s.splice(s.length-1,1)[0],r.length>=1){const t=this.getOriginalRecord(r),e=t.filteredChildren?t.filteredChildren.splice(i,1):t.children.splice(i,1);e.unshift(n,0),Array.prototype.splice.apply(null!==(o=t.filteredChildren)&&void 0!==o?o:t.children,e)}else{const t=this.records.splice(i,1);t.unshift(n,0),Array.prototype.splice.apply(this.records,t)}}else{i=this.currentPagerIndexedData[t],n=this.currentPagerIndexedData[e];const o=this.records.splice(i,1);o.unshift(n,0),Array.prototype.splice.apply(this.records,o)}this.restoreTreeHierarchyState(),this.updatePagerData()}else{const i=this.records.splice(t,1);i.unshift(e,0),Array.prototype.splice.apply(this.records,i)}}restoreTreeHierarchyState(){var t,e;if(this.hierarchyExpandLevel){for(let e=0;e<this._sourceLength;e++){const i=this.getOriginalRecord(e);(null!==(t=i.filteredChildren)&&void 0!==t?t:i.children)&&!i.hierarchyState&&(i.hierarchyState=Kw.collapse)}this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e));let i=this._sourceLength;for(let t=0;t<i;t++){const n=this.currentIndexedData[t],o=this.getOriginalRecord(n),r=null!==(e=o.filteredChildren)&&void 0!==e?e:o.children;if((null==r?void 0:r.length)>0&&o.hierarchyState===Kw.expand){this.hasHierarchyStateExpand=!0;const e=this.restoreChildrenNodeHierarchy(n,o);t+=e,i+=e}else!0===o.children&&!o.hierarchyState&&(o.hierarchyState=Kw.collapse)}}}restoreChildrenNodeHierarchy(t,e){var i,n;let o=0;const r=null!==(i=e.filteredChildren)&&void 0!==i?i:e.children,s=null!==(n=null==r?void 0:r.length)&&void 0!==n?n:0;for(let i=0;i<s;i++){e.hierarchyState===Kw.expand&&(o+=1);const n=r[i],s=Array.isArray(t)?t.concat(i):[t,i];e.hierarchyState===Kw.expand&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+o,0,s),o+=this.restoreChildrenNodeHierarchy(s,n)}return o}};function rS(t,e){var i;let n=t;for(let t=0;t<e.length;t++){const o=e[t];if(!n[o])return;n=n[o];const r=null!==(i=n.filteredChildren)&&void 0!==i?i:null==n?void 0:n.children;r&&t+1<e.length&&(n=r)}return n}function sS(t,e){return t.sort(((t,i)=>{var n,o;tw(t)&&(t=[t]),tw(i)&&(i=[i]);const r=Math.max(t.length,i.length);for(let s=0;s<r;s++){const r=null!==(n=t[s])&&void 0!==n?n:-1,a=null!==(o=i[s])&&void 0!==o?o:-1;if(r!==a)return 1===e?r-a:a-r}return 0}))}oS.EMPTY=new oS({get(){},length:0});var aS=Array.isArray,lS="object"==typeof J&&J&&J.Object===Object&&J,hS="object"==typeof self&&self&&self.Object===Object&&self,dS=lS||hS||Function("return this")(),cS=dS.Symbol,uS=cS,gS=Object.prototype,pS=gS.hasOwnProperty,fS=gS.toString,vS=uS?uS.toStringTag:void 0;var bS=function(t){var e=pS.call(t,vS),i=t[vS];try{t[vS]=void 0;var n=!0}catch(t){}var o=fS.call(t);return n&&(e?t[vS]=i:delete t[vS]),o},mS=Object.prototype.toString;var yS=bS,CS=function(t){return mS.call(t)},wS=cS?cS.toStringTag:void 0;var xS=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":wS&&wS in Object(t)?yS(t):CS(t)};var _S=xS,SS=function(t){return null!=t&&"object"==typeof t};var AS=function(t){return"symbol"==typeof t||SS(t)&&"[object Symbol]"==_S(t)},BS=aS,TS=AS,RS=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,kS=/^\w*$/;var MS=function(t,e){if(BS(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!TS(t))||(kS.test(t)||!RS.test(t)||null!=e&&t in Object(e))};var LS=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},PS=xS,ES=LS;var HS,OS=function(t){if(!ES(t))return!1;var e=PS(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},IS=dS["__core-js_shared__"],FS=(HS=/[^.]+$/.exec(IS&&IS.keys&&IS.keys.IE_PROTO||""))?"Symbol(src)_1."+HS:"";var zS=function(t){return!!FS&&FS in t},DS=Function.prototype.toString;var WS=OS,NS=zS,GS=LS,jS=function(t){if(null!=t){try{return DS.call(t)}catch(t){}try{return t+""}catch(t){}}return""},VS=/^\[object .+?Constructor\]$/,US=Function.prototype,XS=Object.prototype,$S=US.toString,YS=XS.hasOwnProperty,KS=RegExp("^"+$S.call(YS).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var qS=function(t,e){return null==t?void 0:t[e]},ZS=function(t){return!(!GS(t)||NS(t))&&(WS(t)?KS:VS).test(jS(t))},JS=qS;var QS=function(t,e){var i=JS(t,e);return ZS(i)?i:void 0},tA=QS(Object,"create"),eA=tA;var iA=function(){this.__data__=eA?eA(null):{},this.size=0};var nA=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},oA=tA,rA=Object.prototype.hasOwnProperty;var sA=function(t){var e=this.__data__;if(oA){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return rA.call(e,t)?e[t]:void 0},aA=tA,lA=Object.prototype.hasOwnProperty;var hA=function(t){var e=this.__data__;return aA?void 0!==e[t]:lA.call(e,t)},dA=tA;var cA=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=dA&&void 0===e?"__lodash_hash_undefined__":e,this},uA=iA,gA=nA,pA=sA,fA=hA,vA=cA;function bA(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}bA.prototype.clear=uA,bA.prototype.delete=gA,bA.prototype.get=pA,bA.prototype.has=fA,bA.prototype.set=vA;var mA=bA;var yA=function(){this.__data__=[],this.size=0};var CA=function(t,e){return t===e||t!=t&&e!=e};var wA=function(t,e){for(var i=t.length;i--;)if(CA(t[i][0],e))return i;return-1},xA=wA,_A=Array.prototype.splice;var SA=function(t){var e=this.__data__,i=xA(e,t);return!(i<0)&&(i==e.length-1?e.pop():_A.call(e,i,1),--this.size,!0)},AA=wA;var BA=function(t){var e=this.__data__,i=AA(e,t);return i<0?void 0:e[i][1]},TA=wA;var RA=function(t){return TA(this.__data__,t)>-1},kA=wA;var MA=function(t,e){var i=this.__data__,n=kA(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this},LA=yA,PA=SA,EA=BA,HA=RA,OA=MA;function IA(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}IA.prototype.clear=LA,IA.prototype.delete=PA,IA.prototype.get=EA,IA.prototype.has=HA,IA.prototype.set=OA;var FA=IA,zA=QS(dS,"Map"),DA=mA,WA=FA,NA=zA;var GA=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var jA=function(t,e){var i=t.__data__;return GA(e)?i["string"==typeof e?"string":"hash"]:i.map},VA=jA;var UA=function(t){var e=VA(this,t).delete(t);return this.size-=e?1:0,e},XA=jA;var $A=function(t){return XA(this,t).get(t)},YA=jA;var KA=function(t){return YA(this,t).has(t)},qA=jA;var ZA=function(t,e){var i=qA(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this},JA=function(){this.size=0,this.__data__={hash:new DA,map:new(NA||WA),string:new DA}},QA=UA,tB=$A,eB=KA,iB=ZA;function nB(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}nB.prototype.clear=JA,nB.prototype.delete=QA,nB.prototype.get=tB,nB.prototype.has=eB,nB.prototype.set=iB;var oB=nB;function rB(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var i=function(){var n=arguments,o=e?e.apply(this,n):n[0],r=i.cache;if(r.has(o))return r.get(o);var s=t.apply(this,n);return i.cache=r.set(o,s)||r,s};return i.cache=new(rB.Cache||oB),i}rB.Cache=oB;var sB=rB;var aB=function(t){var e=sB(t,(function(t){return 500===i.size&&i.clear(),t})),i=e.cache;return e},lB=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,hB=/\\(\\)?/g,dB=aB((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(lB,(function(t,i,n,o){e.push(n?o.replace(hB,"$1"):i||t)})),e})),cB=dB;var uB=function(t,e){for(var i=-1,n=null==t?0:t.length,o=Array(n);++i<n;)o[i]=e(t[i],i,t);return o},gB=uB,pB=aS,fB=AS,vB=cS?cS.prototype:void 0,bB=vB?vB.toString:void 0;var mB=function t(e){if("string"==typeof e)return e;if(pB(e))return gB(e,t)+"";if(fB(e))return bB?bB.call(e):"";var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i},yB=mB;var CB=aS,wB=MS,xB=cB,_B=function(t){return null==t?"":yB(t)};var SB=AS;var AB=function(t){if("string"==typeof t||SB(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e},BB=function(t,e){return CB(t)?t:wB(t,e)?[t]:xB(_B(t))},TB=AB;var RB=function(t,e){for(var i=0,n=(e=BB(e,t)).length;null!=t&&i<n;)t=t[TB(e[i++])];return i&&i==n?t:void 0},kB=RB;var MB=function(t,e,i){var n=null==t?void 0:kB(t,e);return void 0===n?i:n},LB=Q(MB);class PB extends oS{static get EVENT_TYPE(){return oS.EVENT_TYPE}static ofArray(t,e,i,n,o,r){return new PB({get:e=>t[e],length:t.length,records:t},e,i,n,o,r)}constructor(t,e,i,n,o,r){let s;ZC(null==e?void 0:e.groupByRules)&&(o="tree",s=!0),super(t,e,i,n,o,r),this._isGrouped=s,this._recordCache=[],this._fieldCache={}}getOriginalRecord(t){return tw(t)&&this._recordCache&&this._recordCache[t]?this._recordCache[t]:super.getOriginalRecord(t)}getRawRecord(t){var e,i,n,o;let r,s;if(this._isGrouped){if(r=this.getOriginRecordIndexForGroup(t),XC(r)&&(null===(e=this.beforeChangedRecordsMap)||void 0===e?void 0:e.has(r.toString())))return null===(i=this.beforeChangedRecordsMap)||void 0===i?void 0:i.get(r.toString())}else if(null===(n=this.beforeChangedRecordsMap)||void 0===n?void 0:n.has(t.toString()))return null===(o=this.beforeChangedRecordsMap)||void 0===o?void 0:o.get(t.toString());return tw(t)&&this._recordCache&&this._recordCache[t]?this._recordCache[t]:(s=this.dataSourceObj.records?Array.isArray(t)?rS(this.records,t):this.records[t]:this._get(t),eS(s,(e=>{this.recordPromiseCallBack(t,e)})))}getOriginalField(t,e,i,n,o){const r=this._fieldCache&&this._fieldCache[t];if(r){const t=r.get(e);if(t)return t}return super.getOriginalField(t,e,i,n,o)}clearCache(){this._recordCache&&(this._recordCache=[]),this._fieldCache&&(this._fieldCache={})}fieldPromiseCallBack(t,e,i){!function(t,e,i,n){(t[e]||(t[e]=new Map)).set(i,n)}(this._fieldCache,t,e,i)}recordPromiseCallBack(t,e){this._recordCache&&(this._recordCache[t]=e)}get records(){return Array.isArray(this._recordCache)&&this._recordCache.length>0?this._recordCache:super.records}release(){var t;null===(t=super.release)||void 0===t||t.call(this),this._recordCache=null,this._fieldCache=null}_generateFieldAggragations(){var t;if(super._generateFieldAggragations(),ZC(null===(t=this.dataConfig)||void 0===t?void 0:t.groupByRules)){const t=this.dataConfig.groupByRules;this.groupAggregator=new this.registedAggregators[Xw.CUSTOM]({field:"",aggregationFun:(e,i,n)=>{const o=new Map,r=[];for(let e=0;e<i.length;e++)EB(i[e],r,o,t,0);return r}}),this.fieldAggregators.push(this.groupAggregator)}}processRecords(t){var e;const i=super.processRecords(t);return(null===(e=this.groupAggregator)||void 0===e?void 0:e.value())||i}getGroupLength(){var t,e,i;return null!==(i=null===(e=null===(t=this.dataConfig)||void 0===t?void 0:t.groupByRules)||void 0===e?void 0:e.length)&&void 0!==i?i:0}updateGroup(){var t,e,i;this.clearCache();const n=this.source;this._source=this.processRecords(null!==(e=null===(t=this.dataSourceObj)||void 0===t?void 0:t.records)&&void 0!==e?e:this.dataSourceObj),n&&HB(n,this.source),this.sourceLength=(null===(i=this.source)||void 0===i?void 0:i.length)||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this.sourceLength},((t,e)=>e)),this.userPagination||(this.pagination.perPageCount=this.sourceLength,this.pagination.totalCount=this.sourceLength),this.initTreeHierarchyState(),this.updatePagerData()}getOriginRecordIndexForGroup(t){const e=this.getOriginalRecord(t);if(XC(e)&&!(e.children&&e.children.length>0))for(let t=0;t<this.dataSourceObj.records.length;t++)if(this.dataSourceObj.records[t]===e)return t}addRecordsForGroup(t,e){if(!ZC(t)||0===t.length)return;let i=this.getOriginRecordIndexForGroup(e);(void 0===i||i>this.dataSourceObj.records)&&(i=this.dataSourceObj.records.length),this.dataSourceObj.records.splice(i,0,...t),this.adjustBeforeChangedRecordsMap(i,t.length),this.updateGroup()}deleteRecordsForGroup(t){if(!ZC(t)||0===t.length)return;const e=sS(t,-1);for(let t=0;t<e.length;t++){const i=e[t];if(tw(i)&&(i>=this.sourceLength||i<0))continue;const n=this.getOriginRecordIndexForGroup(i);this.beforeChangedRecordsMap.delete(n.toString()),this.dataSourceObj.records.splice(n,1),this.sourceLength-=1,this.adjustBeforeChangedRecordsMap(n,1,"delete")}this.updateGroup()}updateRecordsForGroup(t,e){for(let i=0;i<e.length;i++){const n=e[i];if(tw(n)&&(n>=this.sourceLength||n<0))continue;const o=this.getOriginRecordIndexForGroup(n);this.beforeChangedRecordsMap.delete(o.toString()),this.dataSourceObj.records[o]=t[i]}this.updateGroup()}addRecordsForTree(t,e){if(ZC(t)&&0!==t.length){if(this.adjustBeforeChangedRecordsMap(e,t.length),tw(e))this.dataSourceObj.records.splice(e,0,...t);else{const i=[...e],n=i.pop(),o=this.getOriginalRecord(i);o.children?o.children.splice(n,0,...t):o.children=t}this.initTreeHierarchyState(),this.updatePagerData()}}deleteRecordsForTree(t){if(!ZC(t)||0===t.length)return;const e=sS(t,-1);for(let t=0;t<e.length;t++){const i=e[t];if(!tw(i)||!(i>=this.sourceLength||i<0)){if(this.beforeChangedRecordsMap.delete(i.toString()),tw(i))this.dataSourceObj.records.splice(i,1);else{const t=[...i],e=t.pop();this.getOriginalRecord(t).children.splice(e,1)}this.adjustBeforeChangedRecordsMap(i,1,"delete")}}this.initTreeHierarchyState(),this.updatePagerData()}updateRecordsForTree(t,e){for(let i=0;i<e.length;i++){const n=e[i],o=t[i];if(!tw(n)||!(n>=this.sourceLength||n<0))if(this.beforeChangedRecordsMap.delete(n.toString()),tw(n))this.dataSourceObj.records.splice(n,1,o);else{const t=[...n],e=t.pop();this.getOriginalRecord(t).children.splice(e,1,o)}}this.initTreeHierarchyState(),this.updatePagerData()}adjustBeforeChangedRecordsMap(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"add";if("tree"===this.rowHierarchyType){let n;n=tw(t)?[t]:t;const o=[];this.beforeChangedRecordsMap.forEach(((t,r)=>{var s,a;const l=r.split(","),h=Math.max(l.length,n.length);for(let d=0;d<h;d++){const h=null!==(s=n[d])&&void 0!==s?s:-1,c=null!==(a=Number(l[d]))&&void 0!==a?a:-1;if(h<c||h===c&&d===l.length-1&&d===n.length-1)return l[d]=(c+("add"===i?e:-e)).toString(),void o.push({originKey:r,targetKey:l.toString(),value:t})}})),o.forEach((t=>{let{originKey:e,targetKey:i,value:n}=t;this.beforeChangedRecordsMap.delete(e),this.beforeChangedRecordsMap.set(i,n)}))}else super.adjustBeforeChangedRecordsMap(t,e,i)}cacheBeforeChangedRecord(t,e){var i;const n=this.getOriginalRecord(t);e.options.groupBy&&(t=this.getOriginRecordIndexForGroup(t)),this.beforeChangedRecordsMap.has(t.toString())||this.beforeChangedRecordsMap.set(t.toString(),null!==(i=lw(n,void 0,["vtable_gantt_linkedFrom","vtable_gantt_linkedTo"]))&&void 0!==i?i:{})}getGroupSeriesNumber(t){const e=this.dataSource.currentIndexedData[t],i=e.length-1;let n=e.length,o=1;for(;n>i;o++){const e=this.dataSource.currentIndexedData[t-o];n=tw(e)?1:e.length}return o-1}}function EB(t,e,i,n,o){const r=n[o];if(!XC(r))return void e.push(t);const s=LB(t,r);if(void 0!==s){if(i.has(s)){const r=i.get(s);return EB(t,e[r].children,e[r].map,n,o+1)}return i.set(s,e.length),e.push({vtableMerge:!0,vtableMergeName:s,children:[],map:new Map}),EB(t,e[e.length-1].children,e[e.length-1].map,n,o+1)}}function HB(t,e,i,n){if(!i){i=new Map;for(let e=0;e<t.length;e++){const n=t[e];n.vtableMerge&&i.set(n.vtableMergeName,e)}}if(!n){n=new Map;for(let t=0;t<e.length;t++){const i=e[t];i.vtableMerge&&n.set(i.vtableMergeName,t)}}for(let i=0;i<t.length;i++){const o=t[i],r=e[n.get(o.vtableMergeName)];XC(r)&&(r.hierarchyState=t[i].hierarchyState),ZC(o.children)&&ZC(r.children)&&0!==o.map.size&&0!==r.map.size&&HB(o.children,r.children,o.map,r.map)}}var OB={exports:{}},IB={},FB=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),zB=["style","variant","weight","size","lineHeight","family"],DB=/([\.0-9]+)(.*)/,WB=function(t,e,i){var n=t.match(DB);if(n){t=parseFloat(n[1]);var o=n[2].toLowerCase().trim(),r=Math.round(t);switch(r===t&&(t=r),o){case"em":if(null===e)return;return t*e;case"px":return t;case"pt":return t/(72/i);case"pc":return t/(6/i);case"mm":return t*(i/25.4);case"cm":return t*(i/2.54);case"in":return t*i;case"%":if(null===e)return;return e*(t/100)}}},NB={size:WB,lineHeight:WB},GB={serif:1,"sans-serif":1,cursive:1,fantasy:1,monospace:1},jB=OB.exports=function(t,e,i){var n=t+"-"+(e||"null")+"@"+i;if(i=i||96,void 0!==IB[n])return IB[n];if(e&&(e=jB(e,null,i)),"inherit"===t)return e;var o=FB.exec(t);if(o){o.shift();for(var r={},s=0;s<o.length;s++){var a=zB[s],l=o[s];if(NB[a]&&l){var h=e&&e[a]||null,d=NB[a](l,h,i);l=void 0===d&&"lineHeight"===a&&l?r.size*parseFloat(l):d}if(l&&"normal"!==l){if("inherit"===l){if(!e)return;l=e[a]}l.trim&&(l=l.trim()),r[a]=l}}Object.keys(r).length||(r=null),IB[n]=r;var c=[];r.style&&c.push(r.style),r.variant&&c.push(r.variant),r.weight&&"400"!==r.weight&&"normal"!==r.weight&&c.push(r.weight),c.push(r.size+"px"),r.lineHeight&&(c[c.length-1]+="/"+r.lineHeight+"px");var u=r.family.split(",");return r.family=u.map((function(t){return t=t.trim(),GB[t.toLowerCase()]&&(t=t.toLowerCase()),t})),c.push(r.family),Object.defineProperty(r,"toString",{value:function(){return c.map((function(t){return Array.isArray(t)?t.map((function(t){return t.indexOf(" ")>-1?'"'+t.replace(/["']/g,"")+'"':t})).join(", "):t})).join(" ")}}),r}IB[n]=null};OB.exports.generics=GB;var VB=Q(OB.exports);function UB(t){var e,i,n,o;if(tw(t)||qC(t)||ZC(t)){let e=fr(t);return"number"==typeof e||"string"==typeof e?e=[e,e,e,e]:Array.isArray(e)&&(e=e.slice(0)),e}return t&&(isFinite(t.bottom)||isFinite(t.left)||isFinite(t.right)||isFinite(t.top))?[null!==(e=t.top)&&void 0!==e?e:0,null!==(i=t.right)&&void 0!==i?i:0,null!==(n=t.bottom)&&void 0!==n?n:0,null!==(o=t.left)&&void 0!==o?o:0]:[0,0,0,0]}const XB=0,$B=1,YB=2,KB=3,qB=10,ZB=11,JB=12,QB=9,tT=13,eT=10,iT=12,nT=32,oT=37,rT=46,sT=48,aT=57,lT=65,hT=90,dT=97,cT=122;function uT(t){return function(t){return t>=dT&&t<=cT}(t)||function(t){return t>=lT&&t<=hT}(t)}function gT(t){return t===QB||t===eT||t===iT||t===tT||t===nT}function pT(t){return t>=sT&&t<=aT}function fT(t){return t===rT}function vT(t){return uT(t)||t===oT}function bT(t){return new Error(`calc parse error: ${t}`)}const mT={"*":3,"/":3,"+":2,"-":2};function yT(t,e){function i(t){const i=t.pop(),n=t.pop(),o=t.pop();if(!(o&&o.nodeType&&n&&n.type===YB&&i&&i.nodeType))throw bT(e);return{nodeType:ZB,left:o,op:n,right:i}}const n=[];for(;t.length;){const o=t.shift();if(o.type===XB&&"("===o.value){let i=0;const o=Yx.findIndex(t,(t=>{if(t.type===XB&&"("===t.value)i++;else if(t.type===XB&&")"===t.value){if(!i)return!0;i--}return!1}));if(-1===o)throw bT(e);n.push(yT(t.splice(0,o),e)),t.shift()}else if(o.type===YB){if(n.length>=3){const t=n[n.length-2].value;mT[o.value]<=mT[t]&&n.push(i(n))}n.push(o)}else if(o.type===$B){const{value:t,unit:e}=o;n.push({nodeType:qB,value:t,unit:e})}else o.type===KB&&n.push({nodeType:JB,value:o.value})}for(;n.length>1;)n.push(i(n));return n[0]}function CT(t){return yT(function(t){const e=t.replace(/calc\(/g,"(").trim(),i=[],n=e.length;for(let s=0;s<n;s++){const n=e[s],a=n.charCodeAt(0);if("("===n||")"===n)i.push({value:n,type:XB});else if("*"===n||"/"===n)i.push({value:n,type:YB});else if("+"===n||"-"===n)s=o(n,s+1)-1;else if(pT(a)||fT(a))s=r(n,s+1)-1;else if(!gT(a))throw bT(t)}function o(t,o){if(o<n){const i=e[o],n=i.charCodeAt(0);if(pT(n)||fT(n))return r(t+i,o+1)}return i.push({value:t,type:YB}),o}function r(o,r){let a=r;for(;a<n;a++){const i=e[a],n=i.charCodeAt(0);if(pT(n))o+=i;else{if("."!==i){if(vT(n))return s(o,i,a+1);break}if(o.indexOf(".")>=0)throw bT(t);o+=i}}if("."===o)throw bT(t);return i.push({value:parseFloat(o),type:KB}),a}function s(t,o,r){let s=r;for(;s<n;s++){const t=e[s];if(!vT(t.charCodeAt(0)))break;o+=t}return i.push({value:parseFloat(t),unit:o,type:$B}),s}return i}(t),t)}function wT(t,e){if(t.nodeType===ZB){const i=wT(t.left,e),n=wT(t.right,e);switch(t.op.value){case"+":return i+n;case"-":return i-n;case"*":return i*n;case"/":return i/n;default:throw new Error(`calc error. unknown operator: ${t.op.value}`)}}else if(t.nodeType===qB)switch(t.unit){case"%":return t.value*e.full/100;case"px":return t.value;default:throw new Error(`calc error. unknown unit: ${t.unit}`)}else if(t.nodeType===JB)return t.value;throw new Error("calc error.")}function xT(t,e){return wT(CT(t),e)}function _T(t){return!!qC(t)&&!!t.endsWith("%")&&function(t){return!(UC(t)||!tw(t)&&+t!=+t)}(t.substring(0,t.length-1))}function ST(t,e){const{dataSourceEventIds:i}=t.internalProps;i&&i.forEach((e=>t.internalProps.handler.off(e))),e(t),t.internalProps.dataSourceEventIds=[t.internalProps.handler.on(t.internalProps.dataSource,oS.EVENT_TYPE.CHANGE_ORDER,(()=>{t.dataSource.hierarchyExpandLevel&&t.refreshRowColCount(),t.render()}))]}function AT(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];ST(t,(()=>{t.internalProps.records=e;const i=t.internalProps.dataSource=PB.ofArray(e,t.internalProps.dataConfig,t.pagination,t.internalProps.columns,t.internalProps.layoutMap.rowHierarchyType,BT(t));t.addReleaseObj(i)}))}function BT(t){var e;return t.options.hierarchyExpandLevel?t.options.hierarchyExpandLevel:t.options.groupBy?1/0:(null===(e=t._hasHierarchyTreeHeader)||void 0===e?void 0:e.call(t))?1:void 0}function TT(t,e){return Math.round((i=e,n=t.internalProps.calcWidthContext,"string"==typeof i?xT(i.trim(),n):i-0));var i,n}function RT(t,e,i,n,o){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s=UB(o("padding",t,i,n,e)),a=o("bgColor",t,i,n,e),l=o("font",t,i,n,e);let h,d,c,u,g;if(l){const{family:t,size:e,weight:i,style:n,variant:o}=function(t){return VB(t)}(l);h=t.join(" "),d=e,c=i,u=n,u=o}else h=o("fontFamily",t,i,n,e),d=o("fontSize",t,i,n,e),c=o("fontWeight",t,i,n,e),u=o("fontStyle",t,i,n,e),g=o("fontVariant",t,i,n,e);const p=o("textAlign",t,i,n,e),f=o("textBaseline",t,i,n,e),v=o("color",t,i,n,e),b=o("strokeColor",t,i,n,e),m=o("lineHeight",t,i,n,e),y=o("underline",t,i,n,e),C=o("underlineDash",t,i,n,e),w=o("underlineOffset",t,i,n,e),x=o("lineThrough",t,i,n,e),_=Math.max(1,Math.floor(d/10)),S=o("textOverflow",t,i,n,e),A=o("borderColor",t,i,n,e),B=o("borderLineWidth",t,i,n,e),T=o("borderLineDash",t,i,n,e),R=o("marked",t,i,n,e),k=o("cursor",t,i,n,e),M=!(s&&a&&l&&p&&f&&v&&S&&A&&B&&T&&"boolean"==typeof y&&"boolean"==typeof x&&"boolean"==typeof R);if(!r)return{hasFunctionPros:M};const L={text:{fontFamily:h,fontSize:d,fontWeight:c,fontStyle:u,fontVariant:g,fill:v,stroke:null!=b&&b,textAlign:p,textBaseline:f,lineHeight:null!=m?m:d,underline:y?_:void 0,underlineDash:C,underlineOffset:w,lineThrough:x?_:void 0,ellipsis:"clip"===S?"":"ellipsis"===S?"...":XC(S)?S:void 0},group:{fill:a,lineDash:T,lineWidth:B,stroke:A,cursor:"auto"===k||"default"===k?void 0:k},_vtable:{padding:s,marked:R}};if(Array.isArray(B)&&(L.group.strokeArrayWidth=UB(B)),Array.isArray(A)){const t=UB(A);L.group.stroke=!t.every((t=>!t))&&t,L.group.strokeArrayColor=UB(A)}return{theme:L,hasFunctionPros:M}}function kT(t,e,i){const n=i.theme.frameStyle.cornerRadius;if(i.theme.cellInnerBorder){if(Array.isArray(n)){const o=[0,0,0,0];return 0===t&&0===e&&(o[0]=n[0]),t===i.colCount-1&&0===e&&(o[1]=n[1]),0===t&&e===i.rowCount-1&&(o[3]=n[3]),t===i.colCount-1&&e===i.rowCount-1&&(o[2]=n[2]),o}if(n){const o=[0,0,0,0];return 0===t&&0===e&&(o[0]=n),t===i.colCount-1&&0===e&&(o[1]=n),0===t&&e===i.rowCount-1&&(o[3]=n),t===i.colCount-1&&e===i.rowCount-1&&(o[2]=n),o}}return 0}function MT(t){for(let e=0;e<t.internalProps.columns.length;e++){const i=t.internalProps.columns[e];if(i.aggregation);else if(t.options.aggregation){let n;if(n="function"==typeof t.options.aggregation?t.options.aggregation({col:e,field:i.field}):t.options.aggregation,n)if(Array.isArray(n)){const t=[];n.forEach((e=>{t.push(Object.assign({showOnTop:!1},e))})),i.aggregation=t}else i.aggregation=Object.assign({showOnTop:!1},n)}}}let LT=class extends eh{constructor(t){super(t),"mouseenter_cell"!==this.attribute.visibleTime&&"click_cell"!==this.attribute.visibleTime||(this.attribute.opacity=0),this.attribute.hoverImage&&(this.attribute.originImage=this.attribute.image),this.attribute.isGif&&this.attribute.gif&&this.loadGif()}loadGif(){this.playing=!1,Or.GetFile(this.attribute.gif+"?role=gif"+`&radom=${Math.random()}`,"arrayBuffer").then((t=>{const e=Ab(t),i=yb(e,!0);this.renderGIF(i),this.resources.set(this.attribute.image,{state:"success",data:this.gifCanvas})})).catch((t=>{}))}get backgroundWidth(){var t,e;return null!==(e=null!==(t=this.attribute.backgroundWidth)&&void 0!==t?t:this.attribute.width)&&void 0!==e?e:0}get backgroundHeight(){var t,e;return null!==(e=null!==(t=this.attribute.backgroundHeight)&&void 0!==t?t:this.attribute.height)&&void 0!==e?e:0}renderGIF(t){this.loadedFrames=t,this.frameIndex=0,this.tempCanvas||(this.tempCanvas=document.createElement("canvas"),this.tempCtx=this.tempCanvas.getContext("2d")),this.gifCanvas||(this.gifCanvas=document.createElement("canvas"),this.gifCtx=this.gifCanvas.getContext("2d")),this.gifCanvas.width=t[0].dims.width,this.gifCanvas.height=t[0].dims.height,this.playing=!0,this.lastTime=(new Date).getTime(),this.animate().to({},1e3,"linear").loop(1/0)}renderFrame(t,e,i){const n=this.loadedFrames[this.frameIndex||0];2===n.disposalType&&this.gifCtx.clearRect(0,0,this.gifCanvas.width,this.gifCanvas.height),this.drawPatch(n),this.manipulate(t,e,i);const o=(new Date).getTime()-this.lastTime;n.delay<o&&(this.frameIndex++,this.lastTime=(new Date).getTime()),this.frameIndex>=this.loadedFrames.length&&(this.frameIndex=0)}drawPatch(t){const e=t.dims;this.frameImageData&&e.width===this.frameImageData.width&&e.height===this.frameImageData.height||(this.tempCanvas.width=e.width,this.tempCanvas.height=e.height,this.frameImageData=this.tempCtx.createImageData(e.width,e.height)),this.frameImageData.data.set(t.patch),this.tempCtx.putImageData(this.frameImageData,0,0),this.gifCtx.drawImage(this.tempCanvas,e.left,e.top)}manipulate(t,e,i){t.drawImage(this.gifCanvas,0,0,this.gifCanvas.width,this.gifCanvas.height,e,i,this.attribute.width,this.attribute.height)}setAttribute(t,e,i,n){super.setAttribute(t,e,i,n),"gif"===t&&this.loadGif()}setAttributes(t,e,i){super.setAttributes(t,e,i),t.gif&&this.loadGif()}};class PT extends Fl{constructor(t){var e,i,n,o,r;t.fill=null!==(e=t.fill)&&void 0!==e?e:"#00F",t.fontSize=null!==(i=t.fontSize)&&void 0!==i?i:12,t.underline=null!==(n=t.underline)&&void 0!==n?n:1,t.textBaseline=null!==(o=t.textBaseline)&&void 0!==o?o:"top",t.cursor=null!==(r=t.cursor)&&void 0!==r?r:"pointer",super(t)}}function ET(t){return{rootContainer:new Ea({}),renderDefault:!0}}class HT{constructor(t){this.table=t,this.customLayoutFuncCache=new Map,this.reactRemoveGraphicCache=new Map,this.reactRemoveAllGraphicCache=new Map,this.headerCustomLayoutFuncCache=new Map,this.headerReactRemoveGraphicCache=new Map,this.headerReactRemoveAllGraphicCache=new Map}hasReactCreateGraphic(t,e){return e?this.headerCustomLayoutFuncCache.has(t):this.customLayoutFuncCache.has(t)}setReactCreateGraphic(t,e,i){i?this.headerCustomLayoutFuncCache.set(t,e):this.customLayoutFuncCache.set(t,e)}setReactRemoveGraphic(t,e,i){i?this.headerReactRemoveGraphicCache.set(t,e):this.reactRemoveGraphicCache.set(t,e)}setReactRemoveAllGraphic(t,e,i){i?this.headerReactRemoveAllGraphicCache.set(t,e):this.reactRemoveAllGraphicCache.set(t,e)}updateCustomCell(t,e){const i=this.table;if("autoWidth"===i.widthMode&&i.scenegraph.recalculateColWidths(),(i.isAutoRowHeight()||"auto"===i.internalProps.defaultRowHeight&&!e||"auto"===i.internalProps.defaultHeaderRowHeight&&e)&&i.scenegraph.recalculateRowHeights(),i.isPivotTable()){const n=function(t,e,i){const n=e.internalProps.rowSeriesNumber?1:0,o=[],r=e.internalProps.layoutMap;if(i){const{headerObjects:e}=r,i=[];for(let n=0;n<e.length;n++){const o=e[n];o&&o.define.componentId===t&&i.push(o.id)}for(let t=0;t<i.length;t++){const e=i[t],n=r.getHeaderCellAdressById(e),s=r.getCellRange(n.col,n.row);o.push(s)}}else{let e;const{columnObjects:i,indicatorsAsCol:s}=r;for(let n=0;n<i.length;n++)if(i[n].define.componentId===t){e=n;break}if(s)for(let t=r.rowHeaderLevelCount+e;t<r.colCount;t+=i.length){const e={start:{col:t+n,row:r.columnHeaderLevelCount},end:{col:t+n,row:r.rowCount-1}};o.push(e)}else for(let t=r.columnHeaderLevelCount+e;t<r.rowCount;t+=i.length){const e={start:{col:r.rowHeaderLevelCount+n,row:t},end:{col:r.colCount-1,row:t}};o.push(e)}}return o}(t,i,e);for(let t=0;t<n.length;t++){const e=n[t];for(let t=e.start.col;t<=e.end.col;t++)for(let n=e.start.row;n<=e.end.row;n++)i.scenegraph.updateCellContent(t,n)}}else{const n=function(t,e,i){const n=e.internalProps.rowSeriesNumber?1:0;if(i){const i=e.internalProps.layoutMap,{headerObjects:n}=e.internalProps.layoutMap;let o;for(let e=0;e<n.length;e++){const i=n[e];if(i.define.componentId===t){o=i.id;break}}const r=i.getHeaderCellAdressById(o);return i.getCellRange(r.col,r.row)}const{columnObjects:o}=e.internalProps.layoutMap;for(let i=0;i<o.length;i++)if(o[i].define.componentId===t)return{start:{col:n+i,row:e.columnHeaderLevelCount},end:{col:n+i,row:e.rowCount-1}};return{start:{col:0,row:0},end:{col:e.colCount-1,row:e.rowCount-1}}}(t,i,e);for(let t=n.start.col;t<=n.end.col;t++)for(let e=n.start.row;e<=n.end.row;e++)i.scenegraph.updateCellContent(t,e)}i.scenegraph.renderSceneGraph()}getCustomLayoutFunc(t,e){var i;if(this.table.isHeader(t,e)){const{componentId:n}=this.table.getHeaderDefine(t,e);return null!==(i=this.headerCustomLayoutFuncCache.get(n))&&void 0!==i?i:ET}const{componentId:n}=this.table.getBodyColumnDefine(t,e);return this.customLayoutFuncCache.get(n)||ET}removeCustomCell(t,e){let i;if(this.table.isHeader(t,e)){const n=this.table.getHeaderDefine(t,e),{componentId:o}=n;i=this.headerReactRemoveGraphicCache.get(o)}else{const n=this.table.getBodyColumnDefine(t,e),{componentId:o}=n;i=this.reactRemoveGraphicCache.get(o)}i&&i(t,e)}clearCache(){this.reactRemoveAllGraphicCache.forEach((t=>{t()})),this.headerReactRemoveAllGraphicCache.forEach((t=>{t()}))}updateAllCustomCell(){this.customLayoutFuncCache.forEach(((t,e)=>{this.updateCustomCell(e)})),this.headerCustomLayoutFuncCache.forEach(((t,e)=>{this.updateCustomCell(e,!0)}))}}function OT(t){const e={abstractPos:{x:t.viewport.x,y:t.viewport.y}},i=IT(t.target);return i&&(e.eventArgs={col:i.col,row:i.row,event:t,targetCell:i,mergeInfo:FT(i),target:t.target}),e}function IT(t){for(;t&&t.parent;){if("cell"===t.role)return t;t=t.parent}return null}function FT(t){if(XC(t.mergeStartCol)&&XC(t.mergeStartRow)&&XC(t.mergeEndCol)&&XC(t.mergeEndRow))return{colStart:t.mergeStartCol,colEnd:t.mergeEndCol,rowStart:t.mergeStartRow,rowEnd:t.mergeEndRow}}const zT=/radio-\d+-\d+-(\d+)/,DT="_custom_",WT="custom-container",NT=DT+"_0";function GT(t,e,i,n,o,r,s,a,l,h,d){var c,u,g;let p,f,v,b,m=!0,y=!1;if("react-custom-layout"===t&&(t=(null===(c=d.reactCustomLayout)||void 0===c?void 0:c.getCustomLayoutFunc(i,n))||ET),"function"==typeof t){const e=t({col:null!==(u=null==h?void 0:h.start.col)&&void 0!==u?u:i,row:null!==(g=null==h?void 0:h.start.row)&&void 0!==g?g:n,dataValue:d.getCellOriginValue(i,n),value:d.getCellValue(i,n)||"",rect:{left:0,top:0,right:o,bottom:r,width:o,height:r},table:d,originCol:i,originRow:n});if(!e)return{renderDefault:!0};e.rootContainer&&(e.rootContainer=UT(e.rootContainer,d.animationManager.timeline)),e.rootContainer instanceof Ea&&(b=e.rootContainer,b.name=WT,b.col=i,b.row=n),m=e.renderDefault,y=e.enableCellPadding}else if("function"==typeof e){const t=e({col:i,row:n,dataValue:d.getCellOriginValue(i,n),value:d.getCellValue(i,n)||"",rect:{left:0,top:0,right:o,bottom:r,width:o,height:r},table:d});t&&(v=t.elements,m=t.renderDefault,p=t.expectedWidth,f=t.expectedHeight)}else e&&(p=e.expectedWidth,f=e.expectedHeight,v=e.elements,m=e.renderDefault);return v&&(b=function(t,e,i,n){const o=new Ea({x:0,y:0,width:e,height:i,fill:!1,stroke:!1,pickable:!1});return o.name=WT,function(t,e,i,n){const o=[],r=[0,0,0,0];for(let s=0;s<t.length;s++){const a=t[s],l=Object.assign({},a);for(const t in l)l.hasOwnProperty(t)&&VC(l[t])&&(l[t]=l[t](n));const h=l;XC(h.x)&&(h.x=qC(h.x)?jT(h.x,e-r[1]):Number(h.x)),XC(h.y)&&(h.y=qC(h.y)?jT(h.y,i-r[2]):Number(h.y)),"width"in l&&(l.width=qC(l.width)?jT(l.width,e-r[1]):Number(l.width)),"height"in l&&(l.height=qC(l.height)?jT(l.height,i-r[2]):Number(l.height)),"radius"in l&&(l.radius=qC(l.radius)?jT(l.radius,Math.min(e-r[1],i-r[2])):Number(l.radius)),"hover"in l&&(l.hover.x=qC(l.hover.x)?jT(l.hover.x,e-r[1]):Number(l.hover.x),l.hover.y=qC(l.hover.y)?jT(l.hover.y,i-r[2]):Number(l.hover.y),l.hover.width=qC(l.hover.width)?jT(l.hover.width,e-r[1]):Number(l.hover.width),l.hover.height=qC(l.hover.height)?jT(l.hover.height,i-r[2]):Number(l.hover.height),l.hover.x+=0,l.hover.y+=0),h.x=h.x+0,h.y=h.y+0,o.push(l)}return o}(t,e,i,n).forEach((t=>{var e,i,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B,T,R,k;switch(t.clickable&&(t.pickable=t.clickable),t.type){case"arc":const M=bh({x:t.x,y:t.y,dx:null!==(e=t.dx)&&void 0!==e?e:0,dy:null!==(i=t.dy)&&void 0!==i?i:0,fill:t.fill,stroke:t.stroke,outerRadius:t.radius,startAngle:t.startAngle,endAngle:t.endAngle,pickable:!!t.pickable,cursor:t.cursor});M.name=t.name,o.appendChild(M);break;case"text":if(t.background){const e=null!==(r=null===(n=t.background)||void 0===n?void 0:n.expandX)&&void 0!==r?r:0,i=null!==(a=null===(s=t.background)||void 0===s?void 0:s.expandY)&&void 0!==a?a:0,p=ql({x:t.x-e,y:t.y-i,dx:null!==(l=t.dx)&&void 0!==l?l:0,dy:null!==(h=t.dy)&&void 0!==h?h:0,width:t.width+2*e,height:t.height+2*i,cornerRadius:null!==(c=null===(d=t.background)||void 0===d?void 0:d.cornerRadius)&&void 0!==c?c:0,fill:null!==(g=null===(u=t.background)||void 0===u?void 0:u.fill)&&void 0!==g?g:"#888"});o.appendChild(p)}const L=new Fl(Object.assign({pickable:!!t.pickable,fill:null!==(p=t.color)&&void 0!==p?p:t.fill},t));L.name=t.name,o.appendChild(L);break;case"rect":const P=ql({x:t.x,y:t.y,dx:null!==(f=t.dx)&&void 0!==f?f:0,dy:null!==(v=t.dy)&&void 0!==v?v:0,width:t.width,height:t.height,cornerRadius:t.radius,fill:t.fill,stroke:t.stroke,pickable:!!t.pickable,cursor:t.cursor});P.name=t.name,o.appendChild(P);break;case"circle":const E=Hl({x:t.x,y:t.y,dx:null!==(b=t.dx)&&void 0!==b?b:0,dy:null!==(m=t.dy)&&void 0!==m?m:0,radius:t.radius,fill:t.fill,stroke:t.stroke,pickable:!!t.pickable,cursor:t.cursor});E.name=t.name,o.appendChild(E);break;case"icon":const H=new LT({x:t.x,y:t.y,dx:null!==(y=t.dx)&&void 0!==y?y:0,dy:null!==(C=t.dy)&&void 0!==C?C:0,width:t.width,height:t.height,image:t.svg,backgroundWidth:t.hover?null!==(w=t.hover.width)&&void 0!==w?w:t.width:void 0,backgroundHeight:t.hover?null!==(x=t.hover.width)&&void 0!==x?x:t.width:void 0,backgroundColor:t.hover?null!==(_=t.hover.bgColor)&&void 0!==_?_:"rgba(22,44,66,0.2)":void 0,pickable:!!t.pickable,cursor:t.cursor});H.name=t.name,H.role="icon-custom",o.appendChild(H);break;case"image":const O=new LT({x:t.x,y:t.y,dx:null!==(S=t.dx)&&void 0!==S?S:0,dy:null!==(A=t.dy)&&void 0!==A?A:0,width:t.width,height:t.height,image:t.src,backgroundWidth:t.hover?null!==(B=t.hover.width)&&void 0!==B?B:t.width:void 0,backgroundHeight:t.hover?null!==(T=t.hover.width)&&void 0!==T?T:t.width:void 0,backgroundColor:t.hover?null!==(R=t.hover.bgColor)&&void 0!==R?R:"rgba(22,44,66,0.2)":void 0,pickable:!!t.pickable,cursor:t.cursor,shape:t.shape});O.name=t.name,O.role="image-custom",o.appendChild(O);break;case"line":const I=$l({points:t.points,lineWidth:null!==(k=t.lineWidth)&&void 0!==k?k:1,stroke:t.stroke,pickable:!!t.pickable,cursor:t.cursor});I.name=t.name,o.appendChild(I)}})),o}(v,s?p:o,a?f:r,d.getCellValue(i,n))),y&&b.setAttributes({x:l[3],y:l[0],width:o-l[1]-l[3],height:r-l[0]-l[2]}),VT(b,o,r),!h||h.start.col===h.end.col&&h.start.row===h.end.row||XT(b,i,n,0),{elementsGroup:b,renderDefault:m}}function jT(t,e){return t.endsWith("px")?parseInt(t,10):t.endsWith("%")&&e?parseInt(t,10)/100*e:parseInt(t,10)}function VT(t,e,i){t&&t.forEachChildren((t=>{var n,o;t&&($C(t.attribute.width)&&t.attribute.width.percent&&t.setAttribute("width",Math.max(0,t.attribute.width.percent/100*e+(null!==(n=t.attribute.width.delta)&&void 0!==n?n:0))),t.attribute.width<0&&t.setAttribute("width",0),$C(t.attribute.height)&&t.attribute.height.percent&&t.setAttribute("height",Math.max(0,t.attribute.height.percent/100*i+(null!==(o=t.attribute.height.delta)&&void 0!==o?o:0))),t.attribute.height<0&&t.setAttribute("height",0),"group"===t.type&&VT(t,t.attribute.width,t.attribute.height))}))}function UT(t,e){if(!t||!XC(t.$$typeof)&&!XC(t.vtype))return t;const i=t.type,{attribute:n,children:o,stateProxy:r,animation:s}=t.props,a=i({attribute:n});if(function(t,e){let i=!1;switch(t.type){case"richtext":case"rich/image":break;default:i=!0}i&&Object.keys(e).forEach((i=>{const n=op[i];n&&t.on(n,e[i])}))}(a,t.props),r&&(a.stateProxy=r),a.id=n.id,a.name=n.name,ZC(o)?o.forEach((t=>{const i=UT(t,e);i&&i.type&&a.add(i)})):o&&a.add(UT(o,e)),ZC(s)&&e){const t=a.animate();t.setTimeline(e),s.forEach((e=>{t[e[0]](...e.slice(1))}))}return a}function XT(t,e,i,n,o){t&&(t.name=`${DT}${null!=o?o:""}_${n}`,t.onBeforeAttributeUpdate=$T,"group"===t.type&&t.childrenCount&&t.forEachChildren(((t,r)=>{XT(t,e,i,r,(null!=o?o:"")+"_"+n)})))}function $T(t,e){const i=this;if(i.skipMergeUpdate)return;const n=IT(i);if(!n||!n.stage)return;const o=n.stage.table;i.skipAttributeUpdate=!0;const{mergeStartCol:r,mergeEndCol:s,mergeStartRow:a,mergeEndRow:l}=n;if(XC(r)&&XC(s)&&XC(a)&&XC(l)&&(r!==s||a!==l)){for(let e=r;e<=s;e++)for(let r=a;r<=l;r++){if(e===n.col&&r===n.row)continue;const s=o.scenegraph.highPerformanceGetCell(e,r);if("cell"===s.role){const e=s.getChildByName(i.name,!0);if(!e||e.skipAttributeUpdate)continue;for(const i in t)t[i]!==e.attribute[i]&&"dx"!==i&&"dy"!==i&&e.setAttribute(i,t[i])}}i.skipAttributeUpdate=void 0}}let YT,KT,qT,ZT,JT,QT,tR,eR,iR,nR,oR,rR,sR,aR,lR,hR,dR,cR,uR,gR,pR,fR,vR,bR;function mR(t){var e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S;YT=null!==(e=null==t?void 0:t.sort_color)&&void 0!==e?e:"#282F38",KT=null!==(i=null==t?void 0:t.sort_color_opacity)&&void 0!==i?i:"0.35",qT=null!==(n=null==t?void 0:t.sort_color_2)&&void 0!==n?n:"#416EFF",ZT=null!==(o=null==t?void 0:t.sort_color_opacity_2)&&void 0!==o?o:"1",JT=null!==(r=null==t?void 0:t.sort_size)&&void 0!==r?r:16,QT=null!==(s=null==t?void 0:t.sort_size_2)&&void 0!==s?s:22,tR=null!==(a=null==t?void 0:t.frozen_color)&&void 0!==a?a:"#282F38",eR=null!==(l=null==t?void 0:t.frozen_color_opacity)&&void 0!==l?l:"0.35",iR=null!==(h=null==t?void 0:t.frozen_color_opacity)&&void 0!==h?h:"0.2",nR=null!==(d=null==t?void 0:t.frozen_color_2)&&void 0!==d?d:"#416EFF",oR=null!==(c=null==t?void 0:t.frozen_color_opacity_2)&&void 0!==c?c:"1",rR=null!==(u=null==t?void 0:t.frozen_size)&&void 0!==u?u:22,sR=null!==(g=null==t?void 0:t.frozen_size_2)&&void 0!==g?g:22,aR=null!==(p=null==t?void 0:t.collapse_color)&&void 0!==p?p:"#141414",lR=null!==(f=null==t?void 0:t.collapse_color_opacity)&&void 0!==f?f:"0.65",hR=null!==(v=null==t?void 0:t.collapse_size)&&void 0!==v?v:16,dR=null!==(b=null==t?void 0:t.frozen_size_2)&&void 0!==b?b:22,cR=null!==(m=null==t?void 0:t.expand_color)&&void 0!==m?m:"#141414",uR=null!==(y=null==t?void 0:t.expand_color_opacity)&&void 0!==y?y:"0.65",gR=null!==(C=null==t?void 0:t.expand_size)&&void 0!==C?C:16,pR=null!==(w=null==t?void 0:t.expand_size_2)&&void 0!==w?w:22,fR=null!==(x=null==t?void 0:t.dragReorder_color)&&void 0!==x?x:"#666666",vR=null!==(_=null==t?void 0:t.dragReorder_color_opacity)&&void 0!==_?_:"1",bR=null!==(S=null==t?void 0:t.dragReorder_size)&&void 0!==S?S:20}const yR={get sort_downward(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${qT}"  fill-opacity="${ZT}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${YT}" fill-opacity="${KT}"/></svg> `,width:JT,height:JT,funcType:Zw.sort,name:"sort_downward",positionType:qw.contentRight,marginLeft:3,hover:{width:QT,height:QT,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_upward(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${YT}"  fill-opacity="${KT}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${qT}"  fill-opacity="${ZT}"/> </svg>`,width:JT,height:JT,funcType:Zw.sort,positionType:qw.contentRight,name:"sort_upward",marginLeft:3,hover:{width:QT,height:QT,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_normal(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${YT}" fill-opacity="${KT}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${YT}" fill-opacity="${KT}"/></svg> `,width:JT,height:JT,funcType:Zw.sort,positionType:qw.contentRight,name:"sort_normal",marginLeft:3,hover:{width:QT,height:QT,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get freeze(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M17.1313 8.42047C17.1932 8.48238 17.2423 8.55587 17.2759 8.63676C17.3094 8.71764 17.3266 8.80434 17.3266 8.89189C17.3266 8.97944 17.3094 9.06613 17.2759 9.14702C17.2423 9.2279 17.1932 9.3014 17.1313 9.3633L13.3843 13.1103C13.7007 14.3048 13.5305 15.4443 12.8388 16.2395C12.8104 16.2781 12.7778 16.3136 12.7417 16.3451L12.712 16.3755C12.6501 16.4374 12.5766 16.4865 12.4957 16.52C12.4148 16.5535 12.3281 16.5707 12.2406 16.5707C12.153 16.5707 12.0663 16.5535 11.9854 16.52C11.9046 16.4865 11.8311 16.4374 11.7692 16.3755L9.17633 13.7826L6.05316 16.9058L5.11983 17.0925C5.09291 17.0979 5.06508 17.0965 5.03881 17.0886C5.01254 17.0806 4.98863 17.0663 4.96923 17.0469C4.94982 17.0275 4.9355 17.0036 4.92755 16.9773C4.9196 16.951 4.91827 16.9232 4.92366 16.8963L5.11033 15.963L8.23333 12.8396L5.64066 10.2471C5.57875 10.1852 5.52964 10.1117 5.49614 10.0309C5.46263 9.94997 5.44539 9.86327 5.44539 9.77572C5.44539 9.68817 5.46263 9.60148 5.49614 9.52059C5.52964 9.43971 5.57875 9.36621 5.64066 9.3043C5.65066 9.2943 5.66066 9.2843 5.67099 9.27464C5.70266 9.2383 5.73833 9.20547 5.77766 9.17664C6.57283 8.48564 7.71199 8.31564 8.90599 8.63197L12.6528 4.88497C12.7147 4.82306 12.7882 4.77395 12.8691 4.74045C12.95 4.70694 13.0367 4.6897 13.1242 4.6897C13.2118 4.6897 13.2985 4.70694 13.3794 4.74045C13.4603 4.77395 13.5338 4.82306 13.5957 4.88497L17.1312 8.42047H17.1313ZM15.7172 8.8918L13.1243 6.29914L9.56483 9.8588C9.47574 9.94788 9.36323 10.0099 9.24034 10.0376C9.11746 10.0654 8.98922 10.0578 8.87049 10.0156C8.22783 9.78764 7.63899 9.7553 7.17749 9.89814L12.1182 14.8388C12.261 14.3771 12.2287 13.7885 12.0007 13.146C11.9585 13.0272 11.9509 12.899 11.9787 12.7761C12.0064 12.6532 12.0684 12.5407 12.1575 12.4516L15.7172 8.89164V8.8918Z" fill="${tR}" fill-opacity="${iR}"/></g><defs><clipPath id="clip0"><rect width="22" height="22" fill="white"/></clipPath></defs></svg>`,width:rR,height:rR,name:"freeze",funcType:Zw.frozen,positionType:qw.right,marginRight:0,hover:{width:sR,height:sR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozen(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z" fill="${tR}" fill-opacity="${eR}"/></svg>`,width:rR,height:rR,name:"frozen",funcType:Zw.frozen,positionType:qw.right,marginRight:0,hover:{width:sR,height:sR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozenCurrent(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z"  fill="${nR}" fill-opacity="${oR}"/></svg>`,width:rR,height:rR,funcType:Zw.frozen,positionType:qw.right,name:"frozenCurrent",marginRight:0,hover:{width:sR,height:sR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get dropdownIcon(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="white"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#959DA5"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="#4F5965"/></svg>',width:24,height:24,funcType:Zw.dropDown,positionType:qw.absoluteRight,name:"dropdownIcon",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)",image:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="#1E54C9"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#141414" stroke-opacity="0.2"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="white"/></svg>'},cursor:"pointer",visibleTime:"mouseenter_cell"}},get play(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="48" height="48" fill="white" fill-opacity="0.01" /><path d="M24 44C35.0457 44 44 35.0457 44 24C44 12.9543 35.0457 4 24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /><path d="M20 24V17.0718L26 20.5359L32 24L26 27.4641L20 30.9282V24Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /></svg>',width:24,height:24,funcType:Zw.play,positionType:qw.right,name:"play",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get damage_pic(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 10V38C5 39.1046 5.89543 40 7 40H14H18L15 29L22 27L21 20L29 16L27 13L30 8H7C5.89543 8 5 8.89543 5 10Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M43 38V10C43 8.89543 42.1046 8 41 8H38L34 14L37 19L28 23L29 31L22 33L24 40H41C42.1046 40 43 39.1046 43 38Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 18C15.3284 18 16 17.3284 16 16.5C16 15.6716 15.3284 15 14.5 15C13.6716 15 13 15.6716 13 16.5C13 17.3284 13.6716 18 14.5 18Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>',width:24,height:24,funcType:Zw.damagePic,positionType:qw.left,name:"damage_pic",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get loading_pic(){return{type:"svg",svg:'<svg viewBox="0 0 400 300" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="a" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="50" y="65" width="301" height="170"><path d="M350.3 65H50v169.8h300.3V65Z" fill="#fff"/></mask><g mask="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M58.3 233.2h32.8v-36.8H58.3v36.8Z" fill="#C7DEFF"/><path d="M91.1 224.5v8.8H58.3M82.4 196.2H58.3" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M305.4 182.5s-2.7 12.6 0 17.4c2.7 4.8 8.3 6.7 12.4 4.4 4.2-2.4 5.3-8.1 2.6-12.9-2.7-4.8-15-8.9-15-8.9ZM336 204.7c4.3 2 9.7-.4 12-5.4 2.3-5-1.5-17.3-1.5-17.3s-11.8 5.1-14.1 10.1c-2.3 5-.7 10.6 3.6 12.6Z" fill="#00E4E5"/><path fill-rule="evenodd" clip-rule="evenodd" d="M326.7 174s-10 11.8-10 18.6c0 6.7 4.5 12.2 10 12.2s10-5.5 10-12.3c0-6.8-10-18.5-10-18.5Z" fill="#00E4E5"/><path d="M332.3 181.5c2.3 3.6 4.4 7.8 4.4 10.9M316.7 192.5c0-3.1 2.1-7.2 4.3-10.8" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M343.1 227.3v-9.7h-34v9.7c0 3.7 3 6.6 6.6 6.6h20.9c3.6 0 6.5-2.9 6.5-6.6Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M350.4 220.8V198H302v22.8c0 5.9 4.8 10.7 10.7 10.7h26.9c5.9 0 10.7-4.8 10.8-10.7Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M331.7 74.2H117.8L87.4 203h213.8l30.5-128.8Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M337 74.2h-6.2l-30.6 129.2h6.2L337 74.2Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M303.8 203.5h2.4l30.7-129.3h-1.8l-31.3 129.3Z" fill="#C7DEFF"/><path d="m337 74.2-30.6 129.2h-5.9" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M229.9 202.1h-47.6l2 9.6h47.3l-1.7-9.6Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path d="M138.5 74.2h193.2l-23.4 98.6M94.5 172.7l11-46.3M104.8 155.4l-2.3 11.5h6.7M316 112.1l1.1-4.5" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M148.3 138.1h97V119h-97v19.1Z" fill="#00E4E5"/><path d="M303.1 80.6h20.3l-4.6 19.6M228.3 234.3c3.6 0 6.3-3.2 5.7-6.8l-4.1-24.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M226.2 229.5h-68.9v1.2c0 2 1.6 3.7 3.7 3.7h60.1c2.8 0 5-2.2 5.1-4.9Z" fill="#C7DEFF"/><path d="M180.699 226.8h-19.9c-2.8 0-4.6 3-3.3 5.5m0 0c.6 1.2 1.9 2 3.3 2h57.8M175.9 203.4l3.6 17.6M241.2 234.3h65.1M104.6 234.3h41.3" stroke="#071F4D"/><path d="M206.2 234.3h14.9c3.1 0 5.5-2.8 5-5.9l-4.3-24.9M160.7 226.8h46M62.2 226.1h-9.5c-1.2 0-2.2-1-2.2-2.2v-18.3c0-1.2 1-2.2 2.2-2.2h9.5" stroke="#071F4D"/><path d="M53.4 171.7H68c2.1 0 3.7 1.7 3.7 3.7v16.1M79.1 192v-21.8c0-2.5 2-4.6 4.6-4.6h2.2c2.5 0 4.5-2 4.5-4.5m0 0c0-2.5-2-4.5-4.5-4.5H56.1c-2.4 0-4.3-1.9-4.3-4.3V148M71.2 165.2h-18M64 181.7v10.1" stroke="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.7 120H124c4.3 0 7.7-3.5 7.7-7.7V65.5H94.2c-4.7 0-8.5 4.9-8.5 11V120Z" fill="#C7DEFF"/><path d="M85.7 110.7V73c0-4.1 3.4-7.5 7.5-7.5h38.5M146.2 73.8v-2.5c0-3.2-2-5.8-5.8-5.8-2.8 0-6 1.1-6 5.8v42.4c0 4.7-3.8 8.5-8.5 8.5h-15.6" stroke="#071F4D"/><path d="M119.7 122.3H87c-6.1 0-11.1-5-11.1-11.1m0 0h39M126.1 122.3c-6.1 0-11.1-5-11.1-11.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.4 122.1h37.2c-6.5-1.8-8-10.5-8-10.5H76.2c.6 8.8 9.2 10.5 9.2 10.5Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M95.8 102.9h4.8V83.6h-4.8v19.3ZM106.6 102.9h4.8V77.6h-4.8v25.3ZM117.3 102.9h4.8V89.1h-4.8v13.8Z" fill="#fff"/><path d="M273.2 195.9h16.9M261.2 195.9h5" stroke="#fff"/><path d="M62.4 201.9v2.9M62.4 224.5v2.9" stroke="#071F4D"/><path d="m153.6 138.1 9.7-19.1M168.8 138.1l9.7-19.1M184.1 138.1l9.7-19.1M199.4 138.1l9.7-19.1M214.6 138.1l9.8-19.1M229.9 138.1l9.7-19.1" stroke="#fff"/><path d="M148.3 138.1h121.6V119H148.3v19.1Z" stroke="#071F4D"/></g></svg>',width:400,height:300,name:"loading_pic",positionType:qw.left}},get expand(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">\n      <path d="M4.64988 6.81235C4.38797 6.48497 4.62106 6 5.04031 6L10.9597 6C11.3789 6 11.612 6.48497 11.3501 6.81235L8.39043 10.512C8.19027 10.7622 7.80973 10.7622 7.60957 10.512L4.64988 6.81235Z" fill="${cR}" fill-opacity="${uR}"/>\n      </svg>`,width:gR,height:gR,funcType:Zw.expand,name:"expand",positionType:qw.contentLeft,marginLeft:0,marginRight:4,hover:{width:pR,height:pR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get collapse(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">\n      <path d="M5.81235 11.3501C5.48497 11.612 5 11.3789 5 10.9597L5 5.04031C5 4.62106 5.48497 4.38797 5.81235 4.64988L9.51196 7.60957C9.76216 7.80973 9.76216 8.19027 9.51196 8.39044L5.81235 11.3501Z"  fill="${aR}" fill-opacity="${lR}"/>\n      </svg>`,width:hR,height:hR,funcType:Zw.collapse,name:"collapse",positionType:qw.contentLeft,marginLeft:0,marginRight:4,hover:{width:dR,height:dR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get drillDown(){return{name:"drillDown",type:"svg",positionType:qw.absolute,funcType:Zw.drillDown,svg:'<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path  d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM549.333333 288a5.333333 5.333333 0 0 1 5.333334 5.333333V469.333333h176a5.333333 5.333333 0 0 1 5.333333 5.333334v74.666666a5.333333 5.333333 0 0 1-5.333333 5.333334H554.666667v176a5.333333 5.333333 0 0 1-5.333334 5.333333h-74.666666a5.333333 5.333333 0 0 1-5.333334-5.333333V554.666667H293.333333a5.333333 5.333333 0 0 1-5.333333-5.333334v-74.666666a5.333333 5.333333 0 0 1 5.333333-5.333334H469.333333V293.333333a5.333333 5.333333 0 0 1 5.333334-5.333333h74.666666z"></path></svg>',width:13,height:13,cursor:"pointer"}},get drillUp(){return{name:"drillUp",type:"svg",positionType:qw.absolute,funcType:Zw.drillUp,svg:'<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM693.333333 469.333333a42.666667 42.666667 0 1 1 0 85.333334H330.666667a42.666667 42.666667 0 1 1 0-85.333334h362.666666z"></path></svg>',width:13,height:13,cursor:"pointer"}},get dragReorder(){return{type:"svg",svg:`<svg t="1710129136961" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5166" width="200" height="200"><path d="M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${fR}"  fill-opacity="${vR}" p-id="5167"></path><path d="M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${fR}"  fill-opacity="${vR}" p-id="5168"></path><path d="M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${fR}"  fill-opacity="${vR}" p-id="5169"></path><path d="M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${fR}"  fill-opacity="${vR}" p-id="5170"></path><path d="M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${fR}"  fill-opacity="${vR}" p-id="5171"></path><path d="M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${fR}"  fill-opacity="${vR}" p-id="5172"></path></svg>`,width:bR,height:bR,funcType:Zw.dragReorder,positionType:qw.left,name:"dragReorder",marginLeft:-10,marginRight:10,cursor:"grab"}}},CR={};function wR(){return t_(yR,CR)}let xR=class extends Ea{clear(){this.removeAllChild()}getChildByName(t,e){let i=null;return this.forEachChildren((e=>e.name===t&&(i=e,!0))),e&&this.forEachChildren((e=>{if(e.getChildByName){const n=e.getChildByName(t,!0);if(n)return i=n,!0}return!1})),i}get width(){var t;let e=this.AABBBounds.width();return e!==1/0&&e!==-1/0||(e=0),Math.max(e,null!==(t=this.attribute.width)&&void 0!==t?t:0)}get height(){var t;let e=this.AABBBounds.height();return e!==1/0&&e!==-1/0||(e=0),Math.max(e,null!==(t=this.attribute.height)&&void 0!==t?t:0)}setDeltaWidth(t){var e;0!==t&&(this.setAttribute("width",(null!==(e=this.attribute.width)&&void 0!==e?e:0)+t),this.border&&(this.border.setAttribute("width",this.border.attribute.width+t),"group"===this.border.type&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.width+t)))}setDeltaHeight(t){var e;0!==t&&(this.setAttribute("height",(null!==(e=this.attribute.height)&&void 0!==e?e:0)+t),this.border&&(this.border.setAttribute("height",this.border.attribute.height+t),"group"===this.border.type&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.height+t)))}setDeltaX(t){0!==t&&this.setAttribute("x",this.attribute.x+t)}setDeltaY(t){0!==t&&this.setAttribute("y",this.attribute.y+t)}forEachChildrenSkipChild(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"border-rect";if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){let i=this._lastChild,n=0;for(;i;){if(i.name!==e&&t(i,n++))return;i=i._prev}}else{let i=this._firstChild,n=0;for(;i;){if(i.name!==e&&t(i,n++))return;i=i._next}}}getColGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.col===t)return e;e=e._next}return null}getRowGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.row===t)return e;e=e._next}return null}addCellGroup(t){if(0===this.childrenCount||this.lastChild.row===t.row-1)this.addChild(t);else{let e=this._firstChild;for(let i=0;i<this.childrenCount;i++){if(e.row===t.row-1)return void this.insertAfter(t,e);e=e._next}this.addChild(t)}}getChildAt(t){const e=super.getChildAt(t);return e&&"border-rect"===e.name?e._next:e}tryUpdateAABBBounds(){if("cell"===this.role){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),function(t,e){t.stage&&t.stage.dirtyBounds&&t.stage.renderCount&&(t.isContainer&&!e||t.stage.dirty(t.globalAABBBounds))}(this,t),e}return super.tryUpdateAABBBounds()}doUpdateAABBBounds(){if("cell"===this.role){const t=this.attribute,{x:e,y:i,width:n,height:o}=t;return this._AABBBounds.setValue(e,i,e+n,i+o),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this.shadowRoot&&this.shadowRoot.tryUpdateAABBBounds(),this._AABBBounds}return"body"===this.role||"row-header"===this.role||"col-header"===this.role||"right-frozen"===this.role||"bottom-frozen"===this.role||"corner-header"===this.role||"corner-right-top-header"===this.role||"corner-right-bottom-header"===this.role||"corner-left-bottom-header"===this.role?(this._AABBBounds.setValue(-1/0,-1/0,1/0,1/0),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this.shadowRoot&&this.shadowRoot.tryUpdateAABBBounds(),this._AABBBounds):super.doUpdateAABBBounds()}updateColumnRowNumber(t){this.rowNumber?this.rowNumber=Math.max(this.rowNumber,t):this.rowNumber=t}updateColumnHeight(t){this.colHeight?this.colHeight+=t:this.colHeight=t}};function _R(t,e,i,n){const o=t/e;let r,s;return o>i/n?(r=i,s=r/o):(s=n,r=s*o),{width:r,height:s}}function SR(t,e,i,n,o,r){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"left",a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"middle",l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[0,0,0,0],h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,u=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0;const g=t+i,p=e+n;let f=t+l[3]+h;"right"===s||"end"===s?f=g-o-l[1]-d:"center"===s&&(f=t+(i-o+h-d)/2);let v=e+l[0]+c;return"bottom"===a||"alphabetic"===a||"ideographic"===a?v=p-r-l[2]-u:"middle"===a&&(v=e+(n-r+c-u)/2),{x:f,y:v}}function AR(t,e,i,n,o){const r=e&&XC(e[t])?e[t]:void 0;return"function"==typeof r?r({col:i,row:n,table:o,value:o.getCellValue(i,n),dataValue:o.getCellOriginValue(i,n),cellHeaderPaths:o.getCellHeaderPaths(i,n)}):r}function BR(t,e,i,n,o){const r=e&&XC(e[t])?e[t]:void 0;if("function"==typeof r)return r({col:i,row:n,table:o,value:o.getCellValue(i,n),dataValue:o.getCellOriginValue(i,n),cellHeaderPaths:o.getCellHeaderPaths(i,n)})}function TR(t,e,i,n){var o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w;let x=null!==(r=null===(o=null==i?void 0:i.group)||void 0===o?void 0:o.strokeArrayWidth)&&void 0!==r?r:void 0;return n.theme.cellInnerBorder||!function(t){return!!XC(t)&&(!ZC(t)||t.some((t=>XC(t))))}(n.theme.frameStyle.borderLineWidth)||function(t){return 0===t||ZC(t)&&t.every((t=>0===t))}(n.theme.frameStyle.borderLineWidth)||(0===t&&(x=null!=x?x:[null===(s=null==i?void 0:i.group)||void 0===s?void 0:s.lineWidth,null===(a=null==i?void 0:i.group)||void 0===a?void 0:a.lineWidth,null===(l=null==i?void 0:i.group)||void 0===l?void 0:l.lineWidth,null===(h=null==i?void 0:i.group)||void 0===h?void 0:h.lineWidth],x[3]=0),t===n.colCount-1&&(x=null!=x?x:[null===(d=null==i?void 0:i.group)||void 0===d?void 0:d.lineWidth,null===(c=null==i?void 0:i.group)||void 0===c?void 0:c.lineWidth,null===(u=null==i?void 0:i.group)||void 0===u?void 0:u.lineWidth,null===(g=null==i?void 0:i.group)||void 0===g?void 0:g.lineWidth],x[1]=0),0===e&&(x=null!=x?x:[null===(p=null==i?void 0:i.group)||void 0===p?void 0:p.lineWidth,null===(f=null==i?void 0:i.group)||void 0===f?void 0:f.lineWidth,null===(v=null==i?void 0:i.group)||void 0===v?void 0:v.lineWidth,null===(b=null==i?void 0:i.group)||void 0===b?void 0:b.lineWidth],x[0]=0),e===n.rowCount-1&&(x=null!=x?x:[null===(m=null==i?void 0:i.group)||void 0===m?void 0:m.lineWidth,null===(y=null==i?void 0:i.group)||void 0===y?void 0:y.lineWidth,null===(C=null==i?void 0:i.group)||void 0===C?void 0:C.lineWidth,null===(w=null==i?void 0:i.group)||void 0===w?void 0:w.lineWidth],x[2]=0)),x}class RR extends xR{constructor(t){super(t),this._autoWidth=!1,this._autoHeight=!1,this._leftGroup=new xR({pickable:!1,fill:!1,stroke:!1}),this._leftGroup.role="content-left",this._rightGroup=new xR({pickable:!1,fill:!1,stroke:!1}),this._rightGroup.role="content-right",this._centerGroup=new xR({pickable:!1,fill:!1,stroke:!1}),this._centerGroup.role="content-center",this.appendChild(this._leftGroup),this.appendChild(this._rightGroup),this.appendChild(this._centerGroup)}setCellContentOption(t){this._autoWidth=t.autoWidth,this._autoHeight=t.autoHeight,this._cellWidth=t.cellWidth,this._originCellWidth=t.cellWidth,this._cellHeight=t.cellHeight,this._align=t.align,this._baseline=t.baseline}addLeftOccupyingIcon(t){var e,i,n;t.setAttribute("x",this._leftGroup.width+(null!==(e=t.attribute.marginLeft)&&void 0!==e?e:0)),this._leftGroup.appendChild(t),this._leftGroup.setDeltaWidth((null!==(i=t.attribute.marginLeft)&&void 0!==i?i:0)+(null!==(n=t.attribute.marginRight)&&void 0!==n?n:0)+t.attribute.width)}addRightOccupyingIcon(t){var e,i,n;t.setAttribute("x",this._rightGroup.width+(null!==(e=t.attribute.marginLeft)&&void 0!==e?e:0)),this._rightGroup.appendChild(t),this._rightGroup.setDeltaWidth((null!==(i=t.attribute.marginLeft)&&void 0!==i?i:0)+(null!==(n=t.attribute.marginRight)&&void 0!==n?n:0)+t.attribute.width)}addContent(t){const e=this._centerGroup.lastChild;e&&t.setAttributes({x:e.attribute.x+e.AABBBounds.width()}),this._centerGroup.appendChild(t),t instanceof Fl&&(this._centerGroup.setAttribute("pickable",!1),t.setAttribute("textAlign","left"))}layout(){let t=this._leftGroup.width;t===1/0&&(t=0);let e=this._rightGroup.width;if(e===-1/0&&(e=0),this._autoWidth){const i=this._centerGroup.width;this._cellWidth=t+e+i,this.setAttribute("width",this._cellWidth)}else{const i=this._cellWidth-t-e;this.updateCenterLayout(i);const n=this._centerGroup.width;this._cellWidth=t+e+n,this.setAttribute("width",this._cellWidth)}this.updateHorizontalPos();const i=this._leftGroup.height,n=this._rightGroup.height,o=this._centerGroup.height;this._cellHeight=Math.max(i,n,o),this.setAttribute("height",this._cellHeight),this.updateVerticalPos()}updateCenterLayout(t){let e=t;this._centerGroup.forEachChildren((t=>{(t instanceof LT||t instanceof PT)&&(e-=t.AABBBounds.width())}));const i=this._centerGroup.getChildByName("text");i instanceof lh?i.setAttribute("width",e):i instanceof Fl&&i.setAttribute("maxLineWidth",e);let n=0;this._centerGroup.forEachChildren((t=>{t.setAttribute("x",n),n+=t.AABBBounds.width()}))}updateHorizontalPos(){this._leftGroup.setAttribute("x",0),this._rightGroup.setAttribute("x",this._cellWidth-this._rightGroup.width),this._centerGroup.setAttribute("x",this._leftGroup.width),"left"===this._align||"start"===this._align?this.setAttribute("dx",0):"center"===this._align?this.setAttribute("dx",-this.attribute.width/2):"right"!==this._align&&"end"!==this._align||this.setAttribute("dx",-this.attribute.width)}updateVerticalPos(){"top"===this._baseline?(this._leftGroup.setAttribute("y",0),this._rightGroup.setAttribute("y",0),this._centerGroup.setAttribute("y",0)):"middle"===this._baseline?(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",(this._leftGroup.height-t.AABBBounds.height())/2)})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",(this._rightGroup.height-t.AABBBounds.height())/2)})),this._leftGroup.setAttribute("y",this._cellHeight/2-this._leftGroup.height/2),this._rightGroup.setAttribute("y",this._cellHeight/2-this._rightGroup.height/2),this._centerGroup.setAttribute("y",this._cellHeight/2-this._centerGroup.height/2)):"bottom"===this._baseline&&(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",this._leftGroup.height-t.AABBBounds.height())})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",this._rightGroup.height-t.AABBBounds.height())})),this._leftGroup.setAttribute("y",this._cellHeight-this._leftGroup.height),this._rightGroup.setAttribute("y",this._cellHeight-this._rightGroup.height),this._centerGroup.setAttribute("y",this._cellHeight-this._centerGroup.height))}updateWidth(t){this._cellWidth=t,this._originCellWidth=t,this.layout()}updateHeight(t){this._cellHeight=t,this._cellWidth=this._originCellWidth;const e=this.getChildByName("text",!0);e&&e.setAttribute("heightLimit",t),this.layout()}}function kR(t,e,i){var n,o,r,s,a;let l=0;const h=i.internalProps.layoutMap;if(h.isHeader(t,e)){const r=h.getHeader(t,e);XC(null==r?void 0:r.hierarchyLevel)&&(l=(null!==(n=r.hierarchyLevel)&&void 0!==n?n:0)*("tree"===h.rowHierarchyType&&null!==(o=h.rowHierarchyIndent)&&void 0!==o?o:0),h.rowHierarchyTextStartAlignment&&!i.internalProps.headerHelper.getHierarchyIcon(t,e)&&(l+=i.internalProps.headerHelper.getHierarchyIconWidth()))}else if(i.options.groupBy||(null===(r=i.getBodyColumnDefine(t,e))||void 0===r?void 0:r.tree)){const n=i.dataSource.getIndexKey(i.getRecordShowIndexByCell(t,e)),o=null!==(s=i.dataSource.getGroupLength())&&void 0!==s?s:0;let r=ZC(n)?n.length-1:0;o>0&&r===o&&(r=0),l=Array.isArray(n)&&i.getHierarchyState(t,e)!==Kw.none?r*(null!==(a=h.hierarchyIndent)&&void 0!==a?a:0):0,h.hierarchyTextStartAlignment&&!i.internalProps.bodyHelper.getHierarchyIcon(t,e)&&(l+=i.internalProps.bodyHelper.getHierarchyIconWidth())}return l}function MR(t,e){var i,n;let o,r=!1;for(qC(t)&&t.length>(e.options.maxCharactersNumber||200)&&(t=t.slice(0,e.options.maxCharactersNumber||200),t+="…",r=!0),o=e.internalProps.enableLineBreak||(null===(i=e.options.customConfig)||void 0===i?void 0:i.multilinesForXTable)?Ix(t).replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n")||[]:[Ix(t)];o.length&&o.length>1&&!o[o.length-1];)o.pop();if((null===(n=e.options.customConfig)||void 0===n?void 0:n.multilinesForXTable)&&!e.internalProps.autoWrapText)for(;o.length&&o.length>1&&!o[0];)o.shift();return{text:o,moreThanMaxCharacters:r}}function LR(t,e,i,n,o,r,s){var a,l,h,d,c,u;const g={};"image"===t.type?t.isGif?(g.gif=t.src,g.image=t.src):g.image=t.src:("svg"===t.type||"svg"in t)&&(g.image=t.svg),g.width=t.width,g.height=t.height,g.visibleTime=null!==(a=t.visibleTime)&&void 0!==a?a:"always",g.funcType=t.funcType,g.interactive=t.interactive,g.isGif=t.isGif;let p,f=0;return s&&0!==(null==s?void 0:s.addedHierarchyOffset)||!tw(i)||!tw(n)||!r||t.funcType!==Zw.collapse&&t.funcType!==Zw.expand&&t.positionType!==qw.contentLeft&&t.positionType!==qw.contentRight||(f=o?kR(o.start.col,o.start.row,r):kR(i,n,r),s&&(s.addedHierarchyOffset=1)),g.marginLeft=(null!==(l=t.marginLeft)&&void 0!==l?l:0)+f,g.marginRight=null!==(h=t.marginRight)&&void 0!==h?h:0,!1===t.interactive&&(g.pickable=!1),t.hover&&(g.backgroundWidth=null!==(d=t.hover.width)&&void 0!==d?d:t.width,g.backgroundHeight=null!==(c=t.hover.width)&&void 0!==c?c:t.width,g.backgroundColor=null!==(u=t.hover.bgColor)&&void 0!==u?u:"rgba(22,44,66,0.2)",g.hoverImage=t.hover.image),t.cursor&&(g.cursor=t.cursor),"shape"in t&&"circle"===t.shape&&(g.shape=t.shape),e?(e.setAttributes(g),e.loadImage(g.image),e.tooltip=t.tooltip,e.name=t.name,e):("text"===t.type?(g.text=t.content,uw(g,t.style),p=new PT(g),p.tooltip=t.tooltip,p.name=t.name):(p=new LT(g),p.tooltip=t.tooltip,p.name=t.name),p)}function PR(t){var e,i,n,o,r,s;const a={};return"image"===t.type?a.image=t.src:("svg"===t.type||"svg"in t)&&(a.image=t.svg),a.visibleTime=null!==(e=t.visibleTime)&&void 0!==e?e:"always",a.funcType=t.funcType,a.id=t.name,a.width=t.width,a.height=t.height,(t.marginRight||t.marginLeft)&&(a.margin=[0,null!==(i=t.marginRight)&&void 0!==i?i:0,0,null!==(n=t.marginLeft)&&void 0!==n?n:0]),t.hover&&(a.backgroundWidth=null!==(o=t.hover.width)&&void 0!==o?o:t.width,a.backgroundHeight=null!==(r=t.hover.height)&&void 0!==r?r:t.height,a.backgroundShowMode="hover",a.hoverImage=t.hover.image,a.backgroundStroke=!1,a.backgroundFill=null!==(s=t.hover.bgColor)&&void 0!==s?s:"rgba(22,44,66,0.2)"),t.cursor&&(a.cursor=t.cursor),a.tooltip=t.tooltip,a}function ER(t,e,i,n,o,r,s,a,l){var h,d,c,u;ew(t.contentWidth)&&(n=e-(null!==(h=t.contentWidth)&&void 0!==h?h:t.attribute.width));let g,p=0,f=0,v=0,b=0;t.forEachChildren((t=>{var e,i,n,o;"icon-left"===t.role?(p+=t.AABBBounds.width()+(null!==(e=t.attribute.marginLeft)&&void 0!==e?e:0)+(null!==(i=t.attribute.marginRight)&&void 0!==i?i:0),f=Math.max(f,t.AABBBounds.height())):"icon-right"===t.role&&(v+=t.AABBBounds.width()+(null!==(n=t.attribute.marginLeft)&&void 0!==n?n:0)+(null!==(o=t.attribute.marginRight)&&void 0!==o?o:0),b=Math.max(b,t.AABBBounds.height()))}));const m=t.getChildByName("text"),y=t.getChildByName("content");let C;m instanceof Fl?(g=m.AABBBounds.height(),m.setAttribute("maxLineWidth",e-p-v-(r[1]+r[3])-(null!==(d=m.attribute.dx)&&void 0!==d?d:0)-(null!==(c=l.table.theme._contentOffset)&&void 0!==c?c:0)),C=m.AABBBounds.height()):m instanceof lh?(g=m.AABBBounds.height(),m.setAttribute("width",e-p-v-(r[1]+r[3])),C=m.AABBBounds.height()):y&&(g=y.AABBBounds.height(),y.updateWidth(e-p-v-(r[1]+r[3])),C=y.AABBBounds.height());const w=Math.round(Math.max(f,b,g)+r[0]+r[2]);if(t.forEachChildren((i=>{var o;if("icon-left"===i.role);else if("icon-right"===i.role)i.setAttribute("x",i.attribute.x+n);else if("icon-absolute-right"===i.role)i.setAttribute("x",i.attribute.x+n);else if("content"===i.name||"text"===i.name&&"richtext"!==i.type){const t=null!==(o=i.attribute.textAlign)&&void 0!==o?o:s;"center"===t?i.setAttribute("x",r[3]+p+(e-(r[1]+r[3])-p-v)/2):"right"===t&&i.setAttribute("x",r[3]+e-(r[1]+r[3])-v)}else"mark"===i.name&&i.setAttribute("x",t.attribute.width)})),o){let e=Math.max(f,C,b);if(function(t,e,i,n){const o=t.table,r=Z_(o,e.col,e.row);if(r&&r.end.row-r.start.row){n/=r.end.row-r.start.row+1,i/=r.end.row-r.start.row+1;for(let t=r.start.row;t<=r.end.row;t++){const e=o.getRowHeight(t);if(e===n&&i!==e)return!0;if(i>e)return!0}}else{const t=o.getRowHeight(e.row);if(t===n&&i!==t)return!0;if(i>t)return!0}return!1}(l,t,Math.round(e+r[0]+r[2]),w))return!0;e=(null!==(u=t.contentHeight)&&void 0!==u?u:i)-(r[0]+r[2]),t.forEachChildren((t=>{"rect"!==t.type&&"chart"!==t.type&&t.name!==WT&&("mark"===t.name?t.setAttribute("y",0):"middle"===a?t.setAttribute("y",r[0]+(e-t.AABBBounds.height())/2):"bottom"===a?t.setAttribute("y",r[0]+e-t.AABBBounds.height()):t.setAttribute("y",r[0]))}))}else"middle"!==a&&"bottom"!==a||t.forEachChildren((t=>{"rect"!==t.type&&"chart"!==t.type&&t.name!==WT&&("mark"===t.name?t.setAttribute("y",0):"middle"===a?t.setAttribute("y",(i-r[2]+r[0]-t.AABBBounds.height())/2):"bottom"===a?t.setAttribute("y",i-t.AABBBounds.height()-r[2]):t.setAttribute("y",r[0]))}));return!1}function HR(t,e,i,n,o,r,s,a){var l;const h=e-Math.floor(o[0]+o[2]),d=t.getChildByName("text");d instanceof Fl&&!n?d.setAttributes({heightLimit:!1===(null===(l=a.options.customConfig)||void 0===l?void 0:l.limitContentHeight)?-1:h}):d instanceof lh&&!n?d.setAttributes({height:h}):t.getChildByName("content")&&t.getChildByName("content").updateHeight(h),t.forEachChildren((t=>{t.setAttribute("dy",0),"rect"===t.type||"chart"===t.type||t.name===WT||("mark"===t.name?t.setAttribute("y",0):"middle"===s?t.setAttribute("y",o[0]+(h-t.AABBBounds.height())/2):"bottom"===s?t.setAttribute("y",o[0]+h-t.AABBBounds.height()):t.setAttribute("y",o[0]))}))}function OR(t,e,i,n){const o=[],r=[],s=[],a=[],l=[],h=[],d=[],c=[];let u=0,g=0,p=0,f=0,v=0,b=0;return t.forEach((t=>{switch(t.positionType){case qw.left:o.push(t);break;case qw.right:r.push(t);break;case qw.contentLeft:s.push(t);break;case qw.contentRight:a.push(t);break;case qw.absoluteRight:c.push(t);break;case qw.inlineFront:l.push(t);break;case qw.inlineEnd:h.push(t)}})),o.forEach((t=>{var o,r,s;const a=LR(t,void 0,e.col,e.row,i,n);a.role="icon-left",a.name=t.name,a.setAttribute("x",u+(null!==(o=a.attribute.marginLeft)&&void 0!==o?o:0)),u+=a.AABBBounds.width()+(null!==(r=a.attribute.marginLeft)&&void 0!==r?r:0)+(null!==(s=a.attribute.marginRight)&&void 0!==s?s:0),g=Math.max(g,a.AABBBounds.height()),e.appendChild(a)})),r.forEach((t=>{var o,r,s;const a=LR(t,void 0,e.col,e.row,i,n);a.role="icon-right",a.name=t.name,a.setAttribute("x",p+(null!==(o=a.attribute.marginLeft)&&void 0!==o?o:0)),p+=a.AABBBounds.width()+(null!==(r=a.attribute.marginLeft)&&void 0!==r?r:0)+(null!==(s=a.attribute.marginRight)&&void 0!==s?s:0),f=Math.max(f,a.AABBBounds.height()),e.appendChild(a)})),d.forEach((t=>{var o,r,s;const a=LR(t,void 0,e.col,e.row,i,n);a.role="icon-absolute-left",a.name=t.name,a.setAttribute("x",v+(null!==(o=a.attribute.marginLeft)&&void 0!==o?o:0)),v+=a.AABBBounds.width()+(null!==(r=a.attribute.marginLeft)&&void 0!==r?r:0)+(null!==(s=a.attribute.marginRight)&&void 0!==s?s:0),e.appendChild(a)})),c.forEach((t=>{var o,r,s;const a=LR(t,void 0,e.col,e.row,i,n);a.role="icon-absolute-right",a.name=t.name,a.setAttribute("x",b+(null!==(o=a.attribute.marginLeft)&&void 0!==o?o:0)),b+=a.AABBBounds.width()+(null!==(r=a.attribute.marginLeft)&&void 0!==r?r:0)+(null!==(s=a.attribute.marginRight)&&void 0!==s?s:0),e.appendChild(a)})),{leftIcons:o,rightIcons:r,contentLeftIcons:s,contentRightIcons:a,inlineFrontIcons:l,inlineEndIcons:h,absoluteLeftIcons:d,absoluteRightIcons:c,leftIconWidth:u,leftIconHeight:g,rightIconWidth:p,rightIconHeight:f,absoluteLeftIconWidth:v,absoluteRightIconWidth:b}}function IR(t,e){if(t.hasOwnProperty("hoverIconId")){const e=this;if(e.skipMergeUpdate)return;const i=IT(e);if(!i||!i.stage)return;const n=i.stage.table;e.skipAttributeUpdate=!0;const{mergeStartCol:o,mergeEndCol:r,mergeStartRow:s,mergeEndRow:a}=i;if(XC(o)&&XC(r)&&XC(s)&&XC(a)&&(o!==r||s!==a)){for(let l=o;l<=r;l++)for(let o=s;o<=a;o++){if(l===i.col&&o===i.row){if(t.hoverIconId!==e.attribute.hoverIconId){const i=e._frameCache.icons.get(t.hoverIconId);e.updateHoverIconState(i)}continue}const r=n.scenegraph.highPerformanceGetCell(l,o);if("cell"===r.role){const i=r.getChildByName(e.name,!0);if(!i||i.skipAttributeUpdate)continue;t.hoverIconId!==i.attribute.hoverIconId&&(i.setAttribute("hoverIconId",t.hoverIconId),r.addUpdateBoundTag())}}e.skipAttributeUpdate=void 0}}}function FR(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v){var b,m,y,C,w,x,_,S,A,B,T,R,k,M,L,P,E,H,O,I,F,z,D,W,N,G,j,V,U,X;const $=BR("padding",g._getCellStyle(n,o),n,o,g);(null===(b=g.options.customConfig)||void 0===b?void 0:b.imageMargin)?h=UB(null===(m=g.options.customConfig)||void 0===m?void 0:m.imageMargin):XC($)&&(h=$),(null===(y=null==p?void 0:p.text)||void 0===y?void 0:y.textAlign)&&(d=null===(C=null==p?void 0:p.text)||void 0===C?void 0:C.textAlign),(null===(w=null==p?void 0:p.text)||void 0===w?void 0:w.textBaseline)&&(c=null===(x=null==p?void 0:p.text)||void 0===x?void 0:x.textBaseline);const Y=TR(n,o,p,g);let K,q;if(v&&(K=g.scenegraph.highPerformanceGetCell(n,o,!0),K&&"cell"===K.role&&K.setAttributes({x:e,y:i,width:r,height:s,lineWidth:null!==(S=null===(_=null==p?void 0:p.group)||void 0===_?void 0:_.lineWidth)&&void 0!==S?S:void 0,fill:null!==(B=null===(A=null==p?void 0:p.group)||void 0===A?void 0:A.fill)&&void 0!==B?B:void 0,stroke:null!==(R=null===(T=null==p?void 0:p.group)||void 0===T?void 0:T.stroke)&&void 0!==R?R:void 0,strokeArrayWidth:null!=Y?Y:void 0,strokeArrayColor:null!==(M=null===(k=null==p?void 0:p.group)||void 0===k?void 0:k.strokeArrayColor)&&void 0!==M?M:void 0,cursor:null!==(P=null===(L=null==p?void 0:p.group)||void 0===L?void 0:L.cursor)&&void 0!==P?P:void 0,lineDash:null!==(H=null===(E=null==p?void 0:p.group)||void 0===E?void 0:E.lineDash)&&void 0!==H?H:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})),K&&"cell"===K.role||(K=new xR({x:e,y:i,width:r,height:s,lineWidth:null!==(I=null===(O=null==p?void 0:p.group)||void 0===O?void 0:O.lineWidth)&&void 0!==I?I:void 0,fill:null!==(z=null===(F=null==p?void 0:p.group)||void 0===F?void 0:F.fill)&&void 0!==z?z:void 0,stroke:null!==(W=null===(D=null==p?void 0:p.group)||void 0===D?void 0:D.stroke)&&void 0!==W?W:void 0,strokeArrayWidth:null!=Y?Y:void 0,strokeArrayColor:null!==(G=null===(N=null==p?void 0:p.group)||void 0===N?void 0:N.strokeArrayColor)&&void 0!==G?G:void 0,cursor:null!==(V=null===(j=null==p?void 0:p.group)||void 0===j?void 0:j.cursor)&&void 0!==V?V:void 0,lineDash:null!==(X=null===(U=null==p?void 0:p.group)||void 0===U?void 0:U.lineDash)&&void 0!==X?X:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),K.role="cell",K.col=n,K.row=o,null==t||t.addCellGroup(K)),u){let t=n,e=o;f&&(t=f.start.col,e=f.start.row),q=g.getCellIcons(t,e)}let Z=0,J=0,Q=0;if(Array.isArray(q)&&0!==q.length){const{leftIconWidth:t,rightIconWidth:e,absoluteLeftIconWidth:i,absoluteRightIconWidth:n}=OR(q,K,f,g);Z=t+e,J=t,Q=e,K.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+r-e-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+r-n-h[1])})),K.forEachChildren((t=>{"middle"===c?t.setAttribute("y",(s-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",s-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])})),K._cellLeftIconWidth=J,K._cellRightIconWidth=Q}const tt=g.getCellValue(n,o),et=ih({x:h[3],y:h[0],width:r-h[1]-h[3]-Z,height:s-h[0]-h[2],image:tt,cursor:"pointer"});return et.name="image",et.keepAspectRatio=a,et.textAlign=d,et.textBaseline=c,a||l?et.resources&&et.resources.has(et.attribute.image)&&"success"===et.resources.get(et.attribute.image).state?(et.setAttribute("opacity",0),setTimeout((()=>{et.setAttribute("opacity",1),GR(l,a,h,d,c,et,K,g),g.scenegraph.updateNextFrame()}),0)):et.successCallback=()=>{GR(l,a,h,d,c,et,K,g),g.scenegraph.updateNextFrame()}:et.resources&&et.resources.has(et.attribute.image)&&"success"===et.resources.get(et.attribute.image).state?DR(K,n,o,0,0,g):et.successCallback=()=>{DR(K,n,o,0,0,g)},et.failCallback=()=>{const t=wR();et.image=t.damage_pic.svg},K.appendChild(et),K}function zR(t,e,i,n,o,r,s){let a=!1,l=null,h=null;const{width:d,height:c,isMerge:u}=WR(s,o.table);if(d<i+r[1]+r[3]&&(l=i+r[1]+r[3],a=!0),c<n+r[2]+r[0]&&(h=n+r[2]+r[0],a=!0),a){if("number"==typeof l)if(u)for(let t=s.mergeStartCol;t<=s.mergeEndCol;t++)o.setColWidth(t,l/(s.mergeEndCol-s.mergeStartCol+1));else o.setColWidth(t,l);if("number"==typeof h)if(u)for(let t=s.mergeStartRow;t<=s.mergeEndRow;t++)o.setRowHeight(t,h/(s.mergeEndRow-s.mergeStartRow+1));else o.setRowHeight(e,h);return o.component.updateScrollBar(),!0}return!1}function DR(t,e,i,n,o,r){var s,a,l,h,d,c,u,g,p,f,v,b;const m=t.getChildByName("image");if(!m)return;const y="string"!=typeof m.attribute.image&&m.attribute.image||(null===(s=m.resources)||void 0===s?void 0:s.get(m.attribute.image).data);if(!y)return;const C=r._getCellStyle(e,i),w=null!==(a=AR("textAlign",C,e,i,r))&&void 0!==a?a:"left",x=null!==(l=AR("textBaseline",C,e,i,r))&&void 0!==l?l:"middle";let _;_=(null===(h=r.options.customConfig)||void 0===h?void 0:h.imageMargin)?UB(null===(d=r.options.customConfig)||void 0===d?void 0:d.imageMargin):null!==(c=UB(AR("padding",C,e,i,r)))&&void 0!==c?c:[0,0,0,0];const{width:S,height:A,isMerge:B}=WR(t,r),T=null!==(u=t.mergeStartCol)&&void 0!==u?u:t.col,R=null!==(g=t.mergeStartRow)&&void 0!==g?g:t.row,k=null!==(p=t.mergeEndCol)&&void 0!==p?p:t.col,M=null!==(f=t.mergeEndCol)&&void 0!==f?f:t.row,L=null!==(v=t._cellLeftIconWidth)&&void 0!==v?v:0,P=null!==(b=t._cellRightIconWidth)&&void 0!==b?b:0;if(m.keepAspectRatio){const{width:t,height:e}=_R(y.width||y.videoWidth,y.height||y.videoHeight,S-(_[1]+_[3]),A-(_[0]+_[2])),i=SR(0,0,S,A,t,e,w,x,_);for(let n=T;n<=k;n++)for(let o=R;o<=M;o++){const s=r.scenegraph.getCell(n,o).getChildByName("image");null==s||s.setAttributes({x:i.x,y:i.y,width:t,height:e})}}else for(let t=T;t<=k;t++)for(let e=R;e<=M;e++){const i=r.scenegraph.getCell(t,e).getChildByName("image");null==i||i.setAttributes({x:L+_[3],y:_[0],width:S-_[1]-_[3]-P-L,height:A-_[0]-_[2]})}if(t.getChildByName("play-icon")){const e=0,i=0,{width:n,height:o}=WR(t,r),s=Math.floor(Math.min(n-_[1]-_[3],o-_[2]-_[0])/2),a=e+(n>m.attribute.width?m.attribute.x-e+m.attribute.width/2:n/2),l=i+(o>m.attribute.height?m.attribute.y-i+m.attribute.height/2:o/2);for(let t=T;t<=k;t++)for(let e=R;e<=M;e++)r.scenegraph.getCell(t,e).getChildByName("play-icon").setAttributes({x:a-s/2,y:l-s/2,width:s,height:s})}t.forEachChildren((t=>{"icon-left"===t.role||("icon-right"===t.role||"icon-absolute-right"===t.role)&&t.setAttribute("x",t.attribute.x+n)})),t.forEachChildren((t=>{("rect"===t.type||t.role&&t.role.startsWith("icon"))&&("middle"===x?t.setAttribute("y",_[0]+(A-_[0]-_[2]-t.AABBBounds.height())/2):"bottom"===x?t.setAttribute("y",_[0]+A-_[0]-_[2]-t.AABBBounds.height()):t.setAttribute("y",_[0]))})),B&&NR(t.mergeStartCol,t.mergeEndCol,t.mergeStartRow,t.mergeEndRow,r)}function WR(t,e){return"cell"===t.role&&XC(t.mergeStartCol)&&XC(t.mergeEndCol)&&XC(t.mergeStartRow)&&XC(t.mergeEndRow)?{width:e.getColsWidth(t.mergeStartCol,t.mergeEndCol),height:e.getRowsHeight(t.mergeStartRow,t.mergeEndRow),isMerge:!0}:{width:t.attribute.width,height:t.attribute.height,isMerge:!1}}function NR(t,e,i,n,o){for(let r=t;r<=e;r++)for(let t=i;t<=n;t++){const e=o.scenegraph.getCell(r,t);if(e){const i=e.getChildByName("image");i&&i.setAttributes({dx:-o.getColsWidth(e.mergeStartCol,r-1),dy:-o.getRowsHeight(e.mergeStartRow,t-1)});const n=e.getChildByName("play-icon");n&&n.setAttributes({dx:-o.getColsWidth(e.mergeStartCol,r-1),dy:-o.getRowsHeight(e.mergeStartRow,t-1)})}}}function GR(t,e,i,n,o,r,s,a){const l=r.resources.get(r.attribute.image).data,{col:h,row:d}=s;if(t&&!jR(r)&&zR(h,d,l.width,l.height,a.scenegraph,i,s),e||jR(r)){const{width:t,height:e,isMerge:h}=WR(s,a),{width:d,height:c}=_R(l.width,l.height,t-i[1]-i[3],e-i[0]-i[2]),u=SR(0,0,t,e,d,c,n,o,i);r.setAttributes({x:u.x,y:u.y,width:d,height:c}),h&&NR(s.mergeStartCol,s.mergeEndCol,s.mergeStartRow,s.mergeEndRow,a)}}function jR(t){const e=wR();return t.attribute.image===e.damage_pic.svg}function VR(t,e,i){t.then((()=>{i(),e.scenegraph.updateNextFrame()})).catch((t=>{}))}function UR(t,e){var i,n;const o=this;if(o.shadowRoot&&o.shadowRoot.childrenCount&&(XC(t.width)||XC(t.height))){const e=o.shadowRoot.findChildrenByName("shadow-rect")[0];e&&e.setAttributes({width:null!==(i=t.width)&&void 0!==i?i:e.attribute.width,height:null!==(n=t.height)&&void 0!==n?n:e.attribute.height})}}function XR(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b){var m,y;let C,w=!1;if(o_(e)){if("cell"!==n.scenegraph.highPerformanceGetCell(o,r).role)return C;e=n.getCellValue(o,r),w=!0}if("checkbox"===t&&i.tree)C=J_.getFunction("createCheckboxCellGroup")(null,h,0,d,o,r,s,a,l,c,u,g,p,n,f,i,v,w,!0);else if("text"===t||"link"===t||b){if("link"===t){const s=e,a=n.getCellOriginValue(o,r),l=n._getCellStyle(o,r);"link"===t&&("templateLink"in i&&i.templateLink||!("linkDetect"in i)||!n_(i.linkDetect,{col:o,row:r,table:n,value:s,dataValue:a,cellHeaderPaths:void 0})||P_.test(s))&&(f?(f.text.fill=AR("linkColor",l,o,r,n),f.group.cursor="pointer"):f={text:{fill:AR("linkColor",l,o,r,n)},group:{cursor:"pointer"}})}const{customElementsGroup:y,renderDefault:x}=$R(n,i,o,r,a,l,c,v,b);C=J_.getFunction("createTextCellGroup")(n,e,h,0,d,o,r,s,a,l,c,u,g,p,y,x,f,v,w);const _=n.internalProps.layoutMap.getAxisConfigInPivotChart(o,r);if(_){const t=new(J_.getComponent("axis"))(_,C.attribute.width,C.attribute.height,null!==(m=_.__vtablePadding)&&void 0!==m?m:c,n);C.clear(),C.appendChild(t.component),t.overlap()}else n.internalProps.layoutMap.isEmpty(o,r)?(C.setAttributes({fill:!1,stroke:!1}),C.clear()):n.internalProps.layoutMap.isAxisCell(o,r)&&C.clear()}else if("image"===t)C=J_.getFunction("createImageCellGroup")(h,0,d,o,r,a,l,i.keepAspectRatio,i.imageAutoSizing,c,u,g,p,n,f,v,w);else if("video"===t)C=J_.getFunction("createVideoCellGroup")(h,0,d,o,r,a,l,i.keepAspectRatio,i.imageAutoSizing,c,u,g,p,n,f,v,w);else if("chart"===t){const t=n.internalProps.layoutMap.getChartInstance(o,r);C=J_.getFunction("createChartCellGroup")(null,h,0,d,o,r,a,l,c,e,i.chartModule,n.internalProps.layoutMap.getChartSpec(o,r),t,null!==(y=n.internalProps.layoutMap.getChartDataId(o,r))&&void 0!==y?y:"data",n,f,n.internalProps.layoutMap.isShareChartSpec(o,r),w,n.internalProps.layoutMap.isNoChartDataRenderNothing(o,r))}else if("progressbar"===t){const{customElementsGroup:t,renderDefault:p}=$R(n,i,o,r,a,l,c,v,b),m=n._getCellStyle(o,r),y=n.getCellOriginValue(o,r);C=J_.getFunction("createTextCellGroup")(n,e,h,0,d,o,r,s,a,l,c,u,g,!1,t,p,f,v,w);const x=J_.getFunction("createProgressBarCell")(i,m,s,e,y,o,r,c,n,v);C.firstChild?C.insertBefore(x,C.firstChild):C.appendChild(x)}else if("sparkline"===t)C=J_.getFunction("createSparkLineCellGroup")(null,h,0,d,o,r,a,l,c,n,f,w);else if("checkbox"===t){const t="isAggregation"in n.internalProps.layoutMap&&n.internalProps.layoutMap.isAggregation(o,r),b=n.internalProps.layoutMap.isSeriesNumber(o,r);C=t&&b?J_.getFunction("createTextCellGroup")(n,e,h,0,d,o,r,s,a,l,c,u,g,!1,void 0,!0,f,v,w):J_.getFunction("createCheckboxCellGroup")(null,h,0,d,o,r,s,a,l,c,u,g,p,n,f,i,v,w,!1)}else"radio"===t?C=J_.getFunction("createRadioCellGroup")(null,h,0,d,o,r,s,a,l,c,u,g,n,f,i,v):"switch"===t?C=J_.getFunction("createSwitchCellGroup")(null,h,0,d,o,r,s,a,l,c,u,g,p,n,f,i,v,w):"button"===t&&(C=J_.getFunction("createButtonCellGroup")(null,h,0,d,o,r,s,a,l,c,u,g,p,n,f,i,v,w));return C.onBeforeAttributeUpdate=UR,C}function $R(t,e,i,n,o,r,s,a,l){let h,d=!0;if(l)h=l.elementsGroup,d=l.renderDefault;else if((null==a?void 0:a.isCustom)&&!t.isCornerHeader(i,n));else{let l,c;if("body"!==t.getCellLocation(i,n)?(l=null==e?void 0:e.headerCustomRender,c=null==e?void 0:e.headerCustomLayout):(l=(null==e?void 0:e.customRender)||t.customRender,c=null==e?void 0:e.customLayout),c||l){const e=GT(c,l,i,n,o,r,!1,t.isAutoRowHeight(n),s,a,t);h=e.elementsGroup,d=e.renderDefault}}return{customElementsGroup:h,renderDefault:d}}function YR(t,e,i,n,o,r){var s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_;const S=i.scenegraph.highPerformanceGetCell(t,e,!0);if("cell"!==S.role&&!n)return;const A=i.getCellLocation(t,e);let B,T,R,k,M=i.getCellValue(t,e),L=!1;if(i.internalProps.customMergeCell){const n=i.getCustomMerge(t,e);if(n){const{range:t,text:o,style:r,customLayout:s,customRender:a}=n;T=t,B=T.start.col!==T.end.col||T.start.row!==T.end.row,M=o,R=r,(s||a)&&(k=GT(s,a,t.start.col,t.start.row,i.getColsWidth(t.start.col,t.end.col),i.getRowsHeight(t.start.row,t.end.row),!1,i.isAutoRowHeight(e),[0,0,0,0],T,i)),L=!0}}let P=t,E=e;T&&(P=T.start.col,E=T.start.row);const H="body"!==A?i.getHeaderDefine(P,E):i.getBodyColumnDefine(P,E);let O="body"!==A||(null==H?void 0:H.dragOrder)||!!(null==H?void 0:H.icon)||!!(null==H?void 0:H.tree);T||!i.internalProps.enableTreeNodeMerge&&"body"===A&&!(null==H?void 0:H.mergeCell)||(T=i.getCellRange(t,e),B=T.start.col!==T.end.col||T.start.row!==T.end.row);let I=!1;if(i.internalProps.enableTreeNodeMerge&&B){const n=i.getCellRawRecord(T.start.col,T.start.row),{vtableMergeName:o,vtableMerge:r}=null!=n?n:{};I=r,r&&(O=!0,i.options.groupTitleCustomLayout&&(k=GT(i.options.groupTitleCustomLayout,void 0,T.start.col,T.start.row,i.getColsWidth(T.start.col,T.end.col),i.getRowsHeight(T.start.row,T.end.row),!1,i.isAutoRowHeight(e),[0,0,0,0],T,i)),i.options.groupTitleFieldFormat?M=i.options.groupTitleFieldFormat(n,t,e,i):o&&(M=o))}const F=R||i._getCellStyle(T?T.start.col:t,T?T.start.row:e),z=null!==(s=F.autoWrapText)&&void 0!==s?s:i.internalProps.autoWrapText,D=RT(F,i,B?T.start.col:t,B?T.start.row:e,AR).theme;if(D.group.cornerRadius=kT(t,e,i),!n&&!B&&!((null==H?void 0:H.customLayout)||(null==H?void 0:H.customRender)||(null==H?void 0:H.headerCustomLayout)||(null==H?void 0:H.headerCustomRender))&&(r||function(t,e,i,n,o,r){var s;const a=r.getBodyColumnType(t,e),l=r.isAutoRowHeight(e),h=r.getCellValue(t,e);return!(r.isHeader(t,e)||"cell"!==i.role||"text"!==a||n||l||o||"text"!==(null===(s=i.firstChild)||void 0===s?void 0:s.type)||o_(h))}(t,e,S,z,O,i))){const n=i.getColWidth(t),o=i.getRowHeight(e),s=TR(t,e,D,i);S.setAttributes({width:n,height:o,lineWidth:null!==(l=null===(a=null==D?void 0:D.group)||void 0===a?void 0:a.lineWidth)&&void 0!==l?l:void 0,fill:null!==(d=null===(h=null==D?void 0:D.group)||void 0===h?void 0:h.fill)&&void 0!==d?d:void 0,stroke:null!==(u=null===(c=null==D?void 0:D.group)||void 0===c?void 0:c.stroke)&&void 0!==u?u:void 0,strokeArrayWidth:null!=s?s:void 0,strokeArrayColor:null!==(p=null===(g=null==D?void 0:D.group)||void 0===g?void 0:g.strokeArrayColor)&&void 0!==p?p:void 0,cursor:null!==(v=null===(f=null==D?void 0:D.group)||void 0===f?void 0:f.cursor)&&void 0!==v?v:void 0,cornerRadius:null!==(m=null===(b=null==D?void 0:D.group)||void 0===b?void 0:b.cornerRadius)&&void 0!==m?m:0,lineDash:null!==(C=null===(y=null==D?void 0:D.group)||void 0===y?void 0:y.lineDash)&&void 0!==C?C:void 0,y:i.scenegraph.getCellGroupY(e)}),S.forEachChildren((t=>{t.setAttributes({dx:0,dy:0})}));const x=S.getChildByName("text");if(r&&x){const t={textBaseline:"top"};x.setAttributes(D.text?Object.assign({},D.text,t):t)}else if(x){const r=i.getCellValue(t,e),{text:s,moreThanMaxCharacters:a}=MR(r,i),l=kR(t,e,i),h=F.lineClamp,d=null!==(w=UB(AR("padding",F,t,e,i)))&&void 0!==w?w:[0,0,0,0],c=D.text.textAlign;let u=0;u="center"===c?d[3]+(n-(d[1]+d[3]))/2:"right"===c?d[3]+n-(d[1]+d[3]):d[3];const g={text:1!==s.length||z?s:s[0],moreThanMaxCharacters:a,maxLineWidth:n-(d[1]+d[3]+l),textBaseline:"top",autoWrapText:z,lineClamp:h,wordBreak:"break-word",heightLimit:o-Math.floor(d[0]+d[2]),pickable:!1,dx:"left"===c?l:0,x:u};if(x.setAttributes(D.text?Object.assign({},D.text,g):g),x.attribute.text){const t=D.text.textBaseline,e=o-(d[0]+d[2]);let i=0;i="middle"===t?d[0]+(e-x.AABBBounds.height())/2:"bottom"===t?d[0]+e-x.AABBBounds.height():d[0],x.setAttributes({y:i})}}return S}if(!n&&"empty"===S.role)return;const W=I||L?"text":i.isHeader(t,e)?null!==(x=i._getHeaderLayoutMap(t,e).headerType)&&void 0!==x?x:"text":null!==(_=i.getBodyColumnType(t,e))&&void 0!==_?_:"text",N=D._vtable.padding,G=D.text.textAlign,j=D.text.textBaseline;let V,U,X;if(T?(U=i.getColsWidth(T.start.col,T.end.col),X=i.getRowsHeight(T.start.row,T.end.row)):(U=i.getColWidth(t),X=i.getRowHeight(e)),o_(M)?(S.removeAllChild(),VR(M,i,qR.bind(null,{type:W,value:M,define:H,table:i,col:t,row:e,cellWidth:U,cellHeight:X,oldCellGroup:S,padding:N,textAlign:G,textBaseline:j,mayHaveIcon:O,addNew:n,range:T,customResult:k,customStyle:R}))):V=KR(W,M,H,i,t,e,U,X,S,N,G,j,O,n,D,T,k),B){const{width:t}=V.attribute,{height:e}=V.attribute;V.contentWidth=t,V.contentHeight=e,o?function(t,e,i,n,o,r,s,a){const{col:l,row:h}=a;t.start.row!==t.end.row&&a.contentHeight!==i&&HR(a,i,0,s.isAutoRowHeight(h),n,0,r,s),t.start.col!==t.end.col&&a.contentWidth!==e&&ER(a,e,i,0,s.isAutoRowHeight(h),n,o,r,s.scenegraph),a.contentWidth=e,a.contentHeight=i;const d=s.getRowHeight(h);JR(a,s.getColWidth(l),d,t,s)}(T,U,X,N,G,j,i,V):ZR(T,U,X,N,G,j,i)}return V}function KR(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v){var b,m;if(o_(e)&&(e=n.getCellValue(o,r)),!g&&(l.row!==r||l.col!==o))return null;if(!g&&l.parent&&n.reactCustomLayout){const t=l.getChildByName("custom-container");if(t){const{col:e,row:i}=t;tw(e)&&tw(i)&&n.reactCustomLayout.removeCustomCell(e,i)}}const y=XR(t,e,i,n,o,r,n.getColWidth(o),s,a,g?n.scenegraph.getColGroup(o):l.parent,g?0:n.scenegraph.getCellGroupY(r),h,d,c,u,p,f,v);return!g&&l.parent&&(l.parent.insertAfter(y,l),l.parent.removeChild(l),(null===(b=n.scenegraph)||void 0===b?void 0:b.proxy.cellCache.get(o))&&(null===(m=n.scenegraph)||void 0===m||m.proxy.cellCache.set(o,y))),y}function qR(t){const{type:e,value:i,define:n,table:o,col:r,row:s,cellWidth:a,cellHeight:l,oldCellGroup:h,padding:d,textAlign:c,textBaseline:u,mayHaveIcon:g,addNew:p,range:f,customResult:v,customStyle:b}=t,m=RT(b||o._getCellStyle(f?f.start.col:r,f?f.start.row:s),o,f?f.start.col:r,f?f.start.row:s,AR).theme;m.group.cornerRadius=kT(r,s,o),KR(e,i,n,o,r,s,a,l,h,d,c,u,g,p,m,f,v)}function ZR(t,e,i,n,o,r,s){for(let a=t.start.col;a<=t.end.col;a++)for(let l=t.start.row;l<=t.end.row;l++){const h=s.scenegraph.highPerformanceGetCell(a,l,!0);if("cell"!==h.role)continue;t.start.row!==t.end.row&&h.contentHeight!==i&&HR(h,i,0,s.isAutoRowHeight(l),n,0,r,s),t.start.col!==t.end.col&&h.contentWidth!==e&&ER(h,e,i,0,s.isAutoRowHeight(l),n,o,r,s.scenegraph),h.contentWidth=e,h.contentHeight=i;const d=s.getRowHeight(l);JR(h,s.getColWidth(a),d,t,s)}}function JR(t,e,i,n,o){var r,s;const{col:a,row:l}=t,h=-o.getColsWidth(n.start.col,a-1);let d=0;if(null===(r=o.options.customConfig)||void 0===r?void 0:r._disableColumnAndRowSizeRound)for(let t=n.start.row;t<=l-1;t++)d-=o.getRowHeight(t);else d=-o.getRowsHeight(n.start.row,l-1);t.forEachChildren((t=>{var e,i,n,o,r,s;"number"==typeof t._dx?(t.skipMergeUpdate=!0,t.setAttributes({dx:(null!==(e=t._dx)&&void 0!==e?e:0)+h}),t.skipMergeUpdate=!1):(t.skipMergeUpdate=!0,t._dx=null!==(i=t.attribute.dx)&&void 0!==i?i:0,t.setAttributes({dx:(null!==(n=t.attribute.dx)&&void 0!==n?n:0)+h}),t.skipMergeUpdate=!1),"number"==typeof t._dy?(t.skipMergeUpdate=!0,t.setAttributes({dy:(null!==(o=t._dy)&&void 0!==o?o:0)+d}),t.skipMergeUpdate=!1):(t._dy=null!==(r=t.attribute.dy)&&void 0!==r?r:0,t.skipMergeUpdate=!0,t.setAttributes({dy:(null!==(s=t.attribute.dy)&&void 0!==s?s:0)+d}),t.skipMergeUpdate=!1)}));const c=null!==(s=t.attribute.strokeArrayWidth)&&void 0!==s?s:t.attribute.lineWidth,u=ZC(c),g=[0,0,0,0];a===n.start.col&&(g[3]=u?c[3]:c),l===n.start.row&&(g[0]=u?c[0]:c),a===n.end.col&&(g[1]=u?c[1]:c),l===n.end.row&&(g[2]=u?c[2]:c);const p=e!==t.attribute.width,f=i!==t.attribute.height;return t.skipMergeUpdate=!0,t.setAttributes({width:e,height:i,strokeArrayWidth:g}),t.skipMergeUpdate=!1,t.mergeStartCol=n.start.col,t.mergeStartRow=n.start.row,t.mergeEndCol=n.end.col,t.mergeEndRow=n.end.row,{widthChange:p,heightChange:f}}function QR(t,e,i,n){if(n.internalProps.customMergeCell){const o=n.getCustomMerge(t,e);if(o){const{range:r,text:s,style:a,customLayout:l,customRender:h}=o;if(l||h){const o=GT(l,h,r.start.col,r.start.row,n.getColsWidth(r.start.col,r.end.col),n.getRowsHeight(r.start.row,r.end.row),!1,n.isAutoRowHeight(e),[0,0,0,0],r,n).elementsGroup;i.childrenCount>0&&o?i.insertBefore(o,i.firstChild):o&&i.appendChild(o);const s=n.getRowHeight(e),a=n.getColWidth(t),{width:d}=i.attribute,{height:c}=i.attribute;return i.contentWidth=d,i.contentHeight=c,JR(i,a,s,r,n),r}}}}function tk(t){return!!("cell"===t.role&&tw(t.mergeStartCol)&&tw(t.mergeStartRow)&&tw(t.mergeEndCol)&&tw(t.mergeEndRow))}const ek=new vC({}),ik=new bC({}),nk=new ym({});function ok(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p){const f=Wx($C(t)?t.text:t).split("\n")||[],v=p.getColsWidth(e,n),b=AR("size",o,e,i,p);let m=AR("outerRadius",o,e,i,p);const y=tw(m)?2*m:b;let C=0;if(r){const t=AR("spaceBetweenTextAndIcon",o,e,i,p),n=v-(g[1]+g[3])-s-y-t;tw(m)||(m=Math.round(b/2)),ik.setAttributes({text:{maxLineWidth:n,text:f,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:d,lineHeight:c,wordBreak:"break-word",lineClamp:u},circle:{outerRadius:m},spaceBetweenTextAndIcon:t}),ik.render(),C=ik.AABBBounds.height()}else C=Math.max(b,f.length*c);return C}let rk="quick";const sk=new l(((t,e,i,n)=>{i(go)?n(go).to(hk).inSingletonScope():t(go).to(hk).inSingletonScope()}));new l(((t,e,i,n)=>{i(go)?n(go).to(po).inSingletonScope():t(go).to(po).inSingletonScope()}));const ak=new Map;function lk(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"normal";const o=`${t}-${e}-${i}-${n}`,r=ak.get(o);if(r)return r;const s=(a={fontSize:t,fontFamily:i,fontWeight:e,fontStyle:n},new mw(Object.assign({defaultFontParams:{fontFamily:Rn.fontFamily,fontSize:Rn.fontSize},getTextBounds:Ah,specialCharSet:`{}()//&-/: .,@%'"~…=——${mw.ALPHABET_CHAR_SET}${mw.ALPHABET_CHAR_SET.toUpperCase()}0123456789`},{}),a));var a;return ak.set(o,s),s}class hk extends po{_fastMeasure(t,e){const{fontSize:i,fontFamily:n="Arial,sans-serif",fontWeight:o="normal",fontStyle:r="normal"}=e,s=lk(i,o,n,r).measure(t,rk);if(!XC(s.fontBoundingBoxAscent)&&!XC(s.fontBoundingBoxDescent)){const{ascent:t,descent:i}=this.measureTextBoundADscentEstimate(e);s.fontBoundingBoxAscent=t,s.fontBoundingBoxDescent=i}return s}measureTextWidth(t,e){return this._fastMeasure(t,e).width}measureText(t,e){return this._fastMeasure(t,e)}_measureTextWithoutAlignBaseline(t,e,i){return this._fastMeasure(t,e)}_measureTextWithAlignBaseline(t,e,i){return this._fastMeasure(t,e)}}const dk=new class{measureText(t,e){const{fontSize:i,fontFamily:n="Arial,sans-serif",fontWeight:o="normal",fontStyle:r="normal"}=e;return lk(i,o,n,r).measure(t,rk)}measureTextWidth(t,e){const{fontSize:i,fontFamily:n="Arial,sans-serif",fontWeight:o="normal",fontStyle:r="normal"}=e;return lk(i,o,n,r).measure(t,rk).width}clipText(t,e,i){if(0===t.length)return{str:"",width:0};let n=this.measureTextWidth(t,e);return n<=i?{str:t,width:n}:(n=this.measureTextWidth(t[0],e),n>i?{str:"",width:0}:this._clipText(t,e,i,0,t.length-1))}_clipText(t,e,i,n,o){const r=Math.floor((n+o)/2),s=t.substring(0,r+1),a=this.measureTextWidth(s,e);let l;if(a>i){if(s.length<=1)return{str:"",width:0};const o=t.substring(0,r);return l=this.measureTextWidth(o,e),l<=i?{str:o,width:l}:this._clipText(t,e,i,n,r)}if(a<i){if(r>=t.length-1)return{str:t,width:this.measureTextWidth(t,e)};const n=t.substring(0,r+2);return l=this.measureTextWidth(n,e),l>=i?{str:s,width:a}:this._clipText(t,e,i,r,o)}return{str:s,width:a}}clipTextWithSuffix(t,e,i,n){if(""===n)return this.clipText(t,e,i);if(0===t.length)return{str:"",width:0};const o=this.measureTextWidth(t,e);if(o<=i)return{str:t,width:o};const r=this.measureTextWidth(n,e);if(r>i)return{str:"",width:0};i-=r;const s=this._clipText(t,e,i,0,t.length-1);return s.str+=n,s.width+=r,s}},ck=new Fl({ignoreBuf:!0});function uk(t){return ck.initAttributes(Object.assign(Object.assign({},t),{ignoreBuf:!0})),ck.AABBBounds}const gk=new lh({width:0,height:0,textConfig:[]});function pk(t,e,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4?arguments[4]:void 0;var r,s,a,l,h,d,c,u,g,p,f;"undefined"!=typeof window&&window.performance.now();const v=[],b=[];if(o)for(let n=e;n<=i;n++)v[n]=t.getRowHeight(n);const m=t.internalProps.layoutMap;t.isPivotTable()&&(m.enableUseGetBodyCache(),m.enableUseHeaderPathCache()),t.defaultHeaderRowHeight,t.defaultHeaderColWidth;const y="auto"===t.defaultHeaderRowHeight||ZC(t.defaultHeaderRowHeight)&&t.defaultHeaderRowHeight.some((t=>"auto"===t)),C=t.isAutoRowHeight(e)||"adaptive"===t.heightMode&&!1!==t.options.autoHeightInAdaptiveMode,w="auto"===t.options.defaultRowHeight;if(C||y||w){e=null!=e?e:0,i=null!=i?i:t.rowCount-1,(0===e&&i===t.rowCount-1||n)&&t._clearRowRangeHeightsMap();for(let i=e;i<t.columnHeaderLevelCount;i++){let e=0,n=t.colCount-1;if((t.isPivotTable()&&!t.isPivotChart()||t.isPivotChart()&&!t.internalProps.layoutMap.indicatorsAsCol)&&bk(t,i)&&!Z_(t,t.rowHeaderLevelCount,i)&&(e=0,n=t.rowHeaderLevelCount),C||"auto"===t.getDefaultRowHeight(i)){const r=fk(i,e,n,t);b[i]=Math.round(r),"only-body"!==t.heightAdaptiveMode&&o||t._setRowHeight(i,r)}}for(let e=t.rowCount-t.bottomFrozenRowCount;e<=i;e++)if(C||"auto"===t.getDefaultRowHeight(e)){const i=fk(e,0,t.colCount-1,t);o?b[e]=Math.round(i):t._setRowHeight(e,i)}if(i<t.columnHeaderLevelCount||!C&&!w);else if(t.internalProps.transpose||t.isPivotTable()&&!t.internalProps.layoutMap.indicatorsAsCol||t.options.customComputeRowHeight||!function(t,e){var i,n,o;const{layoutMap:r}=t.internalProps,s=t.columnHeaderLevelCount;if((t.internalProps.autoWrapText||t.internalProps.enableLineBreak||t.isPivotChart())&&(t.isAutoRowHeight(e)||"adaptive"===t.options.heightMode))return!1;for(let e=0;e<t.colCount;e++){const a=r.getBody(e,s);if("radio"===a.cellType)return!1;if("function"==typeof a.style||"function"==typeof a.icon||(null===(i=a.define)||void 0===i?void 0:i.customRender)||(null===(n=a.define)||void 0===n?void 0:n.customLayout)||"function"==typeof(null===(o=a.define)||void 0===o?void 0:o.icon))return!1;const l=t._getCellStyle(e,s);if("function"==typeof l.padding||"function"==typeof l.fontSize||"function"==typeof l.lineHeight||!0===l.autoWrapText)return!1}return!0}(t,e))if(t.internalProps.transpose||t.isPivotTable()&&!t.internalProps.layoutMap.indicatorsAsCol)for(let n=Math.max(e,t.columnHeaderLevelCount);n<=i;n++){let e;e=vk(t,n)?fk(n,0,t.rowHeaderLevelCount,t):fk(n,0,t.colCount-1,t),o?b[n]=Math.round(e):t._setRowHeight(n,e)}else for(let n=Math.max(e,t.columnHeaderLevelCount);n<=i;n++){const e=fk(n,0,t.colCount-1,t);o?b[n]=Math.round(e):t._setRowHeight(n,e)}else{!function(t,e,i,n,o){if(!n.internalProps.useOneRowHeightFillAll){for(let r=e;r<=i;r++)o?o[r]=t:n._setRowHeight(r,t);n.internalProps.useOneRowHeightFillAll=!0}}(fk(t.columnHeaderLevelCount,0,t.colCount-1,t),t.columnHeaderLevelCount,t.rowCount-1-t.bottomFrozenRowCount,t,o?b:void 0);for(let e=t.rowCount-t.bottomFrozenRowCount;e<=i;e++){const i=fk(e,0,t.colCount-1,t);o?b[e]=Math.round(i):t._setRowHeight(e,i)}}}else if(("adaptive"===t.heightMode||t.autoFillHeight)&&t.clearRowHeightCache(),o)for(let n=e;n<=i;n++)b[n]=t.getRowHeight(n);if((0===e&&i===t.rowCount-1||n)&&t._clearRowRangeHeightsMap(),"adaptive"===t.heightMode){t._clearRowRangeHeightsMap();let e=t.tableNoFrameHeight,i=0,n=t.rowCount;if("only-body"===t.heightAdaptiveMode){const o=t.getRowsHeight(0,t.columnHeaderLevelCount-1),r=t.isPivotChart()?t.getBottomFrozenRowsHeight():0;e=t.tableNoFrameHeight-o-r,i=t.columnHeaderLevelCount,n=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount}let a=0;for(let e=i;e<n;e++)a+=o&&null!==(r=b[e])&&void 0!==r?r:t.getRowHeight(e);const l=e/a;for(let r=i;r<n;r++){let a;a=r===n-1?e-(o?b.reduce(((t,e,o)=>o>=i&&o<=n-2?t+e:t),0):t.getRowsHeight(i,n-2)):Math.round((o&&null!==(s=b[r])&&void 0!==s?s:t.getRowHeight(r))*l),o?b[r]=a:t._setRowHeight(r,a,!1)}}else if(t.autoFillHeight){t._clearRowRangeHeightsMap();const e=t.tableNoFrameHeight;let i=0,n=0;for(let e=0;e<t.rowCount;e++){const r=o&&null!==(a=b[e])&&void 0!==a?a:t.getRowHeight(e);(e<t.columnHeaderLevelCount||t.isPivotChart()&&e>=t.rowCount-t.bottomFrozenRowCount)&&(n+=r),i+=r}if(t.scenegraph._dealAutoFillHeightOriginRowsHeight=i,i<e&&i-n>0){const r=t.columnHeaderLevelCount,s=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount,a=(e-n)/(i-n);for(let i=r;i<s;i++){let h;h=i===s-1?e-n-(o?b.reduce(((t,e,i)=>i>=r&&i<=s-2?t+e:t),0):t.getRowsHeight(r,s-2)):Math.round((o&&null!==(l=b[i])&&void 0!==l?l:t.getRowHeight(i))*a),o?b[i]=h:t._setRowHeight(i,h,!1)}}}if(o){for(let n=e;n<=i;n++){const e=null!==(h=b[n])&&void 0!==h?h:t.getRowHeight(n);XC(e)&&t._setRowHeight(n,e)}for(let e=0;e<=t.frozenRowCount-1;e++){const i=t.getRowHeight(e);i!==(null!==(d=v[e])&&void 0!==d?d:t.getRowHeight(e))&&t.scenegraph.updateRowHeight(e,i-(null!==(c=v[e])&&void 0!==c?c:t.getRowHeight(e)),!0)}for(let e=t.rowCount-t.bottomFrozenRowCount;e<=t.rowCount-1;e++){const i=t.getRowHeight(e);i!==(null!==(u=v[e])&&void 0!==u?u:t.getRowHeight(e))&&t.scenegraph.updateRowHeight(e,i-(null!==(g=v[e])&&void 0!==g?g:t.getRowHeight(e)),!0)}for(let e=t.scenegraph.proxy.rowStart;e<=t.scenegraph.proxy.rowEnd;e++){const i=t.getRowHeight(e);i!==(null!==(p=v[e])&&void 0!==p?p:t.getRowHeight(e))&&t.scenegraph.updateRowHeight(e,i-(null!==(f=v[e])&&void 0!==f?f:t.getRowHeight(e)),!0)}}t.isPivotTable()&&(m.disableUseGetBodyCache(),m.disableUseHeaderPathCache())}function fk(t,e,i,n){var o;if(!(n.isAutoRowHeight(t)||"adaptive"===n.heightMode&&!1!==n.options.autoHeightInAdaptiveMode)&&"auto"!==n.getDefaultRowHeight(t))return n.getDefaultRowHeight(t);let r;if(n.options.customComputeRowHeight){const e=n.options.customComputeRowHeight({row:t,table:n});if("number"==typeof e)return e;if("auto"!==e)return n.getDefaultRowHeight(t)}if(n.isPivotChart()&&t>=n.columnHeaderLevelCount&&t<n.rowCount-n.bottomFrozenRowCount)if(n.internalProps.layoutMap.indicatorsAsCol){const e=n.internalProps.layoutMap.getOptimunHeightForChart(t);if(e>0)return e}else{const e=n.getDefaultRowHeight(t);if(tw(e))return e}for(let s=e;s<=i;s++){const e=mk(s,t,n);if(e&&(r=XC(r)?Math.max(e.height,r):e.height,!e.renderDefault))continue;if(n.isPivotChart()){const e=n.internalProps.layoutMap.getAxisConfigInPivotChart(s,t);if(e){const t=J_.getFunction("computeAxisComponentHeight")(e,n);if("number"==typeof t){r=XC(r)?Math.max(t,r):t;continue}}}if(n.isPivotChart()&&(n.isLeftFrozenColumn(s)&&n.isBottomFrozenRow(t)||n.isRightFrozenColumn(s)&&n.isBottomFrozenRow(t)))continue;const i=yk(s,t,n.isHeader(s,t)?null===(o=n._getHeaderLayoutMap(s,t))||void 0===o?void 0:o.headerType:n.getBodyColumnType(s,t),n);r=XC(r)?Math.max(i,r):i}if(XC(r))return r;const s=n.getDefaultRowHeight(t);return tw(s)?s:n.defaultRowHeight}function vk(t,e){var i,n,o;const{layoutMap:r}=t.internalProps;if((t.internalProps.autoWrapText||t.internalProps.enableLineBreak)&&(t.isAutoRowHeight(e)||"adaptive"===t.options.heightMode))return!1;const s=r.getBody(t.rowHeaderLevelCount,e);if("function"==typeof s.style||"function"==typeof s.icon||(null===(i=s.define)||void 0===i?void 0:i.customRender)||(null===(n=s.define)||void 0===n?void 0:n.customLayout)||"function"==typeof(null===(o=s.define)||void 0===o?void 0:o.icon))return!1;const a=t._getCellStyle(t.rowHeaderLevelCount,e);return"function"!=typeof a.padding&&"function"!=typeof a.fontSize&&"function"!=typeof a.lineHeight&&!0!==a.autoWrapText}function bk(t,e){var i,n,o;const{layoutMap:r}=t.internalProps;if(t.internalProps.autoWrapText&&(t.isAutoRowHeight(e)||"adaptive"===t.options.heightMode))return!1;const s=r.getHeader(t.rowHeaderLevelCount,e);if("function"==typeof s.style||"function"==typeof s.icons||(null===(i=s.define)||void 0===i?void 0:i.headerCustomRender)||(null===(n=s.define)||void 0===n?void 0:n.headerCustomLayout)||"function"==typeof(null===(o=s.define)||void 0===o?void 0:o.icon))return!1;const a=t._getCellStyle(t.rowHeaderLevelCount,e);return"function"!=typeof a.padding&&"function"!=typeof a.fontSize&&"function"!=typeof a.lineHeight&&!0!==a.autoWrapText}function mk(t,e,i){var n,o,r,s,a,l,h;const d=i.getCustomRender(t,e);let c=i.getCustomLayout(t,e);if(d||c){let u,g=1,p=0,f=!1,v=!1;(i.isHeader(t,e)||(null===(n=i.getBodyColumnDefine(t,e))||void 0===n?void 0:n.mergeCell)||i.hasCustomMerge())&&(u=i.getCellRange(t,e),g=u.end.row-u.start.row+1);const b={col:null!==(o=null==u?void 0:u.start.col)&&void 0!==o?o:t,row:null!==(r=null==u?void 0:u.start.row)&&void 0!==r?r:e,dataValue:i.getCellOriginValue(t,e),value:i.getCellValue(t,e)||"",rect:Ck(t,e,i),table:i,originCol:t,originRow:e,forComputation:!0};if("react-custom-layout"===c&&(c=(null===(s=i.reactCustomLayout)||void 0===s?void 0:s.getCustomLayoutFunc(t,e))||ET),VC(c)){const e=c(b);e.rootContainer?(e.rootContainer=UT(e.rootContainer),VT(e.rootContainer,i.getColWidth(t),0),e.rootContainer.setStage(i.scenegraph.stage),p=null!==(a=e.rootContainer.AABBBounds.height())&&void 0!==a?a:0,f=e.renderDefault,v=e.enableCellPadding):(p=0,f=e.renderDefault,v=e.enableCellPadding)}else if("function"==typeof d){const t=d(b);p=null!==(l=null==t?void 0:t.expectedHeight)&&void 0!==l?l:0,f=null==t?void 0:t.renderDefault}else p=null!==(h=null==d?void 0:d.expectedHeight)&&void 0!==h?h:0,f=null==d?void 0:d.renderDefault;if(v){const n=UB(AR("padding",i._getCellStyle(t,e),t,e,i));p+=n[0]+n[2]}return{height:p/g,renderDefault:f}}}function yk(t,e,i,n){var o,r,s,a;let l=0;const h=n.getCellValue(t,e),d=n._getCellStyle(t,e);let c=0,u=0;const g=[];let p=0;const f=[];let v=0,b=!1;if("body"!==n.getCellLocation(t,e))b=!0;else{const i=n.getBodyColumnDefine(t,e);b=!!(null==i?void 0:i.icon)||!!(null==i?void 0:i.tree)||(null==i?void 0:i.dragOrder)}if(b){const i=n.getCellIcons(t,e);null==i||i.forEach((t=>{var e,i,n,o,r,s,a,l,h,d;t.positionType!==qw.absoluteRight&&t.positionType!==qw.inlineFront&&t.positionType!==qw.inlineEnd?(u+=(null!==(e=t.width)&&void 0!==e?e:0)+(null!==(i=t.marginLeft)&&void 0!==i?i:0)+(null!==(n=t.marginRight)&&void 0!==n?n:0),c=Math.max(c,null!==(o=t.height)&&void 0!==o?o:0)):t.positionType===qw.inlineFront?(g.push(t),p=Math.max(p,(null!==(r=t.height)&&void 0!==r?r:0)+(null!==(s=t.marginLeft)&&void 0!==s?s:0)+(null!==(a=t.marginRight)&&void 0!==a?a:0))):t.positionType===qw.inlineEnd&&(f.push(t),v=Math.max(v,(null!==(l=t.height)&&void 0!==l?l:0)+(null!==(h=t.marginLeft)&&void 0!==h?h:0)+(null!==(d=t.marginRight)&&void 0!==d?d:0)))}))}let m=1,y=t;if(n.isHeader(t,e)||(null===(o=n.getBodyColumnDefine(t,e))||void 0===o?void 0:o.mergeCell)||n.hasCustomMerge()){const i=n.getCellRange(t,e);m=i.end.row-i.start.row+1,t=i.start.col,y=i.end.col}const C=UB(AR("padding",d,t,e,n)),w=AR("fontSize",d,t,e,n),x=AR("fontStyle",d,t,e,n),_=AR("fontWeight",d,t,e,n),S=null!==(r=AR("lineHeight",d,t,e,n))&&void 0!==r?r:w,A=AR("fontFamily",d,t,e,n),B=AR("autoWrapText",d,t,e,n),T=AR("lineClamp",d,t,e,n),R=AR("underline",d,t,e,n),k=null!==(s=AR("underlineOffset",d,t,e,n))&&void 0!==s?s:0;let M;if("text"!==i&&"link"!==i&&"progressbar"!==i&&"checkbox"!==i&&"radio"!==i&&"switch"!==i&&"button"!==i)l=S;else if("checkbox"===i)l=function(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p){const f=Wx($C(t)?t.text:t).split("\n")||[],v=p.getColsWidth(e,n),b=AR("size",o,e,i,p);let m=0;if(r){const t=AR("spaceBetweenTextAndIcon",o,e,i,p),n=v-(g[1]+g[3])-s-b-t;ek.setAttributes({text:{maxLineWidth:n,text:f,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:d,lineHeight:c,wordBreak:"break-word",lineClamp:u},icon:{width:Math.floor(b/1.4),height:Math.floor(b/1.4)},box:{width:b,height:b},spaceBetweenTextAndIcon:t}),ek.render(),m=ek.AABBBounds.height()}else m=Math.max(b,f.length*c);return m}(h,t,e,y,d,B,u,w,x,_,A,S,T,C,n);else if("radio"===i)l=function(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p){var f;if(ZC(t)){let v=0;const b=p.getBodyColumnDefine(e,i),m=AR("spaceBetweenRadio",o,e,i,p),y=null!==(f=null==b?void 0:b.radioDirectionInCell)&&void 0!==f?f:"vertical";return"vertical"===y?t.forEach(((f,b)=>{const y=ok(f,e,i,n,o,r,s,a,l,h,d,c,u,g,p);v+=y,b!==t.length-1&&(v+=m)})):"horizontal"===y&&t.forEach((t=>{const f=ok(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p);v=Math.max(f,v)})),v}return ok(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p)}(h,t,e,y,d,B,u,w,x,_,A,S,T,C,n);else if("switch"===i)l=function(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p){return AR("boxWidth",o,e,i,p)}(0,t,e,0,d,0,0,0,0,0,0,0,0,0,n);else if("button"===i)l=function(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p){const f=Wx($C(t)?t.text:t).split("\n")||[],v=p.getColsWidth(e,n),b=AR("buttonPadding",o,e,i,p),m=AR("buttonLineWidth",o,e,i,p);let y=0;if(r){const t=v-(g[1]+g[3]);nk.setAttributes({text:f,textStyle:{maxLineWidth:t,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:d,lineHeight:c,wordBreak:"break-word",lineClamp:u},padding:b,panel:{visible:!0,fill:"red",stroke:"red",lineWidth:m}}),ik.render(),y=ik.AABBBounds.height()}else y=f.length*c+2*b;return y}(h,t,e,y,d,B,0,w,x,_,A,S,T,C,n);else{M=h;const i=MR(M,n).text,o=n.getColsWidth(t,y);if(g.length||f.length)if(B){const t=Object.assign({text:null==h?void 0:h.toString(),fontFamily:A,fontSize:w,fontStyle:x,fontWeight:_,lineHeight:S});t.textBaseline="middle";const e=[...g.map((t=>PR(t))),t,...f.map((t=>PR(t)))];gk.setAttributes({width:o-(C[1]+C[3])-u,height:0,textConfig:e}),l=gk.AABBBounds.height()}else l=0,i.forEach(((t,e)=>{var o;(null===(o=n.options.customConfig)||void 0===o?void 0:o.multilinesForXTable)&&0!==e||(0===e&&g.length?l+=Math.max(S,p):e===i.length-1&&f.length?l+=Math.max(S,v):l+=S)}));else if(B){const r=kR(t,e,n),s=uk({maxLineWidth:o-(C[1]+C[3])-u-r,text:i,fontSize:w,fontStyle:x,fontWeight:_,fontFamily:A,lineHeight:S,wordBreak:"break-word",whiteSpace:1!==i.length||B?"normal":"no-wrap",lineClamp:T});l=(s.height()||("number"==typeof S?S:w))+(R?k:0)}else l=(null===(a=n.options.customConfig)||void 0===a?void 0:a.multilinesForXTable)?S:i.length*S}return(Math.max(l,c)+C[0]+C[2])/m}function Ck(t,e,i){return{left:0,top:0,right:i.getColWidth(t),bottom:i.getRowHeight(e),width:i.getColWidth(t),height:0}}function wk(t,e){if(!e||!e.proxy)return{colStart:0,colEnd:0,rowStart:0,rowEnd:0};const{mergeStartCol:i,mergeEndCol:n,mergeStartRow:o,mergeEndRow:r,col:s,row:a}=t;return{colStart:i,colEnd:n,rowStart:o,rowEnd:r}}function xk(t,e,i,n){n||t.table._setRowHeight(e,t.table.getRowHeight(e)+i,!0);for(let n=0;n<t.table.colCount;n++){const o=t.getCell(n,e);if("empty"===o.role)continue;const r=Z_(t.table,n,e);r&&r.start.col!==n||(_k(t,o,n,e,o.attribute.height+i,i,t.table.isHeader(n,e)),t.updateCellContentWhileResize(n,e))}let o=0,r=0;e<t.table.frozenRowCount?(o=e+1,r=t.table.frozenRowCount-1):e>=t.table.rowCount-t.table.bottomFrozenRowCount?(o=e+1,r=t.table.rowCount-1):(o=e+1,r=Math.min(t.proxy.rowEnd,t.table.rowCount-t.table.bottomFrozenRowCount-1));for(let e=0;e<t.table.colCount;e++)for(let n=o;n<=r;n++){const o=t.highPerformanceGetCell(e,n);"cell"===o.role&&o.setAttribute("y",o.attribute.y+i)}}function _k(t,e,i,n,o,r,s){e&&function(t,e,i,n,o,r,s){var a,l,h,d,c;if(e.attribute.height===o&&!e.needUpdateHeight)return;e.needUpdateHeight=!1,e.setAttribute("height",o);const u=null===(a=t.table.getCellRawRecord(i,n))||void 0===a?void 0:a.vtableMerge,g=!!t.table.getCustomMerge(i,n),p=u||g?"text":t.table.isHeader(i,n)?null!==(l=t.table._getHeaderLayoutMap(i,n).headerType)&&void 0!==l?l:"text":null!==(h=t.table.getBodyColumnType(i,n))&&void 0!==h?h:"text";if("progressbar"===p){const s=t.table.getBodyColumnDefine(i,n),a=t.table._getCellStyle(i,n),l=t.table.getCellValue(i,n),h=t.table.getCellOriginValue(i,n),d=UB(AR("padding",a,i,n,t.table));let c;(null==s?void 0:s.mergeCell)&&(c=t.table.getCellRange(i,n));const u=J_.getFunction("createProgressBarCell")(s,a,e.attribute.width,l,h,i,n,d,t.table,c),g=e.getChildByName("progress-bar");e.insertBefore(u,g),e.removeChild(g),g.removeAllChild(),g.release(),Sk(e,o,r,t.table.isAutoRowHeight(n),!0,t.table)}else if("sparkline"===p){e.removeAllChild();const o=t.table._getCellStyle(i,n),r=UB(AR("padding",o,i,n,t.table));J_.getFunction("createSparkLineCellGroup")(e,e.parent,e.attribute.x,e.attribute.y,i,n,e.attribute.width,e.attribute.height,r,t.table,RT(o,t.table,i,n,AR).theme,!1)}else if("image"===p||"video"===p)DR(e,i,n,0,0,t.table);else if("axis"===(null===(d=e.firstChild)||void 0===d?void 0:d.name))null===(c=e.firstChild)||void 0===c||c.originAxis.resize(e.attribute.width,e.attribute.height);else{let s=!0;const a=e.getChildByName(WT)||e.getChildByName(NT);if(a){let o;e.removeChild(a);const r=QR(i,n,e,t.table);if(r)for(let e=r.start.row;e<=r.end.row;e++){if(e===n)continue;const o=t.getCell(i,e),r=o.getChildByName(WT)||o.getChildByName(NT);r.removeAllChild(),o.removeChild(r),QR(i,e,o,t.table)}else{let r,a;const l=t.table.getCellLocation(i,n),{vtableMerge:h}=t.table.getCellRawRecord(i,n)||{};if(h&&t.table.options.groupTitleCustomLayout)a=t.table.options.groupTitleCustomLayout;else if("body"!==l){const e=t.table.getHeaderDefine(i,n);r=null==e?void 0:e.headerCustomRender,a=null==e?void 0:e.headerCustomLayout}else{const e=t.table.getBodyColumnDefine(i,n);r=(null==e?void 0:e.customRender)||t.table.customRender,a=null==e?void 0:e.customLayout}if((r||a)&&tk(e))for(let i=e.mergeStartCol;i<=e.mergeEndCol;i++)for(let o=e.mergeStartRow;o<=e.mergeEndRow;o++)o!==n&&t.updateCellContent(i,o);if(a||r){const l=UB(AR("padding",t.table._getCellStyle(i,n),i,n,t.table));let h=e.attribute.width,d=e.attribute.height;tk(e)&&(h=t.table.getColsWidth(e.mergeStartCol,e.mergeEndCol),d=t.table.getRowsHeight(e.mergeStartRow,e.mergeEndRow));const c=GT(a,r,i,n,h,d,!1,t.table.isAutoRowHeight(n),l,tk(e)?{start:{col:e.mergeStartCol,row:e.mergeStartRow},end:{col:e.mergeEndCol,row:e.mergeEndRow}}:void 0,t.table);o=c.elementsGroup,s=c.renderDefault}e.childrenCount>0&&o?e.insertBefore(o,e.firstChild):o&&e.appendChild(o)}}Sk(e,o,r,t.table.isAutoRowHeight(n),s,t.table)}}(t,e,i,n,o,r)}function Sk(t,e,i,n,o,r){if(tk(t)){e=0;for(let i=t.mergeStartRow;i<=t.mergeEndRow;i++)e+=r.getRowHeight(i);const{colStart:i,colEnd:s,rowStart:a,rowEnd:l}=wk(t,r.scenegraph);for(let h=i;h<=s;h++)for(let s=a;s<=l;s++){const l=r.scenegraph.getCell(h,s);if("cell"!==l.role)continue;if(l.forEachChildren((t=>{t.setAttributes({dx:0,dy:0})})),o){const t=r._getCellStyle(i,a);HR(l,e,0,n,UB(AR("padding",t,h,s,r)),t.textAlign,t.textBaseline,r)}const d=r.getRowHeight(s),c=r.getColWidth(h);l.contentHeight=e;const{widthChange:u}=JR(l,c,d,{start:{col:t.mergeStartCol,row:t.mergeStartRow},end:{col:t.mergeEndCol,row:t.mergeEndRow}},r);u&&(l.needUpdateWidth=!0)}}else{const i=r._getCellStyle(t.col,t.row);HR(t,e,0,n,UB(AR("padding",i,t.col,t.row,r)),i.textAlign,i.textBaseline,r)}}function Ak(t,e,i,n){var o,r,s,a,l,h,d;let c=!1;const u=null!==(o=null==t?void 0:t.attribute.width)&&void 0!==o?o:0;if(null==t||t.setAttribute("width",u+e),null==t||t.forEachChildren(((t,o)=>{if(function(t,e,i,n,o,r,s,a,l){var h,d,c,u,g,p,f;if(e.attribute.width===r&&!e.needUpdateWidth)return!1;e.needUpdateWidth=!1,e.setAttribute("width",r);const v=e;if(!v)return!1;const b=t.table.isAutoRowHeight(n),m=null===(h=t.table.getCellRawRecord(i,n))||void 0===h?void 0:h.vtableMerge,y=!!t.table.getCustomMerge(i,n),C=m||y?"text":t.table.isHeader(i,n)?null!==(d=t.table._getHeaderLayoutMap(i,n).headerType)&&void 0!==d?d:"text":null!==(c=t.table.getBodyColumnType(i,n))&&void 0!==c?c:"text";let w=!1;if("progressbar"===C){const e=t.table.getBodyColumnDefine(i,n),o=t.table._getCellStyle(i,n),a=t.table.getCellValue(i,n),l=t.table.getCellOriginValue(i,n),h=UB(AR("padding",o,i,n,t.table));let d;(null==e?void 0:e.mergeCell)&&(d=t.table.getCellRange(i,n));const c=J_.getFunction("createProgressBarCell")(e,o,v.attribute.width,a,l,i,n,h,t.table,d),u=v.getChildByName("progress-bar");v.insertBefore(c,u),v.removeChild(u),u.removeAllChild(),u.release();const g=Bk(v,r,s,b,!0,t.table);w=w||g}else if("sparkline"===C){v.removeAllChild();const e=t.table._getCellStyle(i,n),o=UB(AR("padding",e,i,n,t.table));J_.getFunction("createSparkLineCellGroup")(v,v.parent,v.attribute.x,v.attribute.y,i,n,v.attribute.width,v.attribute.height,o,t.table,RT(e,t.table,i,n,AR).theme,!1)}else if("image"===C||"video"===C)DR(v,i,n,s,0,t.table);else if("axis"===(null===(u=v.firstChild)||void 0===u?void 0:u.name)){const e=t.table.internalProps.layoutMap.getAxisConfigInPivotChart(i,n),o=UB(AR("padding",t.table._getCellStyle(i,n),i,n,t.table));if(e){const i=new(J_.getComponent("axis"))(e,v.attribute.width,v.attribute.height,null!==(g=e.__vtablePadding)&&void 0!==g?g:o,t.table);v.clear(),v.appendChild(i.component),i.overlap()}}else if("axis"===(null===(p=e.firstChild)||void 0===p?void 0:p.name))null===(f=e.firstChild)||void 0===f||f.originAxis.resize(e.attribute.width,e.attribute.height);else{let o=!0;const a=e.getChildByName(WT)||e.getChildByName(NT);if(a){let r;e.removeChild(a);const s=QR(i,n,e,t.table);if(s)for(let e=s.start.col;e<=s.end.col;e++){if(e===i)continue;const o=t.getCell(e,n),r=o.getChildByName(WT)||o.getChildByName(NT);r.removeAllChild(),o.removeChild(r),QR(e,n,o,t.table)}else{let s,a;const l=t.table.getCellLocation(i,n),{vtableMerge:h}=t.table.getCellRawRecord(i,n)||{};if(h&&t.table.options.groupTitleCustomLayout)a=t.table.options.groupTitleCustomLayout;else if("body"!==l){const e=t.table.getHeaderDefine(i,n);s=null==e?void 0:e.headerCustomRender,a=null==e?void 0:e.headerCustomLayout}else{const e=t.table.getBodyColumnDefine(i,n);s=(null==e?void 0:e.customRender)||t.table.customRender,a=null==e?void 0:e.customLayout}if((s||a)&&tk(v))for(let e=v.mergeStartCol;e<=v.mergeEndCol;e++)if(e!==i)for(let i=v.mergeStartRow;i<=v.mergeEndRow;i++)t.updateCellContent(e,i);if(a||s){const e=UB(AR("padding",t.table._getCellStyle(i,n),i,n,t.table));let l=v.attribute.width,h=v.attribute.height;tk(v)&&(l=t.table.getColsWidth(v.mergeStartCol,v.mergeEndCol),h=t.table.getRowsHeight(v.mergeStartRow,v.mergeEndRow));const d=GT(a,s,i,n,l,h,!1,t.table.isAutoRowHeight(n),e,tk(v)?{start:{col:v.mergeStartCol,row:v.mergeStartRow},end:{col:v.mergeEndCol,row:v.mergeEndRow}}:void 0,t.table);r=d.elementsGroup,o=d.renderDefault,w=!0}e.childrenCount>0&&r?e.insertBefore(r,e.firstChild):r&&e.appendChild(r)}}const l=Bk(v,r,s,b,o,t.table);w=w||l}l||(l=t.table._getCellStyle(i,n).autoWrapText);return!(!b||!l)&&w}(n,t,t.col,t.row,0,u+e,e,"row-body"!==i||(t.col,n.table.rowHeaderLevelCount),n.table.internalProps.autoWrapText)){const e=Z_(n.table,t.col,t.row);if(e&&e.end.row-e.start.row)for(let t=e.start.row;t<=e.end.row;t++)Tk(n,t);else Tk(n,t.row);c=!0}})),c){let t,e,o,c=0;for(let u=0;u<n.table.colCount;u++){if("col-corner"===i?(o=0,t=n.getColGroup(u,!0),e=null!==(r=n.colHeaderGroup.attribute.height)&&void 0!==r?r:0):"row-body"===i?(o=n.table.frozenRowCount,t=n.getColGroup(u,!1),e=null!==(s=n.bodyGroup.attribute.height)&&void 0!==s?s:0):"bottom"===i?(o=n.table.rowCount-n.table.bottomFrozenRowCount,t=n.getColGroupInBottom(u),e=null!==(a=n.bottomFrozenGroup.attribute.height)&&void 0!==a?a:0):"left-bottom"===i?(o=n.table.rowCount-n.table.bottomFrozenRowCount,t=n.getColGroupInLeftBottomCorner(u),e=null!==(l=n.leftBottomCornerGroup.attribute.height)&&void 0!==l?l:0):"right-top"===i?(o=0,t=n.getColGroupInRightTopCorner(u),e=null!==(h=n.rightTopCornerGroup.attribute.height)&&void 0!==h?h:0):"right-bottom"===i&&(o=n.table.rowCount-n.table.bottomFrozenRowCount,t=n.getColGroupInRightBottomCorner(u),e=null!==(d=n.rightBottomCornerGroup.attribute.height)&&void 0!==d?d:0),!t)continue;let g=0;t.forEachChildren((t=>{var e;t.setAttribute("y",g),g+=null!==(e=n.table.getRowHeight(t.row))&&void 0!==e?e:0})),c=g}n.updateContainerHeight(o,c-e);for(let t=0;t<n.table.frozenColCount;t++){const e=n.getColGroupInLeftBottomCorner(t);let i=0;null==e||e.forEachChildren((t=>{t.setAttribute("y",i),i+=n.table.getRowHeight(t.row)}))}for(let t=n.table.colCount-n.table.rightFrozenColCount;t<n.table.colCount;t++){const e=n.getColGroupInRightBottomCorner(t);let i=0;null==e||e.forEachChildren((t=>{t.setAttribute("y",i),i+=n.table.getRowHeight(t.row)}))}for(let t=n.table.frozenColCount;t<n.table.colCount-n.table.rightFrozenColCount;t++){const e=n.getColGroupInBottom(t);let i=0;null==e||e.forEachChildren((t=>{t.setAttribute("y",i),i+=n.table.getRowHeight(t.row)}))}}}function Bk(t,e,i,n,o,r){if(tk(t)){e=0;let s=!1;for(let i=t.mergeStartCol;i<=t.mergeEndCol;i++)e+=r.getColWidth(i);let a=0;for(let e=t.mergeStartRow;e<=t.mergeEndRow;e++)a+=r.getRowHeight(e);const{colStart:l,colEnd:h,rowStart:d,rowEnd:c}=wk(t,r.scenegraph);for(let u=l;u<=h;u++)for(let h=d;h<=c;h++){if(u===t.col&&h!==t.row)continue;const c=r.scenegraph.getCell(u,h);if("cell"!==c.role)continue;c.forEachChildren((t=>{t.setAttributes({dx:0,dy:0})}));let g=!1;if(o){const t=r._getCellStyle(l,d);g=ER(c,e,a,i,n,UB(AR("padding",t,u,h,r)),t.textAlign,t.textBaseline,r.scenegraph);const o=kR(c.col,c.row,r);if(o){const t=c.getChildByName("text"),e=c.getChildByName("expand")||c.getChildByName("collapse");"icon-left"!==(null==e?void 0:e.role)&&t&&t.setAttribute("dx",o)}}const p=r.getRowHeight(h),f=r.getColWidth(u);c.contentWidth=e;const{heightChange:v}=JR(c,f,p,{start:{col:t.mergeStartCol,row:t.mergeStartRow},end:{col:t.mergeEndCol,row:t.mergeEndRow}},r);v&&(c.needUpdateHeight=!0),s=s||g}return s}const s=r._getCellStyle(t.col,t.row),a=UB(AR("padding",s,t.col,t.row,r)),l=s.textAlign,h=s.textBaseline;return ER(t,e,r.getRowHeight(t.row),i,n,a,l,h,r.scenegraph)}function Tk(t,e){const i=Math.round(fk(e,0,t.table.colCount-1,t.table));t.table._setRowHeight(e,i,!0);for(let n=0;n<t.table.colCount;n++){const o=i,r=t.highPerformanceGetCell(n,e);"empty"!==r.role&&_k(t,r,n,e,o,o-r.attribute.height,t.table.isHeader(n,e))}}var Rk;!function(t){t.dropDown="dropDown",t.contextmenu="contextmenu",t.custom="custom"}(Rk||(Rk={}));const kk=12,Mk="Arial,sans-serif",Lk="#000",Pk="#2E68CF",Ek="#EEE",Hk=30,Ok="#FFF",Ik=4,Fk=.5,zk="#CCC",Dk=6,Wk=9,Nk=200;const Gk=wR();class jk{constructor(){const t=Gk.drillDown;this.icon=new LT({x:-1e3,y:-1e3,image:t.svg,width:t.width,height:t.height,dx:-t.width/2,dy:-t.height/2,visible:!1,funcType:t.funcType,cursor:t.cursor}),this.icon.role="icon-drill"}appand(t){t.appendChild(this.icon)}update(t,e,i,n,o,r){if(!t||n&&o)return this.icon.setAttributes({x:-1e3,y:-1e3,visible:!1}),void r.updateNextFrame();const s=Gk.drillDown,a=Gk.drillUp;this.icon.setAttributes({x:e,y:i,image:n?s.svg:a.svg,visible:!0}),this.icon.loadImage(this.icon.attribute.image),r.updateNextFrame()}}class Vk{constructor(t){const e=t.theme.dragHeaderSplitLine.lineWidth,i=t.theme.dragHeaderSplitLine.lineColor,n=t.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel=Vl({visible:!1,pickable:!1,x:0,y:0,symbolType:"triangle",fill:i}),this.columnMoverLine=$l({visible:!1,pickable:!1,stroke:i,lineWidth:e,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnMoverBack=ql({visible:!1,pickable:!1,fill:n,x:0,y:0,width:0,height:0}),this.table=t}appand(t){t.appendChild(this.columnMoverLabel),t.appendChild(this.columnMoverLine),t.appendChild(this.columnMoverBack)}show(t,e,i){const n=this.table.getCellLocation(t,e),o=Z_(this.table,t,e);o&&(t=o.start.col,e=o.start.row);let r=0,s=0,a=0,l=0,h=0,d=0,c=0,u=0,g=Math.PI;const p=[];return"columnHeader"===n?(r=this.table.getColsWidth(0,t-1)-this.table.stateManager.scroll.horizontalBarPos,s=this.table.getRowsHeight(0,this.table.frozenRowCount-1),l=this.table.tableNoFrameHeight,a=o?this.table.getColsWidth(o.start.col,o.end.col):this.table.getColWidth(t),h=r-i,c=r+a,u=2,p.push({x:0,y:0}),p.push({x:0,y:this.table.tableNoFrameHeight})):("rowHeader"===n||this.table.internalProps.layoutMap.isSeriesNumberInBody(t,e))&&(s=this.table.getRowsHeight(0,e-1)-this.table.stateManager.scroll.verticalBarPos,r=this.table.getColsWidth(0,this.table.frozenColCount-1),a=this.table.tableNoFrameWidth,l=o?this.table.getRowsHeight(o.start.row,o.end.row):this.table.getRowHeight(e),d=s-i,c=2,u=s+l,g=Math.PI/2,p.push({x:0,y:0}),p.push({x:this.table.tableNoFrameWidth,y:0})),this.columnMoverBack.setAttributes({visible:!0,x:r-h,y:s-d,width:a,height:l,dx:h,dy:d}),this.columnMoverLine.setAttributes({x:c,y:u,visible:!0,points:p}),this.columnMoverLabel.setAttributes({visible:!0,x:c,y:u,angle:g}),{backX:r-h,lineX:c,backY:s-d,lineY:u}}hide(){this.columnMoverLabel.setAttribute("visible",!1),this.columnMoverLine.setAttribute("visible",!1),this.columnMoverBack.setAttribute("visible",!1)}update(t,e,i,n){"number"==typeof t&&"number"==typeof e?(this.columnMoverLabel.setAttribute("x",e),this.columnMoverLine.setAttribute("x",e),this.columnMoverBack.setAttribute("x",t)):"number"==typeof i&&"number"==typeof n&&(this.columnMoverLabel.setAttribute("y",n),this.columnMoverLine.setAttribute("y",n),this.columnMoverBack.setAttribute("y",i))}updateStyle(){const t=this.table.theme.dragHeaderSplitLine.lineWidth,e=this.table.theme.dragHeaderSplitLine.lineColor,i=this.table.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel.setAttributes({fill:e}),this.columnMoverLine.setAttributes({stroke:e,lineWidth:t}),this.columnMoverBack.setAttributes({fill:i})}}function Uk(t,e,i){if(i)return Math.min(e.tableNoFrameWidth,e.getAllColsWidth())-e.getColsWidth(t,e.colCount-1);let n=e.getColsWidth(0,t);return t>=e.frozenColCount&&(n-=e.scrollLeft),n}function Xk(t,e,i){if(i)return Math.min(e.tableNoFrameWidth,e.getAllRowsHeight())-e.getRowsHeight(t,e.rowCount-1);let n=e.getRowsHeight(0,t);return t>=e.frozenRowCount&&(n-=e.scrollTop),n}class $k{constructor(t){var e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y;this.table=t;const C=this.table.theme;this.createScrollBar();const w=null===(e=C.columnResize)||void 0===e?void 0:e.lineColor,x=null===(i=C.columnResize)||void 0===i?void 0:i.lineWidth,_=null===(n=C.columnResize)||void 0===n?void 0:n.bgColor,S=null===(o=C.columnResize)||void 0===o?void 0:o.width,A=null===(s=null===(r=C.columnResize)||void 0===r?void 0:r.labelVisible)||void 0===s||s,B=null===(a=C.columnResize)||void 0===a?void 0:a.labelColor,T=null===(l=C.columnResize)||void 0===l?void 0:l.labelFontSize,R=null===(h=C.columnResize)||void 0===h?void 0:h.labelFontFamily,k=null===(d=C.columnResize)||void 0===d?void 0:d.labelBackgroundFill,M=null===(c=C.columnResize)||void 0===c?void 0:c.labelBackgroundCornerRadius;this.labelVisible=A,this.columnResizeLine=$l({visible:!1,pickable:!1,stroke:w,lineWidth:x,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnResizeBgLine=$l({visible:!1,pickable:!1,stroke:_,lineWidth:S,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const L=zl({visible:!1,pickable:!1,x:0,y:0,fontSize:T,fill:B,fontFamily:R,text:"",textBaseline:"top",dx:16,dy:-T/2}),P=ql({visible:!1,pickable:!1,fill:k,x:0,y:0,width:5*T*.8,height:T+8,cornerRadius:M,dx:12,dy:-T/2-4});this.columnResizeLabel=Ha({visible:!1,pickable:!1,x:0,y:0}),this.columnResizeLabel.appendChild(P),this.columnResizeLabel.appendChild(L),this.rowResizeLine=$l({visible:!1,pickable:!1,stroke:w,lineWidth:x,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.rowResizeBgLine=$l({visible:!1,pickable:!1,stroke:_,lineWidth:S,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const E=zl({visible:!1,pickable:!1,x:0,y:0,fontSize:T,fill:B,fontFamily:R,text:"",textBaseline:"top",dx:16,dy:-T/2}),H=ql({visible:!1,pickable:!1,fill:k,x:0,y:0,width:5*T*.8,height:T+8,cornerRadius:M,dx:12,dy:-T/2-4});this.rowResizeLabel=Ha({visible:!1,pickable:!1,x:0,y:0}),this.rowResizeLabel.appendChild(H),this.rowResizeLabel.appendChild(E),this.cellMover=new Vk(this.table);const O=null===(g=null===(u=C.frozenColumnLine)||void 0===u?void 0:u.shadow)||void 0===g?void 0:g.width,I=null===(f=null===(p=C.frozenColumnLine)||void 0===p?void 0:p.shadow)||void 0===f?void 0:f.startColor,F=null===(b=null===(v=C.frozenColumnLine)||void 0===v?void 0:v.shadow)||void 0===b?void 0:b.endColor,z=null===(y=null===(m=C.frozenColumnLine)||void 0===m?void 0:m.shadow)||void 0===y?void 0:y.visible;this.frozenShadowLine=ql({visible:"always"===z,pickable:!1,x:0,y:0,width:O,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:I,offset:0},{color:F,offset:1}]}}),this.rightFrozenShadowLine=ql({visible:"always"===z,pickable:!1,x:0,y:0,width:O,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:F,offset:0},{color:I,offset:1}]}}),this.menu=new class{constructor(t){this._table=t,this._menuInstance=new xR({x:0,y:0,fill:Ok,stroke:zk,cornerRadius:Ik,lineWidth:Fk}),this._menuInfo={x:-1,y:-1,col:-1,row:-1,type:Rk.dropDown,menuInfo:[],highlightIndex:-1}}bindTableComponent(t){t.appendChild(this._menuInstance),this.bindEvent()}release(){}attach(t,e,i,n,o,r){if(o===Rk.dropDown&&this.checkDropDownMenuChange(i,n)){const t=this.getMenuInfo(i,n,o);if(!t)return;const{menuInfo:e,highlightIndex:r}=t;this.updateMenuInfo(i,n,o,e,r),this.updateMenuInstance(e,r)}else if(o===Rk.contextmenu&&this.checkContextMenuChange(t,e)){const t=this.getMenuInfo(i,n,o);if(!t)return;const{menuInfo:e,highlightIndex:r}=t;this.updateMenuInfo(i,n,o,e,r),this.updateMenuInstance(e,r)}this.updatePosition(t-this._table.scenegraph.x,e-this._table.scenegraph.y),this.addToScene()}updateMenuInfo(t,e,i,n,o){this._menuInfo.col=t,this._menuInfo.row=e,this._menuInfo.type=i,this._menuInfo.menuInfo=n,this._menuInfo.highlightIndex=o}checkDropDownMenuChange(t,e){const{type:i,col:n,row:o}=this._menuInfo;return i!==Rk.dropDown||t!==n||e!==o}checkContextMenuChange(t,e){var i;const{type:n,menuInfo:o}=this._menuInfo;return n!==Rk.contextmenu||o!==(null===(i=this._table.internalProps.menu)||void 0===i?void 0:i.contextMenuItems)}updateMenuInstance(t,e){this._menuInstance.removeAllChild();let i=Dk;const n=Dk;let o=0;t.forEach(((t,r)=>{var s,a;const l=e===r;let h,d;"string"==typeof t?d=t:"object"==typeof t&&(d=t.text,h=l?t.selectedIcon:t.icon);const c=new xR({y:i,x:n,height:Hk,fill:Ok});c.role="menu-item",this._menuInstance.appendChild(c),c.stateProxy=t=>"hover"===t?{fill:Ek}:{fill:Ok},c.addEventListener("pointerenter",(t=>{c.addState("hover",!0,!1),this._table.scenegraph.updateNextFrame()})),c.addEventListener("pointerleave",(t=>{c.removeState("hover",!1),this._table.scenegraph.updateNextFrame()}));const u=new Fl({x:Wk,y:Wk,fill:l?Pk:Lk,text:d,textBaseline:"top",fontSize:kk,fontFamily:Mk,pickable:!1,maxLineWidth:Nk,ellipsis:"…"});if(c.addChild(u),h){u.AABBBounds.height();const t=null!==(s=h.width)&&void 0!==s?s:16,e=null!==(a=h.height)&&void 0!==a?a:16,i=new LT({x:Wk,y:(Hk-e)/2,width:t,height:e,image:h.svg,pickable:!1});i.role="menu-icon",c.insertBefore(i,u),u.setAttribute("x",t+Wk)}o=Math.max(c.AABBBounds.width(),o),i+=Hk})),this._menuInstance.setAttributes({width:o+2*Wk+2*Dk,height:i+Dk}),this._menuInstance.forEachChildren((t=>{t.setAttribute("width",o+2*Wk)}))}updatePosition(t,e){this._menuInstance.setAttributes({x:this._menuInfo.type===Rk.dropDown?t-this._menuInstance.attribute.width:t,y:e}),this._menuInfo.x=Rk.dropDown?t-this._menuInstance.attribute.width:t,this._menuInfo.y=e}addToScene(){this._table.scenegraph.updateNextFrame()}detach(){this._menuInstance.setAttributes({x:-1e3,y:-1e3}),this._table.scenegraph.updateNextFrame()}getMenuInfo(t,e,i){var n;if(i===Rk.dropDown){let i=this._table.globalDropDownMenu;i=this._table._getHeaderLayoutMap(t,e).dropDownMenu,"function"==typeof i&&(i=i({row:e,col:t,table:this._table}));let n=-1;if(Array.isArray(i))for(let o=0;o<i.length;o++)if(this._table._dropDownMenuIsHighlight(t,e,o)){n=o;break}return{menuInfo:i,highlightIndex:n}}if(i===Rk.contextmenu){const i=null===(n=this._table.internalProps.menu)||void 0===n?void 0:n.contextMenuItems;let o;if(Array.isArray(i))o=i;else if("function"==typeof i){const{field:n}=this._table.isHeader(t,e)?this._table.getHeaderDefine(t,e):this._table.getBodyColumnDefine(t,e);o=i(n,e,t)}return{menuInfo:o,highlightIndex:-1}}}bindEvent(){this._menuInstance.addEventListener("click",(t=>{const{target:e}=t;if(e&&"menu-item"===e.role){const i=this.getEventInfo(e),n=this._table.getMenuInfo(this._menuInfo.col,this._menuInfo.row,this._menuInfo.type),o=Object.assign(i,n);o.event=t.nativeEvent,this._table.fireListeners(v_.DROPDOWN_MENU_CLICK,o)}}))}getEventInfo(t){const e=t.parent;let i=0;e.forEachChildren(((e,n)=>e===t&&(i=n-1,!0)));const n="string"==typeof this._menuInfo.menuInfo[i]?this._menuInfo.menuInfo[i]:this._menuInfo.menuInfo[i].text,o="string"==typeof this._menuInfo.menuInfo[i]?n:this._menuInfo.menuInfo[i].menuKey||n;return{col:this._menuInfo.col,row:this._menuInfo.row,dropDownIndex:i,highlight:i===this._menuInfo.highlightIndex,text:n,menuKey:o}}get bounds(){return this._menuInstance.globalAABBBounds}}(this.table),this.drillIcon=new jk}addToGroup(t){t.addChild(this.frozenShadowLine),t.addChild(this.rightFrozenShadowLine),t.addChild(this.columnResizeBgLine),t.addChild(this.columnResizeLine),t.addChild(this.columnResizeLabel),t.addChild(this.rowResizeBgLine),t.addChild(this.rowResizeLine),t.addChild(this.rowResizeLabel),this.table.theme.scrollStyle.hoverOn&&!this.table.theme.scrollStyle.barToSide?(t.addChild(this.hScrollBar),t.addChild(this.vScrollBar)):(t.stage.defaultLayer.addChild(this.hScrollBar),t.stage.defaultLayer.addChild(this.vScrollBar)),this.menu.bindTableComponent(t),this.drillIcon.appand(t),this.cellMover.appand(t)}createScrollBar(){var t,e,i,n,o,r;const s=this.table.theme,a=null===(t=s.scrollStyle)||void 0===t?void 0:t.scrollRailColor,l=null===(e=s.scrollStyle)||void 0===e?void 0:e.scrollSliderColor,h=null===(i=s.scrollStyle)||void 0===i?void 0:i.scrollSliderCornerRadius,d=null===(n=s.scrollStyle)||void 0===n?void 0:n.width,c=null===(o=s.scrollStyle)||void 0===o?void 0:o.horizontalPadding,u=null===(r=s.scrollStyle)||void 0===r?void 0:r.verticalPadding;let g;g=XC(h)?{cornerRadius:h,fill:l}:{fill:l},this.hScrollBar=new am({direction:"horizontal",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:this.table.tableNoFrameWidth,height:d,padding:c,railStyle:{fill:a},sliderStyle:g,range:[0,.1],visible:!1}),this.hScrollBar.render(),this.hScrollBar.hideAll(),this.vScrollBar=new am({direction:"vertical",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:d,height:this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight(),padding:u,railStyle:{fill:a},sliderStyle:g,range:[0,.1],visible:!1}),this.vScrollBar.render(),this.vScrollBar.hideAll()}updateScrollBar(){var t,e,i,n,o,r,s;const a=this.table.stateManager.scroll.horizontalBarPos,l=this.table.stateManager.scroll.verticalBarPos,h=this.table.theme,d=null===(t=h.scrollStyle)||void 0===t?void 0:t.width,c=null===(e=h.scrollStyle)||void 0===e?void 0:e.visible,u=null!==(n=null===(i=h.scrollStyle)||void 0===i?void 0:i.horizontalVisible)&&void 0!==n?n:c,g=null!==(r=null===(o=h.scrollStyle)||void 0===o?void 0:o.verticalVisible)&&void 0!==r?r:c,p=Math.ceil(this.table.scenegraph.tableGroup.attribute.width),f=Math.ceil(this.table.scenegraph.tableGroup.attribute.height),v=this.table.getAllRowsHeight(),b=this.table.getAllColsWidth(),m=this.table.getFrozenRowsHeight(),y=this.table.getFrozenColsWidth(),C=this.table.getBottomFrozenRowsHeight(),w=this.table.getRightFrozenColsWidth(),x=(null===(s=this.table.options.customConfig)||void 0===s?void 0:s._disableColumnAndRowSizeRound)?1:0;if(b>p+x){const t=Math.min(f,v),e=Math.max(.05,(p-y)/(b-y)),i=this.table.theme.scrollStyle.hoverOn;let n=0;n=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameHeight-(i?d:-this.table.scenegraph.tableGroup.attribute.y)+this.table.tableY:t-(i?d:-this.table.scenegraph.tableGroup.attribute.y),this.hScrollBar.setAttributes({x:y+(i?0:this.table.scenegraph.tableGroup.attribute.x),y:n,width:p-y-w,range:[0,e],visible:"always"===u});const o=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:o.x1,y:o.y1},"always"===u&&this.hScrollBar.showAll()}else this.hScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:0,visible:!1});if(v>f+x){const t=Math.min(p,b),e=Math.max(.05,(f-m)/(v-m));let i=0;const n=this.table.theme.scrollStyle.hoverOn;i=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameWidth-(n?d:-this.table.scenegraph.tableGroup.attribute.x)+this.table.tableX:t-(n?d:-this.table.scenegraph.tableGroup.attribute.x),this.vScrollBar.setAttributes({x:i,y:m+(n?0:this.table.scenegraph.tableGroup.attribute.y),height:f-m-C,range:[0,e],visible:"always"===g});const o=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:o.x1,y:o.y1},"always"===g&&this.vScrollBar.showAll()}else this.vScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,height:0,visible:!1});this.table.stateManager.setScrollLeft(a),this.table.stateManager.setScrollTop(l)}hideResizeCol(){this.columnResizeLine.setAttribute("visible",!1),this.columnResizeBgLine.setAttribute("visible",!1),this.columnResizeLabel.setAttribute("visible",!1),this.columnResizeLabel.hideAll()}showResizeCol(t,e,i){const n=Uk(t,this.table,i);this.columnResizeLine.setAttributes({visible:!0,x:n,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({visible:!0,x:n,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.labelVisible&&(this.columnResizeLabel.showAll(),this.columnResizeLabel.setAttributes({visible:!0,x:n,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${this.table.getColWidth(t)}px`))}updateResizeCol(t,e,i){const n=Uk(t,this.table,i);this.columnResizeLine.setAttributes({x:n,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({x:n,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.labelVisible&&(this.columnResizeLabel.setAttributes({x:n,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getColWidth(t))}px`))}hideResizeRow(){this.rowResizeLine.setAttribute("visible",!1),this.rowResizeBgLine.setAttribute("visible",!1),this.rowResizeLabel.setAttribute("visible",!1),this.rowResizeLabel.hideAll()}showResizeRow(t,e,i){const n=Xk(t,this.table,i);this.rowResizeLine.setAttributes({visible:!0,y:n,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({visible:!0,y:n,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.labelVisible&&(this.rowResizeLabel.showAll(),this.rowResizeLabel.setAttributes({visible:!0,y:n,x:e}),this.rowResizeLabel.lastChild.setAttribute("text",`${this.table.getRowHeight(t)}px`))}updateResizeRow(t,e,i){const n=Xk(t,this.table,i);this.rowResizeLine.setAttributes({y:n,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({y:n,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.labelVisible&&(this.rowResizeLabel.setAttributes({y:n,x:e}),this.rowResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getRowHeight(t))}px`))}hideMoveCol(){this.cellMover.hide()}showMoveCol(t,e,i){return this.cellMover.show(t,e,i)}updateMoveCol(t,e,i,n){this.cellMover.update(t,e,i,n)}setFrozenColumnShadow(t,e){var i,n;const o=Uk(t,this.table,e);t<0||"always"!==(null===(n=null===(i=this.table.theme.frozenColumnLine)||void 0===i?void 0:i.shadow)||void 0===n?void 0:n.visible)?this.frozenShadowLine.setAttributes({visible:!1,x:o,height:this.table.getDrawRange().height}):this.frozenShadowLine.setAttributes({visible:!0,x:o,height:this.table.getDrawRange().height})}setRightFrozenColumnShadow(t){var e,i;const n=Uk(t,this.table,!0);t>=this.table.colCount||"always"!==(null===(i=null===(e=this.table.theme.frozenColumnLine)||void 0===e?void 0:e.shadow)||void 0===i?void 0:i.visible)?this.rightFrozenShadowLine.setAttributes({visible:!1,x:n-this.rightFrozenShadowLine.attribute.width,height:this.table.getDrawRange().height}):this.rightFrozenShadowLine.setAttributes({visible:!0,x:n-this.rightFrozenShadowLine.attribute.width,height:this.table.getDrawRange().height})}hideFrozenColumnShadow(){var t,e,i,n,o;const r=null===(e=null===(t=this.table.theme.frozenColumnLine)||void 0===t?void 0:t.shadow)||void 0===e?void 0:e.visible;"scrolling"===(null!==(o=null===(n=null===(i=this.table.theme.frozenColumnLine)||void 0===i?void 0:i.shadow)||void 0===n?void 0:n.visible)&&void 0!==o?o:r)&&(this.frozenShadowLine.setAttribute("visible",!1),this.rightFrozenShadowLine.setAttribute("visible",!1),this.table.scenegraph.updateNextFrame())}showFrozenColumnShadow(){var t,e,i,n,o;const r=null===(e=null===(t=this.table.theme.frozenColumnLine)||void 0===t?void 0:t.shadow)||void 0===e?void 0:e.visible;"scrolling"===(null!==(o=null===(n=null===(i=this.table.theme.frozenColumnLine)||void 0===i?void 0:i.shadow)||void 0===n?void 0:n.visible)&&void 0!==o?o:r)&&(this.frozenShadowLine.setAttribute("visible",!0),this.rightFrozenShadowLine.setAttribute("visible",!0),this.table.scenegraph.updateNextFrame())}hideVerticalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=null!==(t=this.table.theme.scrollStyle.verticalVisible)&&void 0!==t?t:e;"focus"!==i&&"scrolling"!==i||(this.vScrollBar.setAttribute("visible",!1),this.vScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showVerticalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=null!==(t=this.table.theme.scrollStyle.verticalVisible)&&void 0!==t?t:e;"focus"!==i&&"scrolling"!==i||(this.vScrollBar.setAttribute("visible",!0),this.vScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}hideHorizontalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=null!==(t=this.table.theme.scrollStyle.horizontalVisible)&&void 0!==t?t:e;"focus"!==i&&"scrolling"!==i||(this.hScrollBar.setAttribute("visible",!1),this.hScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showHorizontalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=null!==(t=this.table.theme.scrollStyle.horizontalVisible)&&void 0!==t?t:e;"focus"!==i&&"scrolling"!==i||(this.hScrollBar.setAttribute("visible",!0),this.hScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}updateVerticalScrollBarPos(t){const e=this.vScrollBar.attribute.range,i=e[1]-e[0],n=t*(1-i);this.vScrollBar.setAttribute("range",[n,n+i]);const o=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:o.x1,y:o.y1}}updateHorizontalScrollBarPos(t){const e=this.hScrollBar.attribute.range,i=e[1]-e[0],n=t*(1-i);this.hScrollBar.setAttribute("range",[n,n+i]);const o=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:o.x1,y:o.y1}}updateStyle(){var t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x;const _=this.table.theme,S=null===(t=_.scrollStyle)||void 0===t?void 0:t.scrollRailColor,A=null===(e=_.scrollStyle)||void 0===e?void 0:e.scrollSliderColor,B=null===(i=_.scrollStyle)||void 0===i?void 0:i.scrollSliderCornerRadius,T=null===(n=_.scrollStyle)||void 0===n?void 0:n.width,R=null===(o=_.scrollStyle)||void 0===o?void 0:o.horizontalPadding,k=null===(r=_.scrollStyle)||void 0===r?void 0:r.verticalPadding;let M;M=XC(B)?{cornerRadius:B,fill:A}:{fill:A},this.hScrollBar.setAttributes({height:T,padding:R,railStyle:{fill:S},sliderStyle:M}),this.vScrollBar.setAttributes({width:T,padding:k,railStyle:{fill:S},sliderStyle:M});const L=null===(s=_.columnResize)||void 0===s?void 0:s.lineColor,P=null===(a=_.columnResize)||void 0===a?void 0:a.lineWidth,E=null===(l=_.columnResize)||void 0===l?void 0:l.bgColor,H=null===(h=_.columnResize)||void 0===h?void 0:h.width;this.columnResizeLine.setAttributes({stroke:L,lineWidth:P}),this.columnResizeBgLine=$l({stroke:E,lineWidth:H});const O=null===(d=_.columnResize)||void 0===d?void 0:d.labelColor,I=null===(c=_.columnResize)||void 0===c?void 0:c.labelFontSize,F=null===(u=_.columnResize)||void 0===u?void 0:u.labelFontFamily,z=null===(g=_.columnResize)||void 0===g?void 0:g.labelBackgroundFill,D=null===(p=_.columnResize)||void 0===p?void 0:p.labelBackgroundCornerRadius,W=null===(v=null===(f=_.columnResize)||void 0===f?void 0:f.labelVisible)||void 0===v||v;this.labelVisible=W,this.columnResizeLabel.lastChild.setAttributes({fontSize:I,fill:O,fontFamily:F,dy:-I/2}),this.columnResizeLabel.firstChild.setAttributes({fill:z,width:5*I*.8,height:I+8,cornerRadius:D,dy:-I/2-4}),this.rowResizeLabel.lastChild.setAttributes({fontSize:I,fill:O,fontFamily:F,dy:-I/2}),this.rowResizeLabel.firstChild.setAttributes({fill:z,width:5*I*.8,height:I+8,cornerRadius:D,dy:-I/2-4});const N=null===(m=null===(b=_.frozenColumnLine)||void 0===b?void 0:b.shadow)||void 0===m?void 0:m.width,G=null===(C=null===(y=_.frozenColumnLine)||void 0===y?void 0:y.shadow)||void 0===C?void 0:C.startColor,j=null===(x=null===(w=_.frozenColumnLine)||void 0===w?void 0:w.shadow)||void 0===x?void 0:x.endColor;this.frozenShadowLine.setAttributes({width:N,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:G,offset:0},{color:j,offset:1}]}}),this.rightFrozenShadowLine.setAttributes({width:N,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:j,offset:0},{color:G,offset:1}]}}),this.cellMover.updateStyle()}}function Yk(t,e,i,n,o){var r,s,a,l,h,d;if(!e)return;const c="table"===i,{shadowBlur:u,shadowOffsetX:g,shadowOffsetY:p,shadowColor:f,cornerRadius:v,borderColor:b,borderLineWidth:m,borderLineDash:y}=e;let C=!1;const w={},x={pickable:!1};u&&c&&(x.shadowBlur=u,x.shadowOffsetX=g,x.shadowOffsetY=p,x.shadowColor=f,x.stroke=!0,x.stroke=f,x.lineWidth=1,C=!0),m&&(x.stroke=!0,x.fill=!1,x.stroke=qk(null!=b?b:"#E1E4E8",n,m),x.lineWidth=m,y&&(x.lineDash=y),x.lineCap="butt"),Array.isArray(b)&&(x.strokeArrayColor=UB(b)),Array.isArray(m)&&(x.strokeArrayWidth=UB(m),x.lineWidth=1),v&&(x.cornerRadius=v,w.cornerRadius=v);const _=x.strokeArrayWidth?x.strokeArrayWidth[0]:null!==(r=x.lineWidth)&&void 0!==r?r:0,S=x.strokeArrayWidth?x.strokeArrayWidth[1]:null!==(s=x.lineWidth)&&void 0!==s?s:0,A=x.strokeArrayWidth?x.strokeArrayWidth[2]:null!==(a=x.lineWidth)&&void 0!==a?a:0,B=x.strokeArrayWidth?x.strokeArrayWidth[3]:null!==(l=x.lineWidth)&&void 0!==l?l:0;if(t.setAttributes(w),!o)if(x.stroke)if(x.x=B/2,x.y=_/2,x.pickable=!1,c){if(v)if(Array.isArray(v)){const t=UB(v);x.cornerRadius=t,w.cornerRadius=t,t[0]&&(t[0]=t[0]+Math.min(B,_)/2),t[1]&&(t[1]=t[1]+Math.min(_,S)/2),t[2]&&(t[2]=t[2]+Math.min(S,A)/2),t[3]&&(t[3]=t[3]+Math.min(A,B)/2)}else if(ZC(m)){const t=[];x.cornerRadius=t,w.cornerRadius=t,t[0]=v+Math.min(B,_)/2,t[1]=v+Math.min(_,S)/2,t[2]=v+Math.min(S,A)/2,t[3]=v+Math.min(A,B)/2}else x.cornerRadius=v+(null!==(h=x.lineWidth)&&void 0!==h?h:0)/2,w.cornerRadius=v+(null!==(d=x.lineWidth)&&void 0!==d?d:0)/2;let i,n;if(e.innerBorder?(x.x=t.attribute.x+B/2,x.y=t.attribute.y+_/2,x.width=t.attribute.width-B/2-S/2,x.height=t.attribute.height-_/2-A/2):(x.x=t.attribute.x-B/2,x.y=t.attribute.y-_/2,x.width=t.attribute.width+B/2+S/2,x.height=t.attribute.height+_/2+A/2),C){x.fill="white",x.notAdjustPos=!0,n=Ha(x),n.name="table-border-rect",i=ql({x:B/2,y:_/2,width:t.attribute.width,height:t.attribute.height,fill:"red",cornerRadius:t.attribute.cornerRadius,globalCompositeOperation:"destination-out"}),n.addChild(i);const e=ql({x:B/2,y:_/2,width:t.attribute.width,height:t.attribute.height,fill:"transparent",pickable:!1,globalCompositeOperation:"source-over"});n.addChild(e)}else n=ql(x),n.name="table-border-rect";e.innerBorder&&!C?t.parent.insertAfter(n,t):t.parent.insertBefore(n,t),t.border=n}else{x.width=t.attribute.width-B/2-S/2,x.height=t.attribute.height-_/2-A/2;const e=ql(x);e.name="border-rect",t.addChild(e),t.border=e}else{const e=ql({fill:!1,stroke:!1,pickable:!1,lineWidth:0});e.name="border-rect",t.addChild(e),t.border=e}}function Kk(t,e,i){var n;if(!e)return;const{borderColor:o}=e;null===(n=t.border)||void 0===n||n.setAttribute("stroke",qk(o,i))}function qk(t,e,i){let n=!0;return!e&&!ZC(i)||ZC(t)?e?n=e:e||ZC(t)?ZC(t)&&(n=!0):n=t:n=(null!=e?e:i).map((e=>!!e&&t)),n}function Zk(t){var e,i,n,o;if(!t.border)return;const r=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[0]:null!==(e=t.border.attribute.lineWidth)&&void 0!==e?e:0,s=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[1]:null!==(i=t.border.attribute.lineWidth)&&void 0!==i?i:0,a=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[2]:null!==(n=t.border.attribute.lineWidth)&&void 0!==n?n:0,l=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[3]:null!==(o=t.border.attribute.lineWidth)&&void 0!==o?o:0;t.border.setAttributes({borderLeft:l,borderTop:r,borderRight:s,borderBottom:a,width:t.attribute.width-l/2-s/2,height:t.attribute.height-r/2-a/2}),"group"===t.border.type&&t.border.firstChild.setAttributes({width:t.attribute.width,height:t.attribute.height})}function Jk(t,e){t.setAttribute("cornerRadius",e),t.border&&t.border.setAttribute("cornerRadius",e)}const Qk=ea();class tM extends Kl{constructor(t,e){if(super(e),this.type="chart",this.numberType=Qk,this.isShareChartSpec=t,e.chartInstance)this.chartInstance=e.chartInstance;else{const t=this.chartInstance=new e.ClassType(e.spec,uw({},this.attribute.tableChartOption,{renderCanvas:e.canvas,mode:"node"===this.attribute.mode?"node":"desktop-browser",modeParams:this.attribute.modeParams,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:e.dpr,interactive:!1,animation:!1,autoFit:!1}));t.renderSync(),t.getStage().enableDirtyBounds(),e.chartInstance=this.chartInstance=t}}activate(t){var e,i,n,o,r;this.active=!0;const{col:s,row:a}=this.parent,{x1:l,y1:h,x2:d,y2:c}=this.getViewBox(),u=function(t,e,i){var n,o,r,s,a,l,h,d;const{layoutMap:c}=i.internalProps,u=new yw,g=i.scenegraph.tableGroup.globalAABBBounds;return u.x1=g.x1,u.x2=g.x2,u.y1=g.y1,u.y2=g.y2,c.isLeftBottomCorner(t,e)||c.isRightTopCorner(t,e)||c.isLeftTopCorner(t,e)||c.isRightBottomCorner(t,e)||(c.isFrozenColumn(t,e)?(u.y1=g.y1+i.getFrozenRowsHeight(),u.y2=g.y2-i.getBottomFrozenRowsHeight()):c.isFrozenRow(t,e)?(u.x1=g.x1+i.getFrozenColsWidth(),u.x2=g.x2-i.getRightFrozenColsWidth()):c.isRightFrozenColumn(t,e)?(u.y1=g.y1+i.getFrozenRowsHeight(),u.y2=g.y2-i.getBottomFrozenRowsHeight()):c.isBottomFrozenRow(t,e)?(u.x1=g.x1+i.getFrozenColsWidth(),u.x2=g.x2-i.getRightFrozenColsWidth()):c.isFrozenColumn(t,e)||c.isRightFrozenColumn(t,e)||(u.x1=g.x1+i.getFrozenColsWidth(),u.x2=g.x2-i.getRightFrozenColsWidth(),u.y1=g.y1+i.getFrozenRowsHeight(),u.y2=g.y2-i.getBottomFrozenRowsHeight())),u.x1=u.x1+(null!==(o=null===(n=i.options.viewBox)||void 0===n?void 0:n.x1)&&void 0!==o?o:0),u.x2=u.x2+(null!==(s=null===(r=i.options.viewBox)||void 0===r?void 0:r.x1)&&void 0!==s?s:0),u.y1=u.y1+(null!==(l=null===(a=i.options.viewBox)||void 0===a?void 0:a.y1)&&void 0!==l?l:0),u.y2=u.y2+(null!==(d=null===(h=i.options.viewBox)||void 0===h?void 0:h.y1)&&void 0!==d?d:0),u}(s,a,t).intersect({x1:l-t.scrollLeft,x2:d-t.scrollLeft,y1:h-t.scrollTop,y2:c-t.scrollTop});null===(e=this.activeChartInstance)||void 0===e||e.release(),this.activeChartInstance=new this.attribute.ClassType(this.attribute.spec,uw({},this.attribute.tableChartOption,{renderCanvas:this.attribute.canvas,mode:"desktop-browser",canvasControled:!1,viewBox:{x1:0,x2:d-l,y1:0,y2:c-h},dpr:t.internalProps.pixelRatio,animation:!1,interactive:!0,autoFit:!1,beforeRender:e=>{const i=this.stage,n=e.window.getContext(),o=i.window.getViewBoxTransform(),r=i.window.getViewBox();n.inuse=!0,n.clearMatrix(),n.setTransform(o.a,o.b,o.c,o.d,o.e,o.f,!0),n.translate(r.x1,r.y1),n.setTransformForCurrent(!0),n.beginPath(),n.rect(u.x1,u.y1,u.x2-u.x1,u.y2-u.y1),n.clip(),n.clearMatrix(),t.options.canvas&&!e.needRender&&(e.pauseRender(),t.scenegraph.stage.dirtyBounds.union(this.globalAABBBounds),t.scenegraph.updateNextFrame())},afterRender(t){t.window.getContext().inuse=!1,t.needRender=!1,g.resumeRender()}}));const g=this.activeChartInstance.getStage(),p=this.globalTransMatrix.clone(),f=this.stage.window.getViewBoxTransform();p.multiply(f.a,f.b,f.c,f.d,f.e,f.f),g.window.setViewBoxTransform&&g.window.setViewBoxTransform(p.a,p.b,p.c,p.d,p.e,p.f),this.activeChartInstance.renderSync(),null===(n=null===(i=t.internalProps.layoutMap)||void 0===i?void 0:i.updateDataStateToActiveChartInstance)||void 0===n||n.call(i,this.activeChartInstance),this.activeChartInstance.on("click",(e=>{var i;!1===(null===(i=this.attribute.spec.select)||void 0===i?void 0:i.enable)?t.scenegraph.updateChartState(null):tM.temp&&t.scenegraph.updateChartState(null==e?void 0:e.datum)})),this.activeChartInstance.on("brushEnd",(e=>{var i;t.scenegraph.updateChartState(null===(i=null==e?void 0:e.value)||void 0===i?void 0:i.inBrushData),tM.temp=0,setTimeout((()=>{tM.temp=1}),0)})),null===(r=(o=t)._bindChartEvent)||void 0===r||r.call(o,this.activeChartInstance)}deactivate(){var t,e;this.active=!1,null===(t=this.activeChartInstance)||void 0===t||t.updateViewBox({x1:-1e3,x2:-800,y1:-1e3,y2:-800},!1,!1),null===(e=this.activeChartInstance)||void 0===e||e.release(),this.activeChartInstance=null}updateData(t){this.attribute.data=t}getViewBox(){var t,e,i,n,o,r,s,a;const l=this.parent,h=this.attribute.cellPadding,d=this.stage.table,{x1:c,y1:u,x2:g,y2:p}=l.globalAABBBounds;return{x1:Math.ceil(c+h[3]+d.scrollLeft+(null!==(e=null===(t=d.options.viewBox)||void 0===t?void 0:t.x1)&&void 0!==e?e:0)),x2:Math.ceil(c+l.attribute.width-h[1]+d.scrollLeft+(null!==(n=null===(i=d.options.viewBox)||void 0===i?void 0:i.x1)&&void 0!==n?n:0)),y1:Math.ceil(u+h[0]+d.scrollTop+(null!==(r=null===(o=d.options.viewBox)||void 0===o?void 0:o.y1)&&void 0!==r?r:0)),y2:Math.ceil(u+l.attribute.height-h[2]+d.scrollTop+(null!==(a=null===(s=d.options.viewBox)||void 0===s?void 0:s.y1)&&void 0!==a?a:0))}}}tM.temp=1;let eM,iM=[],nM=[],oM=5,rM=!1;function sM(t){XC(t)&&(oM=t)}function aM(){iM=[],nM=[],rM=!1,cancelAnimationFrame(eM)}function lM(t){var e,i,n,o,r,s,a;const{axes:l,dataId:h,data:d,spec:c,ClassType:u,canvas:g,mode:p,modeParams:f,dpr:v}=t.attribute;let{chartInstance:b}=t;b||(b=new u(c,{renderCanvas:g,mode:"node"===p?"node":"desktop-browser",modeParams:f,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:v,interactive:!1,animation:!1,autoFit:!1}),b.renderSync(),t.chartInstance=b);const m=t.getViewBox();m.x2<=m.x1&&(m.x2=m.x1+1),m.y2<=m.y1&&(m.y2=m.y1+1),b.updateViewBox({x1:0,x2:m.x2-m.x1,y1:0,y2:m.y2-m.y1},!1,!1);const y=b.getStage(),C=t.globalTransMatrix,w=t.stage.window.getViewBoxTransform().clone();w.multiply(C.a,C.b,C.c,C.d,C.e,C.f),y.window.setViewBoxTransform&&y.window.setViewBoxTransform(w.a,w.b,w.c,w.d,w.e,w.f);const{table:x}=t.getRootNode();let _=!1;if(x.options.specFormat){const i=x.options.specFormat(t.attribute.spec,b,t);if(i.needFormatSpec&&i.spec){const t=i.spec;b.updateSpecSync(t),_=null===(e=i.updateSpec)||void 0===e||e}}if(!_)if(null==l||l.forEach(((t,e)=>{var i,n,o,r,s;"band"===t.type?b.updateModelSpec({type:"axes",index:e},{domain:t.domain.slice(0)},!0):b.updateModelSpecSync({type:"axes",index:e},{min:null!==(n=null===(i=t.range)||void 0===i?void 0:i.min)&&void 0!==n?n:0,max:null!==(r=null===(o=t.range)||void 0===o?void 0:o.max)&&void 0!==r?r:0,tick:{tickMode:null===(s=t.tick)||void 0===s?void 0:s.tickMode}},!0)})),null===(n=null===(i=x.internalProps.layoutMap)||void 0===i?void 0:i.updateDataStateToActiveChartInstance)||void 0===n||n.call(i,b),"string"==typeof h)b.updateDataSync(h,null!=d?d:[]);else{const t=[];for(const e in h){const i=h[e],n=c.series.find((t=>{var i;return(null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.id)===e}));t.push({id:e,values:i?null!==(o=null==d?void 0:d.filter((t=>t.hasOwnProperty(i))))&&void 0!==o?o:[]:null!=d?d:[],fields:null===(r=null==n?void 0:n.data)||void 0===r?void 0:r.fields}),b.updateFullDataSync||b.updateDataSync(e,i?null!==(s=null==d?void 0:d.filter((t=>t.hasOwnProperty(i))))&&void 0!==s?s:[]:null!=d?d:[])}null===(a=b.updateFullDataSync)||void 0===a||a.call(b,t)}x.fireListeners("before_cache_chart_image",{chartInstance:b}),function(t,e){var i;const{viewWidth:n,viewHeight:o}=t;if(n<dM&&o<dM)return e.cacheCanvas=cM(t),void(e.isShareChartSpec||(null===(i=e.chartInstance)||void 0===i||i.release(),e.chartInstance=null,e.setAttribute("chartInstance",null)));const r=Math.ceil(o/dM),s=Math.ceil(n/dM),a=[];for(let e=0;e<r;e++)for(let i=0;i<s;i++){const r=i*dM,s=e*dM,l=r+dM>n?n:r+dM,h=s+dM>o?o:s+dM,d=l-r,c=h-s,u=new yw;u.setValue(r,s,l,h);const g=cM(t,!1,u);a.push({canvas:g,x:r,y:s,width:d,height:c})}e.cacheCanvas=a}(b.getStage(),t)}function hM(t){rM=!0,nM.length>0?eM=requestAnimationFrame((()=>{const e=nM.splice(0,oM);iM.splice(0,oM),e.forEach((t=>{lM(t),t.addUpdateBoundTag()})),t.render(),hM(t)})):rM=!1}const dM=2e3;function cM(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;if("released"===t.releaseStatus)return null;const n=function(t){let e=arguments.length>2?arguments[2]:void 0;const i=t.window.getViewBoxTransform(),n=fo.get(xo),o=e?-e.x1:0,r=e?-e.y1:0,s=e?e.x2:t.viewWidth,a=e?e.y2:t.viewHeight,l=e?e.width():t.viewWidth,h=e?e.height():t.viewHeight;return n.create({viewBox:{x1:o,y1:r,x2:s,y2:a},width:l*i.a,height:h*i.d,dpr:t.window.dpr,canvasControled:!0,offscreen:!0,title:""}),n.setViewBoxTransform(i.a,i.b,i.c,i.d,0,0),t.renderTo(n),n}(t,e,i).getNativeHandler();return n.nativeCanvas?n.nativeCanvas:null}var uM=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};const gM=Symbol.for("ChartRender");let pM=class extends rd{constructor(){super(...arguments),this.numberType=Qk}drawShape(t,e,i,n,o,r,s,a){var l,h,d,c;const u=zo(t,null==r?void 0:r.theme).group,{dataId:g,data:p,spec:f}=t.attribute,{width:v=u.width,height:b=u.height}=(t.getViewBox(),t.attribute),{table:m}=t.getRootNode(),{active:y,cacheCanvas:C,activeChartInstance:w}=t;if(!y&&C)ZC(C)?C.forEach((t=>{const{x:i,y:n,width:o,height:r,canvas:s}=t;e.drawImage(s,i,n,o,r)})):e.drawImage(C,i,n,v,b);else if(w){if(m.options.specFormat){const e=m.options.specFormat(t.attribute.spec,w,t);if(e.needFormatSpec&&e.spec){const t=e.spec;w.updateSpecSync(t)}}const e=t.getViewBox();w.updateViewBox({x1:0,x2:e.x2-e.x1,y1:0,y2:e.y2-e.y1},!1,!1);const i=w.getStage();i.needRender=!0;const n=t.globalTransMatrix.clone(),o=t.stage.window.getViewBoxTransform().clone();if(o.multiply(n.a,n.b,n.c,n.d,n.e,n.f),i.window.setViewBoxTransform(o.a,o.b,o.c,o.d,o.e,o.f),"string"==typeof g)w.updateDataSync(g,null!=p?p:[]);else{const t=[];for(const e in g){const i=g[e],n=f.series.find((t=>{var i;return(null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.id)===e}));t.push({id:e,values:i?null!==(l=null==p?void 0:p.filter((t=>t.hasOwnProperty(i))))&&void 0!==l?l:[]:null!=p?p:[],fields:null===(h=null==n?void 0:n.data)||void 0===h?void 0:h.fields}),w.updateFullDataSync||w.updateDataSync(e,i?null!==(d=null==p?void 0:p.filter((t=>t.hasOwnProperty(i))))&&void 0!==d?d:[]:null!=p?p:[])}null===(c=w.updateFullDataSync)||void 0===c||c.call(w,t)}}else m.internalProps.renderChartAsync?(-1===iM.indexOf(`${t.parent.col}+${t.parent.row}`)&&(iM.push(`${t.parent.col}+${t.parent.row}`),nM.push(t)),rM||hM(m)):lM(t)}draw(t,e,i,n){this._draw(t,{},!1,i,n)}};pM=uM([w()],pM);var fM=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let vM=class{constructor(){this.time=ki.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){const{shape:g}=t.attribute;if("circle"===g){const{width:o=l.width,height:r=l.height}=t.attribute;e.beginPath(),e.arc(i+o/2,n+r/2,Math.min(o,r)/2,0,2*Math.PI),e.closePath(),e.save(),e.clip()}}};vM=fM([w()],vM);let bM=class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){const{shape:g}=t.attribute;"circle"===g&&e.restore()}};bM=fM([w()],bM);let mM=class{constructor(){this.time=ki.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){const{isGif:g}=t.attribute;g&&t.playing&&(t.attribute.opacity=0)}};mM=fM([w()],mM);let yM=class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){const{isGif:g}=t.attribute;g&&t.playing&&(t.attribute.opacity=1,e.globalAlpha=t.attribute.opacity,t.renderFrame(e,i,n))}};function CM(t,e,i,n){var o;const{highlightScope:r,disableHeader:s,cellPos:a}=t.hover,l=t.table,h=l.isHeader(e,i);if(h&&s)return;let d;if(r===Vw.single&&a.col===e&&a.row===i?d="cellBgColor":r===Vw.column&&a.col===e?d=a.col===e&&a.row===i?"cellBgColor":"inlineColumnBgColor":r===Vw.row&&a.row===i?d=a.col===e&&a.row===i?"cellBgColor":"inlineRowBgColor":r===Vw.cross&&(a.col===e&&a.row===i?d="cellBgColor":a.col===e?d="inlineColumnBgColor":a.row===i&&(d="inlineRowBgColor")),d){let t;if(h){const r=l.getHeaderDefine(e,i);t=null==r?void 0:r.disableHeaderHover,n.firstChild&&"axis"===n.firstChild.name&&(null===(o=l.options.hover)||void 0===o?void 0:o.disableAxisHover)&&(t=!0)}else{const n=l.getBodyColumnDefine(e,i);t=null==n?void 0:n.disableHover}t&&(d=void 0)}return d}function wM(t,e,i,n){const{highlightInRange:o,disableHeader:r,ranges:s}=t.select;let a;const l=1===s.length&&function(t){return t.start.col!==t.end.col||t.start.row!==t.end.row}(null==s?void 0:s[0])&&o;if(l?1===(null==s?void 0:s.length)&&s[0].start&&s[0].end:1===(null==s?void 0:s.length)&&s[0].end.col===s[0].start.col&&s[0].end.row===s[0].start.row){if(t.table.isHeader(e,i)&&r)return;a=l?function(t,e,i){let n;const{highlightScope:o,cellPos:r,ranges:s}=t.select,a=s[0],l=Math.min(a.start.col,a.end.col),h=Math.max(a.start.col,a.end.col),d=Math.min(a.start.row,a.end.row),c=Math.max(a.start.row,a.end.row);return o===Vw.single&&r.col===e&&r.row===i?n="cellBgColor":o===Vw.column&&e>=l&&e<=h?n=a_(s[0],e,i)?"cellBgColor":"inlineColumnBgColor":o===Vw.row&&i>=d&&i<=c?n=a_(s[0],e,i)?"cellBgColor":"inlineRowBgColor":o===Vw.cross&&(a_(s[0],e,i)?n="cellBgColor":e>=l&&e<=h?n="inlineColumnBgColor":i>=d&&i<=c&&(n="inlineRowBgColor")),n}(t,e,i):function(t,e,i){let n;const{highlightScope:o,cellPos:r}=t.select;return o===Vw.single&&r.col===e&&r.row===i?n="cellBgColor":o===Vw.column&&r.col===e?n=r.col===e&&r.row===i?"cellBgColor":"inlineColumnBgColor":o===Vw.row&&r.row===i?n=r.col===e&&r.row===i?"cellBgColor":"inlineRowBgColor":o===Vw.cross&&(r.col===e&&r.row===i?n="cellBgColor":r.col===e?n="inlineColumnBgColor":r.row===i&&(n="inlineRowBgColor")),n}(t,e,i),a&&xM(t.table,e,i)&&(a=void 0)}else if("replace"===t.table.theme.selectionStyle.selectionFillMode)for(let t=0;t<s.length;t++){const n=s[t],o=Math.min(n.start.col,n.end.col),r=Math.max(n.start.col,n.end.col),l=Math.min(n.start.row,n.end.row),h=Math.max(n.start.row,n.end.row);if(o<=e&&l<=i&&r>=e&&h>=i){a="cellBgColor";break}}return a}function xM(t,e,i){var n,o;const r=null===(n=t.options.select)||void 0===n?void 0:n.disableSelect;if("function"==typeof r?r(e,i,t):r)return!0;if(t.isHeader(e,i)){let n=null===(o=t.options.select)||void 0===o?void 0:o.disableHeaderSelect;if(n)return!0;const r=t.getHeaderDefine(e,i);if(n=null==r?void 0:r.disableHeaderSelect,n)return!0}else{const n=t.getBodyColumnDefine(e,i),o=null==n?void 0:n.disableSelect;if("function"==typeof o?o(e,i,t):o)return!0}return!1}yM=fM([w()],yM);var _M=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let SM=class{constructor(){this.time=ki.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){const{stroke:g=l.stroke,strokeArrayWidth:p=l.strokeArrayWidth,strokeArrayColor:f=l.strokeArrayColor}=t.attribute;g&&(Array.isArray(p)||Array.isArray(f))&&(u.doStroke=!1)}};SM=_M([w()],SM);let AM=class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){var u,g;const{stroke:p=l.stroke,strokeArrayColor:f=l.strokeArrayColor,strokeArrayWidth:v=l.strokeArrayWidth,lineWidth:b=l.lineWidth,strokeColor:m=l.stroke,cornerRadius:y=l.cornerRadius}=t.attribute;let C,w,{width:x=l.width,height:_=l.height}=t.attribute;if(p&&(Array.isArray(v)||0!==b)&&(Array.isArray(f)||Array.isArray(v))){if("number"==typeof b&&1&b||Array.isArray(v)&&v.some((t=>1&t))){const e=t.stage.table;if(!e)return;const o="bottom-right"===(null===(u=null==e?void 0:e.theme)||void 0===u?void 0:u.cellBorderClipDirection);if(o){if(i=Math.floor(i)-.5,n=Math.floor(n)-.5,"cell"===t.role){const e=t.col,o=t.row;0===e&&(i+=1),0===o&&(n+=1)}}else i=Math.floor(i)+.5,n=Math.floor(n)+.5;(null===(g=e.options.customConfig)||void 0===g?void 0:g._disableColumnAndRowSizeRound)&&(x=Math.round(x),_=Math.round(_));const{width:r,height:s}=FM(t,Math.ceil(x),Math.ceil(_),o);C=r,w=s}else C=Math.ceil(x),w=Math.ceil(_);0===y||ZC(y)&&y.every((t=>0===t))?TM(t,e,i,n,l,p,v||b,f||m,C,w):(e.beginPath(),Vh(e,i,n,C,w,y,!0,new Array(4).fill(0).map(((o,r)=>(o,s,a,h)=>{NM(r,o,s,a,h,t,e,i,n,l,p,v||b,f||m,C,w)}))),e.stroke())}}};function BM(t){if(!Array.isArray(t))return{isSplitDraw:!1,width:t};let e;for(let i=0;i<t.length;i++){const n=t[i];if(n)if(e){if(n!==e)return{isSplitDraw:!0}}else e=n}return{isSplitDraw:!1,width:e}}function TM(t,e,i,n,o,r,s,a,l,h,d,c){var u,g,p,f;const v=BM(s),b=!Array.isArray(s),m=!Array.isArray(r),y=Array.isArray(c),C=Array.isArray(a)||v.isSplitDraw;e.setStrokeStyle(t,t.attribute,i,n,o);const{lineDash:w=o.lineDash}=t.attribute;let x=!1;w.length&&w.some((t=>Array.isArray(t)))&&(x=!0),e.beginPath(),e.moveTo(i,n);const _=(m||r[0])&&(b||s[0]),S=(m||r[1])&&(b||s[1]),A=(m||r[2])&&(b||s[2]),B=(m||r[3])&&(b||s[3]);if(_){const t=(b?v.width:s[0])/2,o=(b?v.width:s[0])/2;y&&Array.isArray(c[0])?(e.moveTo(i-t+(l+t+o)*c[0][0],n),e.lineTo(i-t+(l+t+o)*(c[0][1]-c[0][0]),n),e.moveTo(i+l+o,n)):(e.moveTo(i-t,n),e.lineTo(i+l+o,n)),(C||x)&&(a&&a[0]?e.strokeStyle=a[0]:a&&!a[0]&&(e.strokeStyle="transparent"),b||(e.lineWidth=s[0]),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,x&&e.setLineDash(null!==(u=w[0])&&void 0!==u?u:[]),e.stroke(),e.beginPath(),e.moveTo(i+l,n))}else e.moveTo(i+l,n);if(S){const t=(b?v.width:s[1])/2,o=(b?v.width:s[1])/2;y&&Array.isArray(c[1])?(e.moveTo(i+l,n-t+h*c[1][0]),e.lineTo(i+l,n-t+(h+t+o)*(c[1][1]-c[1][0])),e.moveTo(i+l,n+h+o)):(e.moveTo(i+l,n-t),e.lineTo(i+l,n+h+o)),(C||x)&&(a&&a[1]?e.strokeStyle=a[1]:a&&!a[1]&&(e.strokeStyle="transparent"),b||(e.lineWidth=s[1]),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,x&&e.setLineDash(null!==(g=w[1])&&void 0!==g?g:[]),e.stroke(),e.beginPath(),e.moveTo(i+l,n+h))}else e.moveTo(i+l,n+h);if(A){const t=(b?v.width:s[2])/2,o=(b?v.width:s[2])/2;y&&Array.isArray(c[2])?(e.moveTo(i-t+(l+t+o)*c[2][0],n+h),e.lineTo(i-t+(l+t+o)*(c[2][1]-c[2][0]),n+h),e.moveTo(i-t,n+h)):(e.moveTo(i-t,n+h),e.lineTo(i+l+o,n+h)),(C||x)&&(a&&a[2]?e.strokeStyle=a[2]:a&&!a[2]&&(e.strokeStyle="transparent"),b||(e.lineWidth=s[2]),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,x&&e.setLineDash(null!==(p=w[2])&&void 0!==p?p:[]),e.stroke(),e.beginPath(),e.moveTo(i,n+h))}else e.moveTo(i,n+h);if(B){const t=(b?v.width:s[3])/2,o=(b?v.width:s[3])/2;y&&Array.isArray(c[3])?(e.moveTo(i,n-t+(h+t+o)*c[3][0]),e.lineTo(i,n-t+(h+t+o)*(c[3][1]-c[3][0])),e.moveTo(i,n-t)):(e.moveTo(i,n-t),e.lineTo(i,n+h+o)),(C||x)&&(a&&a[3]?e.strokeStyle=a[3]:a&&!a[3]&&(e.strokeStyle="transparent"),b||(e.lineWidth=s[3]),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,x&&e.setLineDash(null!==(f=w[3])&&void 0!==f?f:[]),e.stroke(),e.beginPath(),e.moveTo(i,n))}else e.moveTo(i,n);C||x||(!b&&v.width&&(e.lineWidth=v.width),e.stroke()),e.lineDashOffset=0,e.setLineDash([])}AM=_M([w()],AM);let RM=class{constructor(){this.time=ki.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){var g;const{lineDash:p=l.lineDash,stroke:f=l.stroke,strokeArrayColor:v=l.strokeArrayColor,strokeArrayWidth:b=l.strokeArrayWidth}=t.attribute;f&&Array.isArray(p)&&p.length&&(null===(g=p[0])||void 0===g?void 0:g.length)&&!Array.isArray(v)&&!Array.isArray(b)&&(u.doStroke=!1)}};RM=_M([w()],RM);let kM=class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){var u,g,p,f,v,b;const{lineDash:m=l.lineDash,stroke:y=l.stroke,strokeArrayColor:C=l.strokeArrayColor,strokeArrayWidth:w=l.strokeArrayWidth,lineWidth:x=l.lineWidth}=t.attribute;if(!y||!(Array.isArray(m)&&m.length&&(null===(u=m[0])||void 0===u?void 0:u.length))||Array.isArray(C)||Array.isArray(w))return;const _=t.stage.table;if(!_)return;const S=ZC(m[0])?function(t){return 1===t.length?[t[0],t[0],t[0],t[0]]:2===t.length?[t[0],t[1],t[0],t[1]]:t}(m):[m,m,m,m];let A,B,{width:T=l.width,height:R=l.height}=t.attribute;if((null===(g=_.options.customConfig)||void 0===g?void 0:g._disableColumnAndRowSizeRound)?(T=Math.round(T),R=Math.round(R)):(T=Math.ceil(T),R=Math.ceil(R)),1&x){const e="bottom-right"===_.theme.cellBorderClipDirection,o=0,r=0;e?(i=Math.floor(i)-.5,n=Math.floor(n)-.5,"cell"===t.role&&(0===t.col&&(i+=1),0===t.row&&(n+=1))):(i=Math.floor(i)+.5,n=Math.floor(n)+.5);const{width:s,height:a}=FM(t,Math.ceil(T+o),Math.ceil(R+r),e);A=s,B=a}else A=Math.ceil(T),B=Math.ceil(R);e.setStrokeStyle(t,t.attribute,i,n,l),e.beginPath(),e.moveTo(i,n),e.lineTo(i+A,n),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,e.setLineDash(null!==(p=S[0])&&void 0!==p?p:[]),e.stroke(),e.beginPath(),e.moveTo(i+A,n),e.lineTo(i+A,n+B),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,e.setLineDash(null!==(f=S[1])&&void 0!==f?f:[]),e.stroke(),e.beginPath(),e.moveTo(i,n+B),e.lineTo(i+A,n+B),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,e.setLineDash(null!==(v=S[2])&&void 0!==v?v:[]),e.stroke(),e.beginPath(),e.moveTo(i,n),e.lineTo(i,n+B),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,e.setLineDash(null!==(b=S[3])&&void 0!==b?b:[]),e.stroke(),e.lineDashOffset=0,e.setLineDash([])}};kM=_M([w()],kM);let MM=class{constructor(){this.time=ki.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){const{lineWidth:g=l.lineWidth,stroke:p=l.stroke,lineDash:f=l.lineDash,strokeArrayWidth:v=l.strokeArrayWidth,strokeArrayColor:b=l.strokeArrayColor,notAdjustPos:m}=t.attribute;!0!==m&&p&&Array.isArray(f)&&!f.length&&!Array.isArray(b)&&!Array.isArray(v)&&1&g&&(u.doStroke=!1)}};MM=_M([w()],MM);let LM=class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){var u,g;const{lineWidth:p=l.lineWidth,stroke:f=l.stroke,lineDash:v=l.lineDash,strokeArrayWidth:b=l.strokeArrayWidth,strokeArrayColor:m=l.strokeArrayColor,notAdjustPos:y,cornerRadius:C=l.cornerRadius}=t.attribute;let{width:w=l.width,height:x=l.height}=t.attribute;if(!0!==y&&f&&Array.isArray(v)&&!v.length&&!Array.isArray(m)&&!Array.isArray(b)&&1&p){const o=t.stage.table;if(!o)return;(null===(u=o.options.customConfig)||void 0===u?void 0:u._disableColumnAndRowSizeRound)&&(w=Math.round(w),x=Math.round(x)),e.beginPath();const r="bottom-right"===(null===(g=null==o?void 0:o.theme)||void 0===g?void 0:g.cellBorderClipDirection),s=0,a=0;r?(i=Math.floor(i)-.5,n=Math.floor(n)-.5,"cell"===t.role&&(0===t.col&&(i+=1),0===t.row&&(n+=1))):(i=Math.floor(i)+.5,n=Math.floor(n)+.5);const{width:h,height:d}=FM(t,Math.ceil(w),Math.ceil(x),r);C?Vh(e,i,n,h+s,d+a,C):e.rect(i,n,h,d),e.setStrokeStyle(t,t.attribute,i,n,l),e.stroke()}}};LM=_M([w()],LM);let PM=class{constructor(){this.time=ki.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){if("cell"===t.role){const e=t.stage.table;if(e){const i=function(t,e){var i,n,o,r,s,a,l,h,d,c,u;let g,p;if("cell"===t.role&&XC(t.mergeStartCol)&&XC(t.mergeStartRow)&&XC(t.mergeEndCol)&&XC(t.mergeEndRow)){const{colStart:i,colEnd:n,rowStart:o,rowEnd:r}=wk(t,e.scenegraph);for(let t=i;t<=n;t++)for(let i=o;i<=r;i++){const n=wM(e.stateManager,t,i);!n||g&&"cellBgColor"!==n||(g=n)}}else"cell"===t.role&&(g=wM(e.stateManager,t.col,t.row));if(!g)return;const f=e.internalProps.layoutMap;return f.isCornerHeader(t.col,t.row)?p=(null===(i=e.theme.cornerHeaderStyle)||void 0===i?void 0:i.select)||(null===(n=e.theme.headerStyle)||void 0===n?void 0:n.select):f.isColumnHeader(t.col,t.row)?p=null===(o=e.theme.headerStyle)||void 0===o?void 0:o.select:f.isRowHeader(t.col,t.row)?p=null===(r=e.theme.rowHeaderStyle)||void 0===r?void 0:r.select:f.isBottomFrozenRow(t.col,t.row)?p=(null===(s=e.theme.bottomFrozenStyle)||void 0===s?void 0:s.select)||(e.isListTable()?null===(a=e.theme.bodyStyle)||void 0===a?void 0:a.select:null===(l=e.theme.headerStyle)||void 0===l?void 0:l.select):f.isRightFrozenColumn(t.col,t.row)?p=(null===(h=e.theme.rightFrozenStyle)||void 0===h?void 0:h.select)||(e.isListTable()?null===(d=e.theme.bodyStyle)||void 0===d?void 0:d.select:null===(c=e.theme.rowHeaderStyle)||void 0===c?void 0:c.select):e.isHeader(t.col,t.row)||(p=null===(u=e.theme.bodyStyle)||void 0===u?void 0:u.select),AR(g,p,t.col,t.row,e)}(t,e);if(i)t.attribute._vtableHightLightFill=i;else if(e.stateManager.interactionState!==jw.scrolling){const i=function(t,e){var i,n,o,r,s,a,l,h,d,c,u;let g,p;if("cell"===t.role&&XC(t.mergeStartCol)&&XC(t.mergeStartRow)&&XC(t.mergeEndCol)&&XC(t.mergeEndRow)){const{colStart:i,colEnd:n,rowStart:o,rowEnd:r}=wk(t,e.scenegraph);for(let s=i;s<=n;s++)for(let i=o;i<=r;i++){const n=CM(e.stateManager,s,i,t);!n||g&&"cellBgColor"!==n||(g=n)}}else"cell"===t.role&&(g=CM(e.stateManager,t.col,t.row,t));if(!g)return;const f=e.internalProps.layoutMap;return f.isCornerHeader(t.col,t.row)?p=(null===(i=e.theme.cornerHeaderStyle)||void 0===i?void 0:i.hover)||(null===(n=e.theme.headerStyle)||void 0===n?void 0:n.hover):f.isColumnHeader(t.col,t.row)?p=null===(o=e.theme.headerStyle)||void 0===o?void 0:o.hover:f.isRowHeader(t.col,t.row)?p=null===(r=e.theme.rowHeaderStyle)||void 0===r?void 0:r.hover:f.isBottomFrozenRow(t.col,t.row)?p=(null===(s=e.theme.bottomFrozenStyle)||void 0===s?void 0:s.hover)||(e.isListTable()?null===(a=e.theme.bodyStyle)||void 0===a?void 0:a.hover:null===(l=e.theme.headerStyle)||void 0===l?void 0:l.hover):f.isRightFrozenColumn(t.col,t.row)?p=(null===(h=e.theme.rightFrozenStyle)||void 0===h?void 0:h.hover)||(e.isListTable()?null===(d=e.theme.bodyStyle)||void 0===d?void 0:d.hover:null===(c=e.theme.rowHeaderStyle)||void 0===c?void 0:c.hover):e.isHeader(t.col,t.row)||(p=null===(u=e.theme.bodyStyle)||void 0===u?void 0:u.hover),AR(g,p,t.col,t.row,e)}(t,e);i&&(t.attribute._vtableHightLightFill=i)}}}}};PM=_M([w()],PM);let EM=class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){if(t.attribute._vtableHightLightFill)if(d);else if(s){const o=t.attribute.fill;t.attribute.fill=t.attribute._vtableHightLightFill,e.setCommonStyle(t,t.attribute,i,n,l),e.fill(),t.attribute.fill=o,t.attribute._vtableHightLightFill=void 0}}};EM=_M([w()],EM);let HM=class{constructor(){this.time=ki.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){var g,p,f,v,b,m;const y=t.stage.table;y&&("body"===t.role?IM(e,-(null!==(g=t.attribute.x)&&void 0!==g?g:0)+y.getFrozenColsWidth(),-(null!==(p=t.attribute.y)&&void 0!==p?p:0)+y.getFrozenRowsHeight(),t.parent.attribute.width-y.getFrozenColsWidth()-y.getRightFrozenColsWidth(),t.parent.attribute.height-y.getFrozenRowsHeight()-y.getBottomFrozenRowsHeight()):"row-header"===t.role?IM(e,0,-(null!==(f=t.attribute.y)&&void 0!==f?f:0)+y.getFrozenRowsHeight(),y.getFrozenColsWidth(),t.parent.attribute.height-y.getFrozenRowsHeight()-y.getBottomFrozenRowsHeight()):"col-header"===t.role?IM(e,-(null!==(v=t.attribute.x)&&void 0!==v?v:0)+y.getFrozenColsWidth(),0,t.parent.attribute.width-y.getFrozenColsWidth()-y.getRightFrozenColsWidth(),y.getFrozenRowsHeight()):"right-frozen"===t.role?IM(e,0,-(null!==(b=t.attribute.y)&&void 0!==b?b:0)+y.getFrozenRowsHeight(),y.getRightFrozenColsWidth(),t.parent.attribute.height-y.getFrozenRowsHeight()-y.getBottomFrozenRowsHeight()):"bottom-frozen"===t.role?IM(e,-(null!==(m=t.attribute.x)&&void 0!==m?m:0)+y.getFrozenColsWidth(),0,t.parent.attribute.width-y.getFrozenColsWidth()-y.getRightFrozenColsWidth(),y.getBottomFrozenRowsHeight()):"corner-header"===t.role?IM(e,0,0,y.getFrozenColsWidth(),y.getFrozenRowsHeight()):"corner-right-top-header"===t.role?IM(e,0,0,y.getRightFrozenColsWidth(),y.getFrozenRowsHeight()):"corner-right-bottom-header"===t.role?IM(e,0,0,y.getRightFrozenColsWidth(),y.getBottomFrozenRowsHeight()):"corner-left-bottom-header"===t.role&&IM(e,0,0,y.getFrozenColsWidth(),y.getBottomFrozenRowsHeight()))}};HM=_M([w()],HM);const OM=Math.pow(2,24);function IM(t,e,i,n,o){t.beginPath();const r=t.applyedMatrix;Math.abs(r.f)>OM||Math.abs(r.g)>OM?t.rect(e-OM,i-OM,n+2*OM,o+2*OM):t.rect(e,i,n,o)}function FM(t,e,i,n){const o=t.stage.table;if(!o)return{width:e,height:i};if("cell"===t.role){let r=t.col,s=t.row;const a=Z_(o,r,s);a&&(r=a.end.col,s=a.end.row),r!==o.colCount-1||n?(r===o.frozenColCount-1&&o.scrollLeft&&!n||0===r&&n)&&(e-=1):e-=1,s!==o.rowCount-1||n?(s===o.frozenRowCount-1&&o.scrollTop&&!n||0===s&&n)&&(i-=1):i-=1}else"corner-frozen"===t.role&&(o.scrollLeft&&!n&&(e-=1),o.scrollTop&&!n&&(i-=1));return{width:e,height:i}}var zM=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let DM=class{constructor(){this.time=ki.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){const{stroke:g=l.stroke,strokeArrayWidth:p=l.strokeArrayWidth,strokeArrayColor:f=l.strokeArrayColor}=t.attribute;g&&(Array.isArray(g)||Array.isArray(p)||Array.isArray(f))&&(u.doStroke=!1)}};DM=zM([w()],DM);let WM=class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c){const{width:u=l.width,height:g=l.height,stroke:p=l.stroke,strokeArrayColor:f=l.strokeArrayColor,strokeArrayWidth:v=l.strokeArrayWidth,lineWidth:b=l.lineWidth,strokeColor:m=l.stroke,cornerRadius:y=l.cornerRadius}=t.attribute;if(p&&(Array.isArray(v)||0!==b)&&(Array.isArray(p)||Array.isArray(f)||Array.isArray(v))){const o=0,r=0;"border-rect"!==t.name&&"table-border-rect"!==t.name&&("number"==typeof b&&1&b||Array.isArray(v)&&v.some((t=>1&t)))&&(i=Math.floor(i)+.5,n=Math.floor(n)+.5),0===y||ZC(y)&&y.every((t=>0===t))?TM(t,e,i,n,l,p,v||b,f||m,"table-border-rect"!==t.name?Math.ceil(u+o):u+o,"table-border-rect"!==t.name?Math.ceil(g+r):g+r):(e.beginPath(),Vh(e,i,n,u,g,y,!0,new Array(4).fill(0).map(((s,a)=>(s,h,d,c)=>{NM(a,s,h,d,c,t,e,i,n,l,p,v||b,f||m,Math.ceil(u+o),Math.ceil(g+r))}))),e.stroke())}}};function NM(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p){var f,v,b,m;const y=r,C=h,w=BM(c),x=!Array.isArray(c),_=!Array.isArray(d),S=Array.isArray(u)||w.isSplitDraw;s.stroke(),s.setStrokeStyle(r,r.attribute,a,l,h);const{lineDash:A=C.lineDash}=y.attribute;let B=!1;A.length&&A.some((t=>Array.isArray(t)))&&(B=!0),s.beginPath(),s.moveTo(a,l);const T=(_||d[0])&&(x||c[0]),R=(_||d[1])&&(x||c[1]),k=(_||d[2])&&(x||c[2]),M=(_||d[3])&&(x||c[3]);T&&0===t?(x?w.width:c[0],x?w.width:c[0],s.moveTo(e,i),s.lineTo(n,o),(S||B)&&(u&&u[0]?s.strokeStyle=u[0]:u&&!u[0]&&(s.strokeStyle="transparent"),x||(s.lineWidth=c[0]),s.lineDashOffset=s.currentMatrix.e/s.currentMatrix.a,B&&s.setLineDash(null!==(f=A[0])&&void 0!==f?f:[]),s.stroke(),s.beginPath())):0===t&&s.moveTo(a+g,l),R&&1===t?(x?w.width:c[1],x?w.width:c[1],s.moveTo(e,i),s.lineTo(n,o),(S||B)&&(u&&u[1]?s.strokeStyle=u[1]:u&&!u[1]&&(s.strokeStyle="transparent"),x||(s.lineWidth=c[1]),s.lineDashOffset=s.currentMatrix.f/s.currentMatrix.d,B&&s.setLineDash(null!==(v=A[1])&&void 0!==v?v:[]),s.stroke(),s.beginPath(),s.moveTo(a+g,l+p))):1===t&&s.moveTo(a+g,l+p),k&&2===t?(x?w.width:c[2],x?w.width:c[2],s.moveTo(e,i),s.lineTo(n,o),(S||B)&&(u&&u[2]?s.strokeStyle=u[2]:u&&!u[2]&&(s.strokeStyle="transparent"),x||(s.lineWidth=c[2]),s.lineDashOffset=s.currentMatrix.e/s.currentMatrix.a,B&&s.setLineDash(null!==(b=A[2])&&void 0!==b?b:[]),s.stroke(),s.beginPath(),s.moveTo(a,l+p))):2===t&&s.moveTo(a,l+p),M&&3===t?(x?w.width:c[3],x?w.width:c[3],s.moveTo(e,i),s.lineTo(n,o),(S||B)&&(u&&u[3]?s.strokeStyle=u[3]:u&&!u[3]&&(s.strokeStyle="transparent"),x||(s.lineWidth=c[3]),s.lineDashOffset=s.currentMatrix.f/s.currentMatrix.d,B&&s.setLineDash(null!==(m=A[3])&&void 0!==m?m:[]),s.stroke(),s.beginPath(),s.moveTo(a,l))):3===t&&s.moveTo(a,l),s.closePath(),S||B||(!x&&w.width&&(s.lineWidth=w.width),s.stroke()),s.lineDashOffset=0,s.setLineDash([]),s.beginPath()}WM=zM([w()],WM);var GM=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let jM,VM=class{constructor(){this.order=1,this.interceptors=[new UM]}afterDrawItem(t,e,i,n,o){for(let r=0;r<this.interceptors.length;r++)if(this.interceptors[r].afterDrawItem&&this.interceptors[r].afterDrawItem(t,e,i,n,o))return!0;return!1}beforeDrawItem(t,e,i,n,o){if((!t.in3dMode||i.in3dInterceptor)&&!t.shadowRoot&&!(t.baseGraphic||t.attribute.globalZIndex||t.interactiveGraphic))return!1;for(let r=0;r<this.interceptors.length;r++)if(this.interceptors[r].beforeDrawItem&&this.interceptors[r].beforeDrawItem(t,e,i,n,o))return!0;return!1}};VM=GM([w()],VM);class UM{constructor(){this.order=1}afterDrawItem(t,e,i,n,o){return"image"===t.type&&this.drawItem(t,e,i,n,o),!1}drawItem(t,e,i,n,o){const{image:r,gif:s}=t.attribute;if(s&&t.playing)return!1;if(!r||!t.resources)return!1;const a=t.resources.get(r);if(!a||"loading"!==a.state)return!1;if(!jM){const t=wR(),e=t.loading_pic.svg,i=t.loading_pic.width,n=t.loading_pic.height;jM=ih({width:i,height:n,image:e})}const{image:l}=jM.attribute;if(!r||!jM.resources)return!1;const h=jM.resources.get(l);if("success"!==h.state)return!1;const{context:d}=i;d.highPerformanceSave(),t.parent&&d.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&d.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const c=t.AABBBounds,{width:u,height:g}=_R(h.data.width,h.data.height,c.width(),c.height());return d.drawImage(h.data,c.x1+(c.width()-u)/2,c.y1+(c.height()-g)/2,u,g),d.highPerformanceRestore(),!0}}var XM=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let $M=class{constructor(){this.time=ki.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){var g,p;const{text:f,underline:v=l.underline,lineThrough:b=l.lineThrough,direction:m=l.direction,whiteSpace:y=l.whiteSpace,fontSize:C=l.fontSize,verticalMode:w=l.verticalMode,ellipsis:x=l.ellipsis,textAlign:_=l.textAlign,textBaseline:S=l.textBaseline,x:A=l.x,y:B=l.y}=t.attribute;let T=!1;if(Array.isArray(t)){const e=null===(g=t.cache)||void 0===g?void 0:g.layoutData;x&&e&&e.lines.every((t=>""===t.str))&&(T=!0)}else{const{cache:e}=t;x&&e&&""===e.clipedText&&0===e.clipedWidth&&(T=!0)}if(!T)return;const R=qC(x)?x:"...",k=null!==(p=Sr(t.attribute.lineHeight,C))&&void 0!==p?p:C;let M=0;k!==C&&("top"===S?M=(k-C)/2:"middle"===S||"bottom"===S&&(M=-(k-C)/2)),r&&(c?c(e,t.attribute,l):a&&(e.setStrokeStyle(t,t.attribute,A-i,B-n,l),e.strokeText(R,A,B+M))),o&&(d?d(e,t.attribute,l):s&&(e.setCommonStyle(t,t.attribute,A-i,B-n,l),e.fillText(R,A,B+M),this.drawUnderLine(v,b,t,A,B+M,0,l,e,R)))}drawUnderLine(t,e,i,n,o,r,s,a,l){if(e+t<=0)return;const{textAlign:h=s.textAlign,textBaseline:d=s.textBaseline,fontSize:c=s.fontSize,fontFamily:u=s.fontFamily,fontWeight:g=s.fontWeight,fontStyle:p=s.fontStyle,fill:f=s.fill,opacity:v=s.opacity,underlineOffset:b=s.underlineOffset,underlineDash:m=s.underlineDash,fillOpacity:y=s.fillOpacity}=i.attribute;if(!t&&!e)return;const C=dk.measureTextWidth(l,{fontSize:c,fontFamily:u,fontWeight:g,fontStyle:p}),w=vl(h,C),x=bl(d,c,c),_={lineWidth:0,stroke:f,opacity:v,strokeOpacity:y};if(t){_.lineWidth=t,a.setStrokeStyle(i,_,n,o,s),a.setLineDash(m),a.beginPath();const e=o+x+c+b;a.moveTo(n+w,e,r),a.lineTo(n+w+C,e,r),a.stroke()}if(e){_.lineWidth=e,a.setStrokeStyle(i,_,n,o,s),a.beginPath();const t=o+x+c/2;a.moveTo(n+w,t,r),a.lineTo(n+w+C,t,r),a.stroke()}}};$M=XM([w()],$M);var YM=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let KM=class{constructor(){this.type="chart",this.numberType=Qk}contains(t,e,i){return!!t.AABBBounds.containsPoint(e)}};KM=YM([w()],KM);var qM=new l(((t,e,i,n)=>{i($h)?n($h).to(DM).inSingletonScope():(t(DM).toSelf().inSingletonScope(),t(ul).toService(DM)),i(Yh)?n(Yh).to(WM).inSingletonScope():(t(WM).toSelf().inSingletonScope(),t(ul).toService(WM)),t(pM).toSelf().inSingletonScope(),t(gM).to(pM),t(gc).to(pM),t(KM).toSelf().inSingletonScope(),t(np).toService(KM),t(vM).toSelf().inSingletonScope(),t(hl).toService(vM),t(bM).toSelf().inSingletonScope(),t(hl).toService(bM),t(mM).toSelf().inSingletonScope(),t(hl).toService(mM),t(yM).toSelf().inSingletonScope(),t(hl).toService(yM),t(PM).toSelf().inSingletonScope(),t(ll).toService(PM),t(EM).toSelf().inSingletonScope(),t(ll).toService(EM),t(AM).toSelf().inSingletonScope(),t(ll).toService(AM),t(SM).toSelf().inSingletonScope(),t(ll).toService(SM),t(RM).toSelf().inSingletonScope(),t(ll).toService(RM),t(kM).toSelf().inSingletonScope(),t(ll).toService(kM),t(MM).toSelf().inSingletonScope(),t(ll).toService(MM),t(LM).toSelf().inSingletonScope(),t(ll).toService(LM),t(HM).toSelf().inSingletonScope(),t(ll).toService(HM),t(VM).toSelf().inSingletonScope(),t(Tc).toService(VM),t($M).toSelf().inSingletonScope(),t(pl).toService($M)}));function ZM(t,e,i,n){var o,r,s,a,l,h,d,c;t.internalProps.columnWidthConfig&&t._parseColumnWidthConfig(t.internalProps.columnWidthConfig),t.isPivotTable()&&t.internalProps.columnWidthConfigForRowHeader&&t._parseColumnWidthConfigForRowHeader(t.internalProps.columnWidthConfigForRowHeader),e=null!=e?e:0,i=null!=i?i:t.colCount-1,0===e&&i===t.colCount-1&&t._clearColRangeWidthsMap();const u=t.internalProps.layoutMap;t.isPivotTable()&&(u.enableUseGetBodyCache(),u.enableUseHeaderPathCache());const g=[],p=[];if(n)for(let e=0;e<t.colCount;e++)g[e]=t.getColWidth(e);for(let l=e;l<=i;l++){let e;if(t.internalProps.transpose||"only-header"!==(null===(r=null===(o=t.internalProps.layoutMap.columnObjects)||void 0===o?void 0:o[l])||void 0===r?void 0:r.columnWidthComputeMode)&&"only-header"!==t.columnWidthComputeMode||!("showHeader"in t.internalProps.layoutMap))e=t.internalProps.transpose||"only-body"!==(null===(a=null===(s=t.internalProps.layoutMap.columnObjects)||void 0===s?void 0:s[l])||void 0===a?void 0:a.columnWidthComputeMode)&&"only-body"!==t.columnWidthComputeMode?JM(l,0,t.rowCount-1,t):JM(l,t.internalProps.layoutMap.getBodyRange().start.row,t.internalProps.layoutMap.getBodyRange().end.row,t);else{const i=t.internalProps.layoutMap.showHeader;t.internalProps.layoutMap.showHeader=!0,e=JM(l,0,t.internalProps.layoutMap.headerLevelCount-1,t),t.internalProps.layoutMap.showHeader=i}t._setColContentWidth(l,e),t.getColWidth(l)!==e&&t._clearColRangeWidthsMap(l),n?p[l]=Math.round(t._adjustColWidth(l,e)):t._setColWidth(l,t._adjustColWidth(l,e),!1,!0)}if("adaptive"===t.widthMode){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,o=0,r=t.colCount;if("only-body"===t.widthAdaptiveMode){for(let e=0;e<t.colCount;e++){const o=n&&null!==(l=p[e])&&void 0!==l?l:t.getColWidth(e);(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=o)}o=t.rowHeaderLevelCount,r=t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount}nL(e-i,o,r,n,p,t)}else if(t.autoFillWidth){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,o=0;for(let e=0;e<t.colCount;e++){const r=n&&null!==(h=p[e])&&void 0!==h?h:t.getColWidth(e);(e<t.rowHeaderLevelCount+t.leftRowSeriesNumberCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=r),o+=r}o<e&&o>i&&nL(e-i,t.rowHeaderLevelCount+t.leftRowSeriesNumberCount,t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount,n,p,t)}if(n){for(let e=0;e<t.colCount;e++){const i=null!==(c=null!==(d=p[e])&&void 0!==d?d:t.getColWidth(e))&&void 0!==c?c:t.getColWidth(e);i!==g[e]&&t._setColWidth(e,i,!1,!0)}t.stateManager.checkFrozen();for(let e=0;e<t.colCount;e++){const i=t.getColWidth(e);i!==g[e]&&t.scenegraph.updateColWidth(e,i-g[e],!0,!0)}t.scenegraph.updateContainer(!0)}t.isPivotTable()&&(u.disableUseGetBodyCache(),u.disableUseHeaderPathCache())}function JM(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=function(t,e){const i=e.getColWidthDefined(t);return e.internalProps._widthResizedColMap.has(t)?e.getColWidth(t):i}(t,n);return n.internalProps.transpose&&"auto"===r&&("only-header"===n.columnWidthComputeMode&&t>=n.rowHeaderLevelCount||"only-body"===n.columnWidthComputeMode&&t<n.rowHeaderLevelCount)&&(r=n.getDefaultColumnWidth(t)),o&&!n.internalProps.transpose?QM(r,t,e,i,o,n):"number"==typeof r?r:"auto"!==r&&"string"==typeof r?n._adjustColWidth(t,n._colWidthDefineToPxWidth(r)):QM(r,t,e,i,o,n)}function QM(t,e,i,n,o,r){var s,a,l,h,d;let c=0,u=1,g=1;if(n-i>5e3&&(g=Math.ceil((n-i)/5e3)),r.isPivotChart()&&e>=r.rowHeaderLevelCount&&e<r.colCount-r.rightFrozenColCount){if(r.internalProps.layoutMap.indicatorsAsCol)return r.defaultColWidth;{const t=r.internalProps.layoutMap.getOptimunWidthForChart(e);if(t>0)return t}}for(let p=i;p<=n;p+=u){if(r.isPivotChart()){const t=r.internalProps.layoutMap,i=t.getAxisConfigInPivotChart(e,p);if(i){const t=J_.getFunction("computeAxisComponentWidth")(i,r);if("number"==typeof t){c=Math.max(t,c);continue}}else if(t.isLeftBottomCorner(e,p)||t.isRightTopCorner(e,p)||t.isRightBottomCorner(e,p))continue}const i=tL(e,p,r);if(i&&(c=Math.max(i.width,c),!i.renderDefault))continue;const n=t;if("number"==typeof n&&"standard"===r.widthMode&&!o){c=Math.max(n,c);continue}const f=r.isHeader(e,p)?null===(s=r._getHeaderLayoutMap(e,p))||void 0===s?void 0:s.headerType:r.getBodyColumnType(e,p);if(XC(f)&&"text"!==f&&"link"!==f&&"progressbar"!==f&&"checkbox"!==f&&"radio"!==f&&"switch"!==f&&"button"!==f){c=Math.max(c,r.getColWidthDefinedNumber(e)||0);continue}let v=0;const b=r.internalProps.layoutMap;if(b.isHeader(e,p)){const t=b.getHeader(e,p);if("only-body"===(null===(a=null==t?void 0:t.define)||void 0===a?void 0:a.columnWidthComputeMode))continue;XC(null==t?void 0:t.hierarchyLevel)&&(v=(null!==(l=t.hierarchyLevel)&&void 0!==l?l:0)*("tree"===b.rowHierarchyType&&null!==(h=b.rowHierarchyIndent)&&void 0!==h?h:0),b.rowHierarchyTextStartAlignment&&!r.internalProps.headerHelper.getHierarchyIcon(e,p)&&(v+=r.internalProps.headerHelper.getHierarchyIconWidth()))}else if(r.isListTable()){u=g;const t=r.getBodyColumnDefine(e,p);if(null==t?void 0:t.tree){const t=r.dataSource.getIndexKey(r.getRecordShowIndexByCell(e,p));v=Array.isArray(t)&&r.getHierarchyState(e,p)!==Kw.none?(t.length-1)*(null!==(d=b.hierarchyIndent)&&void 0!==d?d:0):0,b.hierarchyTextStartAlignment&&!r.internalProps.bodyHelper.getHierarchyIcon(e,p)&&(v+=r.internalProps.headerHelper.getHierarchyIconWidth())}}const m=eL(e,p,f,r);c=Math.max(m+v,c),u>1&&r.bottomFrozenRowCount>0&&p<r.rowCount-r.bottomFrozenRowCount&&p+u>=r.rowCount-r.bottomFrozenRowCount&&(p=r.rowCount-r.bottomFrozenRowCount-u,u=1,g=1)}const p=r.getMinColWidth(e),f=r.getMaxColWidth(e);return c<p?p:c>f?f:(c<=0&&(c=r.defaultColWidth),c)}function tL(t,e,i){var n,o,r,s,a,l,h;const d=i.getCustomRender(t,e);let c=i.getCustomLayout(t,e);if(d||c){let u,g=1,p=0,f=!1,v=!1;(i.isHeader(t,e)||(null===(n=i.getBodyColumnDefine(t,e))||void 0===n?void 0:n.mergeCell)||i.hasCustomMerge())&&(u=i.getCellRange(t,e),g=u.end.col-u.start.col+1);const b={col:null!==(o=null==u?void 0:u.start.col)&&void 0!==o?o:t,row:null!==(r=null==u?void 0:u.start.row)&&void 0!==r?r:e,dataValue:i.getCellOriginValue(t,e),value:i.getCellValue(t,e)||"",rect:iL(t,e,i),table:i,originCol:t,originRow:e,forComputation:!0};if("react-custom-layout"===c&&(c=(null===(s=i.reactCustomLayout)||void 0===s?void 0:s.getCustomLayoutFunc(t,e))||ET),VC(c)){const t=c(b);if(t.rootContainer){t.rootContainer=UT(t.rootContainer),VT(t.rootContainer,0,i.getRowHeight(e));const n=t.rootContainer.attribute.width;t.rootContainer.setStage(i.scenegraph.stage),p=n>0?n:null!==(a=t.rootContainer.AABBBounds.width())&&void 0!==a?a:0,f=t.renderDefault,v=t.enableCellPadding}else p=0,f=t.renderDefault,v=t.enableCellPadding}else if("function"==typeof d){const t=d(b);p=null!==(l=null==t?void 0:t.expectedWidth)&&void 0!==l?l:0,f=null==t?void 0:t.renderDefault}else p=null!==(h=null==d?void 0:d.expectedWidth)&&void 0!==h?h:0,f=null==d?void 0:d.renderDefault;if(p=Math.ceil(p),v){const n=UB(AR("padding",i._getCellStyle(t,e),t,e,i));p+=n[1]+n[3]}return{width:p/g,renderDefault:f}}}function eL(t,e,i,n){var o,r,s,a;let l=0;const h=n.getCellValue(t,e),d=n._getCellStyle(t,e);let c=0,u=!1;if("body"!==n.getCellLocation(t,e))u=!0;else{const i=n.getBodyColumnDefine(t,e);u=!!(null==i?void 0:i.icon)||!!(null==i?void 0:i.tree)||(null==i?void 0:i.dragOrder)}if(u){const i=n.getCellIcons(t,e);null==i||i.forEach((t=>{var e,i,n;t.positionType!==qw.absoluteRight&&(c+=(null!==(e=t.width)&&void 0!==e?e:0)+(null!==(i=t.marginLeft)&&void 0!==i?i:0)+(null!==(n=t.marginRight)&&void 0!==n?n:0))}))}let g=1;if(n.isHeader(t,e)||(null===(o=n.getBodyColumnDefine(t,e))||void 0===o?void 0:o.mergeCell)||n.hasCustomMerge()){const i=n.getCellRange(t,e);g=i.end.col-i.start.col+1}const p=UB(AR("padding",d,t,e,n)),f=p[1]+p[3],v=AR("fontSize",d,t,e,n),b=AR("fontFamily",d,t,e,n),m=AR("fontWeight",d,t,e,n);let y;if("checkbox"===i)y=$C(h)?h.text:h;else if("radio"===i)if(ZC(h)){y="";const i=n.getBodyColumnDefine(t,e),o=null!==(r=null==i?void 0:i.radioDirectionInCell)&&void 0!==r?r:"vertical";"vertical"===o?h.forEach((t=>{y+=($C(t)?t.text:t).toString()+"\n"})):"horizontal"===o&&h.forEach((t=>{y+=($C(t)?t.text:t).toString()}))}else y=$C(h)?h.text:h;else if("button"===i){const i=n_(n.getBodyColumnDefine(t,e).text,{col:t,row:e,table:n,context:null,value:h,dataValue:n.getCellOriginValue(t,e)});y=null!==(s=null!=i?i:h)&&void 0!==s?s:""}else y=h;const C=MR(y,n).text;if(C.length>=1&&(1!==C.length||""!==C[0])?C.forEach((t=>{const e=n.measureText(t,{fontSize:v,fontFamily:b,fontWeight:m}).width;l=Math.max((e+f+4+c)/g,l)})):l=Math.max((f+4+c)/g,l),!1!==n.internalProps.limitMaxAutoWidth&&(l=Math.min("number"==typeof n.internalProps.limitMaxAutoWidth?n.internalProps.limitMaxAutoWidth:450,l)),"checkbox"===i){const i=AR("size",d,t,e,n);if(l+=i,y){const i=AR("spaceBetweenTextAndIcon",d,t,e,n);l+=i}}else if("radio"===i){const i=AR("size",d,t,e,n),o=AR("outerRadius",d,t,e,n),r=tw(o)?2*o:i,s=AR("spaceBetweenTextAndIcon",d,t,e,n);if(ZC(h)){const i=n.getBodyColumnDefine(t,e),o=AR("spaceBetweenRadio",d,t,e,n),c=null!==(a=null==i?void 0:i.radioDirectionInCell)&&void 0!==a?a:"vertical";"vertical"===c?(l+=r,l+=s):"horizontal"===c&&(l+=(r+s)*h.length,l+=o*(h.length-1))}else l+=r,y&&(l+=s)}else if("switch"===i){const i=AR("boxWidth",d,t,e,n);l=i}else if("button"===i){const i=AR("buttonPadding",d,t,e,n);l+=2*i}return l}function iL(t,e,i){return{left:0,top:0,right:i.getColWidth(t),bottom:i.getRowHeight(e),width:null,height:null}}function nL(t,e,i,n,o,r,s){var a,l,h,d;let c=0;const u=[],g=[];let p=0;for(let s=e;s<i;s++){const e=n&&null!==(a=o[s])&&void 0!==a?a:r.getColWidth(s),i=r.getMaxColWidth(s),h=r.getMinColWidth(s);e!==i&&e!==h?(c+=e,u.push(s)):t-=e,(null===(l=r.options.customConfig)||void 0===l?void 0:l.shrinkSparklineFirst)&&"sparkline"===r.getBodyColumnType(s,0)&&(g.push({col:s,width:e}),p+=e-r.defaultColWidth)}const f=t/c;if((null===(h=r.options.customConfig)||void 0===h?void 0:h.shrinkSparklineFirst)&&f<1&&c-t<p)for(let e=0;e<g.length;e++){const{col:i,width:a}=g[e],l=(c-t)/g.length,h=Math.floor(a-l);n?o[i]=r._adjustColWidth(i,h):s?r.scenegraph.setColWidth(i,r._adjustColWidth(i,h)):r._setColWidth(i,r._adjustColWidth(i,h),!1,!0)}else for(let e=0;e<u.length;e++){const i=u[e];let a;a=e===u.length-1?t-u.reduce(((t,e,s)=>{var a;return e!==i?t+(n?null!==(a=o[e])&&void 0!==a?a:r.getColWidth(i):r.getColWidth(e)):t}),0):Math.round((n&&null!==(d=o[i])&&void 0!==d?d:r.getColWidth(i))*f),n?o[i]=r._adjustColWidth(i,a):s?r.scenegraph.setColWidth(i,r._adjustColWidth(i,a)):r._setColWidth(i,r._adjustColWidth(i,a),!1,!0)}}const oL=new xR({});function rL(t,e,i,n,o,r,s,a,l){var h,d;let c,u,g,p=0;t.lastChild&&t.lastChild.row===n-1?p=t.lastChild.attribute.y+t.lastChild.attribute.height:t.colHeight&&(p=t.colHeight);for(let f=n;f<=o;f++){const o=f;let v,b,m,y,C=a.getCellLocation(e,o),w=a.getCellValue(e,o),x=i,_=a.getRowHeight(o),S=!1;if(a.internalProps.customMergeCell){const t=a.getCustomMerge(e,o);if(t){const{range:e,text:i,style:s,customLayout:l,customRender:h}=t;if(v=e,b=v.start.col!==v.end.col||v.start.row!==v.end.row,b){const t=aL(v,r,a,n>v.start.row);x=t.cellWidth,_=t.cellHeight}w=i,m=s,(l||h)&&(y=GT(l,h,e.start.col,e.start.row,a.getColsWidth(e.start.col,e.end.col),a.getRowsHeight(e.start.row,e.end.row),!1,a.isAutoRowHeight(o),[0,0,0,0],v,a)),S=!0}}let A,B=e,T=o;v&&(B=v.start.col,T=v.start.row),!a.isPivotTable()&&("columnHeader"===C||"cornerHeader"===C)&&o>=a.columnHeaderLevelCount&&(C="body"),A=!a.isPivotTable()&&a.isSeriesNumberInBody(e,o)?a.getBodyColumnDefine(B,T):"body"!==C?a.getHeaderDefine(B,T):a.getBodyColumnDefine(B,T);const R="isAggregation"in a.internalProps.layoutMap&&a.internalProps.layoutMap.isAggregation(e,o),k=a.internalProps.layoutMap.isSeriesNumber(e,o);let M="body"!==C||((null==A?void 0:A.dragOrder)||!!(null==A?void 0:A.icon)||!!(null==A?void 0:A.tree))&&!(R&&k);if(!v&&(a.internalProps.enableTreeNodeMerge||"body"!==C||(null==A?void 0:A.mergeCell))&&(v=a.getCellRange(e,o),b=v.start.col!==v.end.col||v.start.row!==v.end.row,b)){const t=aL(v,r,a,n>v.start.row);x=t.cellWidth,_=t.cellHeight}let L=!1;if(a.internalProps.enableTreeNodeMerge&&b){const t=a.getCellRawRecord(v.start.col,v.start.row),{vtableMergeName:i,vtableMerge:n}=null!=t?t:{};L=n,n&&(M=!0,a.options.groupTitleCustomLayout&&(y=GT(a.options.groupTitleCustomLayout,void 0,v.start.col,v.start.row,a.getColsWidth(v.start.col,v.end.col),a.getRowsHeight(v.start.row,v.end.row),!1,a.isAutoRowHeight(o),[0,0,0,0],v,a)),a.options.groupTitleFieldFormat?w=a.options.groupTitleFieldFormat(t,e,o,a):i&&(w=i))}const P=L||S?"text":null!==(d=a.isHeader(e,o)?null!==(h=a._getHeaderLayoutMap(e,o).headerType)&&void 0!==h?h:"text":a.getBodyColumnType(e,o))&&void 0!==d?d:"text";if(o_(w)){lL(e,o,0,p,x,_,t),VR(w,a,sL.bind(null,{type:P,value:w,define:A,table:a,col:e,row:o,colWidth:i,cellWidth:x,cellHeight:_,columnGroup:t,y:p,customStyle:m,mayHaveIcon:M,cellLocation:C,range:v,customResult:y,defaultRowHeight:s})),t.updateColumnRowNumber(o);const n=a.getRowHeight(o);t.updateColumnHeight(n),p+=n}else{const n=RT(m||a._getCellStyle(v?v.start.col:e,v?v.start.row:o),a,v?v.start.col:e,v?v.start.row:o,AR).theme;n.group.cornerRadius=kT(e,o,a),n.group.width=i,n.group.height=Array.isArray(s)?s[o]:s,n._vtable.padding&&(c=n._vtable.padding),n.text.textAlign&&(u=n.text.textAlign),n.text.textBaseline&&(g=n.text.textBaseline),"body"===C||n.group.fill||(n.group.fill="#fff");const r=XR(P,w,A,a,e,o,i,x,_,t,p,c,u,g,M,n,v,y);if(t.updateColumnRowNumber(o),b){const i=a.getRowHeight(o),{width:n}=(a.getColWidth(e),r.attribute),{height:s}=r.attribute;r.contentWidth=n,r.contentHeight=s,ZR(v,n,s,c,u,g,a),t.updateColumnHeight(i),p+=i}else t.updateColumnHeight(_),p+=_}if(l&&o>l)break}return t.setAttribute("width",i),{width:i,height:p}}function sL(t){let e,i,n;const{type:o,value:r,define:s,table:a,col:l,row:h,colWidth:d,cellWidth:c,cellHeight:u,columnGroup:g,y:p,cellLocation:f,mayHaveIcon:v,customStyle:b,range:m,customResult:y,defaultRowHeight:C}=t,w=RT(b||a._getCellStyle(m?m.start.col:l,m?m.start.row:h),a,m?m.start.col:l,m?m.start.row:h,AR).theme;w.group.cornerRadius=kT(l,h,a),w.group.width=d,w.group.height=Array.isArray(C)?C[h]:C,w._vtable.padding&&(e=w._vtable.padding),w.text.textAlign&&(i=w.text.textAlign),w.text.textBaseline&&(n=w.text.textBaseline),"body"===f||w.group.fill||(w.group.fill="#fff"),XR(o,r,s,a,l,h,d,c,u,g,p,e,i,n,v,w,m,y)}function aL(t,e,i,n){let o=0,r=0;const s=e.get(`${t.start.col},${t.start.row};${t.end.col},${t.end.row}`);if(!s||n){for(let e=t.start.col;e<=t.end.col;e++)o+=i.getColWidth(e);for(let e=t.start.row;e<=t.end.row;e++)r+=i.getRowHeight(e);e.set(`${t.start.col},${t.start.row};${t.end.col},${t.end.row}`,{cellWidth:o,cellHeight:r})}else o=s.cellWidth,r=s.cellHeight;return{cellWidth:o,cellHeight:r}}function lL(t,e,i,n,o,r,s){const a=new xR({x:i,y:n,width:o,height:r});a.role="cell",a.col=t,a.row=e,s.addChild(a)}function hL(t,e,i,n,o,r,s,a,l,h){if(n>o||r>s)return;const{layoutMap:d,defaultHeaderRowHeight:c,defaultColWidth:u}=l.internalProps,g=l.defaultRowHeight;let p=0,f=0;for(let d=n;d<=o;d++){const n=d,o=l.getColWidth(n),u=new xR({x:e+p,y:i,width:o,height:0,clip:!1,pickable:!1});u.role="column",u.col=d,t.addChild(u);const{width:v,height:b}=rL(u,n,o,r,s,l.scenegraph.mergeMap,"columnHeader"===a&&tw(c)?c:g,l,h);p+=v,f=Math.max(f,b)}t.setAttribute("width",p),t.setAttribute("height",f)}function dL(t){let e=t.firstChild;for(;e&&"group"!==e.type;)e=e._next;return e}function cL(t){let e=t.lastChild;for(;e&&"group"!==e.type;)e=e._prev;return e}function uL(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"left";for(let o=t;o<=e;o++){const t=i.scenegraph.getColGroup(o);t&&gL(t,i,n);const e=i.scenegraph.getColGroup(o,!0);e&&gL(e,i,n);const r=i.scenegraph.getColGroupInBottom(o);r&&gL(r,i,n)}const o=Math.min(i.scenegraph.proxy.colLimit,i.scenegraph.proxy.bodyRightCol-i.scenegraph.proxy.bodyLeftCol+1),r=i.getColsWidth(i.frozenColCount,i.frozenColCount+o),s=i.getColsWidth(i.frozenColCount,i.colCount-1);i.scenegraph.proxy.xLimitLeft=r/2,i.scenegraph.proxy.xLimitRight=s-r/2}function gL(t,e){if("left"===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left")){let i;const n=function(t){let e=t._prev;for(;e&&"group"!==e.type;)e=e._prev;return e}(t);i=n?n.attribute.x+e.getColWidth(t._prev.col):e.getColsWidth(e.frozenColCount,t.col-1),t.setAttribute("x",i)}else{let i;const n=function(t){let e=t._next;for(;e&&"group"!==e.type;)e=e._next;return e}(t);i=n?n.attribute.x-e.getColWidth(t.col):e.getColsWidth(e.frozenColCount,t.col-1),t.setAttribute("x",i)}}oL.role="empty";var pL=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))};function fL(t,e,i,n){return pL(this,void 0,void 0,(function*(){if(!e)return;const o=e.col,r=e.left;let s;if(s=i?n.bodyRightCol-n.colEnd:n.screenLeftCol-n.referenceCol,function(t,e,i,n,o){t>0?(vL(t,"left",o.screenLeftCol,i,n,o),o.updateDeltaX(n,i,e),o.table.scenegraph.setBodyAndColHeaderX(-n+o.deltaX)):t<0?(vL(-t,"right",o.screenLeftCol,i,n,o),o.updateDeltaX(n,i,e),o.table.scenegraph.setBodyAndColHeaderX(-n+o.deltaX)):(o.updateDeltaX(n,i,e),o.table.scenegraph.setBodyAndColHeaderX(-n+o.deltaX))}(s,o,r,t,n),i){const e=n.table.scenegraph.getColGroup(n.colEnd);if(e){const i=e.attribute.x+e.attribute.width-(n.table.tableNoFrameWidth-n.table.getFrozenColsWidth()-n.table.getRightFrozenColsWidth())-t;n.deltaX=-i,n.table.scenegraph.setBodyAndColHeaderX(-t+n.deltaX)}}n.table.scenegraph.updateNextFrame()}))}function vL(t,e,i,n,o,r){return pL(this,void 0,void 0,(function*(){if("left"===e&&r.colEnd+t>r.bodyRightCol?t=r.bodyRightCol-r.colEnd:"right"===e&&r.colStart-t<r.bodyLeftCol&&(t=r.colStart-r.bodyLeftCol),0!==t)if(t<0&&(e="left"===e?"right":"left",t=-t),t<r.colEnd-r.colStart){const o="left"===e?r.colStart:r.colEnd-t+1,s="left"===e?r.colStart+t-1:r.colEnd,a="left"===e?r.colEnd+1:r.colStart-t,l="left"===e?r.colEnd+t:r.colStart-1;ZM(r.table,a,l),function(t,e,i,n){for(let o=t;o<=e;o++)n.table.scenegraph.bodyGroup.childrenCount>0&&"group"===n.table.scenegraph.bodyGroup.firstChild.type&&CL(n.table.scenegraph.bodyGroup,i,n),n.table.scenegraph.colHeaderGroup.childrenCount>0&&"group"===n.table.scenegraph.colHeaderGroup.firstChild.type&&CL(n.table.scenegraph.colHeaderGroup,i,n),n.table.scenegraph.bottomFrozenGroup.childrenCount>0&&"group"===n.table.scenegraph.bottomFrozenGroup.firstChild.type&&CL(n.table.scenegraph.bottomFrozenGroup,i,n)}(o,s,e,r);const h=a,d=l;r.colStart="left"===e?r.colStart+t:r.colStart-t,r.colEnd="left"===e?r.colEnd+t:r.colEnd-t,wL(h,d,r),uL(h,d,r.table,e);const c=r.table.scenegraph.getColGroup(i)||r.table.scenegraph.getColGroup(i,!0),u=n-(c.attribute.x+r.table.getFrozenColsWidth()+r.table.scenegraph.proxy.deltaX);r.table.scenegraph.proxy.deltaX+=u,r.currentCol="left"===e?r.currentCol+t:r.currentCol-t,r.totalCol=Math.max(0,Math.min(r.table.colCount-1,"left"===e?r.totalCol+t:r.totalCol-t)),r.referenceCol=r.colStart+Math.floor((r.colEnd-r.colStart)/2),r.colUpdatePos=a,r.colUpdateDirection=e,r.table.scenegraph.updateNextFrame()}else{const i="left"===e?r.colStart+t:r.colStart-t,n="left"===e?r.colEnd+t:r.colEnd-t;ZM(r.table,i,n),function(t,e,i,n){n.table.scenegraph.colHeaderGroup.forEachChildren(((o,r)=>{"group"===o.type&&bL(o,"left"===i?o.col+e:o.col-e,0===r?t:o._prev.attribute.x+n.table.getColWidth(o._prev.col))})),n.table.scenegraph.bottomFrozenGroup.forEachChildren(((o,r)=>{"group"===o.type&&bL(o,"left"===i?o.col+e:o.col-e,0===r?t:o._prev.attribute.x+n.table.getColWidth(o._prev.col))})),n.table.scenegraph.bodyGroup.forEachChildren(((o,r)=>{"group"===o.type&&bL(o,"left"===i?o.col+e:o.col-e,0===r?t:o._prev.attribute.x+n.table.getColWidth(o._prev.col))}))}(r.table.getColsWidth(r.bodyLeftCol,i-1),t,e,r);const o=i,s=n;r.colStart=i,r.colEnd=n,wL(o,s,r),uL(o,s,r.table,n>r.bodyRightCol-(r.colEnd-r.colStart+1)?"right":"left"),r.currentCol="left"===e?r.currentCol+t:r.currentCol-t,r.totalCol=Math.max(0,Math.min(r.table.colCount-1,"left"===e?r.totalCol+t:r.totalCol-t)),r.referenceCol=r.colStart+Math.floor((r.colEnd-r.colStart)/2),r.colUpdatePos=r.colStart,r.colUpdateDirection=n>r.bodyRightCol-(r.colEnd-r.colStart+1)?"right":"left",r.table.scenegraph.updateNextFrame()}}))}function bL(t,e,i){t.col=e,t.forEachChildren((t=>{t.col=e,t.needUpdate=!0})),t.setAttribute("x",i),t.needUpdate=!0}function mL(t,e){if(!t)return;let i=t.firstChild;for(;i;)i=e.updateCellGroupContent(i)._next;t.needUpdate=!1,t.setAttribute("width",e.table.getColWidth(t.col))}function yL(t,e){if(!t)return;const i=e.screenTopRow,n=Math.max(e.bodyTopRow,i-1*e.screenRowCount),o=Math.min(e.bodyBottomRow,i+2*e.screenRowCount,e.table.rowCount-1);for(let i=n;i<=o;i++){const n=e.highPerformanceGetCell(t.col,i,!0);e.updateCellGroupContent(n)}e.rowUpdatePos=e.rowStart,t.needUpdate=!1,t.setAttribute("width",e.table.getColWidth(t.col))}function CL(t,e,i){if("left"===e){const e=dL(t),n=cL(t);bL(e,n.col+1,n.attribute.x+i.table.getColWidth(n.col)),t.appendChild(e),t.border&&t.appendChild(t.border)}else{const e=cL(t),n=dL(t);bL(e,n.col-1,n.attribute.x-i.table.getColWidth(n.col-1)),t.insertBefore(e,t.firstChild)}}function wL(t,e,i){for(let n=t;n<=e;n++){const t=i.table.scenegraph.getColGroup(n,!0);t&&mL(t,i);const e=i.table.scenegraph.getColGroupInBottom(n);e&&mL(e,i);const o=i.table.scenegraph.getColGroupInRightTopCorner(n);o&&mL(o,i);const r=i.table.scenegraph.getColGroupInRightBottomCorner(n);r&&mL(r,i);const s=i.table.scenegraph.getColGroup(n);s&&yL(s,i)}xL(i.table.scenegraph.colHeaderGroup),xL(i.table.scenegraph.bottomFrozenGroup),xL(i.table.scenegraph.bodyGroup),i.progress()}function xL(t){var e,i;const n=cL(t);if(n&&(t.setAttribute("width",n.attribute.x+n.attribute.width),t.border)){const o=t.border;o.setAttribute("width",n.attribute.x+n.attribute.width-(null!==(e=o.attribute.borderLeft)&&void 0!==e?e:0)/2-(null!==(i=o.attribute.borderRight)&&void 0!==i?i:0)/2)}}function _L(t,e,i,n,o){let r=arguments.length>6?arguments[6]:void 0;var s,a;if("up"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"up"))for(let a=t;a<=e;a++)for(let t=i;t<=n;t++){const e=o.scenegraph.highPerformanceGetCell(a,t,!0);if("cell"!==e.role||!e.row)continue;let i;if(e._prev)i=(null===(s=e._prev)||void 0===s?void 0:s.attribute.y)+o.getRowHeight(e._prev.row);else if(r){const e=n===o.rowCount-o.bottomFrozenRowCount-1?n:n+1;if(i=o.scenegraph.highPerformanceGetCell(a,e,!0).attribute.y,XC(i))for(let n=t;n<e;n++)i-=o.getRowHeight(n)}else i=SL(e.row,o);XC(i)&&e.setAttribute("y",i)}else for(let s=t;s<=e;s++)for(let t=n;t>=i;t--){const e=o.scenegraph.highPerformanceGetCell(s,t,!0);if("cell"!==e.role||!e.row)continue;let n;if(e._next)n=(null===(a=e._next)||void 0===a?void 0:a.attribute.y)-o.getRowHeight(e.row);else if(r){const e=i<=o.frozenRowCount?o.frozenRowCount:i-1;n=i<=o.frozenRowCount?0:o.scenegraph.highPerformanceGetCell(s,e,!0).attribute.y;for(let i=e;i<t;i++)n+=o.getRowHeight(i)}else n=SL(e.row,o);XC(n)&&e.setAttribute("y",n)}const l=Math.min(o.scenegraph.proxy.rowLimit,o.scenegraph.proxy.bodyBottomRow-o.scenegraph.proxy.bodyTopRow+1),h=o.getRowsHeight(o.frozenRowCount,o.frozenRowCount+l),d=o.getRowsHeight(o.frozenRowCount,o.rowCount-1);o.scenegraph.proxy.yLimitTop=h/2,o.scenegraph.proxy.yLimitBottom=d-h/2}function SL(t,e){let i;return i=t<e.frozenRowCount?e.getRowsHeight(0,t-1):t>=e.rowCount-e.bottomFrozenRowCount?e.getRowsHeight(e.rowCount-e.bottomFrozenRowCount,t-1):e.getRowsHeight(e.frozenRowCount,t-1),i}var AL=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))};function BL(t,e,i,n){return AL(this,void 0,void 0,(function*(){if(!e)return;const o=e.row,r=e.top;let s;if(s=i?n.bodyBottomRow-n.rowEnd:o-n.referenceRow,function(t,e,i,n,o){t>0?(TL(t,"up",e,i,n,o),o.updateDeltaY(n,i,e),o.updateBody(n-o.deltaY)):t<0?(TL(-t,"down",e,i,n,o),o.updateDeltaY(n,i,e),o.updateBody(n-o.deltaY)):(o.updateDeltaY(n,i,e),o.updateBody(n-o.deltaY))}(s,o,r,t,n),i){const e=n.table.scenegraph.highPerformanceGetCell(n.colStart,n.rowEnd,!0);if("cell"===e.role){const i=e.attribute.y+e.attribute.height-(n.table.tableNoFrameHeight-n.table.getFrozenRowsHeight()-n.table.getBottomFrozenRowsHeight())-t;n.deltaY=-i,n.updateBody(t-n.deltaY)}}}))}function TL(t,e,i,n,o,r){return AL(this,void 0,void 0,(function*(){if("up"===e&&r.rowEnd+t>r.bodyBottomRow?t=r.bodyBottomRow-r.rowEnd:"down"===e&&r.rowStart-t<r.bodyTopRow&&(t=r.rowStart-r.bodyTopRow),0!==t)if(t<0&&(e="up"===e?"down":"up",t=-t),t<r.rowEnd-r.rowStart){const n="up"===e?r.rowStart:r.rowEnd-t+1,o="up"===e?r.rowStart+t-1:r.rowEnd,s="up"===e?r.rowEnd+1:r.rowStart-t,a="up"===e?r.rowEnd+t:r.rowStart-1;let l,h;r.table.isAutoRowHeight(n)?(l=s,h=a):(l=Math.max(r.bodyTopRow,i-1*r.screenRowCount),h=Math.min(r.bodyBottomRow,i+2*r.screenRowCount,r.table.rowCount-1)),pk(r.table,l,h,!1),function(t,e,i,n){for(let o=0;o<n.table.frozenColCount;o++){const r=n.table.scenegraph.getColGroup(o);if(r)for(let o=t;o<=e;o++)RL(r,i,n)}for(let o=n.table.colCount-n.table.rightFrozenColCount;o<n.table.colCount;o++){const r=n.table.scenegraph.getColGroup(o);if(r)for(let o=t;o<=e;o++)RL(r,i,n)}for(let o=n.bodyLeftCol;o<=n.bodyRightCol;o++){const r=n.table.scenegraph.getColGroup(o);if(r)for(let o=t;o<=e;o++)RL(r,i,n)}}(n,o,e,r),r.rowStart="up"===e?r.rowStart+t:r.rowStart-t,r.rowEnd="up"===e?r.rowEnd+t:r.rowEnd-t;const d=kL(l,h,r,!0);r.table.isAutoRowHeight(n)&&(_L(r.bodyLeftCol,r.bodyRightCol,l,h,r.table,a>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up",!0),_L(0,r.table.frozenColCount-1,l,h,r.table,a>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up",!0),_L(r.table.colCount-r.table.rightFrozenColCount,r.table.colCount-1,l,h,r.table,a>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up",!0)),r.currentRow="up"===e?r.currentRow+t:r.currentRow-t,r.totalRow=Math.max(0,Math.min(r.bodyBottomRow,"up"===e?r.totalRow+t:r.totalRow-t,r.table.rowCount-1)),r.referenceRow=r.rowStart+Math.floor((r.rowEnd-r.rowStart)/2),r.table.isAutoRowHeight(n)&&d?r.rowUpdatePos=Math.min(r.rowUpdatePos,r.rowEnd+1):r.rowUpdatePos=Math.min(r.rowUpdatePos,s),r.rowUpdateDirection=e,r.table.scenegraph.updateNextFrame(),yield r.progress()}else{const n="up"===e?r.rowStart+t:r.rowStart-t,o=Math.min(r.table.rowCount-1,"up"===e?r.rowEnd+t:r.rowEnd-t),s=r.table.getRowsHeight(r.bodyTopRow,n-1);let a,l;r.table.isAutoRowHeight(n)?(a=n,l=o):(a=Math.max(r.bodyTopRow,i-1*r.screenRowCount),l=Math.min(r.bodyBottomRow,i+2*r.screenRowCount,r.table.rowCount-1)),pk(r.table,a,l,!1),function(t,e,i,n){for(let o=0;o<n.table.frozenColCount;o++){const r=n.table.scenegraph.getColGroup(o);null==r||r.forEachChildren(((o,r)=>{n.updateCellGroupPosition(o,"up"===i?o.row+e:o.row-e,0===r?t:o._prev.attribute.y+n.table.getRowHeight(o._prev.row))}))}for(let o=n.table.colCount-n.table.rightFrozenColCount;o<n.table.colCount;o++){const r=n.table.scenegraph.getColGroup(o);null==r||r.forEachChildren(((o,r)=>{n.updateCellGroupPosition(o,"up"===i?o.row+e:o.row-e,0===r?t:o._prev.attribute.y+n.table.getRowHeight(o._prev.row))}))}for(let o=n.bodyLeftCol;o<=n.bodyRightCol;o++){const r=n.table.scenegraph.getColGroup(o);null==r||r.forEachChildren(((o,r)=>{n.updateCellGroupPosition(o,"up"===i?o.row+e:o.row-e,0===r?t:o._prev.attribute.y+n.table.getRowHeight(o._prev.row))}))}}(s,t,e,r),r.rowStart=n,r.rowEnd=o;const h=kL(a,l,r,!0);r.table.isAutoRowHeight(n)&&(_L(r.bodyLeftCol,r.bodyRightCol,a,l,r.table,o>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up"),_L(0,r.table.frozenColCount-1,a,l,r.table,o>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up"),_L(r.table.colCount-r.table.rightFrozenColCount,r.table.colCount-1,a,l,r.table,o>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up")),r.currentRow="up"===e?r.currentRow+t:r.currentRow-t,r.totalRow=Math.max(0,Math.min(r.bodyBottomRow,"up"===e?r.totalRow+t:r.totalRow-t,r.table.rowCount-1)),r.referenceRow=r.rowStart+Math.floor((r.rowEnd-r.rowStart)/2),r.table.isAutoRowHeight(n)&&h?r.rowUpdatePos=r.rowEnd+1:r.rowUpdatePos=r.rowStart,r.rowUpdateDirection=o>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up",r.table.scenegraph.updateNextFrame(),yield r.progress()}}))}function RL(t,e,i){if(t.childrenCount>=1)if("up"===e){const e=t.firstChild;i.updateCellGroupPosition(e,t.lastChild.row+1,t.lastChild.attribute.y+i.table.getRowHeight(t.lastChild.row)),t.appendChild(e)}else{const e=t.lastChild;i.updateCellGroupPosition(e,t.firstChild.row-1,t.firstChild.attribute.y-i.table.getRowHeight(e.row)),t.insertBefore(e,t.firstChild)}}function kL(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];for(let n=0;n<i.table.frozenColCount;n++)for(let o=t;o<=e;o++){const t=i.highPerformanceGetCell(n,o,!0);i.updateCellGroupContent(t)}for(let n=i.table.colCount-i.table.rightFrozenColCount;n<i.table.colCount;n++)for(let o=t;o<=e;o++){const t=i.highPerformanceGetCell(n,o);i.updateCellGroupContent(t)}let o=i.bodyLeftCol,r=i.bodyRightCol,s=!0;if(n){const t=i.screenLeftCol;o=Math.max(i.bodyLeftCol,t-1*i.screenColCount),r=Math.min(i.bodyRightCol,t+2*i.screenColCount),o===i.bodyLeftCol&&r===i.bodyRightCol||(s=!1)}for(let n=o;n<=r;n++)for(let o=t;o<=e;o++){const t=i.highPerformanceGetCell(n,o);i.updateCellGroupContent(t)}return ML(i.table.scenegraph.rowHeaderGroup),ML(i.table.scenegraph.rightFrozenGroup),ML(i.table.scenegraph.bodyGroup),i.table.scenegraph.updateNextFrame(),s}function ML(t){var e,i;const n=cL(t);if(!n)return;const o=cL(n);if(o&&(t.setAttribute("height",o.attribute.y+o.attribute.height),t.border)){const n=t.border;n.setAttribute("height",o.attribute.y+o.attribute.height-(null!==(e=n.attribute.borderTop)&&void 0!==e?e:0)/2-(null!==(i=n.attribute.borderBottom)&&void 0!==i?i:0)/2)}}var LL=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))};var PL=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))};function EL(t){const{changedCells:e}=t.internalProps.stick;return e.forEach((e=>{t.scenegraph.getCell(e.col,e.row).forEachChildren((t=>{t.setAttributes({dx:e.dx,dy:e.dy})}))})),e.clear(),e}function HL(t){const e=EL(t),{scrollTop:i,scrollLeft:n,frozenRowCount:o,frozenColCount:r}=t,s=t.getFrozenRowsHeight(),a=t.getFrozenColsWidth(),{row:l}=t.getRowAt(i+s+1),{col:h}=t.getColAt(n+a+1),d=Math.max(l,t.frozenRowCount),c=Math.max(h,t.frozenColCount),u=t.getAllRowsHeight()>t.tableNoFrameHeight?t.getRowAt(i+t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()-1).row:t.rowCount-t.bottomFrozenRowCount-1,g=t.getAllColsWidth()>t.tableNoFrameWidth?t.getColAt(n+t.tableNoFrameWidth-t.getRightFrozenColsWidth()-1).col:t.colCount-t.rightFrozenColCount-1;if(!(g<0||u<0)){for(let i=0;i<o&&!(g<c);i++)[c,g].forEach((n=>{const o=t._getCellStyle(n,i);(null==o?void 0:o.textStick)&&"vertical"!==(null==o?void 0:o.textStick)&&FL(t.scenegraph.getCell(n,i),a+t.tableX,t.tableNoFrameWidth-t.getRightFrozenColsWidth()+t.tableX,e,null==o?void 0:o.textStickBaseOnAlign,t)}));for(let i=0;i<r&&!(u<d);i++)[d,u].forEach((n=>{const o=t._getCellStyle(i,n);(null==o?void 0:o.textStick)&&"horizontal"!==(null==o?void 0:o.textStick)&&OL(t.scenegraph.getCell(i,n),s+t.tableY,t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()+t.tableY,e,null==o?void 0:o.textStickBaseOnAlign,t)}));for(let i=c;i<=g&&!(u<d);i++)[d,u].forEach((n=>{const o=t._getCellStyle(i,n);(null==o?void 0:o.textStick)&&"horizontal"!==(null==o?void 0:o.textStick)&&OL(t.scenegraph.getCell(i,n),s+t.tableY,t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()+t.tableY,e,null==o?void 0:o.textStickBaseOnAlign,t)}));for(let i=d;i<=u&&!(g<c);i++)[c,g].forEach((n=>{const o=t._getCellStyle(n,i);(null==o?void 0:o.textStick)&&"vertical"!==(null==o?void 0:o.textStick)&&FL(t.scenegraph.getCell(n,i),a+t.tableX,t.tableNoFrameWidth-t.getRightFrozenColsWidth()+t.tableX,e,null==o?void 0:o.textStickBaseOnAlign,t)}))}}function OL(t,e,i,n,o,r){if(tw(t.mergeStartCol)&&tw(t.mergeStartRow)&&tw(t.mergeEndCol)&&tw(t.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=wk(t,r.scenegraph);for(let t=s;t<=a;t++)for(let s=l;s<=h;s++){const a=r.scenegraph.getCell(t,s);"cell"===a.role&&IL(a,e,i,n,o)}}else IL(t,e,i,n,o)}function IL(t,e,i,n,o){var r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w;const x=t.getChildByName("text",!0)||t.getChildByName("image",!0);if(!x)return;if("image"===x.type){const{image:t}=x.attribute;if(!t||!x.resources)return;if("success"!==x.resources.get(t).state)return}const _=null!==(r=x.textBaseline)&&void 0!==r?r:"top";x.AABBBounds.width();const S=x.globalAABBBounds.y1,A=x.globalAABBBounds.y2;if("middle"===_&&o){const o=t.globalAABBBounds.y1+(null!==(a=null===(s=t.firstChild)||void 0===s?void 0:s.attribute.dy)&&void 0!==a?a:0),r=o+(null!==(h=null!==(l=t.contentHeight)&&void 0!==l?l:t.attribute.height)&&void 0!==h?h:0);if(o<e||r>i){const s=Math.max(o,e),a=Math.min(r,i),l=x.globalTransMatrix.f-(a+s)/2+x.AABBBounds.height()/2;!n.has(`${t.col}-${t.row}`)&&n.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:null!==(c=null===(d=t.firstChild)||void 0===d?void 0:d.attribute.dx)&&void 0!==c?c:0,dy:null!==(g=null===(u=t.firstChild)||void 0===u?void 0:u.attribute.dy)&&void 0!==g?g:0}),t.forEachChildren((t=>{var e;t.setAttribute("dy",(null!==(e=t.attribute.dy)&&void 0!==e?e:0)-l+2)}))}}else if(S<e){const i=S-e;!n.has(`${t.col}-${t.row}`)&&n.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:null!==(f=null===(p=t.firstChild)||void 0===p?void 0:p.attribute.dx)&&void 0!==f?f:0,dy:null!==(b=null===(v=t.firstChild)||void 0===v?void 0:v.attribute.dy)&&void 0!==b?b:0}),t.forEachChildren((t=>{var e;t.setAttribute("dy",(null!==(e=t.attribute.dy)&&void 0!==e?e:0)-i+2)}))}else if(A>i){const e=A-i;!n.has(`${t.col}-${t.row}`)&&n.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:null!==(y=null===(m=t.firstChild)||void 0===m?void 0:m.attribute.dx)&&void 0!==y?y:0,dy:null!==(w=null===(C=t.firstChild)||void 0===C?void 0:C.attribute.dy)&&void 0!==w?w:0}),t.forEachChildren((t=>{var i;t.setAttribute("dy",(null!==(i=t.attribute.dy)&&void 0!==i?i:0)-e)}))}}function FL(t,e,i,n,o,r){if(tw(t.mergeStartCol)&&tw(t.mergeStartRow)&&tw(t.mergeEndCol)&&tw(t.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=wk(t,r.scenegraph);for(let t=s;t<=a;t++)for(let s=l;s<=h;s++){const a=r.scenegraph.getCell(t,s);"cell"===a.role&&zL(a,e,i,n,o)}}else zL(t,e,i,n,o)}function zL(t,e,i,n,o){var r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x;const _=t.getChildByName("text",!0)||t.getChildByName("image",!0);if(!_)return;if("image"===_.type){const{image:t}=_.attribute;if(!t||!_.resources)return;if("success"!==_.resources.get(t).state)return}const S=null!==(s=null!==(r=_.attribute.textAlign)&&void 0!==r?r:_.textAlign)&&void 0!==s?s:"left";_.AABBBounds.width();const A=_.globalAABBBounds.x1,B=_.globalAABBBounds.x2;if("center"===S&&o){const o=t.globalAABBBounds.x1+(null!==(l=null===(a=t.firstChild)||void 0===a?void 0:a.attribute.dx)&&void 0!==l?l:0),r=o+(null!==(d=null!==(h=t.contentWidth)&&void 0!==h?h:t.attribute.width)&&void 0!==d?d:0);if(o<e||r>i){const s=Math.max(o,e),a=Math.min(r,i),l=_.globalTransMatrix.e-(a+s)/2;!n.has(`${t.col}-${t.row}`)&&n.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:null!==(u=null===(c=t.firstChild)||void 0===c?void 0:c.attribute.dx)&&void 0!==u?u:0,dy:null!==(p=null===(g=t.firstChild)||void 0===g?void 0:g.attribute.dy)&&void 0!==p?p:0}),t.forEachChildren((t=>{var e;t.setAttribute("dx",(null!==(e=t.attribute.dx)&&void 0!==e?e:0)-l+2)}))}}else if(A<e){const i=A-e;!n.has(`${t.col}-${t.row}`)&&n.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:null!==(v=null===(f=t.firstChild)||void 0===f?void 0:f.attribute.dx)&&void 0!==v?v:0,dy:null!==(m=null===(b=t.firstChild)||void 0===b?void 0:b.attribute.dy)&&void 0!==m?m:0}),t.forEachChildren((t=>{var e;t.setAttribute("dx",(null!==(e=t.attribute.dx)&&void 0!==e?e:0)-i+2)}))}else if(B>i){const e=B-i;!n.has(`${t.col}-${t.row}`)&&n.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:null!==(C=null===(y=t.firstChild)||void 0===y?void 0:y.attribute.dx)&&void 0!==C?C:0,dy:null!==(x=null===(w=t.firstChild)||void 0===w?void 0:w.attribute.dy)&&void 0!==x?x:0}),t.forEachChildren((t=>{var i;t.setAttribute("dx",(null!==(i=t.attribute.dx)&&void 0!==i?i:0)-e)}))}}function DL(t){var e,i;const n=t.internalProps.layoutMap.headerObjects,o=t.internalProps.layoutMap.columnObjects;for(let t=0;t<n.length;t++){const i=n[t];if(i&&(null===(e=i.style)||void 0===e?void 0:e.textStick))return!0}for(let t=0;t<o.length;t++){const e=o[t];if(e&&(null===(i=e.style)||void 0===i?void 0:i.textStick))return!0}return!!(t.theme.headerStyle.textStick||t.theme.rowHeaderStyle.textStick||t.theme.bodyStyle.textStick)}var WL=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))};class NL{constructor(t){this.isRelease=!1,this.mode="column",this.rowLimit=200,this.currentRow=0,this.rowStart=0,this.rowEnd=0,this.referenceRow=0,this.screenTopRow=0,this.deltaY=0,this.deltaHeight=0,this.colLimit=100,this.screenLeftCol=0,this.deltaX=0,this.deltaWidth=0,this.cellCache=new Map,this.table=t,this.table.isPivotChart()?(this.rowLimit=Math.max(100,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight)),this.colLimit=Math.max(100,Math.ceil(2*t.tableNoFrameWidth/t.defaultColWidth))):this.table.isAutoRowHeight(t.columnHeaderLevelCount)?this.rowLimit=Math.max(100,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight)):("autoWidth"===this.table.widthMode||(this.rowLimit=Math.max(200,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight))),this.colLimit=Math.max(100,Math.ceil(2*t.tableNoFrameWidth/t.defaultColWidth))),this.table.internalProps.transpose?this.mode="row":this.table.isPivotTable()&&(this.mode="pivot"),this.table.options.maintainedDataCount&&(this.rowLimit=this.table.options.maintainedDataCount),this.table.options.maintainedColumnCount&&(this.colLimit=this.table.options.maintainedColumnCount),"adaptive"===this.table.heightMode&&(this.rowLimit=this.table.rowCount),"adaptive"===this.table.widthMode&&(this.colLimit=this.table.colCount)}get bodyLeftCol(){return this.table.frozenColCount}get bodyTopRow(){return this.table.frozenRowCount}setParamsForColumn(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const t=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=t,this.totalCol=this.bodyLeftCol+t-1,this.colStart=this.bodyLeftCol,this.colEnd=this.totalCol;const e=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/e);const i=e*t,n=e*(this.bodyRightCol-this.bodyLeftCol+1);this.xLimitLeft=i/2,this.xLimitRight=n-i/2;const o=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/e),this.firstScreenColLimit=Math.max(15,this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(o/e))),this.colUpdatePos=this.bodyRightCol}setParamsForRow(){this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const t=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=t,this.totalRow=this.bodyTopRow+t-1,this.rowStart=this.bodyTopRow,this.rowEnd=this.totalRow;const e=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/e);const i=e*t,n=e*(this.bodyBottomRow-this.bodyTopRow+1);this.yLimitTop=i/2,this.yLimitBottom=n-i/2;const o=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/e),this.firstScreenRowLimit=Math.max(30,this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(o/e))),this.rowUpdatePos=this.bodyBottomRow}refreshRowCount(){this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const t=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=t,this.totalRow=this.rowStart+t-1}refreshColCount(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const t=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=t,this.totalCol=this.bodyLeftCol+t-1,this.colStart=this.bodyLeftCol,this.colEnd=this.totalCol}resize(){const t=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/t);const e=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/t),this.firstScreenColLimit=this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(e/t));const i=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/i);const n=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/i),this.firstScreenRowLimit=this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(n/i))}createGroupForFirstScreen(t,e,i,n,o,r,s,a){!function(t,e,i,n,o,r,s,a,l){var h,d,c,u,g,p,f,v,b,m,y,C;const{table:w}=l,{leftBottomCornerGroup:x,rightTopCornerGroup:_,rightBottomCornerGroup:S}=w.scenegraph;let A,B,T,R;l.setParamsForRow(),l.setParamsForColumn(),"adaptive"===w.widthMode||w.options.autoWrapText&&("adaptive"===w.heightMode||w.isAutoRowHeight(w.columnHeaderLevelCount))?(T=w.colCount-1,A=Math.min(l.firstScreenColLimit-1,w.colCount-1)):A=Math.min(l.firstScreenColLimit-1,w.colCount-1),"adaptive"===w.heightMode?(R=w.rowCount-1,B=Math.min(l.firstScreenRowLimit-1,w.rowCount-1)):B=Math.min(l.firstScreenRowLimit-1,w.rowCount-1),0===w.internalProps._widthResizedColMap.size&&ZM(w,0,null!=T?T:A),0===w.internalProps._heightResizedRowMap.size&&pk(w,0,"auto"===w.options.canvasHeight?w.rowCount-1:null!=R?R:B),A<w.colCount-w.rightFrozenColCount&&w.colCount-w.rightFrozenColCount<=w.colCount-1&&ZM(w,w.colCount-w.rightFrozenColCount,w.colCount-1),B<w.rowCount-w.bottomFrozenRowCount&&w.rowCount-w.bottomFrozenRowCount<=w.rowCount-1&&pk(w,w.rowCount-w.bottomFrozenRowCount,w.rowCount-1),w.scenegraph.colHeaderGroup.setAttribute("x",w.getFrozenColsWidth()),w.scenegraph.rowHeaderGroup.setAttribute("y",w.getFrozenRowsHeight()),w.scenegraph.bottomFrozenGroup.setAttribute("x",w.getFrozenColsWidth()),w.scenegraph.rightFrozenGroup.setAttribute("y",w.getFrozenRowsHeight()),w.scenegraph.bodyGroup.setAttributes({x:w.getFrozenColsWidth(),y:w.getFrozenRowsHeight()}),hL(t,s,a,0,w.frozenColCount-1,0,w.frozenRowCount-1,w.isListTable()?"columnHeader":"cornerHeader",w),A-w.rightFrozenColCount>=w.frozenColCount&&hL(e,s,a,w.frozenColCount,A-w.rightFrozenColCount,0,w.frozenRowCount-1,"columnHeader",w),w.frozenColCount>0&&(w.leftRowSeriesNumberCount>0&&hL(i,s,a,0,w.leftRowSeriesNumberCount-1,w.frozenRowCount,B-w.bottomFrozenRowCount,"rowHeader",w),w.frozenColCount>w.leftRowSeriesNumberCount&&hL(i,s,a,w.leftRowSeriesNumberCount,Math.min(w.frozenColCount-1,w.rowHeaderLevelCount+w.leftRowSeriesNumberCount-1),w.frozenRowCount,B-w.bottomFrozenRowCount,"rowHeader",w),w.frozenColCount>w.rowHeaderLevelCount+w.leftRowSeriesNumberCount&&hL(i,s,a,w.rowHeaderLevelCount+w.leftRowSeriesNumberCount,w.frozenColCount-1,w.frozenRowCount,B-w.bottomFrozenRowCount,"body",w)),w.bottomFrozenRowCount>0&&(w.frozenColCount>0&&(w.leftRowSeriesNumberCount>0&&hL(x,s,a,0,w.leftRowSeriesNumberCount-1,w.rowCount-1-w.bottomFrozenRowCount+1,w.rowCount-1,"rowHeader",w),w.rowHeaderLevelCount>0&&hL(x,s,a,w.leftRowSeriesNumberCount,w.leftRowSeriesNumberCount+w.rowHeaderLevelCount-1,w.rowCount-1-w.bottomFrozenRowCount+1,w.rowCount-1,"rowHeader",w),w.frozenColCount>w.rowHeaderLevelCount+w.leftRowSeriesNumberCount&&hL(x,s,a,w.rowHeaderLevelCount+w.leftRowSeriesNumberCount,w.frozenColCount-1,w.rowCount-1-w.bottomFrozenRowCount+1,w.rowCount-1,"body",w)),A-w.rightFrozenColCount>=w.frozenColCount&&hL(o,s,a,w.frozenColCount,A-w.rightFrozenColCount,w.rowCount-1-w.bottomFrozenRowCount+1,w.rowCount-1,w.isPivotChart()?"rowHeader":"body",w)),w.rightFrozenColCount>0&&(hL(_,s,a,w.colCount-1-w.rightFrozenColCount+1,w.colCount-1,0,w.frozenRowCount-1,"columnHeader",w),hL(n,s,a,w.colCount-1-w.rightFrozenColCount+1,w.colCount-1,w.frozenRowCount,B-w.bottomFrozenRowCount,w.isPivotChart()?"rowHeader":"body",w)),w.bottomFrozenRowCount>0&&w.rightFrozenColCount>0&&hL(S,s,a,w.colCount-1-w.rightFrozenColCount+1,w.colCount-1,w.rowCount-1-w.bottomFrozenRowCount+1,w.rowCount-1,"body",w),A-w.rightFrozenColCount>=w.frozenColCount&&hL(r,s,a,w.frozenColCount,A-w.rightFrozenColCount,w.frozenRowCount,B-w.bottomFrozenRowCount,"body",w),r.firstChild||e.firstChild||t.firstChild||i.firstChild?(l.currentRow=null!==(u=null!==(d=null===(h=r.firstChild)||void 0===h?void 0:h.rowNumber)&&void 0!==d?d:null===(c=i.firstChild)||void 0===c?void 0:c.rowNumber)&&void 0!==u?u:l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=null!==(C=null!==(m=null!==(v=null!==(p=null===(g=r.lastChild)||void 0===g?void 0:g.col)&&void 0!==p?p:null===(f=e.lastChild)||void 0===f?void 0:f.col)&&void 0!==v?v:null===(b=i.lastChild)||void 0===b?void 0:b.col)&&void 0!==m?m:null===(y=t.lastChild)||void 0===y?void 0:y.col)&&void 0!==C?C:l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2),l.progress()):(l.currentRow=l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2))}(t,e,i,n,o,r,s,a,this)}progress(){return WL(this,void 0,void 0,(function*(){if(!this.isProgressing)return this.isProgressing=!0,new Promise(((t,e)=>{setTimeout((()=>WL(this,void 0,void 0,(function*(){this.isProgressing=!1,this.isRelease||(this.colUpdatePos<=this.colEnd?(yield this.updateColCellGroupsAsync(),yield this.progress()):this.rowUpdatePos<=this.rowEnd?(yield this.updateRowCellGroupsAsync(),yield this.progress()):this.currentCol<this.totalCol?(yield this.createCol(),yield this.progress()):this.currentRow<this.totalRow&&(yield this.createRow(),yield this.progress()),HL(this.table),this.table.scenegraph.updateNextFrame(),t())}))),16)}))}))}createRow(){return WL(this,void 0,void 0,(function*(){this.taskRowCount&&this.createRowCellGroup(this.taskRowCount)}))}createCol(){return WL(this,void 0,void 0,(function*(){this.taskColCount&&this.createColGroup(this.taskRowCount)}))}createRowCellGroup(t){const e=Math.min(this.totalRow,this.currentRow+t);if("adaptive"!==this.table.heightMode&&pk(this.table,this.currentRow+1,e,!1),this.rowEnd=e,this.table.frozenColCount){let t=0;for(let i=0;i<this.table.frozenColCount;i++){const n=this.table.scenegraph.getColGroup(i),{height:o}=(this.table.isListTable(),rL(n,i,n.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table));t=Math.max(t,o),this.table.scenegraph.rowHeaderGroup.setAttribute("height",t)}}if(this.table.rightFrozenColCount){let t=0;for(let i=this.table.colCount-this.table.rightFrozenColCount;i<this.table.colCount;i++){const n=this.table.scenegraph.getColGroup(i),{height:o}=(this.table.isPivotChart(),rL(n,i,n.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table));t=Math.max(t,o),this.table.scenegraph.rightFrozenGroup.setAttribute("height",t)}}let i=0;for(let t=this.bodyLeftCol;t<=this.bodyRightCol;t++){const n=this.table.scenegraph.getColGroup(t);if(!n)continue;this.table.rowHeaderLevelCount;const{height:o}=rL(n,t,n.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table);i=Math.max(i,o)}this.table.scenegraph.bodyGroup.setAttribute("height",i),this.currentRow=e,this.rowUpdatePos=this.rowEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}createColGroup(t){const e=Math.min(this.totalCol,this.currentCol+t);"adaptive"!==this.table.widthMode&&ZM(this.table,this.currentCol+1,e),this.colEnd=e;for(let t=0;t<this.table.rowCount;t++){const e=this.highPerformanceGetCell(this.currentCol,t);"cell"===e.role&&tw(e.mergeStartCol)&&e.mergeStartCol>this.currentCol&&this.table.scenegraph.updateCellContent(e.col,e.row)}if(this.table.frozenRowCount){const t=this.table.scenegraph.colHeaderGroup.lastChild instanceof xR?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev,i=t.attribute.x+t.attribute.width,n=t.attribute.y;hL(this.table.scenegraph.colHeaderGroup,i,n,this.currentCol+1,e,0,this.table.frozenRowCount-1,"columnHeader",this.table)}if(this.table.bottomFrozenRowCount){const t=this.table.scenegraph.bottomFrozenGroup.lastChild instanceof xR?this.table.scenegraph.bottomFrozenGroup.lastChild:this.table.scenegraph.bottomFrozenGroup.lastChild._prev,i=t.attribute.x+t.attribute.width,n=t.attribute.y;hL(this.table.scenegraph.bottomFrozenGroup,i,n,this.currentCol+1,e,this.table.rowCount-this.table.bottomFrozenRowCount,this.table.rowCount-1,"columnHeader",this.table)}let i=this.table.scenegraph.bodyGroup.lastChild&&(this.table.scenegraph.bodyGroup.lastChild instanceof xR?this.table.scenegraph.bodyGroup.lastChild:this.table.scenegraph.bodyGroup.lastChild._prev);i||(i=this.table.scenegraph.colHeaderGroup.lastChild&&(this.table.scenegraph.colHeaderGroup.lastChild instanceof xR?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev));const n=i.attribute.x+i.attribute.width,o=i.attribute.y;hL(this.table.scenegraph.bodyGroup,n,o,this.currentCol+1,e,this.rowStart,this.rowEnd,"body",this.table),this.currentCol=e,this.colUpdatePos=this.colEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}setY(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return WL(this,void 0,void 0,(function*(){const i=this.table.getRowsHeight(this.bodyTopRow,this.bodyTopRow+(this.rowEnd-this.rowStart+1))/2,n=this.table.getAllRowsHeight()-i,o=this.table.getTargetRowAt(t+this.table.scenegraph.colHeaderGroup.attribute.height);o&&(this.screenTopRow=o.row),t<i&&this.rowStart===this.bodyTopRow||t>n&&this.rowEnd===this.bodyBottomRow?(this.updateDeltaY(t),this.updateBody(t-this.deltaY)):this.table.scenegraph.bodyGroup.firstChild&&"group"===this.table.scenegraph.bodyGroup.firstChild.type&&0!==this.table.scenegraph.bodyGroup.firstChild.childrenCount||this.table.scenegraph.rowHeaderGroup.firstChild&&"group"===this.table.scenegraph.rowHeaderGroup.firstChild.type&&0!==this.table.scenegraph.rowHeaderGroup.firstChild.childrenCount?this.dynamicSetY(t,o,e):(this.updateDeltaY(t),this.updateBody(t-this.deltaY))}))}setX(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return WL(this,void 0,void 0,(function*(){const i=this.table.getColsWidth(this.bodyLeftCol,this.bodyLeftCol+(this.colEnd-this.colStart+1))/2,n=this.table.getAllColsWidth()-i,o=this.table.getTargetColAt(t+this.table.scenegraph.rowHeaderGroup.attribute.width);o&&(this.screenLeftCol=o.col),t<i&&this.colStart===this.bodyLeftCol||t>n&&this.colEnd===this.bodyRightCol||this.table.scenegraph.bodyGroup.firstChild&&"group"===this.table.scenegraph.bodyGroup.firstChild.type&&0===this.table.scenegraph.bodyGroup.firstChild.childrenCount?(this.updateDeltaX(t),this.table.scenegraph.setBodyAndColHeaderX(-t+this.deltaX)):this.dynamicSetX(t,o,e)}))}dynamicSetY(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return WL(this,void 0,void 0,(function*(){BL(t,e,i,this)}))}dynamicSetX(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return WL(this,void 0,void 0,(function*(){fL(t,e,i,this)}))}updateBody(t){this.table.scenegraph.setBodyAndRowHeaderY(-t)}updateRowCellGroupsAsync(){return WL(this,void 0,void 0,(function*(){this.updateCellGroups(this.taskRowCount)}))}updateCellGroups(t){const e=Math.min(this.bodyBottomRow,this.rowUpdatePos+t);this.table.isAutoRowHeight(this.rowUpdatePos)&&pk(this.table,this.rowUpdatePos,e,!1),kL(this.rowUpdatePos,e,this),this.table.isAutoRowHeight(this.rowUpdatePos)&&(_L(this.bodyLeftCol,this.bodyRightCol,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),_L(0,this.table.frozenColCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),_L(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0)),this.rowUpdatePos=e+1}updateBottomFrozenCellGroups(){const t=this.table.rowCount-this.table.bottomFrozenRowCount,e=this.table.rowCount-1;this.table.isAutoRowHeight(t)&&pk(this.table,t,e,!1),kL(t,e,this),this.table.isAutoRowHeight(t)&&(_L(this.bodyLeftCol,this.bodyRightCol,t,e,this.table,this.rowUpdateDirection),_L(0,this.table.frozenColCount-1,t,e,this.table,this.rowUpdateDirection),_L(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,t,e,this.table,this.rowUpdateDirection))}updateRightFrozenCellGroups(){const t=this.table.colCount-this.table.rightFrozenColCount,e=this.table.colCount-1;"autoWidth"===this.table.widthMode&&ZM(this.table,t,e,!1),wL(t,e,this),this.table.isAutoRowHeight(this.rowStart)&&uL(t,e,this.table,this.colUpdateDirection)}updateColCellGroupsAsync(){return WL(this,void 0,void 0,(function*(){this.updateColGroups(this.taskRowCount)}))}updateColGroups(t){const e=Math.min(this.bodyRightCol,this.colUpdatePos+t);"autoWidth"===this.table.widthMode&&ZM(this.table,this.colUpdatePos,e),wL(this.colUpdatePos,e,this),this.colUpdatePos=e+1}updateCellGroupPosition(t,e,i){t.row=e,t.mergeStartCol=void 0,t.mergeStartRow=void 0,t.mergeEndCol=void 0,t.mergeEndRow=void 0,t.setAttribute("y",i),t.needUpdate=!0,t.needUpdateForAutoRowHeight=!0}updateCellGroupContent(t){if(!t.needUpdate||"cell"!==t.role)return t;const e=this.table.scenegraph.updateCellContent(t.col,t.row);return t.needUpdate=!1,e||t}sortCellVertical(){return WL(this,void 0,void 0,(function*(){yield function(t){var e;return LL(this,void 0,void 0,(function*(){let i,n;t.table.scenegraph.bodyGroup.forEachChildren(((t,e)=>{"group"===t.type&&(t.needUpdate=!0,null==t||t.forEachChildren((t=>{t.needUpdate=!0})))})),t.table.isAutoRowHeight(t.rowStart)?(i=t.rowStart,n=t.rowEnd):(i=Math.max(t.bodyTopRow,t.screenTopRow-1*t.screenRowCount),n=Math.min(t.bodyBottomRow,t.screenTopRow+2*t.screenRowCount,t.table.rowCount-1));const o=t.table.getAllRowsHeight();pk(t.table,i,n);const r=t.table.getAllRowsHeight();o!==r&&t.table.scenegraph.updateContainerHeight(t.table.frozenRowCount,r-o);for(let i=0;i<(null!==(e=t.table.frozenColCount)&&void 0!==e?e:0);i++){const e=t.table.scenegraph.getColGroup(i);null==e||e.setAttribute("chartInstance",void 0);for(let e=t.rowStart;e<=t.rowEnd;e++)t.table.scenegraph.updateCellContent(i,e);for(let e=t.table.rowCount-t.table.bottomFrozenRowCount;e<t.table.rowCount;e++)t.table.scenegraph.updateCellContent(i,e)}for(let e=t.colStart;e<=t.colEnd;e++){const i=t.table.scenegraph.getColGroup(e);null==i||i.setAttribute("chartInstance",void 0);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}for(let e=t.table.colCount-t.table.rightFrozenColCount;e<t.table.colCount;e++){const i=t.table.scenegraph.getColGroup(e);null==i||i.setAttribute("chartInstance",void 0);for(let i=t.rowStart;i<=t.rowEnd;i++)t.table.scenegraph.updateCellContent(e,i);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}kL(i,n,t),t.table.isAutoRowHeight(i)&&_L(t.bodyLeftCol,t.bodyRightCol,i,n,t.table,t.rowEnd>t.bodyBottomRow-(t.rowEnd-t.rowStart+1)?"down":"up"),t.rowUpdatePos=t.rowStart,t.rowUpdateDirection=t.rowEnd>t.bodyBottomRow-(t.rowEnd-t.rowStart+1)?"down":"up",t.table.scenegraph.updateNextFrame(),t.table.isAutoRowHeight(t.rowStart)||(yield t.progress())}))}(this)}))}sortCellHorizontal(){return WL(this,void 0,void 0,(function*(){yield function(t){return PL(this,void 0,void 0,(function*(){t.table.scenegraph.bodyGroup.forEachChildren(((t,e)=>{"group"===t.type&&(t.needUpdate=!0,null==t||t.forEachChildren((t=>{t.needUpdate=!0})))}));const e=Math.max(t.bodyLeftCol,t.screenLeftCol-1*t.screenColCount),i=Math.min(t.bodyRightCol,t.screenLeftCol+2*t.screenColCount);ZM(t.table,e,i);for(let e=t.colStart;e<=t.colEnd;e++){const i=t.table.scenegraph.getColGroup(e);null==i||i.setAttribute("chartInstance",void 0);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}for(let e=t.table.colCount-t.table.rightFrozenColCount;e<t.table.colCount;e++){const i=t.table.scenegraph.getColGroup(e);null==i||i.setAttribute("chartInstance",void 0);for(let i=t.rowStart;i<=t.rowEnd;i++)t.table.scenegraph.updateCellContent(e,i);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}wL(e,i,t),t.colUpdatePos=t.colStart,t.colUpdateDirection=t.colEnd>t.bodyRightCol-(t.colEnd-t.colStart+1)?"right":"left",t.table.scenegraph.updateNextFrame(),yield t.progress()}))}(this)}))}highPerformanceGetCell(t,e,i){if(e>=this.table.frozenRowCount&&e<this.table.rowCount-this.table.bottomFrozenRowCount&&(e<this.rowStart||e>this.rowEnd))return oL;if(t>=this.table.frozenColCount&&t<this.table.colCount-this.table.rightFrozenColCount&&(t<this.colStart||t>this.colEnd))return oL;if(this.cellCache.get(t)){const n=this.cellCache.get(t);if((n._next||n._prev)&&Math.abs(n.row-e)<e){let o=GL(n,e);return o&&(i||"shadow-cell"!==o.role)||(o=this.table.scenegraph.getCell(t,e,i)),o.row&&this.cellCache.set(t,o),o}const o=this.table.scenegraph.getCell(t,e,i);return o.col===t&&o.row&&this.cellCache.set(t,o),o}const n=this.table.scenegraph.getCell(t,e,i);return n.col===t&&n.row&&this.cellCache.set(t,n),n}updateDeltaY(t,e,i){if(this.rowStart===this.bodyTopRow){const t=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowStart,!0);if("cell"===t.role){const e=t.attribute.y;this.deltaY=-e}}else if(this.rowEnd===this.bodyBottomRow){const t=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowEnd,!0);if("cell"===t.role){const e=t.attribute.y+t.attribute.height-(this.table.getAllRowsHeight()-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight());this.deltaY=-e}}else if(XC(e)&&XC(i)){let n=this.table.scenegraph.highPerformanceGetCell(this.colStart,i,!0);"cell"!==n.role&&(n=this.table.scenegraph.highPerformanceGetCell(0,i,!0));const o=t-this.deltaY,r=e-o,s=n.attribute.y-o+this.table.getFrozenRowsHeight();this.deltaY=r-s}}updateDeltaX(t,e,i){if(this.colStart===this.bodyLeftCol){const t=this.table.scenegraph.getColGroup(this.colStart);if(t){const e=t.attribute.x;this.deltaX=-e}}else if(this.colEnd===this.bodyRightCol){const t=this.table.scenegraph.getColGroup(this.colEnd);if(t){const e=t.attribute.x+t.attribute.width-(this.table.getAllColsWidth()-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth());this.deltaX=-e}}else if(XC(e)&&XC(i)){const n=this.table.scenegraph.getColGroup(i)||this.table.scenegraph.getColGroup(i,!0),o=t-this.deltaX,r=e-o,s=n.attribute.x-o+this.table.getFrozenColsWidth();this.deltaX=r-s}}release(){this.isRelease=!0}}function GL(t,e){if(!t)return null;if(t.row===e)return t;const i=t._prev,n=t._next;return t.row>e&&i&&i.row===t.row-1?GL(i,e):t.row<e&&n&&n.row===t.row+1?GL(n,e):null}function jL(t){t.customSelectedRangeComponents.forEach(((e,i)=>{VL(e,i,t)})),t.selectingRangeComponents.forEach(((e,i)=>{VL(e,i,t)})),t.selectedRangeComponents.forEach(((e,i)=>{VL(e,i,t)}))}function VL(t,e,i){var n,o,r,s,a,l,h,d,c,u;const g=i.table,[p,f,v,b]=e.split("-"),m=parseInt(p,10),y=parseInt(f,10),C=parseInt(v,10),w=parseInt(b,10);let x,_=m,S=y,A=C,B=w;switch(t.role){case"rowHeader":x=g.getBodyVisibleRowRange(),x&&(S=Math.max(y,x.rowStart-1),B=Math.min(w,x.rowEnd+1));break;case"columnHeader":case"bottomFrozen":x=g.getBodyVisibleCellRange(),x&&(_=Math.max(m,x.colStart-1),A=Math.min(C,x.colEnd+1));break;case"cornerHeader":case"rightTopCorner":case"leftBottomCorner":case"rightBottomCorner":break;case"rightFrozen":x=g.getBodyVisibleCellRange(),x&&(S=Math.max(y,x.rowStart-1),B=Math.min(w,x.rowEnd+1));break;default:x=g.getBodyVisibleCellRange(),x&&(S=Math.max(y,x.rowStart-1),B=Math.min(w,x.rowEnd+1),_=Math.max(m,x.colStart-1),A=Math.min(C,x.colEnd+1))}const T=g.getColsWidth(_,A),R=g.getRowsHeight(S,B),k=i.highPerformanceGetCell(_,S).globalAABBBounds;if(t.rect.setAttributes({x:k.x1-i.tableGroup.attribute.x,y:k.y1-i.tableGroup.attribute.y,width:T,height:R,visible:!0}),t.fillhandle){const e=null===(n=i.table.options.excelOptions)||void 0===n?void 0:n.fillHandle;let r,s=!0;"function"==typeof e&&(s=e({selectRanges:i.table.stateManager.select.ranges,table:i.table})),r=A<g.colCount-1?i.highPerformanceGetCell(A,B).globalAABBBounds:i.highPerformanceGetCell(_-1,B).globalAABBBounds;const a=r.x2-i.tableGroup.attribute.x-3;r=B<g.rowCount-1?i.highPerformanceGetCell(A,B).globalAABBBounds:i.highPerformanceGetCell(A,S-1).globalAABBBounds;const l=r.y2-i.tableGroup.attribute.y-3;null===(o=t.fillhandle)||void 0===o||o.setAttributes({x:a,y:l,width:6,height:6,visible:s})}let M=!!g.frozenColCount&&m===g.frozenColCount;!M&&g.frozenColCount&&g.scrollLeft>0&&m>=g.frozenColCount&&g.getColsWidth(0,m-1)-g.scrollLeft<g.getFrozenColsWidth()&&(M=!0);let L=!!g.rightFrozenColCount&&g.rightFrozenColCount>0&&C===g.colCount-g.rightFrozenColCount-1;!L&&g.rightFrozenColCount&&C<g.colCount-g.rightFrozenColCount&&g.getColsWidth(0,C)-g.scrollLeft>g.tableNoFrameWidth-g.getRightFrozenColsWidth()&&(L=!0);let P=!g.frozenRowCount||y===g.frozenRowCount;!P&&g.frozenRowCount&&g.scrollTop>0&&y>=g.frozenRowCount&&g.getRowsHeight(0,y-1)-g.scrollTop<g.getFrozenRowsHeight()&&(P=!0);let E=!!g.bottomFrozenRowCount&&w===g.rowCount-g.bottomFrozenRowCount-1;!E&&g.bottomFrozenRowCount&&w<g.rowCount-g.bottomFrozenRowCount&&g.getRowsHeight(0,w)-g.scrollTop>g.tableNoFrameHeight-g.getBottomFrozenRowsHeight()&&(E=!0);const{dynamicUpdateSelectionSize:H}=g.theme.selectionStyle;if(M&&(t.rect.attribute.stroke[3]||H)||L&&(t.rect.attribute.stroke[1]||H)||P&&(t.rect.attribute.stroke[0]||H)||E&&(t.rect.attribute.stroke[2]||H)){if(M&&t.rect.attribute.stroke[3]&&i.tableGroup.insertAfter(t.rect,"columnHeader"===t.role?i.cornerHeaderGroup:"bottomFrozen"===t.role?i.leftBottomCornerGroup:i.rowHeaderGroup),E&&t.rect.attribute.stroke[2]&&i.tableGroup.insertAfter(t.rect,"rowHeader"===t.role?i.leftBottomCornerGroup:"rightFrozen"===t.role?i.rightBottomCornerGroup:i.bottomFrozenGroup),P&&t.rect.attribute.stroke[0]&&i.tableGroup.insertAfter(t.rect,"rowHeader"===t.role?i.cornerHeaderGroup:"rightFrozen"===t.role?i.rightTopCornerGroup:i.colHeaderGroup),L&&t.rect.attribute.stroke[1]&&i.tableGroup.insertAfter(t.rect,"columnHeader"===t.role?i.rightTopCornerGroup:"bottomFrozen"===t.role?i.rightBottomCornerGroup:i.rightFrozenGroup),t.rect.attribute.x<g.getFrozenColsWidth()&&g.scrollLeft>0&&("body"===t.role||"columnHeader"===t.role||"bottomFrozen"===t.role)){const e=t.rect.attribute.width-(g.getFrozenColsWidth()-t.rect.attribute.x);t.rect.setAttributes({x:t.rect.attribute.x+(g.getFrozenColsWidth()-t.rect.attribute.x),width:e>0?e:0}),null===(r=t.fillhandle)||void 0===r||r.setAttributes({visible:e>0})}if(g.getRightFrozenColsWidth()>0&&i.rightFrozenGroup.attribute.height>0&&t.rect.attribute.x+t.rect.attribute.width>i.rightFrozenGroup.attribute.x&&("body"===t.role||"columnHeader"===t.role||"bottomFrozen"===t.role)){const e=i.rightFrozenGroup.attribute.x-t.rect.attribute.x;t.rect.setAttributes({x:t.rect.attribute.x,width:e>0?e:0}),null===(s=t.fillhandle)||void 0===s||s.setAttributes({visible:e-T>0})}if(t.rect.attribute.y<i.colHeaderGroup.attribute.height&&g.scrollTop>0&&("body"===t.role||"rowHeader"===t.role||"rightFrozen"===t.role)){const e=t.rect.attribute.height-(i.colHeaderGroup.attribute.height-t.rect.attribute.y);t.rect.setAttributes({y:t.rect.attribute.y+(i.colHeaderGroup.attribute.height-t.rect.attribute.y),height:e>0?e:0}),null===(a=t.fillhandle)||void 0===a||a.setAttributes({visible:e>0})}if(i.bottomFrozenGroup.attribute.width>0&&i.bottomFrozenGroup.attribute.height>0&&t.rect.attribute.y+t.rect.attribute.height>i.bottomFrozenGroup.attribute.y&&("body"===t.role||"rowHeader"===t.role||"rightFrozen"===t.role)){const e=i.bottomFrozenGroup.attribute.y-t.rect.attribute.y;t.rect.setAttributes({y:t.rect.attribute.y,height:e>0?e:0}),null===(l=t.fillhandle)||void 0===l||l.setAttributes({visible:e-R>0})}}else i.tableGroup.insertAfter(t.rect,"body"===t.role?i.bodyGroup:"columnHeader"===t.role?i.colHeaderGroup:"rowHeader"===t.role?i.rowHeaderGroup:"cornerHeader"===t.role?i.cornerHeaderGroup:"rightTopCorner"===t.role?i.rightTopCornerGroup:"rightFrozen"===t.role?i.rightFrozenGroup:"leftBottomCorner"===t.role?i.leftBottomCornerGroup:"bottomFrozen"===t.role?i.bottomFrozenGroup:i.rightBottomCornerGroup);let O=0;"number"==typeof t.rect.attribute.lineWidth&&(O=Math.ceil(t.rect.attribute.lineWidth/2)),C===g.colCount-1&&(Array.isArray(t.rect.attribute.lineWidth)&&(O=Math.ceil((null!==(h=t.rect.attribute.lineWidth[1])&&void 0!==h?h:0)/2)),t.rect.setAttributes({width:t.rect.attribute.width-O})),0===m&&(Array.isArray(t.rect.attribute.lineWidth)&&(O=Math.ceil((null!==(d=t.rect.attribute.lineWidth[3])&&void 0!==d?d:0)/2)),t.rect.setAttributes({x:t.rect.attribute.x+O,width:t.rect.attribute.width-O})),w===g.rowCount-1&&(Array.isArray(t.rect.attribute.lineWidth)&&(O=Math.ceil((null!==(c=t.rect.attribute.lineWidth[2])&&void 0!==c?c:0)/2)),t.rect.setAttributes({height:t.rect.attribute.height-O})),0===y&&(Array.isArray(t.rect.attribute.lineWidth)&&(O=Math.ceil((null!==(u=t.rect.attribute.lineWidth[0])&&void 0!==u?u:0)/2)),t.rect.setAttributes({y:t.rect.attribute.y+O,height:t.rect.attribute.height-O}))}function UL(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=t.table,o=e.start.col,r=e.start.row,s=e.end.col,a=e.end.row,l=e.skipBodyMerge;let h=Math.max(Math.min(s,o),0),d=Math.max(Math.min(a,r),0),c=Math.min(Math.max(s,o),n.colCount-1),u=Math.min(Math.max(a,r),n.rowCount-1);const g=()=>{let t=!1;for(let e=h;e<=c;e++){if(e===h)for(let i=d;i<=u;i++){if(!n.isHeader(e,i)&&l)continue;const o=Z_(n,e,i);if(o&&o.start.col<h){h=o.start.col,t=!0;break}}if(!t&&e===c)for(let i=d;i<=u;i++){if(!n.isHeader(e,i)&&l)continue;const o=Z_(n,e,i);if(o&&Math.min(o.end.col,n.colCount-1)>c){c=o.end.col,t=!0;break}}if(t)break}if(!t)for(let e=d;e<=u;e++){if(e===d)for(let i=h;i<=c;i++){if(!n.isHeader(i,e)&&l)continue;const o=Z_(n,i,e);if(o&&o.start.row<d){d=o.start.row,t=!0;break}}if(!t&&e===u)for(let i=h;i<=c;i++){if(!n.isHeader(i,e)&&l)continue;const o=Z_(n,i,e);if(o&&Math.min(o.end.row,n.rowCount-1)>u){u=o.end.row,t=!0;break}}if(t)break}t&&g()};i&&(g(),e.start.col>e.end.col?(e.start.col=Math.max(h,c),e.end.col=Math.min(h,c)):(e.start.col=Math.min(h,c),e.end.col=Math.max(h,c)),e.start.row>e.end.row?(e.start.row=Math.max(d,u),e.end.row=Math.min(d,u)):(e.start.row=Math.min(d,u),e.end.row=Math.max(d,u))),t.selectingRangeComponents.forEach(((t,e)=>{var i;t.rect.delete(),null===(i=t.fillhandle)||void 0===i||i.delete()})),t.selectingRangeComponents=new Map;let p=!1,f=!1,v=!1,b=!1,m=!1,y=!1,C=!1,w=!1,x=!1;if(h<=n.frozenColCount-1&&d<=n.frozenRowCount-1&&(y=!0),c>=n.colCount-n.rightFrozenColCount&&d<=n.frozenRowCount-1&&(C=!0),h<=n.frozenColCount-1&&u>=n.rowCount-n.bottomFrozenRowCount&&(x=!0),c>=n.colCount-n.rightFrozenColCount&&u>=n.rowCount-n.bottomFrozenRowCount&&(w=!0),h<=n.frozenColCount-1&&u>=n.frozenRowCount&&d<=n.rowCount-n.bottomFrozenRowCount-1&&(p=!0),c>=n.colCount-n.rightFrozenColCount&&u>=n.frozenRowCount&&d<=n.rowCount-n.bottomFrozenRowCount-1&&(f=!0),d<=n.frozenRowCount-1&&c>=n.frozenColCount&&h<=n.colCount-n.rightFrozenColCount-1&&(v=!0),u>=n.rowCount-n.bottomFrozenRowCount&&c>=n.frozenColCount&&h<=n.colCount-n.rightFrozenColCount-1&&(b=!0),h<=n.colCount-n.rightFrozenColCount-1&&c>=n.frozenColCount&&d<=n.rowCount-n.bottomFrozenRowCount-1&&u>=n.frozenRowCount&&(m=!0),y){const e=Math.min(c,n.frozenColCount-1),i=Math.min(u,n.frozenRowCount-1),o=[!0,!v,!p,!0];t.createCellSelectBorder(h,d,e,i,"cornerHeader",`${h}${d}${c}${u}`,o)}if(C){const e=Math.max(h,n.colCount-n.rightFrozenColCount),i=Math.min(u,n.frozenRowCount-1),o=[!0,!0,!f,!v];t.createCellSelectBorder(e,d,c,i,"rightTopCorner",`${h}${d}${c}${u}`,o)}if(x){const e=Math.min(c,n.frozenColCount-1),i=Math.max(d,n.rowCount-n.bottomFrozenRowCount),o=[!p,!b,!0,!0];t.createCellSelectBorder(h,i,e,u,"leftBottomCorner",`${h}${d}${c}${u}`,o)}if(w){const e=Math.max(h,n.colCount-n.rightFrozenColCount),i=Math.max(d,n.rowCount-n.bottomFrozenRowCount),o=[!f,!0,!0,!b];t.createCellSelectBorder(e,i,c,u,"rightBottomCorner",`${h}${d}${c}${u}`,o)}if(v){const e=Math.max(h,n.frozenColCount),i=Math.min(c,n.colCount-n.rightFrozenColCount-1),o=Math.min(u,n.frozenRowCount-1),r=[!0,!C,!m,!y];t.createCellSelectBorder(e,d,i,o,"columnHeader",`${h}${d}${c}${u}`,r)}if(b){const e=Math.max(h,n.frozenColCount),i=Math.min(c,n.colCount-n.rightFrozenColCount-1),o=Math.max(d,n.rowCount-n.bottomFrozenRowCount),r=[!m,!w,!0,!x];t.createCellSelectBorder(e,o,i,u,"bottomFrozen",`${h}${d}${c}${u}`,r)}if(p){const e=Math.max(d,n.frozenRowCount),i=Math.min(u,n.rowCount-n.bottomFrozenRowCount-1),o=Math.min(c,n.frozenColCount-1),r=[!y,!m,!x,!0];t.createCellSelectBorder(h,e,o,i,"rowHeader",`${h}${d}${c}${u}`,r)}if(f){const e=Math.max(d,n.frozenRowCount),i=Math.min(u,n.rowCount-n.bottomFrozenRowCount-1),o=Math.max(h,n.colCount-n.rightFrozenColCount),r=[!C,!0,!w,!m];t.createCellSelectBorder(o,e,c,i,"rightFrozen",`${h}${d}${c}${u}`,r)}if(m){const e=Math.max(h,n.frozenColCount),i=Math.max(d,n.frozenRowCount),o=Math.min(c,n.colCount-n.rightFrozenColCount-1),r=Math.min(u,n.rowCount-n.bottomFrozenRowCount-1),s=[!v,!f,!b,!p];t.createCellSelectBorder(e,i,o,r,"body",`${h}${d}${c}${u}`,s)}}function XL(t){t.selectingRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",0)})),t.selectedRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",0)}))}function $L(t){t.selectingRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",1)})),t.selectedRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",1)}))}function YL(t,e,i,n,o,r,s){if(!e)return;const a=Array.isArray(e)?e:[e,e,e,e],l=s.colCount-1,h=s.rowCount-1,d=[0,0,0,0];let c=!1;return 0===i&&0===n?(d[0]=a[0],c=!0):o===l&&r===h?(d[2]=a[2],c=!0):0===i&&r===h?(d[3]=a[3],c=!0):o===l&&0===n&&(d[1]=a[1],c=!0),c?d:void 0}function KL(t){t.selectingRangeComponents.forEach(((e,i)=>{var n;t.selectedRangeComponents.get(i)&&(t.selectingRangeComponents.get(i).rect.delete(),null===(n=t.selectingRangeComponents.get(i).fillhandle)||void 0===n||n.delete()),t.selectedRangeComponents.set(i,e)})),t.selectingRangeComponents=new Map,t.updateNextFrame()}function qL(t){t.selectedRangeComponents.forEach(((t,e)=>{var i;t.rect.delete(),null===(i=t.fillhandle)||void 0===i||i.delete()})),t.selectedRangeComponents=new Map}function ZL(t){t.selectingRangeComponents.forEach(((t,e)=>{var i;t.rect.delete(),null===(i=t.fillhandle)||void 0===i||i.delete()})),t.selectingRangeComponents=new Map}function JL(t,e,i,n,o){var r,s;DL(n)&&EL(n);const a=n.scenegraph,l=jx(t.map((t=>t.row))).sort(((t,e)=>e-t)),h=jx(e.map((t=>t.row))).sort(((t,e)=>t-e)),d=jx(i.map((t=>t.row))).sort(((t,e)=>t-e));let c;if(d.length&&(c=iP(d[0]-1,d[d.length-1]+1,a)),h.length){const t=iP(h[0]-1,h[h.length-1]+1,a);c=XC(c)?XC(t)?Math.min(c,t):c:t}if(l.length){const t=iP(l[0]-1,l[l.length-1]+1,a);c=XC(c)?XC(t)?Math.min(c,t):c:t}l.forEach((t=>{!function(t,e,i){const n=e.proxy;if(t>=n.rowStart&&t<=n.rowEnd&&(tP(t,e),n.rowEnd--,n.currentRow--),!i){n.bodyBottomRow--;const t=Math.min(n.rowLimit,n.bodyBottomRow-n.bodyTopRow+1);n.totalActualBodyRowCount=t,n.totalRow=Math.min(n.table.rowCount-1,n.rowStart+t-1)}}(t,a,o)}));const u=n.rowHeightsMap;if(l.forEach((t=>{u.delete(t)})),l.length){!function(t){function e(e,i){e.row=i;const n=Z_(t.table,e.col,e.row);n?(e.mergeStartCol=n.start.col,e.mergeEndCol=n.end.col,e.mergeStartRow=n.start.row,e.mergeEndRow=n.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}t.bodyGroup.forEachChildren((i=>{let n=t.bodyRowStart;null==i||i.forEachChildren((t=>{e(t,n),n++}))})),t.rowHeaderGroup.forEachChildren((i=>{let n=t.bodyRowStart;null==i||i.forEachChildren((t=>{e(t,n),n++}))})),t.rightFrozenGroup.forEachChildren((i=>{let n=t.bodyRowStart;null==i||i.forEachChildren((t=>{e(t,n),n++}))})),t.bottomFrozenGroup.forEachChildren((i=>{let n=t.table.rowCount-t.table.bottomFrozenRowCount;null==i||i.forEachChildren((t=>{e(t,n),n++}))})),t.leftBottomCornerGroup.forEachChildren((i=>{let n=t.table.rowCount-t.table.bottomFrozenRowCount;null==i||i.forEachChildren((t=>{e(t,n),n++}))})),t.rightBottomCornerGroup.forEachChildren((i=>{let n=t.table.rowCount-t.table.bottomFrozenRowCount;null==i||i.forEachChildren((t=>{e(t,n),n++}))}))}(a);const t=eP(l[l.length-1]-1,l[0]-l.length+1,a);c=XC(c)?XC(t)?Math.min(c,t):c:t}let g;if(a.table._clearRowRangeHeightsMap(),h.forEach((t=>{const e=function(t,e,i){const n=e.proxy;if(!i){n.bodyBottomRow++;const t=Math.min(n.rowLimit,n.bodyBottomRow-n.bodyTopRow+1);n.totalActualBodyRowCount=t,n.totalRow=n.rowStart+t-1}if(!(t<n.rowStart))return t>n.rowEnd?n.rowEnd-n.rowStart+1<n.rowLimit?(n.rowEnd++,n.currentRow++,QL(t,e),t):void 0:n.rowEnd-n.rowStart+1<n.rowLimit?(n.rowEnd++,n.currentRow++,QL(t,e),t):t}(t,a,o);g=null!=g?g:e,u.insert(t)})),function(t){function e(e,i,n){e.row=i,e.setAttribute("y",n);const o=Z_(t.table,e.col,e.row);o?(e.mergeStartCol=o.start.col,e.mergeEndCol=o.end.col,e.mergeStartRow=o.start.row,e.mergeEndRow=o.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}t.bodyGroup.forEachChildren((i=>{let n=t.bodyRowStart,o=t.getCellGroupY(n);null==i||i.forEachChildren((t=>{e(t,n,o),n++,o+=t.attribute.height}))})),t.rowHeaderGroup.forEachChildren((i=>{let n=t.bodyRowStart,o=t.getCellGroupY(n);null==i||i.forEachChildren((t=>{e(t,n,o),n++,o+=t.attribute.height}))})),t.rightFrozenGroup.forEachChildren((i=>{let n=t.bodyRowStart,o=t.getCellGroupY(n);null==i||i.forEachChildren((t=>{e(t,n,o),n++,o+=t.attribute.height}))})),t.bottomFrozenGroup.forEachChildren((i=>{let n=t.table.rowCount-t.table.bottomFrozenRowCount,o=0;null==i||i.forEachChildren((t=>{e(t,n,o),n++,o+=t.attribute.height}))})),t.leftBottomCornerGroup.forEachChildren((i=>{let n=t.table.rowCount-t.table.bottomFrozenRowCount,o=0;null==i||i.forEachChildren((t=>{e(t,n,o),n++,o+=t.attribute.height}))})),t.rightBottomCornerGroup.forEachChildren((i=>{let n=t.table.rowCount-t.table.bottomFrozenRowCount,o=0;null==i||i.forEachChildren((t=>{e(t,n,o),n++,o+=t.attribute.height}))}))}(a),h.length){const t=eP(h[0]-1,h[h.length-1]+1,a);c=XC(c)?XC(t)?Math.min(c,t):c:t}for(let t=0;t<n.colCount;t++)d.forEach((e=>{if(e<n.frozenRowCount){const i=Z_(a.table,t,e);if(i)for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)YR(t,e,a.table,!1);else YR(t,e,a.table,!1)}else if(e>n.rowCount-1||e<a.table.rowCount-a.table.bottomFrozenRowCount&&(e<a.proxy.rowStart||e>a.proxy.rowEnd))tP(e,a);else{const i=Z_(a.table,t,e);if(i)for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)YR(t,e,a.table,!1);else YR(t,e,a.table,!1)}}));if(d.length){const t=eP(d[0]-1,d[d.length-1]+1,a);c=XC(c)?XC(t)?Math.min(c,t):c:t}if(tw(g)){for(let t=0;t<Math.max(n.colCount,null!==(r=n.internalProps._oldColCount)&&void 0!==r?r:n.colCount);t++)for(let e=g;e<Math.max(n.rowCount,null!==(s=n.internalProps._oldRowCount)&&void 0!==s?s:n.rowCount);e++){const i=a.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}c=XC(c)?XC(g)?Math.min(c,g):c:g}if(tw(c)&&(a.proxy.rowUpdatePos=Math.min(a.proxy.rowUpdatePos,c)),h.length){if(!tw(g)){const t=Math.min(...h);a.proxy.rowUpdatePos=Math.min(t,a.proxy.rowUpdatePos)}a.proxy.rowUpdateDirection="up",a.proxy.updateCellGroups(2*a.proxy.screenRowCount),f()}else l.length&&(function(t,e){if(e.table.isHasSeriesNumber())for(let i=t;i<=e.table.rowCount-1;i++)YR(0,i,e.table,!1)}(l[l.length-1],a),a.proxy.updateCellGroups(2*a.proxy.screenRowCount),f());a.proxy.progress();const p=n.getRowsHeight(n.frozenRowCount,n.rowCount-1-n.bottomFrozenRowCount);function f(){if((null==h?void 0:h[(null==h?void 0:h.length)-1])>=n.rowCount-n.bottomFrozenRowCount||(null==d?void 0:d[(null==d?void 0:d.length)-1])>=n.rowCount-n.bottomFrozenRowCount||(null==l?void 0:l[0])>=n.rowCount-n.bottomFrozenRowCount){for(let t=0;t<n.colCount;t++)for(let e=n.rowCount-n.bottomFrozenRowCount;e<n.rowCount;e++){const i=a.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}a.proxy.updateBottomFrozenCellGroups()}}a.updateContainerHeight(a.table.frozenRowCount,p-a.bodyGroup.attribute.height)}function QL(t,e){for(let i=0;i<e.table.colCount;i++){const n=new xR({x:0,y:0,width:e.table.getColWidth(i),height:e.table.getRowHeight(t)});if(n.role="cell",n.col=i,n.row=t,n.needUpdate=!0,!n)continue;const o=e.getColGroup(i);if(o)if(o.firstChild&&t<o.firstChild.row)o.insertBefore(n,o.firstChild),o.firstChild.row=o.firstChild.row+1;else if(o.lastChild&&t>o.lastChild.row)o.appendChild(n);else{const r=e.highPerformanceGetCell(i,t,!0);r!==n&&(o.insertBefore(n,r),r&&(r.row=r.row+1),r!==o.lastChild&&o.lastChild&&(o.lastChild.row=o.lastChild.row+1))}}}function tP(t,e){for(let i=0;i<e.table.colCount;i++){const n=e.getColGroup(i,!1);if(!n)continue;let o;n.forEachChildren((e=>e.row===t&&(o=e,!0))),o&&(n.updateColumnHeight(-o.attribute.height),n.removeChild(o))}}function eP(t,e,i){let n;for(let o=0;o<i.table.colCount;o++){const r=i.table.getCellRange(o,t);let s;r.start.row<=t+1&&r.end.row>=t+1&&(nP(r,i),s=r.start.row);const a=i.table.getCellRange(o,e);a.start.row<=e+1&&a.end.row>=e+1&&(nP(a,i),s=a.start.row),XC(s)&&(n=XC(n)?Math.min(n,s):s)}return n}function iP(t,e,i){let n;for(let o=0;o<i.table.colCount;o++){let r;const s=i.highPerformanceGetCell(o,t);s.mergeStartRow&&s.mergeEndRow&&s.mergeEndRow>t&&(nP({start:{row:s.mergeStartRow,col:i.table.isAutoRowHeight(e)?0:s.mergeStartCol},end:{row:s.mergeEndRow,col:i.table.isAutoRowHeight(e)?i.table.colCount-1:s.mergeEndCol}},i),r=s.mergeStartRow);const a=i.highPerformanceGetCell(o,e);a.mergeStartRow&&a.mergeEndRow&&a.mergeStartRow<e&&(nP({start:{row:a.mergeStartRow,col:i.table.isAutoRowHeight(e)?0:a.mergeStartCol},end:{row:a.mergeEndRow,col:i.table.isAutoRowHeight(e)?i.table.colCount-1:a.mergeEndCol}},i),r=a.mergeStartRow),XC(r)&&(n=XC(n)?Math.min(n,r):r)}return n}function nP(t,e){const{start:i,end:n}=t;for(let t=i.col;t<=n.col;t++)for(let o=i.row;o<=n.row;o++){const i=e.highPerformanceGetCell(t,o,!0);i&&(i.needUpdate=!0)}}function oP(t){if(!t.table.reactCustomLayout)return;const{table:e,stage:i}=t,n=i.pluginService.findPluginsByName("ReactAttributePlugin")[0],{htmlMap:o,renderId:r}=n;for(const s in o){const a=o[s],{graphic:l,wrapContainer:h,renderId:d}=a;if(d!==r)continue;let c;if(t.frozenColCount>e.frozenColCount){const i=IT(l);if(!i)continue;const{col:n,row:o}=i;o>=e.rowCount-e.bottomFrozenRowCount&&n<t.frozenColCount&&n>=e.frozenColCount&&l.attribute.react.container===e.frozenBottomDomContainer?c=e.bottomDomContainer:o>=e.frozenRowCount&&n<t.frozenColCount&&n>=e.frozenColCount&&l.attribute.react.container===e.frozenBodyDomContainer?c=e.bodyDomContainer:o<e.frozenRowCount&&n<t.frozenColCount&&n>=e.frozenColCount&&l.attribute.react.container===e.frozenHeaderDomContainer&&(c=e.headerDomContainer)}else if(t.frozenColCount<e.frozenColCount){const i=IT(l);if(!i)continue;const{col:n,row:o}=i;o>=e.rowCount-e.bottomFrozenRowCount&&n<e.frozenColCount&&n>=t.frozenColCount&&l.attribute.react.container===e.bottomDomContainer?c=e.frozenBottomDomContainer:o>=e.frozenRowCount&&n<e.frozenColCount&&n>=t.frozenColCount&&l.attribute.react.container===e.bodyDomContainer?c=e.frozenBodyDomContainer:o<e.frozenRowCount&&n<e.frozenColCount&&n>=t.frozenColCount&&l.attribute.react.container===e.headerDomContainer&&(c=e.frozenHeaderDomContainer)}c&&(c.appendChild(h),a.nativeContainer=c,a.container=c,l.attribute.react.container=c,n.updateStyleOfWrapContainer(l,i,h,c,l.attribute.react))}}function rP(t){const e=t.bodyGroup.firstChild instanceof xR?t.bodyGroup.firstChild:null;e&&(t.rowHeaderGroup.appendChild(e),t.rowHeaderGroup.setAttribute("width",t.rowHeaderGroup.attribute.width+e.attribute.width),t.bodyGroup.setAttribute("width",t.bodyGroup.attribute.width-e.attribute.width))}function sP(t){const e=t.colHeaderGroup.firstChild instanceof xR?t.colHeaderGroup.firstChild:null;e&&(t.cornerHeaderGroup.appendChild(e),t.cornerHeaderGroup.setAttribute("width",t.cornerHeaderGroup.attribute.width+e.attribute.width),t.colHeaderGroup.setAttribute("width",t.colHeaderGroup.attribute.width-e.attribute.width))}function aP(t){var e;const i=t.rowHeaderGroup.lastChild instanceof xR?t.rowHeaderGroup.lastChild:null===(e=t.rowHeaderGroup.lastChild)||void 0===e?void 0:e._prev;i&&(cP(t.bodyGroup,i,t.bodyGroup.firstChild),t.bodyGroup.setAttribute("width",t.bodyGroup.attribute.width+i.attribute.width),t.rowHeaderGroup.setAttribute("width",t.rowHeaderGroup.attribute.width-i.attribute.width))}function lP(t){var e;const i=t.cornerHeaderGroup.lastChild instanceof xR?t.cornerHeaderGroup.lastChild:null===(e=t.cornerHeaderGroup.lastChild)||void 0===e?void 0:e._prev;i&&(cP(t.colHeaderGroup,i,t.colHeaderGroup.firstChild),t.colHeaderGroup.setAttribute("width",t.colHeaderGroup.attribute.width+i.attribute.width),t.cornerHeaderGroup.setAttribute("width",t.cornerHeaderGroup.attribute.width-i.attribute.width))}function hP(t){const e=t.bottomFrozenGroup.firstChild instanceof xR?t.bottomFrozenGroup.firstChild:null;e&&(t.leftBottomCornerGroup.appendChild(e),t.leftBottomCornerGroup.setAttribute("width",t.leftBottomCornerGroup.attribute.width+e.attribute.width),t.bottomFrozenGroup.setAttribute("width",t.bottomFrozenGroup.attribute.width-e.attribute.width),t.table.isPivotChart()&&e.forEachChildren((t=>{t.setAttributes({stroke:!1,fill:!1})})))}function dP(t){var e;const i=t.leftBottomCornerGroup.lastChild instanceof xR?t.leftBottomCornerGroup.lastChild:null===(e=t.leftBottomCornerGroup.lastChild)||void 0===e?void 0:e._prev;i&&(cP(t.bottomFrozenGroup,i,t.bottomFrozenGroup.firstChild),t.bottomFrozenGroup.setAttribute("width",t.bottomFrozenGroup.attribute.width+i.attribute.width),t.leftBottomCornerGroup.setAttribute("width",t.leftBottomCornerGroup.attribute.width-i.attribute.width),t.table.isPivotChart()&&i.forEachChildren((e=>{var i,n,o,r;const s=t.table._getCellStyle(e.col,e.row),a=t.table.getCellRange(e.col,e.row),l=RT(s,t.table,a?a.start.col:e.col,a?a.start.row:e.row,AR).theme;e.setAttributes({fill:null!==(n=null===(i=null==l?void 0:l.group)||void 0===i?void 0:i.fill)&&void 0!==n?n:void 0,stroke:null!==(r=null===(o=null==l?void 0:l.group)||void 0===o?void 0:o.stroke)&&void 0!==r?r:void 0})})))}function cP(t,e,i){e&&t&&(i?t.insertBefore(e,i):t.appendChild(e))}function uP(t){var e;let i=!1;for(let n=0;n<t.bodyGroup.childrenCount;n++){const o=t.bodyGroup.children[n];if(!mP(o))continue;const r=o.firstChild;null===(e=t.colHeaderGroup.children[n])||void 0===e||e.appendChild(r),i||(t.colHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height+r.attribute.height),t.bodyGroup.setAttribute("height",t.bodyGroup.attribute.height-r.attribute.height),i=!0)}}function gP(t){var e;let i=!1;for(let n=0;n<t.rowHeaderGroup.childrenCount;n++){const o=t.rowHeaderGroup.children[n];if(!mP(o))continue;const r=o.firstChild;null===(e=t.cornerHeaderGroup.children[n])||void 0===e||e.appendChild(r),i||(t.cornerHeaderGroup.setAttribute("height",t.cornerHeaderGroup.attribute.height+r.attribute.height),t.rowHeaderGroup.setAttribute("height",t.rowHeaderGroup.attribute.height-r.attribute.height),i=!0)}}function pP(t){var e;let i=!1;for(let n=0;n<t.rightFrozenGroup.childrenCount;n++){const o=t.rightFrozenGroup.children[n];if(!mP(o))continue;const r=o.firstChild;null===(e=t.rightTopCornerGroup.children[n])||void 0===e||e.appendChild(r),i||(t.rightTopCornerGroup.setAttribute("height",t.rightTopCornerGroup.attribute.height+r.attribute.height),t.rightFrozenGroup.setAttribute("height",t.rightFrozenGroup.attribute.height-r.attribute.height),i=!0)}}function fP(t){let e=!1;for(let i=0;i<t.colHeaderGroup.childrenCount;i++){const n=t.colHeaderGroup.children[i];if(!mP(n))continue;const o=t.bodyGroup.children[i];if(!o)continue;const r=n.lastChild;cP(o,r,o.firstChild),e||(t.colHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height-r.attribute.height),t.bodyGroup.setAttribute("height",t.bodyGroup.attribute.height+r.attribute.height),e=!0)}}function vP(t){let e=!1;for(let i=0;i<t.cornerHeaderGroup.childrenCount;i++){const n=t.cornerHeaderGroup.children[i];if(!mP(n))continue;const o=t.rowHeaderGroup.children[i];if(!o)continue;const r=n.lastChild;cP(o,r,o.firstChild),e||(t.cornerHeaderGroup.setAttribute("height",t.cornerHeaderGroup.attribute.height-r.attribute.height),t.rowHeaderGroup.setAttribute("height",t.rowHeaderGroup.attribute.height+r.attribute.height),e=!0)}}function bP(t){let e=!1;for(let i=0;i<t.rightTopCornerGroup.childrenCount;i++){const n=t.rightTopCornerGroup.children[i];if(!mP(n))continue;const o=t.rightFrozenGroup.children[i];if(!o)continue;const r=n.lastChild;cP(o,r,o.firstChild),e||(t.rightTopCornerGroup.setAttribute("height",t.rightTopCornerGroup.attribute.height-r.attribute.height),t.rightFrozenGroup.setAttribute("height",t.rightFrozenGroup.attribute.height+r.attribute.height),e=!0)}}function mP(t){return t instanceof xR&&"table-border-rect"!==(null==t?void 0:t.name)}function yP(t){var e;for(let i=t.proxy.colStart;i<=t.proxy.colEnd;i++){const n=t.getColGroup(i);null===(e=null==n?void 0:n.getChildren())||void 0===e||e.forEach((t=>{t.children.forEach((t=>{"chart"===t.type&&(t.cacheCanvas=null,t.addUpdateBoundTag())}))}))}}function CP(t,e,i){t.forEachChildren((t=>{"chart"===t.type&&(t.cacheCanvas=null,t.setAttributes({width:Math.ceil(e-t.attribute.cellPadding[3]-t.attribute.cellPadding[1]),height:Math.ceil(i-t.attribute.cellPadding[0]-t.attribute.cellPadding[2])}))}))}function wP(t,e,i){return new xR({x:0,y:0,width:t,height:e,clip:null!=i&&i,pickable:!1})}function xP(t,e){return t.forEachChildrenSkipChild(((t,i)=>{t.setAttribute("x",e),e+=t.attribute.width})),e}function _P(t,e,i,n,o){const r=t.name;BP(i,n,(t=>t.name===r),(t=>{LR(e,t),t.name=e.name}),o),o.updateNextFrame()}function SP(t){const{col:e,row:i,iconMark:n,order:o,oldSortCol:r,oldSortRow:s,oldIconMark:a,scene:l}=t,h=l.table.internalProps.headerHelper.getSortIcon(o,l.table,e,i);if(n&&_P(n,h,e,i,l),!function(t,e,i,n,o){const r=o.getCellRange(t,e),s=o.getCellRange(i,n);return r.start.col===s.start.col&&r.start.row===s.start.row&&r.end.col===s.end.col&&r.end.row===s.end.row}(e,i,r,s,l.table)){const t=l.table.internalProps.headerHelper.getSortIcon("normal",l.table,r,s);a?_P(a,t,r,s,l):function(t,e,i,n){const o=n.getCell(t,e);if(XC(o.mergeStartCol)&&XC(o.mergeStartRow)&&XC(o.mergeEndCol)&&XC(o.mergeEndRow))for(let t=o.mergeStartCol;t<=o.mergeEndCol;t++)for(let e=o.mergeStartRow;e<=o.mergeEndRow;e++){let o;n.getCell(t,e).forEachChildren((t=>"sort"===t.attribute.funcType&&(o=t,!0))),o&&(LR(i,o),o.name=i.name)}else{let t;Vx(o,"children",(e=>"sort"===e.attribute.funcType&&(t=e,!0))),t&&(LR(i,t),t.name=i.name)}}(r,s,t,l)}}function AP(t,e,i){t&&"empty"!==t.role&&t.forEachChildren((t=>{"group"===t.type?AP(t,e,i):e(t)&&i(t)}))}function BP(t,e,i,n,o){const r=o.getCell(t,e);if("cell"===r.role&&XC(r.mergeStartCol)&&XC(r.mergeStartRow)&&XC(r.mergeEndCol)&&XC(r.mergeEndRow)){const{colStart:t,colEnd:e,rowStart:s,rowEnd:a}=wk(r,o);for(let r=t;r<=e;r++)for(let t=s;t<=a;t++)AP(o.highPerformanceGetCell(r,t),i,n)}else AP(r,i,n)}function TP(t,e){const{bgColor:i,borderColor:n,borderLineWidth:o,borderLineDash:r}=e,s={x:0,y:0,width:0,height:0,visible:!1,pickable:!0,fill:i};return s.stroke=qk(n,void 0),s.lineWidth=o,r&&(s.lineDash=r),s.lineCap="butt",Array.isArray(n)&&(s.strokeArrayColor=UB(n)),Array.isArray(o)&&(s.strokeArrayWidth=UB(o),s.lineWidth=1),t.setAttributes(s),t.role="corner-frozen",t}function RP(t,e,i,n){var o,r;DL(n)&&EL(n);const s=n.scenegraph,a=kP(t.map((t=>t.col))).sort(((t,e)=>e-t)),l=kP(e.map((t=>t.col))).sort(((t,e)=>t-e)),h=kP(i.map((t=>t.col))).sort(((t,e)=>t-e));a.forEach((t=>{!function(t,e){const i=e.proxy;if(t>=e.table.rowHeaderLevelCount)if(t>=e.table.colCount-e.table.rightFrozenColCount);else{const i=e.getColGroup(t,!1);i&&i.parent===e.bodyGroup&&e.bodyGroup.removeChild(i);const n=e.getColGroupInBottom(t);n&&n.parent===e.bottomFrozenGroup&&e.bottomFrozenGroup.removeChild(n);const o=e.getColGroup(t,!0);o&&o.parent===e.colHeaderGroup&&e.colHeaderGroup.removeChild(o)}t>=i.colStart&&t<=i.colEnd&&(i.colEnd--,i.currentCol--),i.bodyRightCol--;const n=Math.min(i.colLimit,i.bodyRightCol-i.bodyLeftCol+1);i.totalActualBodyColCount=n,i.totalCol=i.colStart+n-1}(t,s)}));const d=n.colWidthsMap;let c;if(a.forEach((t=>{d.delAndReorder(t)})),a.length&&MP(s),s.table._clearColRangeWidthsMap(),l.forEach((t=>{const e=function(t,e){const i=e.proxy;i.bodyRightCol++;const n=Math.min(i.colLimit,i.bodyRightCol-i.bodyLeftCol+1);if(i.totalActualBodyColCount=n,i.totalCol=i.colStart+n-1,!(t<i.colStart))return t>i.colEnd?i.colEnd-i.colStart+1<i.colLimit?(i.colEnd++,i.currentCol++,LP(t,e),t):void 0:i.colEnd-i.colStart+1<i.colLimit?(i.colEnd++,i.currentCol++,LP(t,e),t):t}(t,s);MP(s),c=null!=c?c:e,d.addAndReorder(t)})),function(t){let e=t.bodyColStart,i=t.getCellGroupX(e);function n(i){i.col=e;const n=Z_(t.table,i.col,i.row);n&&(i.mergeStartCol=n.start.col,i.mergeStartCol=n.start.col,i.mergeEndCol=n.end.col,i.mergeEndCol=n.end.col),i.role}t.bodyGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{n(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.bodyColStart,i=t.getCellGroupX(e),t.colHeaderGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{n(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.bodyColStart,i=t.getCellGroupX(e),t.bottomFrozenGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{n(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.table.colCount-t.table.rightFrozenColCount,i=0,t.rightFrozenGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{n(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.table.colCount-t.table.rightFrozenColCount,i=0,t.rightTopCornerGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{n(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.table.colCount-t.table.rightFrozenColCount,i=0,t.rightBottomCornerGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{n(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++}))}(s),h.forEach((t=>{for(let e=0;e<n.rowCount;e++){const i=Z_(s.table,t,e);if(i)for(let t=i.start.col;t<=i.end.col;t++)for(let t=i.start.col;t<=i.end.col;t++)YR(t,e,s.table,!1);else YR(t,e,s.table,!1)}})),tw(c)){for(let t=c;t<Math.max(n.colCount,null!==(o=n.internalProps._oldColCount)&&void 0!==o?o:n.colCount);t++)for(let e=0;e<Math.max(n.rowCount,null!==(r=n.internalProps._oldRowCount)&&void 0!==r?r:n.rowCount);e++){const i=s.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}s.proxy.colUpdatePos=c}if(l.length){if(!tw(c)){const t=Math.min(...l);s.proxy.colUpdatePos=t}s.proxy.colUpdateDirection="left",s.proxy.updateColGroups(2*s.proxy.screenColCount),g(),s.proxy.progress()}else a.length&&(s.proxy.updateColGroups(2*s.proxy.screenColCount),g(),s.proxy.progress());const u=n.getColsWidth(n.frozenColCount,n.colCount-1);function g(){if((null==l?void 0:l[(null==l?void 0:l.length)-1])>=n.colCount-n.rightFrozenColCount||(null==h?void 0:h[(null==h?void 0:h.length)-1])>=n.colCount-n.rightFrozenColCount||(null==a?void 0:a[0])>=n.colCount-n.rightFrozenColCount){for(let t=n.colCount-n.rightFrozenColCount;t<n.colCount;t++)for(let e=0;e<n.rowCount;e++){const i=s.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}s.proxy.updateRightFrozenCellGroups()}}s.updateContainerWidth(s.table.frozenColCount,u-s.bodyGroup.attribute.width)}function kP(t){const e=[];for(let i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e}function MP(t){let e=t.bodyColStart;function i(i){i.col=e;const n=Z_(t.table,i.col,i.row);n&&(i.mergeStartCol=n.start.col,i.mergeStartCol=n.start.col,i.mergeEndCol=n.end.col,i.mergeEndCol=n.end.col),i.role}t.bodyGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{i(t)})),e++})),e=t.bodyColStart,t.colHeaderGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{i(t)})),e++})),e=t.bodyColStart,t.bottomFrozenGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{i(t)})),e++}))}function LP(t,e){if(e.colHeaderGroup&&e.table.columnHeaderLevelCount>0){const n=new xR({x:0,y:0,width:e.table.getColWidth(t),height:0,clip:!1,pickable:!1});n.role="column",n.col=t;const o=e.getColGroup(t,!0);o?e.colHeaderGroup.insertBefore(n,o):e.colHeaderGroup.appendChild(n),i(n,t,0,e.table.columnHeaderLevelCount-1)}if(e.bodyGroup){const n=new xR({x:0,y:0,width:e.table.getColWidth(t),height:0,clip:!1,pickable:!1});n.role="column",n.col=t;const o=e.getColGroup(t,!1);o?e.bodyGroup.insertBefore(n,o):e.bodyGroup.appendChild(n),i(n,t,e.bodyRowStart,e.bodyRowEnd)}if(e.bottomFrozenGroup&&e.table.bottomFrozenRowCount>0){const n=new xR({x:0,y:0,width:e.table.getColWidth(t),height:0,clip:!1,pickable:!1});n.role="column",n.col=t;const o=e.getColGroupInBottom(t);o?e.bottomFrozenGroup.insertBefore(n,o):e.bottomFrozenGroup.appendChild(n),i(n,t,e.table.rowCount-e.table.bottomFrozenRowCount,e.table.rowCount-1)}function i(t,i,n,o){for(let r=n;r<=o;r++){const n=new xR({x:0,y:0,width:e.table.getColWidth(i),height:e.table.getRowHeight(r)});n.role="cell",n.col=i,n.row=r,n.needUpdate=!0,t.appendChild(n)}}}wC(),fo.load(qM),fo.load(sk);function PP(t,e,i){const n=t.highPerformanceGetCell(e,i);if("cell"===n.role&&XC(n.mergeStartCol)&&XC(n.mergeStartRow)&&XC(n.mergeEndCol)&&XC(n.mergeEndRow)){const{colStart:e,colEnd:i,rowStart:o,rowEnd:r}=wk(n,t);for(let n=e;n<=i;n++)for(let e=o;e<=r;e++){const i=t.highPerformanceGetCell(n,e);"cell"===i.role&&i.addUpdateBoundTag()}}else n.addUpdateBoundTag()}function EP(t,e,i,n,o){const r=t.table;for(let i=0;i<r.columnHeaderLevelCount;i++)PP(t,e,i);const s=t.getColGroup(e);return null==s||s.addUpdateBoundTag(),!0}function HP(t,e,i,n,o,r){const s=t.table;for(let i=0;i<s.columnHeaderLevelCount;i++)PP(t,e,i);const a=t.getColGroup(e);return null==a||a.addUpdateBoundTag(),!0}function OP(t,e,i,n,o){const r=t.table;for(let e=0;e<r.colCount;e++)PP(t,e,i);return!0}function IP(t,e,i,n,o,r){const s=t.table;for(let e=0;e<s.colCount;e++)PP(t,e,i);return!0}function FP(t,e,i){var n;const{table:o}=t,{scenegraph:r}=o,{highlightScope:s,singleStyle:a,disableHeader:l,cellPos:h,cellPosContainHeader:d}=t.hover,c=h.col,u=h.row;if(s===Vw.none||l&&(d.col!==e||d.row!==i)){const t=d.col,n=d.row;r.hideHoverIcon(t,n),r.showHoverIcon(e,i),d.col=e,d.row=i}if((l&&o.isHeader(e,i)||s===Vw.none)&&(e=-1,i=-1),c===e&&u===i)return;(null===(n=t.table.options.customConfig)||void 0===n?void 0:n.disableBuildInChartActive)||(r.deactivateChart(c,u),r.activateChart(e,i));let g=!1;const{ranges:p,highlightScope:f}=t.select;if(-1!==c&&-1!==u&&(g=function(t,e,i,n,o,r,s){let a=!1;return r===Vw.single?a=!!function(t,e,i,n,o){return PP(t,e,i),!0}(t,e,i):r===Vw.row?a=!!OP(t,0,i):r===Vw.column?a=!!EP(t,e):r===Vw.cross&&(a=!!OP(t,0,i),a=!!EP(t,e)),a}(r,c,u,0,0,s),l||r.hideHoverIcon(c,u)),-1===e||-1===i)return h.col=-1,h.row=-1,void(!g||c===e&&u===i||t.table.scenegraph.updateNextFrame());s===Vw.single?g=!!function(t,e,i,n,o){return PP(t,e,i),!0}(r,e,i):s===Vw.row?g=!!IP(r,0,i):s===Vw.column?g=!!HP(r,e):s===Vw.cross&&(g=!!IP(r,0,i),g=!!HP(r,e)),s===Vw.none||l||r.showHoverIcon(e,i),h.col=e,h.row=i,g&&t.table.scenegraph.updateNextFrame()}function zP(t,e,i,n){var o;let r,s=null,a=!1;if(Array.isArray(i.sortState))for(let n=0;n<i.sortState.length&&(r=i.sortState[n],r&&(s=i._getHeaderCellBySortState(r)),s&&(a=DP(t,e,s.col,s.row,i)),!a);n++);else r=i.sortState,r&&(s=i._getHeaderCellBySortState(r)),s&&(a=DP(t,e,s.col,s.row,i));const l=i.getHeaderDefine(t,e);if(r&&a&&(null==l?void 0:l.sort)?r.order="asc"===r.order?"desc":"desc"===r.order?"normal":"asc":(null==l?void 0:l.sort)?r={field:i.getHeaderField(t,e),order:"asc"}:a&&(null==l?void 0:l.showSort)||(r={field:i.getHeaderField(t,e),order:"normal"}),r.event=n,i.fireListeners(v_.SORT_CLICK,r).includes(!1))return;let h=!1,d=i.internalProps.sortState?Array.isArray(i.internalProps.sortState)&&(h=!0)?i.internalProps.sortState:[i.internalProps.sortState]:[];if(Array.isArray(d)){const t=d.findIndex((t=>t.field===r.field));t>=0?d[t]=r:d.push(r)}d=d.filter((t=>"normal"!==t.order)),d=i.internalProps.multipleSort&&(h=!0)?d:d.splice(-1),d=h&&d.length?d:d[0],i.internalProps.sortState=d,i.stateManager.setSortState(d),(null==l?void 0:l.sort)&&function(t,e,i){t=Array.isArray(t)||!t?t:[t],e.dataSource.sort((t||[]).map((t=>{var i,n;const o=e.internalProps.layoutMap.headerObjects.find((e=>e&&e.field===t.field));return{field:t.field,order:t.order||"asc",orderFn:"function"==typeof(null===(i=null==o?void 0:o.define)||void 0===i?void 0:i.sort)?null===(n=null==o?void 0:o.define)||void 0===n?void 0:n.sort:Gx}})))}(d,i),i.internalProps.useOneRowHeightFillAll=!1,i.internalProps.layoutMap.clearCellRangeMap(),i.scenegraph.sortCell();const c=!!(null===(o=i.stateManager.select.ranges)||void 0===o?void 0:o.length);i.stateManager.updateSelectPos(-1,-1),i.stateManager.endSelectCells(!0,c)}function DP(t,e,i,n,o){return o._getLayoutCellId(t,e)===o._getLayoutCellId(i,n)}const WP=t_(v_,{PIVOT_SORT_CLICK:"pivot_sort_click",DRILLMENU_CLICK:"drillmenu_click"});function NP(t,e,i,n,o){for(let i=t;i<=e;i++)o._clearColRangeWidthsMap(i);for(let t=i;t<=n;t++)o._clearRowRangeHeightsMap(t)}function GP(t){var e;if(!t)return;const i=(null===(e=t.role)||void 0===e?void 0:e.startsWith("icon"))?t:"richtext"===t.type?t._currentHoverIcon:void 0;return i?"richtext"===t.type?{icon:i,position:{left:t.globalAABBBounds.x1+i.globalAABBBounds.x1,right:t.globalAABBBounds.x1+i.globalAABBBounds.x2,top:t.globalAABBBounds.y1+i.globalAABBBounds.y1,bottom:t.globalAABBBounds.y1+i.globalAABBBounds.y2,width:i.globalAABBBounds.x2-i.globalAABBBounds.x1,height:i.globalAABBBounds.y2-i.globalAABBBounds.y1},type:"richtext-icon"}:{icon:i,position:{left:i.globalAABBBounds.x1,right:i.globalAABBBounds.x2,top:i.globalAABBBounds.y1,bottom:i.globalAABBBounds.y2,width:i.globalAABBBounds.x2-i.globalAABBBounds.x1,height:i.globalAABBBounds.y2-i.globalAABBBounds.y1},type:"icon"}:void 0}function jP(t,e){"adaptive"===e.table.widthMode&&e.columnResize.col<e.table.colCount-1?(e.table.scenegraph.updateColWidth(e.columnResize.col,t),e.table.scenegraph.updateColWidth(e.columnResize.col+1,-t),e.table.internalProps._widthResizedColMap.add(e.columnResize.col),e.table.internalProps._widthResizedColMap.add(e.columnResize.col+1)):(e.table.scenegraph.updateColWidth(e.columnResize.col,t),e.table.internalProps._widthResizedColMap.add(e.columnResize.col))}function VP(t,e,i,n,o){const r=o.table.getRecordShowIndexByCell(t,e);if(r>=0){const t=o.table.dataSource.getIndexKey(r).toString();o.checkedState.get(t)?o.checkedState.get(t)[i]=n:o.checkedState.set(t,{[i]:n})}}function UP(t,e){e.checkedState.clear(),e.headerCheckedState={},e.radioState={};let i=!1;if(e._checkboxCellTypeFields=[],e._headerCheckFuncs={},e.table.internalProps.layoutMap.headerObjects.forEach(((t,n)=>{if("checkbox"===t.headerType){const n=t.define.checked;null==n||"function"==typeof n?(i=!0,"function"==typeof n&&(e._headerCheckFuncs[t.field]=n)):e.headerCheckedState[t.field]=n,"checkbox"!==t.define.cellType&&!VC(t.define.cellType)||t.fieldFormat||e._checkboxCellTypeFields.push(t.field)}})),1===e.table.leftRowSeriesNumberCount)e.headerCheckedState._vtable_rowSeries_number=!1,e._checkboxCellTypeFields.push("_vtable_rowSeries_number"),i=!0;else if(e.table.leftRowSeriesNumberCount>1){for(let t=0;t<e.table.leftRowSeriesNumberCount;t++)e.headerCheckedState[`_vtable_rowSeries_number_${t}`]=!1,e._checkboxCellTypeFields.push(`_vtable_rowSeries_number_${t}`);i=!0}i&&function(t,e){const i=e.table,n=i.isPivotTable()?0:i.internalProps.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount,o=i.isPivotTable()?ZC(t)?t.length:0:i.internalProps.transpose?i.colCount:i.rowCount;for(let r=0;r+n<o;r++){const n=i.isPivotTable()?t[r]:i.dataSource.get(r);e._checkboxCellTypeFields.forEach((t=>{const o=n&&n[t];let s;if($C(o)?s=o.checked:"boolean"==typeof o&&(s=o),null==s){const i=e._headerCheckFuncs[t];if(i){const n=e.table.getCellAddrByFieldRecord(t,r);s=n_(i,{col:n.col,row:n.row,table:e.table,context:null,value:o})}}const a=i.isPivotTable()?r.toString():e.table.dataSource.getIndexKey(r).toString();e.checkedState.get(a)||e.checkedState.set(a,{}),e.checkedState.get(a)[t]=s}))}}(t,e)}function XP(t,e,i,n){var o,r;const s=n.scenegraph.getCell(t,e),a=(null==s?void 0:s.getChildByName("checkbox"))||(null===(r=null===(o=null==s?void 0:s.getChildByName("checkbox-content"))||void 0===o?void 0:o._checkboxGroup)||void 0===r?void 0:r.getChildByName("checkbox"));a&&("indeterminate"===i?(a.setAttribute("indeterminate",!0),a.setAttribute("checked",void 0)):(a.setAttribute("indeterminate",void 0),a.setAttribute("checked",i)))}function $P(t,e){"adaptive"===e.table.heightMode&&e.rowResize.row<e.table.rowCount-1?(e.table.scenegraph.updateRowHeight(e.rowResize.row,t),e.table.scenegraph.updateRowHeight(e.rowResize.row+1,-t),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row+1)):(e.table.scenegraph.updateRowHeight(e.rowResize.row,t),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row))}t_(v_,{VCHART_EVENT_TYPE:"vchart_event_type"});function YP(t){if(t.eventManager.bindSparklineHoverEvent)return;let e=!1;e=t.isPivotTable()?t.internalProps.layoutMap.indicatorsDefine.some((t=>"string"!=typeof t&&"sparkline"===t.cellType)):t.internalProps.layoutMap.columnObjects.some((t=>"sparkline"===t.cellType||"function"==typeof t.cellType)),e&&(t.eventManager.bindSparklineHoverEvent=!0,t.on(v_.MOUSEMOVE_CELL,(e=>{const{col:i,row:n,x:o,y:r}=e;"sparkline"!==t.getBodyColumnType(i,n)&&t.stateManager.updateSparklineHoverPose(-1,-1,0,0),t.stateManager.updateSparklineHoverPose(i,n,o,r)})),t.on(v_.MOUSELEAVE_TABLE,(e=>{t.stateManager.updateSparklineHoverPose(-1,-1,0,0)})))}function KP(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n,o,r;let{deltaX:s,deltaY:a}=t;t.shiftKey&&t.deltaY&&(s=a,a=0);const[l,h]=function(t,e,i){var n,o;const r=Math.abs(t/e),s=r<=.5?0:t,a=r>2?0:e;return[Math.ceil(s*(null!==(n=i.horizontal)&&void 0!==n?n:0)),Math.ceil(a*(null!==(o=i.vertical)&&void 0!==o?o:0))]}(s,a,{horizontal:1,vertical:1});(l||h)&&e.interactionState!==jw.scrolling&&e.updateInteractionState(jw.scrolling);const d="scrolling"===(null===(o=null===(n=e.table.options.theme)||void 0===n?void 0:n.scrollStyle)||void 0===o?void 0:o.visible);l&&(e.setScrollLeft(e.scroll.horizontalBarPos+l,t),e.showHorizontalScrollBar(d)),h&&(e.setScrollTop(e.scroll.verticalBarPos+h,t),e.showVerticalScrollBar(d)),i&&e.resetInteractionState(e.interactionStateBeforeScroll),(null===(r=t.nativeEvent)||void 0===r?void 0:r.cancelable)&&("none"===e.table.internalProps.overscrollBehavior||Math.abs(a)>=Math.abs(s)&&0!==a&&qP(a,e)||Math.abs(a)<=Math.abs(s)&&0!==s&&ZP(s,e))&&t.nativeEvent.preventDefault()}function qP(t,e){return 0!=e.table.getAllRowsHeight()-e.table.scenegraph.height&&!function(t,e){return 0!=e.table.getAllRowsHeight()-e.table.scenegraph.height&&t<=0&&e.scroll.verticalBarPos<1}(t,e)&&!function(t,e){var i;const n=(null===(i=e.table.options.customConfig)||void 0===i?void 0:i._disableColumnAndRowSizeRound)?1:0,o=e.table.getAllRowsHeight()-e.table.scenegraph.height;return 0!==o&&t>=0&&Math.abs(e.scroll.verticalBarPos-o)<1+n}(t,e)}function ZP(t,e){return 0!=e.table.getAllColsWidth()-e.table.scenegraph.width&&!function(t,e){return 0!=e.table.getAllColsWidth()-e.table.scenegraph.width&&t<=0&&e.scroll.horizontalBarPos<1}(t,e)&&!function(t,e){var i;const n=(null===(i=e.table.options.customConfig)||void 0===i?void 0:i._disableColumnAndRowSizeRound)?1:0,o=e.table.getAllColsWidth()-e.table.scenegraph.width;return 0!==o&&t>=0&&Math.abs(e.scroll.horizontalBarPos-o)<1+n}(t,e)}class JP{constructor(t){this.stateManager=t}setScrollHandle(t){this.scrollHandle=t}startInertia(t,e,i){this.lastTime=Date.now(),this.speedX=t,this.speedY=e,this.friction=i,this.runingId||(this.runingId=requestAnimationFrame(this.inertia.bind(this)))}inertia(){var t;const e=Date.now(),i=e-this.lastTime;let n=!0;const o=Math.pow(this.friction,i/16),r=o*this.speedX,s=o*this.speedY;let a=0,l=0;Math.abs(r)>.05&&(n=!1,a=(this.speedX+r)/2*i),Math.abs(s)>.05&&(n=!1,l=(this.speedY+s)/2*i),null===(t=this.scrollHandle)||void 0===t||t.call(this,a,l),n?this.runingId=null:(this.lastTime=e,this.speedX=r,this.speedY=s,this.runingId=requestAnimationFrame(this.inertia.bind(this)))}endInertia(){cancelAnimationFrame(this.runingId),this.runingId=null}isInertiaScrolling(){return!!this.runingId}}function QP(t,e,i){var n,o,r,s;e&&-1!==(null===(n=t.stateManager.columnMove)||void 0===n?void 0:n.colSource)&&-1!==(null===(o=t.stateManager.columnMove)||void 0===o?void 0:o.rowSource)&&-1!==(null===(r=t.stateManager.columnMove)||void 0===r?void 0:r.colTarget)&&-1!==(null===(s=t.stateManager.columnMove)||void 0===s?void 0:s.rowTarget)?t.hasListeners(v_.CHANGE_HEADER_POSITION)&&t.fireListeners(v_.CHANGE_HEADER_POSITION,{target:{col:t.stateManager.columnMove.colTarget,row:t.stateManager.columnMove.rowTarget},source:{col:t.stateManager.columnMove.colSource,row:t.stateManager.columnMove.rowSource},event:i}):e||t.hasListeners(v_.CHANGE_HEADER_POSITION_FAIL)&&t.fireListeners(v_.CHANGE_HEADER_POSITION_FAIL,{target:{col:t.stateManager.columnMove.colTarget,row:t.stateManager.columnMove.rowTarget},source:{col:t.stateManager.columnMove.colSource,row:t.stateManager.columnMove.rowSource},event:i})}function tE(t){const e=t.table,i=e.stateManager;e.scenegraph.tableGroup.addEventListener("pointermove",(n=>{var o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x;const _=null!==(r=null===(o=e.eventManager.LastPointerXY)||void 0===o?void 0:o.x)&&void 0!==r?r:n.x,S=null!==(a=null===(s=e.eventManager.LastPointerXY)||void 0===s?void 0:s.y)&&void 0!==a?a:n.y;e.eventManager.LastPointerXY={x:n.x,y:n.y},t.touchSetTimeout&&(clearTimeout(t.touchSetTimeout),t.touchSetTimeout=void 0);const A=OT(n);if(A.eventArgs&&e.hasListeners(v_.MOUSEMOVE_TABLE)&&e.fireListeners(v_.MOUSEMOVE_TABLE,{col:A.eventArgs.col,row:A.eventArgs.row,x:A.abstractPos.x,y:A.abstractPos.y,event:n.nativeEvent,target:null===(l=null==A?void 0:A.eventArgs)||void 0===l?void 0:l.target,mergeCellInfo:null===(h=A.eventArgs)||void 0===h?void 0:h.mergeInfo}),i.interactionState===jw.grabing&&!(null===(d=e.editorManager)||void 0===d?void 0:d.editingEditor))return void(Math.abs(_-n.x)+Math.abs(S-n.y)>=1&&(i.isResizeCol()||i.isResizeRow()||(i.isMoveCol()?t.dealColumnMover(A):i.isFillHandle()?t.dealFillSelect(A,!0):(null===(c=e.options.select)||void 0===c?void 0:c.disableDragSelect)||t.dealTableSelect(A,!0))));!(null===(u=e.options.select)||void 0===u?void 0:u.disableDragSelect)&&e.eventManager.isDraging&&i.isSelecting()&&!(null===(g=e.editorManager)||void 0===g?void 0:g.editingEditor)&&t.dealTableSelect(A,!0);const B=n.path.find((t=>"cell"===t.role));if(e.hasListeners(v_.MOUSELEAVE_CELL)&&(-1===e.stateManager.hover.cellPos.col||-1===e.stateManager.hover.cellPos.row||(null==B?void 0:B.col)===e.stateManager.hover.cellPos.col&&(null==B?void 0:B.row)===e.stateManager.hover.cellPos.row||e.fireListeners(v_.MOUSELEAVE_CELL,{col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row,cellRange:e.getCellRangeRelativeRect({col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:n.nativeEvent,target:null===(p=null==A?void 0:A.eventArgs)||void 0===p?void 0:p.target})),e.hasListeners(v_.MOUSEENTER_CELL)&&("cell"!==(null==B?void 0:B.role)||!XC(B.col)||!XC(B.row)||B.col===e.stateManager.hover.cellPos.col&&B.row===e.stateManager.hover.cellPos.row||B.col===(null===(f=e.stateManager.hover.cellPosContainHeader)||void 0===f?void 0:f.col)&&B.row===(null===(v=e.stateManager.hover.cellPosContainHeader)||void 0===v?void 0:v.row)||e.fireListeners(v_.MOUSEENTER_CELL,{col:B.col,row:B.row,cellRange:e.getCellRangeRelativeRect({col:B.col,row:B.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:n.nativeEvent,target:null===(b=null==A?void 0:A.eventArgs)||void 0===b?void 0:b.target,mergeCellInfo:null===(m=A.eventArgs)||void 0===m?void 0:m.mergeInfo})),t.dealIconHover(A),t.dealTableHover(A),e.theme.columnResize.visibleOnHover&&t.checkColumnResize(A,!0),A.eventArgs&&e.hasListeners(v_.MOUSEMOVE_CELL)){let t,i;if(null===(y=A.eventArgs)||void 0===y?void 0:y.target){const e=GP(null===(C=A.eventArgs)||void 0===C?void 0:C.target);e&&(t=e.icon,i=e.position)}e.fireListeners(v_.MOUSEMOVE_CELL,{col:A.eventArgs.col,row:A.eventArgs.row,x:A.abstractPos.x,y:A.abstractPos.y,event:n.nativeEvent,targetIcon:t?{name:t.name,position:i,funcType:t.attribute.funcType}:void 0,target:null===(w=null==A?void 0:A.eventArgs)||void 0===w?void 0:w.target,mergeCellInfo:null===(x=A.eventArgs)||void 0===x?void 0:x.mergeInfo})}})),e.scenegraph.tableGroup.addEventListener("pointerout",(e=>{var i;const n=OT(e),o=null===(i=null==n?void 0:n.eventArgs)||void 0===i?void 0:i.target;"table"===(null==o?void 0:o.role)&&t.dealTableHover()})),e.scenegraph.tableGroup.addEventListener("pointerover",(t=>{var i,n;const o=OT(t),r=null===(i=null==o?void 0:o.eventArgs)||void 0===i?void 0:i.target;if(r&&e.hasListeners(v_.MOUSEOVER_CHART_SYMBOL)&&"symbol"===r.type){const i=t.composedPath().find((t=>"cell"===t.roll));if(i){const{col:r,row:s}=i,a={col:r,row:s,field:e.getHeaderField(r,s),value:e.getCellValue(r,s),dataValue:e.getCellOriginValue(r,s),cellHeaderPaths:e.internalProps.layoutMap.getCellHeaderPaths(r,s),title:e.getBodyColumnDefine(r,s).title,cellRange:e.getCellRelativeRect(r,s),event:t.nativeEvent,sparkline:{pointData:void 0},scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:null===(n=null==o?void 0:o.eventArgs)||void 0===n?void 0:n.target};e.fireListeners(v_.MOUSEOVER_CHART_SYMBOL,a)}}})),e.scenegraph.tableGroup.addEventListener("pointerenter",(t=>{(e.theme.scrollStyle.horizontalVisible&&"focus"===e.theme.scrollStyle.horizontalVisible||!e.theme.scrollStyle.horizontalVisible&&"focus"===e.theme.scrollStyle.visible)&&i.showHorizontalScrollBar(),(e.theme.scrollStyle.verticalVisible&&"focus"===e.theme.scrollStyle.verticalVisible||!e.theme.scrollStyle.verticalVisible&&"focus"===e.theme.scrollStyle.visible)&&i.showVerticalScrollBar(),e.hasListeners(v_.MOUSEENTER_TABLE)&&e.fireListeners(v_.MOUSEENTER_TABLE,{event:t.nativeEvent})})),e.scenegraph.tableGroup.addEventListener("pointerleave",(n=>{i.isResizeCol()||i.isResizeRow()||i.isMoveCol()||i.isSelecting()||(i.updateInteractionState(jw.default),i.updateCursor()),(e.theme.scrollStyle.horizontalVisible&&"focus"===e.theme.scrollStyle.horizontalVisible||!e.theme.scrollStyle.horizontalVisible&&"focus"===e.theme.scrollStyle.visible)&&i.hideHorizontalScrollBar(),(e.theme.scrollStyle.verticalVisible&&"focus"===e.theme.scrollStyle.verticalVisible||!e.theme.scrollStyle.verticalVisible&&"focus"===e.theme.scrollStyle.visible)&&i.hideVerticalScrollBar(),e.hasListeners(v_.MOUSELEAVE_CELL)&&-1!==e.stateManager.hover.cellPos.col&&-1!==e.stateManager.hover.cellPos.row&&e.fireListeners(v_.MOUSELEAVE_CELL,{col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row,cellRange:e.getCellRangeRelativeRect({col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:n.nativeEvent,target:void 0}),t.dealTableHover();const o=n.target;o&&!o.isDescendantsOf(e.scenegraph.tableGroup)&&e.fireListeners(v_.MOUSELEAVE_TABLE,{event:n.nativeEvent})})),e.scenegraph.tableGroup.addEventListener("pointerdown",(n=>{var o,r,s,a,l;if(e.hasListeners(v_.MOUSEDOWN_TABLE)&&e.fireListeners(v_.MOUSEDOWN_TABLE,{event:n.nativeEvent}),e.eventManager.isDown=!0,e.eventManager.LastBodyPointerXY={x:n.x,y:n.y},e.eventManager.LastPointerXY={x:n.x,y:n.y},0!==n.button)return;const h=OT(n);if(t.downIcon=void 0,i.interactionState!==jw.default)return;if(e.isPivotChart()&&"chart"!==(null===(o=null==h?void 0:h.eventArgs)||void 0===o?void 0:o.target.type)&&e.scenegraph.updateChartState(null),(null===(r=h.eventArgs)||void 0===r?void 0:r.target)!==(null===(s=i.residentHoverIcon)||void 0===s?void 0:s.icon)&&i.hideMenu(),"chart"===(null===(a=null==h?void 0:h.eventArgs)||void 0===a?void 0:a.target.type))return;r_(null===(l=e.editorManager)||void 0===l?void 0:l.completeEdit(n.nativeEvent),(o=>{var r,s,a,l,d,c,u,g,p,f,v;if(!1===o)return;const b=(null===(a=null===(s=null===(r=null==h?void 0:h.eventArgs)||void 0===r?void 0:r.target)||void 0===s?void 0:s.role)||void 0===a?void 0:a.startsWith("icon"))?h.eventArgs.target:(null===(l=n.target.role)||void 0===l?void 0:l.startsWith("icon"))?n.target:void 0;if(t.downIcon=b,b&&!1!==b.attribute.interactive)b.attribute.funcType===Zw.dragReorder&&(i.startMoveCol(h.eventArgs.col,h.eventArgs.row,h.abstractPos.x,h.abstractPos.y,null===(f=null===(p=h.eventArgs)||void 0===p?void 0:p.event)||void 0===f?void 0:f.nativeEvent),i.updateInteractionState(jw.grabing));else{if(t.cellIsHeaderCheck(h))return;if("touch"===n.pointerType){if(t.touchEnd=!1,t.touchSetTimeout=setTimeout((()=>{t.isTouchdown=!1,t.isLongTouch=!0,(!t.touchEnd&&(t.checkColumnResize(h,!0)||t.checkRowResize(h,!0))||!t.touchEnd&&t.checkColumnMover(h)||t.dealTableSelect(h)&&!t.touchEnd)&&i.updateInteractionState(jw.grabing)}),500),e.hasListeners(v_.MOUSEENTER_CELL)){const t=n.path.find((t=>"cell"===t.role));"cell"!==(null==t?void 0:t.role)||!XC(t.col)||!XC(t.row)||t.col===e.stateManager.hover.cellPos.col&&t.row===e.stateManager.hover.cellPos.row||t.col===(null===(d=e.stateManager.hover.cellPosContainHeader)||void 0===d?void 0:d.col)&&t.row===(null===(c=e.stateManager.hover.cellPosContainHeader)||void 0===c?void 0:c.row)||e.fireListeners(v_.MOUSEENTER_CELL,{col:t.col,row:t.row,cellRange:e.getCellRangeRelativeRect({col:t.col,row:t.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:n.nativeEvent,target:null===(u=null==h?void 0:h.eventArgs)||void 0===u?void 0:u.target,mergeCellInfo:null===(g=h.eventArgs)||void 0===g?void 0:g.mergeInfo})}t.dealTableHover(h)}else{if(!t.checkCellFillhandle(h)&&(t.checkColumnResize(h,!0)||t.checkRowResize(h,!0)))return e.scenegraph.updateChartState(null),void i.updateInteractionState(jw.grabing);if(t.checkColumnMover(h))return void i.updateInteractionState(jw.grabing);if(t.checkCellFillhandle(h,!0)&&t.dealFillSelect(h))return void i.updateInteractionState(jw.grabing);t.dealTableSelect(h)&&i.updateInteractionState(jw.grabing)}}if(e.hasListeners(v_.MOUSEDOWN_CELL)){const t=OT(n);t.eventArgs&&e.fireListeners(v_.MOUSEDOWN_CELL,{col:t.eventArgs.col,row:t.eventArgs.row,event:n.nativeEvent,target:null===(v=null==t?void 0:t.eventArgs)||void 0===v?void 0:v.target,mergeCellInfo:t.eventArgs.mergeInfo})}}))})),e.scenegraph.tableGroup.addEventListener("pointerup",(n=>{var o,r,s,a;if(0===n.button){if("grabing"===i.interactionState){if(i.updateInteractionState(jw.default),i.isResizeCol())iE(e);else if(i.isResizeRow())nE(e);else if(i.isMoveCol()){const t=e.stateManager.endMoveCol();QP(e,t,n.nativeEvent)}else if(i.isSelecting()){e.stateManager.endSelectCells(),e.stateManager.isFillHandle()&&e.stateManager.endFillSelect();const t=OT(n);if(e.eventManager.isDraging&&t.eventArgs&&e.hasListeners(v_.DRAG_SELECT_END)){const i={event:n.nativeEvent,cells:[],col:t.eventArgs.target.col,row:t.eventArgs.target.row,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:null===(o=null==t?void 0:t.eventArgs)||void 0===o?void 0:o.target,mergeCellInfo:null===(r=t.eventArgs)||void 0===r?void 0:r.mergeInfo};i.cells=e.getSelectedCellInfos(),e.fireListeners(v_.DRAG_SELECT_END,i)}}}else i.interactionState===jw.scrolling&&i.updateInteractionState(jw.default);if(e.hasListeners(v_.MOUSEUP_CELL)){const t=OT(n);t.eventArgs&&e.fireListeners(v_.MOUSEUP_CELL,{col:t.eventArgs.col,row:t.eventArgs.row,event:n.nativeEvent,target:null===(s=null==t?void 0:t.eventArgs)||void 0===s?void 0:s.target,mergeCellInfo:null===(a=t.eventArgs)||void 0===a?void 0:a.mergeInfo})}setTimeout((()=>{t.isDown=!1,t.isTouchdown=!1,t.isTouchMove=!1,t.isDraging=!1,t.touchMovePoints=[]}),0)}})),e.scenegraph.tableGroup.addEventListener("rightdown",(t=>{var n,o,r,s;const a=OT(t);if(a.eventArgs){i.triggerContextMenu(a.eventArgs.col,a.eventArgs.row,a.abstractPos.x,a.abstractPos.y);const{col:l,row:h}=a.eventArgs;if(e.hasListeners(v_.CONTEXTMENU_CELL)){const i=e.getCellInfo(l,h);let d,c;if(null===(n=a.eventArgs)||void 0===n?void 0:n.target){const t=GP(null===(o=a.eventArgs)||void 0===o?void 0:o.target);t&&(d=t.icon,c=t.position)}const u=Object.assign(Object.assign({},i),{event:t.nativeEvent,cells:[],targetIcon:d?{name:d.name,position:c,funcType:d.attribute.funcType}:void 0,target:null===(r=null==a?void 0:a.eventArgs)||void 0===r?void 0:r.target,mergeCellInfo:null===(s=a.eventArgs)||void 0===s?void 0:s.mergeInfo});!function(t,e,i){for(let n=0;n<t.length;n++){const o=t[n],r=Math.min(o.start.col,o.end.col),s=Math.max(o.start.col,o.end.col),a=Math.min(o.start.row,o.end.row),l=Math.max(o.start.row,o.end.row);if(r<=e&&e<=s&&a<=i&&i<=l||s<=e&&e<=r&&l<=i&&i<=a)return!0}return!1}(e.stateManager.select.ranges,l,h)?u.cells=[[i]]:u.cells=e.getSelectedCellInfos(),e.fireListeners(v_.CONTEXTMENU_CELL,u)}}})),e.scenegraph.tableGroup.addEventListener("pointertap",(n=>{var o,r,s,a,l;if(e.stateManager.columnResize.resizing)return;const h=OT(n);if(!t.isTouchMove&&0===n.button&&h.eventArgs&&e.hasListeners(v_.CLICK_CELL)){const{col:t,row:i}=h.eventArgs,l=e.getCellInfo(t,i);let d,c;if(null===(o=h.eventArgs)||void 0===o?void 0:o.target){const t=GP(null===(r=h.eventArgs)||void 0===r?void 0:r.target);t&&(d=t.icon,c=t.position)}const u=Object.assign(Object.assign({},l),{event:n.nativeEvent,federatedEvent:n,cells:[],targetIcon:d?{name:d.name,position:c,funcType:d.attribute.funcType}:void 0,target:null===(s=null==h?void 0:h.eventArgs)||void 0===s?void 0:s.target,mergeCellInfo:null===(a=h.eventArgs)||void 0===a?void 0:a.mergeInfo});e.fireListeners(v_.CLICK_CELL,u)}if(!e.stateManager.columnResize.resizing&&!e.stateManager.columnMove.moving&&(t.dealIconClick(n,h),(null==h?void 0:h.eventArgs)&&t.touchSetTimeout&&"touch"===n.pointerType)){const e=OT(n);if(t.touchSetTimeout){clearTimeout(t.touchSetTimeout);const n=!!(null===(l=i.select.ranges)||void 0===l?void 0:l.length);t.dealTableSelect(e),i.endSelectCells(!0,n),t.touchSetTimeout=void 0}}})),e.scenegraph.stage.addEventListener("pointerdown",(n=>{var o,r,s,a;const l=OT(n);(null===(o=l.eventArgs)||void 0===o?void 0:o.target)&&(null===(r=l.eventArgs)||void 0===r?void 0:r.target)===(null===(s=i.residentHoverIcon)||void 0===s?void 0:s.icon)||i.hideMenu();r_(null===(a=e.editorManager)||void 0===a?void 0:a.completeEdit(n.nativeEvent),(o=>{var r;if(!1===o)return;const s=(null===(r=n.target.role)||void 0===r?void 0:r.startsWith("icon"))?n.target:void 0;if(t.downIcon=s,"touch"===n.pointerType||s||t.checkCellFillhandle(l)||i.columnResize.resizing||!t.checkColumnResize(l,!0));else{e.scenegraph.updateChartState(null),i.updateInteractionState(jw.grabing);const{eventArgs:t}=l;(null==t?void 0:t.targetCell)||e.getCellAt(l.abstractPos.x-e.theme.columnResize.resizeHotSpotSize/2,l.abstractPos.y)&&e.hasListeners(v_.MOUSEDOWN_TABLE)&&e.fireListeners(v_.MOUSEDOWN_TABLE,{event:n.nativeEvent})}}))})),e.scenegraph.stage.addEventListener("pointerup",(t=>{"grabing"===i.interactionState&&(i.updateInteractionState(jw.default),i.isResizeCol()?iE(e):i.isResizeRow()&&nE(e))})),e.scenegraph.stage.addEventListener("pointertap",(n=>{var o,r,s;const a=n.target;if(e.eventManager.isDraging||!a||!a.isDescendantsOf(e.scenegraph.stage)&&a.stage!==a||a.isDescendantsOf(e.scenegraph.tableGroup))e.eventManager.isDraging&&i.isSelecting()&&i.endSelectCells();else{i.updateInteractionState(jw.default),t.dealTableHover();const n=!!(null===(o=i.select.ranges)||void 0===o?void 0:o.length);(null===(s=null===(r=e.options.select)||void 0===r?void 0:r.blankAreaClickDeselect)||void 0===s||s)&&t.dealTableSelect(),i.endSelectCells(!0,n),i.updateCursor(),e.scenegraph.updateChartState(null)}})),e.scenegraph.stage.addEventListener("pointermove",(n=>{const o=OT(n);i.isResizeCol()||t.checkColumnResize(o)?e.stateManager.select&&t.checkCellFillhandle(o)?i.updateCursor("crosshair"):i.updateCursor("col-resize"):i.isResizeRow()||t.checkRowResize(o)?e.stateManager.select&&t.checkCellFillhandle(o)?i.updateCursor("crosshair"):i.updateCursor("row-resize"):i.isMoveCol()||i.updateCursor()})),e.scenegraph.tableGroup.addEventListener("checkbox_state_change",(t=>{var i,n;const o=OT(t),{col:r,row:s}=o.eventArgs,a=e.getCellInfo(r,s),l=Z_(e,r,s);if(l)for(let i=l.start.col;i<=l.end.col;i++)for(let n=l.start.row;n<=l.end.row;n++)e.scenegraph.getCell(i,n).forEachChildren((e=>{"checkbox"===e.name&&e.setAttributes({checked:t.target.attribute.checked,indeterminate:t.target.attribute.indeterminate})}));const h=Object.assign(Object.assign({},a),{event:t.nativeEvent,target:null===(i=null==o?void 0:o.eventArgs)||void 0===i?void 0:i.target,mergeCellInfo:null===(n=null==o?void 0:o.eventArgs)||void 0===n?void 0:n.mergeInfo,checked:t.detail.checked});if(e.isHeader(r,s))e.stateManager.setHeaderCheckedState(a.field,t.detail.checked),"checkbox"===e.getCellType(r,s)&&e.scenegraph.updateCheckboxCellState(r,s,t.detail.checked);else if(e.stateManager.setCheckedState(r,s,a.field,t.detail.checked),"checkbox"===e.getCellType(r,s)){const t=e.stateManager.headerCheckedState[a.field],i=e.stateManager.updateHeaderCheckedState(a.field,r,s);t!==i&&e.scenegraph.updateHeaderCheckboxCellState(r,s,i)}e.fireListeners(v_.CHECKBOX_STATE_CHANGE,h),e.scenegraph.updateNextFrame()})),e.scenegraph.tableGroup.addEventListener("radio_checked",(t=>{var i,n,o;const r=OT(t),{col:s,row:a,target:l}=r.eventArgs,h=e.getCellInfo(s,a),d=null===(i=zT.exec(l.id))||void 0===i?void 0:i[1],c=Z_(e,s,a);if(c)for(let t=c.start.col;t<=c.end.col;t++)for(let i=c.start.row;i<=c.end.row;i++)e.scenegraph.getCell(t,i).forEachChildren((t=>{"radio"===t.name&&t.id===l.id&&t.setAttributes({checked:!0})}));const u=e.getBodyColumnDefine(s,a).radioCheckType||"column";if("cell"===u)if(c)for(let t=c.start.col;t<=c.end.col;t++)for(let i=c.start.row;i<=c.end.row;i++)e.scenegraph.getCell(t,i).forEachChildren((t=>{"radio"===t.name&&t.id!==l.id&&t.setAttributes({checked:!1})}));else e.scenegraph.getCell(s,a).forEachChildren((t=>{"radio"===t.name&&t.id!==l.id&&t.setAttributes({checked:!1})}));else"column"===u&&e.scenegraph.getColGroup(s).forEachChildren((t=>{t.forEachChildren((t=>{"radio"===t.name&&t.id!==l.id&&t.setAttributes({checked:!1})}))}));const g=d?Number(d):void 0;e.stateManager.setRadioState(s,a,h.field,u,g);const p=Object.assign(Object.assign({},h),{event:t.nativeEvent,target:null===(n=null==r?void 0:r.eventArgs)||void 0===n?void 0:n.target,mergeCellInfo:null===(o=null==r?void 0:r.eventArgs)||void 0===o?void 0:o.mergeInfo,radioIndexInCell:g});e.fireListeners(v_.RADIO_STATE_CHANGE,p),e.scenegraph.updateNextFrame()})),e.scenegraph.tableGroup.addEventListener("switch_state_change",(t=>{var i,n;const o=OT(t),{col:r,row:s,target:a}=o.eventArgs,l=e.getCellInfo(r,s),h=Z_(e,r,s);if(h)for(let i=h.start.col;i<=h.end.col;i++)for(let n=h.start.row;n<=h.end.row;n++)e.scenegraph.getCell(i,n).forEachChildren((e=>{"switch"===e.name&&e.setAttributes({checked:t.target.attribute.checked})}));const d=Object.assign(Object.assign({},l),{event:t.nativeEvent,target:null===(i=null==o?void 0:o.eventArgs)||void 0===i?void 0:i.target,mergeCellInfo:null===(n=null==o?void 0:o.eventArgs)||void 0===n?void 0:n.mergeInfo,checked:t.detail.checked});e.stateManager.setCheckedState(r,s,l.field,t.detail.checked),e.fireListeners(v_.SWITCH_STATE_CHANGE,d),e.scenegraph.updateNextFrame()})),e.scenegraph.stage.addEventListener("wheel",(t=>{var n;t.path.find((t=>"legend"===t.name))||(null===(n=e.editorManager)||void 0===n||n.completeEdit(),e.eventManager._enableTableScroll&&KP(t,i))}))}function eE(t){const e=t.table;t.gesture=new ap(e.scenegraph.tableGroup,{tap:{interval:300}}),t.gesture.on("doubletap",(t=>{!function(t,e){var i,n,o,r,s,a;const l=OT(t);let h=-1,d=-1;l.eventArgs&&(h=l.eventArgs.col,d=l.eventArgs.row);const c=e.getCellValue(h,d),u=null===(n=null===(i=l.eventArgs)||void 0===i?void 0:i.targetCell)||void 0===n?void 0:n.globalAABBBounds;if(u&&e.internalProps.focusControl.setFocusRect(new __(u.x1+e.scrollLeft,u.y1+e.scrollTop,u.x2-u.x1,u.y2-u.y1),c),e.hasListeners(v_.DBLCLICK_CELL)){const i=e.getCellInfo(h,d);let n,c;if(null===(o=l.eventArgs)||void 0===o?void 0:o.target){const t=GP(null===(r=l.eventArgs)||void 0===r?void 0:r.target);t&&(n=t.icon,c=t.position)}const u=Object.assign(Object.assign({},i),{event:t.nativeEvent,federatedEvent:t,cells:[],targetIcon:n?{name:n.name,position:c,funcType:n.attribute.funcType}:void 0,target:null===(s=null==l?void 0:l.eventArgs)||void 0===s?void 0:s.target,mergeCellInfo:null===(a=null==l?void 0:l.eventArgs)||void 0===a?void 0:a.mergeInfo});e.fireListeners(v_.DBLCLICK_CELL,u)}}(t,e)}))}function iE(t){t.stateManager.endResizeCol();const e=[];for(let i=0;i<t.colCount;i++)e.push(t.getColWidth(i));t.fireListeners(v_.RESIZE_COLUMN_END,{col:t.stateManager.columnResize.col,colWidths:e})}function nE(t){t.stateManager.endResizeRow(),t.fireListeners(v_.RESIZE_ROW_END,{row:t.stateManager.rowResize.row,rowHeight:t.getRowHeight(t.stateManager.rowResize.row)})}let oE=1;function rE(){return Ux?oE=1:(oE=Math.ceil(window.devicePixelRatio||1),oE>1&&oE%2!=0&&(oE+=1)),oE}rE();var sE=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))};function aE(t){return!!t.changedTouches}function lE(t,e,i){if(i.indicatorsAsCol){if(i.hasTwoIndicatorAxes&&e===i.columnHeaderLevelCount-1&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return"top";if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return"bottom";if(t===i.rowHeaderLevelCount-1&&e>=i.rowHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return"left"}else{if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return"left";if(t===i.colCount-i.rightFrozenColCount&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return"right";if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return"bottom"}return"bottom"}function hE(t,e,i,n,o,r,s){var a;const l=s||"_vtable_rowSeries_number";let h=e+1;for(;ZC(n[h])&&(null===(a=n[h])||void 0===a?void 0:a.length)>i.length;){const e=o.columnHeaderLevelCount+h;o.stateManager.setCheckedState(r,e,l,t),XP(r,e,t,o),h++}}function dE(t,e,i,n,o,r){var s;let a=e.length-1;if(a>0){let e=t-1;for(;a>0&&e>=0;)(ZC(i[e])&&(null===(s=i[e])||void 0===s?void 0:s.length)===a||1===a&&tw(i[e]))&&(cE(o,n.columnHeaderLevelCount+e,i[e],n,r),a--),e--}}function cE(t,e,i,n,o){const{checkedState:r}=n.stateManager,s=i.toString(),a=o||"_vtable_rowSeries_number";ZC(i)&&i.length;let l=!1;const h=[],d=Array.from(r.keys()).sort(((t,e)=>{var i,n;const o=t.split(","),r=e.split(","),s=Math.max(o.length,r.length);for(let t=0;t<s;t++){const e=null!==(i=Number(o[t]))&&void 0!==i?i:0,s=null!==(n=Number(r[t]))&&void 0!==n?n:0;if(e!==s)return e-s}return 0})),c=d.map((t=>r.get(t))),u=d.filter((t=>t.startsWith(s+",")&&t!==s));if(c.forEach(((t,e)=>{const i=d[e],n=t,o=u.includes(i);l&&(o?h.push(n[a]):l=!1),i===s&&(l=!0)})),0===h.length)return;const g=h.every((t=>!!t)),p=h.every((t=>!t));g?(n.stateManager.setCheckedState(t,e,a,!0),XP(t,e,!0,n)):p?(n.stateManager.setCheckedState(t,e,a,!1),XP(t,e,!1,n)):(n.stateManager.setCheckedState(t,e,a,"indeterminate"),XP(t,e,"indeterminate",n))}function uE(t,e,i,n){const{checkedState:o}=i.stateManager,r=e.toString();ZC(e)&&e.length;let s=!1;const a=Array.from(o.keys()).sort(((t,e)=>{var i,n;const o=t.split(","),r=e.split(","),s=Math.max(o.length,r.length);for(let t=0;t<s;t++){const e=null!==(i=Number(o[t]))&&void 0!==i?i:0,s=null!==(n=Number(r[t]))&&void 0!==n?n:0;if(e!==s)return e-s}return 0})),l=a.filter((t=>t.startsWith(r+",")&&t!==r)),h=a.map((t=>o.get(t)));h.forEach(((e,i)=>{const o=a[i],h=e,d=0!==l.length&&l.includes(o);s&&(d?h[n]=t:s=!1),o===r&&(s=!0)}))}function gE(t,e,i){const n=t.getRecordShowIndexByCell(e,i);return t.dataSource.getHierarchyState(n)}function pE(t){t.on(v_.ICON_CLICK,(e=>{var i;const{col:n,row:o,x:r,y:s,funcType:a,icon:l,event:h}=e,{stateManager:d}=t;if(a===Zw.dropDown)d.triggerDropDownMenu(n,o,r,s,h);else if(a===Zw.sort)d.triggerSort(n,o,l,h);else if(a===Zw.frozen)d.triggerFreeze(n,o,l);else if(a===Zw.drillDown)!function(t){t.fireListeners(WP.DRILLMENU_CLICK,t.stateManager.drill)}(t);else if(a===Zw.collapse||a===Zw.expand){const e=!!(null===(i=d.select.ranges)||void 0===i?void 0:i.length);d.updateSelectPos(-1,-1),d.endSelectCells(!0,e),t.toggleHierarchyState(n,o)}}))}let fE;const vE=t=>{const e=t.value;return Number(e)>80?"#20a8d8":Number(e)>50?"#4dbd74":Number(e)>20?"#ffc107":"#f86c6b"};class bE extends mx{static get DEFAULT(){return fE||(fE=new bE)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v;super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this._showBar=null===(e=t.showBar)||void 0===e||e,this._barColor=null!==(i=t.barColor)&&void 0!==i?i:vE,this._barPositiveColor=null!==(n=t.barPositiveColor)&&void 0!==n?n:"#4dbd74",this._barNegativeColor=null!==(o=t.barNegativeColor)&&void 0!==o?o:"#f86c6b",this._barAxisColor=null!==(r=t.barAxisColor)&&void 0!==r?r:"black",this._barBgColor=t.barBgColor,this._barHeight=null!==(s=t.barHeight)&&void 0!==s?s:3,this._barHeight=null!==(a=t.barHeight)&&void 0!==a?a:3,this._barBottom=null!==(l=t.barBottom)&&void 0!==l?l:0,this._barPadding=null!==(h=t.barPadding)&&void 0!==h?h:[0,0,0,0],this._showBarMark=null!==(d=t.showBarMark)&&void 0!==d&&d,this._barMarkPositiveColor=null!==(c=t.barMarkPositiveColor)&&void 0!==c?c:"#4dbd74",this._barMarkNegativeColor=null!==(u=t.barMarkNegativeColor)&&void 0!==u?u:"#f86c6b",this._barMarkWidth=null!==(g=t.barMarkWidth)&&void 0!==g?g:2,this._barMarkPosition=null!==(p=t.barMarkPosition)&&void 0!==p?p:"right",this._barRightToLeft=null!==(f=t.barRightToLeft)&&void 0!==f&&f,this._barMarkInBar=null===(v=t.barMarkInBar)||void 0===v||v}get showBar(){return this._showBar}set showBar(t){this._showBar=t}get barColor(){return this._barColor}set barColor(t){this._barColor=t}get barBgColor(){return this._barBgColor}set barBgColor(t){this._barBgColor=t}get barHeight(){return this._barHeight}set barHeight(t){this._barHeight=t}get barBottom(){return this._barBottom}set barBottom(t){this._barBottom=t}get barPositiveColor(){return this._barPositiveColor}set barPositiveColor(t){this._barPositiveColor=t}get barNegativeColor(){return this._barNegativeColor}set barNegativeColor(t){this._barNegativeColor=t}get barAxisColor(){return this._barAxisColor}set barAxisColor(t){this._barAxisColor=t}get barPadding(){return this._barPadding}set barPadding(t){this._barPadding=t}get showBarMark(){return this._showBarMark}set showBarMark(t){this._showBarMark=t}get barMarkPositiveColor(){return this._barMarkPositiveColor}set barMarkPositiveColor(t){this._barMarkPositiveColor=t}get barMarkNegativeColor(){return this._barMarkNegativeColor}set barMarkNegativeColor(t){this._barMarkNegativeColor=t}get barMarkWidth(){return this._barMarkWidth}set barMarkWidth(t){this._barMarkWidth=t}get barMarkPosition(){return this._barMarkPosition}set barMarkPosition(t){this._barMarkPosition=t}get barRightToLeft(){return this._barRightToLeft}set barRightToLeft(t){this._barRightToLeft=t}get barMarkInBar(){return this._barMarkInBar}set barMarkInBar(t){this._barMarkInBar=t}clone(){return new bE(this,null)}}const mE=["type","content","style","color","width","height","marginRight","marginLeft","src","svg","name","path","positionType","tooltip","hover","cursor","shape","interactive","isGif"];class yE{constructor(t){this._table=t;const e=wR();this.expandIcon=e[Jw.expandIconName],this.collapseIcon=e[Jw.collapseIconName]}getIcons(t,e,i,n,o){const r=[],s=this.getHierarchyIcon(t,e);s&&r.push(s);const{icon:a}=this._table.getBodyColumnDefine(t,e);if(a){let o;o="function"==typeof a?a({col:t,row:e,value:i,dataValue:n,table:this._table}):a;const s=wR(),l=t=>{let e;e="string"==typeof t?s[t]:t,e&&r.push(e)};Array.isArray(o)?o.forEach(((t,e)=>{l(t)})):l(o)}return o&&r.forEach(((i,n)=>{(i.content||i.src)&&(r[n]=this.getCellIconFromRecordValue(i,t,e))})),r}getStyleClass(t){switch(t){case"text":case"link":return Cx;case"image":case"video":return yx;case"chart":case"sparkline":return mx;case"progressbar":return bE;case"checkbox":return Sx;case"radio":return Ax;case"switch":return Bx;case"button":return Tx}return Cx}getCellIconFromRecordValue(t,e,i){if(Array.isArray(t))return t.map((t=>this.getCellIconFromRecordValue(t,e,i)));if(!c_.isObject(t)||"function"==typeof t)return this._table.getFieldData(t,e,i);const n={},o=t;return mE.forEach((t=>{var r,s;if(void 0!==o[t]){const a=this._table.getFieldData(o[t],e,i);XC(a)?n[t]=a:(null===(s=(r=this._table)._hasField)||void 0===s?void 0:s.call(r,o[t],e,i))||(n[t]=o[t])}})),n}getHierarchyIcon(t,e){const i=this._table.getHierarchyState(t,e);return i===Kw.expand?this.expandIcon:i===Kw.collapse?this.collapseIcon:void 0}getHierarchyIconWidth(){var t,e;return this.expandIcon.width+(null!==(t=this.expandIcon.marginLeft)&&void 0!==t?t:0)+(null!==(e=this.expandIcon.marginRight)&&void 0!==e?e:0)}}function CE(t,e){const i=document.createElement(t);return e&&i.classList.add(...e),i}!function(){if("node"===kx.mode)return;const t=document.createElement("style");t.id="vtable-menu-styleSheet",t.textContent="\n@keyframes vtable__menu-element--shown-animation {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n.vtable__menu-element {\n\tposition: absolute;\n\tbox-sizing: border-box;\n\tborder-radius: 4px;\n\tbackground-color: #fff;\n\tpadding: 6px 0;\n\t/* pointer-events: none; */\n\tuser-select: none;\n\tcolor: #000;\n\tmax-width: 300px;\n\tz-index: 99999;\n\tborder: #CCC 0.5px solid;\n\tcursor: default;\n\twidth: max-content;\n\tbox-shadow: 0px 8px 16px rgba(27, 31, 35, 0.12);\n  max-height: 100%;\n  overflow-y: auto;\n}\n.vtable__menu-element--hidden {\n\topacity: 0;\n\t/* transform: translate(-50%, -50%); */\n\ttransition: opacity 75ms linear;\n\tz-index: -9999;\n}\n.vtable__menu-element--shown {\n\topacity: 1;\n\t/* transform: translate(-50%, -50%); */\n\tanimation: vtable__menu-element--shown-animation 150ms ease-out;\n}\n.vtable__menu-element__content {\n\tfont-family: Roboto;\n\tfont-size: 12px;\n\toverflow: hidden;\n\tdisplay: inline-block;\n\t/* height: 100%; */\n\tline-height: 30px;\n}\n.vtable__menu-element__item {\n\theight: 32px;\n\tpadding: 0px 12px;\n\tcursor: pointer;\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: flex-start;\n}\n.vtable__menu-element__item:hover {\n\tbackground-color: rgba(27, 31, 35, 0.06);\n}\n.vtable__menu-element__icon{\n\t/* vertical-align: top; */\n\tdisplay: flex;\n\t/* line-height: 30px; */\n\tmargin-right: 6px;\n}\n.vtable__menu-element__no-event {\n\tpointer-events: none;\n}\n.vtable__menu-element--select {\n\tcolor: #2E68CF;\n}\n.vtable__menu-element--normal {\n\tcolor: rgba(20, 20, 20, 0.9);;\n}\n.vtable__menu-element__item-disabled {\n    color: rgba(0, 0, 0, 0.25);\n    cursor: not-allowed;\n\t  background-color: #fff;\n}\n.vtable__menu-element__item-disabled:hover {\n\t  background-color: #fff;\n}\n.vtable__menu-element__split {\n\theight: 0px;\n\tborder: 1px solid rgb(209, 213, 218);\n\tmargin: 5px 0;\n}\n.vtable__menu-element__title {\n\tcolor: rgb(149, 149, 149);\n}\n.vtable__menu-element__arrow {\n\tposition: absolute;\n\tright: 3px;\n\tfont-weight: bold;\n\tmargin-top: 1px;\n}\n.vtable__menu-element__item-text {\n\tmargin-right: 15px;\n}\n",document.head.appendChild(t)}();const wE="vtable__menu-element",xE=`${wE}__item`,_E=`${wE}__content`,SE=`${wE}--hidden`,AE=`${wE}--shown`,BE=`${wE}--normal`,TE=`${wE}--select`,RE=`${wE}__icon`,kE=`${wE}__split`,ME=`${wE}__title`,LE=`${wE}__arrow`,PE=`${wE}__no-event`,EE=`${wE}__item-text`,HE=`${wE}__item-disabled`;function OE(){return CE("div",[wE,SE])}function IE(t,e,i,n,o,r){const s=t.getCellRange(n,o);for(let n=0;n<e.length;n++){const o=e[n];let{col:r,row:a}=o;const{field:l,menuKey:h}=o;if("number"!=typeof r||"number"!=typeof a)if(t.isPivotTable()){const e=t.internalProps.layoutMap.getPivotCellAdress(l);if(!e)continue;r=e.col,a=e.row}else{const e=t.internalProps.layoutMap.getHeaderCellAddressByField(l);if(!e)continue;r=e.col,a=e.row}if(XC(r)&&XC(a)&&a_(s,r,a)&&i===h)return!0}return!1}class FE{constructor(t){var e,i,n,o,r,s,a,l,h,d,c;this._handler=new C_,this._rootElement=OE(),this._secondElement=OE(),this._secondElement.sub=!0,this._showChildrenIndex=-1,this._rootElement.addEventListener("wheel",(t=>{t.stopPropagation()})),null===(e=this._rootElement)||void 0===e||e.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()})),null===(i=this._rootElement)||void 0===i||i.addEventListener("contextmenu",(t=>{t.stopPropagation(),t.preventDefault()})),null===(n=this._rootElement)||void 0===n||n.addEventListener("touchend",(e=>{if(e.stopPropagation(),e.preventDefault(),e.target.classList.contains(HE))return;if(this._rootElement.classList.contains(SE))return;const{col:i,row:n,dropDownIndex:o,menuKey:r,text:s,hasChildren:a}=e.target;if("number"!=typeof o||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,n):t.getHeaderField(i,n),h=t._dropDownMenuIsHighlight(i,n,o);t.fireListeners(v_.DROPDOWN_MENU_CLICK,{col:i,row:n,field:l,menuKey:r,text:s,highlight:h,cellLocation:t.getCellLocation(i,n),event:e}),t.fireListeners(v_.DROPDOWN_MENU_CLEAR,null),t.fireListeners(v_.HIDE_MENU,null),e.stopPropagation()})),null===(o=this._rootElement)||void 0===o||o.addEventListener("click",(e=>{if(e.stopPropagation(),e.preventDefault(),e.target.classList.contains(HE))return;if(this._rootElement.classList.contains(SE))return;const{col:i,row:n,dropDownIndex:o,menuKey:r,text:s,hasChildren:a}=e.target;if("number"!=typeof o||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,n):t.getHeaderField(i,n),h=t._dropDownMenuIsHighlight(i,n,o);t.fireListeners(v_.DROPDOWN_MENU_CLICK,{col:i,row:n,field:l,menuKey:r,text:s,highlight:h,cellLocation:t.getCellLocation(i,n),event:e}),t.fireListeners(v_.DROPDOWN_MENU_CLEAR,null),t.fireListeners(v_.HIDE_MENU,null),e.stopPropagation()})),null===(r=this._rootElement)||void 0===r||r.addEventListener("mousemove",(e=>{var i,n;if(this._rootElement.classList.contains(SE))return;e.stopPropagation();const{hasChildren:o,dropDownIndex:r,col:s,row:a,sub:l}=e.target;if(o){this._showChildrenIndex=r;const n=this._secondElement;null==n||n.classList.remove(SE),null==n||n.classList.add(AE),n.innerHTML="";const o=null===(i=this._menuInstanceInfo.content[r])||void 0===i?void 0:i.children;for(let e=0;e<o.length;e++){const i=o[e],r=zE(i,!!t.stateManager.menu.dropDownMenuHighlight&&IE(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof i?(null==i?void 0:i.menuKey)||(null==i?void 0:i.text):i,s,a));r.col=s,r.row=a,r.dropDownIndex=e,"string"==typeof i?(r.text=i,r.menuKey=i):"object"==typeof i&&(r.text=i.text,r.menuKey=i.menuKey||i.text),r.sub=!0,r.sub=!0,n.appendChild(r)}const l=e.target.getBoundingClientRect();this._bindSecondElement(t,s,a,l.right,l.top)}else if(o&&this._showChildrenIndex===r){const t=this._secondElement;null==t||t.classList.remove(SE),null==t||t.classList.add(AE)}else!l&&(null===(n=this._secondElement)||void 0===n?void 0:n.classList.contains(AE))&&setTimeout((()=>{if(!0!==this._mouseEnterSecondElement){this._showChildrenIndex=-1;const t=this._secondElement;null==t||t.classList.remove(AE),null==t||t.classList.add(SE)}}),300)})),null===(s=this._secondElement)||void 0===s||s.addEventListener("wheel",(t=>{t.stopPropagation()})),null===(a=this._secondElement)||void 0===a||a.addEventListener("mousemove",(t=>{this._rootElement.classList.contains(SE)||t.stopPropagation()})),null===(l=this._secondElement)||void 0===l||l.addEventListener("mouseenter",(t=>{this._mouseEnterSecondElement=!0})),null===(h=this._secondElement)||void 0===h||h.addEventListener("mouseleave",(t=>{this._mouseEnterSecondElement=!1})),null===(d=this._secondElement)||void 0===d||d.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()})),null===(c=this._secondElement)||void 0===c||c.addEventListener("click",(e=>{if(e.stopPropagation(),e.preventDefault(),e.target.classList.contains(HE))return;if(this._secondElement.classList.contains(SE))return;const{col:i,row:n,dropDownIndex:o,menuKey:r,text:s,hasChildren:a}=e.target;if("number"!=typeof o||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,n):t.getHeaderField(i,n);let h=!1;this._menuInstanceInfo.content.forEach(((e,o)=>{if("object"==typeof e&&e.children&&e.children.length)for(let o=0;o<e.children.length;o++){const s=e.children[o];if(IE(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof s?null==s?void 0:s.menuKey:s,i,n)&&r===("object"==typeof s?null==s?void 0:s.menuKey:s))return void(h=!0)}})),t.fireListeners(v_.DROPDOWN_MENU_CLICK,{col:i,row:n,field:l,cellHeaderPaths:t.isPivotTable()?t.getCellHeaderPaths(i,n):void 0,menuKey:r,text:s,highlight:h,cellLocation:t.getCellLocation(i,n),event:e}),t.fireListeners(v_.DROPDOWN_MENU_CLEAR,null),t.fireListeners(v_.HIDE_MENU,null),e.stopPropagation()}))}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;(null==t?void 0:t.parentElement)&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,n){var o,r;const s=this._rootElement,a=this._secondElement;if(this._menuInstanceInfo=n,null==s||s.classList.remove(AE),null==s||s.classList.add(SE),null==a||a.classList.remove(AE),null==a||a.classList.add(SE),this._canBindToCell(t,e,i)){if(s.innerHTML="",Array.isArray(n.content)){const a=n.content;for(let n=0;null!==(o=n<(null==a?void 0:a.length))&&void 0!==o&&o;n++){const o=a[n];let l=!!t.stateManager.menu.dropDownMenuHighlight&&IE(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof o?(null==o?void 0:o.menuKey)||(null==o?void 0:o.text):o,e,i);if(t.stateManager.menu.dropDownMenuHighlight&&"object"==typeof o&&Array.isArray(o.children)&&o.children.length)for(let n=0;n<o.children.length;n++){const r=o.children[n];if(IE(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof r?(null==r?void 0:r.menuKey)||(null==r?void 0:r.text):r,e,i)){l=!0;break}}const h=zE(o,l);h.col=e,h.row=i,h.dropDownIndex=n,"string"==typeof o?(h.text=o,h.menuKey=o):"object"==typeof o&&(h.text=o.text,h.menuKey=o.menuKey||o.text,(null===(r=o.children)||void 0===r?void 0:r.length)&&(h.hasChildren=!0)),s.appendChild(h)}}if(this._bindToCell(t,e,i,n.position,n.referencePosition))return null==s||s.classList.add(AE),null==s||s.classList.remove(SE),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement,e=this._secondElement;this._menuInstanceInfo=void 0,(null==t?void 0:t.parentElement)&&(t.classList.remove(AE),t.classList.add(SE)),(null==e?void 0:e.parentElement)&&(e.classList.remove(AE),e.classList.add(SE))}_canBindToCell(t,e,i){var n;const o=t.getCellRangeRelativeRect({col:e,row:i}),r=null!==(n=t.internalProps.menu.parentElement)&&void 0!==n?n:t.getElement(),{top:s,bottom:a,left:l,right:h}=o;if(t.isFrozenCell(e,i))return!0;if(a<t.getFrozenRowsHeight()||h<t.getFrozenColsWidth()||l>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||s>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:d,offsetWidth:c}=r;return!(d<s||c<l)}_bindToCell(t,e,i,n,o){var r;const s=this._rootElement,a=null!==(r=t.internalProps.menu.parentElement)&&void 0!==r?r:t.getElement(),{width:l,height:h,left:d,top:c}=a.getBoundingClientRect();if(s){s.parentElement!==a&&a.appendChild(s),s.style.left="0px";const e=.8*l;s.style.maxWidth=`${e}px`;const i=s.offsetWidth,r=s.offsetHeight;let u,g;n?(u=n.x,g=n.y):o&&(u=o.rect.right-i,g=o.rect.bottom);const p=a.getBoundingClientRect(),f=p.width/a.offsetWidth,v=p.height/a.offsetHeight;g*v+r>h&&(g=(h-r)/v),g<0&&(g/=2);let b=0,m=0;if(t.getElement()!==a){const{left:e,top:i}=t.getElement().getBoundingClientRect();b=i-c,m=e-d}return s.style.top=`${g+b}px`,u<0?u=0:u*f+i>l&&(u=(l-i)/f),s.style.left=`${u+m}px`,!0}return!1}_bindSecondElement(t,e,i,n,o){var r;const s=this._secondElement,a=this._rootElement,l=null!==(r=t.internalProps.menu.parentElement)&&void 0!==r?r:t.getElement(),{width:h,height:d,left:c,top:u}=l.getBoundingClientRect(),{x:g,y:p,width:f,height:v}=a.getBoundingClientRect();if(s){s.parentElement!==l&&l.appendChild(s),s.style.left="0px";const t=.8*h;s.style.maxWidth=`${t}px`;const e=s.clientWidth,i=s.clientHeight,r=n-c;let a=o-4-u;a+i>d&&(a=a-i+s.firstElementChild.clientHeight+4),s.style.top=`${a}px`;let g=r;return g+e>h?g=g-e-f:g+=4,s.style.left=`${g}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:n,y:o,width:r,height:s}=i.getBoundingClientRect();if(t>n-5&&t<n+r+5&&e>o-5&&e<o+s+5)return!0;const a=this._secondElement;if(a){const{x:i,y:n,width:o,height:r}=a.getBoundingClientRect();if(t>i-5&&t<i+o+5&&e>n-5&&e<n+r+5)return!0}return!1}}function zE(t,e){var i,n,o;const r=CE("div",[xE,e?TE:BE]);if("object"==typeof t&&t.disabled&&r.classList.add(HE),"string"==typeof t){const e=CE("span",[_E,PE,EE]);e.innerHTML=t,r.appendChild(e)}else if("object"==typeof t){const s=null!==(i=t.type)&&void 0!==i?i:"item";if("split"===s)return null==r||r.classList.add(kE),r;if(null===(n=null==t?void 0:t.icon)||void 0===n?void 0:n.svg)if(P_.test(t.icon.svg)){const e=new Image;t.icon.width?e.style.width=t.icon.width.toString()+"px":e.style.width="16px",t.icon.height?e.style.height=t.icon.height.toString()+"px":e.style.height="16px",e.src=t.icon.svg,r.appendChild(e)}else{const i=CE("span",[RE,PE]);i.innerHTML=e&&t.selectedIcon&&t.selectedIcon.svg?t.selectedIcon.svg:t.icon.svg,t.icon.width&&i.children[0].setAttribute("width",t.icon.width.toString()),t.icon.height&&i.children[0].setAttribute("height",t.icon.height.toString()),r.appendChild(i)}const a=CE("span",[_E,PE,EE]);if(a.innerHTML=t.text,r.appendChild(a),"title"===s)null==r||r.classList.add(PE,ME);else if(null===(o=null==t?void 0:t.children)||void 0===o?void 0:o.length){const t=CE("span",[_E,PE,LE]);t.innerHTML=e?'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#2E68CF" fill-opacity="0.65"></path></svg>':'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#141414" fill-opacity="0.65"></path></svg>',r.appendChild(t)}}return r}let DE;const WE={CHANGE_STYLE:"change_style"};class NE extends gx{static get EVENT_TYPE(){return WE}static get DEFAULT(){return DE||(DE=new NE)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B,T,R,k,M,L,P,E;super(),this._defaultPadding=[10,16,10,16],this._color=null!==(i=t.color)&&void 0!==i?i:null==e?void 0:e.color,this._strokeColor=null!==(n=null==t?void 0:t.strokeColor)&&void 0!==n?n:null==e?void 0:e.strokeColor,this._fontSize=null!==(o=t.fontSize)&&void 0!==o?o:null==e?void 0:e.fontSize,this._fontFamily=null!==(r=t.fontFamily)&&void 0!==r?r:null==e?void 0:e.fontFamily,this._fontWeight=null!==(s=t.fontWeight)&&void 0!==s?s:null==e?void 0:e.fontWeight,this._fontVariant=null!==(a=t.fontVariant)&&void 0!==a?a:null==e?void 0:e.fontVariant,this._fontStyle=null!==(l=t.fontStyle)&&void 0!==l?l:null==e?void 0:e.fontStyle,this._textOverflow=(null!==(h=t.textOverflow)&&void 0!==h?h:null==e?void 0:e.textOverflow)||"ellipsis",this._textStick=null!==(c=null!==(d=t.textStick)&&void 0!==d?d:null==e?void 0:e.textStick)&&void 0!==c&&c,this._textStickBaseOnAlign=null!==(g=null!==(u=t.textStickBaseOnAlign)&&void 0!==u?u:null==e?void 0:e.textStickBaseOnAlign)&&void 0!==g&&g,this._marked=null!==(f=null!==(p=t.marked)&&void 0!==p?p:null==e?void 0:e.marked)&&void 0!==f&&f,this._textAlign=(null!==(v=t.textAlign)&&void 0!==v?v:null==e?void 0:e.textAlign)||"left",this._textBaseline=(null!==(b=t.textBaseline)&&void 0!==b?b:null==e?void 0:e.textBaseline)||"middle",this._bgColor=null!==(m=t.bgColor)&&void 0!==m?m:null==e?void 0:e.bgColor,this._padding=null!==(C=null!==(y=t.padding)&&void 0!==y?y:null==e?void 0:e.padding)&&void 0!==C?C:this._defaultPadding,this._borderColor=null!==(w=t.borderColor)&&void 0!==w?w:null==e?void 0:e.borderColor,this._lineHeight=null!==(x=t.lineHeight)&&void 0!==x?x:null==e?void 0:e.lineHeight,this._underline=null!==(_=t.underline)&&void 0!==_?_:null==e?void 0:e.underline,this._underlineColor=null!==(S=t.underlineColor)&&void 0!==S?S:null==e?void 0:e.underlineColor,this._underlineDash=null!==(A=t.underlineDash)&&void 0!==A?A:null==e?void 0:e.underlineDash,this._underlineOffset=null!==(B=t.underlineOffset)&&void 0!==B?B:null==e?void 0:e.underlineOffset,this._lineThrough=null!==(T=t.lineThrough)&&void 0!==T?T:null==e?void 0:e.lineThrough,this._lineThroughColor=null!==(R=t.lineThroughColor)&&void 0!==R?R:null==e?void 0:e.lineThroughColor,this._lineThroughDash=null!==(k=t.lineThroughDash)&&void 0!==k?k:null==e?void 0:e.lineThroughDash,this._linkColor=null!==(M=t.linkColor)&&void 0!==M?M:null==e?void 0:e.linkColor,this._cursor=null!==(L=t.cursor)&&void 0!==L?L:null==e?void 0:e.cursor,this._borderLineWidth=null!==(P=t.borderLineWidth)&&void 0!==P?P:null==e?void 0:e.borderLineWidth,this._borderLineDash=null!==(E=t.borderLineDash)&&void 0!==E?E:null==e?void 0:e.borderLineDash}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get color(){return this._color}set color(t){this._color=t}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get padding(){var t;return null!==(t=this._padding)&&void 0!==t?t:this._defaultPadding}set padding(t){this._padding=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(t){this._textStickBaseOnAlign=t}get marked(){return this._marked}set marked(t){this._marked=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}clone(){return new NE(this)}}let GE,jE,VE;class UE extends NE{static get DEFAULT(){return GE||(GE=new UE)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;super(t,e),this.textAlign=(null!==(i=t.textAlign)&&void 0!==i?i:null==e?void 0:e.textAlign)||"center"}clone(){return new UE(this)}}class XE extends NE{static get DEFAULT(){return jE||(jE=new XE)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var i,n;super(t,e),this._autoWrapText=null!==(i=null==t?void 0:t.autoWrapText)&&void 0!==i?i:null==e?void 0:e.autoWrapText,this._lineClamp=null!==(n=null==t?void 0:t.lineClamp)&&void 0!==n?n:null==e?void 0:e.lineClamp}clone(){return new XE(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}class $E extends NE{static get DEFAULT(){return VE||(VE=new $E)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S;super(t,e),this._size=(null!==(o=null!==(n=null==t?void 0:t.size)&&void 0!==n?n:null==e?void 0:e.size)&&void 0!==o?o:null==i?void 0:i.size)||14,this._spaceBetweenTextAndIcon=(null!==(s=null!==(r=null==t?void 0:t.spaceBetweenTextAndIcon)&&void 0!==r?r:null==e?void 0:e.spaceBetweenTextAndIcon)&&void 0!==s?s:null==i?void 0:i.spaceBetweenTextAndIcon)||8,this._defaultFill=null!==(l=null===(a=null==t?void 0:t.checkboxStyle)||void 0===a?void 0:a.defaultFill)&&void 0!==l?l:null==i?void 0:i.defaultFill,this._defaultStroke=null!==(d=null===(h=null==t?void 0:t.checkboxStyle)||void 0===h?void 0:h.defaultStroke)&&void 0!==d?d:null==i?void 0:i.defaultStroke,this._disableFill=null!==(u=null===(c=null==t?void 0:t.checkboxStyle)||void 0===c?void 0:c.disableFill)&&void 0!==u?u:null==i?void 0:i.disableFill,this._checkedFill=null!==(p=null===(g=null==t?void 0:t.checkboxStyle)||void 0===g?void 0:g.checkedFill)&&void 0!==p?p:null==i?void 0:i.checkedFill,this._checkedStroke=null!==(v=null===(f=null==t?void 0:t.checkboxStyle)||void 0===f?void 0:f.checkedStroke)&&void 0!==v?v:null==i?void 0:i.checkedStroke,this._disableCheckedFill=null!==(m=null===(b=null==t?void 0:t.checkboxStyle)||void 0===b?void 0:b.disableCheckedFill)&&void 0!==m?m:null==i?void 0:i.disableCheckedFill,this._disableCheckedStroke=null!==(C=null===(y=null==t?void 0:t.checkboxStyle)||void 0===y?void 0:y.disableCheckedStroke)&&void 0!==C?C:null==i?void 0:i.disableCheckedStroke,this._checkIconImage=null!==(x=null===(w=null==t?void 0:t.checkboxStyle)||void 0===w?void 0:w.checkIconImage)&&void 0!==x?x:null==i?void 0:i.checkIconImage,this._indeterminateIconImage=null!==(S=null===(_=null==t?void 0:t.checkboxStyle)||void 0===_?void 0:_.indeterminateIconImage)&&void 0!==S?S:null==i?void 0:i.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(t){return new $E(t,this)}clone(){return new $E(this)}}function YE(t,e,i,n,o,r){var s;return t||e?t instanceof NE?t:"function"==typeof t?YE(t(i),e,i,n,o,r):(t||(t={}),o&&!XC(t.autoWrapText)&&(t.autoWrapText=!0),n===$E?new $E(null!=t?t:{},null!=e?e:{},null!==(s=r.checkboxStyle)&&void 0!==s?s:{}):new n(null!=t?t:{},null!=e?e:{})):n.DEFAULT}class KE{constructor(t){this._table=t;const e=wR();this.freezeIcon=e[Jw.freezeIconName],this.frozenIcon=e[Jw.frozenIconName],this.frozenCurrentIcon=e[Jw.frozenCurrentIconName],this.normalIcon=e[Jw.normalIconName],this.upIcon=e[Jw.upwardIconName],this.downIcon=e[Jw.downwardIconName],this.dropDownAbsoluteIcon=e[Jw.dropdownIconName],this.expandIcon=e[Jw.expandIconName],this.collapseIcon=e[Jw.collapseIconName]}getIcons(t,e){const i=[];if(this._table.isPivotTable()){const{showSort:n,sort:o}=this._table.internalProps.layoutMap.getHeader(t,e);let r;if(r="function"==typeof n?n({col:t,row:e,table:this._table}):n,r){let n=this._table.getPivotSortState(t,e);n&&(n=n.toUpperCase());const o="ASC"===n?this.upIcon:"DESC"===n?this.downIcon:this.normalIcon;o&&i.push(o)}else if(o){const n=this.getSortIconForPivotTable(this._table.getPivotSortState(t,e),this._table,t,e);n&&i.push(n)}}else{const n=this._table.sortState;let o;o=void 0;const r=this._table.getCellRange(t,e);if(n)if(Array.isArray(n))for(let t=0;t<n.length;t++){const e=n[t],i=this._table._getHeaderCellBySortState(e);if(i&&a_(r,i.col,i.row)){({order:o}=e);break}}else{const t=this._table._getHeaderCellBySortState(n);t&&a_(r,t.col,t.row)&&({order:o}=n)}const s=this.getSortIcon(o,this._table,t,e);s&&i.push(s)}if(this._table.showFrozenIcon&&t<this._table.allowFrozenColCount){const n=this.getFrozenIcon(t,e);n&&i.push(n)}if(this.checkDropDownIcon(this._table,t,e)){const t=this.dropDownAbsoluteIcon;i.push(t)}const n=this.getDropDownStateIcons(this._table,t,e);n.length&&i.push(...n);const{headerIcon:o}=this._table._getHeaderLayoutMap(t,e),r=this.getHierarchyIcon(t,e);if(r&&i.push(r),o){let n;n="function"==typeof o?o({col:t,row:e,value:this._table.getCellValue(t,e),dataValue:this._table.getCellOriginValue(t,e),table:this._table}):o;const r=wR(),s=t=>{let e;e="string"==typeof t?r[t]:t,e&&i.push(e)};Array.isArray(n)?n.forEach(((t,e)=>{s(t)})):s(n)}return i}getFrozenIcon(t,e){if(this._table.isPivotTable()||this._table.transpose)return null;if(this._table.rightFrozenColCount&&t>=this._table.colCount-this._table.rightFrozenColCount)return null;const i=this._table.getHeaderDefine(t,e);if(i.columns&&i.columns.length>0)return null;let n=this.freezeIcon;return this._table.options.frozenColCount-1>t?n=this.frozenIcon:this._table.options.frozenColCount-1===t&&(n=this.frozenCurrentIcon),n}getSortIcon(t,e,i,n){const o="asc"===t?this.upIcon:"desc"===t?this.downIcon:this.normalIcon,r=e.getHeaderDefine(i,n);let s;return r&&(s="function"==typeof r.showSort?r.showSort({col:i,row:n,table:this._table}):r.showSort),!r||!1===s||!XC(s)&&!r.sort||r.columns&&r.columns.length>0?null:o}getSortIconForPivotTable(t,e,i,n){const o=e.getHeaderDefine(i,n);let r;return o&&(r="function"==typeof o.showSort?o.showSort({col:i,row:n,table:this._table}):o.showSort),!o||!1===r||!XC(r)&&!o.sort||o.columns&&o.columns.length>0?null:"ASC"===(null==t?void 0:t.toUpperCase())?this.upIcon:"DESC"===(null==t?void 0:t.toUpperCase())?this.downIcon:this.normalIcon}getDropDownStateIcons(t,e,i){var n,o,r;const s=t.getHeaderDefine(e,i),a=t._getHeaderLayoutMap(e,i);let{dropDownMenu:l}=a;"function"==typeof l&&(l=l({row:i,col:e,table:t}));let h=t.globalDropDownMenu;"function"==typeof h&&(h=h({row:i,col:e,table:t}));const d=[];if(Array.isArray(l)&&l.length||Array.isArray(h)&&h.length&&!(null===(n=null==s?void 0:s.columns)||void 0===n?void 0:n.length)){const n=l||h;let s=-1,a=-1;for(let l=0;l<n.length;l++){const h=n[l];if("object"==typeof h&&h.children&&h.children.length)for(let n=0;n<h.children.length;n++){const d=h.children[n];if((null===(o=t.stateManager.menu)||void 0===o?void 0:o.dropDownMenuHighlight)&&IE(t,null===(r=t.stateManager.menu)||void 0===r?void 0:r.dropDownMenuHighlight,"object"==typeof d?null==d?void 0:d.menuKey:d,e,i)){s=l,a=n;break}}if(t._dropDownMenuIsHighlight(e,i,l)){s=l;break}}if(-1!==s){let t;t=-1!==a?n[s].children[a]:n[s],t.stateIcon&&(t.stateIcon.svg?d.push({type:"svg",name:t.stateIcon.src||t.stateIcon.svg,width:t.stateIcon.width||22,height:t.stateIcon.height||22,svg:t.stateIcon.svg,positionType:qw.right,marginRight:0,funcType:Zw.dropDownState,interactive:!1}):t.stateIcon.src&&d.push({type:"image",name:t.stateIcon.src||t.stateIcon.svg,width:t.stateIcon.width||22,height:t.stateIcon.height||22,src:t.stateIcon.src,positionType:qw.right,marginRight:0,funcType:Zw.dropDownState,interactive:!1}))}}return d}getDropDownIconRect(t,e,i){var n,o,r,s,a,l,h,d;const c=null!==(s=null!==(o=null===(n=this.downIcon.hover)||void 0===n?void 0:n.width)&&void 0!==o?o:null===(r=this.downIcon)||void 0===r?void 0:r.width)&&void 0!==s?s:0,u=null!==(d=null!==(l=null===(a=this.downIcon.hover)||void 0===a?void 0:a.height)&&void 0!==l?l:null===(h=this.downIcon)||void 0===h?void 0:h.height)&&void 0!==d?d:0,g=t.right-2-c,p=t.right-2;let f;return f="middle"===i?t.top+t.height/2-c/2:"top"===i?t.top+e/2:"bottom"===i?t.bottom-2*e:t.top,{left:g,right:p,top:f,bottom:u+f,width:c,height:u}}getHierarchyIcon(t,e){const{hierarchyState:i}=this._table._getHeaderLayoutMap(t,e);if(i){if(i===Kw.expand)return this.expandIcon;if(i===Kw.collapse)return this.collapseIcon}}getHierarchyIconWidth(){var t,e;return this.expandIcon.width+(null!==(t=this.expandIcon.marginLeft)&&void 0!==t?t:0)+(null!==(e=this.expandIcon.marginRight)&&void 0!==e?e:0)}checkDropDownIcon(t,e,i){var n;if(t.isPivotTable()){let n=t._getHeaderLayoutMap(e,i).dropDownMenu;if("function"==typeof n&&(n=n({row:i,col:e,table:t})),Array.isArray(n)&&n.length)return!0}else{const o=t.getHeaderDefine(e,i),r=o.dropDownMenu;let s=t.globalDropDownMenu;if("function"==typeof s&&(s=s({row:i,col:e,table:t})),Array.isArray(r)&&r.length||(!Array.isArray(o.dropDownMenu)||0!==o.dropDownMenu.length)&&Array.isArray(s)&&s.length&&!(null===(n=null==o?void 0:o.columns)||void 0===n?void 0:n.length))return!0}return!1}getStyleClass(t){switch(t){case"text":case"link":return XE;case"image":case"video":return UE;case"checkbox":return $E}}setTableColumnsEditor(){const t=(e,i)=>{null==e||e.forEach(((e,n)=>{e.editor&&(i[n].editor=e.editor),e.columns&&t(e.columns,i[n].columns)}))};t(this._table.options.columns,this._table.internalProps.columns)}}class qE extends EventTarget{constructor(t,e){if(super(),this._table=t,"node"===kx.mode)return;const i=document.createElement("div");i.style.opacity="0",i.dataset.vtable="vtable",i.style.pointerEvents="none",i.classList.add("input-container");const n=this._input=document.createElement("input");i.appendChild(n),n.classList.add("table-focus-control"),n.dataset.vtable="vtable",n.readOnly=!0,e.appendChild(i),this._container=i}focus(){this._input.focus({preventScroll:!0})}setFocusRect(t,e){const i=this._input;i.value=e,i.select();const n=t.top-this._table.scrollTop,o=t.left-this._table.scrollLeft;i.style.top=`${n.toFixed()}px`,i.style.left=`${o.toFixed()}px`,i.style.width=`${t.width.toFixed()}px`,i.style.height=`${t.height.toFixed()}px`}get input(){return this._input}release(){var t;null===(t=this._container.parentElement)||void 0===t||t.removeChild(this._container)}}class ZE{constructor(t){this.isUpdate=!1,this._keys=[],this._sorted=!1,this.data=new Map,this._keys.length=0,this.cumulativeSum=new Map,this.difference=new Map,this.totalSum=0,this.table=t}get length(){return this.data.size}clear(){this._keys=[],this.data.clear(),this.cumulativeSum.clear(),this.difference.clear(),this.totalSum=0}clearRange(){this.cumulativeSum.clear(),this.difference.clear()}add(t,e){if(!XC(e))return;const i=this.table.getRowHeight(t);this.data.has(t)||(this._keys.push(t),this._sorted=!1),this.data.set(t,e),this.totalSum+=e,this.updateDifference(t,e-i)}remove(t){if(this.data.has(t)){const e=this.data.get(t);this.data.delete(t);const i=this._keys.indexOf(t);-1!==i&&this._keys.splice(i,1),this.totalSum-=e;const n=this.table.getRowHeight(t);this.updateDifference(t,n-e)}}put(t,e){if(XC(e))if(this.data.has(t)){const i=this.data.get(t);if(i===e)return;this.data.set(t,e);const n=e-i;this.totalSum+=n,this.updateDifference(t,n)}else this.add(t,e)}get(t){return this.data.get(t)}has(t){return this.data.has(t)}_sort(){const{_keys:t}=this;this._sorted||(t.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0)}updateDifference(t,e){var i;const n=null!==(i=this.difference.get(t))&&void 0!==i?i:0;this.difference.set(t,n+e),this.update()}getSumInRange(t,e){return this.calculatePrefixSum(e)-this.calculatePrefixSum(t-1)}updateCumulativeSum(t,e){for(const[i,n]of this.cumulativeSum)i>=t&&this.cumulativeSum.set(i,n+e)}calculatePrefixSum(t){if(t<0)return 0;if(this.cumulativeSum.has(t)){let e=this.cumulativeSum.get(t);for(const[i,n]of this.difference)i<=t&&(e+=n);return e}return this.dealDiffenence(),this.getCumulativeSum(t)}getCumulativeSum(t){var e;let i=0;for(let n=t;n>=0;n--){if(this.cumulativeSum.has(n)){i+=this.cumulativeSum.get(n);break}i+=null!==(e=this.data.get(n))&&void 0!==e?e:this.table.getRowHeight(n)}return this.cumulativeSum.set(t,i),i}update(){this.isUpdate||(this.isUpdate=!0,setTimeout((()=>{this.dealDiffenence(),this.isUpdate=!1}),0))}dealDiffenence(){for(const[t]of this.cumulativeSum)for(const[e,i]of this.difference)if(t>=e){const e=this.cumulativeSum.get(t);this.cumulativeSum.set(t,e+i)}this.difference.clear()}insert(t,e){for(let e=t;e<=this.getLastIndex();e++)this.cumulativeSum.delete(e);const i=this.getLastIndex()+1;this.adjustOrder(t,t+1,i-t),XC(e)&&this.put(t,e)}getLastIndex(){return this._sort(),this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.remove(t)}delete(t){if(!this.has(t))return;for(let e=t;e<=this.getLastIndex();e++)this.cumulativeSum.delete(e);const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}adjustOrder(t,e,i){this.clearRange(),this._sort();const{_keys:n}=this;if(t>e){const o=[];for(let r=JE(n,t+i-1);r>=0;r--){const s=n[r];if(s>=t)o.push(this.get(s));else if(e<=s&&s<t)this.put(s+i,this.get(s));else if(s<e)break}for(let t=0;t<i;t++)this.put(e+t,o[i-1-t])}const{length:o}=n;if(t<e){const r=[];for(let s=JE(n,t);s<o;s++){const o=n[s];if(o>=t&&o<t+i)r.push(this.get(o));else if(t+i<=o&&o<=e)this.put(o-i,this.get(o));else if(o>e)break}for(let t=0;t<i;t++)this.put(e+t,r[t])}}exchangeOrder(t,e,i,n,o){const{_keys:r}=this;if(this._sorted||(r.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0),t>i){const n=[],s=[];for(let o=JE(r,i);o<JE(r,t)+e;o++){const i=r[o];i>=t&&i<t+e?s.push(this.get(i)):n.push(this.get(i))}for(let t=0;t<e;t++)this.put(o+t,s[t]);for(let t=0;t<n.length;t++)this.put(o+e+t,n[t])}else{const s=[],a=[];for(let o=JE(r,t);o<JE(r,i)+n;o++){const i=r[o];i>=t&&i<t+e?a.push(this.get(i)):s.push(this.get(i))}for(let t=0;t<e;t++)this.put(o+t,a[t]);for(let e=0;e<s.length;e++)this.put(t+e,s[e])}}}function JE(t,e){let i=0,n=t.length-1;for(;i<=n;){const o=Math.floor((i+n)/2);if(t[o]===e)return o;t[o]>e?n=o-1:i=o+1}return n<0?0:n}class QE{constructor(t){this._table=t;const e=wR();this.dragReorderIconName=e[Jw.dragReorderIconName]}getIcons(t,e){return[this.dragReorderIconName]}}class tH{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"grid",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;this.hasHideNode=!1,this.sizeIncludeParent=!1,this.tree={id:0,dimensionKey:"",value:"",children:[],level:-1,afterSpanLevel:-1,levelSpan:1,startIndex:0,size:0,startInTotal:0,hierarchyState:void 0},this.totalLevel=0,this.expandedMaxLevel=0,this.dimensionKeys=new x_,this.dimensionKeysIncludeVirtual=new x_,this.cache=new Map,this.sizeIncludeParent=null!=n,this.setExpandLevel=n,this.hierarchyType=i,this.sharedVar=e,this.reset(t)}reset(t){this.totalLevel=0,this.expandedMaxLevel=0,this.hasHideNode=!1,this.cache.clear(),this.dimensionKeys=new x_,this.dimensionKeysIncludeVirtual=new x_,this.tree.children=t,this.setTreeNode(this.tree,0,this.tree)}setTreeNode(t,e,i){var n,o,r,s;t.startIndex=e,t.startInTotal=(null!==(n=i.startInTotal)&&void 0!==n?n:0)+t.startIndex,t.hide&&(this.hasHideNode=!0),(null!==(o=t.dimensionKey)&&void 0!==o?o:t.indicatorKey)&&(t.virtual||this.dimensionKeys.contain(t.indicatorKey?E_:t.dimensionKey)||this.dimensionKeys.put(t.level,t.indicatorKey?E_:t.dimensionKey),this.dimensionKeysIncludeVirtual.contain(t.indicatorKey?E_:t.dimensionKey)||this.dimensionKeysIncludeVirtual.put(t.level,t.indicatorKey?E_:t.dimensionKey),t.id||(t.id=++this.sharedVar.seqId));let a=t.dimensionKey&&this.sizeIncludeParent?1:0;const l=t.children||t.columns;return"grid"===this.hierarchyType||null===this.hierarchyType?(null==l?void 0:l.length)>=1?l.forEach((e=>{var i,n,o;e.level=(null!==(i=t.level)&&void 0!==i?i:0)+1,"grid"===this.hierarchyType&&(e.afterSpanLevel=(null!==(n=t.afterSpanLevel)&&void 0!==n?n:0)+(null!==(o=t.levelSpan)&&void 0!==o?o:1)),this.totalLevel=Math.max(this.totalLevel,e.level+1),a+=this.setTreeNode(e,a,t)})):a=-1===t.level?0:1:t.hierarchyState===Kw.expand&&(null==l?void 0:l.length)>=1?l.forEach((e=>{var i;e.level=(null!==(i=t.level)&&void 0!==i?i:0)+1,this.totalLevel=Math.max(this.totalLevel,e.level+1),this.expandedMaxLevel=Math.max(this.expandedMaxLevel,e.level+1),a+=this.setTreeNode(e,a,t)})):t.hierarchyState===Kw.collapse&&(null==l?void 0:l.length)>=1?l.forEach((e=>{var i;e.level=(null!==(i=t.level)&&void 0!==i?i:0)+1,this.totalLevel=Math.max(this.totalLevel,e.level+1),this.setTreeNode(e,a,t)})):!t.hierarchyState&&t.level+1<this.setExpandLevel&&((null==l?void 0:l.length)>=1||!0===l)?((null===(r=l[0])||void 0===r?void 0:r.indicatorKey)&&"grid-tree"===this.hierarchyType||(t.hierarchyState=Kw.expand),(null==l?void 0:l.length)>=1&&l.forEach((e=>{var i;e.level=(null!==(i=t.level)&&void 0!==i?i:0)+1,this.totalLevel=Math.max(this.totalLevel,e.level+1),this.expandedMaxLevel=Math.max(this.expandedMaxLevel,e.level+1),a+=this.setTreeNode(e,a,t)}))):(null==l?void 0:l.length)>=1||!0===l?((null===(s=l[0])||void 0===s?void 0:s.indicatorKey)&&"grid-tree"===this.hierarchyType||(t.hierarchyState=Kw.collapse),(null==l?void 0:l.length)>=1&&l.forEach((e=>{var i;e.level=(null!==(i=t.level)&&void 0!==i?i:0)+1,this.totalLevel=Math.max(this.totalLevel,e.level+1),this.setTreeNode(e,a,t)}))):(t.hierarchyState=Kw.none,a=-1===t.level?0:1),t.size=a,a}getTreePath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;const i=[];return this.searchPath(t,this.tree,i,e),i.shift(),i}findNodeById(t,e){return t.find((t=>t.id===e))}searchPath(t,e,i,n){if(!e)return;if(t<e.startIndex||t>=e.startIndex+e.size)return;if(i.push(e),!e.children||0===e.children.length||e.level>=n)return;const o=t-e.startIndex;if(this.cache.has(e.level+1)){const t=this.cache.get(e.level+1);if(o>=t.startIndex&&o<t.startIndex+t.size)return void this.searchPath(o,t,i,n)}let r=0,s=e.children.length-1;for(;r<=s;){const t=Math.floor((r+s)/2),a=e.children[t];if(o>=a.startIndex&&o<a.startIndex+a.size){this.cache.set(a.level,a);const t=[];this.cache.forEach(((e,i)=>{i>a.level&&t.push(i)})),t.forEach((t=>{this.cache.delete(t)})),this.searchPath(o,a,i,n);break}o<a.startIndex?s=t-1:r=t+1}}movePosition(t,e,i){let n,o,r;const s=(a,l)=>{if(void 0!==o&&void 0!==r)return;a.level===t&&(a.startInTotal===e&&(o=l),a.startInTotal<=i&&i<=a.startInTotal+a.size-1&&(r=l));const h=a.children||a.columns;if(h&&a.level<t){n=a;for(let t=0;t<h.length;t++)(e>=h[t].startInTotal&&e<=h[t].startInTotal+h[t].size||i>=h[t].startInTotal&&i<=h[t].startInTotal+h[t].size)&&s(h[t],t)}};s(this.tree,0);const a=n.children||n.columns,l=a.splice(o,1);l.unshift(r,0),Array.prototype.splice.apply(a,l)}getCopiedTree(){const t=lw(this.tree.children);return eH(t),t}}function eH(t){for(let e=0;e<t.length;e++){const i=t[e];delete i.level,delete i.startIndex,delete i.id,delete i.levelSpan,delete i.size,delete i.startInTotal;const n=i.children||i.columns;n&&eH(n)}}function iH(t,e){var i;const n=function(t,e){if(!t.internalProps.frozenRowCount)return null;let{scrollTop:i}=t;const n=t.internalProps.frozenRowCount;for(let o=0;o<n;o++){const n=t.getRowHeight(o),r=i+n;if(r>e)return{top:i,row:o,bottom:r,height:n};i=r}return null}(e,t);return n||(null!==(i=rH(t,e))&&void 0!==i?i:{top:-1,row:-1,bottom:-1,height:-1})}function nH(t,e){var i;const n=function(t,e){if(!t.internalProps.frozenColCount)return null;let{scrollLeft:i}=t;const n=t.internalProps.frozenColCount;for(let o=0;o<n;o++){const n=t.getColWidth(o),r=i+n;if(r>e)return{left:i,col:o,right:r,width:n};i=r}return null}(e,t);return n||(null!==(i=oH(t,e))&&void 0!==i?i:{left:-1,col:-1,right:-1,width:1})}function oH(t,e){if(0===t)return{left:0,col:0,right:0,width:0};const i=function(t,e){if(e._colRangeWidthsMap.get("$0$"+(e.colCount-1))){let i=0,n=e.colCount-1;for(;n-i>1;){const o=Math.floor((i+n)/2);if(t<e._colRangeWidthsMap.get(`$0$${o}`))n=o;else{if(!(t>e._colRangeWidthsMap.get(`$0$${o}`)))return o;i=o}}return n}return Math.min(Math.ceil(t/e.internalProps.defaultColWidth),e.colCount-1)}(t,e),n=e.getColsWidth(0,i);return t>=n?((i,n)=>{let o=n-e.getColWidth(i);const{colCount:r}=e.internalProps;for(let n=i;n<r;n++){const i=e.getColWidth(n),r=o+i;if(Math.round(o)<=Math.round(t)&&Math.round(t)<Math.round(r))return{left:o,col:n,right:r,width:i};o=r}return null})(i,n):((i,n)=>{let o=n;for(let n=i;n>=0;n--){const i=e.getColWidth(n),r=o-i;if(Math.round(r)<=Math.round(t)&&Math.round(t)<Math.round(o))return{left:r,col:n,right:o,width:i};o=r}return null})(i,n)}function rH(t,e){var i;if(0===t)return{top:0,row:0,bottom:0,height:0};const n=!0===(null===(i=e.options.customConfig)||void 0===i?void 0:i._disableColumnAndRowSizeRound)?Math.floor:Math.round,o=function(t,e){let i=e.defaultRowHeight;return e._rowRangeHeightsMap.get("$0$"+(e.rowCount-1))&&(i=e._rowRangeHeightsMap.get("$0$"+(e.rowCount-1))/e.rowCount),Math.min(Math.ceil(t/i),e.rowCount-1)}(t,e),r=e.getRowsHeight(0,o);return t>=r?((i,o)=>{let r=o-e.getRowHeight(i);const{rowCount:s}=e.internalProps;for(let o=i;o<s;o++){const i=e.getRowHeight(o),s=r+i;if(n(r)<=n(t)&&n(t)<n(s))return{top:r,row:o,bottom:s,height:i};r=s}return null})(o,r):((i,o)=>{let r=o;for(let o=i;o>=0;o--){const i=e.getRowHeight(o),s=r-i;if(n(s)<=n(t)&&n(t)<n(r))return{top:s,row:o,bottom:r,height:i};r=s}return null})(o,r)}function sH(t,e,i){if(0===t)return{left:0,col:0,right:0,width:0};if(t-=i.tableX,e&&t>i.tableNoFrameWidth-i.getRightFrozenColsWidth()&&t<i.tableNoFrameWidth&&t<=i.getAllColsWidth())for(let e=0;e<i.rightFrozenColCount;e++)if(t>i.tableNoFrameWidth-i.getColsWidth(i.colCount-e-1,i.colCount-1))return{col:i.colCount-e-1,left:void 0,right:void 0,width:void 0};return oH(t,i)}function aH(t,e,i){if(0===t)return{top:0,row:0,bottom:0,height:0};if(t-=i.tableY,e&&t>i.tableNoFrameHeight-i.getBottomFrozenRowsHeight()&&t<i.tableNoFrameHeight)for(let e=0;e<i.rightFrozenColCount;e++)if(t>i.tableNoFrameHeight-i.getRowsHeight(i.rowCount-e-1,i.rowCount-1))return{row:i.rowCount-e-1,top:void 0,bottom:void 0,height:void 0};return rH(t,i)}function lH(t){return 2===t.length&&ew(t[0])&&ew(t[1])&&t[1]>=t[0]}function hH(t){const e=t[1]-t[0],i=t[1]*t[0]<0;let n=t[0]<=0?0-t[0]:0,o=t[1]>0?t[1]-0:0;return 0===e?t[0]<0?(n=1,o=0):t[0]>0&&(n=0,o=1):(n/=e,o/=e),{total:e,negative:n,positive:o,includeZero:i,domain:t,extendable_min:!0,extendable_max:!0}}function dH(t,e){const{positive:i,negative:n,extendable_min:o,extendable_max:r,domain:s}=t,{positive:a,negative:l,extendable_min:h,extendable_max:d,domain:c}=e;if(a>0){if(!h)return!1;let t=n/i;r&&(t=n/Math.max(i,a),s[1]=-s[0]/t),c[0]=-c[1]*t}else if(l>0){if(!d)return!1;let t=i/n;o&&(t=i/Math.max(n,n),s[0]=-s[1]/t),c[1]=-c[0]*t}return!0}function cH(t,e){const{extendable_min:i,extendable_max:n,domain:o}=t,{positive:r,negative:s,domain:a}=e;return!(0===r&&0===s||r>0&&!n||s>0&&!i||(o[0]=a[0],o[1]=a[1],0))}function uH(t,e){const{positive:i,negative:n,extendable_max:o,domain:r}=t,{positive:s,negative:a,extendable_min:l,domain:h}=e;if(o&&l){const t=Math.max(n,a)/Math.max(i,s);r[1]=-r[0]/t,h[0]=-h[1]*t}else if(l){const t=n/i;h[0]=-h[1]*t}else{if(!o)return!1;{const t=a/s;r[1]=-r[0]/t}}return!0}function gH(t,e){const{extendable_min:i,domain:n}=t,{extendable_max:o,domain:r}=e;return!(!i||!o||(n[0]=-n[1],r[1]=-r[0],0))}function pH(t,e,i,n){return 0!==n&&t?()=>t.map((t=>{const n=(t-e.min)/(e.max-e.min),o=(i.max-i.min)*n+i.min;return Math.round(100*o)/100})):void 0}function fH(t,e,i){var n,o,r,s,a,l,h;if(i._table.isPivotChart())if(i.indicatorsAsCol){if(i.hasTwoIndicatorAxes&&e===i.columnHeaderLevelCount-1&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount){const n=wH("top",t,e+1,t,i.columnHeaderLevelCount-1,t,e,1,i);if(!n)return;const o=UB(AR("padding",i._table._getCellStyle(t,e+1),t,e+1,i._table)),{range:r,ticks:s,axisOption:a,targetTicks:l,targetRange:h,index:d,theme:c}=n;return tw(null==a?void 0:a.min)&&(r.min=a.min,r.min>0&&(a.zero=!1)),tw(null==a?void 0:a.max)&&(r.max=a.max,r.max<0&&(a.zero=!1)),uw({range:r},a,{orient:"top",type:(null==a?void 0:a.type)||"linear",label:{flush:!0},tick:{tickMode:pH(l,h,r,d)},__ticksForVTable:s,__vtableChartTheme:c,__vtablePadding:o})}if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount){const n=i.getIndicatorKeyInChartSpec(t,e);let o=null;null==n||n.forEach((t=>{const e=i.getIndicatorInfo(t);e&&(o=e)}));const r=wH("bottom",t,e-1,t,e,t,e,0,i);if(!r)return;const s=UB(AR("padding",i._table._getCellStyle(t,e-1),t,e-1,i._table)),{range:a,ticks:l,axisOption:h,index:d,targetTicks:c,targetRange:u,theme:g}=r;return tw(null==h?void 0:h.min)&&(a.min=h.min,a.min>0&&(h.zero=!1)),tw(null==h?void 0:h.max)&&(a.max=h.max,a.max<0&&(h.zero=!1)),uw({title:{visible:!0,text:null==o?void 0:o.title},range:a},h,{orient:"bottom",type:(null==h?void 0:h.type)||"linear",label:{flush:!0},tick:{tickMode:pH(c,u,a,d)},__ticksForVTable:l,__vtableChartTheme:g,__vtablePadding:s})}if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount){let a=i.getDimensionKeyInChartSpec(i.rowHeaderLevelCount,e);ZC(a)&&(a=a[0]);const l=null!==(n=i.dataset.collectedValues[a])&&void 0!==n?n:[],h=i.getRowKeysPath(t,e),d=null!==(o=l[null!=h?h:""])&&void 0!==o?o:[],{axisOption:c,theme:u,chartType:g}=vH(t+1,e,"left",i);if(!1===(null==c?void 0:c.visible))return;const p=UB(AR("padding",i._table._getCellStyle(t+1,e),t+1,e,i._table)),f=i.getRawChartSpec(t+1,e);return uw({domain:"linear"===(null==c?void 0:c.type)?void 0:Array.from(d),range:"linear"===(null==c?void 0:c.type)?d:void 0,title:{autoRotate:!0}},c,{orient:"left",type:null!==(r=null==c?void 0:c.type)&&void 0!==r?r:"band",__vtableChartTheme:u,inverse:CH(c,"horizontal"===(null!==(s=null==f?void 0:f.direction)&&void 0!==s?s:"scatter"===g?"vertical":"horizontal")),__vtablePadding:p})}}else{if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount){const n=i.getIndicatorKeyInChartSpec(t,e);let o=null;null==n||n.forEach((t=>{const e=i.getIndicatorInfo(t);e&&(o=e)}));const r=wH("left",t+1,e,t,e,t,e,0,i);if(!r)return;const s=UB(AR("padding",i._table._getCellStyle(t+1,e),t+1,e,i._table)),{range:a,ticks:l,axisOption:h,index:d,targetTicks:c,targetRange:u,theme:g}=r;return tw(null==h?void 0:h.min)&&(a.min=h.min,a.min>0&&(h.zero=!1)),tw(null==h?void 0:h.max)&&(a.max=h.max,a.max<0&&(h.zero=!1)),uw({title:{visible:!0,text:null==o?void 0:o.title,autoRotate:!0},range:a},h,{orient:"left",type:(null==h?void 0:h.type)||"linear",label:{flush:!0},tick:{tickMode:pH(c,u,a,d)},__ticksForVTable:l,__vtableChartTheme:g,__vtablePadding:s})}if(t===i.colCount-i.rightFrozenColCount&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount){const n=wH("right",t-1,e,i.rowHeaderLevelCount-1,e,t,e,1,i);if(!n)return;const o=UB(AR("padding",i._table._getCellStyle(t-1,e),t-1,e,i._table)),{range:r,ticks:s,axisOption:a,index:l,targetTicks:h,targetRange:d,theme:c}=n;return tw(null==a?void 0:a.min)&&(r.min=a.min,r.min>0&&(a.zero=!1)),tw(null==a?void 0:a.max)&&(r.max=a.max,r.max<0&&(a.zero=!1)),uw({range:r,title:{autoRotate:!0}},a,{orient:"right",type:(null==a?void 0:a.type)||"linear",label:{flush:!0},tick:{tickMode:pH(h,d,r,l)},__ticksForVTable:s,__vtableChartTheme:c,__vtablePadding:o})}if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount){let n=i.getDimensionKeyInChartSpec(t,i.columnHeaderLevelCount);ZC(n)&&(n=n[0]);const o=null!==(a=i.dataset.collectedValues[n])&&void 0!==a?a:[],r=i.getColKeysPath(t,e),s=null!==(l=null==o?void 0:o[null!=r?r:""])&&void 0!==l?l:[],{axisOption:d,isPercent:c,theme:u,chartType:g}=vH(t,e-1,"bottom",i);if(!1===(null==d?void 0:d.visible))return;const p=UB(AR("padding",i._table._getCellStyle(t,e-1),t,e-1,i._table));return uw({domain:"linear"===(null==d?void 0:d.type)?void 0:Array.from(s),range:"linear"===(null==d?void 0:d.type)?s:void 0},d,{orient:"bottom",type:null!==(h=null==d?void 0:d.type)&&void 0!==h?h:"band",__vtableChartTheme:u,__vtablePadding:p})}}}function vH(t,e,i,n){var o,r;const s=n.getRawChartSpec(t,e),a=null!==(o=s.axes)&&void 0!==o?o:[];if(n._table.pivotChartAxes.forEach((t=>{-1===a.findIndex((e=>t.orient===e.orient))&&a.push(t)})),s&&ZC(a)){const t=a.find((t=>t.orient===i));if(t){const{seriesIndex:e,seriesId:o}=t;let a,l;XC(o)&&ZC(s.series)?a=(ZC(o)?o:[o]).map((t=>{const e=s.series.findIndex((e=>e.id===t));return e>=0&&(l=s.series[e]),e})):XC(e)&&ZC(s.series)&&(a=e);const{isZeroAlign:h,isTickAlign:d}=bH(s,i,n);return{axisOption:t,isPercent:s.percent,isZeroAlign:h,isTickAlign:d,seriesIndice:a,theme:s.theme,chartType:null!==(r=null==l?void 0:l.type)&&void 0!==r?r:s.type}}}const l=n._table.pivotChartAxes.find((t=>t.orient===i)),{isZeroAlign:h,isTickAlign:d}=bH(s,i,n);return{axisOption:l,isPercent:!1,isZeroAlign:h,isTickAlign:d,theme:s.theme,chartType:s.type}}function bH(t,e,i){const n=[];let o;"left"===e||"right"===e?n.push("left","right"):"top"!==e&&"bottom"!==e||n.push("top","bottom"),o=t&&ZC(t.axes)?t.axes:i._table.pivotChartAxes;let r=!1,s=!1;if(ZC(o)){const t=[];o.forEach((e=>{n.includes(e.orient)&&t.push(e)}));for(let e=0;e<t.length;e++){const i=t[e];i.sync&&i.sync.axisId&&t.find((t=>t.id===i.sync.axisId))&&(r=r||i.sync.zeroAlign,s=s||i.sync.tickAlign)}}return{isZeroAlign:r,isTickAlign:s}}function mH(t,e,i,n,o){var r;if(ZC(o)){const r={min:1/0,max:-1/0};for(let s=0;s<o.length;s++){const a=mH(t,e,i,n,o[s]);a&&(r.min=Math.min(r.min,a.min),r.max=Math.max(r.max,a.max))}return isFinite(r.min)&&isFinite(r.max)?r:null}let s=null==e?void 0:e[o];if(ZC(s)&&(s=s[0]),!s)return null;const a=t[s],l=uw({},null!==(r=null==a?void 0:a[null!=n?n:""])&&void 0!==r?r:{min:0,max:1});return l.positiveMax&&l.positiveMax>l.max&&(l.max=l.positiveMax),l.negativeMin&&l.negativeMin<l.min&&(l.min=l.negativeMin),l.min===l.max&&(l.min>0?l.min=0:l.max=0),l}var yH;function CH(t,e){let i=null==t?void 0:t.inverse;return e&&!("bottom"===(n=null==t?void 0:t.orient)||"top"===n)&&(i=!XC(null==t?void 0:t.inverse)||!(null==t?void 0:t.inverse)),i;var n}function wH(t,e,i,n,o,r,s,a,l){const h=l.getIndicatorKeyInChartSpec(n,o);let d;d="top"===t||"bottom"===t?l.getColKeysPath(r,s):l.getRowKeysPath(r,s);const c=xH(e,i,a,t,h,d,l);if(!c)return;const u="bottom"===t?"top":"top"===t?"bottom":"left"===t?"right":"left",{targetRange:g,targetTicks:p}=function(t,e,i,n,o,r,s,a,l,h){let d,c;if(!n&&!o)return{targetTicks:d,targetRange:c};const u=xH(t,e,s.length-1-i,a,s,l,h);if(u){const{range:s,ticks:l}=u;if(c=s,n){const t=function(t,e){const i=[t.min,t.max],n=[e.min,e.max];if(!lH(i)||!lH(n))return;const o=hH(i),r=hH(n),{positive:s,negative:a,extendable_min:l,extendable_max:h,includeZero:d}=o,{positive:c,negative:u,extendable_min:g,extendable_max:p,includeZero:f}=r;if(0===s&&0===a){if(!cH(o,r))return}else if(0===c&&0===u){if(!cH(r,o))return}else if(d||f)if(d&&!f){if(!dH(o,r))return}else if(f&&!d){if(!dH(r,o))return}else{if(a===u)return;if(a>u){if(!uH(o,r))return}else if(!uH(r,o))return}else{if(0===a&&0===c){if(!gH(o,r))return}else if(0===u&&0===s&&!gH(r,o))return;if(0===a&&0===u)if(0===i[0]&&n[0]>0){if(!g)return;n[0]=0}else{if(!(0===n[0]&&i[0]>0))return;if(!l)return;i[0]=0}if(0===s&&0===c)if(0===i[1]&&n[1]>0){if(!p)return;n[1]=0}else{if(!(0===n[1]&&i[1]>0))return;if(!h)return;i[1]=0}}return{range1:i,range2:n}}(r,s);t&&(r.min=t.range1[0],r.max=t.range1[1],c.min=t.range2[0],c.max=t.range2[1])}o&&(d=n?function(t,e,i,n,o,r){const s=J_.getFunction("getAxisDomainRangeAndLabels"),{axisOption:a,isZeroAlign:l}=vH(e,i,0===n?"right":"left",r),{ticks:h}=s(t.min,t.max,a,l,"bottom"===o||"top"===o?r._table.getColWidth(e)||r._table.tableNoFrameWidth:r._table.getRowHeight(i)||r._table.tableNoFrameHeight);return h}(c,t,e,i,a,h):l)}return{targetTicks:d,targetRange:c}}(e,i,c.index,c.isZeroAlign,c.isTickAlign,c.range,h,u,d,l);if(0!==c.index&&p){const e=J_.getFunction("getAxisDomainRangeAndLabels"),{range:i,ticks:n}=e(c.range.min,c.range.max,c.axisOption,c.isZeroAlign,"bottom"===t||"top"===t?l._table.getColWidth(r)||l._table.tableNoFrameWidth:l._table.getRowHeight(s)||l._table.tableNoFrameHeight,{targetTicks:p,targetRange:g});c.range.min=i[0],c.range.max=i[1],c.ticks=n}return c.targetRange=g,c.targetTicks=p,c}function xH(t,e,i,n,o,r,s){const{axisOption:a,isPercent:l,isZeroAlign:h,isTickAlign:d,seriesIndice:c,theme:u,chartType:g}=vH(t,e,n,s),p=mH(s.dataset.collectedValues,o,h,r,null!=c?c:i);if(!p)return;l&&(p.min=p.min<0?-1:0,p.max=p.max>0?1:0),((null==a?void 0:a.zero)||p.min===p.max)&&(p.min=Math.min(p.min,0),p.max=Math.max(p.max,0));const f=J_.getFunction("getAxisDomainRangeAndLabels"),{range:v,ticks:b}=f(p.min,p.max,a,h,"bottom"===n||"top"===n?s._table.getColWidth(t)||s._table.tableNoFrameWidth:s._table.getRowHeight(e)||s._table.tableNoFrameHeight);(null==a?void 0:a.nice)&&(p.min=v[0],p.max=v[1]);const m=b;return tw(null==a?void 0:a.min)&&(p.min=a.min),tw(null==a?void 0:a.max)&&(p.max=a.max),{index:null!=c?c:i,range:p,ticks:m,isZeroAlign:h,isTickAlign:d,axisOption:a,theme:u,chartType:g}}!function(t){t.vertical="vertical",t.horizontal="horizontal"}(yH||(yH={}));class _H{constructor(t,e,i){this.table=t,this.customCellStyle=e,this.customCellStyleArrangement=i}getCustomCellStyle(t,e){const i=this.getCustomCellStyleIds(t,e);if(i.length){const n=[];return i.forEach((i=>{const o=this.getCustomCellStyleOption(i);if(VC(null==o?void 0:o.style)){const i=o.style({col:t,row:e,table:this.table,value:this.table.getCellValue(t,e),dataValue:this.table.getCellOriginValue(t,e),cellHeaderPaths:this.table.getCellHeaderPaths(t,e)});n.push(i)}else(null==o?void 0:o.style)&&n.push(o.style)})),uw({},...n)}}getCustomCellStyleIds(t,e){const i=[],n=this.table.getCellRange(t,e);for(let t=n.start.col;t<=n.end.col;t++)for(let e=n.start.row;e<=n.end.row;e++)this.customCellStyleArrangement.forEach((n=>{n.cellPosition.range?n.cellPosition.range.start.col<=t&&n.cellPosition.range.end.col>=t&&n.cellPosition.range.start.row<=e&&n.cellPosition.range.end.row>=e&&i.push(n.customStyleId):n.cellPosition.col===t&&n.cellPosition.row===e&&i.push(n.customStyleId)}));return i}getCustomCellStyleOption(t){return this.customCellStyle.find((e=>e.id===t))}registerCustomCellStyle(t,e){const i=this.customCellStyle.findIndex((e=>e.id===t));-1===i?this.customCellStyle.push({id:t,style:e}):this.customCellStyle[i]={id:t,style:e},this.customCellStyleArrangement.forEach((e=>{const i=e.cellPosition;if(e.customStyleId===t)if(i.range)for(let t=Math.max(0,i.range.start.col);t<=Math.min(this.table.colCount-1,i.range.end.col);t++)for(let e=Math.max(0,i.range.start.row);e<=Math.min(this.table.rowCount-1,i.range.end.row);e++)this.table.scenegraph.updateCellContent(t,e);else this.table.scenegraph.updateCellContent(i.col,i.row)})),this.table.scenegraph.updateNextFrame()}arrangeCustomCellStyle(t,e,i){var n;const o=this.customCellStyleArrangement.findIndex((e=>e.cellPosition.range&&t.range?e.cellPosition.range.start.col===t.range.start.col&&e.cellPosition.range.start.row===t.range.start.row&&e.cellPosition.range.end.col===t.range.end.col&&e.cellPosition.range.end.row===t.range.end.row:e.cellPosition.col===t.col&&e.cellPosition.row===t.row));if(-1===o&&!e)return;if(-1===o&&e)this.customCellStyleArrangement.push({cellPosition:{col:t.col,row:t.row,range:t.range},customStyleId:e});else{if(this.customCellStyleArrangement[o].customStyleId===e)return;e?this.customCellStyleArrangement[o].customStyleId=e:this.customCellStyleArrangement.splice(o,1)}const r=null===(n=this.getCustomCellStyleOption(e))||void 0===n?void 0:n.style;if(r){i=!0;for(const t in r)if(-1===Uw.indexOf(t)){i=!1;break}}if(t.range)for(let e=Math.max(0,t.range.start.col);e<=Math.min(this.table.colCount-1,t.range.end.col);e++)for(let n=Math.max(0,t.range.start.row);n<=Math.min(this.table.rowCount-1,t.range.end.row);n++){const t=this.table.getCellRange(e,n);for(let e=t.start.col;e<=t.end.col;e++)for(let n=t.start.row;n<=t.end.row;n++)this.table.scenegraph.updateCellContent(e,n,i)}else this.table.scenegraph.updateCellContent(t.col,t.row,i);this.table.scenegraph.updateNextFrame()}updateCustomCell(t,e){this.customCellStyle.length=0,this.customCellStyleArrangement.length=0,t.forEach((t=>{this.registerCustomCellStyle(t.id,t.style)})),e.forEach((t=>{this.arrangeCustomCellStyle(t.cellPosition,t.customStyleId)}))}hasCustomCellStyle(t){return this.customCellStyle.some((e=>e.id===t))}}function SH(t,e){t=t.clone();for(const i in e){const n=e[i];XC(n)&&(t[`_${i}`]=n)}return t}const AH={};function BH(t){return Math.floor(t)===t}class TH extends rr{onUpdate(t,e,i){if(this.from.x!==this.to.x){const i=t?this.to.x:this.from.x+Math.floor((this.to.x-this.from.x)*e);this.params.table.scrollLeft=i}if(this.from.y!==this.to.y){const i=t?this.to.y:this.from.y+Math.floor((this.to.y-this.from.y)*e);this.params.table.scrollTop=i}}}class RH{constructor(t){this.table=t,this.timeline=new nr,this.ticker=new tr,this.ticker.addTimeline(this.timeline),this.ticker.setFPS(60),this.tempGraphic=ql({})}scrollTo(t,e){var i,n;const o={x:this.table.scrollLeft,y:this.table.scrollTop},{col:r,row:s}=t;let l,h,d=r,c=s;tw(r)&&!BH(r)&&(d=Math.floor(r),l=r-d),tw(s)&&!BH(s)&&(c=Math.floor(s),h=s-c);const u=this.table.getCellRect(null!=d?d:0,null!=c?c:0);let{left:g,top:p}=u;l&&(g+=l*u.width),h&&(p+=h*u.height);const f={x:tw(r)?g-this.table.getFrozenColsWidth():this.table.scrollLeft,y:tw(s)?p-this.table.getFrozenRowsHeight():this.table.scrollTop},v=jC(e)?e?3e3:0:null!==(i=null==e?void 0:e.duration)&&void 0!==i?i:3e3,b=jC(e)?e?"linear":"":null!==(n=null==e?void 0:e.easing)&&void 0!==n?n:"linear";new ar(a.GenAutoIncrementId(),this.timeline).bind(this.tempGraphic).play(new TH(o,f,v,b,{graphic:this.tempGraphic,table:this.table})),this.ticker.start()}clear(){this.timeline.clear(),this.ticker.stop()}}function kH(t){return VC(t)?t:ZC(t)?(e,i)=>t.find((t=>t.range.start.col<=e&&t.range.end.col>=e&&t.range.start.row<=i&&t.range.end.row>=i)):void 0}const{toBoxArray:MH}=p_,{isTouchEvent:LH}=g_,PH=/^\$(\d+)\$(\d+)$/;!function(){if("node"===kx.mode)return;const t=document.createElement("style");t.id="vtable-style-styleSheet",t.textContent="\n.vtable .input-container {\n\tposition: absolute;\n\ttop:0px;\n}\n.vtable .table-scrollable {\n\tposition: absolute;\n\toverflow: scroll;\n}\n.vtable .table-scrollable::-webkit-scrollbar-button{\n\tbackground-color: transparent;\n}\n.vtable .table-scrollable::-webkit-scrollbar-track-piece{\n\tbackground-color: transparent;\n}\n.vtable .table-scrollable::-webkit-scrollbar-corner {\n\tbackground-color: transparent;\n}\n.vtable .table-scrollable::-webkit-scrollbar-thumb {\n\tborder-radius      : 4px;\n\tbackground-color   : rgba(100, 100, 100, .5);\n}\n\n.vtable .table-scroll-end-point {\n\topacity: 0;\n\tposition: relative;\n}\n.vtable {\n\t/* 设置overflow: auto 应该是为了滚动条的某个问题 但设置了auto之后 dom的下拉菜单只能显示在vtable节点中 超出会截断;现在去掉auto 暂时滚动条的问题没有发现 */\n\t/* overflow: auto; */\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\ttext-align: left;\n  -webkit-font-smoothing:auto;\n\n  overflow: hidden; // for react-vtable dom custom element\n}\n\n.vtable-gantt {\n\t/* 设置overflow: auto 应该是为了滚动条的某个问题 但设置了auto之后 dom的下拉菜单只能显示在vtable节点中 超出会截断;现在去掉auto 暂时滚动条的问题没有发现 */\n\t/* overflow: auto; */\n\tposition: absolute;\n\twidth: 100%;\n\theight: 100%;\n\ttext-align: left;\n  -webkit-font-smoothing:auto;\n\n  overflow: hidden; // for react-vtable dom custom element\n}\n.vtable .table-component-container {\n  pointer-events: none;\n  overflow: hidden;\n  position: absolute;\n  top: 0px;\n  left: 0px;\n}\n.vtable > canvas {\n\tposition: absolute;\n\twidth: 0;\n\theight: 0;\n}\n.vtable .table-focus-control {\n\tposition: relative !important;\n\twidth: 1px;\n\theight: 1px;\n\topacity: 0;\n\tpadding: 0;\n\tmargin: 0;\n\tbox-sizing: border-box;\n\tpointer-events: none;\n\tmax-width: 500px;\n\tmax-height: 500px;\n\tfloat: none !important;\n}\n.vtable input.table-focus-control::-ms-clear {\n\tvisibility: hidden;\n}\n.vtable input.table-focus-control.composition {\n\topacity: 1;\n\tmax-width: none;\n\tmax-height: none;\n}\n",document.head.appendChild(t)}();class EH extends gx{static get EVENT_TYPE(){return v_}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b;if(super(),this.showFrozenIcon=!0,this.version="1.18.6",this.id=`VTable${Date.now()}`,this.isReleased=!1,this._chartEventMap={},this.throttleInvalidate=function(t,e){let i=null;return function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];i||(i=setTimeout((()=>{t.apply(this,o),i=null}),e))}}(this.render.bind(this),200),"node"===kx.mode?(e=t,t=null):t instanceof HTMLElement||(e=t,t=t.container?t.container:null),!t&&"node"!==e.mode&&!e.canvas)throw new Error("vtable's container is undefined");this.pluginManager=new class{constructor(t,e){var i;this.plugins=new Map,this.table=t,null===(i=e.plugins)||void 0===i||i.map((t=>{this.register(t),this._bindTableEventForPlugin(t)}))}register(t){this.plugins.set(t.id,t)}registerAll(t){t.forEach((t=>this.register(t)))}getPlugin(t){return this.plugins.get(t)}getPluginByName(t){return Array.from(this.plugins.values()).find((e=>e.name===t))}_bindTableEventForPlugin(t){var e,i=this;null===(e=t.runTime)||void 0===e||e.forEach((e=>{this.table.on(e,(function(){for(var n,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];null===(n=t.run)||void 0===n||n.call(t,...r,e,i.table)}))}))}updatePlugins(t){Array.from(this.plugins.values()).filter((e=>!(null==t?void 0:t.some((t=>t.id===e.id))))).forEach((t=>{this.release(),this.plugins.delete(t.id)})),this.plugins.forEach((t=>{t.update&&t.update()}));const e=null==t?void 0:t.filter((t=>!this.plugins.has(t.id)));null==e||e.forEach((t=>{this.register(t),this._bindTableEventForPlugin(t)}))}release(){this.plugins.forEach((t=>{var e;null===(e=t.release)||void 0===e||e.call(t,this.table)}))}}(this,e),this.fireListeners(v_.BEFORE_INIT,{options:e,container:t}),t=e.container&&e.container instanceof HTMLElement?e.container:t,!1===(null===(i=e.customConfig)||void 0===i?void 0:i.imageAnonymous)&&(Pu.isImageAnonymous=!1);const{frozenColCount:m=0,unfreezeAllOnExceedsMaxWidth:y,frozenRowCount:C,defaultRowHeight:w=40,defaultHeaderRowHeight:x,defaultColWidth:_=80,defaultHeaderColWidth:S,widthMode:A="standard",heightMode:B="standard",autoFillWidth:T=!1,autoFillHeight:R=!1,widthAdaptiveMode:k="only-body",heightAdaptiveMode:M="only-body",keyboardOptions:L,eventOptions:P,rowSeriesNumber:E,enableCheckboxCascade:H,columnResizeMode:O,rowResizeMode:I="none",resize:F,dragHeaderMode:z,dragOrder:D,showFrozenIcon:W,allowFrozenColCount:N,padding:G,hover:j,menu:V,select:U,customRender:X,pixelRatio:$=oE,renderChartAsync:Y,renderChartAsyncBatchCount:K,mode:q,modeParams:Z,canvasWidth:J,canvasHeight:Q,overscrollBehavior:tt,limitMinWidth:et,limitMinHeight:it,clearDOM:nt=!0}=e;this.container=t,this.options=e,this._widthMode=A,this._heightMode=B,this._widthAdaptiveMode=k,this._heightAdaptiveMode=M,this._autoFillWidth=T,this._autoFillHeight=R,this.customRender=X,this.padding={top:0,right:0,left:0,bottom:0},G&&("number"==typeof G?(this.padding.top=G,this.padding.left=G,this.padding.bottom=G,this.padding.right=G):(G.top&&(this.padding.top=G.top),G.bottom&&(this.padding.bottom=G.bottom),G.left&&(this.padding.left=G.left),G.right&&(this.padding.right=G.right))),(XC(Q)||XC(J))&&(this.canvasSizeSeted=!0),this.tableNoFrameWidth=0,this.tableNoFrameHeight=0,this.canvasWidth=tw(J)?J:void 0,this.canvasHeight=tw(Q)?Q:void 0,this.columnWidthComputeMode=null!==(n=e.columnWidthComputeMode)&&void 0!==n?n:"normal";const ot=this.internalProps={};void 0!==W&&(this.showFrozenIcon=W),"number"==typeof N&&N<=0&&(this.showFrozenIcon=!1),this.options.canvas?("node"!==kx.mode&&(ot.element=this.options.canvas.parentElement,ot.element.style.position="relative"),ot.focusControl=new qE(this,ot.element),ot.canvas=this.options.canvas,ot.context=ot.canvas.getContext("2d")):"node"!==kx.mode&&(ot.element=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vtable";var i,n;const o=document.createElement("div");o.setAttribute("tabindex","0"),o.classList.add(e),o.style.outline="none",o.style.margin=`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`;const r=(o.offsetWidth||(null===(i=o.parentElement)||void 0===i?void 0:i.offsetWidth)||1)-1,s=(o.offsetHeight||(null===(n=o.parentElement)||void 0===n?void 0:n.offsetHeight)||1)-1;return o.style.width=r&&r-t.left-t.right+"px"||"0px",o.style.height=s&&s-t.top-t.bottom+"px"||"0px",o}(this.padding),ot.focusControl=new qE(this,ot.element),ot.canvas=document.createElement("canvas"),ot.element.appendChild(ot.canvas),ot.context=ot.canvas.getContext("2d"),(null===(o=e.customConfig)||void 0===o?void 0:o.createReactContainer)&&function(t){const{internalProps:e}=t;e.bodyDomContainer=document.createElement("div"),e.bodyDomContainer.id="vtable-body-dom-container",e.bodyDomContainer.classList.add("table-component-container"),e.element.appendChild(e.bodyDomContainer),e.headerDomContainer=document.createElement("div"),e.headerDomContainer.id="vtable-header-dom-container",e.headerDomContainer.classList.add("table-component-container"),e.element.appendChild(e.headerDomContainer),e.frozenBodyDomContainer=document.createElement("div"),e.frozenBodyDomContainer.id="vtable-frozen-body-dom-container",e.frozenBodyDomContainer.classList.add("table-component-container"),e.element.appendChild(e.frozenBodyDomContainer),e.frozenHeaderDomContainer=document.createElement("div"),e.frozenHeaderDomContainer.id="vtable-frozen-header-dom-container",e.frozenHeaderDomContainer.classList.add("table-component-container"),e.element.appendChild(e.frozenHeaderDomContainer),e.rightFrozenBodyDomContainer=document.createElement("div"),e.rightFrozenBodyDomContainer.id="vtable-right-frozen-body-dom-container",e.rightFrozenBodyDomContainer.classList.add("table-component-container"),e.element.appendChild(e.rightFrozenBodyDomContainer),e.rightFrozenHeaderDomContainer=document.createElement("div"),e.rightFrozenHeaderDomContainer.id="vtable-right-frozen-header-dom-container",e.rightFrozenHeaderDomContainer.classList.add("table-component-container"),e.element.appendChild(e.rightFrozenHeaderDomContainer),e.frozenBottomDomContainer=document.createElement("div"),e.frozenBottomDomContainer.id="vtable-frozen-bottom-dom-container",e.frozenBottomDomContainer.classList.add("table-component-container"),e.element.appendChild(e.frozenBottomDomContainer),e.bottomDomContainer=document.createElement("div"),e.bottomDomContainer.id="vtable-bottom-dom-container",e.bottomDomContainer.classList.add("table-component-container"),e.element.appendChild(e.bottomDomContainer),e.rightFrozenBottomDomContainer=document.createElement("div"),e.rightFrozenBottomDomContainer.id="vtable-right-frozen-bottom-dom-container",e.rightFrozenBottomDomContainer.classList.add("table-component-container"),e.element.appendChild(e.rightFrozenBottomDomContainer)}(this)),ot.handler=new C_,tw(this.options.resizeTime)&&(ot.handler.resizeTime=this.options.resizeTime),ot.pixelRatio=$,ot.frozenColCount=m,ot.frozenRowCount=C,ot.unfreezeAllOnExceedsMaxWidth=null==y||y,ot.defaultRowHeight=w,ot.defaultHeaderRowHeight=null!=x?x:w,ot.defaultColWidth=_,ot.defaultHeaderColWidth=null!=S?S:_,ot.keyboardOptions=L,ot.eventOptions=P,ot.rowSeriesNumber=E,ot.enableCheckboxCascade=H,ot.columnResizeMode=null!==(r=null==F?void 0:F.columnResizeMode)&&void 0!==r?r:O,ot.rowResizeMode=null!==(s=null==F?void 0:F.rowResizeMode)&&void 0!==s?s:I,ot.dragHeaderMode=null!==(l=null!==(a=null==D?void 0:D.dragHeaderMode)&&void 0!==a?a:z)&&void 0!==l?l:"none",ot.renderChartAsync=Y,sM(K),ot.overscrollBehavior=null!=tt?tt:"auto",ot._rowHeightsMap=new ZE(this),ot._rowRangeHeightsMap=new Map,ot._colRangeWidthsMap=new Map,ot._widthResizedColMap=new Set,ot._heightResizedRowMap=new Set,this.colWidthsMap=new x_,this.colContentWidthsMap=new x_,this.colWidthsLimit={};const rt=this;if(ot.calcWidthContext={_:ot,get full(){var t;return"node"===kx.mode?rt.canvasWidth/(null!=$?$:1):this._.canvas.width/(null!==(t=this._.context.pixelRatio)&&void 0!==t?t:window.devicePixelRatio)}},ot.cellTextOverflows={},ot.focusedTable=!1,ot.theme=K_.of(null!==(h=e.theme)&&void 0!==h?h:K_.DEFAULT),ot.theme.isPivot=this.isPivotTable(),mR(ot.theme.functionalIconsStyle),t?(nt&&(t.innerHTML=""),t.appendChild(ot.element),this._updateSize()):this._updateSize(),ot.bodyHelper=new yE(this),ot.headerHelper=new KE(this),ot.rowSeriesNumberHelper=new QE(this),ot.autoWrapText=e.autoWrapText,ot.enableLineBreak=e.enableLineBreak,ot.allowFrozenColCount=null!==(d=e.allowFrozenColCount)&&void 0!==d?d:0,ot.limitMaxAutoWidth=null!==(c=e.limitMaxAutoWidth)&&void 0!==c?c:450,ot.limitMinWidth=null!=et?"number"==typeof et?et:et?10:0:10,ot.limitMinHeight=null!=it?"number"==typeof it?it:it?10:0:10,this.scenegraph=new class{constructor(t){let e,i;var n;this._needUpdateContainer=!1,this.table=t,this.hasFrozen=!1,this.clear=!0,this.mergeMap=new Map,n=this.table.theme.textPopTipStyle,Lt(wm.poptip,Cm,n),"node"===kx.mode?(Pu.setEnv("node",t.options.modeParams),e=t.canvasWidth,i=t.canvasHeight):t.options.canvas&&t.options.viewBox?(Pu.setEnv("browser"),e=t.options.viewBox.x2-t.options.viewBox.x1,i=t.options.viewBox.y2-t.options.viewBox.y1):(Pu.setEnv("browser"),e=t.canvas.width,i=t.canvas.height),this.stage=Ku(Object.assign({canvas:t.canvas,width:e,height:i,disableDirtyBounds:!1,background:t.theme.underlayBackgroundColor,dpr:t.internalProps.pixelRatio,enableLayout:!0,beforeRender:t=>{this.table.options.beforeRender&&this.table.options.beforeRender(t),this.table.animationManager.ticker.start()},afterRender:t=>{this.table.options.afterRender&&this.table.options.afterRender(t),this.table.fireListeners("after_render",null)},canvasControled:!t.options.canvas,viewBox:t.options.viewBox},t.options.renderOption)),this.stage.defaultLayer.setTheme({group:{boundsPadding:0,strokeBoundsBuffer:0,lineJoin:"round"},text:{ignoreBuf:!0}}),this.initSceneGraph(),this.stage.defaultLayer.add(this.tableGroup),this.stage.table=this.table,this.createComponent()}get width(){var t,e;return null!==(e=null===(t=this.tableGroup.attribute)||void 0===t?void 0:t.width)&&void 0!==e?e:0}get height(){var t,e;return null!==(e=null===(t=this.tableGroup.attribute)||void 0===t?void 0:t.height)&&void 0!==e?e:0}get x(){var t,e;return null!==(e=null===(t=this.tableGroup.attribute)||void 0===t?void 0:t.x)&&void 0!==e?e:0}get y(){var t,e;return null!==(e=null===(t=this.tableGroup.attribute)||void 0===t?void 0:t.y)&&void 0!==e?e:0}get bodyRowStart(){var t;return null!==(t=this.proxy.rowStart)&&void 0!==t?t:0}get bodyRowEnd(){var t;return null!==(t=this.proxy.rowEnd)&&void 0!==t?t:this.table.rowCount-1}get bodyColStart(){var t;return null!==(t=this.proxy.colStart)&&void 0!==t?t:0}get bodyColEnd(){var t;return null!==(t=this.proxy.colEnd)&&void 0!==t?t:this.table.colCount-1}initSceneGraph(){this.isPivot=this.table.isPivotTable(),function(t){const e=t.table.tableNoFrameWidth,i=t.table.tableNoFrameHeight;t.tableGroup=new xR({x:0,y:0,width:e,height:i,clip:!0,pickable:!1}),t.tableGroup.role="table";const n=wP(0,0,!t.table.options.enableTreeStickCell);n.role="col-header",t.colHeaderGroup=n;const o=wP(0,0,!t.table.options.enableTreeStickCell);o.role="corner-header",t.cornerHeaderGroup=o;const r=wP(0,0,!0);r.role="row-header",t.rowHeaderGroup=r;const s=wP(e,0,!0);s.role="body",t.bodyGroup=s;const a=wP(0,0,!0);a.role="right-frozen",t.rightFrozenGroup=a;const l=wP(0,0,!0);l.role="bottom-frozen",t.bottomFrozenGroup=l;const h=wP(0,0);h.role="component",t.componentGroup=h;const d=wP(0,0,!0);d.role="corner-right-top-header",t.rightTopCornerGroup=d;const c=wP(0,0,!0);c.role="corner-right-bottom-header",t.rightBottomCornerGroup=c;const u=wP(0,0,!0);u.role="corner-left-bottom-header",t.leftBottomCornerGroup=u,t.tableGroup.addChild(s),t.tableGroup.addChild(r),t.tableGroup.addChild(l),t.tableGroup.addChild(n),t.tableGroup.addChild(a),t.tableGroup.addChild(c),t.tableGroup.addChild(d),t.tableGroup.addChild(u),t.tableGroup.addChild(o),t.tableGroup.addChild(h)}(this)}clearCells(){var t,e;this.table.animationManager.clear(),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.findPluginsByName("poptipForText").forEach((t=>{t.deactivate(this.stage.pluginService)})),this.clear=!0,this.hasFrozen=!1,this.mergeMap.clear(),this.colHeaderGroup.clear(),delete this.colHeaderGroup.border,this.rowHeaderGroup.clear(),delete this.rowHeaderGroup.border,this.cornerHeaderGroup.clear(),delete this.cornerHeaderGroup.border,this.bodyGroup.clear(),delete this.bodyGroup.border,this.bottomFrozenGroup.clear(),delete this.bottomFrozenGroup.border,this.rightFrozenGroup.clear(),delete this.rightFrozenGroup.border,this.rightTopCornerGroup.clear(),delete this.rightTopCornerGroup.border,this.rightBottomCornerGroup.clear(),delete this.rightBottomCornerGroup.border,this.leftBottomCornerGroup.clear(),delete this.leftBottomCornerGroup.border,this.colHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rowHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.cornerHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bodyGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bottomFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightTopCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.leftBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.rightBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:0,height:0}),this.tableGroup.border&&(this.tableGroup.parent.removeChild(this.tableGroup.border),delete this.tableGroup.border),null===(t=this.proxy)||void 0===t||t.release(),null===(e=this.table.reactCustomLayout)||void 0===e||e.clearCache()}updateStageBackground(){this.stage.background=this.table.theme.underlayBackgroundColor,this.stage.renderNextFrame()}createComponent(){this.component=new $k(this.table),this.component.addToGroup(this.componentGroup),this.selectedRangeComponents=new Map,this.selectingRangeComponents=new Map,this.customSelectedRangeComponents=new Map}updateComponent(){this.component.updateStyle()}createSceneGraph(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(this.table.rowHeightsMap.clear(),this.table.internalProps.layoutMap.clearCellRangeMap()),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.autoEnablePlugins.getContributions().forEach((t=>{"poptipForText"===t.name&&this.stage.pluginService.register(t)})),this.clear=!1,this.frozenColCount=this.table.frozenColCount,this.frozenRowCount=this.table.frozenRowCount,this.proxy=new NL(this.table),Yk(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0,!0),this.table.isPivotChart()&&(TP(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle||this.table.theme.cornerHeaderStyle||{}),TP(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle||this.table.theme.cornerHeaderStyle||{}),TP(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle||this.table.theme.cornerHeaderStyle||{})),this.proxy.createGroupForFirstScreen(this.cornerHeaderGroup,this.colHeaderGroup,this.rowHeaderGroup,this.rightFrozenGroup,this.bottomFrozenGroup,this.bodyGroup,0,0),this.afterScenegraphCreated()}renderSceneGraph(){this.stage.render()}getCell(t,e,i){var n,o,r,s,a,l;let h;if(h=this.table.rightFrozenColCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e<this.table.frozenRowCount?null===(n=this.rightTopCornerGroup.getColGroup(t))||void 0===n?void 0:n.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<this.table.frozenColCount?null===(o=this.leftBottomCornerGroup.getColGroup(t))||void 0===o?void 0:o.getRowGroup(e):this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e>=this.table.rowCount-this.table.bottomFrozenRowCount?null===(r=this.rightBottomCornerGroup.getColGroup(t))||void 0===r?void 0:r.getRowGroup(e):this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?null===(s=this.rightFrozenGroup.getColGroup(t))||void 0===s?void 0:s.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>this.table.rowCount-1-this.table.bottomFrozenRowCount?null===(a=this.bottomFrozenGroup.getColGroup(t))||void 0===a?void 0:a.getRowGroup(e):null===(l=this.getColGroup(t,e<this.frozenRowCount))||void 0===l?void 0:l.getRowGroup(e),h&&"shadow-cell"===h.role&&!i){const i=this.table.getCellRange(t,e);i.start.col===t&&i.start.row===e||(h=this.getCell(i.start.col,i.start.row))}return h||oL}highPerformanceGetCell(t,e,i){return this.proxy.highPerformanceGetCell(t,e,i)}getColGroup(t){let e,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e=t<this.frozenColCount&&i?this.cornerHeaderGroup.getColGroup(t):t<this.frozenColCount?this.rowHeaderGroup.getColGroup(t):i&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightTopCornerGroup.getColGroup(t):!i&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightFrozenGroup.getColGroup(t):i?this.colHeaderGroup.getColGroup(t):this.bodyGroup.getColGroup(t),e||void 0}getColGroupInBottom(t){var e;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){const i=null!==(e=this.getColGroupInLeftBottomCorner(t))&&void 0!==e?e:this.getColGroupInRightBottomCorner(t);if(i)return i}if(this.table.bottomFrozenRowCount>0)return this.bottomFrozenGroup.getColGroup(t)}getColGroupInLeftBottomCorner(t){if(this.table.bottomFrozenRowCount>0)return this.leftBottomCornerGroup.getColGroup(t)}getColGroupInRightTopCorner(t){if(this.table.rightFrozenColCount>0)return this.rightTopCornerGroup.getColGroup(t)}getColGroupInRightBottomCorner(t){if(this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0)return this.rightBottomCornerGroup.getColGroup(t)}getCellSize(t,e){const i=this.getCell(t,e),n=Z_(this.table,t,e);let o=i.attribute.width,r=i.attribute.height;return n&&(o/=n.end.col-n.start.col+1,r/=n.end.row-n.start.row+1),{width:o,height:r}}updateNextFrame(){this.updateContainerSync(),this.resetAllSelectComponent(),this.stage.renderNextFrame()}resetAllSelectComponent(){var t,e,i,n;((null===(e=null===(t=this.table.stateManager.select)||void 0===t?void 0:t.ranges)||void 0===e?void 0:e.length)>0||(null===(n=null===(i=this.table.stateManager.select)||void 0===i?void 0:i.customSelectRanges)||void 0===n?void 0:n.length)>0)&&jL(this)}hideHoverIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(BP(t,e,(t=>"mouseenter_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",0);const e=t.parent.getChildByName("icon-back");e&&e.setAttribute("visible",!1)}),i),i.updateNextFrame())}(t,e,this)}showHoverIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(BP(t,e,(t=>"mouseenter_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",1)}),i),i.updateNextFrame())}(t,e,this)}hideClickIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(BP(t,e,(t=>"click_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",0)}),i),i.updateNextFrame())}(t,e,this)}showClickIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(BP(t,e,(t=>"click_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",1)}),i),i.updateNextFrame())}(t,e,this)}getIcon(t,e,i,n){return function(t,e,i,n,o){let r;return o.getCell(t,e).forEachChildren((t=>{t.role&&t.role.startsWith("icon")&&t.containsPoint(i,n,xi.GLOBAL)&&(r=t)})),r}(t,e,i,n,this)}setIconHoverStyle(t,e,i,n){!function(t,e,i,n,o){var r,s;if((t.attribute.backgroundColor||t.attribute.hoverImage)&&BP(e,i,(e=>e.name===t.name),(t=>{var e,i,n,o,r,s,a,l;if(t.attribute.backgroundColor){let h=t.parent.getChildByName("icon-back");h?h.setAttributes({x:(null!==(e=t.attribute.x)&&void 0!==e?e:0)+(t.AABBBounds.width()-t.backgroundWidth)/2,y:(null!==(i=t.attribute.y)&&void 0!==i?i:0)+(t.AABBBounds.height()-t.backgroundHeight)/2,dx:null!==(n=t.attribute.dx)&&void 0!==n?n:0,dy:null!==(o=t.attribute.dy)&&void 0!==o?o:0,width:t.backgroundWidth,height:t.backgroundHeight,fill:t.attribute.backgroundColor,cornerRadius:5,visible:!0}):(h=ql({x:(null!==(r=t.attribute.x)&&void 0!==r?r:0)+(t.AABBBounds.width()-t.backgroundWidth)/2,y:(null!==(s=t.attribute.y)&&void 0!==s?s:0)+(t.AABBBounds.height()-t.backgroundHeight)/2,dx:null!==(a=t.attribute.dx)&&void 0!==a?a:0,dy:null!==(l=t.attribute.dy)&&void 0!==l?l:0,width:t.backgroundWidth,height:t.backgroundHeight,fill:t.attribute.backgroundColor,cornerRadius:5,pickable:!1,visible:!0}),h.name="icon-back"),t.parent.insertBefore(h,t)}t.attribute.hoverImage&&t.attribute.image!==t.attribute.hoverImage&&(t.image=t.attribute.hoverImage)}),o),t.tooltip){const{x1:n,x2:a,y1:l,y2:h}=t.globalAABBBounds,d={content:t.tooltip.title,referencePosition:{rect:{left:n,right:a,top:l,bottom:h,width:t.globalAABBBounds.width(),height:t.globalAABBBounds.height()},placement:t.tooltip.placement},disappearDelay:t.tooltip.disappearDelay,style:Object.assign({},null===(r=o.table.internalProps.theme)||void 0===r?void 0:r.tooltipStyle,null===(s=t.tooltip)||void 0===s?void 0:s.style)};o.table.internalProps.tooltipHandler.isBinded(d)||o.table.showTooltip(e,i,d)}}(t,e,i,0,this)}updateSortIcon(t){const{col:e,row:i,iconMark:n,order:o,oldSortCol:r,oldSortRow:s,oldIconMark:a}=t;SP({col:e,row:i,iconMark:n,order:o,oldSortCol:r,oldSortRow:s,oldIconMark:a,scene:this})}updateFrozenIcon(t,e){!function(t){for(let e=0;e<t.table.colCount;e++)for(let i=0;i<t.table.columnHeaderLevelCount;i++)BP(e,i,(t=>"frozen"===t.attribute.funcType),(n=>{const o=t.table.internalProps.headerHelper.getFrozenIcon(e,i);LR(o,n),n.name=o.name}),t)}(this)}updateHierarchyIcon(t,e){!function(t,e,i){let n;n=i.table.isHeader(t,e)?i.table.internalProps.headerHelper.getHierarchyIcon(t,e):i.table.internalProps.bodyHelper.getHierarchyIcon(t,e),BP(t,e,(t=>t.attribute.funcType===Zw.collapse||t.attribute.funcType===Zw.expand),(t=>{LR(n,t),t.name=n.name}),i)}(t,e,this)}setIconNormalStyle(t,e,i){!function(t,e,i,n){(t.attribute.backgroundColor||t.attribute.hoverImage)&&BP(e,i,(e=>e.name===t.name),(t=>{const e=t.parent.getChildByName("icon-back");e&&e.setAttribute("visible",!1),t.attribute.hoverImage&&t.attribute.image!==t.attribute.originImage&&(t.image=t.attribute.originImage)}),n)}(t,e,i,this)}residentHoverIcon(t,e){!function(t,e,i){BP(t,e,(t=>t.attribute.funcType===Zw.dropDown),(t=>{t.oldVisibleTime=t.attribute.visibleTime,t.setAttribute("visibleTime","always"),t.setAttribute("opacity",1)}),i)}(t,e,this)}resetResidentHoverIcon(t,e){!function(t,e,i){BP(t,e,(t=>t.attribute.funcType===Zw.dropDown),(t=>{t.oldVisibleTime&&t.setAttribute("visibleTime",t.oldVisibleTime),t.setAttribute("opacity","always"===t.attribute.visibleTime?1:0)}),i)}(t,e,this)}deactivateChart(t,e){var i,n;if(-1===t||-1===e)return;const o=this.getCell(t,e);null===(n=null===(i=null==o?void 0:o.firstChild)||void 0===i?void 0:i.deactivate)||void 0===n||n.call(i)}activateChart(t,e){var i,n,o;if(-1===t||-1===e)return;const r=this.getCell(t,e);return null===(n=null===(i=null==r?void 0:r.firstChild)||void 0===i?void 0:i.activate)||void 0===n||n.call(i,this.table),null===(o=null==r?void 0:r.firstChild)||void 0===o?void 0:o.activeChartInstance}removeInteractionBorder(t,e){const i=this.getCell(t,e);i.setAttribute("highlightStroke",void 0),i.setAttribute("highlightStrokeArrayWidth",void 0),i.setAttribute("highlightStrokeArrayColor",void 0)}createCellSelectBorder(t,e,i,n,o,r,s){!function(t,e,i,n,o,r,s,a){var l,h,d,c,u,g,p,f,v;let b=!!(null===(l=t.table.options.excelOptions)||void 0===l?void 0:l.fillHandle);if((null===(h=t.table.stateManager.select.ranges)||void 0===h?void 0:h.length)>1)b=!1,t.removeFillHandleFromSelectComponents();else if(1===(null===(d=t.table.stateManager.select.ranges)||void 0===d?void 0:d.length)){const e=Math.max(t.table.stateManager.select.ranges[0].start.row,t.table.stateManager.select.ranges[0].end.row),i=Math.max(t.table.stateManager.select.ranges[0].start.col,t.table.stateManager.select.ranges[0].end.col);t.table.isHeader(i,e)&&(b=!1)}!Array.isArray(a)||!1!==a[1]&&!1!==a[2]||(b=!1);const m=Math.min(e,n),y=Math.min(i,o),C=Math.max(e,n),w=Math.max(i,o),x=t.highPerformanceGetCell(m,y).globalAABBBounds,_=t.highPerformanceGetCell(C,w).globalAABBBounds,S=t.table.theme,A=null===(c=S.selectionStyle)||void 0===c?void 0:c.cellBorderColor,B=null===(u=S.selectionStyle)||void 0===u?void 0:u.cellBorderLineWidth,T=ql({pickable:!1,fill:"replace"!==(null===(g=S.selectionStyle)||void 0===g?void 0:g.selectionFillMode)&&(null!==(f=null===(p=S.selectionStyle)||void 0===p?void 0:p.cellBgColor)&&void 0!==f?f:"rgba(0, 0, 255,0.1)"),lineWidth:B,stroke:a.map((t=>!!t&&A)),x:x.x1-t.tableGroup.attribute.x,y:x.y1-t.tableGroup.attribute.y,width:0,height:0,visible:!0,cornerRadius:YL(0,null===(v=t.table.theme.frameStyle)||void 0===v?void 0:v.cornerRadius,e,i,n,o,t.table)});let R;b&&(R=ql({pickable:!1,fill:A,stroke:A,x:_.x2-3,y:_.y2-3,width:6,height:6,visible:!0})),t.lastSelectId=s,t.selectingRangeComponents.set(`${m}-${y}-${C}-${w}-${s}`,{rect:T,fillhandle:R,role:r}),t.tableGroup.insertAfter(T,"body"===r?t.bodyGroup:"columnHeader"===r?t.colHeaderGroup:"rowHeader"===r?t.rowHeaderGroup:"cornerHeader"===r?t.cornerHeaderGroup:"rightTopCorner"===r?t.rightTopCornerGroup:"rightFrozen"===r?t.rightFrozenGroup:"leftBottomCorner"===r?t.leftBottomCornerGroup:"bottomFrozen"===r?t.bottomFrozenGroup:t.rightBottomCornerGroup),b&&t.tableGroup.insertAfter(R,"body"===r?t.bodyGroup:"columnHeader"===r?t.colHeaderGroup:"rowHeader"===r?t.rowHeaderGroup:"cornerHeader"===r?t.cornerHeaderGroup:"rightTopCorner"===r?t.rightTopCornerGroup:"rightFrozen"===r?t.rightFrozenGroup:"leftBottomCorner"===r?t.leftBottomCornerGroup:"bottomFrozen"===r?t.bottomFrozenGroup:t.rightBottomCornerGroup)}(this,t,e,i,n,o,r,s)}moveSelectingRangeComponentsToSelectedRangeComponents(){KL(this)}deleteLastSelectedRangeComponents(){var t;(t=this).selectedRangeComponents.forEach(((e,i)=>{var n;i.split("-")[4]===t.lastSelectId&&(e.rect.delete(),null===(n=e.fillhandle)||void 0===n||n.delete(),t.selectedRangeComponents.delete(i))}))}deleteAllSelectBorder(){qL(this),ZL(this)}updateCellSelectBorder(t){UL(this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}removeFillHandleFromSelectComponents(){this.selectedRangeComponents.forEach(((t,e)=>{var i;null===(i=t.fillhandle)||void 0===i||i.delete(),t.fillhandle=void 0}))}recreateAllSelectRangeComponents(){qL(this),this.table.stateManager.select.ranges.forEach((t=>{UL(this,t),KL(this)}))}updateColWidth(t,e,i,n){(function(t,e,i,n){n||t.table._setColWidth(e,t.table.getColWidth(e)+i,!0);const o=t.getColGroup(e,!0),r=t.getColGroupInRightTopCorner(e);o&&!r&&Ak(o,i,"col-corner",t),r&&Ak(r,i,"right-top",t);const s=t.getColGroup(e);s&&Ak(s,i,"row-body",t);const a=t.getColGroupInLeftBottomCorner(e);a&&Ak(a,i,"left-bottom",t);const l=t.getColGroupInBottom(e);l&&Ak(l,i,"bottom",t);const h=t.getColGroupInRightBottomCorner(e);h&&Ak(h,i,"right-bottom",t),e<t.frozenColCount?(t.cornerHeaderGroup.forEachChildrenSkipChild(((t,n)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),t.rowHeaderGroup.forEachChildrenSkipChild(((t,n)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)}))):(t.colHeaderGroup.forEachChildrenSkipChild(((t,n)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),t.bodyGroup.forEachChildrenSkipChild(((t,n)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)}))),a&&t.leftBottomCornerGroup.forEachChildrenSkipChild(((t,n)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),l&&t.bottomFrozenGroup.forEachChildrenSkipChild(((t,n)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),h&&t.rightBottomCornerGroup.forEachChildrenSkipChild(((t,n)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)}))})(this,t,Math.round(e),n),i||this.updateContainer(!0)}updateChartSizeForResizeColWidth(t){!function(t,e){const{table:i}=t,n=i.internalProps.layoutMap,o=-1===e?"all":i.internalProps.columnResizeType;if("column"===o){const n=t.getColGroup(e),o=t.getColGroup(e,!0),r=t.getColGroupInBottom(e,!0);if(null==n||n.forEachChildren((t=>{CP(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),null==o||o.forEachChildren((t=>{CP(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),null==r||r.forEachChildren((t=>{CP(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),"adaptive"===i.widthMode&&e<i.colCount-1){const n=t.getColGroup(e+1),o=t.getColGroup(e+1,!0),r=t.getColGroupInBottom(e+1,!0);null==n||n.forEachChildren((t=>{CP(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),null==o||o.forEachChildren((t=>{CP(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),null==r||r.forEachChildren((t=>{CP(t,i.getColWidth(t.col),i.getRowHeight(t.row))}))}}else{let r,s,a,l=i.rowHeaderLevelCount,h=i.colCount-1;if("indicator"===o)if(n.indicatorsAsCol)r=n.getIndicatorKey(e,i.columnHeaderLevelCount);else{const t=n.getCellHeaderPaths(e,i.columnHeaderLevelCount-1),o=t.colHeaderPaths[t.colHeaderPaths.length-1];s=o.dimensionKey,a=o.value}else if("indicatorGroup"===o){const t=i.internalProps.layoutMap,e=t.getCellHeaderPaths(i.stateManager.columnResize.col,i.columnHeaderLevelCount),n=t.getHeadNodeByRowOrColDimensions(e.colHeaderPaths.slice(0,e.colHeaderPaths.length-1));l=n.startInTotal+i.frozenColCount,h=n.startInTotal+i.frozenColCount+n.size-1}for(let e=l;e<=h;e++){const l=t.getColGroup(e),h=t.getColGroup(e,!0),d=t.getColGroupInBottom(e,!0);if(l){if("indicator"===o){const t=n.getIndicatorKey(e,i.columnHeaderLevelCount);if(n.indicatorsAsCol&&t!==r)continue;if(!n.indicatorsAsCol){const t=n.getCellHeaderPaths(e,i.columnHeaderLevelCount-1),o=null==t?void 0:t.colHeaderPaths[t.colHeaderPaths.length-1];if(!o||s!==o.dimensionKey||a!==o.value)continue}}l.forEachChildren((t=>{CP(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),null==h||h.forEachChildren((t=>{CP(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),null==d||d.forEachChildren((t=>{CP(t,i.getColWidth(t.col),i.getRowHeight(t.row))}))}}}}(this,t)}updateChartSizeForResizeRowHeight(t){!function(t,e){var i;const{table:n}=t,o=n.internalProps.layoutMap,r=n.stateManager,s=-1===e?"all":n.internalProps.rowResizeType;let a,l,h,d=n.columnHeaderLevelCount,c=n.rowCount-1;if("indicator"===s)if(o.indicatorsAsCol){const t=o.getCellHeaderPaths(n.rowHeaderLevelCount-1,e),r=null===(i=t.rowHeaderPaths)||void 0===i?void 0:i[t.rowHeaderPaths.length-1];l=null==r?void 0:r.dimensionKey,h=null==r?void 0:r.value}else a=o.getIndicatorKey(n.rowHeaderLevelCount,e);else if("indicatorGroup"===s){const t=n.internalProps.layoutMap,i=t.getCellHeaderPaths(n.rowHeaderLevelCount,e),o=t.getHeadNodeByRowOrColDimensions(i.rowHeaderPaths.slice(0,i.rowHeaderPaths.length-1));d=o.startInTotal+n.frozenRowCount,c=o.startInTotal+n.frozenRowCount+o.size-1}const u=[{startCol:t.proxy.colStart,endCol:t.proxy.colEnd}];n.frozenColCount&&u.push({startCol:0,endCol:n.frozenColCount-1}),n.rightFrozenColCount&&u.push({startCol:n.colCount-n.rightFrozenColCount,endCol:n.colCount-1}),u.forEach((i=>{let{startCol:u,endCol:g}=i;for(let i=u;i<=g;i++)if("row"===s){const o=t.highPerformanceGetCell(i,e);if("cell"!==o.role)continue;if(CP(o,n.getColWidth(o.col),n.getRowHeight(o.row)),"adaptive"===n.heightMode&&e<n.rowCount-1){const o=t.highPerformanceGetCell(i,e+1);CP(o,n.getColWidth(o.col),n.getRowHeight(o.row))}}else for(let e=d;e<=c;e++){if("indicator"===s){const t=o.getIndicatorKey(r.table.rowHeaderLevelCount,e);if(!o.indicatorsAsCol&&t!==a)continue;if(o.indicatorsAsCol){const t=o.getCellHeaderPaths(r.table.rowHeaderLevelCount-1,e),i=null==t?void 0:t.rowHeaderPaths[t.rowHeaderPaths.length-1];if(!i||l!==i.dimensionKey||h!==i.value)continue}}const d=t.highPerformanceGetCell(i,e);"cell"===d.role&&CP(d,n.getColWidth(d.col),n.getRowHeight(d.row))}}))}(this,t)}updateChartState(t){this.table.isPivotChart()&&function(t,e){const i=t.table;if(i.isPivotChart()){const n=i._selectedDataItemsInChart.length;if((null===e||0===(null==e?void 0:e.length)||0===Object.keys(e).length)&&0===n)return;const o=[];if(Array.isArray(e))e.forEach((t=>{if(t&&0!==t.key&&Object.keys(t).length>0){const e={};for(const i in t)i.startsWith("VGRAMMAR_")||i.startsWith("__VCHART")||(e[i]=t[i]);o.push(e)}}));else if(e&&0!==e.key&&Object.keys(e).length>0){const t={};for(const i in e)i.startsWith("VGRAMMAR_")||i.startsWith("__VCHART")||(t[i]=e[i]);o.push(t)}fw(i._selectedDataItemsInChart,o)||(i._selectedDataItemsInChart=o,i.internalProps.layoutMap.updateDataStateToChartInstance(),yP(t),i.scenegraph.updateNextFrame())}}(this,t)}updateCheckboxCellState(t,e,i){var n,o;if(this.table.transpose)null===(n=this.bodyGroup.children)||void 0===n||n.forEach((t=>{var n;null===(n=t.getChildAt(e))||void 0===n||n.getChildren().forEach((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i))),"checkbox-content"===t.name&&("indeterminate"===i?(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",!0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",void 0)):(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",void 0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",i)))}))}));else{const e=this.getColGroup(t);null===(o=null==e?void 0:e.children)||void 0===o||o.forEach((t=>{t.getChildren().find((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i))),"checkbox-content"===t.name&&("indeterminate"===i?(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",!0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",void 0)):(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",void 0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",i)))}))}))}}updateHeaderCheckboxCellState(t,e,i){var n,o;this.table.transpose?null===(n=this.rowHeaderGroup.children)||void 0===n||n.forEach((t=>{t.getChildAt(e).getChildren().forEach((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i))),"checkbox-content"===t.name&&("indeterminate"===i?(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",!0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",void 0)):(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",void 0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",i)))}))})):null===(o=this.getColGroup(t,!0).children)||void 0===o||o.forEach((t=>{t.getChildren().find((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i))),"checkbox-content"===t.name&&("indeterminate"===i?(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",!0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",void 0)):(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",void 0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",i)))}))}))}updateAutoColWidth(t){this.table.internalProps._widthResizedColMap.delete(t);const e=this.table.getColWidth(t),i=JM(t,0,this.table.rowCount-1,this.table,!0);i!==e&&this.updateColWidth(t,i-e)}recalculateColWidths(){const t=this.table;"adaptive"===t.widthMode||t.autoFillWidth||t.internalProps.transpose?ZM(this.table,0,this.table.colCount-1,!0):(t._clearColRangeWidthsMap(),t.frozenColCount>0&&ZM(this.table,0,t.frozenColCount-1,!0),t.rightFrozenColCount>0&&ZM(this.table,t.rightFrozenColCount,t.colCount-1,!0),ZM(t,this.proxy.colStart,this.proxy.colEnd,!0))}recalculateRowHeights(){const t=this.table;t.internalProps.useOneRowHeightFillAll=!1,"adaptive"===t.heightMode||t.autoFillHeight?pk(this.table,0,this.table.rowCount-1,!0,!0):(t.frozenRowCount>0&&pk(this.table,0,t.frozenRowCount-1,!0,!0),t.bottomFrozenRowCount>0&&pk(this.table,t.bottomFrozenRowCount,t.rowCount-1,!0,!0),pk(t,this.proxy.rowStart,this.proxy.rowEnd,!0,!0))}resize(){this.proxy.resize(),("adaptive"===this.table.widthMode||this.table.autoFillWidth)&&(0===this.table.internalProps._widthResizedColMap.size?this.recalculateColWidths():this.dealWidthMode()),"adaptive"===this.table.heightMode?0===this.table.internalProps._heightResizedRowMap.size?this.recalculateRowHeights():this.dealHeightMode():this.table.autoFillHeight&&this.dealHeightMode(),this.resetFrozen(),this.updateTableSize(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),("adaptive"===this.table.widthMode||"adaptive"===this.table.heightMode||this.table.autoFillWidth||this.table.autoFillHeight)&&this.updateChartSizeForResizeColWidth(-1),this.proxy.progress(),this.updateNextFrame()}updateTableSize(){var t,e,i,n,o,r,s,a,l,h,d,c,u;if(this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:Math.min(this.table.tableNoFrameWidth,Math.max(this.colHeaderGroup.attribute.width,this.bodyGroup.attribute.width,this.bottomFrozenGroup.attribute.width,0)+Math.max(this.cornerHeaderGroup.attribute.width,this.rowHeaderGroup.attribute.width,this.leftBottomCornerGroup.attribute.width,0)+Math.max(this.rightTopCornerGroup.attribute.width,this.rightFrozenGroup.attribute.width,this.rightBottomCornerGroup.attribute.width,0)),height:Math.min(this.table.tableNoFrameHeight,Math.max(this.colHeaderGroup.attribute.height,this.cornerHeaderGroup.attribute.height,this.rightTopCornerGroup.attribute.height,0)+Math.max(this.rowHeaderGroup.attribute.height,this.bodyGroup.attribute.height,this.rightFrozenGroup.attribute.height,0)+Math.max(this.leftBottomCornerGroup.attribute.height,this.bottomFrozenGroup.attribute.height,this.rightBottomCornerGroup.attribute.height,0))}),this.tableGroup.border){const g=null===(t=this.tableGroup.border)||void 0===t?void 0:t.attribute;let p,f,v,b;(null==g?void 0:g.strokeArrayWidth)?(p=g.strokeArrayWidth?g.strokeArrayWidth[0]:null!==(e=g.lineWidth)&&void 0!==e?e:0,f=g.strokeArrayWidth?g.strokeArrayWidth[1]:null!==(i=g.lineWidth)&&void 0!==i?i:0,v=g.strokeArrayWidth?g.strokeArrayWidth[2]:null!==(n=g.lineWidth)&&void 0!==n?n:0,b=g.strokeArrayWidth?g.strokeArrayWidth[3]:null!==(o=g.lineWidth)&&void 0!==o?o:0):(p=null!==(r=null==g?void 0:g.lineWidth)&&void 0!==r?r:0,f=null!==(s=null==g?void 0:g.lineWidth)&&void 0!==s?s:0,v=null!==(a=null==g?void 0:g.lineWidth)&&void 0!==a?a:0,b=null!==(l=null==g?void 0:g.lineWidth)&&void 0!==l?l:0),"rect"===this.tableGroup.border.type?(null===(h=this.table.theme.frameStyle)||void 0===h?void 0:h.innerBorder)?this.tableGroup.border.setAttributes({x:this.table.tableX+b/2,y:this.table.tableY+p/2,width:this.tableGroup.attribute.width-b/2-f/2,height:this.tableGroup.attribute.height-p/2-v/2}):this.tableGroup.border.setAttributes({x:this.table.tableX-b/2,y:this.table.tableY-p/2,width:this.tableGroup.attribute.width+b/2+f/2,height:this.tableGroup.attribute.height+p/2+v/2}):"group"===this.tableGroup.border.type&&((null===(d=this.table.theme.frameStyle)||void 0===d?void 0:d.innerBorder)?(this.tableGroup.border.setAttributes({x:this.table.tableX+b/2,y:this.table.tableY+p/2,width:this.tableGroup.attribute.width-b/2-f/2,height:this.tableGroup.attribute.height-p/2-v/2}),null===(c=this.tableGroup.border.firstChild)||void 0===c||c.setAttributes({x:0,y:0,width:this.tableGroup.attribute.width-b/2-f/2,height:this.tableGroup.attribute.height-p/2-v/2})):(this.tableGroup.border.setAttributes({x:this.table.tableX-b/2,y:this.table.tableY-p/2,width:this.tableGroup.attribute.width+b/2+f/2,height:this.tableGroup.attribute.height+p/2+v/2}),null===(u=this.tableGroup.border.firstChild)||void 0===u||u.setAttributes({x:b/2,y:p/2,width:this.tableGroup.attribute.width,height:this.tableGroup.attribute.height})))}this.table.bottomFrozenRowCount>0&&(this.bottomFrozenGroup.setAttribute("y",this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight()),this.leftBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight(),width:this.table.getFrozenColsWidth()}),this.rightBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight()})),this.table.rightFrozenColCount>0&&(this.rightFrozenGroup.setAttribute("x",this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth()),this.rightTopCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth(),height:this.table.getFrozenRowsHeight()}),this.rightBottomCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth()})),this.updateDomContainer()}updateRowHeight(t,e,i){xk(this,t,e=Math.round(e),i),this.updateContainerHeight(t,e)}updateRowsHeight(t,e,i){for(let n=0;n<t.length;n++){const o=t[n];if(o>=this.proxy.rowStart&&o<=this.proxy.rowEnd){const t=e[n];xk(this,o,Math.round(t),i),this._updateContainerHeight(o,t)}}this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}updateContainerWidth(t,e){t<this.frozenColCount?(this.rowHeaderGroup.setDeltaWidth(e),this.cornerHeaderGroup.setDeltaWidth(e),this.colHeaderGroup.setDeltaX(e),this.bodyGroup.setDeltaX(e)):(this.colHeaderGroup.setDeltaWidth(e),this.bodyGroup.setDeltaWidth(e)),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}_updateContainerHeight(t,e){t<this.table.frozenRowCount?(this.colHeaderGroup.setDeltaHeight(e),this.cornerHeaderGroup.setDeltaHeight(e),this.rowHeaderGroup.setDeltaY(e),this.bodyGroup.setDeltaY(e),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaY(e)):t>=this.table.rowCount-this.table.bottomFrozenRowCount?(this.leftBottomCornerGroup.setDeltaHeight(e),this.bottomFrozenGroup.setDeltaHeight(e),this.table.rightFrozenColCount&&this.rightBottomCornerGroup.setDeltaHeight(e)):(this.rowHeaderGroup.setDeltaHeight(e),this.bodyGroup.setDeltaHeight(e),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaHeight(e))}updateContainerHeight(t,e){this._updateContainerHeight(t,e),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}setColWidth(t,e){const i=this.table.getColWidth(t);i!==e&&(this.updateColWidth(t,e-i),this.table._clearColRangeWidthsMap(t))}setRowHeight(t,e){const i=this.table.getRowHeight(t);i!==e&&((t>=this.proxy.rowStart&&t<=this.proxy.rowEnd||t>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<=this.table.rowCount-1||t<this.table.frozenRowCount)&&this.updateRowHeight(t,e-i),this.table._clearRowRangeHeightsMap(t))}setX(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.table.scenegraph.proxy.setX(-t,e)}setY(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.table.scenegraph.proxy.setY(-t,e)}setBodyAndRowHeaderY(t){var e,i,n,o,r,s;const a=null!==(i=null===(e=this.bodyGroup.firstChild)||void 0===e?void 0:e.firstChild)&&void 0!==i?i:null===(n=this.rowHeaderGroup.firstChild)||void 0===n?void 0:n.firstChild,l=null!==(r=null===(o=this.bodyGroup.firstChild)||void 0===o?void 0:o.lastChild)&&void 0!==r?r:null===(s=this.rowHeaderGroup.firstChild)||void 0===s?void 0:s.lastChild;0===t&&a&&a.row===this.table.frozenRowCount&&a.attribute.y+t<0?t=-a.attribute.y:l&&this.table.tableNoFrameHeight<this.table.getAllRowsHeight()&&l.row===this.table.rowCount-this.table.bottomFrozenRowCount-1&&l.attribute.y+l.attribute.height+t<this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()&&(t=this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()-l.attribute.y-l.attribute.height),this.colHeaderGroup.attribute.height+t!==this.bodyGroup.attribute.y&&(this.bodyGroup.setAttribute("y",this.colHeaderGroup.attribute.height+t),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height+t),this.table.rightFrozenColCount>0&&this.rightFrozenGroup.setAttribute("y",this.rightTopCornerGroup.attribute.height+t),this.updateNextFrame())}setBodyAndColHeaderX(t){const e=this.bodyGroup.firstChild,i=this.bodyGroup.lastChild;0===t&&e&&e.col===this.table.frozenColCount&&e.attribute.x+t<0?t=-e.attribute.x:i&&this.table.tableNoFrameWidth<this.table.getAllColsWidth()&&i.col===this.table.colCount-this.table.rightFrozenColCount-1&&i.attribute.x+i.attribute.width+t<this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()&&(t=this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()-i.attribute.x-i.attribute.width),this.table.getFrozenColsWidth()+t!==this.bodyGroup.attribute.x&&(this.bodyGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.colHeaderGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.table.bottomFrozenRowCount>0&&this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.updateNextFrame())}afterScenegraphCreated(){this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount?this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):this.component.setFrozenColumnShadow(-1):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.table.stateManager.checkFrozen(),this.updateContainer(),this.createFrameBorder(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),HL(this.table),this.table.options.animationAppear&&function(t){var e,i,n,o;if(!t.options.animationAppear)return;let r,s,a,l;!0===t.options.animationAppear?(r=500,s=0,a="one-by-one",l="column"):(r=null!==(e=t.options.animationAppear.duration)&&void 0!==e?e:500,s=null!==(i=t.options.animationAppear.delay)&&void 0!==i?i:0,a=null!==(n=t.options.animationAppear.type)&&void 0!==n?n:"one-by-one",l=null!==(o=t.options.animationAppear.direction)&&void 0!==o?o:"row");const{scenegraph:h,frozenColCount:d,frozenRowCount:c}=t,{colStart:u,colEnd:g,rowStart:p,rowEnd:f}=h.proxy;for(let t=0;t<=g;t++)for(let e=0;e<=f;e++){const i=h.highPerformanceGetCell(t,e);i&&"cell"===i.role&&i.forEachChildren((i=>{i.setAttribute("opacity",0),i.animate().wait("one-by-one"===a?("row"===l?e:t)*(r-s):s).to({opacity:1},r,"linear")}))}}(this.table),this.updateNextFrame()}dealWidthMode(){const t=this.table;if("adaptive"===t.widthMode){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,n=0,o=t.colCount;if("only-body"===t.widthAdaptiveMode){for(let e=0;e<t.colCount;e++)(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=t.getColWidth(e));n=t.rowHeaderLevelCount,o=t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount}nL(e-i,n,o,!1,[],t,!0)}else if(t.autoFillWidth){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,n=0;for(let e=0;e<t.colCount;e++){const o=t.getColWidth(e);(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=o),n+=o}n<e&&n>i&&nL(e-i,t.rowHeaderLevelCount,t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount,!1,[],t,!0)}let e=0;this.bodyGroup.forEachChildrenSkipChild((t=>{e+=t.attribute.width})),this.bodyGroup.setAttribute("width",e);let i=0;this.colHeaderGroup.forEachChildrenSkipChild((t=>{i+=t.attribute.width})),this.colHeaderGroup.setAttribute("width",i);let n=0;this.rowHeaderGroup.forEachChildrenSkipChild((t=>{n+=t.attribute.width})),this.rowHeaderGroup.setAttribute("width",n);let o=0;this.cornerHeaderGroup.forEachChildrenSkipChild((t=>{o+=t.attribute.width})),this.cornerHeaderGroup.setAttribute("width",o),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height),this.bodyGroup.setAttributes({x:this.rowHeaderGroup.attribute.width,y:this.colHeaderGroup.attribute.height})}dealHeightMode(){var t;const e=this.table;if("adaptive"===e.heightMode){e._clearRowRangeHeightsMap();const t=e.getRowsHeight(0,e.columnHeaderLevelCount-1),i=e.isPivotChart()?e.getBottomFrozenRowsHeight():0,n=e.tableNoFrameHeight-t-i,o=e.columnHeaderLevelCount,r=e.isPivotChart()?e.rowCount-e.bottomFrozenRowCount:e.rowCount;let s=0;for(let t=o;t<r;t++)s+=e.getRowHeight(t);const a=n/s;for(let t=o;t<r;t++){let i;i=t===r-1?n-e.getRowsHeight(o,r-2):Math.round(e.getRowHeight(t)*a),this.setRowHeight(t,i)}}else if(e.autoFillHeight){e._clearRowRangeHeightsMap();const i=e.tableNoFrameHeight;let n=0,o=0;for(let t=0;t<e.rowCount;t++){const i=e.getRowHeight(t);(t<e.columnHeaderLevelCount||e.isPivotChart()&&t>=e.rowCount-e.bottomFrozenRowCount)&&(o+=i),n+=i}if((null!==(t=this._dealAutoFillHeightOriginRowsHeight)&&void 0!==t?t:n)<i&&n-o>0){const t=e.columnHeaderLevelCount,r=e.isPivotChart()?e.rowCount-e.bottomFrozenRowCount:e.rowCount,s=(i-o)/(n-o);for(let n=t;n<r;n++){let a;a=n===r-1?i-o-e.getRowsHeight(t,r-2):Math.round(e.getRowHeight(n)*s),this.setRowHeight(n,a)}}}}dealFrozen(){!function(t){var e,i,n,o;if(t.table.frozenColCount>t.table.rowHeaderLevelCount){t.rowHeaderGroup.setAttribute("height",t.bodyGroup.attribute.height),t.rowHeaderGroup.setAttribute("y",t.bodyGroup.attribute.y),t.cornerHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height);for(let e=0;e<t.table.frozenColCount-t.table.rowHeaderLevelCount;e++)rP(t),sP(t),hP(t)}else if(t.table.frozenColCount<t.table.rowHeaderLevelCount){t.bodyGroup.setAttribute("height",t.rowHeaderGroup.attribute.height),t.bodyGroup.setAttribute("y",t.rowHeaderGroup.attribute.y),t.colHeaderGroup.setAttribute("height",t.cornerHeaderGroup.attribute.height);for(let e=0;e<t.table.rowHeaderLevelCount-t.table.frozenColCount;e++)aP(t),lP(t),dP(t)}t.bodyGroup.setAttribute("x",t.rowHeaderGroup.attribute.width),t.colHeaderGroup.setAttribute("x",t.cornerHeaderGroup.attribute.width),t.updateContainer(),t.updateBorderSizeAndPosition(),t.isPivot||t.table.transpose?t.table.options.frozenColCount?t.component.setFrozenColumnShadow(t.table.frozenColCount-1):t.table.options.frozenColCount&&t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount):(t.component.setFrozenColumnShadow(t.table.frozenColCount-1),t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount)),t.hasFrozen=!0,t.frozenColCount=t.table.frozenColCount,t.frozenRowCount=null!==(o=null!==(i=null===(e=t.colHeaderGroup.firstChild)||void 0===e?void 0:e.childrenCount)&&void 0!==i?i:null===(n=t.cornerHeaderGroup.firstChild)||void 0===n?void 0:n.childrenCount)&&void 0!==o?o:t.table.frozenRowCount}(this)}resetFrozen(){!function(t){var e,i,n,o,r,s;if(t.frozenColCount>t.table.frozenColCount){t.bodyGroup.setAttribute("height",t.rowHeaderGroup.attribute.height),t.bodyGroup.setAttribute("y",t.rowHeaderGroup.attribute.y),t.colHeaderGroup.setAttribute("height",t.cornerHeaderGroup.attribute.height);for(let e=0;e<t.frozenColCount-t.table.frozenColCount;e++)aP(t),lP(t),dP(t)}else if(t.frozenColCount<t.table.frozenColCount){t.rowHeaderGroup.setAttribute("height",t.bodyGroup.attribute.height),t.rowHeaderGroup.setAttribute("y",t.bodyGroup.attribute.y),t.cornerHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height);for(let e=0;e<t.table.frozenColCount-t.frozenColCount;e++)rP(t),sP(t),hP(t)}oP(t),t.recreateAllSelectRangeComponents(),t.frozenColCount=t.table.frozenColCount,t.frozenRowCount=null!==(o=null!==(i=null===(e=t.colHeaderGroup.firstChild)||void 0===e?void 0:e.childrenCount)&&void 0!==i?i:null===(n=t.cornerHeaderGroup.firstChild)||void 0===n?void 0:n.childrenCount)&&void 0!==o?o:t.table.frozenRowCount,t.proxy.colStart=null!==(s=null===(r=t.bodyGroup.firstChild)||void 0===r?void 0:r.col)&&void 0!==s?s:t.table.frozenColCount,t.bodyGroup.setAttribute("x",t.rowHeaderGroup.attribute.width),t.colHeaderGroup.setAttribute("x",t.cornerHeaderGroup.attribute.width),t.updateContainer(),t.updateBorderSizeAndPosition(),t.isPivot||t.table.transpose?t.table.options.frozenColCount?t.component.setFrozenColumnShadow(t.table.frozenColCount-1):t.table.options.rightFrozenColCount&&t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount):(t.component.setFrozenColumnShadow(t.table.frozenColCount-1),t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount)),t.hasFrozen=!0}(this)}resetRowFrozen(){!function(t){var e,i,n,o,r;if(t.frozenRowCount>t.table.frozenRowCount){t.bodyGroup.setAttribute("width",t.colHeaderGroup.attribute.width),t.bodyGroup.setAttribute("x",t.colHeaderGroup.attribute.x),t.rowHeaderGroup.setAttribute("width",t.cornerHeaderGroup.attribute.width);for(let e=0;e<t.frozenRowCount-t.table.frozenRowCount;e++)fP(t),vP(t),bP(t)}else if(t.frozenRowCount<t.table.frozenRowCount){t.colHeaderGroup.setAttribute("width",t.bodyGroup.attribute.width),t.colHeaderGroup.setAttribute("x",t.bodyGroup.attribute.x),t.cornerHeaderGroup.setAttribute("width",t.rowHeaderGroup.attribute.width);for(let e=0;e<t.table.frozenRowCount-t.frozenRowCount;e++)uP(t),gP(t),pP(t)}oP(t),t.recreateAllSelectRangeComponents(),t.frozenRowCount=t.table.frozenRowCount,t.frozenColCount=null!==(i=null===(e=t.rowHeaderGroup)||void 0===e?void 0:e.childrenCount)&&void 0!==i?i:0,t.proxy.rowStart=null!==(r=null===(o=null===(n=t.bodyGroup.firstChild)||void 0===n?void 0:n.firstChild)||void 0===o?void 0:o.row)&&void 0!==r?r:t.table.frozenRowCount,t.bodyGroup.setAttribute("y",t.colHeaderGroup.attribute.height),t.rowHeaderGroup.setAttribute("y",t.cornerHeaderGroup.attribute.height),t.updateContainer(),t.updateBorderSizeAndPosition(),t.hasFrozen=!0}(this)}updateCellLayoutWidthCertainWidth(t,e,i){const n=t.attribute.width;let o=!1;return t.forEachChildren(((t,r)=>{r+=e;const s=Z_(this.table,i,r);s?t=this.getCell(s.start.col,s.start.row):t.setAttribute("width",n);const a=UB(AR("padding",this.table._getCellStyle(i,r),i,r,this.table)),l=t.getChildByName("text");let h=0,d=0;if(l)h=l.AABBBounds.height()+(a[0]+a[2]),l.setAttribute("maxLineWidth",n-(a[1]+a[3])),d=l.AABBBounds.height()+(a[0]+a[2]);else{const e=t.getChildAt(1);h=e.AABBBounds.height()+(a[0]+a[2]),e._cellWidth=n-(a[1]+a[3]),e.layout(),d=e.AABBBounds.height()+(a[0]+a[2])}const c=this.table.getRowHeight(r);t.attribute.height!==d&&(t.setAttribute("height",d),(c===h||d>c)&&(o=!0))})),o}updateHeaderPosition(t,e,i,n,o){!function(t,e,i,n,o,r){const s=r.scenegraph;for(let i=t;i<=e;i++){const t=r.getColWidth(i),e=r.scenegraph.getColGroup(i,!0),n=r.scenegraph.getColGroup(i),o=r.scenegraph.getColGroupInBottom(i),s=r.scenegraph.getColGroupInLeftBottomCorner(i),a=r.scenegraph.getColGroupInRightBottomCorner(i);e&&(e.setAttribute("width",t),e.forEachChildren((e=>{e.setAttribute("width",t)}))),n&&(n.setAttribute("width",t),n.forEachChildren((e=>{e.setAttribute("width",t)}))),o&&(o.setAttribute("width",t),o.forEachChildren((e=>{e.setAttribute("width",t)}))),a&&(a.setAttribute("width",t),a.forEachChildren((e=>{e.setAttribute("width",t)}))),s&&(s.setAttribute("width",t),s.forEachChildren((e=>{e.setAttribute("width",t)})))}if(s.updateContainer(),"column"===o)for(let i=t;i<=e;i++){const t=r.scenegraph.getColGroup(i);null==t||t.setAttribute("chartInstance",void 0);for(let t=0;t<=r.frozenRowCount-1;t++)s.updateCellContent(i,t);for(let t=s.bodyRowStart;t<=s.bodyRowEnd;t++)s.updateCellContent(i,t);for(let t=r.rowCount-r.bottomFrozenRowCount;t<=r.rowCount-1;t++)s.updateCellContent(i,t)}else{for(let t=0;t<=r.frozenColCount-1;t++){const e=r.scenegraph.getColGroup(t);null==e||e.setAttribute("chartInstance",void 0);for(let e=i;e<=n;e++)s.updateCellContent(t,e)}for(let t=s.bodyColStart;t<=s.bodyColEnd;t++){const e=r.scenegraph.getColGroup(t);null==e||e.setAttribute("chartInstance",void 0);for(let e=i;e<=n;e++)s.updateCellContent(t,e)}for(let t=r.colCount-r.rightFrozenColCount;t<=r.colCount-1;t++){const e=r.scenegraph.getColGroup(t);null==e||e.setAttribute("chartInstance",void 0);for(let e=i;e<=n;e++)s.updateCellContent(t,e)}}}(t,e,i,n,o,this.table)}updateContainerAttrWidthAndX(){var t,e,i;const n=xP(this.cornerHeaderGroup,0),o=xP(this.rowHeaderGroup,0),r=this.colHeaderGroup.hasChildNodes()&&this.colHeaderGroup.firstChild?xP(this.colHeaderGroup,this.colHeaderGroup.firstChild.col>0?this.table.getColsWidth(null!==(t=this.table.frozenColCount)&&void 0!==t?t:0,this.colHeaderGroup.firstChild.col-1):0):0,s=this.bodyGroup.hasChildNodes()&&this.bodyGroup.firstChild?xP(this.bodyGroup,this.bodyGroup.firstChild.col>0?this.table.getColsWidth(null!==(e=this.table.frozenColCount)&&void 0!==e?e:0,this.bodyGroup.firstChild.col-1):0):0,a=xP(this.rightFrozenGroup.childrenCount>0?this.rightFrozenGroup:this.rightTopCornerGroup,0);this.bottomFrozenGroup.hasChildNodes()&&this.bottomFrozenGroup.firstChild&&xP(this.bottomFrozenGroup,this.bottomFrozenGroup.firstChild.col>0?this.table.getColsWidth(null!==(i=this.table.frozenColCount)&&void 0!==i?i:0,this.bottomFrozenGroup.firstChild.col-1):0),xP(this.leftBottomCornerGroup,0),xP(this.rightTopCornerGroup,0),xP(this.rightBottomCornerGroup,0),this.cornerHeaderGroup.setDeltaWidth(n-this.cornerHeaderGroup.attribute.width),this.leftBottomCornerGroup.setDeltaWidth(n-this.leftBottomCornerGroup.attribute.width),this.colHeaderGroup.setDeltaWidth(r-this.colHeaderGroup.attribute.width),this.rowHeaderGroup.setDeltaWidth(o-this.rowHeaderGroup.attribute.width),this.bottomFrozenGroup.setDeltaWidth(r-this.bottomFrozenGroup.attribute.width),this.rightFrozenGroup.setDeltaWidth(a-this.rightFrozenGroup.attribute.width),this.rightTopCornerGroup.setDeltaWidth(a-this.rightTopCornerGroup.attribute.width),this.rightBottomCornerGroup.setDeltaWidth(a-this.rightBottomCornerGroup.attribute.width),this.bodyGroup.setDeltaWidth(s-this.bodyGroup.attribute.width),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()),this.bodyGroup.setAttribute("x",this.rowHeaderGroup.attribute.width)}updateContainer(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._needUpdateContainer||(this._needUpdateContainer=!0,setTimeout((()=>{this.updateContainerSync()}),0)):(this._needUpdateContainer=!0,this.updateContainerSync())}updateContainerSync(){this._needUpdateContainer&&(this._needUpdateContainer=!1,this.updateContainerAttrWidthAndX(),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame())}updateCellContentWhileResize(t,e){var i;const n=(null===(i=this.table.getCellRawRecord(t,e))||void 0===i?void 0:i.vtableMerge)?"text":this.table.isHeader(t,e)?this.table._getHeaderLayoutMap(t,e).headerType:this.table.getBodyColumnType(t,e),o=this.getCell(t,e);"image"!==n&&"video"!==n||DR(o,t,e,0,0,this.table)}createFrameBorder(){var t,e,i,n,o;this.updateTableSize();const r=!this.isPivot&&!this.table.internalProps.transpose;Yk(this.bodyGroup,this.table.theme.bodyStyle.frameStyle,this.bodyGroup.role,r?[!0,!0,!0,!1]:void 0),Yk(this.rowHeaderGroup,this.isPivot||this.table.internalProps.transpose?this.table.theme.rowHeaderStyle.frameStyle:this.table.theme.bodyStyle.frameStyle,this.rowHeaderGroup.role,r?[!0,!1,!0,!0]:void 0),Yk(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle,this.colHeaderGroup.role,r?[!0,!0,!0,!1]:void 0),Yk(this.cornerHeaderGroup,this.isPivot?this.table.theme.cornerHeaderStyle.frameStyle:this.table.theme.headerStyle.frameStyle,this.cornerHeaderGroup.role,r?[!0,!1,!0,!0]:void 0),(null===(t=this.table.theme.cornerLeftBottomCellStyle)||void 0===t?void 0:t.frameStyle)&&Yk(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle.frameStyle,this.leftBottomCornerGroup.role,r?[!0,!1,!0,!0]:void 0),(null===(e=this.table.theme.bottomFrozenStyle)||void 0===e?void 0:e.frameStyle)&&Yk(this.bottomFrozenGroup,this.table.theme.bottomFrozenStyle.frameStyle,this.bottomFrozenGroup.role,r?[!0,!0,!0,!1]:void 0),(null===(i=this.table.theme.rightFrozenStyle)||void 0===i?void 0:i.frameStyle)&&Yk(this.rightFrozenGroup,this.table.theme.rightFrozenStyle.frameStyle,this.rightFrozenGroup.role,void 0),(null===(n=this.table.theme.cornerRightTopCellStyle)||void 0===n?void 0:n.frameStyle)&&Yk(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle.frameStyle,this.rightTopCornerGroup.role,void 0),(null===(o=this.table.theme.cornerRightBottomCellStyle)||void 0===o?void 0:o.frameStyle)&&Yk(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle.frameStyle,this.rightBottomCornerGroup.role,void 0),Yk(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0)}getResizeColAt(t,e,i){const n=this.table.theme.columnResize.resizeHotSpotSize/2;let o;if(!i){const i=this.table.getDrawRange();return e>=i.top&&e<=i.bottom&&(o=this.table.getCellAtRelativePosition(t-n,e),o.col===this.table.colCount-1)?o:{col:-1,row:-1}}return i.stage?(t<i.globalAABBBounds.x1+n?o={col:i.col-1,row:i.row,x:i.globalAABBBounds.x1}:i.globalAABBBounds.x2-n<t&&(o={col:i.col,row:i.row,x:i.globalAABBBounds.x2}),o&&this.table.rightFrozenColCount>0&&o.col>=this.table.colCount-this.table.rightFrozenColCount-1&&this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()+this.table.scrollLeft<this.bodyGroup.attribute.width&&(o.col=o.col+1,o.rightFrozen=!0),o||{col:-1,row:-1}):{col:-1,row:-1}}getResizeRowAt(t,e,i){const n=this.table.theme.columnResize.resizeHotSpotSize/2;if(i){let t;if(e<i.globalAABBBounds.y1+n?t={col:i.col,row:i.row-1,y:i.globalAABBBounds.y1}:i.globalAABBBounds.y2-n<e&&(t={col:i.col,row:i.row,y:i.globalAABBBounds.y2}),t&&this.table.bottomFrozenRowCount>0&&t.row>=this.table.rowCount-this.table.bottomFrozenRowCount-1&&this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()+this.table.scrollTop<this.bodyGroup.attribute.height&&(t.row=t.row+1,t.bottomFrozen=!0),t)return t}return{col:-1,row:-1}}updateFrozen(){this.clear||(this.resetFrozen(),this.component.updateScrollBar())}updateRowFrozen(){this.clear||(this.resetRowFrozen(),this.component.updateScrollBar())}dealWidthRightFrozen(t){this.clear?this.table.internalProps.rightFrozenColCount=t:function(t,e){const{table:i,proxy:n,rightTopCornerGroup:o,rightFrozenGroup:r,rightBottomCornerGroup:s,bottomFrozenGroup:a,bodyGroup:l,colHeaderGroup:h}=e,d=e.table.rightFrozenColCount;if(t>d){for(let n=i.colCount-d-1;n>=i.colCount-t;n--)cP(r,e.getColGroup(n),r.firstChild),cP(o,e.getColGroup(n,!0),o.firstChild),cP(s,e.getColGroupInBottom(n),s.firstChild);let n=0;r.forEachChildren((t=>{t.setAttribute("x",n),n+=t.attribute.width})),n=0,o.forEachChildren((t=>{t.setAttribute("x",n),n+=t.attribute.width})),n=0,s.forEachChildren((t=>{t.setAttribute("x",n),n+=t.attribute.width}))}else if(t<d){for(let n=i.colCount-d;n<i.colCount-t;n++){const t=e.getColGroup(n);t.setAttribute("x",l.lastChild.attribute.x+i.getColWidth(l.lastChild.col)),l.appendChild(t);const o=e.getColGroupInRightTopCorner(n);o.setAttribute("x",h.lastChild.attribute.x+i.getColWidth(h.lastChild.col)),h.appendChild(o);const r=e.getColGroupInRightBottomCorner(n);r.setAttribute("x",a.lastChild.attribute.x+i.getColWidth(a.lastChild.col)),a.appendChild(r)}let n=0;r.forEachChildren((t=>{t.setAttribute("x",n),n+=t.attribute.width})),n=0,o.forEachChildren((t=>{t.setAttribute("x",n),n+=t.attribute.width})),n=0,s.forEachChildren((t=>{t.setAttribute("x",n),n+=t.attribute.width}))}r.setAttribute("width",i.getColsWidth(i.colCount-t,i.colCount-1)),o.setAttribute("width",i.getColsWidth(i.colCount-t,i.colCount-1)),s.setAttribute("width",i.getColsWidth(i.colCount-t,i.colCount-1)),i.internalProps.rightFrozenColCount=t,e.updateContainer(),e.component.updateScrollBar(),e.updateNextFrame()}(t,this)}dealWidthBottomFrozen(t){this.clear?this.table.internalProps.bottomFrozenRowCount=t:function(t,e){const{table:i,proxy:n,bottomFrozenGroup:o,leftBottomCornerGroup:r,rightBottomCornerGroup:s}=e;o.childrenCount||(n.table.isPivotChart()||(hL(r,0,0,0,i.frozenColCount-1,0,-1,"rowHeader",i),hL(s,0,0,i.colCount-i.rightFrozenColCount,i.colCount-1,0,-1,"body",i)),hL(o,0,0,n.colStart,n.colEnd,0,-1,"body",i));const a=e.table.bottomFrozenRowCount;if(t>a){for(let n=0;n<i.frozenColCount;n++){const o=e.getColGroupInLeftBottomCorner(n);for(let r=i.rowCount-a-1;r>=i.rowCount-t;r--)cP(o,e.getCell(n,r,!0),o.firstChild);let r=0;o.forEachChildren((t=>{t.setAttribute("y",r),r+=i.getRowHeight(t.row)}))}for(let o=n.colStart;o<=n.colEnd;o++){const n=e.getColGroupInBottom(o);for(let r=i.rowCount-a-1;r>=i.rowCount-t;r--)cP(n,e.getCell(o,r,!0),n.firstChild);let r=0;n.forEachChildren((t=>{t.setAttribute("y",r),r+=i.getRowHeight(t.row)}))}if(i.rightFrozenColCount>0)for(let n=i.colCount-i.rightFrozenColCount;n<i.colCount;n++){const o=e.getColGroupInRightBottomCorner(n);for(let r=i.rowCount-a-1;r>=i.rowCount-t;r--)cP(o,e.getCell(n,r,!0),o.firstChild);let r=0;o.forEachChildren((t=>{t.setAttribute("y",r),r+=i.getRowHeight(t.row)}))}}else if(t<a){for(let n=0;n<i.rowHeaderLevelCount;n++){const o=e.getColGroup(n);for(let r=i.rowCount-a;r<i.rowCount-t;r++){const t=e.getCell(n,r,!0);t.setAttribute("y",o.lastChild.attribute.y+i.getRowHeight(o.lastChild.row)),o.appendChild(t)}const r=e.getColGroupInLeftBottomCorner(n);let s=0;r.forEachChildren((t=>{t.setAttribute("y",s),s+=i.getRowHeight(t.row)}))}for(let o=n.colStart;o<=n.colEnd;o++){const n=e.getColGroup(o);for(let r=i.rowCount-a;r<i.rowCount-t;r++){const t=e.getCell(o,r,!0);t.setAttribute("y",n.lastChild.attribute.y+i.getRowHeight(n.lastChild.row)),n.appendChild(t)}const r=e.getColGroupInBottom(o);let s=0;r.forEachChildren((t=>{t.setAttribute("y",s),s+=i.getRowHeight(t.row)}))}if(i.rightFrozenColCount>0)for(let n=i.colCount-i.rightFrozenColCount;n<i.colCount;n++){const o=e.getColGroup(n);for(let r=i.rowCount-a;r<i.rowCount-t;r++){const t=e.getCell(n,r,!0);t.setAttribute("y",o.lastChild.attribute.y+i.getRowHeight(o.lastChild.row)),o.appendChild(t)}const r=e.getColGroupInRightBottomCorner(n);let s=0;r.forEachChildren((t=>{t.setAttribute("y",s),s+=i.getRowHeight(t.row)}))}}o.setAttribute("height",i.getRowsHeight(i.rowCount-t,i.rowCount-1)),r.setAttribute("height",i.getRowsHeight(i.rowCount-t,i.rowCount-1)),s.setAttribute("height",i.getRowsHeight(i.rowCount-t,i.rowCount-1)),i.internalProps.bottomFrozenRowCount=t,e.updateContainer(),e.component.updateScrollBar(),e.updateNextFrame()}(t,this)}updateBorderSizeAndPosition(){this.bodyGroup.border&&(this.bodyGroup.appendChild(this.bodyGroup.border),Zk(this.bodyGroup),this.rowHeaderGroup.attribute.width,Kk(this.bodyGroup,this.table.theme.bodyStyle.frameStyle)),this.colHeaderGroup.border&&(this.colHeaderGroup.appendChild(this.colHeaderGroup.border),Zk(this.colHeaderGroup),this.cornerHeaderGroup.attribute.width,Kk(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle)),this.rowHeaderGroup.border&&(this.rowHeaderGroup.appendChild(this.rowHeaderGroup.border),Zk(this.rowHeaderGroup)),this.cornerHeaderGroup.border&&(this.cornerHeaderGroup.appendChild(this.cornerHeaderGroup.border),Zk(this.cornerHeaderGroup)),this.leftBottomCornerGroup.border&&(this.leftBottomCornerGroup.appendChild(this.leftBottomCornerGroup.border),Zk(this.leftBottomCornerGroup)),this.bottomFrozenGroup.border&&(this.bottomFrozenGroup.appendChild(this.bottomFrozenGroup.border),Zk(this.bottomFrozenGroup)),this.rightFrozenGroup.border&&(this.rightFrozenGroup.appendChild(this.rightFrozenGroup.border),Zk(this.rightFrozenGroup)),this.rightTopCornerGroup.border&&(this.rightTopCornerGroup.appendChild(this.rightTopCornerGroup.border),Zk(this.rightTopCornerGroup)),this.rightBottomCornerGroup.border&&(this.rightBottomCornerGroup.appendChild(this.rightBottomCornerGroup.border),Zk(this.rightBottomCornerGroup)),function(t){if(!t.theme.frameStyle.cornerRadius)return;const e=t.theme.frameStyle.cornerRadius,{cornerHeaderGroup:i,colHeaderGroup:n,rowHeaderGroup:o,bodyGroup:r,rightTopCornerGroup:s,leftBottomCornerGroup:a,rightBottomCornerGroup:l,rightFrozenGroup:h,bottomFrozenGroup:d}=t.scenegraph;i.setAttribute("cornerRadius",0),n.setAttribute("cornerRadius",0),o.setAttribute("cornerRadius",0),r.setAttribute("cornerRadius",0),s.setAttribute("cornerRadius",0),a.setAttribute("cornerRadius",0),l.setAttribute("cornerRadius",0),h.setAttribute("cornerRadius",0),d.setAttribute("cornerRadius",0);const c=s_(e);i.attribute.width>0&&i.attribute.height>0?Jk(i,[c[0],0,0,0]):n.attribute.height>0?Jk(n,[c[0],0,0,0]):o.attribute.width>0?Jk(o,[c[0],0,0,0]):Jk(r,[c[0],0,0,0]),a.attribute.width>0&&a.attribute.height>0?Jk(a,[0,0,0,c[3]]):d.attribute.height>0?Jk(d,[0,0,0,c[3]]):o.attribute.width>0?Jk(o,[0,0,0,c[3]]):Jk(r,[0,0,0,c[3]]),s.attribute.width>0&&s.attribute.height>0?Jk(s,[0,c[1],0,0]):n.attribute.height>0?Jk(n,[0,c[1],0,0]):h.attribute.width>0?Jk(h,[0,c[1],0,0]):Jk(r,[0,c[1],0,0]),l.attribute.width>0&&l.attribute.height>0?Jk(l,[0,0,c[2],0]):h.attribute.width>0?Jk(h,[0,0,c[2],0]):d.attribute.height>0?Jk(d,[0,0,c[2],0]):Jk(r,[0,0,c[2],0])}(this.table)}sortCell(){this.isPivot||(this.table.transpose?this.proxy.sortCellHorizontal():this.proxy.sortCellVertical())}getCellOverflowText(t,e){const i=this.getCell(t,e).getChildByName("text",!0);if(i&&"text"===i.type){if(i.attribute.moreThanMaxCharacters)return this.table.getCellValue(t,e);if(i.cliped)return this.table.getCellValue(t,e)}else if(i&&"richtext"===i.type){const n=i;if(n.attribute.ellipsis&&n._frameCache&&n.attribute.height<n._frameCache.actualHeight)return n.attribute.textConfig.find((t=>t.text)),this.table.getCellValue(t,e)}return null}updateDrill(t,e,i,n,o){this.component.drillIcon.update(t,e,i,n,o,this)}updateCellContent(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.clear)return YR(t,e,this.table,void 0,void 0,i)}setPixelRatio(t){this.stage.disableDirtyBounds(),this.stage.window.setDpr(t),this.stage.render(),this.stage.enableDirtyBounds()}updateRow(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4?arguments[4]:void 0;this.table.internalProps.layoutMap.clearCellRangeMap(),this.table.internalProps.useOneRowHeightFillAll=!1;const r=jx(e.map((t=>t.row))).sort(((t,e)=>t-e)),s=jx(i.map((t=>t.row))).sort(((t,e)=>t-e)),a=this.table.getAllRowsHeight()-[...r,...s].reduce(((t,e)=>t+this.table.getRowHeight(e)),0)<=this.table.tableNoFrameHeight;if(JL(t,e,i,this.table,o),n&&this.recalculateColWidths(),"adaptive"===this.table.heightMode||this.table.autoFillHeight&&(this.table.getAllRowsHeight()<=this.table.tableNoFrameHeight||a))this.table.scenegraph.recalculateRowHeights();else if(this.table.isAutoRowHeight(this.table.columnHeaderLevelCount))for(let t=0;t<s.length;t++){const e=s[t],i=this.table.getRowHeight(e),n=fk(e,0,this.table.colCount-1,this.table);(e>=this.proxy.rowStart&&e<=this.proxy.rowEnd||e>=this.table.rowCount-this.table.bottomFrozenRowCount&&e<=this.table.rowCount-1)&&this.table.scenegraph.updateRowHeight(e,n-i)}this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCol(t,e){RP(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],this.table),this.recalculateColWidths(),this.recalculateRowHeights(),this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCornerHeaderCells(){for(let t=0;t<this.table.frozenColCount;t++)for(let e=0;e<this.table.frozenRowCount;e++)YR(t,e,this.table,!1)}updateRowHeaderCells(){for(let t=0;t<this.table.frozenColCount;t++)for(let e=this.table.frozenRowCount;e<this.table.rowCount;e++)YR(t,e,this.table,!1)}updateColumnHeaderCells(){for(let t=0;t<this.table.frozenRowCount;t++)for(let e=this.table.frozenColCount;e<this.table.colCount;e++)YR(e,t,this.table,!1)}getColumnGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupY(t){return t<this.table.frozenRowCount?this.table.getRowsHeight(0,t-1):t<this.table.rowCount-this.table.bottomFrozenRowCount?this.table.getRowsHeight(this.table.frozenRowCount,t-1):t<this.table.rowCount?this.table.getRowsHeight(this.table.rowCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.rightFrozenColCount,t-1):0}updateDomContainer(){!function(t){const{headerDomContainer:e,bodyDomContainer:i,frozenBodyDomContainer:n,frozenHeaderDomContainer:o,rightFrozenBodyDomContainer:r,rightFrozenHeaderDomContainer:s,bottomDomContainer:a,frozenBottomDomContainer:l,rightFrozenBottomDomContainer:h}=t.internalProps;if(!(e||i||n||o||r||s||a||l||h))return;const d=t.getAllColsWidth(),c=Math.min(d,t.tableNoFrameWidth),u=t.getFrozenColsWidth(),g=t.getRightFrozenColsWidth(),p=u+g,f=Math.min(d-p,c-p),v=t.getAllRowsHeight(),b=Math.min(v,t.tableNoFrameHeight),m=t.getFrozenRowsHeight(),y=t.getBottomFrozenRowsHeight(),C=m+y,w=Math.min(v-C,b-C);t.frozenColCount>0?(e.style.left=`${t.tableX+u}px`,i.style.left=`${t.tableX+u}px`,a.style.left=`${t.tableX+u}px`):0===t.frozenColCount&&(e.style.left=`${t.tableX}px`,i.style.left=`${t.tableX}px`,a.style.left=`${t.tableX}px`),n.style.left=`${t.tableX}px`,o.style.left=`${t.tableX}px`,e.style.width=`${f}px`,e.style.height=`${m}px`,i.style.top=`${t.tableY}px`,i.style.width=`${f}px`,i.style.height=`${w}px`,i.style.top=`${t.tableY+m}px`,n.style.width=`${u}px`,n.style.height=`${w}px`,n.style.top=`${t.tableY+m}px`,o.style.width=`${u}px`,o.style.height=`${m}px`,o.style.top=`${t.tableY}px`,r.style.width=`${g}px`,r.style.height=`${w}px`,r.style.top=`${t.tableY+m}px`,r.style.left=t.tableX+c-g+"px",s.style.width=`${g}px`,s.style.height=`${m}px`,s.style.top=`${t.tableY}px`,s.style.left=t.tableX+c-g+"px",a.style.width=`${f}px`,a.style.height=`${y}px`,a.style.top=t.tableY+b-y+"px",l.style.width=`${u}px`,l.style.height=`${y}px`,l.style.top=t.tableY+b-y+"px",h.style.width=`${g}px`,h.style.height=`${y}px`,h.style.top=t.tableY+b-y+"px",h.style.left=t.tableX+c-g+"px"}(this.table)}setLoadingHierarchyState(t,e){const i=this.getCell(t,e),n=i.getChildByName("collapse",!0)||i.getChildByName("expand",!0);if(n){const i=wR()[Jw.loadingIconName];i&&LR(i,n,t,e)}}temporarilyUpdateSelectRectStyle(t){!function(t,e){const{selectedRangeComponents:i}=e;i.forEach(((e,i)=>{e.rect.setAttributes(t)})),e.updateNextFrame()}(t,this)}resetSelectRectStyle(){this.recreateAllSelectRangeComponents()}}(this),this.stateManager=new class{constructor(t){this.fastScrolling=!1,this.checkedState=new Map,this.headerCheckedState={},this._checkboxCellTypeFields=[],this._headerCheckFuncs={},this.radioState={},this.resetInteractionState=m_((t=>{this.updateInteractionState(null!=t?t:jw.default)}),100),this.table=t,this.initState(),this.updateVerticalScrollBar=this.updateVerticalScrollBar.bind(this),this.updateHorizontalScrollBar=this.updateHorizontalScrollBar.bind(this)}initState(){this._initState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}updateOptionSetState(){this._updateOptionSetState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}_updateOptionSetState(){this.interactionState=jw.default,this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new yw,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort=[{col:-1,row:-1,order:"normal"}],this.frozen={col:-1,row:-1},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}_initState(){this.interactionState=jw.default,this.select={highlightScope:Vw.single,ranges:[],cellPos:{col:-1,row:-1},selecting:!1},this.fillHandle={isFilling:!1,startX:void 0,startY:void 0},this.hover={highlightScope:Vw.single,cellPos:{col:-1,row:-1}},this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new yw,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort=[{col:-1,row:-1,order:"normal"}],this.frozen={col:-1,row:-1},this.scroll={horizontalBarPos:0,verticalBarPos:0},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}setHoverState(){var t;const{highlightMode:e,disableHover:i,disableHeaderHover:n}=null!==(t=this.table.options.hover)&&void 0!==t?t:{highlightMode:"cell"};i?this.hover.highlightScope=Vw.none:"cross"===e?this.hover.highlightScope=Vw.cross:"row"===e?this.hover.highlightScope=Vw.row:"column"===e?this.hover.highlightScope=Vw.column:"cell"===e&&(this.hover.highlightScope=Vw.single),this.hover.singleStyle=!i,this.hover.disableHeader=n,(this.hover.highlightScope===Vw.none||n)&&(this.hover.cellPosContainHeader={col:-1,row:-1})}setSelectState(){var t,e,i,n,o;const{headerSelectMode:r,disableSelect:s,disableHeaderSelect:a,highlightMode:l,highlightInRange:h}=Object.assign({},{headerSelectMode:"inline",disableSelect:!1,disableHeaderSelect:!1,highlightMode:"cell",highlightInRange:!1},this.table.options.select),d=(null===(t=this.table.options.select)||void 0===t?void 0:t.cornerHeaderSelectMode)?null===(e=this.table.options.select)||void 0===e?void 0:e.cornerHeaderSelectMode:"body"===(null===(i=this.table.options.select)||void 0===i?void 0:i.headerSelectMode)?null===(n=this.table.options.select)||void 0===n?void 0:n.headerSelectMode:"all";this.select.highlightScope=!0===s?Vw.none:"cross"===l?Vw.cross:"row"===l?Vw.row:"column"===l?Vw.column:Vw.single,this.select.singleStyle=!s,this.select.disableHeader=a,this.select.headerSelectMode=r,this.select.cornerHeaderSelectMode=d,this.select.highlightInRange=h,this.select.disableCtrlMultiSelect=!1===(null===(o=this.table.options.keyboardOptions)||void 0===o?void 0:o.ctrlMultiSelect)}isSelected(t,e){let i=!1;return this.select.ranges.forEach((n=>{a_(n,t,e)&&(i=!0)})),i}setSortState(t){const e=this,i=(t=!t||Array.isArray(t)?t:[t])&&t.reduce(((t,i)=>{var n,o,r;const s=null===(n=function(t){const i=[];return function t(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n.forEach((n=>{var r;const s=n.startInTotal?null!==(r=n.startInTotal+e.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)&&void 0!==r?r:0:o;n.columns?t(n.columns,s):i.push(Object.assign(Object.assign({},n),{startIndex:s}))}))}(t),i}(this.table.internalProps.columns))||void 0===n?void 0:n.find((t=>(null==t?void 0:t.field)===(null==i?void 0:i.field)));return this.table.internalProps.transpose?t.push({field:i.field,order:i.order,row:null!==(o=(null==s?void 0:s.startInTotal)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)&&void 0!==o?o:0,col:null==s?void 0:s.level}):t.push({field:i.field,order:i.order,col:null!==(r=(null==s?void 0:s.startInTotal)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)&&void 0!==r?r:0,row:null==s?void 0:s.level}),t}),[]);this.sort=i||[]}setFrozenState(){this.frozen.col=this.table.frozenColCount-1}updateInteractionState(t){if(this.interactionState===t)return;t===jw.scrolling&&(this.interactionStateBeforeScroll=this.interactionState);const e=this.interactionState;this.interactionState=t,e===jw.scrolling&&jw.default}updateHoverhighlightScope(t){this.hover.highlightScope!==t&&(this.hover.highlightScope=t)}updateHoverPos(t,e){FP(this,t,e)}updateSelectPos(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];-1!==e&&-1!==e&&(this.select.selecting=!0),t<0&&(t=-1),e<0&&(e=-1),t>this.table.colCount-1&&(t=this.table.colCount-1),e>this.table.rowCount-1&&(e=this.table.rowCount-1),function(t,e,i,n,o,r){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];var l,h;const{table:d,interactionState:c}=t,{scenegraph:u}=d,{highlightScope:g,disableHeader:p,cellPos:f,disableCtrlMultiSelect:v}=t.select;if(-1!==e&&-1!==i&&s&&d._makeVisibleCell(e,i),-1!==e&&-1!==i&&s)if(c===jw.grabing&&t.select.ranges.length>0){const n=t.select.ranges[t.select.ranges.length-1];e>n.start.col&&e>n.end.col&&d._makeVisibleCell(e+1,i),i>n.start.row&&i>n.end.row&&d._makeVisibleCell(e,i+1),e<n.start.col&&e<n.end.col&&d._makeVisibleCell(e-1,i),i<n.start.row&&i<n.end.row&&d._makeVisibleCell(e,i-1)}else d._makeVisibleCell(e,i);if(r){t.select.ranges=[],u.deleteAllSelectBorder();let e=0,i=0;const{disableHeaderSelect:n,disableRowSeriesNumberSelect:o}=(null===(l=d.options.keyboardOptions)||void 0===l?void 0:l.selectAllOnCtrlA)||{};n&&(e=d.rowHeaderLevelCount,i=d.columnHeaderLevelCount),(o||n&&d.transpose)&&d.options.rowSeriesNumber&&(e+=1),t.select.ranges.push({start:{col:e,row:i},end:{col:d.colCount-1,row:d.rowCount-1}});const r=t.select.ranges[t.select.ranges.length-1];u.updateCellSelectBorder(r,!1)}else if(-1===f.col||-1===f.row||-1!==e&&-1!==i)if(c!==jw.default||d.eventManager.isDraging||d.stateManager.isResizeCol()){if((c===jw.grabing||d.eventManager.isDraging)&&!d.stateManager.isResizeCol()){let n=!0;-1===f.col&&(f.col=e),-1===f.row&&(f.row=i),f.col=e,f.row=i;const o=t.select.ranges[t.select.ranges.length-1];if(o){if(d.internalProps.layoutMap.isSeriesNumberInBody(o.start.col,o.start.row))n=!1,o.end={col:d.colCount-1,row:i};else if(t.fillHandle.isFilling){if("top"===t.fillHandle.direction)if(i===t.fillHandle.beforeFillMinRow&&i===t.fillHandle.beforeFillMaxRow)o.start.row=o.end.row=i;else if(i<=t.fillHandle.beforeFillMinRow){if(o.start.row<o.end.row){const t=o.start.row;o.start.row=o.end.row,o.end.row=t}o.end.row=i}else i===t.fillHandle.beforeFillMaxRow&&(o.start.row>o.end.row?o.start.row=i:o.end.row=i);else if("bottom"===t.fillHandle.direction){if(i>=t.fillHandle.beforeFillMaxRow){if(o.start.row>o.end.row){const t=o.start.row;o.start.row=o.end.row,o.end.row=t}o.end.row=i}}else if("left"===t.fillHandle.direction)if(e===t.fillHandle.beforeFillMinCol&&e===t.fillHandle.beforeFillMaxCol)o.start.col=o.end.col=e;else if(e<=t.fillHandle.beforeFillMinCol){if(o.start.col<o.end.col){const t=o.start.col;o.start.col=o.end.col,o.end.col=t}o.end.col=e}else e===t.fillHandle.beforeFillMaxCol&&(o.start.col>o.end.col?o.start.col=e:o.end.col=e);else if("right"===t.fillHandle.direction&&e>=t.fillHandle.beforeFillMaxCol){if(o.start.col>o.end.col){const t=o.start.col;o.start.col=o.end.col,o.end.col=t}o.end.col=e}}else{o.end={col:e,row:i};const n=a?{start:{col:e,row:i},end:{col:e,row:i}}:d.getCellRange(e,i);o.start.col<n.end.col?o.end.col=n.end.col:o.start.col>n.start.col&&(o.end.col=n.start.col),o.start.row<n.end.row?o.end.row=n.end.row:o.start.row>n.start.row&&(o.end.row=n.start.row),"body"===t.select.headerSelectMode&&(d.isRowHeader(e,i)?(o.start.col=d.rowHeaderLevelCount+d.leftRowSeriesNumberCount,o.end.col=d.colCount-1):d.isColumnHeader(e,i)?(o.start.row=d.columnHeaderLevelCount,o.end.row=d.rowCount-1):d.internalProps.layoutMap.isSeriesNumberInBody(e,i)?(o.start.col=d.leftRowSeriesNumberCount,o.end.col=d.colCount-1):d.isCornerHeader(e,i)?(o.start.col=d.rowHeaderLevelCount+d.leftRowSeriesNumberCount,o.start.row=d.columnHeaderLevelCount,o.end.col=d.colCount-1,o.end.row=d.rowCount-1):d.isSeriesNumber(e,i)&&(o.start.col=d.leftRowSeriesNumberCount,o.start.row=d.columnHeaderLevelCount,o.end.col=d.colCount-1,o.end.row=d.rowCount-1)),a&&(o.skipBodyMerge=!0)}o&&o.start.row<=d.rowCount-1&&o.end.row<=d.rowCount-1&&o.start.col<=d.colCount-1&&o.end.col<=d.colCount-1&&u.updateCellSelectBorder(o,n)}}}else{const r=t.select.ranges[t.select.ranges.length-1];if(n&&r){if(o&&!v||(f.col=e,f.row=i),"cell"!==t.select.headerSelectMode&&d.isColumnHeader(e,i)){const n=Math.min(r.start.col,r.end.col,e),o=Math.max(r.start.col,r.end.col,e),s=Math.min(r.start.row,r.end.row,i),a=d.rowCount-1;"body"===t.select.headerSelectMode?(r.start={col:n,row:d.columnHeaderLevelCount},r.end={col:o,row:d.rowCount-1}):(r.start={col:n,row:s},r.end={col:o,row:a})}else if("cell"!==t.select.headerSelectMode&&d.isRowHeader(e,i)){const n=Math.min(r.start.col,r.end.col,e),o=d.colCount-1,s=Math.min(r.start.row,r.end.row,i),a=Math.max(r.start.row,r.end.row,i);"body"===t.select.headerSelectMode?(r.start={col:d.leftRowSeriesNumberCount+d.rowHeaderLevelCount,row:s},r.end={col:d.colCount-1,row:a}):(r.start={col:n,row:s},r.end={col:o,row:a})}else if("cell"!==t.select.headerSelectMode&&d.isSeriesNumberInBody(e,i)){const n=Math.min(r.start.col,r.end.col,e),o=d.colCount-1,s=Math.min(r.start.row,r.end.row,i),a=Math.max(r.start.row,r.end.row,i);"body"===t.select.headerSelectMode?(r.start={col:d.leftRowSeriesNumberCount,row:s},r.end={col:d.colCount-1,row:a}):(r.start={col:n,row:s},r.end={col:o,row:a})}else r.end={col:e,row:i};u.deleteLastSelectedRangeComponents(),u.updateCellSelectBorder(r)}else{let n=!0;if(-1===f.col||-1===f.row||o&&!v||(t.select.ranges=[],u.deleteAllSelectBorder()),"cell"!==t.select.headerSelectMode&&d.isColumnHeader(e,i)){const n=d.getCellRange(e,i);"body"===t.select.headerSelectMode?t.select.ranges.push({start:{col:n.start.col,row:d.columnHeaderLevelCount},end:{col:n.end.col,row:d.rowCount-1},skipBodyMerge:!0}):t.select.ranges.push({start:{col:n.start.col,row:n.start.row},end:{col:n.end.col,row:d.rowCount-1},skipBodyMerge:!0})}else if("cell"!==t.select.headerSelectMode&&d.isRowHeader(e,i)){const n=d.getCellRange(e,i);"body"===t.select.headerSelectMode?t.select.ranges.push({start:{col:d.rowHeaderLevelCount+d.leftRowSeriesNumberCount,row:n.start.row},end:{col:d.colCount-1,row:n.end.row},skipBodyMerge:!0}):t.select.ranges.push({start:{col:n.start.col,row:n.start.row},end:{col:d.colCount-1,row:n.end.row},skipBodyMerge:!0})}else if(d.internalProps.layoutMap.isSeriesNumberInHeader(e,i)){n=!1;const{cornerHeaderSelectMode:o}=t.select;if("body"===o)t.select.ranges.push({start:{col:d.leftRowSeriesNumberCount,row:d.columnHeaderLevelCount},end:{col:d.colCount-1,row:d.rowCount-1},skipBodyMerge:!0});else if("inline"===o){const n=a?{start:{col:e,row:i},end:{col:e,row:i}}:d.getCellRange(e,i);t.select.ranges.push({start:{col:n.start.col,row:n.start.row},end:{col:n.end.col,row:d.rowCount-1},skipBodyMerge:!0})}else if("cell"===o){const n=a?{start:{col:e,row:i},end:{col:e,row:i}}:d.getCellRange(e,i);t.select.ranges.push({start:{col:n.start.col,row:n.start.row},end:{col:n.end.col,row:n.end.row},skipBodyMerge:a||void 0})}else t.select.ranges.push({start:{col:0,row:0},end:{col:d.colCount-1,row:d.rowCount-1},skipBodyMerge:!0})}else if(d.internalProps.layoutMap.isSeriesNumberInBody(e,i))n=!1,"body"===t.select.headerSelectMode?t.select.ranges.push({start:{col:d.leftRowSeriesNumberCount,row:i},end:{col:d.colCount-1,row:i},skipBodyMerge:!0}):t.select.ranges.push({start:{col:e,row:i},end:{col:d.colCount-1,row:i},skipBodyMerge:!0});else if(d.internalProps.layoutMap.isCornerHeader(e,i)){n=!1;const{cornerHeaderSelectMode:o}=t.select;if("body"===o)t.select.ranges.push({start:{col:d.rowHeaderLevelCount+d.leftRowSeriesNumberCount,row:d.columnHeaderLevelCount},end:{col:d.colCount-1,row:d.rowCount-1},skipBodyMerge:!0});else if("cell"===o){const n=a?{start:{col:e,row:i},end:{col:e,row:i}}:d.getCellRange(e,i);t.select.ranges.push({start:{col:n.start.col,row:n.start.row},end:{col:n.end.col,row:n.end.row},skipBodyMerge:a||void 0})}else if("inline"===o){const n=a?{start:{col:e,row:i},end:{col:e,row:i}}:d.getCellRange(e,i);t.select.ranges.push({start:{col:n.start.col,row:n.start.row},end:{col:n.end.col,row:d.rowCount-1},skipBodyMerge:!0})}else t.select.ranges.push({start:{col:d.leftRowSeriesNumberCount,row:0},end:{col:d.colCount-1,row:d.rowCount-1},skipBodyMerge:!0})}else if(e>=0&&i>=0){const n=a?{start:{col:e,row:i},end:{col:e,row:i}}:d.getCellRange(e,i);t.select.ranges.push({start:{col:n.start.col,row:n.start.row},end:{col:n.end.col,row:n.end.row},skipBodyMerge:a||void 0})}f.col=e,f.row=i;const r=null===(h=t.select.ranges)||void 0===h?void 0:h[t.select.ranges.length-1];r&&r.start.row<=d.rowCount-1&&r.end.row<=d.rowCount-1&&r.start.col<=d.colCount-1&&r.end.col<=d.colCount-1&&u.updateCellSelectBorder(r,n)}}else f.col=-1,f.row=-1,t.select.ranges=[],u.deleteAllSelectBorder();u.updateNextFrame()}(this,t,e,i,n,o,r,s)}checkCellRangeInSelect(t,e){return function(t,e,i,n){for(let n=0;n<i.length;n++)if(h_(i[n],{start:t,end:e}))return!0;return!1}(t,e,this.select.ranges,this.select.highlightScope)}updateHoverIcon(t,e,i,n){var o,r,s,a,l,h,d,c,u;if((null===(o=this.residentHoverIcon)||void 0===o?void 0:o.icon)&&i===(null===(r=this.residentHoverIcon)||void 0===r?void 0:r.icon))return;const g=GP(i);if(g)if("richtext-icon"===g.type){const i=g.icon;if(this.hoverIcon.icon&&this.hoverIcon.icon!==(null===(a=this.residentHoverIcon)||void 0===a?void 0:a.icon)&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame()),i.attribute.tooltip){const n={content:i.attribute.tooltip.title,referencePosition:{rect:g.position,placement:i.attribute.tooltip.placement},style:Object.assign({},null===(l=this.table.internalProps.theme)||void 0===l?void 0:l.tooltipStyle,null===(h=i.tooltip)||void 0===h?void 0:h.style,null===(c=null===(d=i.attribute)||void 0===d?void 0:d.tooltip)||void 0===c?void 0:c.style),disappearDelay:i.attribute.tooltip.disappearDelay};this.table.internalProps.tooltipHandler.isBinded(n)||this.table.showTooltip(t,e,n)}}else{const i=g.icon;i!==this.hoverIcon.icon&&(this.hoverIcon.icon&&this.hoverIcon.icon!==(null===(u=this.residentHoverIcon)||void 0===u?void 0:u.icon)&&this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=t,this.hoverIcon.row=e,this.hoverIcon.icon=i,this.table.scenegraph.setIconHoverStyle(i,t,e,n),this.table.scenegraph.updateNextFrame())}else this.hoverIcon.icon&&this.hoverIcon.icon!==(null===(s=this.residentHoverIcon)||void 0===s?void 0:s.icon)&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame())}isResizeCol(){return this.columnResize.resizing}isResizeRow(){return this.rowResize.resizing}isFillHandle(){return this.fillHandle.isFilling}isSelecting(){return this.select.selecting}endSelectCells(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.select.selecting){if(this.select.selecting=!1,0===this.select.ranges.length)return;const e=this.select.ranges[this.select.ranges.length-1];this.table.isSeriesNumber(this.select.cellPos.col,this.select.cellPos.row)||this.table.isHeader(this.select.cellPos.col,this.select.cellPos.row)||function(t,e){const i=t.start.col,n=t.end.col,o=t.start.row,r=t.end.row;let s=i,a=n,l=o,h=r;for(let t=i;t<=n;t++)for(let i=o;i<=r;i++){const n=e.getCellRange(t,i);n&&(s=Math.min(s,n.start.col),a=Math.max(a,n.end.col),l=Math.min(l,n.start.row),h=Math.max(h,n.end.row))}t.start.col=s,t.end.col=a,t.start.row=l,t.end.row=h}(e,this.table);let i=!1;for(let t=0;t<this.select.ranges.length-1;t++){const n=this.select.ranges[t];if(n&&n.start.col===e.start.col&&n.start.row===e.start.row&&n.end.col===e.end.col&&n.end.row===e.end.row){i=!0;break}}i?(this.select.ranges.pop(),ZL(this.table.scenegraph),this.table.scenegraph.selectingRangeComponents.clear()):this.table.scenegraph.moveSelectingRangeComponentsToSelectedRangeComponents();const n=this.select.ranges[this.select.ranges.length-1].end.col,o=this.select.ranges[this.select.ranges.length-1].end.row;t&&this.table.fireListeners(v_.SELECTED_CELL,{ranges:this.select.ranges,col:n,row:o})}else e&&0===this.select.ranges.length&&this.table.fireListeners(v_.SELECTED_CLEAR,{})}endResizeCol(){setTimeout((()=>{this.columnResize.resizing=!1}),0),this.table.scenegraph.updateChartSizeForResizeColWidth(this.columnResize.col),this.checkFrozen(),this.table.scenegraph.component.hideResizeCol(),this.table.scenegraph.updateNextFrame()}startResizeCol(t,e,i,n){this.columnResize.resizing=!0,this.columnResize.col=t,this.columnResize.x=e,this.columnResize.isRightFrozen=n,this.table.scenegraph.component.showResizeCol(t,i,n),this.table.scenegraph.updateNextFrame()}updateResizeCol(t,e){!function(t,e,i){t=Math.ceil(t),e=Math.ceil(e);let n=i.columnResize.isRightFrozen?i.columnResize.x-t:t-i.columnResize.x;if(Math.abs(n)<1)return;const o=i.table.getColWidth(i.columnResize.col);let r=o;r+=n;const s=i.table.getMinColWidth(i.columnResize.col),a=i.table.getMaxColWidth(i.columnResize.col);if(r<s||r>a){if(o===s||o===a)return;n=o-s>a-o?a-o:s-o}let l=i.table.getColWidth(i.columnResize.col)+n;if(l<i.table.internalProps.limitMinWidth&&(l=i.table.internalProps.limitMinWidth,n=l-i.table.getColWidth(i.columnResize.col)),"adaptive"===i.table.widthMode&&i.columnResize.col<i.table.colCount-1){const t=i.table.getColWidth(i.columnResize.col+1),e=i.table.getMinColWidth(i.columnResize.col+1),o=i.table.getMaxColWidth(i.columnResize.col+1);let r=t;if(r-=n,r<e||r>o){if(t===e||t===o)return;n=t-e>o-t?o-t:e-t}r-n<i.table.internalProps.limitMinWidth&&(n=r-i.table.internalProps.limitMinWidth)}n=Math.ceil(n),i.columnResize.col<i.table.rowHeaderLevelCount||i.columnResize.col>=i.table.colCount-i.table.rightFrozenColCount?jP(n,i):"indicator"===i.table.internalProps.columnResizeType?function(t,e){const i=e.table.internalProps.layoutMap;let n,o,r;if(i.indicatorsAsCol)n=i.getIndicatorKey(e.columnResize.col,e.table.columnHeaderLevelCount);else{const t=i.getCellHeaderPaths(e.columnResize.col,e.table.columnHeaderLevelCount-1),n=t.colHeaderPaths[t.colHeaderPaths.length-1];o=n.dimensionKey,r=n.value}for(let s=e.table.rowHeaderLevelCount;s<e.table.colCount-e.table.rightFrozenColCount;s++){const a=i.getIndicatorKey(s,e.table.columnHeaderLevelCount);if(i.indicatorsAsCol&&a===n)e.table.scenegraph.updateColWidth(s,t),e.table.internalProps._widthResizedColMap.add(s);else if(!i.indicatorsAsCol){const n=i.getCellHeaderPaths(s,e.table.columnHeaderLevelCount-1),a=null==n?void 0:n.colHeaderPaths[n.colHeaderPaths.length-1];a&&o===a.dimensionKey&&r===a.value&&(e.table.scenegraph.updateColWidth(s,t),e.table.internalProps._widthResizedColMap.add(s))}}}(n,i):"indicatorGroup"===i.table.internalProps.columnResizeType?function(t,e){const i=e.table.internalProps.layoutMap,n=i.getCellHeaderPaths(e.columnResize.col,e.table.columnHeaderLevelCount),o=i.getHeadNodeByRowOrColDimensions(n.colHeaderPaths.slice(0,n.colHeaderPaths.length-1)),r=o.startInTotal+e.table.frozenColCount,s=o.startInTotal+e.table.frozenColCount+o.size-1,a=e.table.getColsWidth(r,s),l=t;for(let t=r;t<=s;t++){if(!(e.table.internalProps.transpose||e.table.isPivotTable()&&!i.indicatorsAsCol)){const n=i.getBody(t,e.table.columnHeaderLevelCount);if(null==n?void 0:n.disableColumnResize)continue}let n=e.table.getColWidth(t)/a*l;n>0&&n<.5?n=.5:n<0&&n>=-.5&&(n=-.5),e.table.scenegraph.updateColWidth(t,n),e.table.internalProps._widthResizedColMap.add(t)}}(n,i):"all"===i.table.internalProps.columnResizeType?function(t,e){const i=e.table.internalProps.layoutMap;for(let n=e.table.frozenColCount;n<e.table.colCount-e.table.rightFrozenColCount;n++){if(!(e.table.internalProps.transpose||e.table.isPivotTable()&&!i.indicatorsAsCol)){const t=i.getBody(n,e.table.columnHeaderLevelCount);if(null==t?void 0:t.disableColumnResize)continue}e.table.scenegraph.updateColWidth(n,t),e.table.internalProps._widthResizedColMap.add(n)}}(n,i):jP(n,i),i.columnResize.x=t,i.table.scenegraph.component.updateResizeCol(i.columnResize.col,e,i.columnResize.isRightFrozen),i.columnResize.col<i.table.frozenColCount&&!i.table.isPivotTable()&&!i.table.transpose?i.table.scenegraph.component.setFrozenColumnShadow(i.table.frozenColCount-1,i.columnResize.isRightFrozen):i.table.options.frozenColCount&&i.table.scenegraph.component.setFrozenColumnShadow(i.table.frozenColCount-1),(i.columnResize.col>=i.table.colCount-i.table.rightFrozenColCount&&!i.table.isPivotTable()&&!i.table.transpose||i.table.options.rightFrozenColCount)&&i.table.scenegraph.component.setRightFrozenColumnShadow(i.table.colCount-i.table.rightFrozenColCount),i.table.scenegraph.updateNextFrame()}(t,e,this)}endResizeRow(){setTimeout((()=>{this.rowResize.resizing=!1}),0),this.table.scenegraph.updateChartSizeForResizeRowHeight(this.rowResize.row),this.table.scenegraph.component.hideResizeRow(),this.table.scenegraph.updateNextFrame()}startResizeRow(t,e,i,n){this.rowResize.resizing=!0,this.rowResize.row=t,this.rowResize.y=i,this.rowResize.isBottomFrozen=n,this.table.scenegraph.component.showResizeRow(t,e,n),this.table.scenegraph.updateNextFrame()}updateResizeRow(t,e){!function(t,e,i){t=Math.ceil(t),e=Math.ceil(e);let n=i.rowResize.isBottomFrozen?i.rowResize.y-e:e-i.rowResize.y;if(Math.abs(n)<1)return;i.table.getRowHeight(i.rowResize.row);let o=i.table.getRowHeight(i.rowResize.row)+n;if(o<i.table.internalProps.limitMinHeight&&(o=i.table.internalProps.limitMinHeight,n=o-i.table.getRowHeight(i.rowResize.row)),"adaptive"===i.table.heightMode&&i.rowResize.row<i.table.rowCount-1){let t=i.table.getRowHeight(i.rowResize.row+1);t-=n,t-n<i.table.internalProps.limitMinHeight&&(n=t-i.table.internalProps.limitMinHeight)}n=Math.ceil(n),i.rowResize.row<i.table.columnHeaderLevelCount||i.rowResize.row>=i.table.rowCount-i.table.bottomFrozenRowCount?$P(n,i):"indicator"===i.table.internalProps.rowResizeType?function(t,e){var i,n;const o=e.table.internalProps.layoutMap;let r,s,a;if(o.indicatorsAsCol){const t=o.getCellHeaderPaths(e.table.rowHeaderLevelCount-1,e.rowResize.row),n=null===(i=t.rowHeaderPaths)||void 0===i?void 0:i[t.rowHeaderPaths.length-1];s=null==n?void 0:n.dimensionKey,a=null==n?void 0:n.value}else r=o.getIndicatorKey(e.table.rowHeaderLevelCount,e.rowResize.row);for(let i=e.table.columnHeaderLevelCount;i<e.table.rowCount-e.table.bottomFrozenRowCount;i++){const l=o.getIndicatorKey(e.table.rowHeaderLevelCount,i);if(o.indicatorsAsCol||l!==r){if(o.indicatorsAsCol){const r=o.getCellHeaderPaths(e.table.rowHeaderLevelCount-1,i),l=null===(n=null==r?void 0:r.rowHeaderPaths)||void 0===n?void 0:n[r.rowHeaderPaths.length-1];l&&s===l.dimensionKey&&a===l.value&&(e.table.scenegraph.updateRowHeight(i,t),e.table.internalProps._heightResizedRowMap.add(i))}}else e.table.scenegraph.updateRowHeight(i,t),e.table.internalProps._heightResizedRowMap.add(i)}}(n,i):"indicatorGroup"===i.table.internalProps.rowResizeType?function(t,e){const i=e.table.internalProps.layoutMap,n=i.getCellHeaderPaths(e.table.rowHeaderLevelCount,e.rowResize.row),o=i.getHeadNodeByRowOrColDimensions(n.rowHeaderPaths.slice(0,n.rowHeaderPaths.length-1)),r=o.startInTotal+e.table.frozenRowCount,s=o.startInTotal+e.table.frozenRowCount+o.size-1,a=e.table.getRowsHeight(r,s),l=t;for(let t=r;t<=s;t++){let i=e.table.getRowHeight(t)/a*l;i>0&&i<.5?i=.5:i<0&&i>=-.5&&(i=-.51),e.table.scenegraph.updateRowHeight(t,i),e.table.internalProps._heightResizedRowMap.add(t)}}(n,i):"all"===i.table.internalProps.rowResizeType?function(t,e){for(let i=e.table.frozenRowCount;i<e.table.rowCount-e.table.bottomFrozenRowCount;i++)e.table.scenegraph.updateRowHeight(i,t),e.table.internalProps._heightResizedRowMap.add(i)}(n,i):$P(n,i),i.rowResize.y=e,i.table.scenegraph.component.updateResizeRow(i.rowResize.row,t,i.rowResize.isBottomFrozen),i.table.scenegraph.updateNextFrame()}(t,e,this)}startFillSelect(t,e){this.fillHandle.isFilling=!0,this.fillHandle.startX=t,this.fillHandle.startY=e;const i=this.select.ranges[this.select.ranges.length-1];this.fillHandle.beforeFillMinCol=Math.min(i.start.col,i.end.col),this.fillHandle.beforeFillMinRow=Math.min(i.start.row,i.end.row),this.fillHandle.beforeFillMaxCol=Math.max(i.start.col,i.end.col),this.fillHandle.beforeFillMaxRow=Math.max(i.start.row,i.end.row),this.table.fireListeners(v_.MOUSEDOWN_FILL_HANDLE,{})}endFillSelect(){this.fillHandle.isFilling=!1,this.fillHandle.startX=void 0,this.fillHandle.startY=void 0,this.fillHandle.directionRow=void 0;const t=Math.min(this.select.ranges[0].start.col,this.select.ranges[0].end.col),e=Math.min(this.select.ranges[0].start.row,this.select.ranges[0].end.row),i=Math.max(this.select.ranges[0].start.col,this.select.ranges[0].end.col),n=Math.max(this.select.ranges[0].start.row,this.select.ranges[0].end.row);this.fillHandle.beforeFillMinCol===t&&this.fillHandle.beforeFillMinRow===e&&this.fillHandle.beforeFillMaxCol===i&&this.fillHandle.beforeFillMaxRow===n||this.table.eventManager.isDraging&&this.table.fireListeners(v_.DRAG_FILL_HANDLE_END,{direction:this.fillHandle.direction}),this.fillHandle.beforeFillMaxCol=void 0,this.fillHandle.beforeFillMaxRow=void 0,this.fillHandle.beforeFillMinCol=void 0,this.fillHandle.beforeFillMinRow=void 0}startMoveCol(t,e,i,n,o){!function(t,e,i,n,o,r){var s;if(!("canMoveHeaderPosition"in o.table.internalProps.layoutMap))return;o.columnMove.moving=!0,o.columnMove.colSource=t,o.columnMove.rowSource=e,o.columnMove.x=i-o.table.tableX,o.columnMove.y=n-o.table.tableY;const a=o.table.getCellLocation(t,e),l="columnHeader"===a?o.columnMove.x:"rowHeader"===a||o.table.internalProps.layoutMap.isSeriesNumberInBody(t,e)?o.columnMove.y:0,{backX:h,lineX:d,backY:c,lineY:u}=o.table.scenegraph.component.showMoveCol(t,e,l);o.table.fireListeners(v_.CHANGE_HEADER_POSITION_START,{col:t,row:e,x:i,y:n,backX:h,lineX:d,backY:c,lineY:u,event:r});const g=!!(null===(s=o.select.ranges)||void 0===s?void 0:s.length);o.table.stateManager.updateSelectPos(-1,-1),o.table.stateManager.endSelectCells(!0,g),o.table.scenegraph.updateNextFrame()}(t,e,i,n,this,o)}updateMoveCol(t,e,i,n,o){!function(t,e,i,n,o,r){if(!("canMoveHeaderPosition"in o.table.internalProps.layoutMap))return;const s=function(t,e,i){const n=i.getCellRange(t.col,t.row);if(i.isColumnHeader(t.col,t.row)){const o=i.getCellRange(e.col,n.start.row);e.row>=i.columnHeaderLevelCount&&(e.row=i.columnHeaderLevelCount-1),e.col>=t.col?e.col=o.end.col:e.col=o.start.col}else if(i.isRowHeader(t.col,t.row)){const o=i.internalProps.layoutMap,r=i.getCellRange(n.start.col,e.row);if(e.col>=i.rowHeaderLevelCount+o.leftRowSeriesNumberColumnCount&&(e.col=i.rowHeaderLevelCount+o.leftRowSeriesNumberColumnCount-1),"tree"===o.rowHierarchyType){const n=o.getCellHeaderPathsWithTreeNode(t.col,t.row).rowHeaderPaths,r=o.getCellHeaderPathsWithTreeNode(e.col,e.row).rowHeaderPaths;if(n.length<=r.length){const o=r[n.length-1];o&&(e.row>=t.row?e.row=o.startInTotal+o.size-1+i.columnHeaderLevelCount:e.row=o.startInTotal+i.columnHeaderLevelCount)}}else e.row>=t.row?e.row=r.end.row:e.row=r.start.row}return e}({col:o.columnMove.colSource,row:o.columnMove.rowSource},{col:t,row:e},o.table);if(o.table.internalProps.layoutMap.canMoveHeaderPosition({col:o.columnMove.colSource,row:o.columnMove.rowSource},{col:s.col,row:s.row})){let a,l,h,d;o.columnMove.x=i-o.table.tableX,o.columnMove.y=n-o.table.tableY,o.columnMove.colTarget=s.col,o.columnMove.rowTarget=s.row,o.updateCursor("grabbing");const c=o.table.getCellLocation(o.columnMove.colSource,o.columnMove.rowSource);"columnHeader"===c?(l=o.columnMove.x,a=o.table.isLeftFrozenColumn(t)?o.columnMove.colTarget>=o.columnMove.colSource?o.table.getColsWidth(0,o.columnMove.colTarget):o.table.getColsWidth(0,o.columnMove.colTarget-1):o.table.isRightFrozenColumn(t)?o.table.tableNoFrameWidth-o.table.getColsWidth(s.col+1,o.table.colCount-1):(o.columnMove.colTarget>=o.columnMove.colSource?o.table.getColsWidth(0,o.columnMove.colTarget):o.table.getColsWidth(0,o.columnMove.colTarget-1))-o.table.stateManager.scroll.horizontalBarPos):("rowHeader"===c||o.table.internalProps.layoutMap.isSeriesNumberInBody(t,e))&&(d=o.columnMove.y,h=o.table.isFrozenRow(e)?o.columnMove.rowTarget>=o.columnMove.rowSource?o.table.getRowsHeight(0,o.columnMove.rowTarget):o.table.getRowsHeight(0,o.columnMove.rowTarget-1):o.table.isBottomFrozenRow(e)?o.table.tableNoFrameHeight-o.table.getRowsHeight(s.row+1,o.table.rowCount-1):(o.columnMove.rowTarget>=o.columnMove.rowSource?o.table.getRowsHeight(0,o.columnMove.rowTarget):o.table.getRowsHeight(0,o.columnMove.rowTarget-1))-o.table.stateManager.scroll.verticalBarPos),o.table.scenegraph.component.updateMoveCol(l,a,d,h),o.table.fireListeners(v_.CHANGING_HEADER_POSITION,{col:t,row:e,x:i,y:n,backX:l,lineX:a,backY:d,lineY:h,event:r}),o.table.scenegraph.updateNextFrame()}else o.updateCursor("not-allowed"),o.columnMove.colTarget=o.columnMove.colSource,o.columnMove.rowTarget=o.columnMove.rowSource}(t,e,i,n,this,o)}isMoveCol(){return this.columnMove.moving}endMoveCol(){return function(t){var e,i;let n=!1;if("canMoveHeaderPosition"in t.table.internalProps.layoutMap&&t.columnMove.moving&&t.columnMove.colSource>=0&&t.columnMove.rowSource>=0&&t.columnMove.colTarget>=0&&t.columnMove.rowTarget>=0&&!0!==(null===(e=t.table.options.customConfig)||void 0===e?void 0:e.notUpdateInColumnRowMove)){const e=t.table.getCellRange(t.columnMove.colSource,t.columnMove.rowSource),i=t.table.getCellRange(t.columnMove.colTarget,t.columnMove.rowTarget),o=t.table._moveHeaderPosition({col:t.columnMove.colSource,row:t.columnMove.rowSource},{col:t.columnMove.colTarget,row:t.columnMove.rowTarget});if(!o||o.targetIndex===o.sourceIndex)return t.updateCursor(),t.columnMove.moving=!1,delete t.columnMove.colSource,delete t.columnMove.rowSource,delete t.columnMove.colTarget,delete t.columnMove.rowTarget,t.table.scenegraph.component.hideMoveCol(),t.table.scenegraph.updateNextFrame(),!1;{t.table.internalProps.useOneRowHeightFillAll=!1,t.table.internalProps.layoutMap.clearCellRangeMap();const r=t.table.getCellRange(t.columnMove.colSource,t.columnMove.rowSource),s=t.table.getCellRange(t.columnMove.colTarget,t.columnMove.rowTarget),a=Math.min(r.start.col,s.start.col,e.start.col,i.start.col),l=Math.max(r.end.col,s.end.col,e.end.col,i.end.col),h=Math.min(r.start.row,s.start.row,e.start.row,i.start.row);let d=Math.max(r.end.row,s.end.row,e.end.row,i.end.row);"row"===o.moveType&&"tree"===t.table.internalProps.layoutMap.rowHierarchyType&&(d=o.targetIndex>o.sourceIndex?d+o.targetSize-1:d+o.sourceSize-1),!t.table.transpose&&t.table.internalProps.layoutMap.isSeriesNumberInBody(t.columnMove.colSource,t.columnMove.rowSource)&&(t.table.changeRecordOrder(o.sourceIndex,o.targetIndex),t.changeCheckboxAndRadioOrder(o.sourceIndex,o.targetIndex)),"column"===o.moveType?NP(a,l,0,-1,t.table):NP(0,-1,h,d,t.table),t.table.clearCellStyleCache(),t.table.internalProps.layoutMap.isSeriesNumberInBody(t.columnMove.colSource,t.columnMove.rowSource)?t.table.scenegraph.updateHeaderPosition(t.table.scenegraph.proxy.colStart,t.table.scenegraph.proxy.colEnd,t.table.scenegraph.proxy.rowStart,t.table.scenegraph.proxy.rowEnd,o.moveType):"column"===o.moveType?t.table.scenegraph.updateHeaderPosition(a,l,0,-1,o.moveType):t.table.scenegraph.updateHeaderPosition(0,-1,h,d,o.moveType),"adjustFrozenCount"===t.table.internalProps.frozenColDragHeaderMode&&t.table.isListTable()&&(t.table.isLeftFrozenColumn(t.columnMove.colTarget)&&!t.table.isLeftFrozenColumn(t.columnMove.colSource)?t.table.frozenColCount+=r.end.col-r.start.col+1:t.table.isLeftFrozenColumn(t.columnMove.colSource)&&!t.table.isLeftFrozenColumn(t.columnMove.colTarget)&&(t.table.frozenColCount-=r.end.col-r.start.col+1),t.table.isRightFrozenColumn(t.columnMove.colTarget)&&!t.table.isRightFrozenColumn(t.columnMove.colSource)?t.table.rightFrozenColCount+=r.end.col-r.start.col+1:t.table.isRightFrozenColumn(t.columnMove.colSource)&&!t.table.isRightFrozenColumn(t.columnMove.colTarget)&&(t.table.rightFrozenColCount-=r.end.col-r.start.col+1)),n=!0}}return t.columnMove.moving=!1,setTimeout((()=>{delete t.columnMove.colSource,delete t.columnMove.rowSource,delete t.columnMove.colTarget,delete t.columnMove.rowTarget}),0),t.table.scenegraph.component.hideMoveCol(),t.columnResize.col<t.table.frozenColCount&&!t.table.isPivotTable()&&!t.table.transpose?(t.table.scenegraph.component.setFrozenColumnShadow(t.table.frozenColCount-1,t.columnResize.isRightFrozen),t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount)):t.columnResize.col>=t.table.colCount-t.table.rightFrozenColCount&&!t.table.isPivotTable()&&!t.table.transpose?t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount):t.table.options.frozenColCount?t.table.scenegraph.component.setFrozenColumnShadow(t.table.frozenColCount-1):t.table.options.rightFrozenColCount&&t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount),t.table.scenegraph.updateNextFrame(),!0===(null===(i=t.table.options.customConfig)||void 0===i?void 0:i.notUpdateInColumnRowMove)||n}(this)}checkFrozen(){var t;let e=this.table.options.frozenColCount?this.table.options.frozenColCount:this.table.isPivotTable()||this.table.isListTable()&&this.table.internalProps.transpose?(null!==(t=this.table.rowHeaderLevelCount)&&void 0!==t?t:0)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount:0;if(e){e>this.table.colCount&&(e=this.table.colCount);const t=this.table._getMaxFrozenWidth();if(this.table.getColsWidth(0,e-1)>t)if(this.table.internalProps.unfreezeAllOnExceedsMaxWidth)this.table._setFrozenColCount(0),this.setFrozenCol(-1);else{const t=this.table._getComputedFrozenColCount(e);this.table._setFrozenColCount(t),this.setFrozenCol(t)}else this.table.frozenColCount!==e&&(this.table._setFrozenColCount(e),this.setFrozenCol(e))}}setFrozenCol(t){t!==this.frozen.col?(this.frozen.col=t,this.table.scenegraph.updateFrozen(),this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)):this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)}setFrozenRow(t){t!==this.frozen.row&&(this.frozen.row=t,this.table.scenegraph.updateRowFrozen())}checkVerticalScrollBarEnd(){var t,e;const i=this.table.getAllRowsHeight(),n=this.scroll.verticalBarPos,o=this.table.tableNoFrameHeight;n+o>=i&&this.table.fireListeners(v_.SCROLL_VERTICAL_END,{scrollTop:n,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(t=this.table.theme.scrollStyle)||void 0===t?void 0:t.width,scrollWidth:null===(e=this.table.theme.scrollStyle)||void 0===e?void 0:e.width,viewHeight:o,viewWidth:this.table.tableNoFrameWidth})}checkHorizontalScrollBarEnd(){var t,e;const i=this.table.getAllColsWidth(),n=this.scroll.horizontalBarPos,o=this.table.tableNoFrameWidth;n+o>=i&&this.table.fireListeners(v_.SCROLL_HORIZONTAL_END,{scrollTop:this.scroll.verticalBarPos,scrollLeft:n,scrollHeight:null===(t=this.table.theme.scrollStyle)||void 0===t?void 0:t.width,scrollWidth:null===(e=this.table.theme.scrollStyle)||void 0===e?void 0:e.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:o})}updateVerticalScrollBar(t){var e,i,n,o;const r=this.table.getAllRowsHeight(),s=this.scroll.verticalBarPos;let a=Math.ceil(t*(r-this.table.scenegraph.height));XC(a)&&!isNaN(a)||(a=0);const l=a-this.table.scenegraph.proxy.deltaY-s;if(this.table.fireListeners(v_.CAN_SCROLL,{event:void 0,scrollTop:a-this.table.scenegraph.proxy.deltaY,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(e=this.table.theme.scrollStyle)||void 0===e?void 0:e.width,scrollWidth:null===(i=this.table.theme.scrollStyle)||void 0===i?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:t,dy:l}).some((t=>!1===t))){const t=this.scroll.verticalBarPos/(r-this.table.scenegraph.height);this.table.scenegraph.component.updateVerticalScrollBarPos(t)}else this.scroll.verticalBarPos=a,this.table.scenegraph.setY(-this.scroll.verticalBarPos,1===t),this.scroll.verticalBarPos-=this.table.scenegraph.proxy.deltaY,this.table.scenegraph.proxy.deltaY=0,this.updateHoverPos(-1,-1),this.table.fireListeners(v_.SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(n=this.table.theme.scrollStyle)||void 0===n?void 0:n.width,scrollWidth:null===(o=this.table.theme.scrollStyle)||void 0===o?void 0:o.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:t,dy:l}),s!==this.scroll.verticalBarPos&&this.checkVerticalScrollBarEnd()}updateHorizontalScrollBar(t){var e,i,n,o;const r=this.table.getAllColsWidth(),s=this.scroll.horizontalBarPos;let a=Math.ceil(t*(r-this.table.scenegraph.width));XC(a)&&!isNaN(a)||(a=0);const l=a-this.table.scenegraph.proxy.deltaX-s;if(this.table.fireListeners(v_.CAN_SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:a-this.table.scenegraph.proxy.deltaX,scrollHeight:null===(e=this.table.theme.scrollStyle)||void 0===e?void 0:e.width,scrollWidth:null===(i=this.table.theme.scrollStyle)||void 0===i?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:t,dx:l}).some((t=>!1===t))){const t=this.scroll.horizontalBarPos/(r-this.table.scenegraph.width);this.table.scenegraph.component.updateHorizontalScrollBarPos(t)}else this.scroll.horizontalBarPos=a,this.table.scenegraph.setX(-this.scroll.horizontalBarPos,1===t),this.scroll.horizontalBarPos-=this.table.scenegraph.proxy.deltaX,this.table.scenegraph.proxy.deltaX=0,this.updateHoverPos(-1,-1),this.table.fireListeners(v_.SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(n=this.table.theme.scrollStyle)||void 0===n?void 0:n.width,scrollWidth:null===(o=this.table.theme.scrollStyle)||void 0===o?void 0:o.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:t,dx:l}),s!==this.scroll.horizontalBarPos&&this.checkHorizontalScrollBarEnd()}setScrollTop(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n,o,r,s,a,l,h;const d=this.table.getAllRowsHeight(),c=(null===(n=this.table.options.customConfig)||void 0===n?void 0:n._disableColumnAndRowSizeRound)?1:0;t=Math.max(0,Math.min(t,d-this.table.scenegraph.height-c)),t=Math.ceil(t);const u=this.scroll.verticalBarPos,g=t/(d-this.table.scenegraph.height);if((u!==t||!0===(null===(r=null===(o=this.table.options)||void 0===o?void 0:o.customConfig)||void 0===r?void 0:r.scrollEventAlwaysTrigger))&&i){let i=t;XC(i)&&!isNaN(i)||(i=0);const n=i-u;if(this.table.fireListeners(v_.CAN_SCROLL,{event:null==e?void 0:e.nativeEvent,scrollTop:i,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(s=this.table.theme.scrollStyle)||void 0===s?void 0:s.width,scrollWidth:null===(a=this.table.theme.scrollStyle)||void 0===a?void 0:a.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:g,dy:n}).some((t=>!1===t))){const t=this.scroll.verticalBarPos/(d-this.table.scenegraph.height);return void this.table.scenegraph.component.updateVerticalScrollBarPos(t)}}(t!==this.scroll.verticalBarPos||this.table.isPivotChart())&&this.updateHoverPos(-1,-1),this.scroll.verticalBarPos=t,XC(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this.table.scenegraph.setY(-t),this.table.scenegraph.component.updateVerticalScrollBarPos(g);const p=this.scroll.verticalBarPos-u;this.table.fireListeners(v_.SCROLL,{event:null==e?void 0:e.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(l=this.table.theme.scrollStyle)||void 0===l?void 0:l.width,scrollWidth:null===(h=this.table.theme.scrollStyle)||void 0===h?void 0:h.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:g,dy:p}),u!==t&&i&&this.checkVerticalScrollBarEnd()}setScrollLeft(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n,o,r,s,a,l,h;this.table.scrollLeft;const d=this.table.getAllColsWidth(),c=(this.table.getFrozenColsWidth(),(null===(n=this.table.options.customConfig)||void 0===n?void 0:n._disableColumnAndRowSizeRound)?1:0);t=Math.max(0,Math.min(t,d-this.table.scenegraph.width-c)),t=Math.ceil(t);const u=this.scroll.horizontalBarPos,g=t/(d-this.table.scenegraph.width);if((u!==t||!0===(null===(r=null===(o=this.table.options)||void 0===o?void 0:o.customConfig)||void 0===r?void 0:r.scrollEventAlwaysTrigger))&&i){let i=t;XC(i)&&!isNaN(i)||(i=0);const n=i-u;if(this.table.fireListeners(v_.CAN_SCROLL,{event:null==e?void 0:e.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:i,scrollHeight:null===(s=this.table.theme.scrollStyle)||void 0===s?void 0:s.width,scrollWidth:null===(a=this.table.theme.scrollStyle)||void 0===a?void 0:a.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:g,dx:n}).some((t=>!1===t))){const t=this.scroll.horizontalBarPos/(d-this.table.scenegraph.width);return void this.table.scenegraph.component.updateHorizontalScrollBarPos(t)}}t!==this.scroll.horizontalBarPos&&this.updateHoverPos(-1,-1),this.scroll.horizontalBarPos=t,XC(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this.table.scenegraph.setX(-t),this.table.scenegraph.component.updateHorizontalScrollBarPos(g);const p=this.scroll.horizontalBarPos-u;this.table.fireListeners(v_.SCROLL,{event:null==e?void 0:e.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(l=this.table.theme.scrollStyle)||void 0===l?void 0:l.width,scrollWidth:null===(h=this.table.theme.scrollStyle)||void 0===h?void 0:h.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:g,dx:p}),u!==t&&i&&this.checkHorizontalScrollBarEnd()}hideVerticalScrollBar(){this.table.scenegraph.component.hideVerticalScrollBar()}showVerticalScrollBar(t){this.table.scenegraph.component.showVerticalScrollBar(),t&&(clearTimeout(this._clearVerticalScrollBar),this._clearVerticalScrollBar=setTimeout((()=>{var t;null===(t=this.table.scenegraph)||void 0===t||t.component.hideVerticalScrollBar()}),1e3))}hideHorizontalScrollBar(){this.table.scenegraph.component.hideHorizontalScrollBar()}showHorizontalScrollBar(t){var e;this.table.scenegraph.component.showHorizontalScrollBar(),null===(e=this.table.scenegraph)||void 0===e||e.component.showFrozenColumnShadow(),t&&(clearTimeout(this._clearHorizontalScrollBar),this._clearHorizontalScrollBar=setTimeout((()=>{var t,e;null===(t=this.table.scenegraph)||void 0===t||t.component.hideFrozenColumnShadow(),null===(e=this.table.scenegraph)||void 0===e||e.component.hideHorizontalScrollBar()}),1e3))}triggerContextMenu(t,e,i,n){this.menu.isShow&&this.menu.x===i&&this.menu.y===n?this.hideMenu():this.showContextMenu(t,e,i,n)}showContextMenu(t,e,i,n){var o;(null===(o=this.table.internalProps.menu)||void 0===o?void 0:o.contextMenuItems)&&("html"===this.table.internalProps.menu.renderMode?this.menu.isShow=!0:(this.menu.isShow=!0,this.menu.x=i,this.menu.y=n,this.table.scenegraph.component.menu.attach(i,n,t,e,Rk.contextmenu)),this.table.fireListeners(v_.SHOW_MENU,{x:i,y:n,col:t,row:e,type:"contextmenu"}))}triggerDropDownMenu(t,e,i,n,o){this.table.fireListeners(v_.DROPDOWN_ICON_CLICK,{col:t,row:e,event:o}),this.menu.isShow?this.hideMenu():this.showDropDownMenu(t,e,i,n)}showDropDownMenu(t,e,i,n){"html"===this.table.internalProps.menu.renderMode?this.menu.isShow=!0:(this.menu.isShow=!0,this.table.scenegraph.component.menu.attach(i,n,t,e,Rk.dropDown),this.menu.bounds=this.table.scenegraph.component.menu.bounds),this.table.fireListeners(v_.SHOW_MENU,{x:i,y:n,col:t,row:e,type:"dropDown"}),this.residentHoverIcon&&this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row);const o=this.table.scenegraph.getCell(t,e);let r;o.forEachChildren((t=>t.attribute.funcType===Zw.dropDown&&(r=t,!0))),r&&(this.residentHoverIcon={col:t,row:e,icon:r},this.table.scenegraph.setIconHoverStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row,o),this.table.scenegraph.residentHoverIcon(t,e))}hideMenu(){this.menu.isShow&&(this.table.fireListeners(v_.DROPDOWN_MENU_CLEAR,null),this.table.fireListeners(v_.HIDE_MENU,null),this.menu.isShow=!1,this.table.scenegraph.component.menu.detach(),this.residentHoverIcon&&(this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row),this.table.scenegraph.resetResidentHoverIcon(this.residentHoverIcon.col,this.residentHoverIcon.row),this.residentHoverIcon=null))}setDropDownMenuHighlight(t){this.menu.dropDownMenuHighlight=t;for(let e=0;e<t.length;e++){const{col:i,row:n}=t[e],o=this.table.getCellRange(i,n);if(o)for(let t=o.start.col;t<=o.end.col;t++)for(let e=o.start.row;e<=o.end.row;e++)this.table.scenegraph.updateCellContent(t,e)}}dropDownMenuIsHighlight(t,e,i){const n=this.menu.dropDownMenuHighlight;if(Array.isArray(n))for(let o=0;o<n.length;o++){const r=n[o];let{col:s,row:a}=r;const{field:l,menuKey:h}=r;if("number"!=typeof s||"number"!=typeof a)if(this.table.isPivotTable()){const t=this.table.internalProps.layoutMap.getPivotCellAdress(l);if(!t)continue;s=t.col,a=t.row}else{const t=this.table.internalProps.layoutMap.getHeaderCellAddressByField(l);if(!t)continue;s=t.col,a=t.row}if(XC(s)&&XC(a)&&this.table.isCellRangeEqual(t,e,s,a)){let n=this.table._getHeaderLayoutMap(null!=s?s:t,null!=a?a:e).dropDownMenu||this.table.globalDropDownMenu;if("function"==typeof n&&(n=n({row:a,col:s,table:this.table})),n)for(let t=0;t<n.length;t++){const e=n[t];if($C(e)&&(e.menuKey||e.text)===(h||"")&&t===i)return!0;if(qC(e)&&e===h&&t===i)return!0}}}return!1}triggerSort(t,e,i,n){if(this.table.isPivotTable()){const i=this.table.getPivotSortState(t,e),o=i?i.toUpperCase():"NORMAL",r="ASC"===o?"DESC":"DESC"===o?"NORMAL":"ASC";return this.table.sort(t,e,r),void this.table.fireListeners(WP.PIVOT_SORT_CLICK,{col:t,row:e,order:o||"normal",dimensionInfo:this.table.internalProps.layoutMap.getPivotDimensionInfo(t,e),cellLocation:this.table.getCellLocation(t,e),event:n})}const o=[...this.sort],r=this.table.internalProps.multipleSort||!o.length?null:this.sort[this.sort.length-1];zP(t,e,this.table,n);const s=this.table.getCellRange(t,e),a=this.sort.find((t=>t.col===s.start.col&&t.row===s.start.row)),l=this.table.internalProps.multipleSort||!r?null:r.col,h=this.table.internalProps.multipleSort||!r?null:r.row,d=o.findIndex((i=>i.col===t&&i.row===e));d>=0&&o.splice(d,1),this.table.scenegraph.updateSortIcon({col:t,row:e,iconMark:i,order:null==a?void 0:a.order,oldSortCol:l,oldSortRow:h,oldIconMark:null==r?void 0:r.icon}),a&&(a.icon=i),this.table.internalProps.multipleSort||o.forEach((t=>{this.table.scenegraph.updateSortIcon({col:null,row:null,iconMark:null,order:"normal",oldSortCol:t.col,oldSortRow:t.row,oldIconMark:null})})),this.table.fireListeners(WP.AFTER_SORT,{order:null==a?void 0:a.order,field:this.table.getHeaderField(t,e),event:n})}updateSortState(t){var e,i,n,o,r,s,a,l;t=Array.isArray(t)?t:[t];for(let l=0;l<t.length;l++){if(t[l].field===(null===(e=this.sort[l])||void 0===e?void 0:e.field)&&t[t.length-1].order===(null===(i=this.sort[l])||void 0===i?void 0:i.order))return;const h=this.table.internalProps.multipleSort?null:(null===(n=this.sort[l])||void 0===n?void 0:n.col)||null,d=this.table.internalProps.multipleSort?null:(null===(o=this.sort[l])||void 0===o?void 0:o.row)||null;"asc"===(null===(r=this.sort[l])||void 0===r?void 0:r.order)||null===(s=this.sort[l])||void 0===s||s.order,this.setSortState(t.slice(0,l+1));const c=this.table.internalProps.layoutMap.getHeaderCellAddressByField(t[l].field);let u;this.sort[l].col=c.col,this.sort[l].row=c.row,Vx(this.table.scenegraph.getCell(this.sort[l].col,this.sort[l].row),"children",(t=>"sort"===t.attribute.funcType&&(u=t,!0))),this.table.scenegraph.updateSortIcon({col:this.sort[l].col,row:this.sort[l].row,iconMark:u,order:this.sort[l].order,oldSortCol:h,oldSortRow:d,oldIconMark:null===(a=this.sort[l])||void 0===a?void 0:a.icon})}const h=[];this.table.internalProps.layoutMap.columnTree.tree.children.forEach((e=>{t.some((t=>t.field===e.field))||h.push(e)}));for(let t=0;t<h.length;t++){const e=h[t];this.table.scenegraph.updateSortIcon({col:null,row:null,iconMark:null,order:null,oldSortCol:null!==(l=e.startInTotal+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)&&void 0!==l?l:0,oldSortRow:e.level,oldIconMark:null})}}triggerFreeze(t,e,i){if(!this.table.isPivotTable()&&!this.table.transpose){if(function(t,e,i){i.frozenColCount>0?t!==i.frozenColCount-1?i.setFrozenColCount(t+1):i.setFrozenColCount(0):i.setFrozenColCount(t+1)}(t,0,this.table),this.table.hasListeners(WP.FREEZE_CLICK)){const i=this.table.internalProps.layoutMap.columnObjects.slice(0,t+1);this.table.fireListeners(WP.FREEZE_CLICK,{col:t,row:e,fields:i.reduce(((t,e)=>t.concat(e.field)),[]),colCount:this.table.frozenColCount})}this.frozen.icon=i}}updateCursor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this.table.getElement().style.cursor=t}updateDrillState(t,e,i,n,o,r){this.drill.dimensionKey=t,this.drill.title=e,this.drill.drillDown=i,this.drill.drillUp=n,this.drill.col=o,this.drill.row=r,function(t,e,i,n,o){const r=o.getCellLocation(t,e);let s=0,a=0,l=!1;"columnHeader"===r?(s=o.getColsWidth(0,o.rowHeaderLevelCount-1)-(0===o.frozenColCount?o.scrollLeft:0),a=o.getRowsHeight(0,e-1)+o.getRowHeight(e)/2,l=!0):"rowHeader"===r&&(a=o.getRowsHeight(0,o.columnHeaderLevelCount-1),s=o.getColsWidth(0,t-1)+o.getColWidth(t)/2,l=!0),o.scenegraph.updateDrill(l,s,a,i,n)}(o,r,i,n,this.table)}updateSparklineHoverPose(t,e,i,n){-1!==this.sparkLine.col&&-1!==this.sparkLine.row&&function(t,e,i){const n=i.scenegraph.getCell(t,e).getChildByName("sparkline"),o=null==n?void 0:n.getChildByName("highlight-line"),r=null==n?void 0:n.getChildByName("highlight-symbol");o&&o.setAttributes({visible:!1,pickable:!1}),r&&r.setAttributes({visible:!1,pickable:!1}),i.scenegraph.updateNextFrame()}(this.sparkLine.col,this.sparkLine.row,this.table);let o=!1;-1!==t&&-1!==e&&(o=function(t,e,i,n,o){var r,s;const a=o.scenegraph.getCell(t,e).getChildByName("sparkline"),l=null==a?void 0:a.getChildByName("sparkline-line"),h=null==a?void 0:a.getChildByName("sparkline-symbol-group");if(!l)return!1;const d=l.bandwidth,c=l.min,u=l.max,g=l.attribute.points;let p;i-=a.globalAABBBounds.x1,a.globalAABBBounds.y1;for(let t=0;t<g.length;t++){const{x:e,y:n,defined:o,rawData:f}=g[t];if(Math.abs(i-e)<d/2&&(p={point:g[t],points:g,pointsBandWidth:d,pointData:f},o)){const t=a.getChildByName("highlight-line");if(t)t.setAttributes({points:[{x:e,y:u},{x:e,y:c}],visible:!0,pickable:!0});else{const t=$l({points:[{x:e,y:u},{x:e,y:c}],lineWidth:null===(r=l.hover)||void 0===r?void 0:r.strokeWidth,stroke:null===(s=l.hover)||void 0===s?void 0:s.stroke});t.name="highlight-line",a.addChild(t)}const i=a.getChildByName("highlight-symbol");if(i)i.setAttributes({x:e,y:n,visible:!0,pickable:!0});else{const t=Vl({x:e,y:n,stroke:h.hover.stroke,lineWidth:h.hover.strokeWidth,fill:h.hover.fill,size:2*h.hover.size,symbolType:"circle"});t.name="highlight-symbol",a.addChild(t)}break}}if(o.scenegraph.updateNextFrame(),p){const i={col:t,row:e,field:o.getHeaderField(t,e),value:o.getCellValue(t,e),dataValue:o.getCellOriginValue(t,e),cellHeaderPaths:o.internalProps.layoutMap.getCellHeaderPaths(t,e),title:o.getBodyColumnDefine(t,e).title,cellRange:o.getCellRelativeRect(t,e),sparkline:{pointData:p.pointData},scaleRatio:o.canvas.getBoundingClientRect().width/o.canvas.offsetWidth};o.fireListeners(v_.MOUSEOVER_CHART_SYMBOL,i)}return!0}(t,e,i,0,this.table)),o?(this.sparkLine.col=t,this.sparkLine.row=e):(this.sparkLine.col=-1,this.sparkLine.row=-1)}setCheckedState(t,e,i,n){return function(t,e,i,n,o){const r=o.table.getCellRange(t,e);if(r.start.col!==r.end.col||r.start.row!==r.end.row)for(let t=r.start.col;t<=r.end.col;t++)for(let e=r.start.row;e<=r.end.row;e++)VP(t,e,i,n,o);else VP(t,e,i,n,o)}(t,e,i,n,this)}setHeaderCheckedState(t,e){return function(t,e,i){var n;i.headerCheckedState[t]=e,null===(n=i.checkedState)||void 0===n||n.forEach((i=>{i[t]=e}))}(t,e,this)}syncCheckedState(t,e,i,n){return function(t,e,i,n,o){var r,s;if(o.table.isHeader(t,e)){if(XC(o.headerCheckedState[i]))return o.headerCheckedState[i];if("function"==typeof n)return;if(XC(n))o.headerCheckedState[i]=n;else if((null===(r=o.checkedState)||void 0===r?void 0:r.size)>0)return o.updateHeaderCheckedState(i,t,e);return o.headerCheckedState[i]}const a=o.table.getRecordShowIndexByCell(t,e);if(a>=0){const t=o.table.dataSource.getIndexKey(a).toString();if(XC(null===(s=o.checkedState.get(t))||void 0===s?void 0:s[i]))return o.checkedState.get(t)[i];if(o.checkedState.get(t))o.checkedState.get(t)[i]=n;else if(t.includes(",")){const e=t.split(",").slice(0,-1).join(",");o.checkedState.has(e)&&!0===o.checkedState.get(e)[i]?o.checkedState.set(t,{[i]:!0}):o.checkedState.set(t,{[i]:n})}else o.checkedState.set(t,{[i]:n})}return n}(t,e,i,n,this)}initCheckedState(t){return UP(t,this)}updateHeaderCheckedState(t,e,i){return function(t,e,i,n){let o=!0,r=!0,s=!1;return e.checkedState.forEach(((a,l)=>{var h,d;l=l.includes(",")?l.split(",").map((t=>Number(t))):Number(l);const c=e.table.getTableIndexByRecordIndex(l),u=e.table.transpose?e.table.getCustomMerge(c,n):e.table.getCustomMerge(i,c),g=null===(h=e.table.dataSource)||void 0===h?void 0:h.get(l);u||!(null===(d=e.table.internalProps.rowSeriesNumber)||void 0===d?void 0:d.enableTreeCheckbox)&&(null==g?void 0:g.vtableMerge)||(!0!==(null==a?void 0:a[t])?o=!1:(r=!1,s=!0))})),o?(e.headerCheckedState[t]=!0,o):r?(e.headerCheckedState[t]=!1,!1):!!s&&(e.headerCheckedState[t]="indeterminate","indeterminate")}(t,this,e,i)}initLeftRecordsCheckState(t){return function(t,e){for(let i=e.checkedState.size;i<t.length;i++){const n=t[i];e._checkboxCellTypeFields.forEach((t=>{const o=n[t];let r;$C(o)?r=o.checked:"boolean"==typeof o&&(r=o);const s=i.toString();e.checkedState.get(s)||e.checkedState.set(s,{}),e.checkedState.get(s)[t]=r}))}}(t,this)}setRadioState(t,e,i,n,o){!function(t,e,i,n,o,r){const s=r.table.getRecordShowIndexByCell(t,e);if(s>=0){const t=r.table.dataSource.getIndexKey(s);"column"===n?tw(o)?(r.radioState[i]={},r.radioState[i][t]=o):r.radioState[i]=t:(r.radioState[i]||(r.radioState[i]={}),tw(o)?r.radioState[i][t]=o:r.radioState[i][t]=!0)}}(t,e,i,n,o,this)}syncRadioState(t,e,i,n,o,r){return function(t,e,i,n,o,r,s){var a,l,h,d,c;const u=s.table.getRecordShowIndexByCell(t,e);if(u>=0){const t=s.table.dataSource.getIndexKey(u);if("column"===n){if(!XC(s.radioState[i])&&r)return tw(o)?(s.radioState[i]={},s.radioState[i][t]=o):s.radioState[i]=t,!0;if(tw(s.radioState[i])&&!tw(o))return s.radioState[i]===t;if(tw(s.radioState[i])&&tw(o))return!1;if($C(s.radioState[i])&&!tw(o))return!1;if($C(s.radioState[i])&&tw(o))return s.radioState[i][t]===o}else if("cell"===n){if(!XC(s.radioState[i])&&r)return s.radioState[i]={},tw(o)?s.radioState[i][t]=o:s.radioState[i][t]=!0,!0;if(!XC(null===(a=s.radioState[i])||void 0===a?void 0:a[t])&&r)return tw(o)?s.radioState[i][t]=o:s.radioState[i][t]=!0,!0;if(jC(null===(l=s.radioState[i])||void 0===l?void 0:l[t])&&!tw(o))return s.radioState[i][t];if(jC(null===(h=s.radioState[i])||void 0===h?void 0:h[t])&&tw(o))return!1;if(tw(null===(d=s.radioState[i])||void 0===d?void 0:d[t])&&!tw(o))return!1;if(tw(null===(c=s.radioState[i])||void 0===c?void 0:c[t])&&tw(o))return s.radioState[i][t]===o}}return r}(t,e,i,n,o,r,this)}changeCheckboxAndRadioOrder(t,e){this.checkedState.size&&function(t,e,i){const{checkedState:n,table:o}=i;let r,s;if(o.internalProps.transpose?(t=o.getRecordShowIndexByCell(t,0),e=o.getRecordShowIndexByCell(e,0)):(r=o.isPivotTable()?void 0:o.getRecordIndexByCell(0,t),s=o.isPivotTable()?void 0:o.getRecordIndexByCell(0,e)),tw(r)&&tw(s)){if((t=r)>(e=s)){const i=n.get(t.toString());for(let i=t;i>e;i--)n.set(i.toString(),n.get((i-1).toString()));n.set(e.toString(),i)}else if(t<e){const i=n.get(t.toString());for(let i=t;i<e;i++)n.set(i.toString(),n.get((i+1).toString()));n.set(e.toString(),i)}}else if(ZC(r)&&ZC(s))if((t=r[r.length-1])>(e=s[s.length-1])){const i=n.get(r.toString());for(let i=t;i>e;i--){const t=[...r];t[t.length-1]=i;const e=[...r];e[e.length-1]=i-1,n.set(t.toString(),n.get(e.toString()))}n.set(s.toString(),i)}else if(t<e){const i=n.get(r.toString());for(let i=t;i<e;i++){const t=[...r];t[t.length-1]=i;const e=[...r];e[e.length-1]=i+1,n.set(t.toString(),n.get(e.toString()))}n.set(s.toString(),i)}}(t,e,this),this.radioState.length&&function(t,e,i){const{radioState:n,table:o}=i;if(o.internalProps.transpose?(t=o.getRecordShowIndexByCell(t,0),e=o.getRecordShowIndexByCell(e,0)):(t=o.getRecordShowIndexByCell(0,t),e=o.getRecordShowIndexByCell(0,e)),t>e){const i=n[t];for(let i=t;i>e;i--)n[i]=n[i-1];n[e]=i}else if(t<e){const i=n[t];for(let i=t;i<e;i++)n[i]=n[i+1];n[e]=i}}(t,e,this)}setCustomSelectRanges(t){(function(t){const{customSelectedRangeComponents:e}=t.table.scenegraph;e.forEach(((t,e)=>{t.rect.delete()})),e.clear(),t.select.customSelectRanges=[]})(this),function(t,e){const{customSelectedRangeComponents:i}=e.table.scenegraph;t.forEach((t=>{var e,n,o,r;const{range:s,style:a}=t,l=ql({fill:null!==(e=a.cellBgColor)&&void 0!==e&&e,stroke:null!==(n=a.cellBorderColor)&&void 0!==n&&n,lineWidth:null!==(o=a.cellBorderLineWidth)&&void 0!==o?o:0,lineDash:null!==(r=a.cellBorderLineDash)&&void 0!==r?r:[],pickable:!1});i.set(`${s.start.col}-${s.start.row}-${s.end.col}-${s.end.row}`,{rect:l,role:"body"})})),e.select.customSelectRanges=t,jL(e.table.scenegraph),e.table.scenegraph.updateNextFrame()}(t,this)}}(this),this.eventManager=new class{constructor(t){this.isDown=!1,this.isDraging=!1,this.globalEventListeners=[],this._enableTableScroll=!0,this.table=t,this.handleTextStickBindId=[],this.inertiaScroll=new JP(t.stateManager),"node"===kx.mode||t.options.disableInteraction||(this.bindOuterEvent(),setTimeout((()=>{this.bindSelfEvent()}),0))}bindOuterEvent(){tE(this),function(t){const e=t.table,i=e.stateManager,n=e.internalProps.handler;function o(t){var i;if(e.hasListeners(v_.KEYDOWN)){const n={keyCode:null!==(i=t.keyCode)&&void 0!==i?i:t.which,code:t.code,event:t,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth};e.fireListeners(v_.KEYDOWN,n)}}n.on(e.getElement(),"blur",(e=>{t.dealTableHover()})),n.on(e.getElement(),"keydown",(n=>{var r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B,T,R,k,M,L,P;const E={keyCode:null!==(r=n.keyCode)&&void 0!==r?r:n.which,code:n.code,event:n};if(e.fireListeners(v_.BEFORE_KEYDOWN,E),"a"===n.key&&(n.ctrlKey||n.metaKey))(null===(s=e.keyboardOptions)||void 0===s?void 0:s.selectAllOnCtrlA)&&(n.preventDefault(),t.deelTableSelectAll());else if(i.select.cellPos.col>=0&&i.select.cellPos.row>=0&&("ArrowUp"===n.key||"ArrowDown"===n.key||"ArrowLeft"===n.key||"ArrowRight"===n.key)){if((null===(l=null===(a=e.options.keyboardOptions)||void 0===a?void 0:a.moveEditCellOnArrowKeys)||void 0===l||!l)&&(null===(h=e.editorManager)||void 0===h?void 0:h.editingEditor)||!1===(null===(d=e.options.keyboardOptions)||void 0===d?void 0:d.moveSelectedCellOnArrowKeys))return;let t,o;if(n.preventDefault(),n.stopPropagation(),"ArrowUp"===n.key?n.ctrlKey||n.metaKey?(t=i.select.cellPos.col,o=0):(n.shiftKey,t=i.select.cellPos.col,o=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row-1))):"ArrowDown"===n.key?n.ctrlKey||n.metaKey?(t=i.select.cellPos.col,o=e.rowCount-1):(n.shiftKey,t=i.select.cellPos.col,o=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row+1))):"ArrowLeft"===n.key?n.ctrlKey||n.metaKey?(t=0,o=i.select.cellPos.row):(n.shiftKey,o=i.select.cellPos.row,t=Math.min(e.colCount-1,Math.max(0,i.select.cellPos.col-1))):"ArrowRight"===n.key&&(n.ctrlKey||n.metaKey?(t=e.colCount-1,o=i.select.cellPos.row):(n.shiftKey,o=i.select.cellPos.row,t=Math.min(e.colCount-1,Math.max(0,i.select.cellPos.col+1)))),xM(e,t,o))return;e.selectCell(t,o,n.shiftKey),null!==(u=null===(c=e.options.keyboardOptions)||void 0===c?void 0:c.moveEditCellOnArrowKeys)&&void 0!==u&&u&&(null===(g=e.editorManager)||void 0===g?void 0:g.editingEditor)&&(null===(p=e.editorManager)||void 0===p||p.completeEdit(),e.getElement().focus(),e.getEditor(t,o)&&(null===(f=e.editorManager)||void 0===f||f.startEditCell(t,o)))}else if("Escape"===n.key)null===(v=e.editorManager)||void 0===v||v.cancelEdit(),e.getElement().focus();else if("Enter"===n.key){if(null===(b=e.editorManager)||void 0===b?void 0:b.editingEditor){if(o(n),null===(m=e.editorManager)||void 0===m||m.completeEdit(),e.getElement().focus(),!0===(null===(y=e.options.keyboardOptions)||void 0===y?void 0:y.moveFocusCellOnEnter)){const t=i.select.cellPos.col,o=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row+1));if(xM(e,t,o))return;e.selectCell(t,o,n.shiftKey)}return}if(!0===(null===(C=e.options.keyboardOptions)||void 0===C?void 0:C.moveFocusCellOnEnter)){const t=i.select.cellPos.col,o=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row+1));if(xM(e,t,o))return;e.selectCell(t,o,n.shiftKey)}else if((null===(x=null===(w=e.options.keyboardOptions)||void 0===w?void 0:w.editCellOnEnter)||void 0===x||x)&&1===(null!==(S=null===(_=e.stateManager.select.ranges)||void 0===_?void 0:_.length)&&void 0!==S?S:0)){const t=e.stateManager.select.ranges[0].start.col,i=e.stateManager.select.ranges[0].start.row,n=e.stateManager.select.ranges[0].end.col,o=e.stateManager.select.ranges[0].end.row;t===n&&i===o&&e.getEditor(t,i)&&(null===(A=e.editorManager)||void 0===A||A.startEditCell(t,i))}}else if("Tab"===n.key){if((null===(T=null===(B=e.options.keyboardOptions)||void 0===B?void 0:B.moveFocusCellOnTab)||void 0===T||T)&&i.select.cellPos.col>=0&&i.select.cellPos.row>=0){if(i.select.cellPos.col===e.colCount-1&&i.select.cellPos.row===e.rowCount-1)return;let t,o;if(n.preventDefault(),i.select.cellPos.col===e.colCount-1?(o=Math.min(e.rowCount-1,i.select.cellPos.row+1),t=e.rowHeaderLevelCount):(o=i.select.cellPos.row,t=i.select.cellPos.col+1),xM(e,t,o))return;e.selectCell(t,o),(null===(R=e.editorManager)||void 0===R?void 0:R.editingEditor)&&(null===(k=e.editorManager)||void 0===k||k.completeEdit(),e.getElement().focus(),e.getEditor(t,o)&&(null===(M=e.editorManager)||void 0===M||M.startEditCell(t,o)))}}else if(!n.ctrlKey&&!n.metaKey){const t=e.options.editCellTrigger;if(("keydown"===t||Array.isArray(t)&&t.includes("keydown"))&&!(null===(L=e.editorManager)||void 0===L?void 0:L.editingEditor)){const t=/^[a-zA-Z0-9+\-*\/%=.,\s]$/;n.key.match(t)&&(e.editorManager&&(e.editorManager.beginTriggerEditCellMode="keydown"),null===(P=e.editorManager)||void 0===P||P.startEditCell(i.select.cellPos.col,i.select.cellPos.row,""))}}o(n)})),n.on(e.getElement(),"copy",(t=>sE(this,void 0,void 0,(function*(){var i,n;if(null===(i=e.keyboardOptions)||void 0===i?void 0:i.copySelected){const i=e.getCopyValue();if(XC(i)){t.preventDefault();const o=yield navigator.permissions.query({name:"clipboard-write"});if((null===(n=navigator.clipboard)||void 0===n?void 0:n.write)&&"granted"===o.state){const t=t=>{const e=["<table>"],i=['<meta name="author" content="Visactor"/>','<style type="text/css">td{white-space:normal}br{mso-data-placement:same-cell}</style>'].join(""),n=t.split("\r\n");return n.forEach((function(t,i){const o=t.split("\t"),r=[];0===i&&e.push("<tbody>"),o.forEach((function(t,e){const i=t?t.toString().replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/(<br(\s*|\/)>(\r\n|\n)?|\r\n|\n)/g,"<br>\r\n").replace(/\x20{2,}/gi,(t=>`<span style="mso-spacerun: yes">${"&nbsp;".repeat(t.length-1)} </span>`)).replace(/\t/gi,"&#9;"):" ";r.push(`<td>${i}</td>`)})),e.push("<tr>",...r,"</tr>"),i===n.length-1&&e.push("</tbody>")})),e.push("</table>"),[i,e.join("")].join("")},e=t(i);navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([e],{type:"text/html"}),"text/plain":new Blob([i],{type:"text/plain"})})])}else d_?window.clipboardData.setData("Text",i):t.clipboardData.setData("text/plain",i);e.fireListeners(v_.COPY_DATA,{cellRange:e.stateManager.select.ranges,copyData:i})}}})))),n.on(e.getElement(),"paste",(t=>{var i,n,o,r;if((null===(i=e.keyboardOptions)||void 0===i?void 0:i.pasteValueToCell)&&e.changeCellValues){if(null===(n=e.editorManager)||void 0===n?void 0:n.editingEditor)return;if((null===(o=e.stateManager.select.ranges)||void 0===o?void 0:o.length)>0)if(null===(r=navigator.clipboard)||void 0===r?void 0:r.read)navigator.clipboard.read().then((t=>{for(const e of t)e.types.includes("text/html")?a(e):1===e.types.length&&"text/plain"===e.types[0]&&h(e)}));else{const i=e.stateManager.select.ranges,n=Math.min(i[0].start.col,i[0].end.col),o=Math.min(i[0].start.row,i[0].end.row),r=(t.clipboardData||window.Clipboard).getData("text").split("\n"),s=[];r.forEach((function(t,e){const i=t.split("\t"),n=[];s.push(n),i.forEach((function(t,e){e===i.length-1&&(t=t.trim()),n.push(t)}))}));const a=e.changeCellValues(n,o,s);e.hasListeners(v_.PASTED_DATA)&&e.fireListeners(v_.PASTED_DATA,{col:n,row:o,pasteData:s,changedCellResults:a})}}})),n.on(e.getElement(),"contextmenu",(t=>{var i;!1!==(null===(i=e.eventOptions)||void 0===i?void 0:i.preventDefaultContextMenu)?t.preventDefault():u(t)})),e.options.canvas||n.on(e.getContainer(),"resize",(t=>{var i;e.isReleased||0===t.width&&0===t.height||((e.autoFillWidth||e.autoFillHeight)&&(null===(i=e.editorManager)||void 0===i||i.completeEdit()),XC(e.options.pixelRatio)||e.setPixelRatio(rE()),t.windowSizeNotChange||e.resize())}));const r=/<tr[^>]*>([\s\S]*?)<\/tr>/g,s=/<td[^>]*>([\s\S]*?)<\/td>/g;function a(t){const i=e.stateManager.select.ranges,n=i.length,o=Math.min(i[n-1].start.col,i[n-1].end.col),a=Math.min(i[n-1].start.row,i[n-1].end.row),h=Math.max(i[n-1].start.col,i[n-1].end.col),c=Math.max(i[n-1].start.row,i[n-1].end.row);let u=0,g=0,p=[];t.getType("text/html").then((t=>{t.text().then((t=>{var i,n;if(t&&/(<table)|(<TABLE)/g.test(t)){const l=Array.from(t.matchAll(r));for(const t of l){const e=t[1],n=Array.from(e.matchAll(s)).map((t=>t[1].replace(/(<(?!br)([^>]+)>)/gi,"").replace(/<br(\s*|\/)>[\r\n]?/gim,"\n").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#9;/gi,"\t").replace(/&nbsp;/g," ")));p.push(n),u=Math.max(u,null!==(i=null==n?void 0:n.length)&&void 0!==i?i:0)}g=null!==(n=p.length)&&void 0!==n?n:0,p=d(p,g,u,c-a+1,h-o+1);const f=e.changeCellValues(o,a,p,!0);e.hasListeners(v_.PASTED_DATA)&&e.fireListeners(v_.PASTED_DATA,{col:o,row:a,pasteData:p,changedCellResults:f})}else navigator.clipboard.read().then((t=>{for(const e of t)e.types.includes("text/plain")&&e.getType("text/plain").then((t=>{t.text().then(l)}))}))}))}))}function l(t){var i;const n=e.stateManager.select.ranges,o=n.length,r=Math.min(n[o-1].start.col,n[o-1].end.col),s=Math.min(n[o-1].start.row,n[o-1].end.row),a=Math.max(n[o-1].start.col,n[o-1].end.col),l=Math.max(n[o-1].start.row,n[o-1].end.row);let h=0,c=0,u=[];t.split("\n").forEach((function(t,e){var i;const n=t.split("\t"),o=[];u.push(o),n.forEach((function(t,e){e===n.length-1&&(t=t.trim()),o.push(t)})),h=Math.max(h,null!==(i=null==o?void 0:o.length)&&void 0!==i?i:0)})),c=null!==(i=u.length)&&void 0!==i?i:0,u=d(u,c,h,l-s+1,a-r+1);const g=e.changeCellValues(r,s,u,!0);e.hasListeners(v_.PASTED_DATA)&&e.fireListeners(v_.PASTED_DATA,{col:r,row:s,pasteData:u,changedCellResults:g})}function h(t){const i=e.stateManager.select.ranges,n=i.length,o=Math.min(i[n-1].start.col,i[n-1].end.col),r=Math.min(i[n-1].start.row,i[n-1].end.row),s=Math.max(i[n-1].start.col,i[n-1].end.col),a=Math.max(i[n-1].start.row,i[n-1].end.row);let l=0,h=0;t.getType("text/plain").then((t=>{t.text().then((t=>{var i;const n=t.replace(/\r(?!\n)/g,"\r\n").split("\r\n");let c=[];n.length>1&&""===n[n.length-1]&&n.pop(),n.forEach((function(t,e){var i;const n=t.split("\t"),o=[];c.push(o),n.forEach((function(t,e){t.includes("\n")&&(t=t.replace(/^"(.*)"$/,"$1").replace(/["]*/g,(t=>new Array(Math.floor(t.length/2)).fill('"').join("")))),o.push(t)})),l=Math.max(l,null!==(i=null==o?void 0:o.length)&&void 0!==i?i:0)})),h=null!==(i=c.length)&&void 0!==i?i:0,c=d(c,h,l,a-r+1,s-o+1);const u=e.changeCellValues(o,r,c,!0);e.hasListeners(v_.PASTED_DATA)&&e.fireListeners(v_.PASTED_DATA,{col:o,row:r,pasteData:c,changedCellResults:u})}))}))}function d(t,e,i,n,o){if(o>i||n>e){if(o%i==0&&n%e==0){const r=[];for(let s=0;s<n;s++){const n=[];r.push(n);for(let r=0;r<o;r++){const o=s%e,a=r%i;n.push(t[o][a])}}return r}return t}return t}const c=n=>{var o;if(e.isReleased)return;e.eventManager.LastBodyPointerXY={x:n.x,y:n.y},e.eventManager.isDown=!0;const r=n.target;e.getElement().contains(r)||e.internalProps.menuHandler.containElement(r)||r_(null===(o=e.editorManager)||void 0===o?void 0:o.completeEdit(n),(n=>{var o,r;if(!1!==n&&(null===(o=e.options.select)||void 0===o?void 0:o.outsideClickDeselect)){const e=!!(null===(r=i.select.ranges)||void 0===r?void 0:r.length);t.dealTableSelect(),i.endSelectCells(!0,e)}}))};t.globalEventListeners.push({name:"pointerdown",env:"vglobal",callback:c}),Pu.addEventListener("pointerdown",c);const u=n=>{var o,r;if(e.isReleased)return;const s=n.target;if(s!==e.canvas&&(t=>{var n,o;if(i.menu.isShow&&setTimeout((()=>{e.internalProps.menuHandler.pointInMenuElement(t.clientX,t.clientY)||i.menu.isShow&&i.hideMenu()}),0),i.isResizeCol())iE(e);else if(i.isResizeRow())nE(e);else if(i.isMoveCol()){const i=e.stateManager.endMoveCol();QP(e,i,t)}else if(i.isSelecting()&&(null===(o=null===(n=e.stateManager.select)||void 0===n?void 0:n.ranges)||void 0===o?void 0:o.length)){const i=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end.col,n=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end.row;if(e.stateManager.endSelectCells(),e.hasListeners(v_.DRAG_SELECT_END)){const o={event:t,cells:[],col:i,row:n,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:void 0};o.cells=e.getSelectedCellInfos(),e.fireListeners(v_.DRAG_SELECT_END,o)}}})(n),e.eventManager.LastBodyPointerXY=null,e.eventManager.isDown=!1,e.eventManager.isDraging=!1,e.eventManager.inertiaScroll.endInertia(),"grabing"===i.interactionState&&i.isResizeCol())iE(e);else if("grabing"===i.interactionState&&i.isResizeRow())nE(e);else if(i.isMoveCol()){const t=e.stateManager.endMoveCol();QP(e,t,n)}else(null===(o=e.editorManager)||void 0===o?void 0:o.editingEditor)&&!e.getElement().contains(s)&&r_(null===(r=e.editorManager)||void 0===r?void 0:r.completeEdit(n),(e=>{!1!==e&&(i.updateInteractionState(jw.default),t.dealTableHover())}));i.updateInteractionState(jw.default)};t.globalEventListeners.push({name:"pointerup",env:"vglobal",callback:u}),Pu.addEventListener("pointerup",u);const g=n=>{var o,r,s,a,l;if(e.eventManager.isDown&&e.eventManager.LastBodyPointerXY){const t=null!==(r=null===(o=e.eventManager.LastBodyPointerXY)||void 0===o?void 0:o.x)&&void 0!==r?r:n.x,i=null!==(a=null===(s=e.eventManager.LastBodyPointerXY)||void 0===s?void 0:s.y)&&void 0!==a?a:n.y;(Math.abs(t-n.x)>1||Math.abs(i-n.y)>1)&&(e.eventManager.isDraging=!0)}const{x:h,y:d}=e._getMouseAbstractPoint(n);i.interactionState===jw.grabing&&(i.isResizeCol()?(t.dealColumnResize(h,d),e.hasListeners(v_.RESIZE_COLUMN)&&e.fireListeners(v_.RESIZE_COLUMN,{col:e.stateManager.columnResize.col,colWidth:e.getColWidth(e.stateManager.columnResize.col)})):i.isResizeRow()&&(t.dealRowResize(h,d),e.hasListeners(v_.RESIZE_ROW)&&e.fireListeners(v_.RESIZE_ROW,{row:e.stateManager.rowResize.row,rowHeight:e.getRowHeight(e.stateManager.rowResize.row)})));const c=e.stateManager.isSelecting();if(t._enableTableScroll&&t.isDraging&&c&&(null===(l=e.stateManager.select.ranges)||void 0===l?void 0:l.length)>0){const t=e.getDrawRange(),i=e.getFrozenRowsHeight(),n=e.getBottomFrozenRowsHeight(),o=e.getFrozenColsWidth(),r=e.getRightFrozenColsWidth(),s=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].start;if(e.isSeriesNumber(s.col,s.row))return;const a=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end,l=(!1===e.isFrozenRow(s.row)||!1===e.isFrozenRow(a.row))&&e.getAllRowsHeight()>e.tableNoFrameHeight,c=(!1===e.isFrozenColumn(s.col)||!1===e.isFrozenColumn(a.col))&&e.getAllColsWidth()>e.tableNoFrameWidth;if((d>t.bottom-n||d<t.top+i)&&l||(h>t.right-r||h<t.left+o)&&c){e.eventManager.scrollXSpeed=0,e.eventManager.scrollYSpeed=0;let s=!1,a=!1,u=!1,g=!1;d>t.bottom-n&&l&&e.scrollTop+e.tableNoFrameHeight<e.getAllRowsHeight()?(s=!0,e.eventManager.scrollYSpeed=-(d-t.bottom+n)/50):d<t.top+i&&l&&e.scrollTop>0&&(a=!0,e.eventManager.scrollYSpeed=-(d-t.top-i)/50),h>t.right-r&&c&&e.scrollLeft+e.tableNoFrameWidth<e.getAllColsWidth()?(u=!0,e.eventManager.scrollXSpeed=-(h-t.right+r)/50):h<t.left+o&&c&&e.scrollLeft>0&&(g=!0,e.eventManager.scrollXSpeed=-(h-t.left-o)/50),e.eventManager.inertiaScroll.startInertia(e.eventManager.scrollXSpeed,e.eventManager.scrollYSpeed,1),e.eventManager.inertiaScroll.setScrollHandle(((l,c)=>{var p;let f,v;KP({deltaX:-l,deltaY:-c},e.stateManager,!1),s?v=e.scrollTop+t.height-n-20:a&&(v=e.scrollTop+i+20),u?f=e.scrollLeft+t.width-r-20:g&&(f=e.scrollLeft+o+20);let b=!1,m=!1;u||g||(h>e.tableNoFrameWidth-e.getRightFrozenColsWidth()&&h<e.tableNoFrameWidth||h>0&&h<e.getFrozenColsWidth()?(f=h,m=!0):f=e.scrollLeft+h),s||a||(d>e.tableNoFrameHeight-e.getBottomFrozenRowsHeight()&&d<e.tableNoFrameHeight||d>0&&d<e.getFrozenRowsHeight()?(v=d,b=!0):v=e.scrollTop+d),e.stateManager.updateInteractionState(jw.grabing);const y=e.getTargetColAtConsiderRightFrozen(f,m),C=e.getTargetRowAtConsiderBottomFrozen(v,b);!(null===(p=e.options.select)||void 0===p?void 0:p.disableDragSelect)&&XC(y)&&XC(C)&&e.stateManager.updateSelectPos(y.col,C.row,!1,!1,!1,!1)}))}else e.eventManager.inertiaScroll.isInertiaScrolling()?e.eventManager.inertiaScroll.endInertia():e.eventManager.scrollYSpeed=0}};t.globalEventListeners.push({name:"pointermove",env:"vglobal",callback:g}),Pu.addEventListener("pointermove",g)}(this),function(t){const e=t.table,i=e.stateManager,n=e.scenegraph;n.component.vScrollBar.addEventListener("pointerover",(t=>{i.showVerticalScrollBar()})),n.component.hScrollBar.addEventListener("pointerover",(t=>{i.showHorizontalScrollBar()})),n.component.vScrollBar.addEventListener("pointerout",(t=>{i.interactionState!==jw.scrolling&&i.hideVerticalScrollBar()})),n.component.hScrollBar.addEventListener("pointerout",(t=>{i.interactionState!==jw.scrolling&&i.hideHorizontalScrollBar()})),n.component.vScrollBar.addEventListener("pointermove",(t=>{n.table.stateManager.updateCursor("default"),t.stopPropagation()})),n.component.vScrollBar.addEventListener("pointerdown",(t=>{t.stopPropagation(),n.table.hasListeners(v_.MOUSEDOWN_TABLE)&&n.table.fireListeners(v_.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),n.component.vScrollBar.addEventListener("scrollDown",(t=>{var e;n.table.eventManager.LastBodyPointerXY={x:t.x,y:t.y},n.table.eventManager.isDown=!0,i.interactionState!==jw.scrolling&&i.updateInteractionState(jw.scrolling),n.table.stateManager.hideMenu(),null===(e=n.table.editorManager)||void 0===e||e.completeEdit(),n.table.hasListeners(v_.MOUSEDOWN_TABLE)&&n.table.fireListeners(v_.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),n.component.vScrollBar.addEventListener("pointerup",(()=>{i.fastScrolling=!1,n.table.eventManager.isDraging=!1,i.interactionState===jw.scrolling&&i.updateInteractionState(jw.default)})),n.component.vScrollBar.addEventListener("pointerupoutside",(()=>{i.fastScrolling=!1,i.interactionState===jw.scrolling&&i.updateInteractionState(jw.default)})),n.component.vScrollBar.addEventListener("scrollUp",(t=>{n.table.eventManager.isDraging=!1})),n.component.hScrollBar.addEventListener("pointermove",(t=>{n.table.stateManager.updateCursor("default"),t.stopPropagation()})),n.component.hScrollBar.addEventListener("pointerdown",(t=>{t.stopPropagation(),n.table.hasListeners(v_.MOUSEDOWN_TABLE)&&n.table.fireListeners(v_.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),n.component.hScrollBar.addEventListener("scrollDown",(t=>{var e;n.table.eventManager.LastBodyPointerXY={x:t.x,y:t.y},n.table.eventManager.isDown=!0,i.interactionState!==jw.scrolling&&i.updateInteractionState(jw.scrolling),n.table.stateManager.hideMenu(),null===(e=n.table.editorManager)||void 0===e||e.completeEdit(),n.table.hasListeners(v_.MOUSEDOWN_TABLE)&&n.table.fireListeners(v_.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),n.component.hScrollBar.addEventListener("pointerup",(()=>{i.fastScrolling=!1,n.table.eventManager.isDraging=!1,i.interactionState===jw.scrolling&&i.updateInteractionState(jw.default)})),n.component.hScrollBar.addEventListener("pointerupoutside",(()=>{i.fastScrolling=!1,i.interactionState===jw.scrolling&&i.updateInteractionState(jw.default)})),n.component.hScrollBar.addEventListener("scrollUp",(t=>{n.table.eventManager.isDraging=!1}));const o=Fx(i.updateVerticalScrollBar,20),r=Fx(i.updateHorizontalScrollBar,20);n.component.vScrollBar.addEventListener("scrollDrag",(t=>{n.table.eventManager.isDown&&(n.table.eventManager.isDraging=!0),i.fastScrolling=!0,i.interactionState!==jw.scrolling&&i.updateInteractionState(jw.scrolling);const e=t.detail.value[0]/(1-t.detail.value[1]+t.detail.value[0]);o(e,t)})),n.component.hScrollBar.addEventListener("scrollDrag",(t=>{n.table.eventManager.isDown&&(n.table.eventManager.isDraging=!0),i.fastScrolling=!0,i.interactionState!==jw.scrolling&&i.updateInteractionState(jw.scrolling);const e=t.detail.value[0]/(1-t.detail.value[1]+t.detail.value[0]);r(e)}))}(this),function(t){const e=t.table,i=e.stateManager,n=e.scenegraph;if(!1===Pu.envContribution.supportsTouchEvents)return;Pu.addEventListener("contextmenu",(t=>{t.stopPropagation(),t.preventDefault()}),{capture:!0}),t.touchMovePoints=[],e.scenegraph.tableGroup.addEventListener("touchstart",(i=>{var o,r,s,a,l,h,d,c;if(i.target.isChildOf(n.component.vScrollBar)||i.target.isChildOf(n.component.vScrollBar))return;t.isTouchdown=!0;const u=i.nativeEvent;t.touchMovePoints.push({x:e.rotateDegree?null!==(s=null===(r=null===(o=u.changedTouches)||void 0===o?void 0:o[0])||void 0===r?void 0:r._canvasX)&&void 0!==s?s:null===(a=i.canvas)||void 0===a?void 0:a.x:i.page.x,y:e.rotateDegree?null!==(d=null===(h=null===(l=u.changedTouches)||void 0===l?void 0:l[0])||void 0===h?void 0:h._canvasY)&&void 0!==d?d:null===(c=i.canvas)||void 0===c?void 0:c.y:i.page.y,timestamp:Date.now()})}));const o=n=>{var o,r;if(t.isLongTouch&&n.preventDefault(),t.isTouchdown&&aE(n))if(t.isTouchMove=!0,(null===(r=null===(o=t.downIcon)||void 0===o?void 0:o.attribute)||void 0===r?void 0:r.funcType)===Zw.dragReorder)n.preventDefault();else if(t.touchMovePoints.length>4&&t.touchMovePoints.shift(),t.touchMovePoints.push({x:e.rotateDegree?n.changedTouches[0]._canvasX:n.changedTouches[0].pageX,y:e.rotateDegree?n.changedTouches[0]._canvasY:n.changedTouches[0].pageY,timestamp:Date.now()}),t._enableTableScroll){const o=-t.touchMovePoints[t.touchMovePoints.length-1].x+t.touchMovePoints[t.touchMovePoints.length-2].x,r=-t.touchMovePoints[t.touchMovePoints.length-1].y+t.touchMovePoints[t.touchMovePoints.length-2].y;KP({deltaX:o,deltaY:r},i),n.cancelable&&("none"===e.internalProps.overscrollBehavior||Math.abs(r)>=Math.abs(o)&&0!==r&&qP(r,i)||Math.abs(r)<=Math.abs(o)&&0!==o&&ZP(o,i))&&n.preventDefault()}};Pu.addEventListener("touchmove",o,{passive:!1}),t.globalEventListeners.push({name:"touchmove",env:"vglobal",callback:o});const r=i=>{var n,o,r,s;if(t.touchEnd=!0,t.isLongTouch=!1,t.isTouchdown&&aE(i)){if((null===(o=null===(n=t.downIcon)||void 0===n?void 0:n.attribute)||void 0===o?void 0:o.funcType)===Zw.dragReorder)i.preventDefault();else if((null===(r=t.touchMovePoints)||void 0===r?void 0:r.length)&&(t.touchMovePoints.length>4&&t.touchMovePoints.shift(),t.touchMovePoints.push({x:e.rotateDegree?i.changedTouches[0]._canvasX:i.changedTouches[0].pageX,y:e.rotateDegree?i.changedTouches[0]._canvasY:i.changedTouches[0].pageY,timestamp:Date.now()}),t._enableTableScroll)){const i=t.touchMovePoints[0],n=t.touchMovePoints[(null===(s=t.touchMovePoints)||void 0===s?void 0:s.length)-1],o=(n.x-i.x)/(n.timestamp-i.timestamp),r=(n.y-i.y)/(n.timestamp-i.timestamp);t.inertiaScroll.startInertia(o,r,.95),e.eventManager.inertiaScroll.setScrollHandle(((t,i)=>{KP({deltaX:-t,deltaY:-i},e.stateManager)}))}t.isTouchdown=!1,t.isTouchMove=!1,t.isDraging=!1,t.touchMovePoints=[]}};Pu.addEventListener("touchend",r),t.globalEventListeners.push({name:"touchend",env:"vglobal",callback:r});const s=e=>{t.touchEnd=!0,t.isLongTouch=!1,t.isTouchdown&&(t.isTouchdown=!1,t.isTouchMove=!1,t.touchMovePoints=[],t.isDraging=!1)};Pu.addEventListener("touchcancel",s),t.globalEventListeners.push({name:"touchcancel",env:"vglobal",callback:s})}(this),eE(this)}updateEventBinder(){setTimeout((()=>{var t;this.table.isReleased||(DL(this.table)&&0===(null===(t=this.handleTextStickBindId)||void 0===t?void 0:t.length)?(this.handleTextStickBindId.push(this.table.on(v_.SCROLL,(t=>{HL(this.table)}))),this.handleTextStickBindId.push(this.table.on(v_.RESIZE_COLUMN_END,(t=>{HL(this.table)}))),this.handleTextStickBindId.push(this.table.on(v_.RESIZE_ROW_END,(t=>{HL(this.table)})))):!DL(this.table)&&this.handleTextStickBindId&&(this.handleTextStickBindId.forEach((t=>{this.table.off(t)})),this.handleTextStickBindId=[]),YP(this.table))}),0)}bindSelfEvent(){var t;this.table.isReleased||(pE(this.table),(t=this.table).on(v_.DROPDOWN_MENU_CLICK,(()=>{t.stateManager.hideMenu()})),this.updateEventBinder(),function(t){"browser"===kx.mode&&t.on(v_.CLICK_CELL,(e=>{const{col:i,row:n}=e;if("image"===e.target.type&&e.target.role&&e.target.role.startsWith("icon"))return;let o;o=t.internalProps.layoutMap.isHeader(i,n)?t.isPivotTable()?t._getHeaderLayoutMap(i,n).headerType:t.getHeaderDefine(i,n).headerType:t.getBodyColumnType(i,n);const r=t.isHeader(i,n)?t.getHeaderDefine(i,n):t.getBodyColumnDefine(i,n),s=t.getCellValue(i,n),a=t.getCellOriginValue(i,n);if("link"===o){let e=n_(r.linkJump,{col:i,row:n,table:t,value:s,dataValue:a,cellHeaderPaths:void 0});if(e=!1!==e,!e)return;const o=r.templateLink;let l,h=n_(r.linkDetect,{col:i,row:n,table:t,value:s,dataValue:a,cellHeaderPaths:void 0});if(h=!1!==h,o){const e=t.getCellOriginRecord(i,n);if(e&&e.vtableMerge)return;const r=Object.assign({__value:s,__dataValue:a},e);if(VC(o))l=o(r,i,n,t);else{const t=/\{\s*(\S+?)\s*\}/g;l=o.replace(t,((t,e)=>r[e]))}}else if(h){if(!P_.test(s))return;l=s}else l=s;if(!l)return;const d=r.linkTarget,c=r.linkWindowFeatures;window.open(l,d,c)}else if("image"===o){const{clickToPreview:t}=r;if(!1===t)return;const e=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.backgroundColor="rgba(30, 30, 30, 0.4)",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.overflow="hidden",e.style.zIndex="9999",e.addEventListener("click",(t=>{t.target===e&&document.body.removeChild(e)}));const i=new Image;i.src=s,i.style.maxWidth="80%",i.style.maxHeight="80%",e.appendChild(i),document.body.appendChild(e)}else if("video"===o){const{clickToPreview:t}=r;if(!1===t)return;const e=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.backgroundColor="rgba(30, 30, 30, 0.4)",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.overflow="hidden",e.style.zIndex="9999",e.addEventListener("click",(t=>{t.target===e&&document.body.removeChild(e)}));const i=document.createElement("video");i.src=s,i.style.maxWidth="80%",i.style.maxHeight="80%",i.setAttribute("preload","auto"),i.setAttribute("controls","true"),e.appendChild(i),document.body.appendChild(e)}}))}(this.table),function(t){t.on(v_.DBLCLICK_CELL,(e=>{var i,n,o;if(e.federatedEvent){const r=OT(e.federatedEvent),s=t.scenegraph.getResizeColAt(r.abstractPos.x,r.abstractPos.y,null===(i=r.eventArgs)||void 0===i?void 0:i.targetCell),a=null!==(n=t.options.disableDblclickAutoResizeColWidth)&&void 0!==n?n:null===(o=t.options.resize)||void 0===o?void 0:o.disableDblclickAutoResizeColWidth;if(t.eventManager.checkCellFillhandle(r))t.fireListeners(v_.DBLCLICK_FILL_HANDLE,{});else if(t._canResizeColumn(s.col,s.row)&&s.col>=0&&!a){t.scenegraph.updateAutoColWidth(s.col),t.internalProps._widthResizedColMap.add(s.col),t.scenegraph.updateChartSizeForResizeColWidth(s.col);const e=t.stateManager;e.columnResize.col<e.table.frozenColCount&&!e.table.isPivotTable()&&!e.table.transpose&&e.table.scenegraph.component.setFrozenColumnShadow(e.table.frozenColCount-1,e.columnResize.isRightFrozen);const i=[];for(let e=0;e<t.colCount;e++)i.push(t.getColWidth(e));t.fireListeners(v_.RESIZE_COLUMN_END,{col:s.col,colWidths:i})}}}))}(this.table),this.table.isPivotTable()&&function(t){const e=t.internalProps.layoutMap.rowsDefine,i=t.internalProps.layoutMap.columnsDefine;for(let t=0;t<e.length;t++){const i=e[t];if("string"!=typeof i&&(i.drillDown||i.drillUp))return!0}for(let t=0;t<i.length;t++){const e=i[t];if("string"!=typeof e&&(e.drillDown||e.drillUp))return!0}return!1}(this.table)&&function(t){t.on(v_.MOUSEENTER_CELL,(e=>{const{col:i,row:n}=e;if(-1===i||-1===n)return;const o=t.internalProps.layoutMap.getHeaderDimension(i,n);(null==o?void 0:o.drillDown)||(null==o?void 0:o.drillUp)?t.stateManager.updateDrillState(o.dimensionKey,o.title,o.drillDown,o.drillUp,i,n):t.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)})),t.on(v_.MOUSELEAVE_TABLE,(e=>{t.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)}))}(this.table),YP(this.table),function(t){t.isPivotChart()&&t.scenegraph.tableGroup.addEventListener("click",(e=>{var i;if(!t.stateManager.columnMove.moving&&!t.stateManager.columnResize.resizing)if("axis-label"===e.target.name){const i=OT(e),{col:n,row:o}=i.eventArgs,r=t.internalProps.layoutMap;let s,a;r.indicatorsAsCol?(s=r.getDimensionKeyInChartSpec(r.rowHeaderLevelCount,o),a=r.getCellHeaderPaths(r.rowHeaderLevelCount-2,o).rowHeaderPaths):(s=r.getDimensionKeyInChartSpec(n,r.columnHeaderLevelCount),a=r.getCellHeaderPaths(n,r.columnHeaderLevelCount-1).colHeaderPaths);const l=a.map((t=>({key:t.dimensionKey,value:t.value}))).filter((t=>t.key));if(l.push({key:s,value:e.target.attribute.text}),t._selectedDimensionInChart.length&&function(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].key!==e[i].key||t[i].value!==e[i].value)return!1;return!0}(t._selectedDimensionInChart,l))return;t._selectedDimensionInChart=l,r.updateDataStateToChartInstance(),yP(t.scenegraph),t.scenegraph.updateNextFrame()}else(null===(i=t._selectedDimensionInChart)||void 0===i?void 0:i.length)&&(t._selectedDimensionInChart.length=0,t.internalProps.layoutMap.updateDataStateToChartInstance(),yP(t.scenegraph),t.scenegraph.updateNextFrame())}))}(this.table),function(t){t.isPivotChart()&&(t.on(v_.MOUSEENTER_CELL,(e=>{t.scenegraph.getCell(e.col,e.row).forEachChildren((i=>{if("axis"===i.name){const i=lE(e.col,e.row,t.internalProps.layoutMap);e.axisPosition=i,t.fireListeners(v_.MOUSEENTER_AXIS,e)}}))})),t.on(v_.MOUSELEAVE_CELL,(e=>{t.scenegraph.getCell(e.col,e.row).forEachChildren((i=>{if("axis"===i.name){const i=lE(e.col,e.row,t.internalProps.layoutMap);e.axisPosition=i,t.fireListeners(v_.MOUSELEAVE_AXIS,e)}}))})))}(this.table),function(t){t.on("checkbox_state_change",(e=>{var i,n;const{col:o,row:r,checked:s,field:a}=e;if(!t.internalProps.layoutMap.isSeriesNumber(o,r)||!0!==(null===(i=t.internalProps.rowSeriesNumber)||void 0===i?void 0:i.enableTreeCheckbox))return;if(t.isHeader(o,r))return;const l=t.getCellOriginRecord(o,r),h=t.dataSource.currentPagerIndexedData,d=t.getRecordShowIndexByCell(o,r);let c=h[d];if(tw(c)&&(c=[c]),l.vtableMerge||(null===(n=l.children)||void 0===n?void 0:n.length))if(s)gE(t,o,r)===Kw.collapse?uE(!0,c,t,a):hE(!0,d,c,h,t,o),dE(d,c,h,t,o);else{gE(t,o,r)===Kw.collapse?uE(!1,c,t,a):hE(!1,d,c,h,t,o),dE(d,c,h,t,o);const e=t.stateManager.headerCheckedState._vtable_rowSeries_number,i=t.stateManager.updateHeaderCheckedState("_vtable_rowSeries_number",o,r);e!==i&&t.scenegraph.updateHeaderCheckboxCellState(o,r,i)}else dE(d,c,h,t,o)}))}(this.table),function(t){t.on("checkbox_state_change",(e=>{var i;const{col:n,row:o,checked:r,field:s}=e,a=t.internalProps.columns.some((t=>t.tree));if(t.internalProps.enableCheckboxCascade,!a)return;if(t.isHeader(n,o))return;const l=t.getCellOriginRecord(n,o),h=t.dataSource.currentPagerIndexedData,d=t.getRecordShowIndexByCell(n,o);let c=h[d];if(tw(c)&&(c=[c]),l.vtableMerge||(null===(i=l.children)||void 0===i?void 0:i.length))if(r)gE(t,n,o)===Kw.collapse?uE(!0,c,t,s):hE(!0,d,c,h,t,n,s),dE(d,c,h,t,n,s);else{gE(t,n,o)===Kw.collapse?uE(!1,c,t,s):hE(!1,d,c,h,t,n,s),dE(d,c,h,t,n,s);const e=t.stateManager.headerCheckedState._vtable_rowSeries_number,i=t.stateManager.updateHeaderCheckedState(s,n,o);e!==i&&t.scenegraph.updateHeaderCheckboxCellState(n,o,i)}else dE(d,c,h,t,n,s)}))}(this.table),function(t){t.on("checkbox_state_change",(e=>{const{col:i,row:n,checked:o,field:r}=e;if(t.isHeader(i,n))t.stateManager.setHeaderCheckedState(r,o),"checkbox"===t.getCellType(i,n)&&t.scenegraph.updateCheckboxCellState(i,n,o);else if(t.stateManager.setCheckedState(i,n,r,o),"checkbox"===t.getCellType(i,n)){const e=t.stateManager.headerCheckedState[r],o=t.stateManager.updateHeaderCheckedState(r,i,n);e!==o&&t.scenegraph.updateHeaderCheckboxCellState(i,n,o)}}))}(this.table),function(t){t.on(v_.CLICK_CELL,(e=>{const{col:i,row:n,target:o}=e;"button"!==o.name||o.attribute.disable||t.hasListeners(v_.BUTTON_CLICK)&&t.fireListeners(v_.BUTTON_CLICK,{col:i,row:n,event:e.event})}))}(this.table),function(t){t.on(v_.CONTEXTMENU_CELL,(e=>{const{col:i,row:n}=e,o=t.getSelectedCellRanges();let r=!1;if(o.length>0)for(let t=0;t<o.length;t++){const e=o[t],s=e.start.col,a=e.end.col,l=e.start.row,h=e.end.row;if(i>=s&&i<=a&&n>=l&&n<=h||i>=a&&i<=s&&n>=h&&n<=l||i>=s&&i<=a&&n>=h&&n<=l||i>=a&&i<=s&&n>=l&&n<=h){r=!0;break}}r||t.selectCell(i,n)}))}(this.table))}dealTableHover(t){if(!t)return void this.table.stateManager.updateHoverPos(-1,-1);const{eventArgs:e}=t;e?this.table.stateManager.updateHoverPos(e.col,e.row):this.table.stateManager.updateHoverPos(-1,-1)}dealIconHover(t){const{eventArgs:e}=t;e?this.table.stateManager.updateHoverIcon(e.col,e.row,e.target,e.targetCell):this.table.stateManager.updateHoverIcon(-1,-1,void 0,void 0)}dealMenuHover(t){}dealTableSelect(t,e){var i,n,o,r,s;if(!t)return this.table.stateManager.updateSelectPos(-1,-1),!1;const{eventArgs:a}=t;if(a){if("checkbox"===a.target.name||"radio"===a.target.name||"switch"===a.target.name||"button"===a.target.name)return!1;if(this.table.isHeader(a.col,a.row)&&xM(this.table,a.col,a.row))return e||this.table.stateManager.updateSelectPos(-1,-1),!1;if(!this.table.isHeader(a.col,a.row)&&xM(this.table,a.col,a.row)){if(!e){const t=!!(null===(i=this.table.stateManager.select.ranges)||void 0===i?void 0:i.length);this.table.stateManager.updateSelectPos(-1,-1),t&&this.table.stateManager.endSelectCells(!0,t)}return!1}return!this.table.isPivotChart()||"axis-label"!==(null===(n=null==t?void 0:t.eventArgs)||void 0===n?void 0:n.target.name)&&"chart"!==(null===(o=null==t?void 0:t.eventArgs)||void 0===o?void 0:o.target.type)?(this.table.stateManager.updateSelectPos(a.col,a.row,a.event.shiftKey,a.event.ctrlKey||a.event.metaKey,!1,!e&&(null===(s=null===(r=this.table.options.select)||void 0===r?void 0:r.makeSelectCellVisible)||void 0===s||s)),!0):(this.table.stateManager.updateSelectPos(-1,-1),!1)}return!1}dealFillSelect(t,e){var i,n;const{eventArgs:o}=t;if(o){if((null===(n=null===(i=this.table.stateManager.select)||void 0===i?void 0:i.ranges)||void 0===n?void 0:n.length)&&this.table.stateManager.isFillHandle()){let i,n;const r=this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1];e&&(XC(this.table.stateManager.fillHandle.directionRow)||(Math.abs(this.table.stateManager.fillHandle.startY-t.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-t.abstractPos.x)?this.table.stateManager.fillHandle.directionRow=!0:this.table.stateManager.fillHandle.directionRow=!1),Math.abs(this.table.stateManager.fillHandle.startY-t.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-t.abstractPos.x)?this.table.stateManager.fillHandle.startY-t.abstractPos.y>0?this.table.stateManager.fillHandle.direction="top":this.table.stateManager.fillHandle.direction="bottom":this.table.stateManager.fillHandle.startX-t.abstractPos.x>0?this.table.stateManager.fillHandle.direction="left":this.table.stateManager.fillHandle.direction="right",this.table.stateManager.fillHandle.directionRow?(i=o.row,n=r.end.col):(i=r.end.row,n=o.col)),this.table.stateManager.updateSelectPos(e?n:r.end.col,e?i:r.end.row,!0,o.event.ctrlKey||o.event.metaKey,!1,!e)}else this.table.stateManager.updateSelectPos(o.col,o.row,o.event.shiftKey,o.event.ctrlKey||o.event.metaKey,!1,!e);return!0}return!1}deelTableSelectAll(){this.table.stateManager.updateSelectPos(-1,-1,!1,!1,!0),this.table.fireListeners(v_.SELECTED_CELL,{ranges:this.table.stateManager.select.ranges,col:0,row:0})}dealMenuSelect(t){}checkColumnResize(t,e){const{eventArgs:i}=t;if(this.table.options.enableTreeStickCell&&!i)return!1;const n=this.table.scenegraph.getResizeColAt(t.abstractPos.x,t.abstractPos.y,null==i?void 0:i.targetCell);return this.table._canResizeColumn(n.col,n.row)&&n.col>=0?(e&&this.table.stateManager.startResizeCol(n.col,t.abstractPos.x,t.abstractPos.y,n.rightFrozen),!0):(this.table.stateManager.isResizeCol()&&this.table.stateManager.endResizeCol(),!1)}checkRowResize(t,e){const{eventArgs:i}=t;if(i){const n=this.table.scenegraph.getResizeRowAt(t.abstractPos.x,t.abstractPos.y,i.targetCell);if(this.table._canResizeRow(n.col,n.row)&&n.row>=0)return e&&this.table.stateManager.startResizeRow(n.row,t.abstractPos.x,t.abstractPos.y,n.bottomFrozen),!0}return!1}cellIsHeaderCheck(t,e){const{eventArgs:i}=t,{col:n,row:o,target:r}=i;return!!this.table.isHeader(n,o)&&"checkbox"===this.table.getCellType(i.col,i.row)&&"checkbox"===r.name}checkCellFillhandle(t,e){var i,n,o,r,s;let a=!1;if(a="function"==typeof(null===(i=this.table.options.excelOptions)||void 0===i?void 0:i.fillHandle)?this.table.options.excelOptions.fillHandle({selectRanges:this.table.stateManager.select.ranges,table:this.table}):null===(n=this.table.options.excelOptions)||void 0===n?void 0:n.fillHandle,a){const{eventArgs:i}=t;if(i&&(null===(r=null===(o=this.table.stateManager.select)||void 0===o?void 0:o.ranges)||void 0===r?void 0:r.length)){const i=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.col,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.col),n=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.row,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.row),o=Math.min(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.col,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.col),r=Math.min(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.row,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.row);let a;a=i<this.table.colCount-1?this.table.scenegraph.highPerformanceGetCell(i,n).globalAABBBounds:this.table.scenegraph.highPerformanceGetCell(o-1,n).globalAABBBounds;const l=Math.abs(t.abstractPos.x-a.x2);a=n<this.table.rowCount-1?this.table.scenegraph.highPerformanceGetCell(i,n).globalAABBBounds:this.table.scenegraph.highPerformanceGetCell(i,r-1).globalAABBBounds;const h=Math.abs(t.abstractPos.y-a.y2),d=18;if((null===(s=this.table.stateManager.fillHandle)||void 0===s?void 0:s.isFilling)||l<=d/2&&h<=d/2)return e&&this.table.stateManager.startFillSelect(t.abstractPos.x,t.abstractPos.y),!0}}return!1}dealColumnResize(t,e){this.table.stateManager.updateResizeCol(t,e)}dealRowResize(t,e){this.table.stateManager.updateResizeRow(t,e)}checkColumnMover(t){var e;const{eventArgs:i}=t;return!(!i||!this.table._canDragHeaderPosition(i.col,i.row)||(this.table.stateManager.startMoveCol(i.col,i.row,t.abstractPos.x,t.abstractPos.y,null===(e=null==i?void 0:i.event)||void 0===e?void 0:e.nativeEvent),0))}dealColumnMover(t){var e;const{eventArgs:i}=t;XC(i.col)&&XC(i.row)&&this.table.stateManager.updateMoveCol(i.col,i.row,t.abstractPos.x,t.abstractPos.y,null===(e=null==i?void 0:i.event)||void 0===e?void 0:e.nativeEvent)}startColumnResize(t){}dealIconClick(t,e){const{eventArgs:i}=e,{target:n,event:o,col:r,row:s}=i||{target:t.target,event:t,col:-1,row:-1},a=n;if(a.role&&a.role.startsWith("icon-"))return this.table.fireListeners(v_.ICON_CLICK,{name:a.name,x:(a.globalAABBBounds.x1+a.globalAABBBounds.x2)/2,y:a.globalAABBBounds.y2,col:r,row:s,funcType:a.attribute.funcType,icon:a,event:o}),!0;if(n instanceof lh){const t=n.pickIcon(o.global);if(t)return this.table.fireListeners(v_.ICON_CLICK,{name:t.attribute.id,x:t.globalX+t.globalAABBBounds.width()/2,y:t.globalY+t.AABBBounds.height(),col:r,row:s,funcType:t.attribute.funcType,icon:t,event:o}),!0}return!1}release(){this.gesture.release(),this.globalEventListeners.forEach((t=>{"document"===t.env?document.removeEventListener(t.name,t.callback):"body"===t.env?document.body.removeEventListener(t.name,t.callback):"window"===t.env?window.removeEventListener(t.name,t.callback):"vglobal"===t.env&&Pu.removeEventListener(t.name,t.callback)})),this.globalEventListeners=[]}enableScroll(){this._enableTableScroll=!0}disableScroll(){this._enableTableScroll=!1}}(this),this.animationManager=new RH(this),e.legends){ot.legends=[];const t=J_.getFunction("createLegend");if(Array.isArray(e.legends)){for(let i=0;i<e.legends.length;i++)ot.legends.push(t(e.legends[i],this));this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}else ot.legends.push(t(e.legends,this)),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}if(ot.tooltip=Object.assign({parentElement:this.getElement(),renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0,position:Yw.bottom},e.tooltip),"html"===ot.tooltip.renderMode){const t=J_.getComponent("tooltipHandler");t&&(ot.tooltipHandler=new t(this,ot.tooltip.confine))}if(ot.menu=Object.assign({renderMode:"html"},e.menu),Array.isArray(null===(u=e.menu)||void 0===u?void 0:u.dropDownMenuHighlight)&&this.setDropDownMenuHighlight(null===(g=e.menu)||void 0===g?void 0:g.dropDownMenuHighlight),(Array.isArray(null===(p=e.menu)||void 0===p?void 0:p.defaultHeaderMenuItems)||"function"==typeof(null===(f=e.menu)||void 0===f?void 0:f.defaultHeaderMenuItems))&&(this.globalDropDownMenu=e.menu.defaultHeaderMenuItems),"html"===ot.menu.renderMode){const t=J_.getComponent("menuHandler");ot.menuHandler=new t(this)}this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyMergeTitleCache=new Map,this.bodyBottomStyleCache=new Map,ot.stick={changedCells:new Map},ot.customMergeCell=kH(e.customMergeCell);const st=J_.getComponent("customCellStylePlugin");st&&(this.customCellStylePlugin=new st(this,null!==(v=e.customCellStyle)&&void 0!==v?v:[],null!==(b=e.customCellStyleArrangement)&&void 0!==b?b:[])),this._adjustCanvasSizeByOption()}_adjustCanvasSizeByOption(){"auto"!==this.options.canvasHeight&&"auto"!==this.options.canvasWidth||setTimeout((()=>{var t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_;let S,A;if("auto"===this.options.canvasHeight){let u=0;if(null===(t=this.theme.frameStyle)||void 0===t?void 0:t.innerBorder)u+=null!==(n=MH(null!==(i=null===(e=this.internalProps.theme.frameStyle)||void 0===e?void 0:e.shadowBlur)&&void 0!==i?i:[0])[1])&&void 0!==n?n:0;else if(this.theme.frameStyle){const t=MH(null!==(r=null===(o=this.internalProps.theme.frameStyle)||void 0===o?void 0:o.borderLineWidth)&&void 0!==r?r:[null]),e=MH(null!==(a=null===(s=this.internalProps.theme.frameStyle)||void 0===s?void 0:s.shadowBlur)&&void 0!==a?a:[0]);u+=(null!==(l=t[0])&&void 0!==l?l:0)+(null!==(h=e[0])&&void 0!==h?h:0)+((null!==(d=t[2])&&void 0!==d?d:0)+(null!==(c=e[2])&&void 0!==c?c:0))}A=Math.min(this.options.maxCanvasHeight?this.options.maxCanvasHeight-u:2e4,this.getAllRowsHeight())+u}else A=this.canvasHeight;if("auto"===this.options.canvasWidth){let t=0;if(null===(u=this.theme.frameStyle)||void 0===u?void 0:u.innerBorder)t+=null!==(f=MH(null!==(p=null===(g=this.internalProps.theme.frameStyle)||void 0===g?void 0:g.shadowBlur)&&void 0!==p?p:[0])[2])&&void 0!==f?f:0;else if(this.theme.frameStyle){const e=MH(null!==(b=null===(v=this.internalProps.theme.frameStyle)||void 0===v?void 0:v.borderLineWidth)&&void 0!==b?b:[null]),i=MH(null!==(y=null===(m=this.internalProps.theme.frameStyle)||void 0===m?void 0:m.shadowBlur)&&void 0!==y?y:[0]);t+=(null!==(C=e[1])&&void 0!==C?C:0)+(null!==(w=i[1])&&void 0!==w?w:0)+((null!==(x=e[3])&&void 0!==x?x:0)+(null!==(_=i[3])&&void 0!==_?_:0))}S=Math.min(this.options.maxCanvasWidth?this.options.maxCanvasWidth-t:2e4,this.getAllColsWidth())+t}else S=this.canvasWidth;this.setCanvasSize(S,A)}),0)}getContainer(){return this.container}getElement(){return this.internalProps.element}get canvas(){return this.internalProps.canvas}setCanvasSize(t,e){this.canvasWidth=t,this.canvasHeight=e,this.options.canvasHeight=e,this.options.canvasWidth=t,this.resize()}resize(){var t;this._updateSize(),null===(t=this.internalProps.legends)||void 0===t||t.forEach((t=>{null==t||t.resize()})),this.internalProps.title&&this.internalProps.title.resize(),this.internalProps.emptyTip&&this.internalProps.emptyTip.resize(),this.scenegraph.resize()}get rowCount(){return this.internalProps.rowCount}set rowCount(t){this.internalProps.rowCount=t}get colCount(){var t;return null!==(t=this.internalProps.colCount)&&void 0!==t?t:0}set colCount(t){this.internalProps.colCount=t}get frozenColCount(){var t,e,i,n,o;return null!==(o=null!==(i=null===(e=null===(t=this.internalProps)||void 0===t?void 0:t.layoutMap)||void 0===e?void 0:e.frozenColCount)&&void 0!==i?i:null===(n=this.internalProps)||void 0===n?void 0:n.frozenColCount)&&void 0!==o?o:0}set frozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t;const e=this._getMaxFrozenWidth();if(this.getColsWidth(0,t-1)>e)if(this.internalProps.unfreezeAllOnExceedsMaxWidth)this.internalProps.frozenColCount=0;else{const e=this._getComputedFrozenColCount(t);this.internalProps.frozenColCount=e}this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t;const e=this._getMaxFrozenWidth();if(this.getColsWidth(0,t-1)>e)if(this.internalProps.unfreezeAllOnExceedsMaxWidth)this.internalProps.frozenColCount=0;else{const e=this._getComputedFrozenColCount(t);this.internalProps.frozenColCount=e}this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}_setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t}_resetFrozenColCount(){this.options.frozenColCount&&(this.tableNoFrameWidth-this.getColsWidth(0,this.options.frozenColCount-1)<=120?this._setFrozenColCount(0):this.frozenColCount!==this.options.frozenColCount&&this._setFrozenColCount(this.options.frozenColCount))}get frozenRowCount(){var t,e,i,n,o;return null!==(o=null!==(i=null===(e=null===(t=this.internalProps)||void 0===t?void 0:t.layoutMap)||void 0===e?void 0:e.frozenRowCount)&&void 0!==i?i:null===(n=this.internalProps)||void 0===n?void 0:n.frozenRowCount)&&void 0!==o?o:0}set frozenRowCount(t){this.internalProps.frozenRowCount=t,this.stateManager.setFrozenRow(this.internalProps.frozenRowCount)}get rightFrozenColCount(){var t,e,i,n,o;return null!==(o=null!==(i=null===(e=null===(t=this.internalProps)||void 0===t?void 0:t.layoutMap)||void 0===e?void 0:e.rightFrozenColCount)&&void 0!==i?i:null===(n=this.internalProps)||void 0===n?void 0:n.rightFrozenColCount)&&void 0!==o?o:0}set rightFrozenColCount(t){this.scenegraph.dealWidthRightFrozen(t)}get bottomFrozenRowCount(){var t,e,i,n,o;return null!==(o=null!==(i=null===(e=null===(t=this.internalProps)||void 0===t?void 0:t.layoutMap)||void 0===e?void 0:e.bottomFrozenRowCount)&&void 0!==i?i:null===(n=this.internalProps)||void 0===n?void 0:n.bottomFrozenRowCount)&&void 0!==o?o:0}set bottomFrozenRowCount(t){this.scenegraph.dealWidthBottomFrozen(t)}get defaultRowHeight(){return tw(this.internalProps.defaultRowHeight)?this.internalProps.defaultRowHeight:40}set defaultRowHeight(t){this.internalProps.defaultRowHeight=t,this.options.defaultRowHeight=t}get defaultHeaderRowHeight(){return this.internalProps.defaultHeaderRowHeight}set defaultHeaderRowHeight(t){this.internalProps.defaultHeaderRowHeight=t,this.options.defaultHeaderRowHeight=t}get defaultColWidth(){return this.internalProps.defaultColWidth}set defaultColWidth(t){this.internalProps.defaultColWidth=t,this.options.defaultColWidth=t}get defaultHeaderColWidth(){return this.internalProps.defaultHeaderColWidth}set defaultHeaderColWidth(t){this.internalProps.defaultHeaderColWidth=t,this.options.defaultHeaderColWidth=t}get colWidthsMap(){return this.internalProps._colWidthsMap}set colWidthsMap(t){this.internalProps._colWidthsMap=t}get colContentWidthsMap(){return this.internalProps._colContentWidthsMap}set colContentWidthsMap(t){this.internalProps._colContentWidthsMap=t}get _colRangeWidthsMap(){return this.internalProps._colRangeWidthsMap}set _colRangeWidthsMap(t){this.internalProps._colRangeWidthsMap=t}get _rowRangeHeightsMap(){return this.internalProps._rowRangeHeightsMap}set _rowRangeHeightsMap(t){this.internalProps._rowRangeHeightsMap=t}get rowHeightsMap(){return this.internalProps._rowHeightsMap}set rowHeightsMap(t){this.internalProps._rowHeightsMap=t}get colWidthsLimit(){return this.internalProps._colWidthsLimit}set colWidthsLimit(t){this.internalProps._colWidthsLimit=t}get keyboardOptions(){var t;return null!==(t=this.internalProps.keyboardOptions)&&void 0!==t?t:null}set keyboardOptions(t){this.internalProps.keyboardOptions=null!=t?t:void 0}get eventOptions(){var t;return null!==(t=this.internalProps.eventOptions)&&void 0!==t?t:null}set eventOptions(t){this.internalProps.eventOptions=null!=t?t:void 0}get widthMode(){return this._widthMode}set widthMode(t){t!==this._widthMode&&(this._widthMode=t,this.options.widthMode=t)}get heightMode(){return this._heightMode}set heightMode(t){t!==this._heightMode&&(this._heightMode=t,this.options.heightMode=t)}get autoFillWidth(){return this._autoFillWidth}set autoFillWidth(t){t!==this._autoFillWidth&&(this._autoFillWidth=t)}get autoFillHeight(){return this._autoFillHeight}set autoFillHeight(t){t!==this._autoFillHeight&&(this._autoFillHeight=t)}get widthAdaptiveMode(){return this._widthAdaptiveMode}set widthAdaptiveMode(t){t!==this._widthAdaptiveMode&&(this._widthAdaptiveMode=t)}get heightAdaptiveMode(){return this._heightAdaptiveMode}set heightAdaptiveMode(t){t!==this._heightAdaptiveMode&&(this._heightAdaptiveMode=t)}_colWidthDefineToPxWidth(t){return"auto"===t?0:TT(this,t)}_getMaxFrozenWidth(){var t;return TT(this,null!==(t=this.options.maxFrozenWidth)&&void 0!==t?t:"80%")}_getComputedFrozenColCount(t){const e=this._getMaxFrozenWidth();let i=t;for(;this.getColsWidth(0,i-1)>e&&(i--,!(i<=0)););return i}_getColWidthLimits(t){const e=this.colWidthsLimit[t];if(!e)return null;const i={};return e.min&&(i.min=TT(this,e.min),i.minDef=e.min),e.max&&(i.max=TT(this,e.max),i.maxDef=e.max),i}_adjustColWidth(t,e){const i=this._getColWidthLimits(t);return Math.max(function(t,e){return t?t.min&&t.min>e?t.min:t.max&&t.max<e?t.max:e:e}(i,e),0)}get pixelRatio(){return this.internalProps.pixelRatio}setPixelRatio(t){var e;if(t!==(null===(e=this.internalProps)||void 0===e?void 0:e.pixelRatio)){this.internalProps.pixelRatio=t;const e=this.canvasWidth;this.internalProps.calcWidthContext={_:this.internalProps,get full(){var i;return"node"===kx.mode?e/(null!=t?t:1):this._.canvas.width/(null!==(i=this._.context.pixelRatio)&&void 0!==i?i:window.devicePixelRatio)}},this.scenegraph.setPixelRatio(t)}}_updateSize(){var t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B,T,R,k;const{padding:M}=this;let L=0,P=0;if(this.tableX=0,this.tableY=0,this.options.canvas&&this.options.viewBox)L=this.options.viewBox.x2-this.options.viewBox.x1,P=this.options.viewBox.y2-this.options.viewBox.y1,(null===(t=null==this?void 0:this.scenegraph)||void 0===t?void 0:t.stage)&&(this.options.viewBox?this.scenegraph.stage.setViewBox(this.options.viewBox,!1):this.scenegraph.stage.resize(L,P));else if("browser"===kx.mode){const t=this.getElement();let d=0,c=0;const u=XC(this.canvasWidth),g=XC(this.canvasHeight);if(this.canvasSizeSeted&&(u&&(d=this.canvasWidth),g&&(c=this.canvasHeight)),(!u||!g)&&t.parentElement){const e=t.parentElement.style||window.getComputedStyle(t.parentElement);u||(d=t.parentElement.offsetWidth-(parseInt(e.paddingLeft,10)||0)-(parseInt(e.paddingRight,10)||0)),g||(c=t.parentElement.offsetHeight-parseInt(e.paddingTop||"0px",10)-parseInt(e.paddingBottom||"0px",20)),d=(null!=d?d:1)-(this.options.tableSizeAntiJitter?1:0),c=(null!=c?c:1)-(this.options.tableSizeAntiJitter?1:0)}t.style.width=d&&d-M.left-M.right+"px"||"0px",t.style.height=c&&c-M.top-M.bottom+"px"||"0px";const{canvas:p}=this.internalProps;L=(null!==(i=null===(e=p.parentElement)||void 0===e?void 0:e.offsetWidth)&&void 0!==i?i:1)-(this.options.tableSizeAntiJitter?1:0),P=(null!==(o=null===(n=p.parentElement)||void 0===n?void 0:n.offsetHeight)&&void 0!==o?o:1)-(this.options.tableSizeAntiJitter?1:0),(null===(r=null==this?void 0:this.scenegraph)||void 0===r?void 0:r.stage)?(null===(s=this.options)||void 0===s?void 0:s.viewBox)&&!(null===(a=this.options)||void 0===a?void 0:a.canvas)&&this.scenegraph.stage.resize(L,P):(p.style.width="",p.style.height="",p.width=L,p.height=P,p.style.width=`${L}px`,p.style.height=`${P}px`),(null===(l=this.options)||void 0===l?void 0:l.viewBox)&&(L=this.options.viewBox.x2-this.options.viewBox.x1,P=this.options.viewBox.y2-this.options.viewBox.y1),(null===(h=null==this?void 0:this.scenegraph)||void 0===h?void 0:h.stage)&&(this.options.viewBox?this.scenegraph.stage.setViewBox(this.options.viewBox,!1):this.scenegraph.stage.resize(L,P))}else"node"===kx.mode&&(L=this.canvasWidth-1,P=this.canvasHeight-1);const E=Math.floor(L-function(t){var e;return(null==t?void 0:t.hoverOn)||(null==t?void 0:t.verticalVisible)&&"none"===(null==t?void 0:t.verticalVisible)||!(null==t?void 0:t.verticalVisible)&&"none"===(null==t?void 0:t.visible)?0:null!==(e=null==t?void 0:t.width)&&void 0!==e?e:7}(this.getTheme().scrollStyle)),H=Math.floor(P-function(t){var e;return(null==t?void 0:t.hoverOn)||(null==t?void 0:t.horizontalVisible)&&"none"===(null==t?void 0:t.horizontalVisible)||!(null==t?void 0:t.horizontalVisible)&&"none"===(null==t?void 0:t.visible)?0:null!==(e=null==t?void 0:t.width)&&void 0!==e?e:7}(this.getTheme().scrollStyle));if(null===(d=this.internalProps.theme)||void 0===d?void 0:d.frameStyle){const t=MH(null!==(u=null===(c=this.internalProps.theme.frameStyle)||void 0===c?void 0:c.borderLineWidth)&&void 0!==u?u:[null]),e=MH(null!==(p=null===(g=this.internalProps.theme.frameStyle)||void 0===g?void 0:g.shadowBlur)&&void 0!==p?p:[0]);(null===(f=this.theme.frameStyle)||void 0===f?void 0:f.innerBorder)?(this.tableX=0,this.tableY=0,this.tableNoFrameWidth=E-(null!==(v=e[1])&&void 0!==v?v:0),this.tableNoFrameHeight=H-(null!==(b=e[2])&&void 0!==b?b:0)):(this.tableX=(null!==(m=t[3])&&void 0!==m?m:0)+(null!==(y=e[3])&&void 0!==y?y:0),this.tableY=(null!==(C=t[0])&&void 0!==C?C:0)+(null!==(w=e[0])&&void 0!==w?w:0),this.tableNoFrameWidth=E-((null!==(x=t[1])&&void 0!==x?x:0)+(null!==(_=e[1])&&void 0!==_?_:0))-((null!==(S=t[3])&&void 0!==S?S:0)+(null!==(A=e[3])&&void 0!==A?A:0)),this.tableNoFrameHeight=H-((null!==(B=t[0])&&void 0!==B?B:0)+(null!==(T=e[0])&&void 0!==T?T:0))-((null!==(R=t[2])&&void 0!==R?R:0)+(null!==(k=e[2])&&void 0!==k?k:0)))}this._clearColRangeWidthsMap(),this._clearRowRangeHeightsMap()}updateViewBox(t){var e,i,n,o,r,s,a,l,h,d,c,u;const g=(null!==(n=null===(i=null===(e=this.options)||void 0===e?void 0:e.viewBox)||void 0===i?void 0:i.x2)&&void 0!==n?n:0)-(null!==(s=null===(r=null===(o=this.options)||void 0===o?void 0:o.viewBox)||void 0===r?void 0:r.x1)&&void 0!==s?s:0),p=(null!==(h=null===(l=null===(a=this.options)||void 0===a?void 0:a.viewBox)||void 0===l?void 0:l.y2)&&void 0!==h?h:0)-(null!==(u=null===(c=null===(d=this.options)||void 0===d?void 0:d.viewBox)||void 0===c?void 0:c.y1)&&void 0!==u?u:0),f=t.x2-t.x1,v=t.y2-t.y1;this.options.viewBox=t,g!==f||p!==v?this.resize():this.scenegraph.stage.setViewBox(this.options.viewBox,!0)}setViewBoxTransform(t,e,i,n,o,r){this.internalProps.modifiedViewBoxTransform=!0,this.scenegraph.stage.window.setViewBoxTransform(t,e,i,n,o,r)}get rowHierarchyType(){return this.dataSource.rowHierarchyType}getColsWidth(t,e){var i;if(t>e)return 0;t=Math.max(t,0),e=Math.min(e,(null!==(i=this.colCount)&&void 0!==i?i:1/0)-1);const n=this._colRangeWidthsMap.get(`$${t}$${e}`);if(null!=n)return n;const o=this._colRangeWidthsMap.get(`$${t}$${e-1}`);if(null!=o){const i=o+this.getColWidth(e);return t>=0&&e>=0&&!Number.isNaN(i)&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(i)),Math.round(i)}let r=0;for(let i=t;i<=e;i++)r+=this.getColWidth(i);return t>=0&&e>=0&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(r)),Math.round(r)}getRowHeight(t){var e;if(XC(this.rowHeightsMap.get(t))){if(null===(e=this.options.customConfig)||void 0===e?void 0:e._disableColumnAndRowSizeRound){const e=this.rowHeightsMap.get(t);let i;return i=t<this.frozenRowCount?this.rowHeightsMap.getSumInRange(0,t):t>=this.rowCount-this.bottomFrozenRowCount?this.rowHeightsMap.getSumInRange(t,this.rowCount-1):this.rowHeightsMap.getSumInRange(this.frozenRowCount,t),i=Number(i.toFixed(2)),Number.isInteger(i)?Math.ceil(e):Math.floor(e)}return this.rowHeightsMap.get(t)}const i=this.getDefaultRowHeight(t);return tw(i)?i:this.defaultRowHeight}getDefaultColumnWidth(t){var e,i;return this.isRowHeader(t,0)||this.isCornerHeader(t,0)?Array.isArray(this.defaultHeaderColWidth)?null!==(e=this.defaultHeaderColWidth[t])&&void 0!==e?e:this.defaultColWidth:this.defaultHeaderColWidth:this.isRightFrozenColumn(t,this.columnHeaderLevelCount)&&this.isPivotTable()?Array.isArray(this.defaultHeaderColWidth)?null!==(i=this.defaultHeaderColWidth[this.rowHeaderLevelCount-this.rightFrozenColCount])&&void 0!==i?i:this.defaultColWidth:this.defaultHeaderColWidth:this.defaultColWidth}getDefaultRowHeight(t){var e,i;return this.isColumnHeader(0,t)||this.isCornerHeader(0,t)||this.isSeriesNumberInHeader(0,t)?Array.isArray(this.defaultHeaderRowHeight)?null!==(e=this.defaultHeaderRowHeight[t])&&void 0!==e?e:this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.isBottomFrozenRow(t)?Array.isArray(this.defaultHeaderRowHeight)?null!==(i=this.defaultHeaderRowHeight[this.columnHeaderLevelCount>0?this.columnHeaderLevelCount-this.bottomFrozenRowCount:0])&&void 0!==i?i:this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.internalProps.defaultRowHeight}_setRowHeight(t,e,i){var n;this.rowHeightsMap.put(t,(null===(n=this.options.customConfig)||void 0===n?void 0:n._disableColumnAndRowSizeRound)?e:Math.round(e)),i&&this._clearRowRangeHeightsMap(t)}setRowHeight(t,e){this.scenegraph.setRowHeight(t,e),this.scenegraph.updateChartSizeForResizeRowHeight(t),this.internalProps._heightResizedRowMap.add(t)}getRowsHeight(t,e){var i,n;if(t>e||0===this.rowCount)return 0;t=Math.max(t,0),e=Math.min(e,(null!==(i=this.rowCount)&&void 0!==i?i:1/0)-1);let o=0;const r="auto"===this.options.defaultRowHeight;if("standard"!==this.heightMode||this.options.customComputeRowHeight||this.autoFillHeight||!this.internalProps.layoutMap||this.hasAutoImageColumn()||r||0!==this.internalProps._heightResizedRowMap.size){if(null===(n=this.options.customConfig)||void 0===n?void 0:n._disableColumnAndRowSizeRound){const i=this.rowHeightsMap.getSumInRange(t,e);let n;return n=e<this.frozenRowCount?this.rowHeightsMap.getSumInRange(0,e):e>=this.rowCount-this.bottomFrozenRowCount?this.rowHeightsMap.getSumInRange(e,this.rowCount-1):this.rowHeightsMap.getSumInRange(this.frozenRowCount,e),n=Number(n.toFixed(2)),Number.isInteger(n)?Math.ceil(i):Math.floor(i)}o=this.rowHeightsMap.getSumInRange(t,e)}else{for(let i=t;i<Math.min(e+1,this.columnHeaderLevelCount);i++)o+=this.getRowHeight(i);e>=this.columnHeaderLevelCount&&(o+=this.defaultRowHeight*(Math.min(e,this.rowCount-this.bottomFrozenRowCount-1)-Math.max(this.columnHeaderLevelCount,t)+1));for(let t=this.rowCount-this.bottomFrozenRowCount;t<e+1;t++)o+=this.getRowHeight(t)}return Math.round(o)}getColWidthDefined(t){var e;const{layoutMap:i}=this.internalProps;if("autoWidth"===this.widthMode)return"auto";const{width:n}=null!==(e=null==i?void 0:i.getColumnWidthDefined(t))&&void 0!==e?e:{};return"number"==typeof n&&n<=0?0:n||this.getDefaultColumnWidth(t)}getColWidthDefinedNumber(t){const e=this.getColWidthDefined(t);return this._adjustColWidth(t,this._colWidthDefineToPxWidth(e))}isAutoRowHeight(t){return"autoHeight"===this.heightMode||!!this.options.customComputeRowHeight||(t>=0&&t<this.columnHeaderLevelCount?"auto"===this.getDefaultRowHeight(t):"auto"===this.internalProps.defaultRowHeight)}getColWidth(t){var e;const i=null!==(e=this.colWidthsMap.get(t))&&void 0!==e?e:this.getDefaultColumnWidth(t);return"adaptive"===this.widthMode&&"number"==typeof i||this.transpose&&"number"==typeof i?this._colWidthDefineToPxWidth(i):this._adjustColWidth(t,this._colWidthDefineToPxWidth(i))}_setColWidth(t,e,i,n){this.colWidthsMap.put(t,"number"==typeof e?Math.round(e):e),i&&this._clearColRangeWidthsMap(t),n||this.stateManager.checkFrozen()}setColWidth(t,e){this.scenegraph.setColWidth(t,e),this.scenegraph.updateChartSizeForResizeColWidth(t),this.internalProps._widthResizedColMap.add(t)}_clearColRangeWidthsMap(t){if("number"!=typeof t)this._colRangeWidthsMap.clear();else{const e=this._colRangeWidthsMap.keys();for(const i of e){const e=PH.exec(i);if(e){const n=Number(e[1]),o=Number(e[2]);t>=n&&t<=o&&this._colRangeWidthsMap.delete(i)}}}}_clearRowRangeHeightsMap(t){this.rowHeightsMap.clearRange()}_getColContentWidth(t){return Number(this.colContentWidthsMap.get(t))}_setColContentWidth(t,e){this.colContentWidthsMap.put(t,e)}getAllRowsHeight(){return this.internalProps.rowCount<=0?0:this.getRowsHeight(0,this.internalProps.rowCount-1)}getAllColsWidth(){return this.internalProps.colCount<=0?0:this.getColsWidth(0,this.internalProps.colCount-1)}getColsWidths(){const t=this.colCount,e=[];for(let i=0;i<t;i++)e.push(this.getColWidth(i));return e}getMaxColWidth(t){var e;const i=this.colWidthsLimit[t];let n=null!==(e=i&&i.max)&&void 0!==e?e:1/0;return"string"==typeof n&&(n=TT(this,n)),n}setMaxColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).max=e}getMinColWidth(t){var e;const i=this.colWidthsLimit[t];let n=null!==(e=i&&i.min)&&void 0!==e?e:0;return"string"==typeof n&&(n=TT(this,n)),n}setMinColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).min=e}getCellRect(t,e){var i,n;const o=this.isFrozenCell(t,e);let r;const s=this.getColWidth(t);let a;r=o&&o.col&&this.isRightFrozenColumn(t,e)?this.getAllColsWidth()<=this.tableNoFrameWidth?this.getColsWidth(0,t-1)||0:this.tableNoFrameWidth-(null!==(i=this.getColsWidth(t,this.colCount-1))&&void 0!==i?i:0):this.getColsWidth(0,t-1)||0;const l=this.getRowHeight(e);return a=o&&o.row&&this.isBottomFrozenRow(t,e)?this.getAllRowsHeight()<=this.tableNoFrameHeight?this.getRowsHeight(0,e-1):this.tableNoFrameHeight-(null!==(n=this.getRowsHeight(e,this.rowCount-1))&&void 0!==n?n:0):this.getRowsHeight(0,e-1),new __(Math.round(r),Math.round(a),Math.round(s),Math.round(l))}getMergeCellRect(t,e){const i=this.getCellRange(t,e),n=this.getColsWidth(0,i.start.col-1)||0,o=this.getColsWidth(i.start.col,i.end.col),r=this.getRowsHeight(0,i.start.row-1)||0,s=this.getRowsHeight(i.start.row,i.end.row);return new __(Math.round(n),Math.round(r),Math.round(o),Math.round(s))}getCellRelativeRect(t,e){const i=this.isFrozenCell(t,e);let n=!0,o=!0;(null==i?void 0:i.col)&&(null==i?void 0:i.row)?(n=!1,o=!1):(null==i?void 0:i.col)?n=!1:(null==i?void 0:i.row)&&(o=!1);const r=this.getCellRect(t,e);return this._toRelativeRect(r,n,o)}getCellRangeRelativeRect(t){if(t.start){const e=this.isFrozenCell(t.start.col,t.start.row);let i=!0,n=!0;return(null==e?void 0:e.col)&&(null==e?void 0:e.row)?(i=!1,n=!1):(null==e?void 0:e.col)?i=!1:(null==e?void 0:e.row)&&(n=!1),this._toRelativeRect(this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row),i,n)}const e=this.getCellRange(t.col,t.row),i=this.isFrozenCell(t.col,t.row);let n=!0,o=!0;return(null==i?void 0:i.col)&&(null==i?void 0:i.row)?(n=!1,o=!1):(null==i?void 0:i.col)?n=!1:(null==i?void 0:i.row)&&(o=!1),this._toRelativeRect(this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row),n,o)}getVisibleCellRangeRelativeRect(t){let e;return e=t.start?t:this.getCellRange(t.col,t.row),this._getVisiableRect(this.getCellRangeRelativeRect(t),e)}_getVisiableRect(t,e){const i=e.start.col>=this.frozenColCount?Math.max(t.left,this.frozenColCount>=1?this.getColsWidth(0,this.frozenColCount-1):0):t.left,n=Math.min(t.right,this.tableNoFrameWidth),o=t.copy();o.left=i,o.right=n;const r=e.start.row>=this.frozenRowCount?Math.max(t.top,this.frozenRowCount>=1?this.getRowsHeight(0,this.frozenRowCount-1):0):t.top,s=Math.min(t.bottom,this.tableNoFrameHeight);return o.top=r,o.bottom=s,o}getCellsRect(t,e,i,n){var o,r,s,a,l,h;let d=this.getColsWidth(0,t-1)||0,c=this.getColsWidth(t,i);const u=this.scrollLeft,g=Math.min(this.tableNoFrameWidth,this.getAllColsWidth()),p=Math.min(this.tableNoFrameHeight,this.getAllRowsHeight());this.isLeftFrozenColumn(t)&&this.isRightFrozenColumn(i)?c=this.tableNoFrameWidth-(null!==(o=this.getColsWidth(t+1,this.colCount-1))&&void 0!==o?o:0)-d:this.isLeftFrozenColumn(t)&&!this.isLeftFrozenColumn(i)?c=Math.max(c-u,this.getColsWidth(t,this.frozenColCount-1)):!this.isRightFrozenColumn(t)&&this.isRightFrozenColumn(i)?(d=Math.min(d-u,g-this.getRightFrozenColsWidth()),c=g-(null!==(r=this.getColsWidth(t+1,this.colCount-1))&&void 0!==r?r:0)-d):this.isRightFrozenColumn(t)&&(d=g-(null!==(s=this.getColsWidth(t,this.colCount-1))&&void 0!==s?s:0));let f=this.getRowsHeight(0,e-1),v=this.getRowsHeight(e,n);const b=this.scrollTop;return this.isTopFrozenRow(e)&&this.isBottomFrozenRow(n)?v=this.tableNoFrameHeight-(null!==(a=this.getRowsHeight(e+1,this.rowCount-1))&&void 0!==a?a:0)-f:this.isTopFrozenRow(e)&&!this.isTopFrozenRow(n)?v=Math.max(v-b,this.getRowsHeight(e,this.frozenRowCount-1)):!this.isBottomFrozenRow(e)&&this.isBottomFrozenRow(n)?(f=Math.min(f-b,p-this.getBottomFrozenRowsHeight()),v=p-(null!==(l=this.getRowsHeight(e+1,this.rowCount-1))&&void 0!==l?l:0)-f):this.isBottomFrozenRow(e)&&(f=p-(null!==(h=this.getRowsHeight(e,this.rowCount-1))&&void 0!==h?h:0)),new __(Math.round(d),Math.round(f),Math.round(c),Math.round(v))}getCellsRectWidth(t,e,i,n){const o=this.isFrozenCell(t,e),r=this.isFrozenCell(i,n);let s=this.getColsWidth(t,i);if(o&&o.col){const e=this.scrollLeft;r&&r.col||(s-=e,s=Math.max(s,this.getColsWidth(t,this.frozenColCount-1)))}return s}getCellRangeRect(t){if(t.start)return this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row)}getCellRangeRectWidth(t){if(t.start)return this.getCellsRectWidth(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRectWidth(e.start.col,e.start.row,e.end.col,e.end.row)}isFrozenCell(t,e){const i=this.isFrozenRow(e),n=this.isFrozenColumn(t);return i||n?{row:i,col:n}:null}getRowAt(t){return iH(t,this)}getColAt(t){return nH(t,this)}getCellAt(t,e){return function(t,e,i){const n=iH(e,i),{row:o,top:r,bottom:s,height:a}=n,l=nH(t,i),{col:h,left:d,right:c,width:u}=l;return{row:o,col:h,rect:{left:d,right:c,top:r,bottom:s,width:u,height:a}}}(t,e,this)}getCellAtRelativePosition(t,e){return function(t,e,i){t-=i.tableX;let n=!1;(e-=i.tableY)>0&&e<i.getFrozenRowsHeight()&&(n=!0);let o=!1;t>0&&t<i.getFrozenColsWidth()&&(o=!0);let r=!1;e>i.tableNoFrameHeight-i.getBottomFrozenRowsHeight()&&e<i.tableNoFrameHeight&&e<=i.getAllRowsHeight()&&(r=!0);let s=!1;t>i.tableNoFrameWidth-i.getRightFrozenColsWidth()&&t<i.tableNoFrameWidth&&t<=i.getAllColsWidth()&&(s=!0);const a=sH((o||s?t:t+i.scrollLeft)+i.tableX,s,i),l=aH((n||r?e:e+i.scrollTop)+i.tableY,r,i);if(a&&l){const{row:t,top:e,bottom:i,height:n}=l,{col:o,left:r,right:s,width:h}=a;return{row:t,col:o,rect:{left:r,right:s,top:e,bottom:i,width:h,height:n}}}return{col:-1,row:-1}}(t,e,this)}_checkRowCol(t,e){return t>=0&&t<this.colCount&&e>=0&&e<this.rowCount}_makeVisibleCell(t,e){if(this._checkRowCol(t,e)){const i=this.isFrozenCell(t,e);if(i&&i.col&&i.row)return;const n=this.getCellRect(t,e),o=function(t){let e=0,i=0;t.frozenColCount>0&&(e=t.getFrozenColsWidth()),t.rightFrozenColCount>0&&(i=t.getRightFrozenColsWidth());let n=0,o=0;return t.frozenRowCount>0&&(n=t.getFrozenRowsHeight()),t.bottomFrozenRowCount>0&&(o=t.getBottomFrozenRowsHeight()),new __(t.scrollLeft+e,t.scrollTop+n,t.tableNoFrameWidth-e-i,t.tableNoFrameHeight-n-o)}(this);if(o.contains(n))return;i&&i.col||this.getColsWidth(0,this.frozenColCount-1)+n.width>this.canvas.width||(n.left<o.left?this.scrollLeft-=o.left-n.left:o.right<n.right&&(this.scrollLeft-=o.right-n.right)),i&&i.row||this.getRowsHeight(0,this.frozenRowCount-1)+n.height>this.canvas.height||(n.top<o.top?this.scrollTop-=o.top-n.top:o.bottom<n.bottom&&(this.scrollTop-=o.bottom-n.bottom))}}render(){this.scenegraph.renderSceneGraph()}renderAsync(){return this.scenegraph.updateNextFrame(),new Promise(((t,e)=>{setTimeout((()=>{t()}),0)}))}_toRelativeRect(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n,o,r,s;const a=t.copy(),l=this.getVisibleRect();return a.offsetLeft(this.tableX-(e?l.left:0)),a.offsetTop(this.tableY-(i?l.top:0)),a.offsetLeft(null!==(o=null===(n=this.options.viewBox)||void 0===n?void 0:n.x1)&&void 0!==o?o:0),a.offsetTop(null!==(s=null===(r=this.options.viewBox)||void 0===r?void 0:r.y1)&&void 0!==s?s:0),a}getVisibleRect(){const{scrollTop:t,scrollLeft:e}=this,i=this.tableNoFrameWidth,n=this.tableNoFrameHeight;return new __(e,t,i,n)}get visibleRowCount(){const{frozenRowCount:t}=this,e=this.getVisibleRect(),i=t>0?e.top+this.getRowsHeight(0,t-1):e.top,n=this.getTargetRowAt(i);if(!n)return 0;const o=Math.max(n.top>=i?n.row:n.row+1,t);let r=this.getRowsHeight(0,o-1),s=0;const{rowCount:a}=this;for(let t=o;t<a;t++){const i=r+this.getRowHeight(t);if(e.bottom<i)break;s++,r=i}return s}getBodyVisibleCellRange(){const{scrollTop:t,scrollLeft:e}=this,i=this.getFrozenRowsHeight(),n=this.getFrozenColsWidth(),o=this.getBottomFrozenRowsHeight(),r=this.getRightFrozenColsWidth(),{row:s}=this.getRowAt(t+i+1),{col:a}=this.getColAt(e+n+1),l=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-o).row:this.rowCount-1,h=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(e+this.tableNoFrameWidth-1-r).col:this.colCount-1;return h<0||l<0?null:{rowStart:s,colStart:a,rowEnd:l,colEnd:h}}getBodyVisibleRowRange(){const{scrollTop:t}=this,e=this.getFrozenRowsHeight(),i=this.getBottomFrozenRowsHeight(),{row:n}=this.getRowAt(t+e+1),o=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-i).row:this.rowCount-1;return o<0?null:{rowStart:n,rowEnd:o}}getBodyVisibleColRange(){const{scrollLeft:t}=this,e=this.getFrozenColsWidth(),i=this.getRightFrozenColsWidth(),{col:n}=this.getColAt(t+e+1),o=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(t+this.tableNoFrameWidth-1-i).col:this.colCount-1;return o<0?null:{colStart:n,colEnd:o}}get visibleColCount(){const{frozenColCount:t}=this,e=this.getVisibleRect(),i=t>0?e.left+this.getColsWidth(0,t-1):e.left,n=this.getTargetColAt(i);if(!n)return 0;const o=Math.max(n.left>=i?n.col:n.col+1,t);let r=this.getColsWidth(0,o-1),s=0;const{colCount:a}=this;for(let t=o;t<a;t++){const i=r+this.getColWidth(t);if(e.right<i)break;s++,r=i}return s}get scrollTop(){return this.stateManager.scroll.verticalBarPos}set scrollTop(t){this.stateManager.setScrollTop(t)}get scrollLeft(){return this.stateManager.scroll.horizontalBarPos}set scrollLeft(t){this.stateManager.setScrollLeft(t)}getScrollLeft(){return this.scrollLeft}getScrollTop(){return this.scrollTop}setScrollLeft(t){this.scrollLeft=Math.ceil(t)}setScrollTop(t){this.scrollTop=Math.ceil(t)}getCellOverflowText(t,e){return this.scenegraph.getCellOverflowText(t,e)}addReleaseObj(t){if(!t||!t.release||"function"!=typeof t.release)throw new Error("not releaseObj!");(this.internalProps.releaseList=this.internalProps.releaseList||[]).push(t)}dispose(){this.release()}release(){var t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f;const v=this.internalProps;if(this.isReleased)return;null===(e=null===(t=v.tooltipHandler)||void 0===t?void 0:t.release)||void 0===e||e.call(t),null===(n=null===(i=v.menuHandler)||void 0===i?void 0:i.release)||void 0===n||n.call(i),null===(o=super.release)||void 0===o||o.call(this),null===(s=null===(r=v.handler)||void 0===r?void 0:r.release)||void 0===s||s.call(r),this.eventManager.release(),null===(l=null===(a=v.focusControl)||void 0===a?void 0:a.release)||void 0===l||l.call(a),null===(h=v.legends)||void 0===h||h.forEach((t=>{null==t||t.release()})),null===(d=v.title)||void 0===d||d.release(),v.title=null,null===(c=v.emptyTip)||void 0===c||c.release(),v.emptyTip=null,v.layoutMap.release(),v.releaseList&&(v.releaseList.forEach((t=>{var e;return null===(e=null==t?void 0:t.release)||void 0===e?void 0:e.call(t)})),v.releaseList=null),this.scenegraph.stage.release(),this.scenegraph.proxy.release(),v.focusControl.release();const{parentElement:b}=v.element;b&&!this.options.canvas&&b.removeChild(v.element),null===(p=null===(g=null===(u=this.editorManager)||void 0===u?void 0:u.editingEditor)||void 0===g?void 0:g.onEnd)||void 0===p||p.call(g),this.isReleased=!0,this.scenegraph=null,this.internalProps=null,null===(f=this.reactCustomLayout)||void 0===f||f.clearCache(),this.pluginManager.release(),aM()}fireListeners(t,e){return super.fireListeners(t,e)}updateOption(t){var e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y;null===(e=this.editorManager)||void 0===e||e.cancelEdit(),this.options=t,this._hasAutoImageColumn=void 0;const{frozenColCount:C=0,unfreezeAllOnExceedsMaxWidth:w,defaultRowHeight:x=40,defaultHeaderRowHeight:_,defaultColWidth:S=80,defaultHeaderColWidth:A=80,keyboardOptions:B,eventOptions:T,rowSeriesNumber:R,enableCheckboxCascade:k,columnResizeMode:M,rowResizeMode:L="none",resize:P,dragHeaderMode:E,dragOrder:H,showFrozenIcon:O,allowFrozenColCount:I,padding:F,hover:z,menu:D,select:W,pixelRatio:N,widthMode:G,heightMode:j,autoFillWidth:V,autoFillHeight:U,widthAdaptiveMode:X,heightAdaptiveMode:$,customRender:Y,renderChartAsync:K,renderChartAsyncBatchCount:q,canvasWidth:Z,canvasHeight:J,overscrollBehavior:Q,limitMinWidth:tt,limitMinHeight:et}=t;N&&N!==this.internalProps.pixelRatio&&(this.internalProps.pixelRatio=N),F&&("number"==typeof F?(this.padding.top=F,this.padding.left=F,this.padding.bottom=F,this.padding.right=F):(F.top&&(this.padding.top=F.top),F.bottom&&(this.padding.bottom=F.bottom),F.left&&(this.padding.left=F.left),F.right&&(this.padding.right=F.right))),this.showFrozenIcon="boolean"!=typeof O||O,"number"==typeof I&&I<=0&&(this.showFrozenIcon=!1),this.widthMode=null!=G?G:"standard",this.heightMode=null!=j?j:"standard",this._widthAdaptiveMode=null!=X?X:"only-body",this._heightAdaptiveMode=null!=$?$:"only-body",this.autoFillWidth=null!=V&&V,this.autoFillHeight=null!=U&&U,this.customRender=Y,this.canvasWidth=tw(Z)?Z:void 0,this.canvasHeight=tw(J)?J:void 0;const it=this.internalProps;if("node"===kx.mode||t.canvas||function(t,e){var i,n;t.style.margin=`${e.top}px ${e.right}px ${e.bottom}px ${e.left}px`;const o=(t.offsetWidth||(null===(i=t.parentElement)||void 0===i?void 0:i.offsetWidth)||1)-1,r=(t.offsetHeight||(null===(n=t.parentElement)||void 0===n?void 0:n.offsetHeight)||1)-1;t.style.width=o&&o-e.left-e.right+"px"||"0px",t.style.height=r&&r-e.top-e.bottom+"px"||"0px"}(it.element,this.padding),this.columnWidthComputeMode=null!==(i=t.columnWidthComputeMode)&&void 0!==i?i:"normal",it.frozenColCount=C,it.unfreezeAllOnExceedsMaxWidth=null==w||w,it.defaultRowHeight=x,it.defaultHeaderRowHeight=null!=_?_:x,it.defaultColWidth=S,it.defaultHeaderColWidth=null!=A?A:S,it.keyboardOptions=B,it.eventOptions=T,it.rowSeriesNumber=R,it.enableCheckboxCascade=k,it.columnResizeMode=null!==(n=null==P?void 0:P.columnResizeMode)&&void 0!==n?n:M,it.rowResizeMode=null!==(o=null==P?void 0:P.rowResizeMode)&&void 0!==o?o:L,it.dragHeaderMode=null!==(s=null!==(r=null==H?void 0:H.dragHeaderMode)&&void 0!==r?r:E)&&void 0!==s?s:"none",it.renderChartAsync=K,sM(q),it.overscrollBehavior=null!=Q?Q:"auto",it.cellTextOverflows={},it._rowHeightsMap=new ZE(this),it._rowRangeHeightsMap=new Map,it._colRangeWidthsMap=new Map,it._widthResizedColMap=new Set,it._heightResizedRowMap=new Set,this.colWidthsMap=new x_,this.colContentWidthsMap=new x_,this.colWidthsLimit={},it.stick.changedCells.clear(),it.theme=K_.of(null!==(a=t.theme)&&void 0!==a?a:K_.DEFAULT),it.theme.isPivot=this.isPivotTable(),mR(it.theme.functionalIconsStyle),this.scenegraph.updateStageBackground(),it.autoWrapText=t.autoWrapText,it.enableLineBreak=t.enableLineBreak,it.allowFrozenColCount=null!==(l=t.allowFrozenColCount)&&void 0!==l?l:0,it.limitMaxAutoWidth=null!==(h=t.limitMaxAutoWidth)&&void 0!==h?h:450,it.limitMinWidth=null!=tt?"number"==typeof tt?tt:tt?10:0:10,it.limitMinHeight=null!=et?"number"==typeof et?et:et?10:0:10,null===(d=it.legends)||void 0===d||d.forEach((t=>{null==t||t.release()})),null===(c=it.title)||void 0===c||c.release(),it.title=null,null===(u=it.emptyTip)||void 0===u||u.release(),it.emptyTip=null,it.layoutMap.release(),aM(),this.scenegraph.clearCells(),this.scenegraph.updateComponent(),this.stateManager.updateOptionSetState(),this._updateSize(),this.eventManager.updateEventBinder(),t.legends){it.legends=[];const e=J_.getFunction("createLegend");if(Array.isArray(t.legends)){for(let i=0;i<t.legends.length;i++)it.legends.push(e(t.legends[i],this));this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}else it.legends.push(e(t.legends,this)),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}if(it.tooltip=Object.assign({parentElement:this.getElement(),renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0,position:Yw.bottom},t.tooltip),"html"===it.tooltip.renderMode&&!it.tooltipHandler){const t=J_.getComponent("tooltipHandler");it.tooltipHandler=new t(this,it.tooltip.confine)}if(it.menu=Object.assign({renderMode:"html"},t.menu),Array.isArray(null===(g=t.menu)||void 0===g?void 0:g.dropDownMenuHighlight)&&this.setDropDownMenuHighlight(null===(p=t.menu)||void 0===p?void 0:p.dropDownMenuHighlight),(Array.isArray(null===(f=t.menu)||void 0===f?void 0:f.defaultHeaderMenuItems)||"function"==typeof(null===(v=t.menu)||void 0===v?void 0:v.defaultHeaderMenuItems))&&(this.globalDropDownMenu=t.menu.defaultHeaderMenuItems),"html"===it.menu.renderMode&&!it.menuHandler){const t=J_.getComponent("menuHandler");it.menuHandler=new t(this)}this.clearCellStyleCache(),this.clearColWidthCache(),this.clearRowHeightCache(),it.customMergeCell=kH(t.customMergeCell),null===(b=this.customCellStylePlugin)||void 0===b||b.updateCustomCell(null!==(m=t.customCellStyle)&&void 0!==m?m:[],null!==(y=t.customCellStyleArrangement)&&void 0!==y?y:[]),this._adjustCanvasSizeByOption()}renderWithRecreateCells(){this.internalProps.stick.changedCells.clear();const t={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(t.col,t.row),this.render()}getFrozenRowsHeight(){return this.getRowsHeight(0,this.frozenRowCount-1)}getFrozenColsWidth(){return this.getColsWidth(0,this.frozenColCount-1)}getBottomFrozenRowsHeight(){if(this.bottomFrozenRowCount>0){let t=0;for(let e=this.rowCount-this.bottomFrozenRowCount;e<=this.rowCount-1;e++)t+=this.getRowHeight(e);return t}return 0}getRightFrozenColsWidth(){if(this.rightFrozenColCount>0){let t=0;for(let e=this.colCount-this.rightFrozenColCount;e<=this.colCount-1;e++)t+=this.getColWidth(e);return t}return 0}getDrawRange(){const t=Math.min(this.tableNoFrameWidth,this.getAllColsWidth()),e=Math.min(this.tableNoFrameHeight,this.getAllRowsHeight());return new __(this.tableX,this.tableY,t,e)}_getMouseAbstractPoint(t){var e,i,n,o,r,s,a,l;let h;if(!t)return{inTable:!1,x:void 0,y:void 0};h=LH(t)?t.changedTouches[0]:t;const d=h.clientX||h.pageX+window.scrollX,c=h.clientY||h.pageY+window.scrollY,u=this.internalProps.canvas.getBoundingClientRect();let g=!0;u.right<=d&&(g=!1),u.bottom<=c&&(g=!1);const p=u.width,f=p/((90===this.rotateDegree?this.canvas.offsetHeight:this.canvas.offsetWidth)||p),v=u.height,b=v/((90===this.rotateDegree?this.canvas.offsetWidth:this.canvas.offsetHeight)||v),m=this.pluginManager.getPluginByName("Rotate Table");if(m&&90===this.rotateDegree){const t={x:d/f-(null!==(i=null===(e=this.options.viewBox)||void 0===e?void 0:e.x1)&&void 0!==i?i:0),y:c/b-(null!==(o=null===(n=this.options.viewBox)||void 0===n?void 0:n.y1)&&void 0!==o?o:0),inTable:g};return m.matrix.transformPoint(t,t),t}const y={x:(d-u.left)/f-(null!==(s=null===(r=this.options.viewBox)||void 0===r?void 0:r.x1)&&void 0!==s?s:0),y:(c-u.top)/b-(null!==(l=null===(a=this.options.viewBox)||void 0===a?void 0:a.y1)&&void 0!==l?l:0),inTable:g};return this.internalProps.modifiedViewBoxTransform&&this.scenegraph.stage.window.getViewBoxTransform()?(this.scenegraph.stage.window.getViewBoxTransform().transformPoint(y,y),y):y}getTheme(){return this.internalProps.theme}getTargetColAt(t){return oH(t,this)}getTargetRowAt(t){const e=rH(t,this);return e&&(e.row=Math.min(e.row,this.rowCount-1)),e}getTargetColAtConsiderRightFrozen(t,e){return sH(t,e,this)}getTargetRowAtConsiderBottomFrozen(t,e){return aH(t,e,this)}clearSelected(){this.stateManager.updateSelectPos(-1,-1)}selectCell(t,e,i,n,o){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];var s,a,l;const h=!!(null===(s=this.stateManager.select.ranges)||void 0===s?void 0:s.length);this.stateManager.updateSelectPos(t,e,i,n,!1,null===(l=null!=o?o:null===(a=this.options.select)||void 0===a?void 0:a.makeSelectCellVisible)||void 0===l||l,r),this.stateManager.endSelectCells(!0,h)}selectCells(t){const{scrollLeft:e,scrollTop:i}=this;t.forEach(((t,e)=>{var i,n,o,r,s,a;t.start.col===t.end.col&&t.start.row===t.end.row?this.stateManager.updateSelectPos(t.start.col,t.start.row,!1,e>=1,!1,null===(n=null===(i=this.options.select)||void 0===i?void 0:i.makeSelectCellVisible)||void 0===n||n,!0):(this.stateManager.updateSelectPos(t.start.col,t.start.row,!1,e>=1,!1,null===(r=null===(o=this.options.select)||void 0===o?void 0:o.makeSelectCellVisible)||void 0===r||r,!0),this.stateManager.updateInteractionState(jw.grabing),this.stateManager.updateSelectPos(t.end.col,t.end.row,!1,e>=1,!1,null===(a=null===(s=this.options.select)||void 0===s?void 0:s.makeSelectCellVisible)||void 0===a||a,!0)),this.stateManager.endSelectCells(!1,!1),this.stateManager.updateInteractionState(jw.default)})),this.setScrollTop(i),this.setScrollLeft(e)}get recordsCount(){var t;return null===(t=this.records)||void 0===t?void 0:t.length}get allowFrozenColCount(){return this.internalProps.allowFrozenColCount}get rowHeaderLevelCount(){return this.internalProps.layoutMap.rowHeaderLevelCount}get columnHeaderLevelCount(){return this.internalProps.layoutMap.columnHeaderLevelCount}get records(){return this.internalProps.records}get dataSource(){return this.internalProps.dataSource}set dataSource(t){this.scenegraph.clearCells(),function(t,e){ST(t,(()=>{t.internalProps.dataSource&&t.internalProps.releaseList.forEach((e=>{e instanceof oS&&(e.release(),t.internalProps.releaseList.splice(t.internalProps.releaseList.indexOf(e),1))})),e?e instanceof oS?(t.internalProps.dataSource=e,t.internalProps.dataSource.supplementConfig(t.pagination,t.options.columns,t.internalProps.layoutMap.rowHierarchyType,BT(t))):t.internalProps.dataSource=new PB(e):t.internalProps.dataSource=oS.EMPTY,t.addReleaseObj(t.internalProps.dataSource),t.internalProps.records=null}))}(this,t),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render()}get autoWrapText(){return this.internalProps.autoWrapText}set autoWrapText(t){this.internalProps.autoWrapText=t,this.options.autoWrapText=t}get enableLineBreak(){return this.internalProps.enableLineBreak}set enableLineBreak(t){this.internalProps.enableLineBreak=t,this.options.enableLineBreak=t}updateAutoWrapText(t){this.internalProps.autoWrapText!==t&&(this.internalProps.autoWrapText=t,this.options.autoWrapText=t,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.render())}get theme(){return this.internalProps.theme}set theme(t){this.internalProps.theme=K_.of(null!=t?t:K_.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),this.options.theme=t,mR(this.internalProps.theme.functionalIconsStyle)}updateTheme(t){const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.theme=K_.of(null!=t?t:K_.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),mR(this.internalProps.theme.functionalIconsStyle),this.options.theme=t,this.scenegraph.updateComponent(),this.scenegraph.updateStageBackground(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.render()}getBodyField(t,e){return this.internalProps.layoutMap.getBody(t,e).field}getBodyColumnDefine(t,e){const i=this.internalProps.layoutMap.getBody(t,e);return null==i?void 0:i.define}getBodyColumnType(t,e){var i,n;return AR("cellType",{cellType:null!==(n=null===(i=this.internalProps.layoutMap.getBody(t,e))||void 0===i?void 0:i.cellType)&&void 0!==n?n:"text"},t,e,this)}getCellType(t,e){let i;return this.isSeriesNumberInHeader(t,e)?this.internalProps.layoutMap.getSeriesNumberHeader(t,e).cellType:(i=this.isHeader(t,e)?this.internalProps.layoutMap.getHeader(t,e).headerType:this.internalProps.layoutMap.getBody(t,e).cellType,AR("cellType",{cellType:i},t,e,this))}getHeaderField(t,e){return this.internalProps.layoutMap.getHeaderField(t,e)}getHeaderDefine(t,e){const i=this.internalProps.layoutMap.getHeader(t,e);return null==i?void 0:i.define}getCellLocation(t,e){return this.internalProps.layoutMap.getCellLocation(t,e)}getCellHeaderPaths(t,e){return this.internalProps.layoutMap.getCellHeaderPaths(t,e)}getHeadersDefine(t,e){const i=[];for(;;){const n=this.getHeaderDefine(t,e);if(!n||!n.field&&!n.columns)break;i.push(n),e++}return i}_getHeaderLayoutMap(t,e){return this.internalProps.layoutMap.getHeader(t,e)}_getBodyLayoutMap(t,e){return this.internalProps.layoutMap.getBody(t,e)}getContext(){return this.internalProps.context}getRecordByCell(t,e){if(!this.internalProps.layoutMap.isHeader(t,e))return this.getCellOriginRecord(t,e)}getRecordByRowCol(t,e){return this.getRecordByCell(t,e)}getRecordStartRowByRecordIndex(t){return this.internalProps.layoutMap.getRecordStartRowByRecordIndex(t)}_getHeaderCellBySortState(t){const{layoutMap:e}=this.internalProps,i=e.headerObjects.find((e=>e&&e.field===t.field));if(i)return e.getHeaderCellAdressById(i.id)}getCellRange(t,e){var i;if(this.internalProps.customMergeCell){const i=this.internalProps.customMergeCell(t,e,this);if(i&&i.range&&(XC(i.text)||i.customLayout||i.customRender))return{start:{col:Math.max(i.range.start.col,0),row:Math.max(i.range.start.row,0)},end:{col:Math.min(i.range.end.col,this.colCount-1),row:Math.min(i.range.end.row,this.rowCount-1)},isCustom:!0}}return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.getCellRange(t,e)}hasCustomMerge(){return!!this.internalProps.customMergeCell}getCustomMerge(t,e){if(this.internalProps.customMergeCell){const i=this.internalProps.customMergeCell(t,e,this);if(i&&i.range&&(XC(i.text)||i.customLayout||this.customRender)){if(i.style){const n=this.internalProps.bodyHelper.getStyleClass("text"),o=Rx(i.style,this.theme.bodyStyle,{col:t,row:e,table:this,value:i.text,dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},n,this.options.autoWrapText,this.theme);i.style=o}return i.range={start:{col:Math.max(i.range.start.col,0),row:Math.max(i.range.start.row,0)},end:{col:Math.min(i.range.end.col,this.colCount-1),row:Math.min(i.range.end.row,this.rowCount-1)},isCustom:!0},i}}}isCellRangeEqual(t,e,i,n){return this.internalProps.layoutMap.isCellRangeEqual(t,e,i,n)}_getLayoutCellId(t,e){return this.internalProps.layoutMap.getCellId(t,e)}getHeaderDescription(t,e){var i;const n=this._getHeaderLayoutMap(t,e),o=null==n?void 0:n.define,r=null!==(i=null==o?void 0:o.description)&&void 0!==i?i:null==n?void 0:n.description;return"function"==typeof r?r({col:t,row:e,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e)}):r}setDropDownMenuHighlight(t){this.stateManager.setDropDownMenuHighlight(t)}_dropDownMenuIsHighlight(t,e,i){return this.stateManager.dropDownMenuIsHighlight(t,e,i)}isSeriesNumberInBody(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInBody(t,e)}isSeriesNumberInHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInHeader(t,e)}isHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isHeader(t,e)}isColumnHeader(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isColumnHeader(t,e)}isRowHeader(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isRowHeader(t,e)}isCornerHeader(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isCornerHeader(t,e)}isFrozenColumn(t,e){return this.isLeftFrozenColumn(t,e)||this.isRightFrozenColumn(t,e)}isLeftFrozenColumn(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isFrozenColumn(t,e)}isRightFrozenColumn(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isRightFrozenColumn(t,e)}isFrozenRow(t,e){return this.isTopFrozenRow(t,e)||this.isBottomFrozenRow(t,e)}isTopFrozenRow(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isFrozenRow(t,e)}isBottomFrozenRow(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isBottomFrozenRow(t,e)}getCellInfo(t,e){if(t>=0&&e>=0){const i=this.isHeader(t,e)?this.getHeaderDefine(t,e):this.getBodyColumnDefine(t,e);return{col:t,row:e,field:this.getHeaderField(t,e),cellHeaderPaths:this.internalProps.layoutMap.getCellHeaderPaths(t,e),title:null==i?void 0:i.title,cellType:this.getCellType(t,e),originData:this.getCellOriginRecord(t,e),cellRange:this.getCellRangeRelativeRect({col:t,row:e}),value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellLocation:this.getCellLocation(t,e),scaleRatio:this.canvas.getBoundingClientRect().width/this.canvas.offsetWidth}}}_hasField(t,e,i){var n;if(null===t)return!1;if(this.internalProps.layoutMap.isHeader(e,i))return!1;const o=this.getRecordShowIndexByCell(e,i);return null===(n=this.internalProps.dataSource)||void 0===n?void 0:n.hasField(o,t)}_getCellStyle(t,e){return function(t,e,i){var n,o,r,s,a,l,h,d,c,u;const g=null===(n=i.customCellStylePlugin)||void 0===n?void 0:n.getCustomCellStyle(t,e),{layoutMap:p}=i.internalProps;if(p.isHeader(t,e)){let n;if(!i.isPivotTable()||i.isBottomFrozenRow(e)||i.isRightFrozenColumn(t))n=`${t}-${e}`;else{const o=i.getHeaderDefine(t,e),r=i.isCornerHeader(t,e);n=(null==o?void 0:o.dimensionKey)?r?`dim-cor-${o.dimensionKey}`:`dim-${o.dimensionKey}`:(null==o?void 0:o.indicatorKey)?`ind-${o.indicatorKey}`:`${t}-${e}`}let l=i.headerStyleCache.get(n);if(l)return g?SH(l,g):l;const h=p.getHeader(t,e);let d;if(i.isPivotChart()&&function(t,e,i){if(!i._table.isPivotChart())return!1;if(i.indicatorsAsCol){if(i.hasTwoIndicatorAxes&&e===i.columnHeaderLevelCount-1&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return!0;if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return!0}else if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return!0;return!1}(t,e,p)&&p.isAxisCell(t,e)?d=null!==(r=null===(o=p.getBody(t,i.rowHeaderLevelCount).style)||void 0===o?void 0:o.padding)&&void 0!==r?r:i.theme.bodyStyle.padding:i.isPivotChart()&&function(t,e,i){if(!i._table.isPivotChart())return!1;if(i.indicatorsAsCol){if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return!0}else{if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return!0;if(t===i.colCount-i.rightFrozenColCount&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return!0}return!1}(t,e,p)&&p.isAxisCell(t,e)&&(d=null!==(a=null===(s=p.getBody(i.columnHeaderLevelCount,e).style)||void 0===s?void 0:s.padding)&&void 0!==a?a:i.theme.bodyStyle.padding),(!h||h.isEmpty)&&(p.isLeftBottomCorner(t,e)||p.isRightBottomCorner(t,e)||p.isCornerHeader(t,e)||p.isRightTopCorner(t,e)))return AH;const c=i.internalProps.headerHelper.getStyleClass((null==h?void 0:h.headerType)||"text");if(p.isBottomFrozenRow(t,e)&&i.theme.bottomFrozenStyle)l=YE(d?{padding:d}:{},i.theme.bottomFrozenStyle,{col:t,row:e,table:i,value:i.getCellValue(t,e),dataValue:i.getCellOriginValue(t,e),cellHeaderPaths:i.getCellHeaderPaths(t,e)},c,i.options.autoWrapText,i.theme);else if(p.isRightFrozenColumn(t,e)&&i.theme.rightFrozenStyle)l=YE(d?{padding:d}:{},i.theme.rightFrozenStyle,{col:t,row:e,table:i,value:i.getCellValue(t,e),dataValue:i.getCellOriginValue(t,e),cellHeaderPaths:i.getCellHeaderPaths(t,e)},c,i.options.autoWrapText,i.theme);else{const n=(null==h?void 0:h.style)||{};d&&(n.padding=d),l=YE(n,p.isColumnHeader(t,e)||p.isBottomFrozenRow(t,e)?i.theme.headerStyle:p.isRowHeader(t,e)||p.isRightFrozenColumn(t,e)?i.theme.rowHeaderStyle:i.theme.cornerHeaderStyle,{col:t,row:e,table:i,value:i.getCellValue(t,e),dataValue:i.getCellOriginValue(t,e),cellHeaderPaths:i.getCellHeaderPaths(t,e)},c,i.options.autoWrapText,i.theme)}return i.headerStyleCache.set(n,l),g?SH(l,g):l}let f,v;(null===(h=null===(l=i.internalProps)||void 0===l?void 0:l.dataConfig)||void 0===h?void 0:h.mappingRules)&&!i.isHeader(t,e)&&(null===(u=null===(c=null===(d=i.internalProps)||void 0===d?void 0:d.dataConfig)||void 0===c?void 0:c.mappingRules)||void 0===u||u.forEach(((n,o)=>{n.bgColor&&i.internalProps.layoutMap.getIndicatorKey(t,e)===n.bgColor.indicatorKey&&(f=n.bgColor.mapping)})));const b=i.getCellType(t,e),m=i.getCellOriginRecord(t,e);let y;if(v=(null==m?void 0:m.vtableMerge)?"merge-title":i.isSeriesNumberInBody(t,e)?`${t}-series-`+b:i.isListTable()&&!i.transpose||i.isPivotTable()&&i.internalProps.layoutMap.indicatorsAsCol?t+b:e+b,y=(null==m?void 0:m.vtableMerge)?i.bodyMergeTitleCache.get(v):p.isBottomFrozenRow(e)?i.bodyBottomStyleCache.get(v):i.bodyStyleCache.get(v),y)return g?SH(y,g):y;const C=p.getBody(t,e),w=i.internalProps.bodyHelper.getStyleClass(i.getCellType(t,e)),x=null==C?void 0:C.style;return y=Rx(x,(null==m?void 0:m.vtableMerge)&&i.theme.groupTitleStyle?i.theme.groupTitleStyle:p.isBottomFrozenRow(e)&&i.theme.bottomFrozenStyle?i.theme.bottomFrozenStyle:p.isRightFrozenColumn(t)&&i.theme.rightFrozenStyle?i.theme.rightFrozenStyle:i.theme.bodyStyle,{col:t,row:e,table:i,value:i.getCellValue(t,e),dataValue:i.getCellOriginValue(t,e),cellHeaderPaths:i.getCellHeaderPaths(t,e)},w,i.options.autoWrapText,i.theme),f&&(y=SH(y,{bgColor:f})),VC(x)||(p.isBottomFrozenRow(e)?i.bodyBottomStyleCache.set(v,y):i.bodyStyleCache.set(v,y)),g?SH(y,g):y}(t,e,this)}clearCellStyleCache(){this.headerStyleCache.clear(),this.bodyStyleCache.clear(),this.bodyMergeTitleCache.clear(),this.bodyBottomStyleCache.clear()}clearRowHeightCache(){this.internalProps._rowHeightsMap.clear(),this._clearRowRangeHeightsMap()}clearColWidthCache(){this.internalProps._colWidthsMap.clear(),this._clearColRangeWidthsMap()}_canResizeColumn(t,e){if(!(t>=0&&e>=0))return!1;if(this.isCellRangeEqual(t,e,t+1,e))return!1;if("none"===this.internalProps.columnResizeMode)return!1;if("header"===this.internalProps.columnResizeMode){if(!this.isHeader(t,e))return!1}else if("body"===this.internalProps.columnResizeMode&&this.isHeader(t,e))return!1;const i=this.colWidthsLimit[t];return!(i&&i.min&&i.max)||i.max!==i.min}_canResizeRow(t,e){if(!(t>=0&&e>=0))return!1;if(this.isCellRangeEqual(t,e,t,e+1))return!1;if("none"===this.internalProps.rowResizeMode)return!1;if("header"===this.internalProps.rowResizeMode){if(!this.isHeader(t,e))return!1}else if("body"===this.internalProps.rowResizeMode&&this.isHeader(t,e))return!1;return!0}_canDragHeaderPosition(t,e){var i;if(this.isHeader(t,e)&&(this.stateManager.isSelected(t,e)||"body"===(null===(i=this.options.select)||void 0===i?void 0:i.headerSelectMode)&&function(t,e,i){for(let n=0;n<i.length;n++)if(a_(i[n],t,e))return!0;return!1}(t,e,[this.getCellRange(this.stateManager.select.cellPos.col,this.stateManager.select.cellPos.row)])||xM(this,t,e))){if("disabled"===this.internalProps.frozenColDragHeaderMode&&this.isFrozenColumn(t))return!1;if(this.stateManager.isSelected(t,e)){const i=this.stateManager.select.ranges[0];if(this.isColumnHeader(t,e)){if(i.end.row!==this.rowCount-1)return!1}else{if(!this.isRowHeader(t,e))return!1;if(i.end.col!==this.colCount-1)return!1}}const i=this.getHeaderDefine(t,e);if(!i)return!1;if(void 0===i.dragHeader){if("all"===this.internalProps.dragHeaderMode)return!0;if("column"===this.internalProps.dragHeaderMode){if(this.isColumnHeader(t,e))return!0}else if("row"===this.internalProps.dragHeaderMode&&this.isRowHeader(t,e))return!0;return!1}return i.dragHeader}return!1}getCellIcons(t,e){var i,n,o;let r;if(this.isHeader(t,e))r=this.internalProps.headerHelper.getIcons(t,e);else if(this.internalProps.layoutMap.isSeriesNumber(t,e)){this.options.groupBy&&(null===(i=this.getCellRawRecord(t,e))||void 0===i?void 0:i.vtableMerge)||(null===(o=null===(n=this.internalProps.layoutMap.getSeriesNumberBody(t,e))||void 0===n?void 0:n.define)||void 0===o?void 0:o.dragOrder)&&(r=this.internalProps.rowSeriesNumberHelper.getIcons(t,e));const s=this.getCellValue(t,e),a=this.getCellOriginValue(t,e),l=this.internalProps.context,h=this.internalProps.bodyHelper.getIcons(t,e,s,a,l);(null==r?void 0:r.length)>0?r=r.concat(h):(null==h?void 0:h.length)>0&&(r=h)}else{const i=this.getCellValue(t,e),n=this.getCellOriginValue(t,e),o=this.internalProps.context;r=this.internalProps.bodyHelper.getIcons(t,e,i,n,o)}return r}showDropDownMenu(t,e,i){let n="dropdown-menu";i&&(n=Array.isArray(i.content)?"dropdown-menu":"container"),"html"===this.internalProps.menu.renderMode&&(this.stateManager.menu.isShow=!0,this.internalProps.menuHandler._bindToCell(t,e,n,i))}showTooltip(t,e,i){"html"===this.internalProps.tooltip.renderMode&&this.internalProps.tooltipHandler._bindToCell(t,e,i)}getCellStyle(t,e){const i=this._getCellStyle(t,e),n=RT(i,this,t,e,AR).theme,{autoWrapText:o,lineClamp:r,textOverflow:s}=i;return{textAlign:n.text.textAlign,textBaseline:n.text.textBaseline,bgColor:jC(n.group.fill)?AR("bgColor",i,t,e,this):n.group.fill,color:jC(n.text.fill)?AR("color",i,t,e,this):n.text.fill,strokeColor:jC(n.text.stroke)?AR("strokeColor",i,t,e,this):n.text.stroke,fontFamily:n.text.fontFamily,fontSize:n.text.fontSize,fontWeight:n.text.fontWeight,fontVariant:n.text.fontVariant,fontStyle:n.text.fontStyle,lineHeight:n.text.lineHeight,autoWrapText:null!=o&&o,lineClamp:null!=r?r:"auto",textOverflow:s,borderColor:jC(n.group.stroke)?AR("borderColor",i,t,e,this):n.group.stroke,borderLineWidth:n.group.lineWidth,borderLineDash:n.group.lineDash,underline:!!n.text.underline,underlineDash:n.text.underlineDash,underlineOffset:n.text.underlineOffset,lineThrough:!!n.text.lineThrough,padding:n._vtable.padding,underlineWidth:n.text.underline,lineThroughLineWidth:n.text.lineThrough,_strokeArrayWidth:n.group.strokeArrayWidth,_strokeArrayColor:n.group.strokeArrayColor,_linkColor:AR("linkColor",i,t,e,this)}}getAllBodyCells(t,e){const i=this.rowHeaderLevelCount,n=this.columnHeaderLevelCount,o=this.colCount-1,r=this.rowCount-1;return Array(Math.min(null!=e?e:2e3,r-n+1,this.rowCount)).fill(0).map(((e,r)=>Array(Math.min(null!=t?t:2e3,o-i+1,this.colCount)).fill(0).map(((t,e)=>this.getCellInfo(e+i,r+n)))))}getAllCells(t,e){const i=this.colCount-1,n=this.rowCount-1;return Array(Math.min(null!=e?e:2e3,n-0+1,this.rowCount)).fill(0).map(((e,n)=>Array(Math.min(null!=t?t:2e3,i-0+1,this.colCount)).fill(0).map(((t,e)=>this.getCellInfo(e+0,n+0)))))}getAllColumnHeaderCells(){const t=this.rowHeaderLevelCount,e=this.colCount-1,i=this.columnHeaderLevelCount-1;return Array(i-0+1).fill(0).map(((i,n)=>Array(e-t+1).fill(0).map(((e,i)=>this.getCellInfo(i+t,n+0)))))}getAllRowHeaderCells(){const t=this.columnHeaderLevelCount,e=this.rowHeaderLevelCount-1,i=this.rowCount-1;return Array(i-t+1).fill(0).map(((i,n)=>Array(e-0+1).fill(0).map(((e,i)=>this.getCellInfo(i+0,n+t)))))}getCopyValue(){var t,e,i;if((null===(e=null===(t=this.stateManager.select)||void 0===t?void 0:t.ranges)||void 0===e?void 0:e.length)>0){const t=this.stateManager.select.ranges;let e=Math.min(t[0].start.col,t[0].end.col),n=Math.max(t[0].start.col,t[0].end.col),o=Math.min(t[0].start.row,t[0].end.row),r=Math.max(t[0].start.row,t[0].end.row);t.forEach((t=>{e=Math.min(e,t.start.col,t.end.col),n=Math.max(n,t.start.col,t.end.col),o=Math.min(o,t.start.row,t.end.row),r=Math.max(r,t.start.row,t.end.row)}));const s=e=>{let i=!1;return t.forEach((t=>{const n=Math.min(t.start.row,t.end.row),o=Math.max(t.start.row,t.end.row);n<=e&&o>=e&&(i=!0)})),i},a=e=>{let i=!1;return t.forEach((t=>{const n=Math.min(t.start.col,t.end.col),o=Math.max(t.start.col,t.end.col);n<=e&&o>=e&&(i=!0)})),i},l=(e,i)=>{let n;return t.forEach((t=>{const o=Math.min(t.start.row,t.end.row),r=Math.max(t.start.row,t.end.row),s=Math.min(t.start.col,t.end.col),a=Math.max(t.start.col,t.end.col);s<=e&&a>=e&&o<=i&&r>=i&&(n=t)})),n},h=(t,e,i)=>{const n=this.getCellRange(t,e);let o=n.start.col,r=n.start.row;if(i){const t=Math.min(i.start.col,i.end.col),e=Math.min(i.start.row,i.end.row);o=Math.max(t,n.start.col),r=Math.max(e,n.start.row)}return o!==t||r!==e?"":this.getCellValue(t,e)};let d="";for(let t=o;t<=r;t++)if(s(t)){for(let i=e;i<=n;i++)if(a(i)){const e=l(i,t);if(e){const o=h(i,t,e);if("undefined"!=typeof Promise&&o instanceof Promise);else{const t=XC(o)?`${o}`:"";/^\[object .*\]$/.exec(t)||(d+=t)}(i<e.end.col||i<n)&&(d+="\t")}else d+="\t"}t<r&&(d+="\r\n")}return(null===(i=this.options)||void 0===i?void 0:i.formatCopyValue)&&(d=this.options.formatCopyValue(d)),d}return""}getSelectedCellInfos(){var t;if(!(null===(t=this.stateManager.select)||void 0===t?void 0:t.ranges))return null;const e=this.stateManager.select.ranges;if(!e.length)return[];let i=Math.min(e[0].start.col,e[0].end.col),n=Math.max(e[0].start.col,e[0].end.col),o=Math.min(e[0].start.row,e[0].end.row),r=Math.max(e[0].start.row,e[0].end.row);e.forEach((t=>{i=Math.min(i,t.start.col,t.end.col),n=Math.max(n,t.start.col,t.end.col),o=Math.min(o,t.start.row,t.end.row),r=Math.max(r,t.start.row,t.end.row)}));const s=t=>{let i=!1;return e.forEach((e=>{const n=Math.min(e.start.row,e.end.row),o=Math.max(e.start.row,e.end.row);n<=t&&o>=t&&(i=!0)})),i},a=t=>{let i=!1;return e.forEach((e=>{const n=Math.min(e.start.col,e.end.col),o=Math.max(e.start.col,e.end.col);n<=t&&o>=t&&(i=!0)})),i},l=(t,i)=>{let n;return e.forEach((e=>{const o=Math.min(e.start.row,e.end.row),r=Math.max(e.start.row,e.end.row),s=Math.min(e.start.col,e.end.col),a=Math.max(e.start.col,e.end.col);s<=t&&a>=t&&o<=i&&r>=i&&(n=e)})),n},h=[];for(let t=o;t<=r;t++)if(s(t)){const e=[];for(let o=i;o<=n;o++)if(a(o)&&l(o,t)){const i=this.getCellInfo(o,t);e.push(i)}h.push(e)}return h}getSelectedCellRanges(){const t=this.stateManager.select.ranges;return t.length?lw(t):[]}measureText(t,e){return dk.measureText(t,e)}measureTextBounds(t){return uk(t)}getCustomRender(t,e){let i;if("body"!==this.getCellLocation(t,e)){const n=this.getHeaderDefine(t,e);i=null==n?void 0:n.headerCustomRender}else{const n=this.getBodyColumnDefine(t,e);i=(null==n?void 0:n.customRender)||this.customRender}return i}getCustomLayout(t,e){let i;if("body"!==this.getCellLocation(t,e)){const n=this.getHeaderDefine(t,e);i=null==n?void 0:n.headerCustomLayout}else{const n=this.getBodyColumnDefine(t,e);i=null==n?void 0:n.customLayout}return i}hasAutoImageColumn(){return void 0===this._hasAutoImageColumn&&(this._hasAutoImageColumn=function(t){const{columns:e,rows:i,indicators:n}=t.options;if(t.isPivotTable()){if(ZC(e)&&e.length>0)for(let t=0;t<e.length;t++){const i=e[t];if(!qC(i)&&("image"===i.headerType||"video"===i.headerType||"function"==typeof i.headerType)&&i.imageAutoSizing)return!0}if(ZC(i)&&i.length>0)for(let t=0;t<i.length;t++){const e=i[t];if(!qC(e)&&("image"===e.headerType||"video"===e.headerType||"function"==typeof e.headerType)&&e.imageAutoSizing)return!0}if(ZC(n)&&n.length>0)for(let t=0;t<n.length;t++){const e=n[t];if(!qC(e)&&(("image"===e.cellType||"video"===e.cellType||"function"==typeof e.cellType)&&e.imageAutoSizing||("image"===e.headerType||"video"===e.headerType||"function"==typeof e.headerType)&&e.imageAutoSizing))return!0}}else if(ZC(e)&&e.length>0)for(let t=0;t<e.length;t++){const i=e[t];if(("image"===i.cellType||"video"===i.cellType||"function"==typeof i.cellType)&&i.imageAutoSizing||("image"===i.headerType||"video"===i.headerType||"function"==typeof i.headerType)&&i.imageAutoSizing)return!0}return!1}(this)),this._hasAutoImageColumn}_getActiveChartInstance(){var t,e,i,n,o,r;const s=this.scenegraph.getCell(null===(e=null===(t=this.stateManager.hover)||void 0===t?void 0:t.cellPos)||void 0===e?void 0:e.col,null===(n=null===(i=this.stateManager.hover)||void 0===i?void 0:i.cellPos)||void 0===n?void 0:n.row);return"chart"===(null===(r=null===(o=null==s?void 0:s.getChildren())||void 0===o?void 0:o[0])||void 0===r?void 0:r.type)?s.getChildren()[0].activeChartInstance:null}cellIsInVisualView(t,e){var i,n,o,r;const s=this.getDrawRange(),a=this.getCellRelativeRect(t,e);if(t<this.frozenColCount&&e<this.frozenRowCount)return!0;let l,h,d,c;if(this.frozenRowCount>=1&&(l=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.colCount-1,row:this.frozenRowCount-1}})),this.frozenColCount>=1&&(h=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.frozenColCount-1,row:this.rowCount-1}})),this.bottomFrozenRowCount>=1&&(d=this.getCellRangeRelativeRect({start:{col:0,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.colCount-1,row:this.rowCount-1}})),this.rightFrozenColCount>=1&&(c=this.getCellRangeRelativeRect({start:{col:this.colCount-this.rightFrozenColCount,row:0},end:{col:this.colCount-1,row:this.rowCount-1}})),a.top>=s.top&&a.bottom<=s.bottom&&a.left>=s.left&&a.right<=s.right){if(this.isFrozenCell(t,e))return!0;if(a.top>=(null!==(i=null==l?void 0:l.bottom)&&void 0!==i?i:a.top)&&a.left>=(null!==(n=null==h?void 0:h.right)&&void 0!==n?n:a.left)&&a.bottom<=(null!==(o=null==d?void 0:d.top)&&void 0!==o?o:a.bottom)&&a.right<=(null!==(r=null==c?void 0:c.left)&&void 0!==r?r:a.right))return!0}return!1}getCustomMergeValue(t,e){if(this.internalProps.customMergeCell){const i=this.getCustomMerge(t,e);if(i){const{text:t}=i;return t}}}exportImg(){return this.scenegraph.stage.toCanvas().toDataURL()}exportCellImg(t,e,i){var n,o,r,s;const a=this.cellIsInVisualView(t,e),{scrollTop:l,scrollLeft:h}=this;a||this.scrollToCell({col:t,row:e});const d=this.getCellRelativeRect(t,e);(null===(o=null===(n=this.stateManager.select)||void 0===n?void 0:n.ranges)||void 0===o?void 0:o.length)>0&&XL(this.scenegraph);const{col:c,row:u}=this.stateManager.hover.cellPos;let g,p;if(this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.tableGroup.border.setAttribute("visible",!1),null==i?void 0:i.disableBackground){const i=this.scenegraph.getCell(t,e);g=i.attribute.fill,i.setAttribute("fill","transparent")}if(null==i?void 0:i.disableBorder){const i=this.scenegraph.getCell(t,e);p=i.attribute.stroke,i.setAttribute("stroke",!1)}this.scenegraph.renderSceneGraph();let f=0;"bottom-right"===this.theme.cellBorderClipDirection&&(f=1);const v=this.scenegraph.stage.toCanvas(!1,(new Cw).set(d.left+this.tableX+1,d.top+this.tableY+1,d.right+this.tableX-f,d.bottom+this.tableY-f));return a||(this.setScrollTop(l),this.setScrollLeft(h)),this.scenegraph.tableGroup.border.setAttribute("visible",!0),g&&this.scenegraph.getCell(t,e).setAttribute("fill",g),p&&this.scenegraph.getCell(t,e).setAttribute("stroke",p),(null===(s=null===(r=this.stateManager.select)||void 0===r?void 0:r.ranges)||void 0===s?void 0:s.length)>0&&$L(this.scenegraph),this.stateManager.updateHoverPos(c,u),this.scenegraph.updateNextFrame(),v.toDataURL()}exportCellRangeImg(t){var e,i,n,o;const{scrollTop:r,scrollLeft:s}=this,a=Math.min(t.start.col,t.end.col),l=Math.min(t.start.row,t.end.row),h=Math.max(t.start.col,t.end.col),d=Math.max(t.start.row,t.end.row),c=this.cellIsInVisualView(a,l),u=this.cellIsInVisualView(h,d);c&&u||this.scrollToCell({col:a,row:l});const g=this.getCellRangeRelativeRect({start:{col:a,row:l},end:{col:h,row:d}});(null===(i=null===(e=this.stateManager.select)||void 0===e?void 0:e.ranges)||void 0===i?void 0:i.length)>0&&XL(this.scenegraph);const{col:p,row:f}=this.stateManager.hover.cellPos;this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.renderSceneGraph();const v=this.scenegraph.stage.toCanvas(!1,(new Cw).set(g.left+this.tableX+1,g.top+this.tableY+1,g.right+this.tableX,g.bottom+this.tableY)).toDataURL();return c&&u||(this.setScrollTop(r),this.setScrollLeft(s)),(null===(o=null===(n=this.stateManager.select)||void 0===n?void 0:n.ranges)||void 0===o?void 0:o.length)>0&&$L(this.scenegraph),this.stateManager.updateHoverPos(p,f),v}exportCanvas(){return this.scenegraph.stage.toCanvas()}getImageBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png";if("node"!==this.options.mode)return;this.render();const e=this.scenegraph.stage;if(e){let i=this.tableX+this.getAllColsWidth(),n=this.tableY+this.getAllRowsHeight();return this.internalProps.legends&&this.internalProps.legends.forEach((t=>{"right"===t.orient?i=Math.max(i,t.legendComponent.globalAABBBounds.x2):"bottom"===t.orient&&(n=Math.max(n,t.legendComponent.globalAABBBounds.y2))})),this.internalProps.title&&("right"===this.internalProps.title._titleOption.orient?i=Math.max(i,this.internalProps.title.getComponentGraphic().globalAABBBounds.x2):"bottom"===this.internalProps.title._titleOption.orient&&(n=Math.max(n,this.internalProps.title.getComponentGraphic().globalAABBBounds.y2))),i>=this.canvasWidth&&n>=this.canvasHeight?(e.render(),e.window.getImageBuffer(t)):this.scenegraph.stage.toCanvas(!1,(new Cw).set(0,0,Math.min(this.canvasWidth,i),Math.min(this.canvasHeight,n))).toBuffer(t)}return null}getBodyIndexByTableIndex(t,e){return{col:t-this.rowHeaderLevelCount-this.leftRowSeriesNumberCount,row:e-this.columnHeaderLevelCount}}getTableIndexByBodyIndex(t,e){return{col:t+this.rowHeaderLevelCount+this.leftRowSeriesNumberCount,row:e+this.columnHeaderLevelCount}}onVChartEvent(t,e,i){this._chartEventMap[t]||(this._chartEventMap[t]=[]),"function"==typeof e?this._chartEventMap[t].push({callback:e}):this._chartEventMap[t].push({callback:i,query:e})}offVChartEvent(t,e){this._chartEventMap[t]&&(this._chartEventMap[t]=e?this._chartEventMap[t].filter((t=>t.callback!==e)):[])}_bindChartEvent(t){if(t)for(const e in this._chartEventMap)(this._chartEventMap[e]||[]).forEach((i=>{i.query?t.on(e,i.query,i.callback):t.on(e,i.callback)}))}changeRecordOrder(t,e){}hasCustomCellStyle(t){var e;return null===(e=this.customCellStylePlugin)||void 0===e?void 0:e.hasCustomCellStyle(t)}registerCustomCellStyle(t,e){var i;null===(i=this.customCellStylePlugin)||void 0===i||i.registerCustomCellStyle(t,e)}arrangeCustomCellStyle(t,e,i){var n;null===(n=this.customCellStylePlugin)||void 0===n||n.arrangeCustomCellStyle(t,e,i)}isSeriesNumber(t,e){return this.internalProps.layoutMap.isSeriesNumber(t,e)}isHasSeriesNumber(){var t;return(null===(t=this.internalProps.layoutMap)||void 0===t?void 0:t.leftRowSeriesNumberColumnCount)>0}get leftRowSeriesNumberCount(){var t,e;return null!==(e=null===(t=this.internalProps.layoutMap)||void 0===t?void 0:t.leftRowSeriesNumberColumnCount)&&void 0!==e?e:0}setMinMaxLimitWidth(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e,i;const n=this.internalProps;for(let o=0;o<n.layoutMap.columnWidths.length;o++){if(this.internalProps._widthResizedColMap.has(o))continue;const{width:r,minWidth:s,maxWidth:a}=null!==(i=null===(e=n.layoutMap.columnWidths)||void 0===e?void 0:e[o])&&void 0!==i?i:{};t&&r&&("string"==typeof r&&"auto"!==r||"number"==typeof r&&r>0)&&this._setColWidth(o,r),s&&("number"==typeof s&&s>0||"string"==typeof s)&&this.setMinColWidth(o,s),a&&("number"==typeof a&&a>0||"string"==typeof a)&&this.setMaxColWidth(o,a)}}setSortedIndexMap(t,e){var i;null===(i=this.dataSource)||void 0===i||i.setSortedIndexMap(t,e)}checkReactCustomLayout(){this.reactCustomLayout||(this.reactCustomLayout=new HT(this))}get bodyDomContainer(){return this.internalProps.bodyDomContainer}get headerDomContainer(){return this.internalProps.headerDomContainer}get frozenBodyDomContainer(){return this.internalProps.frozenBodyDomContainer}get frozenHeaderDomContainer(){return this.internalProps.frozenHeaderDomContainer}get rightFrozenBodyDomContainer(){return this.internalProps.rightFrozenBodyDomContainer}get rightFrozenHeaderDomContainer(){return this.internalProps.rightFrozenHeaderDomContainer}get frozenBottomDomContainer(){return this.internalProps.frozenBottomDomContainer}get bottomDomContainer(){return this.internalProps.bottomDomContainer}get rightFrozenBottomDomContainer(){return this.internalProps.rightFrozenBottomDomContainer}showMoverLine(t,e){this.scenegraph.component.showMoveCol(t,e,0),this.scenegraph.renderSceneGraph()}hideMoverLine(t,e){this.scenegraph.component.hideMoveCol(),this.scenegraph.renderSceneGraph()}disableScroll(){this.eventManager.disableScroll()}enableScroll(){this.eventManager.enableScroll()}getGroupTitleLevel(t,e){}scrollToRow(t,e){e?this.animationManager.scrollTo({row:t},e):this.scrollToCell({row:t})}scrollToCol(t,e){e?this.animationManager.scrollTo({col:t},e):this.scrollToCell({col:t})}scrollToCell(t,e){if(e)return void this.animationManager.scrollTo(t,e);const i=this.getDrawRange();if(XC(t.col)&&t.col>=this.frozenColCount){const e=this.getFrozenColsWidth(),n=this.getColsWidth(0,t.col-1);this.scrollLeft=Math.min(n-e,this.getAllColsWidth()-i.width)}if(XC(t.row)&&t.row>=this.frozenRowCount){const e=this.getFrozenRowsHeight(),n=this.getRowsHeight(0,t.row-1);this.scrollTop=Math.min(n-e,this.getAllRowsHeight()-i.height)}this.render()}checkHasColumnAutoWidth(){return function(t){if("autoWidth"===t.options.widthMode)return!0;if("auto"===t.options.defaultHeaderColWidth||Array.isArray(t.options.defaultHeaderColWidth)&&t.options.defaultHeaderColWidth.includes("auto"))return!0;const e=t.internalProps.layoutMap.columnObjects;for(let t=0;t<e.length;t++)if("auto"===e[t].width)return!0;return!1}(this)}}const HH={},OH={};const IH={};function FH(t,e,i){const n=t[e];return t[e]=i,n}function zH(t){for(const e in t)delete t[e]}var DH=Object.freeze({__proto__:null,aggregator:function(t,e){null!=e&&FH(Qw,t,e)},chartModule:function(t,e){return null!=e?FH(HH,t,e):HH[t]},clearAll:function(){zH(k_),zH(CR),zH(HH),zH(IH),zH(Qw)},editor:function(t,e){return null!=e?FH(IH,t,e):IH[t]},icon:function(t,e){return null!=e?FH(CR,t,e):CR[t]},theme:function(t,e){return null!=e?FH(k_,t,e):k_[t]}});var WH=(t,e)=>Object.prototype.toString.call(t)===`[object ${e}]`;var NH=function(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"boolean"==typeof t:!0===t||!1===t||WH(t,"Boolean")};var GH=t=>"function"==typeof t;var jH=t=>null==t;var VH=t=>null!=t;var UH=t=>"object"==typeof t&&null!==t;var XH=function(t){if(!UH(t)||!WH(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};var $H=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"string"===e:"string"===e||WH(t,"String")};var YH=t=>Array.isArray?Array.isArray(t):WH(t,"Array");var KH=function(t){return null!==t&&"function"!=typeof t&&Number.isFinite(t.length)};var qH=t=>WH(t,"Date");var ZH=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"number"===e:"number"===e||WH(t,"Number")};function JH(t,e,i){let n;if(!VH(t)||"object"!=typeof t||e&&e(t))return t;const o=YH(t),r=t.length;n=o?new Array(r):"object"==typeof t?{}:NH(t)||ZH(t)||$H(t)?t:qH(t)?new Date(+t):void 0;const s=o?void 0:Object.keys(Object(t));let a=-1;if(n)for(;++a<(s||t).length;){const o=s?s[a]:a,r=t[o];i&&i.includes(o.toString())?n[o]=r:n[o]=JH(r,e,i)}return n}function QH(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e){if(t===e)return;if(VH(e)&&"object"==typeof e){const o=Object(e),r=[];for(const t in o)r.push(t);let{length:s}=r,a=-1;for(;s--;){const s=r[++a];!VH(o[s])||"object"!=typeof o[s]||n&&YH(t[s])?eO(t,s,o[s]):tO(t,e,s,i,n)}}}}function tO(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=t[i],s=e[i];let a=e[i],l=!0;if(YH(s)){if(n)a=[];else if(YH(r))a=r;else if(KH(r)){a=new Array(r.length);let t=-1;const e=r.length;for(;++t<e;)a[t]=r[t]}}else XH(s)?(a=null!=r?r:{},"function"!=typeof r&&"object"==typeof r||(a={})):l=!1;l&&QH(a,s,n,o),eO(t,i,a)}function eO(t,e,i){(void 0!==i&&!function(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}(t[e],i)||void 0===i&&!(e in t))&&(t[e]=i)}function iO(t,e,i){const n=function(t){if(!t)return[];if(Object.keys)return Object.keys(t);const e=[];for(const i in t)t.hasOwnProperty(i)&&e.push(i);return e}(e);for(let o=0;o<n.length;o++){const r=n[o];(i?null!=e[r]:null==t[r])&&(t[r]=e[r])}return t}function nO(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t="prototype"in t?t.prototype:t,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames){const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o++){const r=n[o];"constructor"!==r&&(i?null!=e[r]:null==t[r])&&(t[r]=e[r])}}else iO(t,e,i)}function oO(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function rO(t){return Number(t)}const sO="undefined"!=typeof console;function aO(t,e,i){const n=[e].concat([].slice.call(i));sO&&console[t].apply(console,n)}var lO;!function(t){t[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug"}(lO||(lO={}));class hO{static getInstance(t,e){return hO._instance&&ZH(t)?hO._instance.level(t):hO._instance||(hO._instance=new hO(t,e)),hO._instance}static setInstance(t){return hO._instance=t}static setInstanceLevel(t){hO._instance?hO._instance.level(t):hO._instance=new hO(t)}static clearInstance(){hO._instance=null}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:lO.None,e=arguments.length>1?arguments[1]:void 0;this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find((e=>e===t))||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex((e=>e===t));e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this._onErrorHandler.forEach((t=>t(...e)))}canLogInfo(){return this._level>=lO.Info}canLogDebug(){return this._level>=lO.Debug}canLogError(){return this._level>=lO.Error}canLogWarn(){return this._level>=lO.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return this._level>=lO.Error&&(this._onErrorHandler.length?this.callErrorHandler(...i):aO(null!==(t=this._method)&&void 0!==t?t:"error","ERROR",i)),this}warn(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=lO.Warn&&aO(this._method||"warn","WARN",e),this}info(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=lO.Info&&aO(this._method||"log","INFO",e),this}debug(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=lO.Debug&&aO(this._method||"log","DEBUG",e),this}}hO._instance=null;const dO=1e-10,cO=1e-10;function uO(t,e){const i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:dO,n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:cO)*Math.max(t,e);return Math.abs(t-e)<=Math.max(i,n)}function gO(t,e,i,n){return t>e&&!uO(t,e,i,n)}function pO(t,e,i,n){return t<e&&!uO(t,e,i,n)}const fO=t=>{let e=null,i=null;return function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return e&&o.every(((t,i)=>t===e[i]))||(e=o,i=t(...o)),i}};var vO=function(t,e,i){return t<e?e:t>i?i:t};function bO(t,e){let i;return t>e&&(i=t,t=e,e=i),i=>Math.max(t,Math.min(e,i))}function mO(t,e){return i=>t*(1-i)+e*i}function yO(t,e){return function(i){return Math.round(t*(1-i)+e*i)}}function CO(t,e,i){e/=100,i/=100;const n=(1-Math.abs(2*i-1))*e,o=n*(1-Math.abs(t/60%2-1)),r=i-n/2;let s=0,a=0,l=0;return 0<=t&&t<60?(s=n,a=o,l=0):60<=t&&t<120?(s=o,a=n,l=0):120<=t&&t<180?(s=0,a=n,l=o):180<=t&&t<240?(s=0,a=o,l=n):240<=t&&t<300?(s=o,a=0,l=n):300<=t&&t<360&&(s=n,a=0,l=o),s=Math.round(255*(s+r)),a=Math.round(255*(a+r)),l=Math.round(255*(l+r)),{r:s,g:a,b:l}}function wO(t,e,i){t/=255,e/=255,i/=255;const n=Math.min(t,e,i),o=Math.max(t,e,i),r=o-n;let s=0,a=0,l=0;return s=0===r?0:o===t?(e-i)/r%6:o===e?(i-t)/r+2:(t-e)/r+4,s=Math.round(60*s),s<0&&(s+=360),l=(o+n)/2,a=0===r?0:r/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l:l}}const xO=/^#([0-9a-f]{3,8})$/,_O={transparent:4294967040},SO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function AO(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function BO(t){return ZH(t)?new LO(t>>16,t>>8&255,255&t,1):YH(t)?new LO(t[0],t[1],t[2]):new LO(255,255,255)}function TO(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function RO(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const kO=(t,e)=>{const i=xO.exec(t);if(e||i){const t=parseInt(i[1],16),e=i[1].length;return 3===e?new LO((t>>8&15)+((t>>8&15)<<4),(t>>4&15)+((t>>4&15)<<4),(15&t)+((15&t)<<4),1):6===e?BO(t):8===e?new LO(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):null}};class MO{static Brighter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===e?t:new MO(t).brighter(e).toRGBA()}static SetOpacity(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===e?t:new MO(t).setOpacity(e).toRGBA()}static getColorBrightness(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hsl";const i=t instanceof MO?t:new MO(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3()}}static parseColorString(t){if(VH(_O[t]))return function(t){return ZH(t)?new LO(t>>>24,t>>>16&255,t>>>8&255,255&t):YH(t)?new LO(t[0],t[1],t[2],t[3]):new LO(255,255,255,1)}(_O[t]);if(VH(SO[t]))return BO(SO[t]);const e=`${t}`.trim().toLowerCase(),i=kO(e);if(void 0!==i)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const t=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new LO(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),parseFloat(t[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const t=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),i=CO(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10));return new LO(i.r,i.g,i.b,parseFloat(t[3]))}}constructor(t){const e=MO.parseColorString(t);this.color=e||new LO(255,255,255)}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:n}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(n*t))),this}add(t){const{r:e,g:i,b:n}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,n+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:n}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(n*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return.5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const n=this.color.opacity,o=wO(this.color.r,this.color.g,this.color.b),r=CO(jH(t)?o.h:vO(t,0,360),jH(e)?o.s:e>=0&&e<=1?100*e:e,jH(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new LO(r.r,r.g,r.b,n),this}setRGB(t,e,i){return!jH(t)&&(this.color.r=t),!jH(e)&&(this.color.g=e),!jH(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=kO(e,!0);return null!=i?i:this}setColorName(t){const e=SO[t.toLowerCase()];return void 0!==e&&this.setHex(e),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}clone(){return new MO(this.color.toString())}copyGammaToLinear(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=TO(t.color.r),this.color.g=TO(t.color.g),this.color.b=TO(t.color.b),this}copyLinearToSRGB(t){return this.color.r=RO(t.color.r),this.color.g=RO(t.color.g),this.color.b=RO(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class LO{constructor(t,e,i,n){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),VH(n)?this.opacity=isNaN(+n)?1:Math.max(0,Math.min(1,+n)):this.opacity=1}formatHex(){return`#${AO(this.r)+AO(this.g)+AO(this.b)+(1===this.opacity?"":AO(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${1===t?"rgb(":"rgba("}${this.r},${this.g},${this.b}${1===t?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:n}=wO(this.r,this.g,this.b);return`${1===t?"hsl(":"hsla("}${e},${i}%,${n}%${1===t?")":`,${t})`}`}toString(){return this.formatHex()}}var PO=Object.freeze({__proto__:null,Color:MO,DEFAULT_COLORS:SO,RGB:LO,hexToRgb:function(t){let e="",i="",n="";const o="#"===t[0]?1:0;for(let r=o;r<t.length;r++)"#"!==t[r]&&(r<o+2?e+=t[r]:r<o+4?i+=t[r]:r<o+6&&(n+=t[r]));return[parseInt(e,16),parseInt(i,16),parseInt(n,16)]},hslToRgb:CO,interpolateRgb:function(t,e){const i=t.r,n=e.r,o=t.g,r=e.g,s=t.b,a=e.b,l=t.opacity,h=e.opacity;return t=>{const e=Math.round(i*(1-t)+n*t),d=Math.round(o*(1-t)+r*t),c=Math.round(s*(1-t)+a*t);return new LO(e,d,c,l*(1-t)+h*t)}},rgbToHex:function(t,e,i){return Number((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},rgbToHsl:wO});const EO=(t,e)=>{var i,n;if(!(null==e?void 0:e.fields))return t;if(0===t.length)return t;const o=e.fields,r=t[0],s={},a=[];for(const e in o)if(Object.prototype.hasOwnProperty.call(o,e)){const l=o[e];if(!l.type){let n=r;e in r||(n=null!==(i=t.find((t=>e in t)))&&void 0!==i?i:r),l.type="number"==typeof n[e]?"linear":"ordinal"}let h;if("number"==typeof l.sortIndex&&(h={key:e,type:l.type,index:l.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:!0===l.sortReverse},a.push(h)),(null===(n=l.domain)||void 0===n?void 0:n.length)>0)if("ordinal"===l.type){l._domainCache={},s[e]=l;const t={};l.domain.forEach(((e,i)=>{t[e]=i,l._domainCache[e]=i})),h&&(h.sortIndex=t,h.sortIndexCount=l.domain.length)}else l.domain.length>=2&&(s[e]=l)}return Object.keys(s).length>0&&(t=t.filter((t=>{for(const e in s){const i=s[e];if("ordinal"===i.type){if(!(t[e]in i._domainCache))return!1}else if(i.domain[0]>t[e]||i.domain[1]<t[e])return!1}return!0}))),a.sort(((t,e)=>t.index-e.index)),t.sort(((t,e)=>function(t,e,i){for(let n=0;n<i.length;n++){const o=i[n];let r=0;if("ordinal"===o.type?(void 0===o.sortIndex[e[o.key]]&&(o.sortIndex[e[o.key]]=o.sortIndexCount++),void 0===o.sortIndex[t[o.key]]&&(o.sortIndex[t[o.key]]=o.sortIndexCount++),r=o.sortIndex[t[o.key]]-o.sortIndex[e[o.key]]):"linear"===o.type&&(r=t[o.key]-e[o.key]),o.sortReverse&&(r=-r),0!==r)return r}return 0}(t,e,a))),t};let HO=0;function OO(){return HO>1e8&&(HO=0),(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dataset")+"_"+HO++}class IO{constructor(t){var e;let i;this.options=t,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new et,i=(null==t?void 0:t.name)?t.name:OO("dataset"),this.name=i,this._logger=null!==(e=null==t?void 0:t.logger)&&void 0!==e?e:hO.getInstance()}setLogger(t){this._logger=t}getDataView(t){return this.dataViewMap[t]}setDataView(t,e){var i;this.dataViewMap[t]&&(null===(i=this._logger)||void 0===i||i.error(`Error: dataView ${t} 之前已存在，请重新命名`)),this.dataViewMap[t]=e}removeDataView(t){this.dataViewMap[t]=null,delete this.dataViewMap[t]}registerParser(t,e){var i;this.parserMap[t]&&(null===(i=this._logger)||void 0===i||i.warn(`Warn: transform ${t} 之前已注册，执行覆盖逻辑`)),this.parserMap[t]=e}removeParser(t){this.parserMap[t]=null,delete this.parserMap[t]}getParser(t){return this.parserMap[t]||this.parserMap.default}registerTransform(t,e){var i;this.transformMap[t]&&(null===(i=this._logger)||void 0===i||i.warn(`Warn: transform ${t} 之前已注册，执行覆盖逻辑`)),this.transformMap[t]=e}removeTransform(t){this.transformMap[t]=null,delete this.transformMap[t]}getTransform(t){return this.transformMap[t]}multipleDataViewAddListener(t,e,i){this._callMap||(this._callMap=new Map);let n=this._callMap.get(i);n||(n=()=>{t.some((t=>t.isRunning))||i()}),t.forEach((t=>{t.target.addListener(e,n)})),this._callMap.set(i,n)}allDataViewAddListener(t,e){this.multipleDataViewAddListener(Object.values(this.dataViewMap),t,e)}multipleDataViewRemoveListener(t,e,i){if(this._callMap){const n=this._callMap.get(i);n&&t.forEach((t=>{t.target.removeListener(e,n)})),this._callMap.delete(i)}}multipleDataViewUpdateInParse(t){t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.markRunning()})),t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.parseNewData(t.data,t.options)}))}multipleDataViewUpdateInRawData(t){t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.markRunning()})),t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.updateRawData(t.data,t.options)}))}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}}const FO="_data-view-diff-rank";class zO{constructor(t,e){var i=this;let n;this.dataSet=t,this.options=e,this.isDataView=!0,this.target=new et,this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{pushHistory:!0,emitMessage:!0};return i.isRunning=!0,i.resetTransformData(),i.transformsArr.forEach((e=>{i.executeTransform(e,{pushHistory:t.pushHistory,emitMessage:!1}),i.isLastTransform(e)&&i.diffLastData()})),i.isRunning=!1,!1!==t.emitMessage&&i.target.emit("change",[]),i},this.markRunning=()=>{this.isRunning=!0,this.target.emit("markRunning",[])},n=(null==e?void 0:e.name)?e.name:OO("dataview"),this.name=n,(null==e?void 0:e.history)&&(this.history=e.history,this.historyData=[]),this.dataSet.setDataView(n,this),this.setFields(null==e?void 0:e.fields)}parse(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n;this.isRunning=!0,i&&this.target.emit("beforeParse",[]),e&&(this.parseOption=e);const o=this.cloneParseData(t,e);if(null==e?void 0:e.type){const t=(null!==(n=this.dataSet.getParser(e.type))&&void 0!==n?n:this.dataSet.getParser("bytejson"))(o,e.options,this);this.rawData=o,this.parserData=t,this.history&&this.historyData.push(o,t),this.latestData=t}else this.parserData=o,this.rawData=o,this.history&&this.historyData.push(o),this.latestData=o;return this.isRunning=!1,i&&this.target.emit("afterParse",[]),this}transform(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.isRunning=!0,t&&t.type){let i=!0;if("fields"===t.type){this._fields=t.options.fields;const e=this.transformsArr.findIndex((e=>e.type===t.type));e>=0&&(i=!1,this.transformsArr[e].options.fields=this._fields)}if(i&&this.transformsArr.push(t),e){const e=this.isLastTransform(t);this.executeTransform(t),e&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(t){return this.transformsArr[this.transformsArr.length-1]===t}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort(((t,e)=>{var i,n;return(null!==(i=t.level)&&void 0!==i?i:0)-(null!==(n=e.level)&&void 0!==n?n:0)}))}executeTransform(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{pushHistory:!0,emitMessage:!0};const{pushHistory:i,emitMessage:n}=e,o=this.dataSet.getTransform(t.type)(this.latestData,t.options);this.history&&!1!==i&&this.historyData.push(o),this.latestData=o,!1!==n&&this.target.emit("change",[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(t){this._diffData=!0,this._diffKeys=t,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){var t;if(!this._diffData)return;if(!this.latestData.forEach)return;if(!(null===(t=this._diffKeys)||void 0===t?void 0:t.length))return;const e=this._diffRank+1;if(0===this._diffRank)this.latestData.forEach((t=>{t[FO]=e,this._diffMap.set(this._diffKeys.reduce(((e,i)=>e+t[i]),""),t)})),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let t;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach((i=>{i[FO]=e,t=this._diffKeys.reduce(((t,e)=>t+i[e]),""),this._diffMap.get(t)?this.latestDataAUD.update.push(i):this.latestDataAUD.add.push(i),this._diffMap.set(t,i)})),this._diffMap.forEach(((t,i)=>{t[FO]<e&&(this.latestDataAUD.del.push(t),this._diffMap.delete(i))}))}this._diffRank=e}cloneParseData(t,e){let i=!1;return t instanceof zO||!0!==(null==e?void 0:e.clone)||(i=!0),i?JH(t):t}parseNewData(t,e){this.parse(t,e||this.parseOption),this.reRunAllTransform()}updateRawData(t,e){const i=this.cloneParseData(t,e);this.rawData=i,this.parserData=i,this.latestData=i,this.reRunAllTransform()}getFields(){var t;return this._fields?this._fields:"dataview"===(null===(t=this.parseOption)||void 0===t?void 0:t.type)&&1===this.rawData.length&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._fields=t&&e?function(t){let e=-1;const i=arguments.length<=1?0:arguments.length-1;for(;++e<i;)QH(t,e+1<1||arguments.length<=e+1?void 0:arguments[e+1],!0);return t}({},this._fields,t):t;const i=this.transformsArr.find((t=>"fields"===t.type));!jH(this._fields)&&jH(i)?(this.dataSet.registerTransform("fields",EO),this.transform({type:"fields",options:{fields:this._fields}},!1)):i&&(i.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}}function DO(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["data"];const i=t;let n;if(!VH(i)||"object"!=typeof i)return i;if(function(t){return t instanceof zO}(i)||function(t){try{return t instanceof Element}catch(e){const i=["children","innerHTML","classList","setAttribute","tagName","getBoundingClientRect"],n=Object.keys(t);return i.every((t=>n.includes(t)))}}(i))return i;const o=YH(i),r=i.length;n=o?new Array(r):"object"==typeof i?{}:NH(i)||ZH(i)||$H(i)?i:qH(i)?new Date(+i):void 0;const s=o?void 0:Object.keys(Object(i));let a=-1;if(n)for(;++a<(s||i).length;){const t=s?s[a]:a,o=i[t];(null==e?void 0:e.includes(t.toString()))?n[t]=o:n[t]=DO(o,e)}return n}function WO(t){var e,i;const n=Object.assign({},t);return sw(t.style)||(n.textStyle=NO(t.style)),sw(t.textStyle)||uw(n.textStyle,NO(t.textStyle)),(null===(e=t.shape)||void 0===e?void 0:e.style)&&NO(n.shape.style),(null===(i=t.background)||void 0===i?void 0:i.style)&&NO(n.background.style),n}function NO(t){return sw(t)||t.angle&&(t.angle=vw(t.angle)),t}function GO(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return sw(t.style)||(t.style=NO(t.style)),sw(t.state)||Object.keys(t.state).forEach((e=>{sw(t.state[e])||(t.state[e]=NO(t.state[e]))})),t}function jO(t){return sw(t)?null:(Object.keys(t).forEach((e=>{sw(t[e])||(t[e]=NO(t[e]))})),t)}const VO={left:{textAlign:"center",textBaseline:"bottom"},right:{textAlign:"center",textBaseline:"bottom"},radius:{},angle:{}},UO="PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",XO=14,$O=14,YO=4,KO={domainLine:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,tickSize:YO,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,tickSize:YO/2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},label:{visible:!0,space:1,style:{fontSize:$O,fill:"#89909D",fontWeight:"normal",fillOpacity:1},autoLimit:!0},title:{space:10,style:{fontSize:$O,fill:"#333333",fontWeight:"normal",fillOpacity:1}}};function qO(t){var e,i,n,o,r,s,a,l,h,d,c,u,g;const p=uw({},t);let f,v=null!==(i=null===(e=p.title)||void 0===e?void 0:e.angle)&&void 0!==i?i:0;"left"!==p.orient&&"right"!==p.orient||(null===(n=p.title)||void 0===n?void 0:n.autoRotate)&&UC(p.title.angle)&&(v="left"===p.orient?-90:90,f=VO[p.orient]);const b=function(t,e){if(!t||!KC(t))return t;const i={};return Object.keys(t).forEach((n=>{const o=t[n];let r=!1;e.forEach((t=>{(qC(t)&&t===n||t instanceof RegExp&&n.match(t))&&(r=!0)})),r||(i[n]=o)})),i}(p.label,["style","formatMethod","state"]);return{orient:p.orient,select:p.select,hover:p.hover,line:(m=p.domainLine,GO(m),GO(m.startSymbol),GO(m.endSymbol),m),label:Object.assign({style:NO(p.label.style),formatMethod:p.label.formatMethod?(t,e,i)=>p.label.formatMethod(e.rawValue,e):null,state:jO(p.label.state)},b),tick:{visible:p.tick.visible,length:p.tick.tickSize,inside:p.tick.inside,alignWithLabel:p.tick.alignWithLabel,style:NO(p.tick.style),state:jO(p.tick.state),dataFilter:p.tick.dataFilter},subTick:{visible:p.subTick.visible,length:p.subTick.tickSize,inside:p.subTick.inside,count:p.subTick.tickCount,style:NO(p.subTick.style),state:jO(p.subTick.state)},grid:{type:"line",visible:p.grid.visible,alternateColor:p.grid.alternateColor,alignWithLabel:p.grid.alignWithLabel,style:NO(p.grid.style)},subGrid:{type:"line",visible:p.subGrid.visible,alternateColor:p.subGrid.alternateColor,style:NO(p.subGrid.style)},title:{visible:p.title.visible,position:p.title.position,space:p.title.space,autoRotate:!1,angle:v?vw(v):null,textStyle:uw({},f,NO(p.title.style)),padding:p.title.padding,shape:{visible:null===(o=p.title.shape)||void 0===o?void 0:o.visible,space:null===(r=p.title.shape)||void 0===r?void 0:r.space,style:NO(null===(s=p.title.shape)||void 0===s?void 0:s.style)},background:{visible:null===(a=p.title.background)||void 0===a?void 0:a.visible,style:NO(null===(l=p.title.background)||void 0===l?void 0:l.style)},state:{text:jO(p.title.state),shape:jO(null===(h=p.title.shape)||void 0===h?void 0:h.state),background:jO(null===(d=p.title.background)||void 0===d?void 0:d.state)}},panel:{visible:null===(c=p.background)||void 0===c?void 0:c.visible,style:NO(null===(u=p.background)||void 0===u?void 0:u.style),state:jO(null===(g=p.background)||void 0===g?void 0:g.state)}};var m}class ZO{constructor(t,e,i,n){var o,r;this.seqId=0,this.leftRowSeriesNumberColumnCount=0,this.rightRowSeriesNumberColumnCount=0,this.bodyRowSpanCount=1,this._transpose=!1,this._showHeader=!0,this._recordsCount=0,this._hasAggregation=!1,this._hasAggregationOnTopCount=0,this._hasAggregationOnBottomCount=0,this._cellRangeMap=new Map,this._showHeader=i,this._table=t,this._columns=[],this._columnsIncludeHided=[],this._headerCellIds=[],this.hierarchyIndent=null!=n?n:20,this.hierarchyTextStartAlignment=t.options.hierarchyTextStartAlignment,this.columnHierarchyType=t.options.headerHierarchyType,this.columnExpandLevel=null!==(o=t.options.headerExpandLevel)&&void 0!==o?o:1,this.columnTree=new tH(e,{seqId:0},null!==(r=this.columnHierarchyType)&&void 0!==r?r:null,"grid-tree"===this.columnHierarchyType?this.columnExpandLevel:void 0),this._headerObjectsIncludeHided=this._addHeaders(0,e,[]),this._headerObjects=this._headerObjectsIncludeHided.filter((t=>!0!==t.define.hide)),this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this.rowHierarchyType=function(t){if(t._table.options.groupBy)return!0;const{columns:e}=t._table.options;if(ZC(e)&&e.length>0)for(let t=0;t<e.length;t++){const i=e[t];if(!qC(i)&&i.tree)return!0}return!1}(this)?"tree":"grid",this._hasAggregation=function(t){const e=t.columnObjects;for(let t=0;t<e.length;t++){const i=e[t];if(null==i?void 0:i.aggregation)return!0}return!1}(this),this._hasAggregationOnBottomCount=function(t){const e=t.columnObjects;let i=0;for(let t=0;t<e.length;t++){const n=e[t];(null==n?void 0:n.aggregation)&&(Array.isArray(null==n?void 0:n.aggregation)?i=Math.max(i,n.aggregation.filter((t=>!t.showOnTop)).length):n.aggregation.showOnTop||(i=Math.max(i,1)))}return i}(this),this._hasAggregationOnTopCount=function(t){const e=t.columnObjects;let i=0;for(let t=0;t<e.length;t++){const n=e[t];(null==n?void 0:n.aggregation)&&(Array.isArray(null==n?void 0:n.aggregation)?i=Math.max(i,n.aggregation.filter((t=>t.showOnTop)).length):n.aggregation.showOnTop&&(i=Math.max(i,1)))}return i}(this),this.handleRowSeriesNumber(t.internalProps.rowSeriesNumber)}handleRowSeriesNumber(t){var e,i;t&&(Array.isArray(t)?this.rowSeriesNumberColumn=t.map(((t,e)=>{var i,n;return{id:this.seqId++,title:t.title,define:uw({field:"_vtable_rowSeries_number_"+e},t),cellType:null!==(i=t.cellType)&&void 0!==i?i:"text",headerType:"checkbox"===t.cellType?"checkbox":"text",style:t.style,width:t.width,format:t.format,field:null!==(n=t.field)&&void 0!==n?n:"_vtable_rowSeries_number_"+e,icon:t.icon,headerIcon:t.headerIcon,isChildNode:!1}})):this.rowSeriesNumberColumn=[{id:this.seqId++,title:t.title,define:uw({field:"_vtable_rowSeries_number"},t),cellType:null!==(e=t.cellType)&&void 0!==e?e:"text",headerType:"checkbox"===t.cellType?"checkbox":"text",style:t.style,width:t.width,format:t.format,field:null!==(i=t.field)&&void 0!==i?i:"_vtable_rowSeries_number",icon:t.icon,headerIcon:t.headerIcon,isChildNode:!1}],this.leftRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((t=>!0)),this.rightRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((t=>!1)),this.leftRowSeriesNumberColumnCount=this.leftRowSeriesNumberColumn.length,this.rightRowSeriesNumberColumnCount=this.rightRowSeriesNumberColumn.length)}get transpose(){return this._transpose}set transpose(t){this._transpose=t}get showHeader(){return this._showHeader}set showHeader(t){this._showHeader=t}isSeriesNumberInHeader(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return!1;if(e<this.headerLevelCount)return!0}if(this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return!1;if(e<this.headerLevelCount)return!0}return!1}isSeriesNumberInBody(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return!0;if(e>=this.headerLevelCount)return!0}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return!0;if(e>=this.headerLevelCount)return!0}return!1}isSeriesNumber(t,e){if(XC(t)&&XC(e)){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount)return!0;if(this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount)return!0}return!1}getSeriesNumberHeader(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return;if(e<this.headerLevelCount)return Object.assign({},this.leftRowSeriesNumberColumn[t],{style:Object.assign({},this._table.transpose?this._table.internalProps.theme.rowHeaderStyle:this._table.internalProps.theme.headerStyle,this._table.internalProps.rowSeriesNumber.headerStyle)})}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e<this.headerLevelCount){if(this.transpose)return;if(e<this.headerLevelCount)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}getSeriesNumberBody(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return this.leftRowSeriesNumberColumn[t];if(e>=this.headerLevelCount)return this.leftRowSeriesNumberColumn[t]}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)];if(e>=this.headerLevelCount)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}isHeader(t,e){return!!(this.transpose&&t>=this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)||!this.transpose&&e>=0&&e<this.headerLevelCount}isAggregation(t,e){if(this.hasAggregation){if(this.hasAggregationOnBottomCount)if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0;if(this.hasAggregationOnTopCount)if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}return!1}isTopAggregation(t,e){if(this.hasAggregationOnTopCount)if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0;return!1}isBottomAggregation(t,e){if(this.hasAggregationOnBottomCount)if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0;return!1}get hasAggregation(){return this._hasAggregation}get hasAggregationOnTopCount(){return this._hasAggregationOnTopCount}get hasAggregationOnBottomCount(){return this._hasAggregationOnBottomCount}getAggregatorsByCell(t,e){return this.getColumnDefine(t,e).vtable_aggregator}getAggregatorsByCellRange(t,e,i,n){let o=[];if(!this.transpose){for(let n=t;n<=i;n++){const t=this.getColumnDefine(n,e);t.vtable_aggregator&&(o=o.concat(Array.isArray(t.vtable_aggregator)?t.vtable_aggregator:[t.vtable_aggregator]))}return o}for(let i=e;i<=n;i++){const e=this.getColumnDefine(t,i);e.vtable_aggregator&&(o=o.concat(Array.isArray(e.vtable_aggregator)?e.vtable_aggregator:[e.vtable_aggregator]))}return[]}getAggregatorOnTop(t,e){const i=this.getColumnDefine(t,e),n=i.vtable_aggregator,o=i.aggregation;if(Array.isArray(o)){const i=o.reduce(((t,e,i)=>(e.showOnTop&&t.push(i),t)),[]).map((t=>n[t]));return this.transpose?i[t-this.rowHeaderLevelCount]:i[e-this.columnHeaderLevelCount]}return this.transpose&&t-this.rowHeaderLevelCount==0?(null==o?void 0:o.showOnTop)?n:null:this.transpose||e-this.columnHeaderLevelCount!=0?null:(null==o?void 0:o.showOnTop)?n:null}getAggregatorOnBottom(t,e){const i=this.getColumnDefine(t,e),n=i.vtable_aggregator,o=i.aggregation;if(Array.isArray(o)){const i=o.reduce(((t,e,i)=>(e.showOnTop||t.push(i),t)),[]).map((t=>n[t]));return this.transpose?i[t-(this.colCount-this.hasAggregationOnBottomCount)]:i[e-(this.rowCount-this.hasAggregationOnBottomCount)]}return this.transpose&&t-(this.colCount-this.hasAggregationOnBottomCount)==0?(null==o?void 0:o.showOnTop)?null:n:this.transpose||e-(this.rowCount-this.hasAggregationOnBottomCount)!=0||(null==o?void 0:o.showOnTop)?null:n}getAggregatorCellAddress(t,e,i,n){const o=[],r=this.hasAggregationOnTopCount,s=this.hasAggregationOnBottomCount;if(this.transpose){for(let i=e;i<=n;i++)if(this.getColumnDefine(t,i).vtable_aggregator){for(let t=0;t<r;t++)o.push({col:this.headerLevelCount+t,row:i});for(let t=0;t<s;t++)o.push({col:this.rowCount-s+t,row:i})}}else for(let n=t;n<=i;n++)if(this.getColumnDefine(n,e).vtable_aggregator){for(let t=0;t<r;t++)o.push({col:n,row:this.headerLevelCount+t});for(let t=0;t<s;t++)o.push({col:n,row:this.rowCount-s+t})}return o}getCellLocation(t,e){return this.isHeader(t,e)?this.transpose?"rowHeader":"columnHeader":"body"}isRowHeader(t,e){return!!(this.transpose&&t>=this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)}isColumnHeader(t,e){return!this.transpose&&e>=0&&e<=this.headerLevelCount-1&&t>=this.leftRowSeriesNumberColumnCount&&t<this.colCount-this.rightRowSeriesNumberColumnCount}isFrozenColumn(t,e){if(XC(e)){if(t>=0&&t<this.frozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&t>=0&&t<this.frozenColCount)return!0;return!1}isRightFrozenColumn(t,e){if(XC(e)){if(t>=this.colCount-this.rightFrozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&t>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(t,e){if(XC(e)){if(e>=0&&e<this.frozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.frozenRowCount>0&&e>=0&&e<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(t,e){if(XC(e)){if(e>=this.rowCount-this.bottomFrozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.bottomFrozenRowCount>0&&e>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftTopCorner(t,e){return t>=0&&t<this.frozenColCount&&e>=0&&e<this.frozenRowCount}isLeftBottomCorner(t,e){return t>=0&&t<this.frozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=0&&e<this.frozenRowCount}isRightBottomCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isCornerHeader(t,e){return!1}getColumnHeaderRange(){var t,e;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:(null!==(t=this.rowCount)&&void 0!==t?t:0)-1}}:{start:{col:0,row:0},end:{col:(null!==(e=this.colCount)&&void 0!==e?e:0)-1,row:this._headerCellIds.length-1}}}getRowHeaderRange(){var t,e;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:(null!==(t=this.rowCount)&&void 0!==t?t:0)-1}}:{start:{col:0,row:0},end:{col:(null!==(e=this.colCount)&&void 0!==e?e:0)-1,row:this._headerCellIds.length-1}}}getCornerHeaderRange(){}getBodyRange(){var t,e,i,n;return this.transpose?{start:{col:this.headerLevelCount,row:0},end:{col:(null!==(t=this.colCount)&&void 0!==t?t:0)-1,row:(null!==(e=this.rowCount)&&void 0!==e?e:0)-1}}:{start:{col:0,row:this.headerLevelCount},end:{col:(null!==(i=this.colCount)&&void 0!==i?i:0)-1,row:(null!==(n=this.rowCount)&&void 0!==n?n:0)-1}}}get headerLevelCount(){return this.showHeader?this._headerCellIds.length:0}get columnHeaderLevelCount(){return this.transpose?0:this.headerLevelCount}get rowHeaderLevelCount(){return this.transpose?this.headerLevelCount:0}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get bottomFrozenRowCount(){return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0}get rightFrozenColCount(){return this._table.internalProps.rightFrozenColCount?this.colCount-this.frozenColCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:Math.max(0,this.colCount-this.frozenColCount):0}get colCount(){return this.transpose?this.headerLevelCount+this.recordsCount+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount:this._columns.length+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount}get rowCount(){return this.transpose?this._columns.length:this.headerLevelCount+this.recordsCount}get bodyRowCount(){return this.transpose?this._columns.length:this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.transpose?this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount:this._columns.length}get recordsCount(){return this._recordsCount}set recordsCount(t){this._recordsCount=t}get headerObjects(){return this._headerObjects}get columnObjects(){return this._columns}get headerObjectsIncludeHided(){return this._headerObjectsIncludeHided}get columnWidths(){if(this.leftRowSeriesNumberColumnCount){const t=this.leftRowSeriesNumberColumn.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})));return t.push(...this._columns.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})))),t}return this._columns.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})))}getColumnWidthDefined(t){var e;if(t>=0){if(t<this.leftRowSeriesNumberColumnCount)return this.leftRowSeriesNumberColumn[t];if(this.transpose){let i,n,o=0;if(t>=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount){let t;return this.columnObjects.forEach(((e,r)=>{"number"==typeof e.width?o=Math.max(e.width,o):"auto"===e.width&&(t=!0),"number"==typeof e.minWidth&&(n=Math.max(e.minWidth,n)),"number"==typeof e.maxWidth&&(i=Math.max(e.maxWidth,i))})),o=o>0?o:t?"auto":void 0,{width:o,minWidth:n,maxWidth:i}}if(this.isRowHeader(t,0)){const i=Array.isArray(this._table.defaultHeaderColWidth)?null!==(e=this._table.defaultHeaderColWidth[t])&&void 0!==e?e:this._table.defaultColWidth:this._table.defaultHeaderColWidth;return"auto"===i?{width:"auto"}:{width:i}}}return this._columns[t-this.leftRowSeriesNumberColumnCount]}}getCellId(t,e){var i,n,o,r;return this.transpose?t>=this.headerLevelCount+this.leftRowSeriesNumberColumnCount?null===(i=this._columns[e])||void 0===i?void 0:i.id:this.isSeriesNumber(t,e)?e+"_series_number":null===(n=this._headerCellIds[t-this.leftRowSeriesNumberColumnCount])||void 0===n?void 0:n[e]:this.isSeriesNumber(t,e)?this.rowSeriesNumberColumn[t].id:this.headerLevelCount<=e?null===(o=this._columns[t-this.leftRowSeriesNumberColumnCount])||void 0===o?void 0:o.id:null===(r=this._headerCellIds[e])||void 0===r?void 0:r[t-this.leftRowSeriesNumberColumnCount]}getHeader(t,e){if(this.isSeriesNumberInHeader(t,e))return this.getSeriesNumberHeader(t,e);const i=this.getCellId(t,e);return this._headerObjectMap[i]}getHeaderField(t,e){var i,n,o;if(this.isSeriesNumberInHeader(t,e))return null===(i=this.getSeriesNumberHeader(t,e))||void 0===i?void 0:i.field;if(this.isSeriesNumberInBody(t,e))return null===(n=this.getSeriesNumberBody(t,e))||void 0===n?void 0:n.field;const r=this.getCellId(t,e);return(null===(o=this._headerObjectMap[r])||void 0===o?void 0:o.field)||(this.transpose?this._columns[e]&&this._columns[e].field:this._columns[t-this.leftRowSeriesNumberColumnCount]&&this._columns[t-this.leftRowSeriesNumberColumnCount].field)}getHeaderCellAdressById(t){for(let e=0;e<this._headerCellIds.length;e++){const i=this._headerCellIds[e];for(let n=0;n<i.length;n++)if(i[n]===t)return this.transpose?{col:e,row:n}:{col:n+this.leftRowSeriesNumberColumnCount,row:e}}}getHeaderCellAddressByField(t){const e=this.headerObjects.find((e=>e&&e.field===t));return e&&this.getHeaderCellAdressById(e.id)}getBody(t,e){return this.isSeriesNumber(t,e)?this.getSeriesNumberBody(t,e):this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]}getBodyLayoutRangeById(t){var e,i;if(this.transpose){for(let i=0;i<(null!==(e=this.rowCount)&&void 0!==e?e:0);i++)if(t===this._columns[i].id)return{start:{col:0,row:i},end:{col:0,row:i}}}else for(let e=this.leftRowSeriesNumberColumnCount;e<(null!==(i=this.colCount)&&void 0!==i?i:0);e++)if(t===this._columns[e-this.leftRowSeriesNumberColumnCount].id)return{start:{col:e,row:0},end:{col:e,row:0}};return{start:{col:-1,row:-1},end:{col:-1,row:-1}}}getCellRange(t,e){return function(t,e,i){var n,o,r;if(-1===t||-1===e)return{start:{col:t,row:e},end:{col:t,row:e}};if(i._cellRangeMap.has(`$${t}$${e}`))return i._cellRangeMap.get(`$${t}$${e}`);let s={start:{col:t,row:e},end:{col:t,row:e}};if(i.transpose)s=function(t,e,i){var n,o,r,s;const a={start:{col:t,row:e},end:{col:t,row:e}};if(i.headerLevelCount+i.leftRowSeriesNumberColumnCount<=t||-1===t&&-1===e){if(i.headerLevelCount+i.leftRowSeriesNumberColumnCount<=t&&(null===(o=null===(n=i.columnObjects[e])||void 0===n?void 0:n.define)||void 0===o?void 0:o.mergeCell)){const n=i._table.getCellValue(t,e);for(let o=t-1;o>=i.headerLevelCount+i.leftRowSeriesNumberColumnCount;o--){const r=i._table.getCellValue(o,e);if("boolean"==typeof i.columnObjects[e].define.mergeCell){if(n!==r)break}else if(!i.columnObjects[e].define.mergeCell(n,r,{source:{col:t,row:e},target:{col:o,row:e},table:i._table}))break;a.start.col=o}for(let o=t+1;o<(null!==(r=i.colCount)&&void 0!==r?r:0);o++){const r=i._table.getCellValue(o,e);if("boolean"==typeof i.columnObjects[e].define.mergeCell){if(n!==r)break}else if(!i.columnObjects[e].define.mergeCell(n,r,{source:{col:t,row:e},target:{col:o,row:e},table:i._table}))break;a.end.col=o}}return a}const l=i.getCellId(t,e);for(let n=e-1;n>=0&&l===i.getCellId(t,n);n--)a.start.row=n;for(let n=e+1;n<(null!==(s=i.rowCount)&&void 0!==s?s:0)&&l===i.getCellId(t,n);n++)a.end.row=n;for(let n=t-1;n>=0&&l===i.getCellId(n,e);n--)a.start.col=n;for(let n=t+1;n<i.headerLevelCount+i.leftRowSeriesNumberColumnCount&&l===i.getCellId(n,e);n++)a.end.col=n;return a}(t,e,i);else if(i.headerLevelCount<=e){if(i.headerLevelCount<=e&&(null===(o=null===(n=i.columnObjects[t-i.leftRowSeriesNumberColumnCount])||void 0===n?void 0:n.define)||void 0===o?void 0:o.mergeCell)){const n=i._table.getCellValue(t,e);for(let o=e-1;o>=i.headerLevelCount;o--){const r=i._table.getCellValue(t,o);if("boolean"==typeof i.columnObjects[t-i.leftRowSeriesNumberColumnCount].define.mergeCell){if(n!==r)break}else if(!i.columnObjects[t-i.leftRowSeriesNumberColumnCount].define.mergeCell(n,r,{source:{col:t,row:e},target:{col:t,row:o},table:i._table}))break;s.start.row=o}for(let o=e+1;o<i.rowCount;o++){const r=i._table.getCellValue(t,o);if("boolean"==typeof i.columnObjects[t-i.leftRowSeriesNumberColumnCount].define.mergeCell){if(n!==r)break}else if(!i.columnObjects[t-i.leftRowSeriesNumberColumnCount].define.mergeCell(n,r,{source:{col:t,row:e},target:{col:t,row:o},table:i._table}))break;s.end.row=o}}!function(t,e,i,n){var o;if("tree"!==n.rowHierarchyType)return;const r=n._table.getCellRawRecord(t,e);(null===(o=n._table.internalProps.rowSeriesNumber)||void 0===o?void 0:o.enableTreeCheckbox)?(null==r?void 0:r.vtableMerge)&&t>=n.leftRowSeriesNumberColumnCount&&(i.start.col=n.rowHeaderLevelCount+n.leftRowSeriesNumberColumnCount,i.end.col=n.colCount-1,i.start.row=i.end.row=e):(null==r?void 0:r.vtableMerge)&&(i.start.col=n.rowHeaderLevelCount,i.end.col=n.colCount-1,i.start.row=i.end.row=e)}(t,e,s,i)}else{const n=i.getCellId(t,e);for(let o=t-1;o>=0&&n===i.getCellId(o,e);o--)s.start.col=o;for(let o=t+1;o<(null!==(r=i.colCount)&&void 0!==r?r:0)&&n===i.getCellId(o,e);o++)s.end.col=o;for(let o=e-1;o>=0&&n===i.getCellId(t,o);o--)s.start.row=o;for(let o=e+1;o<i.headerLevelCount&&n===i.getCellId(t,o);o++)s.end.row=o}return i._cellRangeMap.set(`$${t}$${e}`,s),s}(t,e,this)}isCellRangeEqual(t,e,i,n){const o=this.getCellRange(t,e),r=this.getCellRange(i,n);return o.start.col===r.start.col&&o.end.col===r.end.col&&o.start.row===r.start.row&&o.end.row===r.end.row}getRecordShowIndexByCell(t,e){const i=this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount;return this.transpose?t<i?-1:t-i:e<i?-1:e-i}getRecordStartRowByRecordIndex(t){return(this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount)+t}_addHeaders(t,e,i,n){const o=[],r=this._newRow(t,n);return e.forEach((e=>{var s,a,l,h;const d=this._columns.length,c=this.seqId++,u={id:c,title:null!==(s=e.title)&&void 0!==s?s:e.caption,headerIcon:e.headerIcon,field:e.field,style:e.headerStyle,headerType:null!==(a=e.headerType)&&void 0!==a?a:"text",dropDownMenu:e.dropDownMenu,define:e,hierarchyState:e.hierarchyState,columnWidthComputeMode:e.columnWidthComputeMode};o[c]=u;for(let e=t-1;e>=0;e--)this._headerCellIds[e]&&(this._headerCellIds[e][d]=i[e]);n?this._headerCellIds[t-1]&&(r[d]=this._headerCellIds[t-1][d]):r[d]=c;const g=!e.hierarchyState||e.hierarchyState===Kw.expand;if(e.columns&&g)!e.columns.every((t=>t.hide))&&this._addHeaders(t+1,e.columns,[...i,c],e.hideColumnsSubHeader||n).forEach((t=>o.push(t)));else{const i={id:this.seqId++,field:e.field,fieldFormat:e.fieldFormat,width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth,icon:e.icon,cellType:null!==(h=null!==(l=e.cellType)&&void 0!==l?l:e.columnType)&&void 0!==h?h:"text",chartModule:"chartModule"in e?e.chartModule:null,chartSpec:"chartSpec"in e?e.chartSpec:null,sparklineSpec:"sparklineSpec"in e?e.sparklineSpec:H_,style:e.style,define:e,columnWidthComputeMode:e.columnWidthComputeMode,disableColumnResize:null==e?void 0:e.disableColumnResize,aggregation:e.aggregation,isChildNode:t>=1};if(this._columnsIncludeHided.push(i),!0!==e.hide){this._columns.push(i);for(let e=t+1;e<this._headerCellIds.length;e++)this._headerCellIds[e][d]=c}}})),o}_newRow(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._headerCellIds[t]){const e=this._headerCellIds[t-1];if(e.length>this._headerCellIds[t].length)for(let i=this._headerCellIds[t].length;i<e.length;i++)this._headerCellIds[t][i]=e[i];return this._headerCellIds[t]}if(e)return[];const i=this._headerCellIds[t]=[];if(!this._columns.length)return i;const n=this._headerCellIds[t-1];for(let t=0;t<n.length;t++)i[t]=n[t];return i}getCellHeaderPaths(t,e){if(this.isSeriesNumber(t,e))return;let i=[],n=[];return this.transpose?n=[{field:this._columns[e].field}]:i=[{field:this._columns[t-this.leftRowSeriesNumberColumnCount].field}],{colHeaderPaths:i,rowHeaderPaths:n,cellLocation:this.getCellLocation(t,e)}}getParentCellId(t,e){if(0!==e){if(this.isColumnHeader(t,e))return this.getCellId(t,e-1);if(this.isRowHeader(t,e)){if(this.isSeriesNumberInBody(t-1,e))return;return this.getCellId(t-1,e)}}}canMoveHeaderPosition(t,e){if(this.isSeriesNumberInHeader(e.col,e.row)||this.isSeriesNumberInHeader(t.col,t.row))return!1;if(!this.transpose&&this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)){const i=this.getRecordShowIndexByCell(0,t.row),n=this.getRecordShowIndexByCell(0,e.row);return this._table.dataSource.canChangeOrder(i,n)}if(this.transpose&&this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)&&(this.getBody(t.col+this.leftRowSeriesNumberColumnCount,t.row).isChildNode&&this.getBody(e.col+this.leftRowSeriesNumberColumnCount,e.row).isChildNode?(t.col=t.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1,e.col=e.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1):(t.col=t.col+this.leftRowSeriesNumberColumnCount,e.col=e.col+this.leftRowSeriesNumberColumnCount)),t.col<0||t.row<0||e.col<0||e.row<0)return!1;if("disabled"===this._table.internalProps.frozenColDragHeaderMode&&this._table.isFrozenColumn(e.col))return!1;const i=this.getCellRange(t.col,t.row);return this.isColumnHeader(t.col,t.row)?this.getParentCellId(t.col,i.start.row)===this.getParentCellId(e.col,i.start.row):!!this.isRowHeader(t.col,t.row)&&this.getParentCellId(i.start.col,t.row)===this.getParentCellId(i.start.col,e.row)}moveHeaderPosition(t,e){var i,n;if((!(null===(i=this._table.options.dragOrder)||void 0===i?void 0:i.validateDragOrderOnEnd)||(null===(n=this._table.options.dragOrder)||void 0===n?void 0:n.validateDragOrderOnEnd(t,e)))&&this.canMoveHeaderPosition(t,e)){let i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){const n=i.end.col-i.start.col+1;let o;const r=this.getCellRange(e.col,i.start.row);if(o=e.col>=t.col?r.end.col-n+1:r.start.col,o===i.start.col)return null;for(let t=0;t<this._headerCellIds.length;t++){const e=this._headerCellIds[t].splice(i.start.col-this.leftRowSeriesNumberColumnCount,n);e.unshift(o-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._headerCellIds[t],e)}const s=this._columns.splice(i.start.col-this.leftRowSeriesNumberColumnCount,n);return s.unshift(o-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columns,s),this.columnTree.movePosition(i.start.row,i.start.col-this.leftRowSeriesNumberColumnCount,o-this.leftRowSeriesNumberColumnCount),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:i.start.col,targetIndex:o,sourceSize:n,targetSize:r.end.col-r.start.col+1,moveType:"column"}}if(this.isRowHeader(t.col,t.row)||this.isSeriesNumberInBody(t.col,t.row)&&this.transpose){this.isSeriesNumberInBody(t.col,t.row)&&(i=this.getCellRange(t.col+this.leftRowSeriesNumberColumnCount,t.row));const n=i.end.row-i.start.row+1;let o;const r=this.getCellRange(i.start.col,e.row);if(o=e.row>=t.row?r.end.row-n+1:r.start.row,o===i.start.row)return null;for(let t=0;t<this._headerCellIds.length;t++){const e=this._headerCellIds[t].splice(i.start.row,n);e.unshift(o,0),Array.prototype.splice.apply(this._headerCellIds[t],e)}const s=this._columns.splice(i.start.row,n);return s.unshift(o,0),Array.prototype.splice.apply(this._columns,s),this.columnTree.movePosition(i.start.col-this.leftRowSeriesNumberColumnCount,i.start.row,o+(e.row>t.row?i.end.row-i.start.row:0)),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:i.start.row,targetIndex:o,sourceSize:n,targetSize:r.end.row-r.start.row+1,moveType:"row"}}if(this.isSeriesNumberInBody(t.col,t.row))return{sourceIndex:t.row,targetIndex:e.row,sourceSize:1,targetSize:1,moveType:"row"}}return null}toggleHierarchyState(t){return{addCellPositions:t.add.map((t=>({col:0,row:this._table.columnHeaderLevelCount+t}))),removeCellPositions:t.remove.map((t=>({col:0,row:this._table.columnHeaderLevelCount+t})))}}setChartInstance(t,e,i){const n=this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount];"function"!=typeof n.chartSpec&&(n.chartInstance=i)}getChartInstance(t,e){return(this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]).chartInstance}checkHasChart(){return function(t){let e=!1;for(let i=0;i<t.columnObjects.length;i++)if(t.columnObjects[i].chartSpec){e=!0;break}return e}(this)}getAxisConfigInPivotChart(t,e){}isEmpty(t,e){return!1}isAxisCell(t,e){return!1}getChartAxes(t,e){return[]}isShareChartSpec(t,e){const i=this.getBody(t,e);return"function"!=typeof(null==i?void 0:i.chartSpec)}isNoChartDataRenderNothing(t,e){const i=this.getBody(t,e);return(null==i?void 0:i.define).noDataRenderNothing}getChartSpec(t,e){return this.getRawChartSpec(t,e)}getRawChartSpec(t,e){const i=this.getBody(t,e),n=null==i?void 0:i.chartSpec;return"function"==typeof n?n({col:t,row:e,dataValue:this._table.getCellOriginValue(t,e)||"",value:this._table.getCellValue(t,e)||"",rect:this._table.getCellRangeRelativeRect(this._table.getCellRange(t,e)),table:this._table}):n}getChartDataId(t,e){return function(t,e,i){var n;const o=i.getRawChartSpec(t,e);if(null==o?void 0:o.series){const t={};return(null===(n=o.data)||void 0===n?void 0:n.id)&&(t[o.data.id]=void 0),null==o||o.series.forEach((e=>{var i,n,r,s,a,l,h,d,c,u,g;if(!(null===(i=e.data)||void 0===i?void 0:i.fromDataId))if(null===(n=e.data)||void 0===n?void 0:n.transforms)t[null!==(g=null!==(c=null===(d=e.data)||void 0===d?void 0:d.id)&&void 0!==c?c:null===(u=o.data)||void 0===u?void 0:u.id)&&void 0!==g?g:"data"]=void 0;else{const i="horizontal"===e.direction?e.xField:e.yField;t[null!==(l=null!==(s=null===(r=e.data)||void 0===r?void 0:r.id)&&void 0!==s?s:null===(a=o.data)||void 0===a?void 0:a.id)&&void 0!==l?l:"data"]=(null===(h=e.data)||void 0===h?void 0:h.id)?i:void 0}})),t}return o.data.id}(t,e,this)}release(){const t=this._table._getActiveChartInstance();null==t||t.release(),this.columnObjects.forEach((t=>{var e;null===(e=t.chartInstance)||void 0===e||e.release()}))}clearCellRangeMap(){this._cellRangeMap.clear()}updateColumnTitle(t,e,i){const n=this._table.internalProps.layoutMap.getHeader(t,e);n.title=i,n.define.title=i}getColumnByField(t){var e;return null===(e=this.columnObjects)||void 0===e?void 0:e.reduce(((e,i,n)=>(i.field===t&&e.push({col:n,columnDefine:i}),e)),[])}getColumnByKey(t){var e;let i;return{columnDefine:null===(e=this.columnObjects)||void 0===e?void 0:e.find(((e,n)=>{var o;return(null===(o=e.define)||void 0===o?void 0:o.key)===t&&(i=n+this.leftRowSeriesNumberColumnCount,!0)})),col:i}}getColumnDefine(t,e){if(t>=0)return t<this.leftRowSeriesNumberColumnCount?this.leftRowSeriesNumberColumn[t].define:this.transpose?this._columns[e].define:this._columns[t-this.leftRowSeriesNumberColumnCount].define}}class JO{constructor(t){this.isValidatingValue=!1,this.listenersId=[],this.table=t,this.bindEvent()}bindEvent(){const t=this.table,e=t.on(v_.DBLCLICK_CELL,(e=>{var i,n,o;const{editCellTrigger:r="doubleclick"}=t.options;if(!r.includes("doubleclick"))return;const{col:s,row:a}=e,l=OT(e.federatedEvent),h=t.scenegraph.getResizeColAt(l.abstractPos.x,l.abstractPos.y,null===(i=l.eventArgs)||void 0===i?void 0:i.targetCell);t._canResizeColumn(h.col,h.row)&&h.col>=0||(null===(o=null===(n=e.target)||void 0===n?void 0:n.attribute)||void 0===o?void 0:o.funcType)||(this.beginTriggerEditCellMode="doubleclick",this.startEditCell(s,a))})),i=t.on(v_.CLICK_CELL,(e=>{var i,n;const{editCellTrigger:o="doubleclick"}=t.options;if("click"===o||Array.isArray(o)&&o.includes("click")){if(null===(n=null===(i=e.target)||void 0===i?void 0:i.attribute)||void 0===n?void 0:n.funcType)return;this.beginTriggerEditCellMode="click";const{col:t,row:o}=e;this.startEditCell(t,o)}}));this.listenersId.push(e,i)}startEditCell(t,e,i){var n,o,r,s,a;if(this.editingEditor)return;const l=this.table.getEditor(t,e);if(l){if(null===(o=null===(n=this.table.internalProps.layoutMap)||void 0===n?void 0:n.isAggregation)||void 0===o?void 0:o.call(n,t,e))return;const h=this.table.getCellRawRecord(t,e);if(null==h?void 0:h.vtableMerge)return;this.editingEditor||(this.editCell={col:t,row:e}),this.table._makeVisibleCell(t,e),this.editingEditor=l;const d=XC(i)?i:this.table.getCellOriginValue(t,e),c=this.table.getCellRangeRelativeRect(this.table.getCellRange(t,e)),u={rect:{left:c.left,top:c.top,width:c.width,height:c.height}};t===this.table.colCount-1?u.rect.width=c.width-1:u.rect.width=c.width+1,e===this.table.rowCount-1?u.rect.height=c.height-1:u.rect.height=c.height+1,l.beginEditing,null===(r=l.beginEditing)||void 0===r||r.call(l,this.table.getElement(),u,d),l.bindSuccessCallback,null===(s=l.bindSuccessCallback)||void 0===s||s.call(l,(()=>{this.completeEdit()})),null===(a=l.onStart)||void 0===a||a.call(l,{value:d,endEdit:()=>{this.completeEdit()},referencePosition:u,container:this.table.getElement(),col:t,row:e,table:this.table})}}completeEdit(t){var e,i;if(!this.editingEditor)return!0;if(this.isValidatingValue)return!1;const n=null==t?void 0:t.target,{editingEditor:o}=this;if(n)if(o.targetIsOnEditor){if(o.targetIsOnEditor(n))return!1}else if(!o.isEditorElement||o.isEditorElement(n))return!1;if(this.editingEditor.getValue,this.editingEditor.validateValue){this.isValidatingValue=!0;const t=this.editingEditor.getValue(),n=this.table.getCellOriginValue(this.editCell.col,this.editCell.row),o=null===(i=(e=this.editingEditor).validateValue)||void 0===i?void 0:i.call(e,t,n,this.editCell,this.table);return o_(o)?(this.isValidatingValue=!0,new Promise(((t,e)=>{o.then((e=>{QO(e,this,n,t)})).catch((t=>{this.isValidatingValue=!1,e(t)}))}))):QO(o,this,n)}return this.doExit(),!0}doExit(){var t,e,i,n,o,r;const s=null===(e=(t=this.editingEditor).getValue)||void 0===e?void 0:e.call(t),a=this.table.getCellRange(this.editCell.col,this.editCell.row),l=[];for(let t=a.start.row;t<=a.end.row;t++){const t=[];for(let e=a.start.col;e<=a.end.col;e++)t.push(s);l.push(t)}this.table.changeCellValues(a.start.col,a.start.row,l),this.editingEditor.exit,null===(n=(i=this.editingEditor).exit)||void 0===n||n.call(i),null===(r=(o=this.editingEditor).onEnd)||void 0===r||r.call(o),this.editingEditor=null,this.isValidatingValue=!1,this.beginTriggerEditCellMode=null}cancelEdit(){var t,e,i,n;this.editingEditor&&(null===(e=(t=this.editingEditor).exit)||void 0===e||e.call(t),null===(n=(i=this.editingEditor).onEnd)||void 0===n||n.call(i),this.editingEditor=null)}release(){this.listenersId.forEach((t=>{this.table.off(t)}))}}function QO(t,e,i,n){return e.isValidatingValue=!1,"validate-exit"===t?(e.doExit(),null==n||n(!0),!0):"invalidate-exit"===t?(e.editingEditor.setValue(i),e.doExit(),null==n||n(!0),!0):"validate-not-exit"===t||"invalidate-not-exit"===t?(null==n||n(!1),!1):!0===t?(e.doExit(),null==n||n(!0),!0):(null==n||n(!1),!1)}function tI(t){return qC(t)?{groupByRules:[t]}:ZC(t)?{groupByRules:t.map((t=>qC(t)?t:t.key))}:{}}function eI(t,e,i,n){if("group"===n)return n;if("sort"===n&&!i.options.groupBy)return n;let o="normal";return i.options.groupBy?o="group":!i.isHeader(t,e)&&i.dataSource.lastOrderField&&i.getBodyField(t,e)===i.dataSource.lastOrderField&&(o="sort"),o}function iI(t){let e=t.sortState;e=!e||Array.isArray(e)?e:[e],e&&(e=e.map((e=>{var i;return e.orderFn=null!==(i=t._getSortFuncFromHeaderOption(void 0,e.field))&&void 0!==i?i:Gx,e})),t.dataSource.sort(e))}class nI extends EH{constructor(t,e){var i,n,o,r,s,a,l,h;super(t,e),this.showHeader=!0,e=this.options;const d=this.internalProps;if(d.frozenColDragHeaderMode=null!==(n=null===(i=e.dragOrder)||void 0===i?void 0:i.frozenColDragHeaderMode)&&void 0!==n?n:e.frozenColDragHeaderMode,this.pagination=e.pagination,d.sortState=e.sortState,d.multipleSort=!!e.multipleSort,d.dataConfig=e.groupBy?tI(e.groupBy):{},d.columns=e.columns?DO(e.columns,["children"]):e.header?DO(e.header,["children"]):[],MT(this),d.enableTreeNodeMerge=null!==(r=null!==(o=e.enableTreeNodeMerge)&&void 0!==o?o:XC(e.groupBy))&&void 0!==r&&r,this.internalProps.headerHelper.setTableColumnsEditor(),this.showHeader=null===(s=e.showHeader)||void 0===s||s,this.internalProps.columnWidthConfig=e.columnWidthConfig,this.transpose=null!==(a=e.transpose)&&void 0!==a&&a,"node"!==kx.mode&&(this.editorManager=new JO(this)),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,e.dataSource?this.dataSource=e.dataSource:e.records?this.setRecords(e.records,{sortState:d.sortState}):this.setRecords([]),e.title){const t=J_.getComponent("title");d.title=new t(e.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)null===(l=this.internalProps.emptyTip)||void 0===l||l.resetVisible();else{const t=J_.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),null===(h=this.internalProps.emptyTip)||void 0===h||h.resetVisible()}if(e.enableTreeStickCell){const t=J_.getComponent("listTreeStickCellPlugin");this.listTreeStickCellPlugin=new t(this)}setTimeout((()=>{this.fireListeners(v_.INITIALIZED,null)}),0)}isListTable(){return!0}isPivotTable(){return!1}isPivotChart(){return!1}get sortState(){return this.internalProps.sortState}get records(){var t;return null===(t=this.dataSource)||void 0===t?void 0:t.records}get recordsCount(){return this.dataSource.records.length}updateColumns(t){var e,i,n,o;this.scenegraph.clearCells();const r={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.columns=DO(t,["children"]),MT(this),this.options.columns=t,this.internalProps.headerHelper.setTableColumnsEditor(),this._hasAutoImageColumn=void 0,this.refreshHeader(),null===(i=(e=this.dataSource).updateColumns)||void 0===i||i.call(e,this.internalProps.columns),this.records&&function(t){for(let e=0;e<t.length;e++)if(t[e].aggregation)return!0;return!1}(t)&&this.dataSource.processRecords(null!==(o=null===(n=this.dataSource.dataSourceObj)||void 0===n?void 0:n.records)&&void 0!==o?o:this.dataSource.dataSourceObj),this.internalProps.useOneRowHeightFillAll=!1,this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(r.col,r.row),this.renderAsync(),this.eventManager.updateEventBinder()}addColumn(t){const e=this.options.columns;e.push(t),this.updateColumns(e)}get columns(){return this.internalProps.layoutMap.columnTree.getCopiedTree()}get header(){return this.internalProps.columns}set header(t){this.internalProps.columns=t,MT(this),this.options.header=t,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.renderAsync()}get transpose(){var t;return null!==(t=this.internalProps.transpose)&&void 0!==t&&t}set transpose(t){this.internalProps.transpose!==t&&(this.internalProps.transpose=t,this.internalProps.layoutMap&&(this.internalProps.layoutMap.transpose=t,this.refreshRowColCount(),this._resetFrozenColCount(),this.renderAsync()))}getCellValue(t,e,i){if(-1===t||-1===e)return null;if(!i){const i=this.getCustomMergeValue(t,e);if(i)return i}const n=this;if(n.internalProps.layoutMap.isSeriesNumber(t,e)){if(n.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:i}=n.internalProps.layoutMap.getSeriesNumberHeader(t,e);return i}let i;if(this.options.groupBy){const o=n.getCellRawRecord(t,e);if(null==o?void 0:o.vtableMerge)return"";n.internalProps.layoutMap.isAggregation(t,e)||(i=this.dataSource.getGroupSeriesNumber(e-this.columnHeaderLevelCount))}else i=e-this.columnHeaderLevelCount+1;const{format:o}=n.internalProps.layoutMap.getSeriesNumberBody(t,e);return"function"==typeof o?o(t,e,this,i):i}if(n.internalProps.layoutMap.isHeader(t,e)){const{title:i}=n.internalProps.layoutMap.getHeader(t,e);return"function"==typeof i?i():i}if(n.internalProps.layoutMap.isAggregation(t,e)){if(n.internalProps.layoutMap.isTopAggregation(t,e)){const i=n.internalProps.layoutMap.getAggregatorOnTop(t,e);return(null==i?void 0:i.formatValue)?i.formatValue(t,e,this):""}if(n.internalProps.layoutMap.isBottomAggregation(t,e)){const i=n.internalProps.layoutMap.getAggregatorOnBottom(t,e);return(null==i?void 0:i.formatValue)?i.formatValue(t,e,this):""}}const{field:o,fieldFormat:r}=n.internalProps.layoutMap.getBody(t,e);return n.getFieldData(r||o,t,e)}getCellOriginValue(t,e){if(-1===t||-1===e)return null;const i=this;if(i.internalProps.layoutMap.isSeriesNumber(t,e)){if(i.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:n}=i.internalProps.layoutMap.getSeriesNumberHeader(t,e);return n}const{format:n}=i.internalProps.layoutMap.getSeriesNumberBody(t,e);return"function"==typeof n?n(t,e,this):e-this.columnHeaderLevelCount}if(i.internalProps.layoutMap.isHeader(t,e)){const{title:n}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof n?n():n}if(i.internalProps.layoutMap.isAggregation(t,e)){if(i.internalProps.layoutMap.isTopAggregation(t,e)){const n=i.internalProps.layoutMap.getAggregatorOnTop(t,e);return null==n?void 0:n.value()}if(i.internalProps.layoutMap.isBottomAggregation(t,e)){const n=i.internalProps.layoutMap.getAggregatorOnBottom(t,e);return null==n?void 0:n.value()}}const{field:n}=i.internalProps.layoutMap.getBody(t,e);return i.getFieldData(n,t,e)}getCellRawValue(t,e){if(-1===t||-1===e)return null;const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){const{title:n}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof n?n():n}const{field:n}=i.internalProps.layoutMap.getBody(t,e);return i.getRawFieldData(n,t,e)}getRecordShowIndexByCell(t,e){const{layoutMap:i}=this.internalProps;return i.getRecordShowIndexByCell(t,e)}getRecordIndexByCell(t,e){const{layoutMap:i}=this.internalProps,n=i.getRecordShowIndexByCell(t,e);return this.dataSource.getRecordIndexPaths(n)}getTableIndexByRecordIndex(t){return this.transpose?this.dataSource.getTableIndex(t)+this.rowHeaderLevelCount:this.dataSource.getTableIndex(t)+this.columnHeaderLevelCount}getTableIndexByField(t){const e=this.internalProps.layoutMap.columnObjects.find((e=>e.field===t));if(!e)return-1;const i=this.internalProps.layoutMap.getBodyLayoutRangeById(e.id);return this.transpose?i.start.row:i.start.col}getCellAddrByFieldRecord(t,e){return this.transpose?{col:this.getTableIndexByRecordIndex(e),row:this.getTableIndexByField(t)}:{col:this.getTableIndexByField(t),row:this.getTableIndexByRecordIndex(e)}}getCellOriginRecord(t,e){const i=this.getRecordShowIndexByCell(t,e);if(i>-1)return this.dataSource.get(i)}getCellRawRecord(t,e){const i=this.getRecordShowIndexByCell(t,e);if(i>-1)return this.dataSource.getRaw(i)}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i&&!this.transpose){const i=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount),n=this.internalProps.layoutMap.isSeriesNumber(t,e);if(null==i?void 0:i.disableColumnResize)return!1;if(n&&!0===this.internalProps.rowSeriesNumber.disableColumnResize)return!1}return i}updateOption(t){var e,i,n,o,r,s,a,l,h;const d=this.internalProps;if(super.updateOption(t),d.frozenColDragHeaderMode=null!==(i=null===(e=t.dragOrder)||void 0===e?void 0:e.frozenColDragHeaderMode)&&void 0!==i?i:t.frozenColDragHeaderMode,this.pagination=t.pagination,d.sortState=t.sortState,d.dataConfig=t.groupBy?tI(t.groupBy):{},this.showHeader=null===(n=t.showHeader)||void 0===n||n,d.columns=t.columns?DO(t.columns,["children"]):t.header?DO(t.header,["children"]):[],MT(this),d.enableTreeNodeMerge=null!==(r=null!==(o=t.enableTreeNodeMerge)&&void 0!==o?o:XC(t.groupBy))&&void 0!==r&&r,this.internalProps.headerHelper.setTableColumnsEditor(),this.transpose=null!==(s=t.transpose)&&void 0!==s&&s,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.internalProps.columnWidthConfig=t.columnWidthConfig,d.releaseList)for(let t=d.releaseList.length-1;t>=0;t--){const e=d.releaseList[t];e instanceof oS?e.updateColumns(this.internalProps.columns):(null===(a=null==e?void 0:e.release)||void 0===a||a.call(e),d.releaseList.splice(t,1))}if(t.dataSource&&this.dataSource!==t.dataSource?this.dataSource=t.dataSource:t.records?this.setRecords(t.records,{sortState:t.sortState}):(this.refreshRowColCount(),this._resetFrozenColCount(),this.scenegraph.createSceneGraph(),this.render()),t.title){const e=J_.getComponent("title");d.title=new e(t.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)null===(l=this.internalProps.emptyTip)||void 0===l||l.resetVisible();else{const t=J_.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),null===(h=this.internalProps.emptyTip)||void 0===h||h.resetVisible()}return this.pluginManager.updatePlugins(t.plugins),new Promise((t=>{setTimeout(t,0)}))}updatePagination(t){this.pagination&&("number"==typeof t.currentPage&&t.currentPage>=0&&(this.pagination.currentPage=t.currentPage),t.perPageCount&&(this.pagination.perPageCount=t.perPageCount||this.pagination.perPageCount),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.dataSource.updatePagination(this.pagination),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph(),this.renderAsync())}refreshHeader(){var t;const e=this.internalProps,i=this.transpose,n=this.showHeader;(e.layoutMap=new ZO(this,null!==(t=e.columns)&&void 0!==t?t:[],n,this.options.hierarchyIndent)).transpose=i,i||this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){var t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b;const m=this,{layoutMap:y}=m.internalProps;if(!y)return;const C=null!==(e=null===(t=m.internalProps.dataSource)||void 0===t?void 0:t.length)&&void 0!==e?e:0;y.recordsCount=C+(C>0||this.options.showAggregationWhenEmpty?y.hasAggregationOnTopCount+y.hasAggregationOnBottomCount:0),m.transpose?(m.rowCount=null!==(i=y.rowCount)&&void 0!==i?i:0,m.colCount=null!==(n=y.colCount)&&void 0!==n?n:0,this.internalProps.frozenColCount=Math.max((null!==(o=y.headerLevelCount)&&void 0!==o?o:0)+y.leftRowSeriesNumberColumnCount,null!==(r=this.options.frozenColCount)&&void 0!==r?r:0),this.internalProps.frozenRowCount=null!==(s=this.options.frozenRowCount)&&void 0!==s?s:0,m.bottomFrozenRowCount!==(null!==(a=this.options.bottomFrozenRowCount)&&void 0!==a?a:0)&&(m.bottomFrozenRowCount=null!==(l=this.options.bottomFrozenRowCount)&&void 0!==l?l:0),m.rightFrozenColCount!==(null!==(h=this.options.rightFrozenColCount)&&void 0!==h?h:0)&&(m.rightFrozenColCount=null!==(d=this.options.rightFrozenColCount)&&void 0!==d?d:0)):(m.colCount=null!==(c=y.colCount)&&void 0!==c?c:0,m.rowCount=y.recordsCount*y.bodyRowSpanCount+y.headerLevelCount,this.internalProps.frozenColCount=null!==(u=this.options.frozenColCount)&&void 0!==u?u:0,m.frozenRowCount=Math.max(y.headerLevelCount,null!==(g=this.options.frozenRowCount)&&void 0!==g?g:0),m.bottomFrozenRowCount!==(null!==(p=this.options.bottomFrozenRowCount)&&void 0!==p?p:0)&&(m.bottomFrozenRowCount=null!==(f=this.options.bottomFrozenRowCount)&&void 0!==f?f:0),m.rightFrozenColCount!==(null!==(v=this.options.rightFrozenColCount)&&void 0!==v?v:0)&&(m.rightFrozenColCount=null!==(b=this.options.rightFrozenColCount)&&void 0!==b?b:0)),this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}getFieldData(t,e,i){if(null===t)return null;if(this.internalProps.layoutMap.isHeader(e,i))return null;const n=this.getRecordShowIndexByCell(this.transpose?e-this.internalProps.layoutMap.leftRowSeriesNumberColumnCount:e,i);return this.internalProps.dataSource.getField(n,t,e,i,this)}getRawFieldData(t,e,i){if(null===t)return null;if(this.internalProps.layoutMap.isHeader(e,i))return null;const n=this.getRecordShowIndexByCell(e,i);return this.internalProps.dataSource.getRawField(n,t,e,i,this)}_moveHeaderPosition(t,e){const i=this.getCellRange(t.col,t.row),n=this.getCellRange(e.col,e.row),o=this.internalProps.layoutMap.moveHeaderPosition(t,e);return o?("column"===o.moveType?(this.colWidthsMap.exchangeOrder(i.start.col,i.end.col-i.start.col+1,n.start.col,n.end.col-n.start.col+1,o.targetIndex),this.transpose||(this.colWidthsLimit={},this.setMinMaxLimitWidth())):o.targetIndex>o.sourceIndex?this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex+o.sourceSize-o.targetSize,o.targetSize,o.targetIndex):this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex,o.targetSize,o.targetIndex),o):null}changeRecordOrder(t,e){this.transpose?(t=this.getRecordShowIndexByCell(t,0),e=this.getRecordShowIndexByCell(e,0)):(t=this.getRecordShowIndexByCell(0,t),e=this.getRecordShowIndexByCell(0,e)),this.dataSource.changeOrder(t,e)}getCellAddress(t,e){let i;for(let e=0;e<this.internalProps.records.length;e++){const n=this.internalProps.records[e];if("function"==typeof t)t(n)&&(i=e);else{let o=!0;for(const e in t)if(n[e]!==t[e]){o=!1;break}o&&(i=e)}if(XC(i))break}const n=this.getCellRangeByField(e,i);if(n)return{row:n.start.row,col:n.start.col}}getCellRangeByField(t,e){const{layoutMap:i}=this.internalProps,n=i.columnObjects.find((e=>e.field===t));if(n){const t=i.getBodyLayoutRangeById(n.id);let o;return XC(e)&&(o=i.getRecordStartRowByRecordIndex(e)),this.transpose?{start:{row:t.start.row,col:XC(o)?o+t.start.col:void 0},end:{row:t.end.row,col:XC(o)?o+t.end.col:void 0}}:{start:{col:t.start.col,row:XC(o)?o+t.start.row:void 0},end:{col:t.end.col,row:XC(o)?o+t.end.row:void 0}}}return null}getHierarchyState(t,e){var i;if(this.isHeader(t,e))return null===(i=this._getHeaderLayoutMap(t,e))||void 0===i?void 0:i.hierarchyState;if((!this.options.groupBy||ZC(this.options.groupBy)&&0===this.options.groupBy.length)&&!this.getBodyColumnDefine(t,e).tree)return Kw.none;const n=this.getRecordShowIndexByCell(t,e);return this.dataSource.getHierarchyState(n)}toggleHierarchyState(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.stateManager.updateHoverIcon(t,e,void 0,void 0);const n=this.getHierarchyState(t,e);if(this.isHeader(t,e)){const i=this.internalProps.layoutMap.getHeader(t,e),{hierarchyState:o,define:r}=i;if(![Kw.collapse,Kw.expand].includes(o)||!r)return;const s=r.columns;if(Array.isArray(s)&&s.length>0){const t=o===Kw.expand?Kw.collapse:Kw.expand;i.hierarchyState=t,i.define.hierarchyState=t,this.updateColumns(this.internalProps.columns)}this.fireListeners(v_.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:n,originData:i,cellLocation:this.getCellLocation(t,e)})}else if(n===Kw.expand)this._refreshHierarchyState(t,e,i),this.fireListeners(v_.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:Kw.collapse});else if(n===Kw.collapse){const n=this.getCellOriginRecord(t,e);Array.isArray(n.children)&&this._refreshHierarchyState(t,e,i),this.fireListeners(v_.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:Kw.expand,originData:n})}}setLoadingHierarchyState(t,e){this.scenegraph.setLoadingHierarchyState(t,e)}_refreshHierarchyState(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n,o;let r=!1,s=!1;const a=this.internalProps.layoutMap.checkHasChart();a&&(this.autoFillWidth&&(r=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(s=this.getAllRowsHeight()<=this.tableNoFrameHeight));const l=this.getRecordShowIndexByCell(t,e),h=this.dataSource.toggleHierarchyState(l,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount,Math.max(this.scenegraph.proxy.rowEnd-this.columnHeaderLevelCount,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount+this.scenegraph.proxy.rowLimit-1)),d=this.internalProps.layoutMap.toggleHierarchyState(h);this.refreshRowColCount();for(let t=this.rowCount-this.bottomFrozenRowCount;t<this.rowCount;t++){const e=fk(t,0,this.colCount-1,this);this._setRowHeight(t,e)}this.clearCellStyleCache(),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1;const{updateCells:c,addCells:u,removeCells:g}=function(t,e,i,n){const o=[{col:e,row:i}],r=[],s=[],{addCellPositions:a,removeCellPositions:l}=t,h=n.scenegraph.proxy,{rowStart:d,rowLimit:c}=h;let{rowEnd:u}=h,g=1/0;for(let t=0;t<a.length;t++){const{row:i}=a[t];u-d+1===c?i>=d&&i<=u&&(g=Math.min(g,i)):(r.push({col:e,row:i}),u++)}const p=Math.min(d+c,n.rowCount-1-n.bottomFrozenRowCount),f=p<d+c;for(let t=0;t<l.length;t++){const{row:i}=l[l.length-t-1];i<d||i>u||(i>p||f?(s.push({col:e,row:i}),g--):g=Math.min(g,i))}if(g!==1/0)for(let t=g;t<=u;t++)o.push({col:e,row:t});return n.scenegraph.proxy.refreshRowCount(),{updateCells:o,addCells:r,removeCells:s}}(d,t,e,this);null===(n=this.reactCustomLayout)||void 0===n||n.clearCache(),this.scenegraph.updateRow(g,u,c,i,!0),null===(o=this.reactCustomLayout)||void 0===o||o.updateAllCustomCell(),a&&(this.autoFillWidth&&!r&&(r=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!s&&(s=this.getAllRowsHeight()<=this.tableNoFrameHeight),("adaptive"===this.widthMode||r||"adaptive"===this.heightMode||s)&&this.scenegraph.updateChartSizeForResizeColWidth(-1))}_hasHierarchyTreeHeader(){var t,e;return null===(e=null!==(t=this.options.columns)&&void 0!==t?t:this.options.header)||void 0===e?void 0:e.some(((t,e)=>t.tree))}getMenuInfo(t,e,i){return{field:this.getHeaderField(t,e),value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),event:void 0}}_getSortFuncFromHeaderOption(t,e,i){if(t||(t=this.internalProps.columns),e&&t&&t.length>0)for(let n=0;n<t.length;n++){const o=t[n];if((i&&i===o.fieldKey||!i&&o.field===e)&&o.sort&&"function"==typeof o.sort)return o.sort;if(o.columns){const t=this._getSortFuncFromHeaderOption(o.columns,e,i);if(t)return t}}}updateSortState(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i;if(t)this.internalProps.sortState=t;else if(this.internalProps.sortState)if(Array.isArray(this.internalProps.sortState))for(let e=0;e<this.internalProps.sortState.length;e++)(t=null===(i=this.internalProps.sortState)||void 0===i?void 0:i[e])&&(t.order="normal");else this.internalProps.sortState.order="normal",t=this.internalProps.sortState;(t=Array.isArray(t)?t:[t]).some((t=>t.field))&&e&&this.internalProps.layoutMap.headerObjects.some((t=>!1!==t.define.sort))&&(this.dataSource.sort(t.map((t=>{const e=this._getSortFuncFromHeaderOption(this.internalProps.columns,t.field);return this.internalProps.layoutMap.headerObjects.find((e=>e&&e.field===t.field)),{field:t.field,order:t.order,orderFn:null!=e?e:Gx}}))),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.sortCell()),t.length&&this.stateManager.updateSortState(t)}updateFilterRules(t){this.scenegraph.clearCells(),this.sortState?(this.dataSource.updateFilterRulesForSorted(t),iI(this)):this.dataSource.updateFilterRules(t),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph()}getCheckboxState(t){if(this.stateManager.checkedState.size<this.rowCount-this.columnHeaderLevelCount&&this.stateManager.initLeftRecordsCheckState(this.records),XC(t)){let e=Array.from(this.stateManager.checkedState.keys()).sort(((t,e)=>{var i,n;const o=t.split(","),r=e.split(","),s=Math.max(o.length,r.length);for(let t=0;t<s;t++){const e=null!==(i=Number(o[t]))&&void 0!==i?i:0,s=null!==(n=Number(r[t]))&&void 0!==n?n:0;if(e!==s)return e-s}return 0})).map((t=>this.stateManager.checkedState.get(t)));return this.options.groupBy&&(e=function(t){const e=[],i=t.dataSource,n=i.dataConfig.groupByRules.length+1;return i.currentIndexedData.forEach(((o,r)=>{if(ZC(o)&&o.length===n){const n=i.getOriginRecordIndexForGroup(o);e[n]=t.stateManager.checkedState.get(o.toString())}})),e}(this)),Array.from(e,(e=>e&&e[t]))}return new Array(...this.stateManager.checkedState.values())}getCellCheckboxState(t,e){var i;const n=this.getBodyColumnDefine(t,e),o=null==n?void 0:n.field,r=this.getCellType(t,e);if(XC(o)&&("checkbox"===r||"switch"===r)){const n=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(t,e)).toString();return null===(i=this.stateManager.checkedState.get(n))||void 0===i?void 0:i[o]}}getRadioState(t){return XC(t)?this.stateManager.radioState[t]:this.stateManager.radioState}getCellRadioState(t,e){return function(t,e,i){var n;const o=i.getBodyColumnDefine(t,e),r=null==o?void 0:o.field,s=i.getCellType(t,e);if(XC(r)&&"radio"===s){const o=i.dataSource.getIndexKey(i.getRecordShowIndexByCell(t,e)),s=null===(n=i.stateManager.radioState)||void 0===n?void 0:n[r];if(tw(s)){if(s===o)return!0}else if($C(s)){const t=s[o];if(tw(t))return t}}return!1}(t,e,this)}setCellCheckboxState(t,e,i){!function(t,e,i,n){const o=n.scenegraph.getCell(t,e),r=null==o?void 0:o.getChildByName("checkbox");if(!r){const o=n.getHeaderField(t,e);if(n.isHeader(t,e))n.stateManager.setHeaderCheckedState(o,i),"checkbox"===n.getCellType(t,e)&&n.scenegraph.updateCheckboxCellState(t,e,i);else if(n.stateManager.setCheckedState(t,e,o,i),"checkbox"===n.getCellType(t,e)){const i=n.stateManager.headerCheckedState[o],r=n.stateManager.updateHeaderCheckedState(o,t,e);i!==r&&n.scenegraph.updateHeaderCheckboxCellState(t,e,r)}return}const{checked:s,indeterminate:a}=r.attribute;a?(i||r._handlePointerUp(),r._handlePointerUp()):s?i||r._handlePointerUp():i&&r._handlePointerUp()}(t,e,i,this)}setCellRadioState(t,e,i){!function(t,e,i,n){const o=n.scenegraph.getCell(t,e);if(o)if(tw(i)){const t=o.getChildAt(i);null==t||t._handlePointerUp()}else{const t=o.getChildByName("radio");null==t||t._handlePointerUp()}}(t,e,i,this)}getSwitchState(t){return this.getCheckboxState(t)}getCellSwitchState(t,e){return this.getCellCheckboxState(t,e)}setCellSwitchState(t,e,i){this.setCellCheckboxState(t,e,i)}setRecords(t,e){var i,n,o,r;let s;aM(),null===(i=this.internalProps.dataSource)||void 0===i||i.release(),this.internalProps.releaseList=null===(n=this.internalProps.releaseList)||void 0===n?void 0:n.filter((t=>!t.dataSourceObj)),this.internalProps.dataSource=null,Array.isArray(e)||(null==e?void 0:e.order)?s=e:e?s=e.sortState:null===e&&(s=null),"undefined"!=typeof window&&window.performance.now();const a={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};if(this.scenegraph.clearCells(),void 0!==s&&(null===s||!Array.isArray(s)&&XC(s.field)||Array.isArray(s))&&(this.internalProps.sortState=this.internalProps.multipleSort?Array.isArray(s)?s:[s]:s,this.stateManager.setSortState(this.sortState)),t){if(AT(this,t),this.sortState){const t=Array.isArray(this.sortState)?this.sortState:[this.sortState];t.some((t=>t.order&&t.field&&"normal"!==t.order))&&this.internalProps.layoutMap.headerObjectsIncludeHided.some((t=>!1!==t.define.sort))&&this.dataSource.sort(t.map((t=>{const e=this._getSortFuncFromHeaderOption(void 0,t.field);return this.internalProps.layoutMap.headerObjectsIncludeHided.find((e=>e&&e.field===t.field)),{field:t.field,order:t.order||"asc",orderFn:null!=e?e:Gx}})))}this.refreshRowColCount()}else AT(this,t);if(this.stateManager.initCheckedState(t),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(a.col,a.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.options.emptyTip)if(this.internalProps.emptyTip)null===(o=this.internalProps.emptyTip)||void 0===o||o.resetVisible();else{const t=J_.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),null===(r=this.internalProps.emptyTip)||void 0===r||r.resetVisible()}this.render(),XC(a.col)&&XC(a.row)&&a.col>=0&&a.row>=0&&setTimeout((()=>{var t;null===(t=this.internalProps)||void 0===t||t.tooltipHandler.showTooltip(a.col,a.row)}),0)}setRecordChildren(t,e,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=this.getCellOriginRecord(e,i);o.children=t;const r=this.getRecordShowIndexByCell(e,i);this.dataSource.setRecord(o,r),this._refreshHierarchyState(e,i,n)}startEditCell(t,e,i){var n;if(XC(t)&&XC(e))this.eventManager.isDraging=!1,this.selectCell(t,e),this.editorManager.startEditCell(t,e,i);else if(null===(n=this.stateManager.select)||void 0===n?void 0:n.cellPos){const{col:t,row:e}=this.stateManager.select.cellPos;XC(t)&&XC(e)&&this.editorManager.startEditCell(t,e,i)}}completeEditCell(){this.editorManager.completeEdit()}getEditor(t,e){var i,n;const o=this.getBodyColumnDefine(t,e);let r=this.isHeader(t,e)?null!==(i=null==o?void 0:o.headerEditor)&&void 0!==i?i:this.options.headerEditor:null!==(n=null==o?void 0:o.editor)&&void 0!==n?n:this.options.editor;return"function"==typeof r&&(r=r({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})),"string"==typeof r?function(t){if(IH[t])return IH[t]}(r):r}isHasEditorDefine(t,e){var i,n;const o=this.getBodyColumnDefine(t,e);let r=this.isHeader(t,e)?null!==(i=null==o?void 0:o.headerEditor)&&void 0!==i?i:this.options.headerEditor:null!==(n=null==o?void 0:o.editor)&&void 0!==n?n:this.options.editor;return"function"==typeof r&&(r=r({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})),XC(r)}changeCellValue(t,e,i){return function(t,e,i,n,o,r){if(n&&r.isHasEditorDefine(t,e)||!1===n){const n=r.getRecordShowIndexByCell(t,e),{field:s}=r.internalProps.layoutMap.getBody(t,e),a=r.getCellRawValue(t,e),l=r.getCellOriginValue(t,e);r.isHeader(t,e)?r.internalProps.layoutMap.updateColumnTitle(t,e,i):r.dataSource.changeFieldValue(i,n,s,t,e,r);const h=r.getCellRange(t,e),d=r.internalProps.layoutMap.getAggregatorsByCell(t,e);if(d){if(Array.isArray(d))for(let t=0;t<(null==d?void 0:d.length);t++)d[t].recalculate();else d.recalculate();const t=r.internalProps.layoutMap.getAggregatorCellAddress(h.start.col,h.start.row,h.end.col,h.end.row);for(let e=0;e<t.length;e++){const i=r.getCellRange(t[e].col,t[e].row);for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)r.scenegraph.updateCellContent(t,e)}}for(let t=h.start.col;t<=h.end.col;t++)for(let e=h.start.row;e<=h.end.row;e++)r.scenegraph.updateCellContent(t,e);if("adaptive"===r.widthMode||r.autoFillWidth&&r.getAllColsWidth()<=r.tableNoFrameWidth)0===r.internalProps._widthResizedColMap.size&&r.scenegraph.recalculateColWidths();else if(!r.internalProps._widthResizedColMap.has(t)){const e=r.getColWidth(t),i=JM(t,0,r.rowCount-1,r,!1);i!==e&&r.scenegraph.updateColWidth(t,i-e)}if("adaptive"===r.heightMode||r.autoFillHeight&&r.getAllRowsHeight()<=r.tableNoFrameHeight)0===r.internalProps._heightResizedRowMap.size&&r.scenegraph.recalculateRowHeights();else if(r.isAutoRowHeight(e)&&!r.internalProps._heightResizedRowMap.has(e)){const t=r.getRowHeight(e),i=fk(e,0,r.colCount-1,r);r.scenegraph.updateRowHeight(e,i-t)}const c=r.getCellOriginValue(t,e);l!==c&&o&&r.fireListeners(v_.CHANGE_CELL_VALUE,{col:t,row:e,rawValue:a,currentValue:l,changedValue:c}),r.scenegraph.updateNextFrame()}}(t,e,i,arguments.length>3&&void 0!==arguments[3]&&arguments[3],!(arguments.length>4&&void 0!==arguments[4])||arguments[4],this)}changeCellValues(t,e,i){return function(t,e,i,n,o,r){var s,a;const l=[];let h=t,d=e;const c=[],u=[];let g;for(let n=0;n<i.length&&!(e+n>r.rowCount-1);n++){const o=i[n],s=[],a=[];c.push(s),u.push(a);for(let i=0;i<o.length&&!(t+i>r.colCount-1);i++){g=eI(t+i,e+n,r,g);const o=r.getCellRawValue(t+i,e+n);s.push(o);const l=r.getCellOriginValue(t+i,e+n);a.push(l)}}for(let g=0;g<i.length&&!(e+g>r.rowCount-1);g++){l[g]=[],d=e+g;const p=i[g];let f=t;for(let i=0;i<p.length&&!(t+i>r.colCount-1);i++){f=t+i;let h=!1;if(!1===n)h=!0;else if(r.isHasEditorDefine(t+i,e+g)){const n=r.getEditor(t+i,e+g),o=u[g][i],l=p[i],d=null===(a=null===(s=null==n?void 0:n.validateValue)||void 0===s?void 0:s.call(n,l,o))||void 0===a||a;h=!!o_(d)||!0===d||"validate-exit"===d||"invalidate-exit"===d}if(h){l[g][i]=!0;const n=p[i],s=r.getRecordShowIndexByCell(t+i,e+g),{field:a}=r.internalProps.layoutMap.getBody(t+i,e+g),h=c[g][i],d=u[g][i];r.isHeader(t+i,e+g)?r.internalProps.layoutMap.updateColumnTitle(t+i,e+g,n):r.dataSource.changeFieldValue(n,s,a,t+i,e+g,r);const f=r.getCellOriginValue(t+i,e+g);d!==f&&o&&r.fireListeners(v_.CHANGE_CELL_VALUE,{col:t+i,row:e+g,rawValue:h,currentValue:d,changedValue:f})}else l[g][i]=!1}h=Math.max(h,f)}const p=r.getCellRange(t,e),f=r.getCellRange(h,d),v=r.internalProps.layoutMap.getAggregatorsByCellRange(p.start.col,p.start.row,f.end.col,f.end.row);if(v){for(let t=0;t<(null==v?void 0:v.length);t++)v[t].recalculate();if("normal"===g){const t=r.internalProps.layoutMap.getAggregatorCellAddress(p.start.col,p.start.row,f.end.col,f.end.row);for(let e=0;e<t.length;e++){const i=r.getCellRange(t[e].col,t[e].row);for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)r.scenegraph.updateCellContent(t,e)}}}if("group"===g&&r.dataSource.updateRecordsForGroup([],[]),"sort"===g||"group"===g)return r.dataSource.sortedIndexMap.clear(),iI(r),r.refreshRowColCount(),r.internalProps.layoutMap.clearCellRangeMap(),r.scenegraph.clearCells(),r.scenegraph.createSceneGraph(),l;for(let t=p.start.col;t<=f.end.col;t++)for(let e=p.start.row;e<=f.end.row;e++)r.scenegraph.updateCellContent(t,e);if("adaptive"===r.widthMode||r.autoFillWidth&&r.getAllColsWidth()<=r.tableNoFrameWidth)0===r.internalProps._widthResizedColMap.size&&r.scenegraph.recalculateColWidths();else for(let e=t;e<=f.end.col;e++)if(!r.internalProps._widthResizedColMap.has(e)){const t=r.getColWidth(e),i=JM(e,0,r.rowCount-1,r,!1);i!==t&&r.scenegraph.updateColWidth(e,i-t)}if("adaptive"===r.heightMode||r.autoFillHeight&&r.getAllRowsHeight()<=r.tableNoFrameHeight)r.scenegraph.recalculateRowHeights();else if(r.isAutoRowHeight(e)){const t=[],i=[];for(let n=e;n<=f.end.row;n++)if(r.rowHeightsMap.get(n)){const e=r.getRowHeight(n),o=fk(n,0,r.colCount-1,r);t.push(n),i.push(o-e)}r.scenegraph.updateRowsHeight(t,i)}return r.scenegraph.updateNextFrame(),l}(t,e,i,arguments.length>3&&void 0!==arguments[3]&&arguments[3],!(arguments.length>4&&void 0!==arguments[4])||arguments[4],this)}addRecord(t,e){var i;(function(t,e,i){var n,o,r,s;if(i.options.groupBy)null===(o=(n=i.dataSource).addRecordsForGroup)||void 0===o||o.call(n,[t],e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&iI(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if("tree"===i.dataSource.rowHierarchyType)null===(s=(r=i.dataSource).addRecordsForTree)||void 0===s||s.call(r,[t],e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&iI(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if(i.sortState)i.dataSource.addRecordForSorted(t),iI(i),i.refreshRowColCount(),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{(void 0===e||e>i.dataSource.sourceLength)&&(e=i.dataSource.sourceLength);const n=i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount;i.dataSource.addRecord(t,e);const o=i.rowCount;if(i.refreshRowColCount(),0===i.scenegraph.proxy.totalActualBodyRowCount)return i.scenegraph.clearCells(),void i.scenegraph.createSceneGraph();const r=i.transpose?i.colCount:i.rowCount;if(i.pagination){const{perPageCount:t,currentPage:s}=i.pagination,a=t*(s||0)+t;if(e<a)if(e<a-t)i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{const s=e-(a-t)+n;if(o-n===i.pagination.perPageCount){const t=[];for(let e=s;e<r;e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],[],t):i.scenegraph.updateRow([],[],t)}else{const t=[];for(let e=s;e<Math.min(r,s+1);e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],t,[]):i.scenegraph.updateRow([],t,[])}}}else{const t=[];for(let o=e+n;o<e+n+1;o++)i.transpose?t.push({col:o,row:0}):t.push({col:0,row:o});const o=[],r=i.internalProps.layoutMap.hasAggregationOnTopCount,s=i.internalProps.layoutMap.hasAggregationOnBottomCount;for(let t=n;t<n+r;t++)i.transpose?o.push({col:t,row:0}):o.push({col:0,row:t});for(let t=(i.transpose?i.colCount:i.rowCount)-s;t<(i.transpose?i.colCount:i.rowCount);t++)i.transpose?o.push({col:t,row:0}):o.push({col:0,row:t});i.transpose?i.scenegraph.updateCol([],t,[]):i.scenegraph.updateRow([],t,[])}}})(t,e,this),null===(i=this.internalProps.emptyTip)||void 0===i||i.resetVisible()}addRecords(t,e){var i;(function(t,e,i){var n,o,r,s;if(i.options.groupBy)null===(o=(n=i.dataSource).addRecordsForGroup)||void 0===o||o.call(n,t,e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&iI(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if("tree"===i.dataSource.rowHierarchyType)null===(s=(r=i.dataSource).addRecordsForTree)||void 0===s||s.call(r,t,e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&iI(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if(i.sortState)i.dataSource.addRecordsForSorted(t),iI(i),i.refreshRowColCount(),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{void 0===e||e>i.dataSource.sourceLength?e=i.dataSource.sourceLength:e<0&&(e=0);const n=i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount;i.dataSource.addRecords(t,e);const o=i.transpose?i.colCount:i.rowCount;if(i.refreshRowColCount(),0===i.scenegraph.proxy.totalActualBodyRowCount)return i.scenegraph.clearCells(),void i.scenegraph.createSceneGraph();const r=i.transpose?i.colCount:i.rowCount;if(i.pagination){const{perPageCount:s,currentPage:a}=i.pagination,l=s*(a||0)+s;if(e<l)if(e<l-s)i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{const a=e-(l-s)+n;if(o-n===i.pagination.perPageCount){const t=[];for(let e=a;e<r;e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],[],t):i.scenegraph.updateRow([],[],t)}else{const e=[];for(let n=a;n<Math.min(r,a+(Array.isArray(t)?t.length:1));n++)i.transpose?e.push({col:n,row:0}):e.push({col:0,row:n});i.transpose?i.scenegraph.updateCol([],e,[]):i.scenegraph.updateRow([],e,[])}}}else{const o=[];for(let r=e+n;r<e+n+(Array.isArray(t)?t.length:1);r++)i.transpose?o.push({col:r,row:0}):o.push({col:0,row:r});const r=i.internalProps.layoutMap.hasAggregationOnTopCount,s=i.internalProps.layoutMap.hasAggregationOnBottomCount,a=[];for(let t=n;t<n+r;t++)i.transpose?a.push({col:t,row:0}):a.push({col:0,row:t});for(let t=(i.transpose?i.colCount:i.rowCount)-s;t<(i.transpose?i.colCount:i.rowCount);t++)i.transpose?a.push({col:t,row:0}):a.push({col:0,row:t});i.transpose?i.scenegraph.updateCol([],o,a):i.scenegraph.updateRow([],o,a)}}})(t,e,this),null===(i=this.internalProps.emptyTip)||void 0===i||i.resetVisible()}deleteRecords(t){var e;(function(t,e){var i,n,o,r,s,a,l,h;if((null==t?void 0:t.length)>0)if(e.options.groupBy)null===(n=(i=e.dataSource).deleteRecordsForGroup)||void 0===n||n.call(i,t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&iI(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if("tree"===e.dataSource.rowHierarchyType)null===(r=(o=e.dataSource).deleteRecordsForTree)||void 0===r||r.call(o,t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&iI(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.sortState)e.dataSource.deleteRecordsForSorted(t),iI(e),e.refreshRowColCount(),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const i=e.dataSource.deleteRecords(t);if(0===i.length)return;const n=e.transpose?e.colCount:e.rowCount;e.refreshRowColCount();const o=e.transpose?e.colCount:e.rowCount,r=i.sort(((t,e)=>t-e)),d=r[0];if(e.pagination){const{perPageCount:t,currentPage:i}=e.pagination,r=t*(i||0)+t;if(d<r)if(d<r-t)e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const i=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,l=e.internalProps.layoutMap.hasAggregationOnTopCount,h=[],c=[];for(let i=d-(r-t)+(e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount)+l;i<o;i++)e.transpose?h.push({col:i,row:0}):h.push({col:0,row:i});for(let t=i;t<i+l;t++)e.transpose?h.push({col:t,row:0}):h.push({col:0,row:t});if(o<n)for(let t=o;t<n;t++)e.transpose?c.push({col:t,row:0}):c.push({col:0,row:t});null===(s=e.reactCustomLayout)||void 0===s||s.clearCache(),e.transpose?e.scenegraph.updateCol(c,[],h):e.scenegraph.updateRow(c,[],h),null===(a=e.reactCustomLayout)||void 0===a||a.updateAllCustomCell()}}else{const t=[],i=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,n=e.internalProps.layoutMap.hasAggregationOnTopCount,o=e.internalProps.layoutMap.hasAggregationOnBottomCount;for(let o=0;o<r.length;o++){const s=r[o]+i+n;e.transpose?t.push({col:s,row:0}):t.push({col:0,row:s})}const s=[];for(let t=i;t<i+n;t++)e.transpose?s.push({col:t,row:0}):s.push({col:0,row:t});for(let t=(e.transpose?e.colCount:e.rowCount)-o;t<(e.transpose?e.colCount:e.rowCount);t++)e.transpose?s.push({col:t,row:0}):s.push({col:0,row:t});null===(l=e.reactCustomLayout)||void 0===l||l.clearCache(),e.transpose?e.scenegraph.updateCol(t,[],s):e.scenegraph.updateRow(t,[],s),null===(h=e.reactCustomLayout)||void 0===h||h.updateAllCustomCell()}}})(t,this),null===(e=this.internalProps.emptyTip)||void 0===e||e.resetVisible()}updateRecords(t,e){!function(t,e,i){var n,o,r,s;if((null==e?void 0:e.length)>0)if(i.options.groupBy)null===(o=(n=i.dataSource).updateRecordsForGroup)||void 0===o||o.call(n,t,e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&iI(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if("tree"===i.dataSource.rowHierarchyType)null===(s=(r=i.dataSource).updateRecordsForTree)||void 0===s||s.call(r,t,e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&iI(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if(i.sortState)i.dataSource.updateRecordsForSorted(t,e),iI(i),i.refreshRowColCount(),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{const n=i.dataSource.updateRecords(t,e);if(0===n.length)return;const o=n.map((t=>i.getBodyRowIndexByRecordIndex(t))).sort(((t,e)=>t-e));if(i.pagination){const{perPageCount:t,currentPage:e}=i.pagination,n=i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount,r=i.internalProps.layoutMap.hasAggregationOnTopCount,s=t*(e||0)+t,a=[];for(let e=0;e<o.length;e++){const n=o[e];if(n<s&&n>=s-t){const e=n-(s-t)+(i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount)+r;a.push(e)}}if(a.length>=1){const t=[];for(let e=0;e<a.length;e++){const n=a[e];i.transpose?t.push({col:n,row:0}):t.push({col:0,row:n})}for(let e=n;e<n+r;e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],[],t):i.scenegraph.updateRow([],[],t)}}else{const t=[],e=i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount,n=i.internalProps.layoutMap.hasAggregationOnTopCount,r=i.internalProps.layoutMap.hasAggregationOnBottomCount;for(let r=0;r<o.length;r++){const s=o[r]+e+n;i.transpose?t.push({col:s,row:0}):t.push({col:0,row:s})}for(let o=e;o<e+n;o++)i.transpose?t.push({col:o,row:0}):t.push({col:0,row:o});for(let e=(i.transpose?i.colCount:i.rowCount)-r;e<(i.transpose?i.colCount:i.rowCount);e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],[],t):i.scenegraph.updateRow([],[],t)}}}(t,e,this)}_hasCustomRenderOrLayout(){var t,e,i,n;const{headerObjects:o}=this.internalProps.layoutMap;if(this.options.customRender)return!0;for(let r=0;r<o.length;r++){const s=o[r];if((null===(t=null==s?void 0:s.define)||void 0===t?void 0:t.customLayout)||(null===(e=null==s?void 0:s.define)||void 0===e?void 0:e.headerCustomLayout)||(null===(i=null==s?void 0:s.define)||void 0===i?void 0:i.customRender)||(null===(n=null==s?void 0:s.define)||void 0===n?void 0:n.headerCustomRender))return!0}return!1}getAggregateValuesByField(t){const e=this.internalProps.layoutMap.getColumnByField(t),i=[];for(let t=0;t<e.length;t++){const n=e[t].columnDefine.aggregator;if(delete e[t].columnDefine,n){const o={col:e[t].col,aggregateValue:null};if(o.aggregateValue=[],Array.isArray(n))for(let t=0;t<n.length;t++)o.aggregateValue.push({aggregationType:n[t].type,value:n[t].value()});else o.aggregateValue.push({aggregationType:n.type,value:n.value()});i.push(o)}}return i}isAggregation(t,e){return this.internalProps.layoutMap.isAggregation(t,e)}getGroupTitleLevel(t,e){var i;if(!this.options.groupBy)return;const n=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(t,e)),o=null!==(i=this.dataSource.getGroupLength())&&void 0!==i?i:0;let r=ZC(n)?n.length-1:0;return o>0&&r===o&&(r=void 0),r}getBodyRowIndexByRecordIndex(t){return Array.isArray(t)&&1===t.length&&(t=t[0]),this.dataSource.getTableIndex(t)}_parseColumnWidthConfig(t){for(let e=0;e<(null==t?void 0:t.length);e++){const i=t[e],n=i.key,o=i.width,r=this.internalProps.layoutMap.getColumnByKey(n);if(r.columnDefine){const{col:t}=r;this.internalProps._widthResizedColMap.has(t)||(this._setColWidth(t,o),this.internalProps._widthResizedColMap.add(t))}}}release(){this.editorManager.release(),super.release()}}function oI(t){return"bottom"===t||"top"===t}var rI;function sI(t){return t}!function(t){t.Identity="identity",t.Linear="linear",t.Log="log",t.Pow="pow",t.Sqrt="sqrt",t.Symlog="symlog",t.Time="time",t.Quantile="quantile",t.Quantize="quantize",t.Threshold="threshold",t.Ordinal="ordinal",t.Point="point",t.Band="band"}(rI||(rI={})),Object.values(rI).forEach((t=>{}));const aI=t=>-Math.log(-t),lI=t=>-Math.exp(-t),hI=t=>isFinite(t)?Math.pow(10,t):t<0?0:t,dI=t=>10===t?hI:t===Math.E?Math.exp:e=>Math.pow(t,e),cI=t=>t===Math.E?Math.log:10===t?Math.log10:2===t?Math.log2:(t=Math.log(t),e=>Math.log(e)/t),uI=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),gI=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t;function pI(t,e){if(t=Number(t),e=Number(e),e-=t)return i=>(i-t)/e;const i=Number.isNaN(e)?NaN:.5;return()=>i}function fI(t,e,i){const n=t[0],o=t[1],r=e[0],s=e[1];let a,l;return o<n?(a=pI(o,n),l=i(s,r)):(a=pI(n,o),l=i(r,s)),t=>l(a(t))}function vI(t,e,i){let n;return n=1===t?t+2*i:t-e+2*i,t?n>0?n:1:0}function bI(t,e){const i=(t[1]-t[0])/(e[1]-e[0]),n=t[0]-i*e[0];return[n,i+n]}function mI(t,e,i){const n=Math.min(t.length,e.length)-1,o=new Array(n),r=new Array(n);let s=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<n;)o[s]=pI(t[s],t[s+1]),r[s]=i(e[s],e[s+1]);return function(e){const i=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;for(jH(n)&&(n=t.length);i<n;){const o=i+n>>>1;oO(t[o],e)>0?n=o:i=o+1}return i}(t,e,1,n)-1;return r[i](o[i](e))}}const yI=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=Math.floor(Math.log10(t)),n=t/Math.pow(10,i);let o;return o=e?n<1.5?1:n<3?2:n<7?5:10:n<=1?1:n<=2?2:n<=5?5:10,o*Math.pow(10,i)};class CI{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:VH(this._rangeFactorStart)&&VH(this._rangeFactorEnd)&&2===t.length?(this._wholeRange=bI(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(2===t.length&&t.every((t=>t>=0&&t<=1))&&(this._wholeRange=null,0===t[0]&&1===t[1]?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):VH(this._rangeFactorStart)&&VH(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return jH(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!jH(this._rangeFactorEnd)&&1!==this._rangeFactorEnd?(this._rangeFactorStart=t,this._rangeFactorEnd=null!==(i=this._rangeFactorEnd)&&void 0!==i?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return jH(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!jH(this._rangeFactorStart)&&0!==this._rangeFactorStart?(this._rangeFactorEnd=t,this._rangeFactorStart=null!==(i=this._rangeFactorStart)&&void 0!==i?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:n}=this._fishEyeOptions,o=this.range(),r=o[0],s=o[o.length-1],a=Math.min(r,s),l=Math.max(r,s),h=vO(null!==(t=this._fishEyeOptions.focus)&&void 0!==t?t:0,a,l),d=jH(n)?(l-a)*i:n;let c=Math.exp(e);c=c/(c-1)*d;const u=e/d;this._fishEyeTransform=t=>{const e=Math.abs(t-h);if(e>=d)return t;if(e<=1e-6)return h;const i=c*(1-Math.exp(-e*u))/e*.75+.25;return h+(t-h)*i}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return null!==(i=null==this?void 0:this[t])&&void 0!==i?i:e}}const wI=Symbol("implicit");class xI extends CI{specified(t){var e;return t?(this._specified=Object.assign(null!==(e=this._specified)&&void 0!==e?e:{},t),this):Object.assign({},this._specified)}_getSpecifiedValue(t){if(this._specified)return this._specified[t]}constructor(){super(),this.type=rI.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=wI}clone(){const t=(new xI).domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&t.specified(this._specified),t}calculateVisibleDomain(t){return VH(this._rangeFactorStart)&&VH(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:this._domain}scale(t){const e=`${t}`,i=this._getSpecifiedValue(e);if(void 0!==i)return i;let n=this._index.get(e);if(!n){if(this._unknown!==wI)return this._unknown;n=this._domain.push(t),this._index.set(e,n)}const o=this._ordinalRange[(n-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(o):o}invert(t){let e=0;for(;e<this._ordinalRange.length&&this._ordinalRange[e]!==t;)e++;return this._domain[(e-1)%this._domain.length]}domain(t){if(!t)return this._domain.slice();this._domain=[],this._index=new Map;for(const e of t){const t=`${e}`;this._index.has(t)||this._index.set(t,this._domain.push(e))}return this}range(t){if(!t)return this._ordinalRange.slice();const e=Array.from(t);return this._ordinalRange=e,this}index(t){var e;return this._index&&null!==(e=this._index.get(`${t}`))&&void 0!==e?e:-1}}function _I(t,e,i,n){const o=[];let r=t;for(;r<=e;)o.push(r),r+=i;return n&&o.reverse(),o}function SI(t,e,i,n){let o,r;if(e=Math.floor(+e),t=Math.floor(+t),!(i=Math.floor(+i)))return[];if(t===e)return[t];if(o=e<t){const i=t;t=e,e=i}let s=bO(1,e-t+1)(i);if(r=Math.floor((e-t+1)/s),!n)for(;Math.ceil((e-t+1)/r)>i&&s>1;)s-=1,r=Math.floor((e-t)/s);return _I(t,e,r,o)}class AI extends xI{constructor(t){super(),this.type=rI.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(t)}rescale(t,e){if(t)return this;this._wholeRange=null;const i=this._calculateWholeRange(this._range,e),n=super.domain().length,o=i[1]<i[0];let r=i[Number(o)-0];const s=i[1-Number(o)],a=vI(n,this._paddingInner,this._paddingOuter);return this._step=(s-r)/Math.max(1,a||1),this._round&&(this._step=Math.floor(this._step)),r+=(s-r-this._step*(n-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(r=Math.round(r),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:o,start:o?r+this._step*(n-1):r,count:n},this.generateFishEyeTransform(),this}scale(t){if(!this._bandRangeState)return;const e=`${t}`,i=this._getSpecifiedValue(e);if(void 0!==i)return i;let n=this._index.get(e);if(!n){if(this._unknown!==wI)return this._unknown;n=this._domain.push(t),this._index.set(e,n)}const{count:o,start:r,reverse:s}=this._bandRangeState,a=r+(n-1)%o*(s?-1:1)*this._step;return this._fishEyeTransform?this._fishEyeTransform(a):a}_calculateWholeRange(t,e){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let e;if(VH(this._rangeFactorStart)&&VH(this._rangeFactorEnd)&&2===t.length){const i=bI(t,[this._rangeFactorStart,this._rangeFactorEnd]);e=Math.abs(i[1]-i[0])}else e=Math.abs(t[1]-t[0]);const i=function(t,e,i,n,o){const r=vI(t,i,n);let s=e/Math.max(1,r||1);o&&(s=Math.floor(s));let a=s*(1-i);return o&&(a=Math.round(a)),a}(super.domain().length,e,this._paddingInner,this._paddingOuter,this._round);i<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):i>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=i,this._isFixed=!1)}if(this.isBandwidthFixed()){const s=(i=super.domain().length,n=this._bandwidth,o=this._paddingInner,r=this._paddingOuter,1===o&&(o=0),vI(i,o,r)*(n/(1-o))*Math.sign(t[1]-t[0])),a=Math.min((t[1]-t[0])/s,1);if(VH(this._rangeFactorStart)&&VH(this._rangeFactorEnd)){if(s>0){const e=t[0]-s*this._rangeFactorStart,i=e+s;this._wholeRange=[e,i]}else{const e=t[1]+s*(1-this._rangeFactorEnd),i=e-s;this._wholeRange=[i,e]}const i=this._rangeFactorStart+a<=1,n=this._rangeFactorEnd-a>=0;"rangeFactorStart"===e&&i?this._rangeFactorEnd=this._rangeFactorStart+a:"rangeFactorEnd"===e&&n?this._rangeFactorStart=this._rangeFactorEnd-a:t[0]<=t[1]?i?this._rangeFactorEnd=this._rangeFactorStart+a:n?this._rangeFactorStart=this._rangeFactorEnd-a:(this._rangeFactorStart=0,this._rangeFactorEnd=a):n?this._rangeFactorStart=this._rangeFactorEnd-a:i?this._rangeFactorEnd=this._rangeFactorStart+a:(this._rangeFactorStart=1-a,this._rangeFactorEnd=1)}else this._rangeFactorStart=0,this._rangeFactorEnd=a,this._wholeRange=[t[0],t[0]+s];return this._wholeRange}var i,n,o,r;return super._calculateWholeRange(t)}calculateWholeRangeSize(){const t=this._calculateWholeRange(this._range);return Math.abs(t[1]-t[0])}calculateVisibleDomain(t){const e=this._domain;if(VH(this._rangeFactorStart)&&VH(this._rangeFactorEnd)&&e.length){const i=this._getInvertIndex(t[0]),n=this._getInvertIndex(t[1]);return e.slice(Math.min(i,n),Math.max(i,n)+1)}return e}domain(t,e){return t?(super.domain(t),this.rescale(e)):super.domain()}range(t,e){return t?(this._range=[rO(t[0]),rO(t[1])],this.rescale(e)):this._range}rangeRound(t,e){return this._range=[rO(t[0]),rO(t[1])],this._round=!0,this.rescale(e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return-1===t?e:SI(0,e.length-1,t,!1).map((t=>e[t]))}tickData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this.ticks(t).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])})))}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return SI(0,e.length-1,t,!0).filter((t=>t<e.length)).map((t=>e[t]))}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){let n;if(i=bO(1,(e=Math.floor(+e))-(t=Math.floor(+t))+1)(Math.floor(+i)),n=e<t){const i=t;t=e,e=i}return _I(t,e,i,n)}(0,e.length-1,t).map((t=>e[t]))}_getInvertIndex(t){let e=0;const i=this.step()/2,n=this.bandwidth()/2,o=this._domain.length,r=this.range(),s=r[0]>r[r.length-1];for(e=0;e<o;e++){const r=this.scale(this._domain[e])+n;if(0===e&&(!s&&!gO(t,r+i)||s&&!pO(t,r-i)))break;if(e===o-1)break;if(!pO(t,r-i)&&!gO(t,r+i))break}return e>=0&&e<=o-1?e:o-1}invert(t){return this._domain[this._getInvertIndex(t)]}padding(t,e){return void 0!==t?(this._paddingOuter=Math.max(0,Math.min(Array.isArray(t)?Math.min.apply(null,t):t)),this._paddingInner=this._paddingOuter,this.rescale(e)):this._paddingInner}paddingInner(t,e){return void 0!==t?(this._paddingInner=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingInner}paddingOuter(t,e){return void 0!==t?(this._paddingOuter=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingOuter}step(){return this._step}round(t,e){return void 0!==t?(this._round=t,this.rescale(e)):this._round}align(t,e){return void 0!==t?(this._align=Math.max(0,Math.min(1,t)),this.rescale(e)):this._align}rangeFactor(t,e){return t?(super.rangeFactor(t),this.rescale(e)):super.rangeFactor()}rangeFactorStart(t,e){return jH(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this.rescale(e,"rangeFactorStart"))}rangeFactorEnd(t,e){return jH(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this.rescale(e,"rangeFactorEnd"))}bandwidth(t,e){return t?("auto"===t?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=t,this._isFixed=!0),this._userBandwidth=t,this.rescale(e)):this._bandwidth}maxBandwidth(t,e){return t?(this._maxBandwidth="auto"===t?void 0:t,this.rescale(e)):this._maxBandwidth}minBandwidth(t,e){return t?(this._minBandwidth="auto"===t?void 0:t,this.rescale(e)):this._minBandwidth}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&ZH(this._userBandwidth)}clone(){var t,e,i;return new AI(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth(null!==(t=this._userBandwidth)&&void 0!==t?t:"auto",!0).maxBandwidth(null!==(e=this._maxBandwidth)&&void 0!==e?e:"auto",!0).minBandwidth(null!==(i=this._maxBandwidth)&&void 0!==i?i:"auto")}}const{interpolateRgb:BI}=PO;function TI(t,e){const i=typeof e;let n;if(jH(e)||"boolean"===i)return()=>e;if("number"===i)return mO(t,e);if("string"===i){if(n=MO.parseColorString(e)){const e=BI(MO.parseColorString(t),n);return t=>e(t).formatRgb()}return mO(Number(t),Number(e))}return e instanceof LO?BI(t,e):e instanceof MO?BI(t.color,e.color):e instanceof Date?function(t,e){const i=t.valueOf(),n=e.valueOf(),o=new Date;return t=>(o.setTime(i*(1-t)+n*t),o)}(t,e):mO(Number(t),Number(e))}class RI extends CI{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sI,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sI;super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=sI,this._piecewise=fI,this._interpolate=TI}calculateVisibleDomain(t){var e;return VH(this._rangeFactorStart)&&VH(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:null!==(e=this._niceDomain)&&void 0!==e?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),mO)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return(null!==(i=this._niceDomain)&&void 0!==i?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const n=Array.from(t,rO);return this._domain=n,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=yO,this.rescale(e)}rescale(t){var e;if(t)return this;const i=null!==(e=this._niceDomain)&&void 0!==e?e:this._domain,n=i.length,o=this._range.length;let r=Math.min(n,o);if(n&&n<o&&this._forceAlign){const t=o-n+1,e=i[n-1],s=n>=2?(e-i[n-2])/t:0;for(let o=1;o<=t;o++)i[n-2+o]=e-s*(t-o);r=o}return this._autoClamp&&(this._clamp=bO(i[0],i[r-1])),this._piecewise=r>2?mI:fI,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:sI),this.rescale(i)):this._clamp!==sI}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(){return[]}tickData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.ticks(t);return(null!=e?e:[]).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0])/(this._range[1]-this._range[0])})))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return jH(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return jH(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}}const kI=Math.sqrt(50),MI=Math.sqrt(10),LI=Math.sqrt(2),PI=[1,2,5,10],EI=(t,e,i)=>{let n=1,o=t;const r=Math.floor((e-1)/2),s=Math.abs(t);return t>=0&&t<=Number.MIN_VALUE?o=0:t<0&&t>=-Number.MIN_VALUE?o=-(e-1):!i&&s<1?n=FI(s).step:(i||s>1)&&(o=Math.floor(t)-r*n),n>0?(t>0?o=Math.max(o,0):t<0&&(o=Math.min(o,-(e-1)*n)),function(t,e,i){VH(e)||(e=t,t=0),VH(i)||(i=1);let n=-1;const o=0|Math.max(0,Math.ceil((e-t)/i)),r=new Array(o);for(;++n<o;)r[n]=t+n*i;return r}(0,e).map((t=>o+t*n))):t>0?OI(0,-(e-1)/n,n):OI((e-1)/n,0,n)},HI=fO(((t,e,i,n)=>{let o,r,s,a,l=-1;if(i=+i,(t=+t)==(e=+e))return[t];if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return[t];if((o=e<t)&&(r=t,t=e,e=r),a=zI(t,e,i).step,!isFinite(a))return[];if(a>0){let i=Math.round(t/a),n=Math.round(e/a);for(i*a<t&&++i,n*a>e&&--n,s=new Array(r=n-i+1);++l<r;)s[l]=(i+l)*a}else if(a<0&&(null==n?void 0:n.noDecimals)){a=1;const i=Math.ceil(t),n=Math.floor(e);if(!(i<=n))return[];for(s=new Array(r=n-i+1);++l<r;)s[l]=i+l}else{a=-a;let i=Math.round(t*a),n=Math.round(e*a);for(i/a<t&&++i,n/a>e&&--n,s=new Array(r=n-i+1);++l<r;)s[l]=(i+l)/a}return o&&s.reverse(),s})),OI=(t,e,i)=>{let n,o,r=-1;if(i>0){let s=Math.floor(t/i),a=Math.ceil(e/i);for((s+1)*i<t&&++s,(a-1)*i>e&&--a,o=new Array(n=a-s+1);++r<n;)o[r]=(s+r)*i}else{i=-i;let s=Math.floor(t*i),a=Math.ceil(e*i);for((s+1)/i<t&&++s,(a-1)/i>e&&--a,o=new Array(n=a-s+1);++r<n;)o[r]=(s+r)/i}return o},II=fO(((t,e,i,n)=>{let o,r,s;if(i=+i,(t=+t)==(e=+e))return EI(t,i,null==n?void 0:n.noDecimals);if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return EI(t,i,null==n?void 0:n.noDecimals);(o=e<t)&&(s=t,t=e,e=s);const a=zI(t,e,i);let l=a.step;if(!isFinite(l))return[];if(l>0){let n=1;const{power:o,gap:s}=a,h=10===s?2*10**o:1*10**o;for(;n<=5&&(r=OI(t,e,l),r.length>i+1)&&i>2;)l+=h,n+=1;i>2&&r.length<i-1&&(r=((t,e,i)=>{let n;const o=t[0],r=t[t.length-1],s=e-t.length;if(r<=0){const e=[];for(n=s;n>=1;n--)e.push(o-n*i);return e.concat(t)}if(o>=0){for(n=1;n<=s;n++)t.push(r+n*i);return t}let a=[];const l=[];for(n=1;n<=s;n++)n%2==0?a=[o-Math.floor(n/2)*i].concat(a):l.push(r+Math.ceil(n/2)*i);return a.concat(t).concat(l)})(r,i,l))}else(null==n?void 0:n.noDecimals)&&l<0&&(l=1),r=OI(t,e,l);return o&&r.reverse(),r})),FI=t=>{const e=Math.floor(Math.log(t)/Math.LN10),i=t/10**e;let n=PI[0];return i>=kI?n=PI[3]:i>=MI?n=PI[2]:i>=LI&&(n=PI[1]),e>=0?{step:n*10**e,gap:n,power:e}:{step:-(10**-e)/n,gap:n,power:e}};function zI(t,e,i){const n=(e-t)/Math.max(0,i);return FI(n)}function DI(t,e,i){let n;if(i=+i,(t=+t)==(e=+e)&&i>0)return[t];if(i<=0||0===(n=function(t,e,i){return(e-t)/Math.max(1,i-1)}(t,e,i))||!isFinite(n))return[];const o=new Array(i);for(let e=0;e<i;e++)o[e]=t+e*n;return o}function WI(t){let e,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,o=0,r=t.length-1,s=t[o],a=t[r],l=10;for(a<s&&(i=s,s=a,a=i,i=o,o=r,r=i);l-- >0;){if(i=zI(s,a,n).step,i===e)return t[o]=s,t[r]=a,t;if(i>0)s=Math.floor(s/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;s=Math.ceil(s*i)/i,a=Math.floor(a*i)/i}e=i}}function NI(t,e){const i=ZH(e.forceMin),n=ZH(e.forceMax);let o=null;const r=[];let s=null;const a=i&&n?t=>t>=e.forceMin&&t<=e.forceMax:i?t=>t>=e.forceMin:n?t=>t<=e.forceMax:null;return i?r[0]=e.forceMin:ZH(e.min)&&e.min<=Math.min(t[0],t[t.length-1])&&(r[0]=e.min),n?r[1]=e.forceMax:ZH(e.max)&&e.max>=Math.max(t[0],t[t.length-1])&&(r[1]=e.max),ZH(r[0])&&ZH(r[1])?(s=t.slice(),s[0]=r[0],s[s.length-1]=r[1]):o=ZH(r[0])||ZH(r[1])?ZH(r[0])?"max":"min":"all",{niceType:o,niceDomain:s,niceMinMax:r,domainValidator:a}}const GI=(t,e,i)=>Math.abs(e-t)<1?+i.toFixed(1):Math.round(+i),jI=fO(((t,e,i,n,o,r,s)=>{let a=t,l=e;const h=l<a;h&&([a,l]=[l,a]);let d,c,u=o(a),g=o(l),p=[];if(!(n%1)&&g-u<i){if(u=Math.floor(u),g=Math.ceil(g),a>0){for(;u<=g;++u)for(d=1;d<n;++d)if(c=u<0?d/r(-u):d*r(u),!(c<a)){if(c>l)break;p.push(c)}}else for(;u<=g;++u)for(d=n-1;d>=1;--d)if(c=u>0?d/r(-u):d*r(u),!(c<a)){if(c>l)break;p.push(c)}2*p.length<i&&(p=II(a,l,i))}else p=II(u,g,Math.min(g-u,i)).map(r);return p=p.filter((t=>0!==t)),(null==s?void 0:s.noDecimals)&&(p=Array.from(new Set(p.map((t=>Math.floor(t)))))),h?p.reverse():p})),VI=fO(((t,e,i,n,o,r)=>{const s=[],a={},l=o(t),h=o(e);let d=[];if(Number.isInteger(n))d=II(l,h,i);else{const t=(h-l)/(i-1);for(let e=0;e<i;e++)d.push(l+e*t)}return d.forEach((i=>{const o=r(i),l=Number.isInteger(n)?GI(t,e,o):GI(t,e,yI(o)),h=GI(t,e,((t,e)=>{let i,n;return e[0]<e[1]?(i=e[0],n=e[1]):(i=e[1],n=e[0]),Math.min(Math.max(t,i),n)})(l,[t,e]));!a[h]&&!isNaN(h)&&d.length>1&&(a[h]=1,s.push(h))})),s})),UI=fO(((t,e,i,n,o)=>DI(n(t),n(e),i).map((t=>yI(o(t))))));class XI extends RI{constructor(){super(...arguments),this.type=rI.Linear}clone(){return(new XI).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.calculateVisibleDomain(this._range);return HI(i[0],i[i.length-1],t,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i;if(GH(null==e?void 0:e.customTicks))return e.customTicks(this,t);if(VH(this._rangeFactorStart)&&VH(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&2===this._range.length||!this._niceType)return this.d3Ticks(t,e);const n=null!==(i=this._niceDomain)&&void 0!==i?i:this._domain,o=this._domain,r=n[0],s=n[n.length-1];let a=II(o[0],o[o.length-1],t,e);if(!a.length)return a;if(this._domainValidator)a=a.filter(this._domainValidator);else if((a[0]!==r||a[a.length-1]!==s)&&this._niceType){const t=n.slice();if("all"===this._niceType?(t[0]=a[0],t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()):"min"===this._niceType&&a[0]!==r?(t[0]=a[0],this._niceDomain=t,this.rescale()):"max"===this._niceType&&a[a.length-1]!==s&&(t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()),"all"!==this._niceType){const e=Math.min(t[0],t[t.length-1]),i=Math.max(t[0],t[t.length-1]);a=a.filter((t=>t>=e&&t<=i))}}return a}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return DI(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){let n,o,r=-1;if(i=+i,(o=(e=+e)<(t=+t))&&(n=t,t=e,e=n),!isFinite(i)||e-t<=i)return[t];const s=Math.floor((e-t)/i+1),a=new Array(s);for(;++r<s;)a[r]=t+r*i;return o&&a.reverse(),a}(e[0],e[e.length-1],t)}nice(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i,n;const o=this._domain;let r=[];if(e){const t=NI(o,e);if(r=t.niceMinMax,this._domainValidator=t.domainValidator,this._niceType=t.niceType,t.niceDomain)return this._niceDomain=t.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const e=WI(o.slice(),t);"min"===this._niceType?e[e.length-1]=null!==(i=r[1])&&void 0!==i?i:e[e.length-1]:"max"===this._niceType&&(e[0]=null!==(n=r[0])&&void 0!==n?n:e[0]),this._niceDomain=e,this.rescale()}return this}niceMin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="min";const e=this._domain[this._domain.length-1],i=WI(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="max";const e=this._domain[0],i=WI(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}}class $I{nice(){let t=arguments.length>1?arguments[1]:void 0;var e,i,n,o;const r=this._domain;let s=[],a=null;if(t){const e=NI(r,t);if(s=e.niceMinMax,this._domainValidator=e.domainValidator,a=e.niceType,e.niceDomain)return this._niceDomain=e.niceDomain,this.rescale(),this}else a="all";if(a){const t=((t,e)=>{const i=t.slice();let n=0,o=i.length-1,r=i[n],s=i[o];return s<r&&([n,o]=[o,n],[r,s]=[s,r]),i[n]=e.floor(r),i[o]=e.ceil(s),i})(r.slice(),null!==(i=null===(e=this.getNiceConfig)||void 0===e?void 0:e.call(this))&&void 0!==i?i:{floor:t=>Math.floor(t),ceil:t=>Math.ceil(t)});return"min"===a?t[t.length-1]=null!==(n=s[1])&&void 0!==n?n:t[t.length-1]:"max"===a&&(t[0]=null!==(o=s[0])&&void 0!==o?o:t[0]),this._niceDomain=t,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}}function YI(t){return e=>-t(-e)}function KI(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.EPSILON;return e=>Math.max(e,t)}class qI extends RI{constructor(){super(cI(10),dI(10)),this.type=rI.Log,this._limit=KI(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return(new qI).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(t){var e;if(t)return this;super.rescale();const i=cI(this._base),n=dI(this._base);return(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain)[0]<0?(this._logs=YI(i),this._pows=YI(n),this._limit=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.EPSILON;return e=>Math.min(e,-t)}(),this.transformer=aI,this.untransformer=lI):(this._logs=i,this._pows=n,this._limit=KI(),this.transformer=this._logs,this.untransformer=n),this}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._limit(this._clamp(t))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(t,e){return arguments.length?(this._base=t,this.rescale(e)):this._base}tickFormat(){return sI}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.domain(),n=this._limit(i[0]),o=this._limit(i[i.length-1]);return jI(n,o,t,this._base,this.transformer,this.untransformer,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return VI(this._limit(e[0]),this._limit(e[e.length-1]),t,this._base,this.transformer,this.untransformer)}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return UI(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return UI(this._limit(e[0]),this._limit(e[e.length-1]),t,this.transformer,this.untransformer)}getNiceConfig(){return{floor:t=>this._pows(Math.floor(this._logs(this._limit(t)))),ceil:t=>Math.abs(t)>=1?Math.ceil(t):this._pows(Math.ceil(this._logs(this._limit(t))))}}}nO(qI,$I);class ZI extends XI{constructor(){super(uI(1),gI(1)),this.type=rI.Symlog,this._const=1}clone(){return(new ZI).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(t,e){return arguments.length?(this._const=t,this.transformer=uI(t),this.untransformer=gI(t),this.rescale(e)):this._const}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.domain(),n=i[0],o=i[i.length-1];return jI(n,o,t,this._const,this.transformer,this.untransformer,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return VI(e[0],e[e.length-1],t,this._const,this.transformer,this.untransformer)}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return UI(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return UI(e[0],e[e.length-1],t,this.transformer,this.untransformer)}}nO(ZI,$I);class JI{constructor(){this._scale=new AI,this._scales=[this._scale]}valueToPosition(t){return this._scale.scale(t)}getPosition(t){let e=0,i=this._scale;if(1===this._scales.length||1===t.length)e=this.valueToPosition(t[0]);else{const n=Math.min(t.length,this._scales.length);for(let i=0;i<n;i++)e+=this._scales[i].scale(t[i]);i=this._scales[n-1]}return{position:e,bandScale:i}}calcScales(t,e){var i,n;const{bandPadding:o,paddingInner:r,paddingOuter:s}=this,a=ZC(o),l=ZC(r),h=ZC(s);for(let d=0;d<this._scales.length;d++){const c=a?o[d]:o,u=l?r[d]:r,g=h?s[d]:s;this._scales[d].paddingInner(null!==(i=null!=u?u:c)&&void 0!==i?i:t,!0).paddingOuter(null!==(n=null!=g?g:c)&&void 0!==n?n:e)}}dataToPosition(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;if(0===t.length||0===this._scales.length)return 0;const{position:n,bandScale:o}=this.getPosition(t);return n+o.bandwidth()*(null!==(i=e.bandPosition)&&void 0!==i?i:.5)}updateScaleDomain(t){for(let e=0;e<this._scales.length;e++)this._scales[e].domain(t)}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}const QI=Math.sqrt(50),tF=Math.sqrt(10),eF=Math.sqrt(2);class iF{constructor(t){this._extend={},this.type=null!=t?t:"linear",this._scale="log"===t?new qI:"symlog"===t?new ZI:new XI,this._scales=[this._scale]}setExtraAttrFromSpec(t,e,i,n,o,r){this.nice=!1,this.zero=e,this.zero&&(i.min=Math.min(i.min,0),i.max=Math.max(i.max,0)),this.domain=i,this.expand=n,"log"===this.type?this._scale.base(null!=o?o:10):"symlog"===this.type&&this._scale.constant(null!=r?r:10)}transformScaleDomain(){"symlog"===this.type||"log"===this.type||this.setScaleNice()}setScaleNice(){"log"===this.type?this.setLogScaleNice():this.setLinearScaleNice()}setLogScaleNice(){var t,e,i,n,o,r;UC(null===(t=this.domain)||void 0===t?void 0:t.min)&&UC(null===(e=this.domain)||void 0===e?void 0:e.max)?this.nice&&this._scale.nice():XC(null===(i=this.domain)||void 0===i?void 0:i.min)&&UC(null===(n=this.domain)||void 0===n?void 0:n.max)?this.nice&&this._scale.niceMax():UC(null===(o=this.domain)||void 0===o?void 0:o.min)&&XC(null===(r=this.domain)||void 0===r?void 0:r.max)&&this.nice&&this._scale.niceMin()}setLinearScaleNice(){var t,e,i,n,o,r,s,a;let l=null!==(e=null!==(t=this.forceTickCount)&&void 0!==t?t:this.tickCount)&&void 0!==e?e:10;"accurateFirst"===this.niceType&&(l=Math.max(10,l)),UC(null===(i=this.domain)||void 0===i?void 0:i.min)&&UC(null===(n=this.domain)||void 0===n?void 0:n.max)?this.nice&&this._scale.nice(l):XC(null===(o=this.domain)||void 0===o?void 0:o.min)&&UC(null===(r=this.domain)||void 0===r?void 0:r.max)?this.nice&&this._scale.niceMax(l):UC(null===(s=this.domain)||void 0===s?void 0:s.min)&&XC(null===(a=this.domain)||void 0===a?void 0:a.max)?this.nice&&this._scale.niceMin(l):this.nice&&this._scale.nice(l)}dataToPosition(t){return this.valueToPosition(t[0])}valueToPosition(t){return this._scale.scale(t)}computeLinearDomain(t){const e=[];return t.forEach((t=>{const{min:i,max:n}=t;e[0]=void 0===e[0]?i:Math.min(e[0],i),e[1]=void 0===e[1]?n:Math.max(e[1],n)})),this.expandDomain(e),this.includeZero(e),this.setDomainMinMax(e),e}expandDomain(t){if(!this.expand)return;const e=t[0],i=t[t.length-1];XC(this.expand.min)&&(t[0]=e-(i-e)*this.expand.min),XC(this.expand.max)&&(t[t.length-1]=i+(i-e)*this.expand.max)}niceDomain(t){if(XC(t[0])||XC(t[1])||"linear"!==this.type)return t;if(Math.abs(((t,e)=>{var i;if(0===t.length)return;let n=t[0];for(let o=1;o<t.length;o++){const r=t[o];(null!==(i=null==e?void 0:e(r,n))&&void 0!==i?i:r-n)<0&&(n=r)}return n})(t)-((t,e)=>{var i;if(0===t.length)return;let n=t[0];for(let o=1;o<t.length;o++){const r=t[o];(null!==(i=null==e?void 0:e(r,n))&&void 0!==i?i:r-n)>0&&(n=r)}return n})(t))<=1e-12){let e=t[0];const i=e>=0?1:-1;if(e=Math.abs(e),e<1)t[0]=0,t[1]=1;else{let i=e/5;const n=Math.floor(Math.log(i)/Math.LN10),o=i/Math.pow(10,n);i=(o>=QI?10:o>=tF?5:o>=eF?2:1)*Math.pow(10,n),t[0]=0,t[1]=10*i}i<0&&(t.reverse(),t[0]*=-1,t[1]*=-1)}return t}niceMinMax(){var t,e,i,n,o,r,s,a;if(this.nice){let l=null!==(e=null!==(t=this.forceTickCount)&&void 0!==t?t:this.tickCount)&&void 0!==e?e:10;"accurateFirst"===this.niceType&&(l=Math.max(10,l)),UC(null===(i=this.domain)||void 0===i?void 0:i.min)&&UC(null===(n=this.domain)||void 0===n?void 0:n.max)?this._scale.nice(l):XC(null===(o=this.domain)||void 0===o?void 0:o.min)&&UC(null===(r=this.domain)||void 0===r?void 0:r.max)?this._scale.niceMax(l):UC(null===(s=this.domain)||void 0===s?void 0:s.min)&&XC(null===(a=this.domain)||void 0===a?void 0:a.max)?this._scale.niceMin(l):this._scale.nice(l)}}includeZero(t){this.zero&&(t[0]=Math.min(t[0],0),t[t.length-1]=Math.max(t[t.length-1],0))}setExtendDomain(t,e){if(void 0===e)return void delete this._extend[t];this._extend[t]=e;const i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this.nice),this.niceMinMax()}extendDomain(t){let e;const i=t.length-1,n=t[0]-t[i]>0,o=n?i:0,r=n?0:i;for(const i in this._extend)e=this._extend[i],e>t[r]&&(t[r]=e),e<t[o]&&(t[o]=e)}setDomainMinMax(t){if(!this.domain)return;const{min:e,max:i}=this.domain;XC(e)&&(t[0]=e),XC(i)&&(t[1]=i)}setZero(t){this.zero!==t&&(this.zero=t,this.updateScaleDomain())}updateScaleDomain(){const t=this.computeDomain([this.domain]);this.updateScaleDomainByModel(t)}computeDomain(t){return this.computeLinearDomain(t)}updateScaleDomainByModel(t){t=null!=t?t:this._scale.domain(),this.extendDomain(t),this.includeZero(t),this.setDomainMinMax(t),this.niceDomain(t),this._scale.domain(t,this.nice),this.niceMinMax()}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}function nF(t,e){const{width:i,height:n}=e.getLayoutRect(),o=oI(e.orient),r=!0===e.option.inverse,s=t[0],a=function(t){if(JC(t))return t[t.length-1]}(t);if(o)if(r){const t=i,e=0,n=s.AABBBounds.x2,o=a.AABBBounds.x1;n>t&&s.setAttributes({x:t,textAlign:"right"}),o<e&&a.setAttributes({x:e,textAlign:"left"})}else{const t=0,e=i,n=s.AABBBounds.x1,o=a.AABBBounds.x2;n<t&&s.setAttributes({x:t,textAlign:"left"}),o>e&&a.setAttributes({x:e,textAlign:"right"})}else if(r){const t=s.AABBBounds.y1,e=a.AABBBounds.y2,i=0,o=n;t<i&&s.setAttributes({y:i,textBaseline:"top"}),e>o&&a.setAttributes({y:o,textBaseline:"bottom"})}else{const t=n,e=0,i=s.AABBBounds.y2,o=a.AABBBounds.y1;i>t&&s.setAttributes({y:t,textBaseline:"bottom"}),o<e&&a.setAttributes({y:e,textBaseline:"top"})}}function oF(t,e){var i;const n=e.option;sw(t)||(null===(i=null==n?void 0:n.label)||void 0===i?void 0:i.flush)&&nF(t,e)}const rF=t=>t;class sF{constructor(t,e,i,n,o){var r,s,a;if(this.x=0,this.y=0,this.padding=n,this.table=o,this.orient=null!==(r=t.orient)&&void 0!==r?r:"left",this.type=null!==(s=t.type)&&void 0!==s?s:"band",this.option=uw({},function(t){var e,i;return(null===(i=null===(e=null==t?void 0:t.colorScheme)||void 0===e?void 0:e.default)||void 0===i?void 0:i.palette)?uw({},KO,{tick:{style:{stroke:t.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},subTick:{style:{stroke:t.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},label:{style:{fill:t.colorScheme.default.palette.axisLabelFontColor||"#89909D"}},title:{style:{fill:t.colorScheme.default.palette.secondaryFontColor||"#333333"}}}):KO}(t.__vtableChartTheme),function(t,e){let i;return"left"===t?i=e.axisStyle.leftAxisStyle:"right"===t?i=e.axisStyle.rightAxisStyle:"top"===t?i=e.axisStyle.topAxisStyle:"bottom"===t&&(i=e.axisStyle.bottomAxisStyle),uw({},e.axisStyle.defaultAxisStyle,i)}(this.orient,o.theme),function(t,e,i){if(!i)return{};const n=i.axis;let o,r;return"linear"===e||"log"===e||"symlog"===e?o=i.axisLinear:"band"===e&&(o=i.axisBand),"top"===t||"bottom"===t?r=i.axisX:"left"!==t&&"right"!==t||(r=i.axisY),uw({},n,o,r)}(this.orient,this.type,t.__vtableChartTheme),t),"left"===this.orient||"right"===this.orient){const t=0,o=0;this.width=e,this.height=i-n[0]-n[2]-o,this.y=n[0]+t}else if("top"===this.orient||"bottom"===this.orient){const t=0,o=0;this.width=e-n[1]-n[3]-o,this.height=i,this.x=n[3]+t}this.visible=null===(a=t.visible)||void 0===a||a,this.inverse="inverse"in t&&!!t.inverse,"band"===t.type&&(this.data=t.domain),this.initScale(),this.initData(),this.createComponent(),this.initEvent()}initScale(){const t=this.option;"band"===this.type||"point"===this.type?(this.scale=new JI,this.scale.bandPadding=t.bandPadding,this.scale.paddingInner=t.paddingInner,this.scale.paddingOuter=t.paddingOuter,this.scale.calcScales(.1,.3),this.scale.updateScaleDomain(this.data),this.updateScaleRange()):"linear"!==this.type&&"time"!==this.type&&"log"!==this.type&&"symlog"!==this.type||(this.scale=new iF(this.type),this.scale.setExtraAttrFromSpec(t.nice,t.zero,t.range,t.expand,t.base,t.constant),this.scale.transformScaleDomain(),this.scale.updateScaleDomain(),this.updateScaleRange())}initData(){var t,e,i;this.table._vDataSet||(this.table._vDataSet=new IO),function(t,e,i){t.getParser(e)||t.registerParser(e,i)}(this.table._vDataSet,"scale",rF),t=this.table._vDataSet,e="ticks",i=Xy,t.getTransform(e)||t.registerTransform(e,i);const n=this.option.label||{},o=this.option.tick||{},r=new zO(this.table._vDataSet).parse(this.scale._scale,{type:"scale"}).transform({type:"ticks",options:{sampling:!1!==this.option.sampling,tickCount:o.tickCount,forceTickCount:o.forceTickCount,tickStep:o.tickStep,tickMode:o.tickMode,noDecimals:o.noDecimals,axisOrientType:this.orient,coordinateType:"cartesian",labelStyle:n.style,labelFormatter:n.formatMethod,labelGap:n.minGap,labelLastVisible:n.lastVisible,labelFlush:n.flush}},!1);this.tickData=r,this.computeData()}computeData(){this.tickData.reRunAllTransform()}initEvent(){}createComponent(){const t=qO(this.option),e=this.getUpdateAttribute();e.verticalFactor="top"===this.orient||"right"===this.orient?-1:1,this.component=new hy(uw({disableTriggerEvent:this.table.options.disableInteraction},t,e)),this.component.setAttributes(this.setLayoutStartPosition({x:this.x,y:this.y})),this.component.originAxis=this}resize(t,e){this.width=t-("top"===this.orient||"bottom"===this.orient?this.padding[1]+this.padding[3]:0),this.height=e-("left"===this.orient||"right"===this.orient?this.padding[2]+this.padding[0]:0),this.updateScaleRange(),this.computeData();const i=qO(this.option),n=this.getUpdateAttribute();n.verticalFactor="top"===this.orient||"right"===this.orient?-1:1,this.component.setAttributes(uw({},i,n)),this.component.setAttributes(this.setLayoutStartPosition({x:this.x,y:this.y})),this.overlap()}overlap(){!function(t,e){const i=t.find((t=>"axis-label-container-layer-0"===t.name),!0),n=t.find((t=>"axis-label-container-layer-1"===t.name),!0);oF(i?i.getChildren():[],e),oF(n?n.getChildren():[],e)}(this.component,this)}getLayoutRect(){return{width:this.width,height:this.height}}getUpdateAttribute(){this.table.tableNoFrameHeight,this.table.tableNoFrameWidth;const{width:t,height:e}=this.getLayoutRect(),i=oI(this.orient),n="left"===(o=this.orient)||"right"===o;var o;let r={x:0,y:0},s=0;i?(r={x:t,y:0},s=t):n&&(r={x:0,y:e},s=e);const a="top"===this.orient||"bottom"===this.orient?e:t;return{start:{x:0,y:0},end:r,title:{text:this.option.title.text,maxWidth:this._getTitleLimit(i)},items:this.getLabelItems(s),verticalLimitSize:a,verticalMinSize:a}}getLabelItems(t){return[this.tickData.latestData.map((e=>({id:e.value,label:e.value,value:0===t?0:this.scale.dataToPosition([e.value])/t,rawValue:e.value}))).filter((t=>t.value>=0&&t.value<=1))]}updateScaleRange(){var t,e,i,n,o,r,s,a;const l=null!==(e=null===(t=this.option.innerOffset)||void 0===t?void 0:t.right)&&void 0!==e?e:0,h=null!==(n=null===(i=this.option.innerOffset)||void 0===i?void 0:i.left)&&void 0!==n?n:0,d=null!==(r=null===(o=this.option.innerOffset)||void 0===o?void 0:o.top)&&void 0!==r?r:0,c=null!==(a=null===(s=this.option.innerOffset)||void 0===s?void 0:s.bottom)&&void 0!==a?a:0,{width:u,height:g}=this.getLayoutRect(),p=this.option.inverse||!1;let f=[0,0];oI(this.orient)?ew(u)&&(f=p?[u-l,h]:[h,u-l]):ew(g)&&(f=p?[d,g-c]:[g-c,d]),this.scale.updateRange(f)}setLayoutStartPosition(t){let{x:e,y:i}=t;return ew(e)&&(e+=Number("left"===this.orient)*this.getLayoutRect().width),ew(i)&&(i+=Number("top"===this.orient)*this.getLayoutRect().height),{x:e,y:i}}_getTitleLimit(t){var e,i,n;if(this.option.title.visible&&UC(null===(e=this.option.title.style)||void 0===e?void 0:e.maxLineWidth)){let e=(null===(i=this.option.title.style)||void 0===i?void 0:i.angle)||0;if((null===(n=this.option.title)||void 0===n?void 0:n.autoRotate)&&UC(this.option.title.angle)&&(e="left"===this.option.orient?-90:90),t){const t=this.getLayoutRect().width,i=Math.abs(Math.cos(vw(e)));return i<1e-6?1/0:t/i}const o=this.getLayoutRect().height,r=Math.abs(Math.sin(vw(e)));return r<1e-6?1/0:o/r}return null}getScale(){return this.scale._scale}getDomainSpec(){return this.scale.domain}}function aF(t,e){var i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y;const C=uw({},KO,t);let w=0;!1!==C.tick.visible&&(w=null!==(i=C.tick.width)&&void 0!==i?i:4);let x=0;if(C.label.visible){if("band"===C.type)C.domain.forEach((t=>{var i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b;C.label.formatMethod&&(t=C.label.formatMethod(t));const{width:m,height:y}=e.measureText(t,{fontSize:null!==(o=null===(n=null===(i=C.label)||void 0===i?void 0:i.style)||void 0===n?void 0:n.fontSize)&&void 0!==o?o:XO,fontWeight:null!==(a=null===(s=null===(r=C.label)||void 0===r?void 0:r.style)||void 0===s?void 0:s.fontWeight)&&void 0!==a?a:"normal",fontFamily:null!==(d=null===(h=null===(l=C.label)||void 0===l?void 0:l.style)||void 0===h?void 0:h.fontFamily)&&void 0!==d?d:UO}),w=(null===(u=null===(c=C.label)||void 0===c?void 0:c.style)||void 0===u?void 0:u.maxLineWidth)||1/0,_=(null!==(f=null===(p=null===(g=C.label)||void 0===g?void 0:g.style)||void 0===p?void 0:p.angle)&&void 0!==f?f:0)+("vertical"===(null===(b=null===(v=C.label)||void 0===v?void 0:v.style)||void 0===b?void 0:b.direction)?90:0);x=Math.max(x,dF(Math.min(m,w),y,_).width)}));else{let i;if((null===(n=t.sync)||void 0===n?void 0:n.tickAlign)&&VC(null===(o=t.tick)||void 0===o?void 0:o.tickMode))i=t.tick.tickMode();else if(ZC(t.__ticksForVTable))i=t.__ticksForVTable;else{const t=C.range,e=Math.abs(t.min)>1?Math.round(t.min):t.min,n=Math.abs(t.max)>1?Math.round(t.max):t.max;i=[hF(e),hF(n)]}i.forEach((t=>{var i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b;C.label.formatMethod&&(t=C.label.formatMethod(t));const{width:m,height:y}=e.measureText(t,{fontSize:null!==(o=null===(n=null===(i=C.label)||void 0===i?void 0:i.style)||void 0===n?void 0:n.fontSize)&&void 0!==o?o:XO,fontWeight:null!==(a=null===(s=null===(r=C.label)||void 0===r?void 0:r.style)||void 0===s?void 0:s.fontWeight)&&void 0!==a?a:"normal",fontFamily:null!==(d=null===(h=null===(l=C.label)||void 0===l?void 0:l.style)||void 0===h?void 0:h.fontFamily)&&void 0!==d?d:UO}),w=(null===(u=null===(c=C.label)||void 0===c?void 0:c.style)||void 0===u?void 0:u.maxLineWidth)||1/0,_=(null!==(f=null===(p=null===(g=C.label)||void 0===g?void 0:g.style)||void 0===p?void 0:p.angle)&&void 0!==f?f:0)+("vertical"===(null===(b=null===(v=C.label)||void 0===v?void 0:v.style)||void 0===b?void 0:b.direction)?90:0);x=Math.max(x,dF(Math.min(m,w),y,_).width)}))}x+=null!==(r=C.label.space)&&void 0!==r?r:4}let _=0;if(C.title.visible&&qC(C.title.text)){const{width:i,height:n}=e.measureText(C.title.text,{fontSize:null!==(l=null===(a=null===(s=C.title)||void 0===s?void 0:s.style)||void 0===a?void 0:a.fontSize)&&void 0!==l?l:XO,fontWeight:null!==(c=null===(d=null===(h=C.title)||void 0===h?void 0:h.style)||void 0===d?void 0:d.fontWeight)&&void 0!==c?c:"normal",fontFamily:null!==(p=null===(g=null===(u=C.title)||void 0===u?void 0:u.style)||void 0===g?void 0:g.fontFamily)&&void 0!==p?p:UO}),o=(null===(v=null===(f=C.label)||void 0===f?void 0:f.style)||void 0===v?void 0:v.maxLineWidth)||1/0,r=dF(Math.min(i,o),n,null===(m=null===(b=C.title)||void 0===b?void 0:b.style)||void 0===m?void 0:m.angle);_="left"!==t.orient&&"right"!==t.orient||!C.title.autoRotate?r.width:r.height,_+=null!==(y=C.title.space)&&void 0!==y?y:4}return Math.ceil(w+x+_+1)}function lF(t,e){var i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y;const C=uw({},KO,t);let w=0;!1!==C.tick.visible&&(w=null!==(i=C.tick.width)&&void 0!==i?i:4);let x=0;if(C.label.visible){if("band"===C.type)C.domain.forEach((t=>{var i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b;C.label.formatMethod&&(t=C.label.formatMethod(t));const{width:m,height:y}=e.measureText(t,{fontSize:null!==(o=null===(n=null===(i=C.label)||void 0===i?void 0:i.style)||void 0===n?void 0:n.fontSize)&&void 0!==o?o:XO,fontWeight:null!==(a=null===(s=null===(r=C.label)||void 0===r?void 0:r.style)||void 0===s?void 0:s.fontWeight)&&void 0!==a?a:"normal",fontFamily:null!==(d=null===(h=null===(l=C.label)||void 0===l?void 0:l.style)||void 0===h?void 0:h.fontFamily)&&void 0!==d?d:UO}),w=(null===(u=null===(c=C.label)||void 0===c?void 0:c.style)||void 0===u?void 0:u.maxLineWidth)||1/0,_=(null!==(f=null===(p=null===(g=C.label)||void 0===g?void 0:g.style)||void 0===p?void 0:p.angle)&&void 0!==f?f:0)+("vertical"===(null===(b=null===(v=C.label)||void 0===v?void 0:v.style)||void 0===b?void 0:b.direction)?90:0);x=Math.max(x,dF(Math.min(m,w),y,_).height)}));else{let i;if((null===(n=t.sync)||void 0===n?void 0:n.tickAlign)&&VC(null===(o=t.tick)||void 0===o?void 0:o.tickMode))i=t.tick.tickMode();else if(ZC(t.__ticksForVTable))i=t.__ticksForVTable;else{const t=C.range,e=Math.abs(t.min)>1?Math.round(t.min):t.min,n=Math.abs(t.max)>1?Math.round(t.max):t.max;i=[hF(e),hF(n)]}i.forEach((t=>{var i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b;C.label.formatMethod&&(t=C.label.formatMethod(t));const{width:m,height:y}=e.measureText(t,{fontSize:null!==(o=null===(n=null===(i=C.label)||void 0===i?void 0:i.style)||void 0===n?void 0:n.fontSize)&&void 0!==o?o:XO,fontWeight:null!==(a=null===(s=null===(r=C.label)||void 0===r?void 0:r.style)||void 0===s?void 0:s.fontWeight)&&void 0!==a?a:"normal",fontFamily:null!==(d=null===(h=null===(l=C.label)||void 0===l?void 0:l.style)||void 0===h?void 0:h.fontFamily)&&void 0!==d?d:UO}),w=(null===(u=null===(c=C.label)||void 0===c?void 0:c.style)||void 0===u?void 0:u.maxLineWidth)||1/0,_=(null!==(f=null===(p=null===(g=C.label)||void 0===g?void 0:g.style)||void 0===p?void 0:p.angle)&&void 0!==f?f:0)+("vertical"===(null===(b=null===(v=C.label)||void 0===v?void 0:v.style)||void 0===b?void 0:b.direction)?90:0);x=Math.max(x,dF(Math.min(m,w),y,_).height)}))}x+=null!==(r=C.label.space)&&void 0!==r?r:4}let _=0;if(C.title.visible&&C.title.text){const{width:i,height:n}=e.measureText(C.title.text,{fontSize:null!==(l=null===(a=null===(s=C.title)||void 0===s?void 0:s.style)||void 0===a?void 0:a.fontSize)&&void 0!==l?l:XO,fontWeight:null!==(c=null===(d=null===(h=C.title)||void 0===h?void 0:h.style)||void 0===d?void 0:d.fontWeight)&&void 0!==c?c:"normal",fontFamily:null!==(p=null===(g=null===(u=C.title)||void 0===u?void 0:u.style)||void 0===g?void 0:g.fontFamily)&&void 0!==p?p:UO}),o=(null===(v=null===(f=C.label)||void 0===f?void 0:f.style)||void 0===v?void 0:v.maxLineWidth)||1/0,r=dF(Math.min(i,o),n,null===(m=null===(b=C.title)||void 0===b?void 0:b.style)||void 0===m?void 0:m.angle);_="bottom"!==t.orient&&"top"!==t.orient||!C.title.autoRotate?r.height:r.width,_+=null!==(y=C.title.space)&&void 0!==y?y:4}return w+x+_+1}function hF(t){return"number"!=typeof t&&(t=Number(t)),Number(t.toPrecision(1)).toString()}function dF(t,e){const i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)*Math.PI/180,n=-t/2,o=-e/2,r=t/2,s=-e/2,a=t/2,l=e/2,h=-t/2,d=e/2,c={x:n*Math.cos(i)-o*Math.sin(i),y:n*Math.sin(i)+o*Math.cos(i)},u={x:r*Math.cos(i)-s*Math.sin(i),y:r*Math.sin(i)+s*Math.cos(i)},g={x:a*Math.cos(i)-l*Math.sin(i),y:a*Math.sin(i)+l*Math.cos(i)},p={x:h*Math.cos(i)-d*Math.sin(i),y:h*Math.sin(i)+d*Math.cos(i)},f=Math.min(c.x,u.x,g.x,p.x),v=Math.max(c.x,u.x,g.x,p.x),b=Math.min(c.y,u.y,g.y,p.y);return{width:v-f,height:Math.max(c.y,u.y,g.y,p.y)-b}}class cF{constructor(t,e){this._emptyTipOption={spaceBetweenTextAndIcon:20,text:"no data",textStyle:{fontSize:14,color:"#000"},icon:{image:'<svg t="1716726614852" class="icon" viewBox="0 0 1194 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2621" width="200" height="200"><path d="M1038.694079 367.237067c13.265507 23.342857-16.633865-40.004445-63.05621-40.004446H219.018794c-26.558738 0-46.46393 13.334815-63.05621 40.004446S0.006238 607.277601 0.006238 650.608819V940.647979a82.351494 82.351494 0 0 0 82.961402 83.349526H1111.702885a82.337632 82.337632 0 0 0 82.975264-83.349526V650.608819c0-43.331218-155.970208-283.371753-155.970208-283.371752zM730.066575 667.284269a136.328386 136.328386 0 0 1-132.738243 133.33429 133.417459 133.417459 0 0 1-132.738243-133.33429v-6.681269a40.6698 40.6698 0 0 0-36.497473-26.66963H73.015044l119.458874-220.02445s23.231965-40.004445 53.103614-40.004446h713.481918c26.544876 0 29.871649 10.008042 46.436207 40.004446L1128.33675 633.947231H769.904682c-26.184476 0-39.838107 7.623855-39.838107 33.337038zM338.505391 210.559919l-89.601086-86.69016a22.178487 22.178487 0 0 1 0-33.26773 21.984425 21.984425 0 0 1 33.170699 0l89.601087 86.676299a22.317102 22.317102 0 0 1 0 33.26773 24.950798 24.950798 0 0 1-33.1707 0z m252.197118-40.059891a25.532983 25.532983 0 0 1-6.639685-16.633865l-3.326773-126.694606A28.263709 28.263709 0 0 1 603.995739 0.515788c13.251646-3.326773 23.204242 10.021904 26.544877 23.342858V153.866163a28.249847 28.249847 0 0 1-23.259688 26.66963c-6.611961-3.312911-13.279369-3.312911-16.578419-10.035765z m235.646421 33.337038a22.372548 22.372548 0 0 1 0-33.337038l86.288175-90.030795a22.039871 22.039871 0 0 1 33.170699 0 22.289379 22.289379 0 0 1 0 33.364761l-82.961401 90.003072a25.962691 25.962691 0 0 1-36.483611 0z" fill="#8a8a8a" p-id="2622"></path></svg>',width:100,height:100}},this.isReleased=!1,this.table=e,this._emptyTipOption=Object.assign(this._emptyTipOption,!0===t?{}:t),XC(this._emptyTipOption.displayMode)||(this.table.isListTable()?this._emptyTipOption.displayMode="basedOnTable":this._emptyTipOption.displayMode="basedOnContainer"),this._emptyTipComponent=this._createOrUpdateEmptyTipComponent(this._getEmptyTipAttrs())}_createOrUpdateEmptyTipComponent(t){if(this._emptyTipComponent)fw(t,this._cacheAttrs)||this._emptyTipComponent.setAttributes(t);else{const e=new mC(t);e.name="emptyTip",this.table.scenegraph.stage.defaultLayer.appendChild(e),this._emptyTipComponent=e,this.bindEvents()}return this._emptyTipComponent}bindEvents(){this._emptyTipComponent.on("click",(t=>{const e=new Cw;this._emptyTipComponent.forEachChildren((t=>{e.union(t.globalAABBBounds)})),e.contains(t.x,t.y)&&this.table.fireListeners("empty_tip_click",t)})),this._emptyTipComponent.on("dblclick",(t=>{const e=new Cw;this._emptyTipComponent.forEachChildren((t=>{e.union(t.globalAABBBounds)})),e.contains(t.x,t.y)&&this.table.fireListeners("empty_tip_dblclick",t)}))}resize(){var t;if(!this._emptyTipComponent)return;const{leftHeaderWidth:e,topHeaderHeight:i,width:n,height:o}=this.getWidthAndHeight();this._emptyTipComponent.setAttributes({spaceBetweenTextAndIcon:this._emptyTipOption.spaceBetweenTextAndIcon,x:this.table.tableX+e,y:this.table.tableY+i,width:n,height:o,text:Object.assign(Object.assign({text:this._emptyTipOption.text},this._emptyTipOption.textStyle),{fill:null===(t=this._emptyTipOption.textStyle)||void 0===t?void 0:t.color}),icon:Object.assign({},this._emptyTipOption.icon)})}release(){this._emptyTipComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._emptyTipComponent),this._emptyTipComponent=null,this.isReleased=!0}resetVisible(){(this.table.recordsCount&&0!==this.table.recordsCount||this.table.internalProps.layoutMap.rowCount!==this.table.internalProps.layoutMap.columnHeaderLevelCount)&&this.table.internalProps.layoutMap.colCount!==this.table.internalProps.layoutMap.rowHeaderLevelCount?this.table.scenegraph.stage.defaultLayer.children.includes(this._emptyTipComponent)&&this.table.scenegraph.stage.defaultLayer.removeChild(this._emptyTipComponent):this.table.scenegraph.stage.defaultLayer.children.includes(this._emptyTipComponent)||this.table.scenegraph.stage.defaultLayer.appendChild(this._emptyTipComponent)}getWidthAndHeight(){const t=this.table.transpose||!1===this.table.options.indicatorsAsCol?this.table.getFrozenColsWidth():0,e=!this.table.transpose||this.table.options.indicatorsAsCol?this.table.getFrozenRowsHeight():0;return{leftHeaderWidth:t,topHeaderHeight:e,width:("basedOnContainer"!==this._emptyTipOption.displayMode&&this.table.columnHeaderLevelCount>0&&this.table.colCount>this.table.rowHeaderLevelCount?this.table.getDrawRange().width:this.table.tableNoFrameWidth)-t-this.table.getTheme().scrollStyle.width,height:("basedOnContainer"!==this._emptyTipOption.displayMode&&this.table.rowHeaderLevelCount>0&&this.table.rowCount>this.table.columnHeaderLevelCount?this.table.getDrawRange().height:this.table.tableNoFrameHeight)-e-this.table.getTheme().scrollStyle.width}}_getEmptyTipAttrs(){var t;const{leftHeaderWidth:e,topHeaderHeight:i,width:n,height:o}=this.getWidthAndHeight();return{spaceBetweenTextAndIcon:this._emptyTipOption.spaceBetweenTextAndIcon,x:this.table.tableX+e,y:this.table.tableY+i,width:n,height:o,text:Object.assign(Object.assign({text:this._emptyTipOption.text},this._emptyTipOption.textStyle),{fill:null===(t=this._emptyTipOption.textStyle)||void 0===t?void 0:t.color}),icon:Object.assign({},this._emptyTipOption.icon)}}}var uF=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i};const gF={orient:"bottom",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fill:"#000000",fontWeight:"normal"},space:12},item:{visible:!0,spaceCol:10,spaceRow:10,padding:2,background:{state:{selectedHover:{fill:"gray",fillOpacity:.7},unSelectedHover:{fill:"gray",fillOpacity:.2}}},shape:{space:4,state:{unSelected:{fillOpacity:.5}}},label:{space:4,style:{fill:"#89909D",fontSize:14},state:{unSelected:{fillOpacity:.5}}}},allowAllCanceled:!0,visible:!0};class pF{constructor(t,e){var i,n,o,r;this.table=e,this.option=lw(t),this.orient=null!==(i=t.orient)&&void 0!==i?i:"left",this.visible=null===(n=t.visible)||void 0===n||n,this.position=null!==(o=t.position)&&void 0!==o?o:"middle",this.selectedData=null!==(r=t.defaultSelected)&&void 0!==r?r:null,this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),e=new aC(uw({},t,{defaultSelected:this.selectedData,disableTriggerEvent:this.table.options.disableInteraction}));e.name="legend",this.legendComponent=e,!1===this.visible&&(e.setAttributes({visible:!1,visibleAll:!1}),e.hideAll()),this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&!1!==this.visible&&(this.legendComponent.setAttributes({maxWidth:this.table.tableNoFrameWidth,maxHeight:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){var e,i;if(!this.legendComponent||!1===this.visible)return;let n=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,o=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(n<=0||o<=0)return;const r=this.table.tableNoFrameWidth,s=this.table.tableNoFrameHeight,a=UB(null!==(i=null!==(e=t.padding)&&void 0!==e?e:this.option.padding)&&void 0!==i?i:10);let l=0,h=0;"left"===this.orient?(l=a[3],h=0,n+=a[1]+a[3]):"top"===this.orient?(l=0,h=a[0],o+=a[0]+a[2]):"right"===this.orient?(l=r-n-a[1],h=0,n+=a[1]+a[3]):"bottom"===this.orient&&(l=0,h=s-o-a[2],o+=a[0]+a[2]);const d="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",c=this.position;let u=0,g=0;"horizontal"===d?u="middle"===c?(r-n)/2:"end"===c?r-n-a[1]:a[3]:g="middle"===c?(s-o)/2:"end"===c?s-o-a[2]:a[0],this.legendComponent.setAttributes({dx:u,dy:g,x:l,y:h}),"left"===this.orient?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(n),this.table.tableX+=Math.ceil(n)):"top"===this.orient?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o),this.table.tableY+=Math.ceil(o)):"right"===this.orient?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(n):"bottom"===this.orient&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o))}getLegendAttributes(t){var e,i;const n="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",o=function(t,e){const i=uw({},gF,t),{title:n={},item:o={},pager:r={},background:s={},type:a,id:l,visible:h,orient:d,position:c,data:u,filter:g,regionId:p,regionIndex:f,seriesIndex:v,seriesId:b,padding:m}=i,y=uF(i,["title","item","pager","background","type","id","visible","orient","position","data","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return n.visible&&(y.title=WO(n)),sw(o.focusIconStyle)||NO(o.focusIconStyle),GO(o.shape),GO(o.label),GO(o.value),GO(o.background),_T(o.maxWidth)&&(o.maxWidth=Number(o.maxWidth.substring(0,o.maxWidth.length-1))*e.width/100),_T(o.width)&&(o.width=Number(o.width.substring(0,o.width.length-1))*e.width/100),_T(o.height)&&(o.height=Number(o.height.substring(0,o.height.length-1))*e.width/100),y.item=o,sw(r.textStyle)||NO(r.textStyle),GO(r.handler),y.pager=r,s.visible&&!sw(s.style)&&(uw(y,s.style),XC(s.padding)&&(y.padding=s.padding)),y}(this.option,t),r=UB(null!==(i=null!==(e=o.padding)&&void 0!==e?e:this.option.padding)&&void 0!==i?i:10);return Object.assign({layout:n,items:this.getLegendItems(),maxWidth:t.width-r[1]-r[3],maxHeight:t.height-r[0]-r[2]},o)}getLegendItems(){return this.option.data}initEvent(){this.legendComponent&&(this.legendComponent.addEventListener(tC.legendItemClick,(t=>{const e=aw(t,"detail.currentSelected");this.table.fireListeners(v_.LEGEND_ITEM_CLICK,{model:this,value:e,event:t})})),this.legendComponent.addEventListener(tC.legendItemHover,(t=>{const e=aw(t,"detail");this.table.fireListeners(v_.LEGEND_ITEM_HOVER,{model:this,value:e,event:t})})),this.legendComponent.addEventListener(tC.legendItemUnHover,(t=>{const e=aw(t,"detail");this.table.fireListeners(v_.LEGEND_ITEM_UNHOVER,{model:this,value:e,event:t})})),this.legendComponent.addEventListener("legendItemAttributeUpdate",(t=>{this.table.scenegraph.updateNextFrame()})))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}var fF=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i};const vF={orient:"right",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"titleFontColor"}},space:12},handler:{visible:!0},startText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},endText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},handlerText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}}},bF={horizontal:Object.assign(Object.assign({},vF),{rail:{width:200,height:8,style:{fill:"rgba(0,0,0,0.04)"}}}),vertical:Object.assign(Object.assign({},vF),{rail:{width:8,height:200,style:{fill:"rgba(0,0,0,0.04)"}}})},mF={horizontal:Object.assign({sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:200,height:4,style:{fill:"rgba(0,0,0,0.04)"}}},vF),vertical:Object.assign({sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:4,height:200,style:{fill:"rgba(0,0,0,0.04)"}}},vF)};class yF{constructor(t,e){var i,n,o,r;this.table=e,this.option=lw(t),this.orient=null!==(i=t.orient)&&void 0!==i?i:"left",this.visible=null===(n=t.visible)||void 0===n||n,this.position=null!==(o=t.position)&&void 0!==o?o:"middle",this.selectedData=null!==(r=t.defaultSelected)&&void 0!==r?r:null,this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight});let e;e="color"===this.option.type?new uC(uw({},t,{slidable:!0})):new pC(uw({},t,{slidable:!0})),e.name="legend",this.legendComponent=e,!1===this.visible&&(e.setAttributes({visible:!1,visibleAll:!1}),e.hideAll()),this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&!1!==this.visible&&(this.legendComponent.setAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){var e,i;if(!this.legendComponent||!1===this.visible)return;let n=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,o=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(n<=0||o<=0)return;const r=this.table.tableNoFrameWidth,s=this.table.tableNoFrameHeight,a=UB(null!==(i=null!==(e=t.padding)&&void 0!==e?e:this.option.padding)&&void 0!==i?i:10);let l=0,h=0;"left"===this.orient?(l=a[3],h=0,n+=a[1]+a[3]):"top"===this.orient?(l=0,h=a[0],o+=a[0]+a[2]):"right"===this.orient?(l=r-n-a[1],h=0,n+=a[1]+a[3]):"bottom"===this.orient&&(l=0,h=s-o-a[2],o+=a[0]+a[2]);const d="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",c=this.position;let u=0,g=0;"horizontal"===d?u="middle"===c?(r-n)/2:"end"===c?r-n-a[1]:a[3]:g="middle"===c?(s-o)/2:"end"===c?s-o-a[2]:a[0],this.legendComponent.setAttributes({dx:u,dy:g,x:l,y:h}),"left"===this.orient?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(n),this.table.tableX+=Math.ceil(n)):"top"===this.orient?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o),this.table.tableY+=Math.ceil(o)):"right"===this.orient?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(n):"bottom"===this.orient&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o))}getLegendAttributes(t){const e="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",i="horizontal"===e?"bottom":this.orient;return Object.assign(Object.assign({},function(t,e){const i=uw({},("color"===t.type?bF:mF)["bottom"===t.orient||"top"===t.orient?"horizontal":"vertical"],t),{title:n={},handler:o={},rail:r={},track:s={},startText:a,endText:l,handlerText:h,sizeBackground:d,background:c={},type:u,id:g,visible:p,orient:f,position:v,data:b,defaultSelected:m,field:y,filter:C,regionId:w,regionIndex:x,seriesIndex:_,seriesId:S,padding:A}=i,B=fF(i,["title","handler","rail","track","startText","endText","handlerText","sizeBackground","background","type","id","visible","orient","position","data","defaultSelected","field","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return n.visible&&(B.title=WO(n)),B.showHandler=!1!==o.visible,sw(o.style)||(B.handlerStyle=NO(o.style)),XC(r.width)&&(B.railWidth=r.width),XC(r.height)&&(B.railHeight=r.height),sw(r.style)||(B.railStyle=NO(r.style)),sw(s.style)||(B.trackStyle=NO(s.style)),B.startText=GO(a),B.endText=GO(l),B.handlerText=GO(h),sw(d)||(B.sizeBackground=NO(d)),c.visible&&!sw(c.style)&&(uw(B,c.style),XC(c.padding)&&(B.padding=c.padding)),B}(this.option)),{layout:e,align:i,min:this.option.min,max:this.option.max,value:this.option.value,["color"===this.option.type?"colors":"sizeRange"]:"color"===this.option.type?this.option.colors:this.option.sizeRange})}initEvent(){this.legendComponent&&this.legendComponent.addEventListener("change",(t=>{const e=aw(t,"detail.value");this.table.fireListeners(v_.LEGEND_CHANGE,{model:this,value:e,event:t}),this.table.scenegraph.updateNextFrame()}))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}function CF(t,e){return"color"===t.type||"size"===t.type?new yF(t,e):new pF(t,e)}class wF{constructor(t){this._table=t}release(){this.unbindMenuElement(),this._menuElement&&this._menuElement.release(),this._menuElement=void 0}_getMenuElement(){return this._menuElement||(this._menuElement=this.createMenuElementInternal()),this._menuElement}bindMenuElement(t,e,i){return this._getMenuElement().bindToCell(this._table,t,e,i)}unbindMenuElement(){this._getMenuElement().unbindFromCell()}pointInMenuElement(t,e){return this._getMenuElement().pointInMenuElement(t,e)}getRootElement(){return this._getMenuElement().rootElement}}const xF="vtable__menu-element",_F=`${xF}--hidden`,SF=`${xF}--shown`;class AF{constructor(t){var e,i,n;this._handler=new C_,this._rootElement=CE("div",[xF,_F]),this._rootElement.addEventListener("wheel",(t=>{t.stopPropagation()})),null===(e=this._rootElement)||void 0===e||e.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()})),null===(i=this._rootElement)||void 0===i||i.addEventListener("click",(e=>{if(e.stopPropagation(),e.preventDefault(),this._rootElement.classList.contains(_F))return;const{col:i,row:n,dropDownIndex:o,menuKey:r,text:s,hasChildren:a}=e.target;if("number"!=typeof o||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,n):t.getHeaderField(i,n),h=t._dropDownMenuIsHighlight(i,n,o);t.fireListeners(v_.DROPDOWN_MENU_CLICK,{col:i,row:n,field:l,menuKey:r,text:s,highlight:h,cellLocation:t.getCellLocation(i,n),event:e}),t.fireListeners(v_.DROPDOWN_MENU_CLEAR,null),t.fireListeners(v_.HIDE_MENU,null),e.stopPropagation()})),null===(n=this._rootElement)||void 0===n||n.addEventListener("mousemove",(t=>{this._rootElement.classList.contains(_F)||t.stopPropagation()}))}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;(null==t?void 0:t.parentElement)&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,n){const o=this._rootElement;if(this._menuInstanceInfo=n,null==o||o.classList.remove(SF),null==o||o.classList.add(_F),this._canBindToCell(t,e,i)){if(o.innerHTML="",o.appendChild(n.content),this._bindCell(t,e,i,n.position,n.referencePosition))return null==o||o.classList.add(SF),null==o||o.classList.remove(_F),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement;this._menuInstanceInfo=void 0,(null==t?void 0:t.parentElement)&&(t.classList.remove(SF),t.classList.add(_F))}_canBindToCell(t,e,i){var n;const o=t.getCellRangeRelativeRect({col:e,row:i}),r=null!==(n=t.internalProps.menu.parentElement)&&void 0!==n?n:t.getElement(),{top:s,bottom:a,left:l,right:h}=o;if(t.isFrozenCell(e,i))return!0;if(a<t.getFrozenRowsHeight()||h<t.getFrozenColsWidth()||l>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||s>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:d,offsetWidth:c}=r;return!(d<s||c<l)}_bindCell(t,e,i,n,o){var r;const s=this._rootElement,a=null!==(r=t.internalProps.menu.parentElement)&&void 0!==r?r:t.getElement(),{width:l,height:h,left:d,top:c}=a.getBoundingClientRect();if(s){s.parentElement!==a&&a.appendChild(s),s.style.left="0px";const e=.8*l;s.style.maxWidth=`${e}px`;const i=s.clientWidth,r=s.clientHeight;let u,g;n&&(u=n.x,g=n.y),o&&(u=o.rect.right-i,g=o.rect.bottom),g+r>h&&(g=h-r,u+=i-2),g<0&&(g/=2);let p=0,f=0;if(t.getElement()!==a){const{left:e,top:i}=t.getElement().getBoundingClientRect();p=i-c,f=e-d}return s.style.top=`${g+p}px`,u<0?u=0:u+i>l&&(u=l-i),s.style.left=`${u+f}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:n,y:o,width:r,height:s}=i.getBoundingClientRect();return t>n-5&&t<n+r+5&&e>o-5&&e<o+s+5}}class BF extends wF{createMenuElementInternal(){return new FE(this._table)}}let TF=class extends wF{createMenuElementInternal(){return new AF(this._table)}};const RF={"dropdown-menu":function(t){return new BF(t)},"context-menu":function(t){return new BF(t)},container:t=>new TF(t)};class kF{constructor(t){this._table=t,this._menuInstances={},this._bindTableEvent(t)}release(){const t=this._menuInstances;for(const e in t)t[e].release();delete this._menuInstances,this._attachInfo=null}_bindToCell(t,e,i,n){var o;const r=this._attachInfo,s=this._getMenuInstanceInfo(t,e,i,n);if(!r||s&&r.instance===s.instance||(null===(o=r.instance)||void 0===o||o.unbindMenuElement(),this._attachInfo=null),!s)return;const{instance:a,info:l}=s;if(a&&a.bindMenuElement(t,e,l)){const i=this._table.getCellRange(t,e);this._attachInfo={range:i,instance:a}}}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;null==e||e.unbindMenuElement(),this._attachInfo=null}_isBindToCell(t,e){const i=this._attachInfo;return!!i&&a_(i.range,t,e)}pointInMenuElement(t,e){if(!this._attachInfo)return!1;const i=this._attachInfo,{instance:n}=i;return n.pointInMenuElement(t,e)}_bindTableEvent(t){t.on(v_.DROPDOWN_ICON_CLICK,(t=>{this._attachInfo&&this._isBindToCell(t.col,t.row)?this._unbindFromCell():this._bindToCell(t.col,t.row,"dropdown-menu")})),t.on(v_.DROPDOWN_MENU_CLEAR,(t=>{this._unbindFromCell()})),t.on(v_.CONTEXTMENU_CELL,(e=>{var i,n,o,r;if("html"===(null===(i=t.internalProps.menu)||void 0===i?void 0:i.renderMode)){const i=t._getMouseAbstractPoint(e.event);let s=null;i.inTable&&"function"==typeof(null===(n=t.internalProps.menu)||void 0===n?void 0:n.contextMenuItems)?s=t.internalProps.menu.contextMenuItems(t.getHeaderField(e.col,e.row),e.row,e.col,t):i.inTable&&Array.isArray(null===(o=t.internalProps.menu)||void 0===o?void 0:o.contextMenuItems)&&(s=null===(r=t.internalProps.menu)||void 0===r?void 0:r.contextMenuItems),this._bindToCell(e.col,e.row,"context-menu",{content:s,position:{x:i.x,y:i.y}})}}))}_getMenuInstanceInfo(t,e,i,n){const o=this._table,r=this._menuInstances,s=function(t,e,i,n,o){var r,s;const{lineHeight:a,textBaseline:l,textStick:h}=t._getCellStyle(e,i);let d=t.getCellRangeRelativeRect(t.getCellRange(e,i));h&&(d=t.getVisibleCellRangeRelativeRect({col:e,row:i}));let{left:c,right:u,bottom:g,top:p,width:f,height:v}=d;if(t.isHeader(e,i)&&({left:c,right:u,bottom:g,top:p,width:f,height:v}=t.internalProps.headerHelper.getDropDownIconRect(d,a,l||"middle")),null==o?void 0:o.content)return{type:n,position:o.position,referencePosition:null!==(r=o.referencePosition)&&void 0!==r?r:{rect:{left:c,right:u,top:p,bottom:g,width:f,height:v}},content:o.content};if("dropdown-menu"===n){let o=t.globalDropDownMenu;const r=t._getHeaderLayoutMap(e,i);o=null!==(s=r.dropDownMenu)&&void 0!==s?s:o;const a=r.pivotInfo;return"function"==typeof o&&(o=o({row:i,col:e,table:t})),{type:n,referencePosition:{rect:{left:c,right:u,top:p,bottom:g,width:f,height:v}},content:o,pivotInfo:a}}return null}(o,t,e,i,n);return s?{instance:r&&r[i]||r&&(r[i]=RF[i](o)),type:i,info:s}:null}containElement(t){var e;for(const i in this._menuInstances)if(null===(e=this._menuInstances[i].getRootElement())||void 0===e?void 0:e.contains(t))return!0;return!1}}class MF{constructor(t,e){this.isReleased=!1,this.table=e,this._titleOption=uw({orient:"top"},t),!1!==t.visible&&(this._titleComponent=this._createOrUpdateTitleComponent(this._getTitleAttrs()))}_createOrUpdateTitleComponent(t){if(this._titleComponent)fw(t,this._cacheAttrs)||this._titleComponent.setAttributes(t);else{const e=new fC(t);e.name="title",this.table.scenegraph.stage.defaultLayer.appendChild(e),this._titleComponent=e}return this._adjustTableSize(this._titleComponent.attribute),this._titleComponent}resize(){var t,e,i,n,o;if(!this._titleComponent)return;const r=UB(null!==(t=this._titleOption.padding)&&void 0!==t?t:10),s=null!==(e=this._titleOption.width)&&void 0!==e?e:("adaptive"===this.table.widthMode?this.table.tableNoFrameWidth:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width))-r[1]-r[3],a=null!==(i=this._titleOption.height)&&void 0!==i?i:("adaptive"===this.table.heightMode?this.table.tableNoFrameHeight:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height))-r[0]-r[2];this._titleComponent.setAttributes({x:(null!==(n=this._titleOption.x)&&void 0!==n?n:"right"===this._titleOption.orient)?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:(null!==(o=this._titleOption.y)&&void 0!==o?o:"bottom"===this._titleOption.orient)?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:"top"===this._titleOption.orient||"bottom"===this._titleOption.orient?s:this._titleOption.width,height:"left"===this._titleOption.orient||"right"===this._titleOption.orient?a:this._titleOption.height,textStyle:Object.assign({width:s},this._titleOption.textStyle),subtextStyle:Object.assign({width:s},this._titleOption.subtextStyle)}),this._adjustTableSize(this._titleComponent.attribute)}_adjustTableSize(t){var e,i,n,o;const r=isFinite(null===(e=this._titleComponent)||void 0===e?void 0:e.AABBBounds.width())?this._titleComponent.AABBBounds.width():0,s=isFinite(null===(i=this._titleComponent)||void 0===i?void 0:i.AABBBounds.height())?this._titleComponent.AABBBounds.height():0;"left"===this._titleOption.orient?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r),this.table.tableX+=Math.ceil(r)):"top"===this._titleOption.orient?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(s),this.table.tableY+=Math.ceil(s)):"right"===this._titleOption.orient?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r):"bottom"===this._titleOption.orient&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(s)),this._cacheAttrs=t,"right"!==this._titleOption.orient&&"bottom"!==this._titleOption.orient||this._titleComponent.setAttributes({x:(null!==(n=this._titleOption.x)&&void 0!==n?n:"right"===this._titleOption.orient)?this.table.tableX+this.table.tableNoFrameWidth:this.table.tableX,y:(null!==(o=this._titleOption.y)&&void 0!==o?o:"bottom"===this._titleOption.orient)?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY})}release(){this._titleComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._titleComponent),this._titleComponent=null,this.isReleased=!0}_getTitleAttrs(){var t,e,i,n,o,r,s,a,l,h,d;const c=this._titleOption.text||this._titleOption.subtext?10:0,u=UB(null!==(t=this._titleOption.padding)&&void 0!==t?t:c),g=null!==(e=this._titleOption.width)&&void 0!==e?e:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width)-u[1]-u[3],p=null!==(i=this._titleOption.height)&&void 0!==i?i:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height)-u[0]-u[2];return{text:null!==(n=this._titleOption.text)&&void 0!==n?n:"",subtext:null!==(o=this._titleOption.subtext)&&void 0!==o?o:"",x:(null!==(r=this._titleOption.x)&&void 0!==r?r:"right"===this._titleOption.orient)?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:(null!==(s=this._titleOption.y)&&void 0!==s?s:"bottom"===this._titleOption.orient)?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:"top"===this._titleOption.orient||"bottom"===this._titleOption.orient?g:this._titleOption.width,height:"left"===this._titleOption.orient||"right"===this._titleOption.orient?p:this._titleOption.height,minWidth:this._titleOption.minWidth,maxWidth:this._titleOption.maxWidth,minHeight:this._titleOption.minHeight,maxHeight:this._titleOption.maxHeight,padding:this._titleOption.padding,align:null!==(a=this._titleOption.align)&&void 0!==a?a:"left",verticalAlign:null!==(l=this._titleOption.verticalAlign)&&void 0!==l?l:"top",textStyle:Object.assign({width:g},this._titleOption.textStyle),subtextStyle:Object.assign({width:g},this._titleOption.subtextStyle),dx:null!==(h=this._titleOption.dx)&&void 0!==h?h:0,dy:null!==(d=this._titleOption.dy)&&void 0!==d?d:0}}getComponentGraphic(){return this._titleComponent}}class LF{constructor(t){this._table=t}release(){var t,e;this.unbindTooltipElement(),this._tooltipElement&&(null===(e=(t=this._tooltipElement).release)||void 0===e||e.call(t)),this._tooltipElement=void 0}_getTooltipElement(){return this._tooltipElement||(this._tooltipElement=this.createTooltipElementInternal()),this._tooltipElement}bindTooltipElement(t,e,i,n){return this._getTooltipElement().bindToCell(this._table,t,e,i,n)}moveTooltipElement(t,e,i,n){this._getTooltipElement().move(this._table,t,e,i,n)}unbindTooltipElement(){this._getTooltipElement().unbindFromCell()}locateTooltipElement(t,e,i,n,o){this._getTooltipElement()._locate(this._table,t,e,i,n,o)}}!function(){if("node"===kx.mode)return;const t=document.createElement("style");t.id="vtable-tooltip-styleSheet",t.textContent="\n@keyframes vtable__bubble-tooltip-element--shown-animation {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n.vtable__bubble-tooltip-element {\n\tposition: absolute;\n\t\n\t// pointer-events: none;\n\t//user-select: none;\n\tmax-width: 300px;\n\tz-index: 99999;\n\n\tbackground: #FFFFFF;\n    border: 1px solid #E6E8ED;\n    box-sizing: border-box;\n    border-radius: 4px;\n    box-shadow: 0px 2px 4px rgb(27 31 35 / 8%);\n    color: #141414;\n    font-size: 13px;\n}\n.vtable__bubble-tooltip-element--hidden {\n\topacity: 0;\n  pointer-events: none;\n\tuser-select: none;\n\t/* transform: translate(-50%, -50%); */\n\ttransition: opacity 75ms linear;\n}\n.vtable__bubble-tooltip-element--shown {\n\topacity: 1;\n\t/* transform: translate(-50%, -50%); */\n\tanimation: vtable__bubble-tooltip-element--shown-animation 150ms ease-out;\n}\n.vtable__bubble-tooltip-element__content {\n\t/* font-size: .75rem; */\n\tpadding: 6px 8px;\n\tmin-height: 1em;\n\tline-height: 1.5;\n\twidth: 100%;\n\tdisplay: block;\n\twhite-space: pre-wrap;\n\tmargin: 0;\n\tbox-sizing: border-box;\n\toverflow: auto;\n\tword-wrap: break-word;\n\tposition: relative;\n\tbackground-color: #FFF;\n\tz-index: 2;\n\tborder-radius: 4px;\n}\n/*  WebKit Microsoft Edge（新版）： */\n.vtable__bubble-tooltip-element__content::-webkit-scrollbar {\n  width: 0;\n  height: 0;\n  background-color: transparent;\n}\n/*  Opera Firefox  */\n.vtable__bubble-tooltip-element__content > scrollbar-track {\n  width: 0;\n  height: 0;\n  background-color: transparent;\n}\n/* Internet Explorer 11 和 Microsoft Edge（旧版） */\n.vtable__bubble-tooltip-element__content > scrollbar {\n  width: 0;\n  height: 0;\n  background-color: transparent;\n}\n.vtable__bubble-tooltip-element__triangle {\n\t/* font-size: .75rem; */\n\tposition: absolute;\n\twidth: 10px;\n\theight: 10px;\n\tdisplay: block;\n\ttransform: rotate(45deg);\n    transform-origin: 50% 50% 0;\n\tz-index: 1;\n\tbackground-color: #FFF;\n\tborder: 1px solid #E6E8ED;\n}\n",document.head.appendChild(t)}();const PF="vtable__bubble-tooltip-element",EF=`${PF}__content`,HF=`${PF}__triangle`,OF=`${PF}--hidden`,IF=`${PF}--shown`;class FF{constructor(){this._handler=new C_;const t=this._rootElement=CE("div",[PF,OF]),e=CE("div",[EF]),i=CE("span",[HF]);t.appendChild(i),t.appendChild(e),this._messageElement=t.querySelector(`.${EF}`)||void 0,this._triangleElement=t.querySelector(`.${HF}`)||void 0,t.addEventListener("mousemove",(()=>{this._disappearDelayId&&clearTimeout(this._disappearDelayId)})),t.addEventListener("mouseleave",(()=>{this._disappearDelay=void 0,this.unbindFromCell()})),e.addEventListener("wheel",(t=>{t.stopPropagation()})),e.addEventListener("copy",(t=>{(function(t){const e=window.getSelection();if(e.rangeCount){const i=e.getRangeAt(0);return i.endOffset>i.startOffset&&t.contains(i.commonAncestorContainer)}return!1})(e)&&t.stopPropagation()}))}bindToCell(t,e,i,n,o){var r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_;this._disappearDelay=null==n?void 0:n.disappearDelay,this._disappearDelayId&&clearTimeout(this._disappearDelayId);const S=this._rootElement,A=this._messageElement,B=this._triangleElement;if(null==S||S.classList.remove(IF),null==S||S.classList.add(OF),this._canBindToCell(t,e,i)){if(A.setAttribute("style",""),B.setAttribute("style",""),(null==n?void 0:n.className)&&S.classList.add(n.className),(null===(r=null==n?void 0:n.style)||void 0===r?void 0:r.bgColor)&&(A.style.backgroundColor=null===(s=null==n?void 0:n.style)||void 0===s?void 0:s.bgColor),(null===(a=null==n?void 0:n.style)||void 0===a?void 0:a.bgColor)&&(B.style.backgroundColor=null===(l=null==n?void 0:n.style)||void 0===l?void 0:l.bgColor),B.style.display=!0===(null===(h=null==n?void 0:n.style)||void 0===h?void 0:h.arrowMark)?"block":"none",(null===(d=null==n?void 0:n.style)||void 0===d?void 0:d.fontSize)&&(A.style.fontSize=(null!==(u=null===(c=null==n?void 0:n.style)||void 0===c?void 0:c.fontSize)&&void 0!==u?u:12)+"px"),(null===(g=null==n?void 0:n.style)||void 0===g?void 0:g.fontFamily)&&(A.style.fontFamily=null===(p=null==n?void 0:n.style)||void 0===p?void 0:p.fontFamily),(null===(f=null==n?void 0:n.style)||void 0===f?void 0:f.color)&&(A.style.color=null===(v=null==n?void 0:n.style)||void 0===v?void 0:v.color),(null===(b=null==n?void 0:n.style)||void 0===b?void 0:b.padding)&&(A.style.padding=`${null===(m=null==n?void 0:n.style)||void 0===m?void 0:m.padding.join("px ")}px`),(null===(y=null==n?void 0:n.style)||void 0===y?void 0:y.maxHeight)&&(A.style.maxHeight=`${null===(C=null==n?void 0:n.style)||void 0===C?void 0:C.maxHeight}px`),(null===(w=null==n?void 0:n.style)||void 0===w?void 0:w.maxWidth)&&(A.style.maxWidth=`${null===(x=null==n?void 0:n.style)||void 0===x?void 0:x.maxWidth}px`),A&&(A.textContent=null==n?void 0:n.content),this._bindToCell(t,e,i,null==n?void 0:n.position,null==n?void 0:n.referencePosition,o,null===(_=null==n?void 0:n.style)||void 0===_?void 0:_.arrowMark))return null==S||S.classList.add(IF),null==S||S.classList.remove(OF),!0}else this.unbindFromCell();return!1}release(){var t,e;this.unbindFromCell();const i=this._rootElement;(null==i?void 0:i.parentElement)&&i.parentElement.removeChild(i),null===(e=null===(t=this._handler)||void 0===t?void 0:t.release)||void 0===e||e.call(t),delete this._rootElement,delete this._messageElement}move(t,e,i,n,o){const r=this._rootElement;this._canBindToCell(t,e,i)?(this._bindToCell(t,e,i,null==n?void 0:n.position,null==n?void 0:n.referencePosition,o),null==r||r.classList.add(IF),null==r||r.classList.remove(OF)):this.unbindFromCell()}unbindFromCell(){var t;if(this._disappearDelay)this._disappearDelayId=setTimeout((()=>{const t=this._rootElement;(null==t?void 0:t.parentElement)&&(t.classList.remove(IF),t.classList.add(OF))}),null!==(t=this._disappearDelay)&&void 0!==t?t:0);else{const t=this._rootElement;(null==t?void 0:t.parentElement)&&(t.classList.remove(IF),t.classList.add(OF))}}_canBindToCell(t,e,i){const n=t.getCellRangeRelativeRect({col:e,row:i}),o=t.getElement(),{bottom:r,left:s,right:a,top:l}=n;if(t.isFrozenCell(e,i))return!0;if(r<t.getFrozenRowsHeight()||a<t.getFrozenColsWidth()||s>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||l>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:h,offsetWidth:d}=o;return!(l>h||s>d)}_bindToCell(t,e,i,n,o,r,s){const a=this._rootElement,l=t.getCellRangeRelativeRect({col:e,row:i}),h=t.internalProps.tooltip.parentElement,d=t.internalProps.element.offsetWidth,{width:c}=l;if(a){let l,u;a.parentElement!==h&&h.appendChild(a),a.style.left="0px";const g=Math.min(.8*d,4*c);a.style.maxWidth=`${g}px`;const p=a.clientWidth,f=a.clientHeight;if(!n&&!o)return!1;{const a=this.getComputedPosition(t,e,i,n,o,r,s);u=a.x,l=a.y}a.style.left=`${u}px`,a.style.top=`${l}px`,Nx()&&(a.style.fontSize="11px");const{x1:v,x2:b,y1:m,y2:y}=t.stateManager.menu.bounds,C=u,w=C+p,x=l,_=C+f;return!(t.stateManager.menu.isShow&&v<w&&b>C&&y>x&&m<_)}return!1}getComputedPosition(t,e,i,n,o,r,s){var a;const l=this._rootElement,h=t.getCellRangeRelativeRect({col:e,row:i}),{x:d,y:c}=t.internalProps.tooltip.parentElement.getBoundingClientRect(),{width:u,height:g,x:p,y:f}=t.internalProps.element.getBoundingClientRect(),{width:v}=h;let b,m;const y=Math.min(.8*u,4*v);l.style.maxWidth=`${y}px`;const C=l.clientWidth,w=l.clientHeight,x=s?6:0;if(n)m=n.x,b=n.y+x,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px";else if(o){let t=null!==(a=o.placement)&&void 0!==a?a:Yw.bottom;const e=o.rect.left+o.rect.width/2,i=o.rect.top+o.rect.height/2,n=o.rect.top,s=o.rect.bottom,l=o.rect.left,h=o.rect.right;let d=0;const c=()=>{d++,d>=4||(this.removeStyleFromTriangle(),t===Yw.top?(m=e-C/2,b=n-w-x,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.bottom="-5px",r&&b<0&&(t=Yw.right,c())):t===Yw.bottom?(m=e-C/2,b=s+x,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px",r&&b+w>g&&(t=Yw.left,c())):t===Yw.left?(b=i-w/2,m=l-C-x,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.right="-5px",r&&m<0&&(t=Yw.top,c())):t===Yw.right&&(b=i-w/2,m=h+x,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.left="-5px",r&&m+C>u&&(t=Yw.bottom,c())))};c()}return r&&(m<0?m=0:m+l.offsetWidth>u&&(m=u-l.offsetWidth)),{x:m+p-d,y:b+f-c}}removeStyleFromTriangle(){this._triangleElement.style.left="",this._triangleElement.style.right="",this._triangleElement.style.top="",this._triangleElement.style.bottom="",this._triangleElement.style.marginLeft="",this._triangleElement.style.marginTop=""}_locate(t,e,i,n,o,r){const s=this.getComputedPosition(t,e,i,n,o,r),a=s.x,l=s.y;this._rootElement.style.left=`${a}px`,this._rootElement.style.top=`${l}px`}}class zF extends LF{createTooltipElementInternal(){return new FF}}const DF=function(t){return new zF(t)};class WF{constructor(t,e){this._table=t,this._tooltipInstances={},this._bindTableEvent(t),this.confine=e}release(){var t,e;const i=this._tooltipInstances;for(const n in i)null===(e=null===(t=i[n])||void 0===t?void 0:t.release)||void 0===e||e.call(t);delete this._tooltipInstances,this._attachInfo=null}_bindToCell(t,e,i){var n;const o=this._attachInfo,r=this._getTooltipInstanceInfo(t,e);if(!o||r&&o.instance===r||(null===(n=o.instance)||void 0===n||n.unbindTooltipElement(),this._attachInfo=null),r&&r&&r.bindTooltipElement(t,e,i,this.confine)){const n=this._table.getCellRange(t,e);this._attachInfo={range:n,instance:r,tooltipOptions:i}}}_move(t,e,i){const n=this._attachInfo;if(!n||!a_(n.range,t,e))return;const{instance:o}=n;null==o||o.moveTooltipElement(t,e,i,this.confine)}moveToPosition(t,e,i,n){const o=this._attachInfo;if(!o||!a_(o.range,t,e))return;const{instance:r}=o;this._attachInfo.tooltipOptions.position=i,this._attachInfo.tooltipOptions.referencePosition=n,null==r||r.locateTooltipElement(t,e,i,n,this.confine)}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;null==e||e.unbindTooltipElement(),this._attachInfo=null}_isBindCell(t,e){const i=this._attachInfo;return!!i&&a_(i.range,t,e)}_bindTableEvent(t){t.on(v_.MOUSEENTER_CELL,(e=>{if(Nx())return;const{x1:i,x2:n,y1:o,y2:r}=t.stateManager.menu.bounds;if(t.stateManager.menu.isShow&&"number"==typeof e.x&&"number"==typeof e.y&&e.x>i&&e.x<n&&e.y>o&&e.y<r)return;const{col:s,row:a}=e;this.showTooltip(s,a)})),t.on(v_.MOUSEMOVE_CELL,(e=>{var i,n;if(!Nx()){if(null===(n=null===(i=this._attachInfo)||void 0===i?void 0:i.tooltipOptions)||void 0===n?void 0:n.referencePosition){const i=this._attachInfo.tooltipOptions.referencePosition,{event:n}=e,{left:o,right:r,top:s,bottom:a}=i.rect,l=t._getMouseAbstractPoint(n);l.inTable&&l.x>=o-5&&l.x<=r+5&&l.y>=s-5&&l.y<=a+5||this._unbindFromCell()}this._attachInfo&&t.stateManager.menu.isShow&&this._bindToCell(e.col,e.row)}})),t.on(v_.MOUSELEAVE_CELL,(t=>{this._unbindFromCell()})),t.on(v_.SELECTED_CELL,(t=>{this._isBindCell(t.col,t.row)&&this._unbindFromCell()})),t.on(v_.MOUSELEAVE_TABLE,(t=>{this._unbindFromCell()})),t.on(v_.SCROLL,(t=>{this._unbindFromCell()}))}showTooltip(t,e){var i,n,o;let r;const s=this._table,a=s.getHeaderDescription(t,e);if(a){const n=s.getCellRangeRelativeRect({col:t,row:e});r={content:a,referencePosition:{placement:s.internalProps.tooltip.position,rect:n},disappearDelay:null!==(i=s.internalProps.tooltip.overflowTextTooltipDisappearDelay)&&void 0!==i?i:0,style:s.theme.tooltipStyle}}else if(VC(null===(n=s.internalProps.tooltip)||void 0===n?void 0:n.isShowOverflowTextTooltip)?s.internalProps.tooltip.isShowOverflowTextTooltip(t,e,s):s.internalProps.tooltip.isShowOverflowTextTooltip){const i=s.getCellOverflowText(t,e),n=s.getCellRangeRelativeRect({col:t,row:e});i&&(r={content:a?`${a}\n  ${i}`:i,referencePosition:{placement:s.internalProps.tooltip.position,rect:n},disappearDelay:null!==(o=s.internalProps.tooltip.overflowTextTooltipDisappearDelay)&&void 0!==o?o:0,style:s.theme.tooltipStyle})}r?this._bindToCell(t,e,r):this._unbindFromCell()}_getTooltipInstanceInfo(t,e){const i=this._table,n=this._tooltipInstances;return n&&n["bubble-tooltip"]||n&&(n["bubble-tooltip"]=DF(i))}isBinded(t){var e;return JSON.stringify(t)===JSON.stringify(null===(e=this._attachInfo)||void 0===e?void 0:e.tooltipOptions)}}class NF{constructor(t){this.titleRows=[],this.showedTitleRows=[],this.rowNow=-1,this.skipStartRow=-1,this.skipEndRow=-1,this.table=t,this.table.on("scroll",(t=>{"vertical"===t.scrollDirection&&this.updateGroupTitle()})),this.table.on("tree_hierarchy_state_change",(t=>{this.updateGroupTitle()})),this.table.on("resize_column",(t=>{this.updateGroupTitle()}))}updateGroupTitle(){0===this.table.scrollTop?(this.titleRows=[],this.showedTitleRows=[]):-1!==this.skipStartRow&&-1!==this.skipEndRow&&this.skipStartRow!==this.table.scenegraph.proxy.bodyTopRow-1?(this.table.scenegraph.proxy.screenTopRow<=this.skipStartRow||this.table.scenegraph.proxy.screenTopRow>=this.skipEndRow)&&(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()):(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()),this.updateScenegraph()}updateGroupTitleInfo(){this.rowNow=this.table.scenegraph.proxy.screenTopRow+this.titleRows.length;const t=this.table.getRecordIndexByCell(0,this.rowNow),e=this.table.getRecordIndexByCell(0,this.rowNow+1);this.getTitleRowsByRecordIndex(t,e)}getTitleRowsByRecordIndex(t,e){ZC(t)||(t=[t]),ZC(e)||(e=[e]);for(let e=0;e<t.length;e++){const i=t.slice(0,e+1);this.table.dataSource.getRaw(i)}const i=[],n=e.length===t.length+1;let o=t.slice(0,n?t.length:t.length-1);const r=this.table.dataSource.currentIndexedData;for(let e=this.rowNow-this.table.columnHeaderLevelCount;e>=0;e--){const n=r[e];if(ZC(n)&&o.length===n.length){let t=!0;for(let e=0;e<n.length;e++)if(n[e]!==o[e]){t=!1;break}t&&(i.push(e+this.table.columnHeaderLevelCount),o=o.slice(0,o.length-1))}else if(n===t[0]){i.push(e+this.table.columnHeaderLevelCount);break}}this.titleRows=i.reverse()}updateScenegraph(){const{table:t}=this,{shadowGroup:e,shadowGroupFrozen:i}=function(t){const e=t.scenegraph.colHeaderGroup,i=t.scenegraph.cornerHeaderGroup;if(!e.border){const i=ql({x:0,y:0,width:0,height:0,cursor:"pointer"});e.add(i),e.border=i,i.attachShadow(i.shadowRoot),i.name="border-rect",i.addEventListener("click",(e=>{const i=t.listTreeStickCellPlugin.titleRows,{shadowTarget:n}=e.pickParams,o=IT(n),{col:r,row:s}=o;VF(s-i.indexOf(s),t)}))}if(!i.border){const e=ql({x:0,y:0,width:0,height:0,cursor:"pointer"});i.add(e),i.border=e,e.attachShadow(e.shadowRoot),e.name="border-rect",e.addEventListener("click",(e=>{const i=t.listTreeStickCellPlugin.titleRows,{shadowTarget:n}=e.pickParams,o=IT(n),{col:r,row:s}=o;VF(s-i.indexOf(s),t)}))}const n=e.border.shadowRoot,o=i.border.shadowRoot;return n.removeAllChild(),o.removeAllChild(),{shadowGroup:n,shadowGroupFrozen:o}}(t);this.showedTitleRows.length=0;let n=0;for(let o=0;o<t.colCount;o++){let r;o<t.frozenColCount?(r=new xR({x:t.getColsWidth(0,o-1),y:t.getFrozenRowsHeight()}),i.add(r)):(r=new xR({x:t.getColsWidth(t.frozenColCount,o-1),y:t.getFrozenRowsHeight()}),e.add(r)),r.col=o;for(let e=0;e<this.titleRows.length;e++){const i=this.titleRows[e];if(GF(i,this.rowNow,t.scenegraph.proxy.screenTopRow,this.titleRows)){0===o&&n++;continue}0===o&&this.showedTitleRows.push(i);const s=t.scenegraph.getCell(o,i);if("cell"===s.role){const t=jF(s);t.setAttributes({y:40*e}),r.add(t)}else{const n=YR(o,i,t,!0,!0);n.setAttributes({y:40*e}),r.add(n)}}}n>0&&-1===this.skipStartRow&&-1===this.skipEndRow&&(this.skipStartRow=t.scenegraph.proxy.screenTopRow-1,this.skipEndRow=t.scenegraph.proxy.screenTopRow+1)}}function GF(t,e,i,n){return t===e&&t!==i+n.length-1||t===i+n.indexOf(t)+1&&t<e}function jF(t){const e=t.clone();if(e.role=t.role,e.col=t.col,e.row=t.row,e.mergeStartCol=t.mergeStartCol,e.mergeStartRow=t.mergeStartRow,e.mergeEndCol=t.mergeEndCol,e.mergeEndRow=t.mergeEndRow,e.contentWidth=t.contentWidth,e.contentHeight=t.contentHeight,"cell"===e.role){const t=ql({x:0,y:0,width:e.attribute.width,height:e.attribute.height});e.add(t)}if("group"===t.type){const i=e;t.forEachChildren((t=>{const e=jF(t);i.add(e)}))}return e}function VF(t,e){const i=e.getDrawRange();if(XC(t)&&t>=e.frozenRowCount){const n=e.getFrozenRowsHeight(),o=e.getRowsHeight(0,t-1);e.scrollTop=Math.min(o-n,e.getAllRowsHeight()-i.height)-1}e.scenegraph.updateNextFrame()}function UF(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m){var y,C,w,x,_,S,A,B,T,R,k,M,L,P,E,H,O,I,F,z,D,W,N,G,j;const V=t_(OH,HH)[d],U=BR("padding",p._getCellStyle(o,r),o,r,p);if(XC(U)&&(l=U),!t){const l=TR(o,r,f,p);b&&(t=p.scenegraph.highPerformanceGetCell(o,r,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:n,width:s,height:a,lineWidth:null!==(C=null===(y=null==f?void 0:f.group)||void 0===y?void 0:y.lineWidth)&&void 0!==C?C:void 0,fill:null!==(x=null===(w=null==f?void 0:f.group)||void 0===w?void 0:w.fill)&&void 0!==x?x:void 0,stroke:null!==(S=null===(_=null==f?void 0:f.group)||void 0===_?void 0:_.stroke)&&void 0!==S?S:void 0,strokeArrayWidth:l,strokeArrayColor:null!==(B=null===(A=null==f?void 0:f.group)||void 0===A?void 0:A.strokeArrayColor)&&void 0!==B?B:void 0,cursor:null!==(R=null===(T=null==f?void 0:f.group)||void 0===T?void 0:T.cursor)&&void 0!==R?R:void 0,lineDash:null!==(M=null===(k=null==f?void 0:f.group)||void 0===k?void 0:k.lineDash)&&void 0!==M?M:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),t&&"cell"===t.role||((t=new xR({x:i,y:n,width:s,height:a,lineWidth:null!==(P=null===(L=null==f?void 0:f.group)||void 0===L?void 0:L.lineWidth)&&void 0!==P?P:void 0,fill:null!==(H=null===(E=null==f?void 0:f.group)||void 0===E?void 0:E.fill)&&void 0!==H?H:void 0,stroke:null!==(I=null===(O=null==f?void 0:f.group)||void 0===O?void 0:O.stroke)&&void 0!==I?I:void 0,strokeArrayWidth:l,strokeArrayColor:null!==(z=null===(F=null==f?void 0:f.group)||void 0===F?void 0:F.strokeArrayColor)&&void 0!==z?z:void 0,cursor:null!==(W=null===(D=null==f?void 0:f.group)||void 0===D?void 0:D.cursor)&&void 0!==W?W:void 0,lineDash:null!==(G=null===(N=null==f?void 0:f.group)||void 0===N?void 0:N.lineDash)&&void 0!==G?G:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})).role="cell",t.col=o,t.row=r,null==e||e.addCellGroup(t))}if(t.AABBBounds.width(),m&&Array.isArray(p.getCellValue(o,r))||!m){const e=new tM(v,{stroke:!1,x:l[3],y:l[0],canvas:null!==(j=p.canvas)&&void 0!==j?j:p.scenegraph.stage.window.getContext().canvas,mode:p.options.mode,modeParams:p.options.modeParams,spec:p.options.specTransformInCell?p.options.specTransformInCell(c,o,r):c,ClassType:V,width:s-l[3]-l[1],height:a-l[2]-l[0],chartInstance:u,dataId:g,data:p.getCellValue(o,r)||[],cellPadding:l,dpr:p.internalProps.pixelRatio,axes:p.isPivotChart()?p.internalProps.layoutMap.getChartAxes(o,r):[],tableChartOption:p.options.chartOption,col:o,row:r});t.appendChild(e),p.internalProps.layoutMap.setChartInstance(o,r,e.chartInstance)}return t}class XF extends xR{constructor(t){super(t),this._autoWidth=!1,this._autoHeight=!1,this._leftGroup=new xR({pickable:!1,fill:!1,stroke:!1}),this._leftGroup.role="content-left",this._rightGroup=new xR({pickable:!1,fill:!1,stroke:!1}),this._rightGroup.role="content-right",this._checkboxGroup=new xR({pickable:!1,fill:!1,stroke:!1}),this._checkboxGroup.role="content-center",this.appendChild(this._leftGroup),this.appendChild(this._rightGroup),this.appendChild(this._checkboxGroup)}addLeftOccupyingIcon(t){var e,i,n;t.setAttribute("x",this._leftGroup.width+(null!==(e=t.attribute.marginLeft)&&void 0!==e?e:0)),this._leftGroup.appendChild(t),this._leftGroup.setDeltaWidth((null!==(i=t.attribute.marginLeft)&&void 0!==i?i:0)+(null!==(n=t.attribute.marginRight)&&void 0!==n?n:0)+t.attribute.width)}addRightOccupyingIcon(t){var e,i,n;t.setAttribute("x",this._rightGroup.width+(null!==(e=t.attribute.marginLeft)&&void 0!==e?e:0)),this._rightGroup.appendChild(t),this._rightGroup.setDeltaWidth((null!==(i=t.attribute.marginLeft)&&void 0!==i?i:0)+(null!==(n=t.attribute.marginRight)&&void 0!==n?n:0)+t.attribute.width)}addCheckbox(t){this._checkboxGroup.appendChild(t)}setCheckboxContentOption(t){this._autoWidth=t.autoWidth,this._autoHeight=t.autoHeight,this._cellWidth=t.cellWidth,this._originCellWidth=t.cellWidth,this._cellHeight=t.cellHeight,this._align=t.align,this._baseline=t.baseline}layout(){let t=this._leftGroup.width;t===1/0&&(t=0);let e=this._rightGroup.width;if(e===-1/0&&(e=0),this._autoWidth){const i=this._checkboxGroup.width;this._cellWidth=t+e+i,this.setAttribute("width",this._cellWidth)}else{const i=this._cellWidth-t-e;this.updateCenterLayout(i);const n=this._checkboxGroup.width;this._cellWidth=t+e+n,this.setAttribute("width",this._cellWidth)}this.updateHorizontalPos();const i=this._leftGroup.height,n=this._rightGroup.height,o=this._checkboxGroup.height;this._cellHeight=Math.max(i,n,o),this.setAttribute("height",this._cellHeight),this.updateVerticalPos()}updateCenterLayout(t){let e=t;this._checkboxGroup.forEachChildren((t=>{t instanceof vC&&(e-=t.AABBBounds.width())}));const i=this._checkboxGroup.getChildByName("checkbox-content");i instanceof vC&&i.setAttribute("width",e);let n=0;this._checkboxGroup.forEachChildren((t=>{t.setAttribute("x",n),n+=t.AABBBounds.width()}))}updateHorizontalPos(){this._leftGroup.setAttribute("x",0),this._rightGroup.setAttribute("x",this._cellWidth-this._rightGroup.width),this._checkboxGroup.setAttribute("x",4),"left"===this._align||"start"===this._align?this.setAttribute("dx",0):"center"===this._align?this.setAttribute("dx",-this.attribute.width/2):"right"!==this._align&&"end"!==this._align||this.setAttribute("dx",-this.attribute.width)}updateVerticalPos(){"top"===this._baseline?(this._leftGroup.setAttribute("y",0),this._rightGroup.setAttribute("y",0),this._checkboxGroup.setAttribute("y",0)):"middle"===this._baseline?(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",(this._leftGroup.height-t.AABBBounds.height())/2)})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",(this._rightGroup.height-t.AABBBounds.height())/2)})),this._leftGroup.setAttribute("y",this._cellHeight/2-this._leftGroup.height/2),this._rightGroup.setAttribute("y",this._cellHeight/2-this._rightGroup.height/2),this._checkboxGroup.setAttribute("y",this._cellHeight/2-this._checkboxGroup.height/2)):"bottom"===this._baseline&&(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",this._leftGroup.height-t.AABBBounds.height())})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",this._rightGroup.height-t.AABBBounds.height())})),this._leftGroup.setAttribute("y",this._cellHeight-this._leftGroup.height),this._rightGroup.setAttribute("y",this._cellHeight-this._rightGroup.height),this._checkboxGroup.setAttribute("y",this._cellHeight-this._checkboxGroup.height))}}function $F(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m){var y,C,w,x,_,S,A,B,T,R,k,M,L,P,E,H,O,I,F,z,D,W,N,G;if(!t){const s=TR(o,r,p,g);b&&(t=g.scenegraph.highPerformanceGetCell(o,r,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:n,width:a,height:l,lineWidth:null!==(C=null===(y=null==p?void 0:p.group)||void 0===y?void 0:y.lineWidth)&&void 0!==C?C:void 0,fill:null!==(x=null===(w=null==p?void 0:p.group)||void 0===w?void 0:w.fill)&&void 0!==x?x:void 0,stroke:null!==(S=null===(_=null==p?void 0:p.group)||void 0===_?void 0:_.stroke)&&void 0!==S?S:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(B=null===(A=null==p?void 0:p.group)||void 0===A?void 0:A.strokeArrayColor)&&void 0!==B?B:void 0,cursor:null!==(R=null===(T=null==p?void 0:p.group)||void 0===T?void 0:T.cursor)&&void 0!==R?R:void 0,lineDash:null!==(M=null===(k=null==p?void 0:p.group)||void 0===k?void 0:k.lineDash)&&void 0!==M?M:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),t&&"cell"===t.role||((t=new xR({x:i,y:n,width:a,height:l,lineWidth:null!==(P=null===(L=null==p?void 0:p.group)||void 0===L?void 0:L.lineWidth)&&void 0!==P?P:void 0,fill:null!==(H=null===(E=null==p?void 0:p.group)||void 0===E?void 0:E.fill)&&void 0!==H?H:void 0,stroke:null!==(I=null===(O=null==p?void 0:p.group)||void 0===O?void 0:O.stroke)&&void 0!==I?I:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(z=null===(F=null==p?void 0:p.group)||void 0===F?void 0:F.strokeArrayColor)&&void 0!==z?z:void 0,cursor:null!==(W=null===(D=null==p?void 0:p.group)||void 0===D?void 0:D.cursor)&&void 0!==W?W:void 0,lineDash:null!==(G=null===(N=null==p?void 0:p.group)||void 0===N?void 0:N.lineDash)&&void 0!==G?G:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",t.col=o,t.row=r,null==e||e.addCellGroup(t))}let j;if(u){let t=o,e=r;v&&(t=v.start.col,e=v.start.row),j=g.getCellIcons(t,e)}let V=0,U=0,X=0,$=0,Y=[];if(Array.isArray(j)&&0!==j.length){const{leftIconWidth:e,rightIconWidth:i,contentLeftIcons:n,contentRightIcons:o,absoluteLeftIconWidth:r,absoluteRightIconWidth:s}=OR(j,t,v,g);V=e+i,U=e,X=i,Y=n,$=s,t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+a-i-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+a-s-h[1])})),t.forEachChildren((t=>{"middle"===c?t.setAttribute("y",(l-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",l-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])}))}const K=function(t,e,i,n,o,r,s,a,l,h){var d,c,u,g,p;const f=l._getCellStyle(t,e),v=AR("size",f,t,e,l),b=AR("spaceBetweenTextAndIcon",f,t,e,l),m=AR("defaultFill",f,t,e,l),y=AR("defaultStroke",f,t,e,l),C=AR("disableFill",f,t,e,l),w=AR("checkedFill",f,t,e,l),x=AR("checkedStroke",f,t,e,l),_=AR("disableCheckedFill",f,t,e,l),S=AR("disableCheckedStroke",f,t,e,l),A=AR("checkIconImage",f,t,e,l),B=AR("indeterminateIconImage",f,t,e,l),T=l.getCellValue(t,e),R=l.getCellOriginValue(t,e);let k,M,L=null!==(d=T)&&void 0!==d?d:"";if($C(T)?(k=T.checked,M=T.disable,L=null!==(c=T.text)&&void 0!==c?c:""):"boolean"==typeof T&&(k=T,L=""),l.internalProps.layoutMap.isSeriesNumber(t,e)){const i=l.getFieldData(a.field,t,e);i&&(k=i.checked,M=i.disable,L=null!==(u=i.text)&&void 0!==u?u:"")}k=l.stateManager.syncCheckedState(t,e,a.field,k);const P=kR(t,e,l),E=l._getCellStyle(t,e),H=null!==(g=E.autoWrapText)&&void 0!==g?g:l.internalProps.autoWrapText,{lineClamp:O}=E,{checked:I,disable:F}=a;if(null==k||"function"==typeof k){const i=n_(I,{col:t,row:e,table:l,context:null,value:T,dataValue:R});k=l.stateManager.syncCheckedState(t,e,a.field,i)}const z=n_(F,{col:t,row:e,table:l,context:null,value:T,dataValue:R}),D="auto"===i,W=l.isAutoRowHeight(e),N={text:1===L.length?L[0]:L,maxLineWidth:D?1/0:n-(r[1]+r[3]+P)-v-b,textAlign:"left",textBaseline:"top",autoWrapText:H,lineClamp:O,wordBreak:"break-word",heightLimit:W?-1:o-Math.floor(r[0]+r[2]),pickable:!1,dx:h?0:P,whiteSpace:1!==L.length||H?"normal":"no-wrap"},G={x:0,y:0,text:s.text?Object.assign({},s.text,N):N,icon:{width:Math.floor(v/1.4),height:Math.floor(v/1.4)},box:{width:v,height:v},dx:h?P:0,spaceBetweenTextAndIcon:b,disabled:null!==(p=null!=M?M:z)&&void 0!==p&&p};"indeterminate"===k?(G.checked=void 0,G.indeterminate=!0):(G.checked=k,G.indeterminate=void 0),m&&(G.box.fill=m),y&&(G.box.stroke=y),C&&(G.box.disableFill=C),w&&(G.box.checkedFill=w),x&&(G.box.checkedStroke=x),_&&(G.box.disableCheckedFill=_),S&&(G.box.disableCheckedStroke=S),A&&(G.icon.checkIconImage=A),B&&(G.icon.indeterminateIconImage=B);const j=new vC(G);return j.name="checkbox",j}(o,r,s-V,a,l,h,p,f,g,m);if(1!==Y.length||Y[0].name!==Jw.expandIconName&&Y[0].name!==Jw.collapseIconName)K&&t.appendChild(K),K.render();else{const e=new XF({x:0,y:0,fill:!1,stroke:!1,pickable:!1});e.name="checkbox-content",e.setCheckboxContentOption({autoWidth:!1,autoHeight:!1,cellWidth:a-(h[1]+h[3]),cellHeight:l-h[0]-h[2],align:d,baseline:c});const i={addedHierarchyOffset:0};Y.forEach((n=>{const o=LR(n,void 0,t.col,t.row,v,g,i);o.role="icon-content-left",o.name=n.name,e.addLeftOccupyingIcon(o)})),K&&e.addCheckbox(K),t.appendChild(e),e.layout(),e.AABBBounds.width(),e.AABBBounds.height();const n=a-(h[1]+h[3]),o=l-(h[0]+h[2]);t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+n-X+h[3]):"icon-absolute-right"===t.role?t.setAttribute("x",t.attribute.x+n-$+h[3]+h[1]):"content"!==t.name&&"checkbox-content"!==t.name||("center"===d&&"richtext"!==t.type?t.setAttribute("x",h[3]+U+(n-U-X)/2):"right"===d&&"richtext"!==t.type?t.setAttribute("x",h[3]+n-X):t.setAttribute("x",h[3]+U))})),t.forEachChildren((t=>{t.name!==WT&&("middle"===c?(null==t?void 0:t._checkboxGroup)&&t._leftGroup.setAttribute("y",h[0]+(o-t._checkboxGroup.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",h[0]+o-t.AABBBounds.height()):t.setAttribute("y",h[0]))}))}return a-=h[1]+h[3]+V,l-=h[0]+h[2],"center"===d?K.setAttribute("x",h[3]+U+(a-K.AABBBounds.width())/2):"right"===d?K.setAttribute("x",h[3]+U+a-K.AABBBounds.width()):K.setAttribute("x",h[3]+U),"middle"===c?K.setAttribute("y",h[0]+(l-K.AABBBounds.height())/2):"bottom"===c?K.setAttribute("y",h[0]+l-K.AABBBounds.height()):K.setAttribute("y",h[0]),t}function YF(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f){var v,b,m,y,C,w,x,_,S,A,B,T;if(!t){const s=TR(o,r,g,u);(t=new xR({x:i,y:n,width:a,height:l,lineWidth:null!==(b=null===(v=null==g?void 0:g.group)||void 0===v?void 0:v.lineWidth)&&void 0!==b?b:void 0,fill:null!==(y=null===(m=null==g?void 0:g.group)||void 0===m?void 0:m.fill)&&void 0!==y?y:void 0,stroke:null!==(w=null===(C=null==g?void 0:g.group)||void 0===C?void 0:C.stroke)&&void 0!==w?w:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(_=null===(x=null==g?void 0:g.group)||void 0===x?void 0:x.strokeArrayColor)&&void 0!==_?_:void 0,cursor:null!==(A=null===(S=null==g?void 0:g.group)||void 0===S?void 0:S.cursor)&&void 0!==A?A:void 0,lineDash:null!==(T=null===(B=null==g?void 0:g.group)||void 0===B?void 0:B.lineDash)&&void 0!==T?T:void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius})).role="cell",t.col=o,t.row=r,null==e||e.addCellGroup(t)}const{width:R,height:k}=function(t,e,i,n,o,r,s,a,l,h,d){var c,u,g,p;const f=d._getCellStyle(t,e);let v=AR("size",f,t,e,d),b=AR("innerRadius",f,t,e,d),m=AR("outerRadius",f,t,e,d);const y=AR("spaceBetweenTextAndIcon",f,t,e,d),C=AR("spaceBetweenRadio",f,t,e,d),w=AR("defaultFill",f,t,e,d),x=AR("defaultStroke",f,t,e,d),_=AR("disableFill",f,t,e,d),S=AR("checkedFill",f,t,e,d),A=AR("checkedStroke",f,t,e,d),B=AR("disableCheckedFill",f,t,e,d),T=AR("disableCheckedStroke",f,t,e,d);tw(m)?v=2*m:m=Math.round(v/2),(!tw(b)||b<0)&&(b=Math.round(m/7*3));const R=d.getCellValue(t,e),k=d.getCellOriginValue(t,e),M=kR(t,e,d),L=d._getCellStyle(t,e),P=null!==(c=L.autoWrapText)&&void 0!==c?c:d.internalProps.autoWrapText,{lineClamp:E}=L,H="auto"===i,O=d.isAutoRowHeight(e),I={maxLineWidth:H?1/0:n-(r[1]+r[3]+M)-v-y,textAlign:"left",textBaseline:"top",autoWrapText:P,lineClamp:E,wordBreak:"break-word",heightLimit:O?-1:o-Math.floor(r[0]+r[2]),pickable:!1,dx:M},F={x:0,y:0,text:s.text?Object.assign({},s.text,I):I,circle:{innerRadius:b,outerRadius:m},spaceBetweenTextAndIcon:y};w&&(F.circle.fill=w),x&&(F.circle.stroke=x),_&&(F.circle.disableFill=_),S&&(F.circle.checkedFill=S),A&&(F.circle.checkedStroke=A),B&&(F.circle.disableCheckedFill=B),T&&(F.circle.disableCheckedStroke=T);let z=0,D=0;const W=null!==(u=a.radioDirectionInCell)&&void 0!==u?u:"vertical";if(ZC(R))R.forEach(((i,n)=>{var o,r;const s=KF(i,k,n,t,e,a,P,F,d);s&&l.appendChild(s),s.id=`radio-${null!==(o=null==h?void 0:h.start.col)&&void 0!==o?o:t}-${null!==(r=null==h?void 0:h.start.row)&&void 0!==r?r:e}-${n}`,s.render();const c=s.AABBBounds;"vertical"===W?(s.setAttribute("y",D),D+=c.height()+(n!==R.length-1?C:0),z=Math.max(z,c.width())):"horizontal"===W&&(s.setAttribute("x",z),z+=c.width()+(n!==R.length-1?C:0),D=Math.max(D,c.height()))}));else{const i=KF(R,k,void 0,t,e,a,P,F,d);i&&l.appendChild(i),i.id=`radio-${null!==(g=null==h?void 0:h.start.col)&&void 0!==g?g:t}-${null!==(p=null==h?void 0:h.start.row)&&void 0!==p?p:e}`,i.render();const n=i.AABBBounds;z=n.width(),D=n.height()}return{width:z,height:D}}(o,r,s,a,l,h,g,p,t,f,u);return a-=h[1]+h[3],l-=h[0]+h[2],t.forEachChildren((t=>{"center"===d?t.setAttribute("x",h[3]+t.attribute.x+(a-R)/2):"right"===d?t.setAttribute("x",h[3]+t.attribute.x+a-R):t.setAttribute("x",h[3]+t.attribute.x),"middle"===c?t.setAttribute("y",h[0]+t.attribute.y+(l-k)/2):"bottom"===c?t.setAttribute("y",h[0]+t.attribute.y+l-k):t.setAttribute("y",h[0]+t.attribute.y)})),t}function KF(t,e,i,n,o,r,s,a,l){const h=function(t,e,i,n,o,r,s){var a,l;const h=null!==(a=r.radioCheckType)&&void 0!==a?a:"column";let d,c;return $C(t)?d=t.checked:"boolean"==typeof t&&(d=t),d=s.stateManager.syncRadioState(n,o,r.field,h,i,d),null!=d&&"function"!=typeof d||(c=n_(r.checked,{col:n,row:o,table:s,context:null,value:t,dataValue:e}),d=s.stateManager.syncRadioState(n,o,r.field,h,i,c)),null!==(l=null!=d?d:c)&&void 0!==l&&l}(t,e,i,n,o,r,l),d=function(t,e,i,n,o,r){var s;let a;$C(t)&&(a=t.disable);const l=n_(o.disable,{col:i,row:n,table:r,context:null,value:t,dataValue:e});return null!==(s=null!=a?a:l)&&void 0!==s&&s}(t,e,n,o,r,l),c=$C(t)?t.text:jC(t)?"":null!=t?t:"",u=uw({},a,{checked:h,disabled:d,text:{text:1===c.length?c[0]:c,whiteSpace:1!==c.length||s?"normal":"no-wrap"},boundsPadding:0}),g=new bC(u);return g.name="radio",g}function qF(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b){var m,y,C,w,x,_,S,A,B,T,R,k,M,L,P,E,H,O,I,F,z,D,W,N;if(!t){const s=TR(o,r,p,g);b&&(t=g.scenegraph.highPerformanceGetCell(o,r,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:n,width:a,height:l,lineWidth:null!==(y=null===(m=null==p?void 0:p.group)||void 0===m?void 0:m.lineWidth)&&void 0!==y?y:void 0,fill:null!==(w=null===(C=null==p?void 0:p.group)||void 0===C?void 0:C.fill)&&void 0!==w?w:void 0,stroke:null!==(_=null===(x=null==p?void 0:p.group)||void 0===x?void 0:x.stroke)&&void 0!==_?_:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(A=null===(S=null==p?void 0:p.group)||void 0===S?void 0:S.strokeArrayColor)&&void 0!==A?A:void 0,cursor:null!==(T=null===(B=null==p?void 0:p.group)||void 0===B?void 0:B.cursor)&&void 0!==T?T:void 0,lineDash:null!==(k=null===(R=null==p?void 0:p.group)||void 0===R?void 0:R.lineDash)&&void 0!==k?k:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),t&&"cell"===t.role||((t=new xR({x:i,y:n,width:a,height:l,lineWidth:null!==(L=null===(M=null==p?void 0:p.group)||void 0===M?void 0:M.lineWidth)&&void 0!==L?L:void 0,fill:null!==(E=null===(P=null==p?void 0:p.group)||void 0===P?void 0:P.fill)&&void 0!==E?E:void 0,stroke:null!==(O=null===(H=null==p?void 0:p.group)||void 0===H?void 0:H.stroke)&&void 0!==O?O:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(F=null===(I=null==p?void 0:p.group)||void 0===I?void 0:I.strokeArrayColor)&&void 0!==F?F:void 0,cursor:null!==(D=null===(z=null==p?void 0:p.group)||void 0===z?void 0:z.cursor)&&void 0!==D?D:void 0,lineDash:null!==(N=null===(W=null==p?void 0:p.group)||void 0===W?void 0:W.lineDash)&&void 0!==N?N:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",t.col=o,t.row=r,null==e||e.addCellGroup(t))}let G;if(u){let t=o,e=r;v&&(t=v.start.col,e=v.start.row),G=g.getCellIcons(t,e)}let j=0,V=0;if(Array.isArray(G)&&0!==G.length){const{leftIconWidth:e,rightIconWidth:i,absoluteLeftIconWidth:n,absoluteRightIconWidth:o}=OR(G,t,v,g);j=e+i,V=e,t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+a-i-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+a-o-h[1])})),t.forEachChildren((t=>{"middle"===c?t.setAttribute("y",(l-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",l-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])}))}const U=function(t,e,i,n,o,r,s,a,l){var h,d,c,u;const g=l._getCellStyle(t,e),p=AR("spaceBetweenTextAndCircle",g,t,e,l),f=AR("circleRadius",g,t,e,l),v=AR("boxWidth",g,t,e,l),b=AR("boxHeight",g,t,e,l),m=AR("checkedFill",g,t,e,l),y=AR("uncheckedFill",g,t,e,l),C=AR("disableCheckedFill",g,t,e,l),w=AR("disableUncheckedFill",g,t,e,l),x=AR("circleFill",g,t,e,l),_=l.getCellValue(t,e),S=l.getCellOriginValue(t,e);let A,B,T=null!==(h=_)&&void 0!==h?h:"";$C(_)?(A=_.checked,B=_.disable,T=null!==(d=_.text)&&void 0!==d?d:""):"boolean"==typeof _&&(A=_,T=""),A=l.stateManager.syncCheckedState(t,e,a.field,A);const R=kR(t,e,l),k=l._getCellStyle(t,e),M=null!==(c=k.autoWrapText)&&void 0!==c?c:l.internalProps.autoWrapText,{lineClamp:L}=k,{checked:P,disable:E,uncheckedText:H,checkedText:O}=a;if(null==A||"function"==typeof A){const i=n_(P,{col:t,row:e,table:l,context:null,value:_,dataValue:S});A=l.stateManager.syncCheckedState(t,e,a.field,i)}const I=n_(E,{col:t,row:e,table:l,context:null,value:_,dataValue:S}),F=n_(O,{col:t,row:e,table:l,context:null,value:_,dataValue:S}),z=n_(H,{col:t,row:e,table:l,context:null,value:_,dataValue:S}),D="auto"===i,W=l.isAutoRowHeight(e),N={text:1===T.length?T[0]:T,maxLineWidth:D?1/0:n-(r[1]+r[3]+R)-2*f-p,textAlign:"left",textBaseline:"top",autoWrapText:M,lineClamp:L,wordBreak:"break-word",heightLimit:W?-1:o-Math.floor(r[0]+r[2]),pickable:!1,dx:R,whiteSpace:1!==T.length||M?"normal":"no-wrap",checkedText:F,uncheckedText:z},G={x:0,y:0,text:s.text?Object.assign({},s.text,N):N,circle:{radius:f},box:{width:v,height:b},spaceBetweenTextAndCircle:p,disabled:null!==(u=null!=B?B:I)&&void 0!==u&&u};G.checked=A,y&&(G.box.uncheckedFill=y),w&&(G.box.disableUncheckedFill=w),m&&(G.box.checkedFill=m),C&&(G.box.disableCheckedFill=C),x&&(G.circle.fill=x);const j=new yC(G);return j.name="switch",j}(o,r,s-j,a,l,h,p,f,g);return U&&t.appendChild(U),U.render(),a-=h[1]+h[3]+j,l-=h[0]+h[2],"center"===d?U.setAttribute("x",h[3]+V+(a-U.AABBBounds.width())/2):"right"===d?U.setAttribute("x",h[3]+V+a-U.AABBBounds.width()):U.setAttribute("x",h[3]+V),"middle"===c?U.setAttribute("y",h[0]+(l-U.AABBBounds.height())/2):"bottom"===c?U.setAttribute("y",h[0]+l-U.AABBBounds.height()):U.setAttribute("y",h[0]),t}const ZF=new class extends AI{constructor(t){super(!1),this.type=rI.Point,this._padding=0,this.paddingInner(1,t),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}},JF=new XI;function QF(t,e,i,n,o,r,s,a,l,h,d,c){var u,g,p,f,v,b,m,y,C,w,x,_,S,A,B,T,R,k,M,L,P,E,H,O;if(!t){const l=TR(o,r,d,h);c&&(t=h.scenegraph.highPerformanceGetCell(o,r,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:n,width:s,height:a,lineWidth:null!==(g=null===(u=null==d?void 0:d.group)||void 0===u?void 0:u.lineWidth)&&void 0!==g?g:void 0,fill:null!==(f=null===(p=null==d?void 0:d.group)||void 0===p?void 0:p.fill)&&void 0!==f?f:void 0,stroke:null!==(b=null===(v=null==d?void 0:d.group)||void 0===v?void 0:v.stroke)&&void 0!==b?b:void 0,strokeArrayWidth:l,strokeArrayColor:null!==(y=null===(m=null==d?void 0:d.group)||void 0===m?void 0:m.strokeArrayColor)&&void 0!==y?y:void 0,cursor:null!==(w=null===(C=null==d?void 0:d.group)||void 0===C?void 0:C.cursor)&&void 0!==w?w:void 0,lineDash:null!==(_=null===(x=null==d?void 0:d.group)||void 0===x?void 0:x.lineDash)&&void 0!==_?_:void 0,lineCap:"butt",clip:!0,cornerRadius:d.group.cornerRadius}),t&&"cell"===t.role||((t=new xR({x:i,y:n,width:s,height:a,lineWidth:null!==(A=null===(S=null==d?void 0:d.group)||void 0===S?void 0:S.lineWidth)&&void 0!==A?A:void 0,fill:null!==(T=null===(B=null==d?void 0:d.group)||void 0===B?void 0:B.fill)&&void 0!==T?T:void 0,stroke:null!==(k=null===(R=null==d?void 0:d.group)||void 0===R?void 0:R.stroke)&&void 0!==k?k:void 0,strokeArrayWidth:l,strokeArrayColor:null!==(L=null===(M=null==d?void 0:d.group)||void 0===M?void 0:M.strokeArrayColor)&&void 0!==L?L:void 0,cursor:null!==(E=null===(P=null==d?void 0:d.group)||void 0===P?void 0:P.cursor)&&void 0!==E?E:void 0,lineDash:null!==(O=null===(H=null==d?void 0:d.group)||void 0===H?void 0:H.lineDash)&&void 0!==O?O:void 0,lineCap:"butt",clip:!0,cornerRadius:d.group.cornerRadius})).role="cell",t.col=o,t.row=r,null==e||e.addCellGroup(t))}const I=function(t,e,i,n,o,r){let s,a;const l=r.internalProps.layoutMap.getBody(t,e).sparklineSpec,h=r.getCellValue(t,e);if(!Array.isArray(h))return;const d=o[3],c=o[0];i-=o[1]+o[3];const u=n-=o[0]+o[2];if("function"==typeof l){const o={col:t,row:e,dataValue:r.getCellOriginValue(t,e)||"",value:r.getCellValue(t,e)||"",rect:r.getCellRangeRelativeRect(r.getCellRange(t,e)),table:r};s=l(o),a=tz(s,d,c,i,n)}else s=l,a=tz(l,d,c,i,n);const g=[],p=[];let f,v;if("object"==typeof s.xField)ZF.domain(s.xField.domain),f=s.xField.field;else if("string"==typeof s.xField){const t=h.map((t=>t[s.xField]));ZF.domain(t),f=s.xField}else Array.isArray(h)&&(ZF.domain(Array.from({length:h.length},((t,e)=>e))),f=s.xField);if(ZF.range([0,i]),"object"==typeof s.yField)JF.domain(s.yField.domain),v=s.yField.field;else if("string"==typeof s.yField){const t=ez(h,s.yField);JF.domain([Math.min(...t),Math.max(...t)]),v=s.yField}else if(Array.isArray(h)){const t=ez(h);JF.domain([Math.min(...t),Math.max(...t)]),v=s.yField}if(JF.range([0,n]),"object"==typeof s.xField&&Array.isArray(s.xField.domain)){const t=h.map((t=>t[s.xField.field])),e=s.xField.domain;for(let i=0;i<e.length;i++){let n=!1;for(let o=0;o<t.length;o++)if(e[i]===t[o]){const t=h[o];if(!XC(t[f])||!XC(t[v]))break;g.push({x:0+ZF.scale(t[f]),y:u-JF.scale(t[v]),defined:XC(t[v])}),p.push(t),n=!0;break}n||(g.push({x:0+ZF.scale(e[i]),y:0,defined:!1}),p.push({[f]:e[i],[v]:null}))}}else for(let t=0;t<h.length;t++){const e=h[t];g.push({x:0+ZF.scale(f?e[f]:t),y:u-JF.scale(v?e[v]:e),defined:XC(v?e[v]:e),rawData:e}),p.push(e)}const b=a.getChildByName("sparkline-line");b&&b.setAttribute("points",g),b.bandwidth=ZF.step(),b.min=JF.range()[0],b.max=JF.range()[1];const m=a.getChildByName("sparkline-symbol-group");if(m){const t="isolatedPoint"===s.pointShowRule;if("all"===s.pointShowRule)for(let t=0;t<g.length;t++){const{x:e,y:i,defined:n}=g[t];if(n){const t=Vl({x:e,y:i});m.appendChild(t)}}else if(t)for(let t=0;t<g.length;t++){const{x:e,y:i,defined:n}=g[t];if(n&&(!g[t-1]||!g[t-1].defined)&&(!g[t+1]||!g[t+1].defined)){const t=Vl({x:e,y:i});m.appendChild(t)}}}return a}(o,r,s,a,l,h);return I&&t.appendChild(I),t}function tz(t,e,i,n,o){var r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B;let T;T="function"==typeof t?t(null):t;const R=new xR({x:e,y:i,width:n,height:o,stroke:!1,fill:!1});if(R.name="sparkline","line"===T.type){const t=$l({x:0,y:0,curveType:T.smooth?"monotoneX":"linear",stroke:null!==(a=null===(s=null===(r=T.line)||void 0===r?void 0:r.style)||void 0===s?void 0:s.stroke)&&void 0!==a?a:"blue",lineWidth:null!==(d=null===(h=null===(l=T.line)||void 0===l?void 0:l.style)||void 0===h?void 0:h.strokeWidth)&&void 0!==d?d:2});t.name="sparkline-line",R.addChild(t),T.crosshair&&(t.hover=null!==(u=null===(c=T.crosshair)||void 0===c?void 0:c.style)&&void 0!==u?u:{stroke:"#000",interpolate:"linear"});const e=new xR({x:0,y:0,width:n,height:o,stroke:!1,fill:!1});e.name="sparkline-symbol-group",e.setTheme({symbol:{stroke:null!==(f=null===(p=null===(g=T.point)||void 0===g?void 0:g.style)||void 0===p?void 0:p.stroke)&&void 0!==f?f:"#000",lineWidth:null!==(m=null===(b=null===(v=T.point)||void 0===v?void 0:v.style)||void 0===b?void 0:b.strokeWidth)&&void 0!==m?m:1,fill:null!==(w=null===(C=null===(y=T.point)||void 0===y?void 0:y.style)||void 0===C?void 0:C.fill)&&void 0!==w?w:"#000",size:2*(null!==(S=null===(_=null===(x=T.point)||void 0===x?void 0:x.style)||void 0===_?void 0:_.size)&&void 0!==S?S:3),symbolType:"circle"}}),R.addChild(e),e.hover=null!==(B=null===(A=T.point)||void 0===A?void 0:A.hover)&&void 0!==B&&B}return R}function ez(t,e){const i=[];for(let n=0;n<t.length;n++){const o=t[n];XC(e)&&XC(o[e])?i.push(o[e]):!XC(e)&&XC(o)&&i.push(o)}return i}const iz=wR();function nz(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v){var b,m,y,C,w,x,_,S,A,B,T,R,k,M,L,P,E,H,O,I,F,z,D,W,N,G,j,V,U,X;const $=BR("padding",g._getCellStyle(n,o),n,o,g);(null===(b=g.options.customConfig)||void 0===b?void 0:b.imageMargin)?h=UB(null===(m=g.options.customConfig)||void 0===m?void 0:m.imageMargin):XC($)&&(h=$),(null===(y=null==p?void 0:p.text)||void 0===y?void 0:y.textAlign)&&(d=null===(C=null==p?void 0:p.text)||void 0===C?void 0:C.textAlign),(null===(w=null==p?void 0:p.text)||void 0===w?void 0:w.textBaseline)&&(c=null===(x=null==p?void 0:p.text)||void 0===x?void 0:x.textBaseline);const Y=TR(n,o,p,g);let K,q;if(v&&(K=g.scenegraph.highPerformanceGetCell(n,o,!0),K&&"cell"===K.role&&K.setAttributes({x:e,y:i,width:r,height:s,lineWidth:null!==(S=null===(_=null==p?void 0:p.group)||void 0===_?void 0:_.lineWidth)&&void 0!==S?S:void 0,fill:null!==(B=null===(A=null==p?void 0:p.group)||void 0===A?void 0:A.fill)&&void 0!==B?B:void 0,stroke:null!==(R=null===(T=null==p?void 0:p.group)||void 0===T?void 0:T.stroke)&&void 0!==R?R:void 0,strokeArrayWidth:Y,strokeArrayColor:null!==(M=null===(k=null==p?void 0:p.group)||void 0===k?void 0:k.strokeArrayColor)&&void 0!==M?M:void 0,cursor:null!==(P=null===(L=null==p?void 0:p.group)||void 0===L?void 0:L.cursor)&&void 0!==P?P:void 0,lineDash:null!==(H=null===(E=null==p?void 0:p.group)||void 0===E?void 0:E.lineDash)&&void 0!==H?H:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})),K&&"cell"===K.role||(K=new xR({x:e,y:i,width:r,height:s,lineWidth:null!==(I=null===(O=null==p?void 0:p.group)||void 0===O?void 0:O.lineWidth)&&void 0!==I?I:void 0,fill:null!==(z=null===(F=null==p?void 0:p.group)||void 0===F?void 0:F.fill)&&void 0!==z?z:void 0,stroke:null!==(W=null===(D=null==p?void 0:p.group)||void 0===D?void 0:D.stroke)&&void 0!==W?W:void 0,strokeArrayWidth:Y,strokeArrayColor:null!==(G=null===(N=null==p?void 0:p.group)||void 0===N?void 0:N.strokeArrayColor)&&void 0!==G?G:void 0,cursor:null!==(V=null===(j=null==p?void 0:p.group)||void 0===j?void 0:j.cursor)&&void 0!==V?V:void 0,lineDash:null!==(X=null===(U=null==p?void 0:p.group)||void 0===U?void 0:U.lineDash)&&void 0!==X?X:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),K.role="cell",K.col=n,K.row=o,null==t||t.addCellGroup(K)),u){let t=n,e=o;f&&(t=f.start.col,e=f.start.row),q=g.getCellIcons(t,e)}let Z=0,J=0;if(Array.isArray(q)&&0!==q.length){const{leftIconWidth:t,rightIconWidth:e,absoluteLeftIconWidth:i,absoluteRightIconWidth:n}=OR(q,K,f,g);Z=t,J=e,K.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+r-e-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+r-n-h[1])})),K.forEachChildren((t=>{"middle"===c?t.setAttribute("y",(s-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",s-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])})),K._cellLeftIconWidth=Z,K._cellRightIconWidth=J}const Q=g.getCellValue(n,o),tt=document.createElement("video");tt.addEventListener("loadeddata",(()=>{l&&zR(n,o,tt.videoWidth,tt.videoHeight,g.scenegraph,h,K);const{width:t,height:e,isMerge:i}=WR(K,g);if(a){const{width:i,height:n}=_R(tt.videoWidth,tt.videoHeight,t-h[1]-h[3],e-h[0]-h[2]),o=SR(0,0,t,e,i,n,d,c,h);et.setAttributes({width:i,height:n,x:o.x,y:o.y,dx:0})}else et.setAttributes({x:h[3],y:h[0],width:t-h[1]-h[3],height:e-h[2]-h[0],dy:0});i&&NR(K.mergeStartCol,K.mergeEndCol,K.mergeStartRow,K.mergeEndRow,g);const{width:r,height:s}=WR(K,g),u=Math.floor(Math.min(r-h[1]-h[3],s-h[2]-h[0])/2),p=0+(r>et.attribute.width?et.attribute.x-0+et.attribute.width/2:r/2),f=0+(s>et.attribute.height?et.attribute.y-0+et.attribute.height/2:s/2),v=K.getChildByName("image",!0),{dx:b,dy:m}=v.attribute,y=new LT({x:p-u/2,y:f-u/2,width:u,height:u,image:iz.play.svg,cursor:iz.play.cursor,dx:b,dy:m});y.name="play-icon",K.appendChild(y),g.scenegraph.updateNextFrame()})),tt.onerror=()=>{et.image=iz.damage_pic.svg},tt.src=Q,tt.setAttribute("preload","auto");const et=ih({x:h[3],y:h[0],width:r-h[1]-h[3],height:s-h[2]-h[0],image:tt,cursor:"pointer"});return et.name="image",et.keepAspectRatio=a,et.textAlign=d,et.textBaseline=c,K.appendChild(et),K}function oz(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m){var y,C,w,x,_,S,A,B,T,R,k,M,L,P,E,H,O,I,F,z,D,W,N,G,j,V,U,X,$,Y,K,q,Z;const J=t._getCellStyle(r,s),Q=BR("padding",J,r,s,t);XC(Q)&&(d=Q),(null===(y=null==v?void 0:v.text)||void 0===y?void 0:y.textAlign)&&(c=null===(C=null==v?void 0:v.text)||void 0===C?void 0:C.textAlign),(null===(w=null==v?void 0:v.text)||void 0===w?void 0:w.textBaseline)&&(u=null===(x=null==v?void 0:v.text)||void 0===x?void 0:x.textBaseline);const tt=t.isAutoRowHeight(s),et="auto"===a,it=null!==(_=J.autoWrapText)&&void 0!==_?_:t.internalProps.autoWrapText,nt=J.lineClamp,ot=TR(r,s,v,t);let rt;if(m&&(rt=t.scenegraph.getCell(r,s,!0),rt&&"cell"===rt.role&&rt.setAttributes({x:n,y:o,width:l,height:h,lineWidth:null!==(A=null===(S=null==v?void 0:v.group)||void 0===S?void 0:S.lineWidth)&&void 0!==A?A:void 0,fill:null!==(T=null===(B=null==v?void 0:v.group)||void 0===B?void 0:B.fill)&&void 0!==T?T:void 0,stroke:null!==(k=null===(R=null==v?void 0:v.group)||void 0===R?void 0:R.stroke)&&void 0!==k?k:void 0,strokeArrayWidth:null!=ot?ot:void 0,strokeArrayColor:null!==(L=null===(M=null==v?void 0:v.group)||void 0===M?void 0:M.strokeArrayColor)&&void 0!==L?L:void 0,cursor:null!==(E=null===(P=null==v?void 0:v.group)||void 0===P?void 0:P.cursor)&&void 0!==E?E:void 0,lineDash:null!==(O=null===(H=null==v?void 0:v.group)||void 0===H?void 0:H.lineDash)&&void 0!==O?O:void 0,lineCap:"butt",clip:!0,cornerRadius:v.group.cornerRadius})),rt&&"cell"===rt.role||(rt=new xR({x:n,y:o,width:l,height:h,lineWidth:null!==(F=null===(I=null==v?void 0:v.group)||void 0===I?void 0:I.lineWidth)&&void 0!==F?F:void 0,fill:null!==(D=null===(z=null==v?void 0:v.group)||void 0===z?void 0:z.fill)&&void 0!==D?D:void 0,stroke:null!==(N=null===(W=null==v?void 0:v.group)||void 0===W?void 0:W.stroke)&&void 0!==N?N:void 0,strokeArrayWidth:null!=ot?ot:void 0,strokeArrayColor:null!==(j=null===(G=null==v?void 0:v.group)||void 0===G?void 0:G.strokeArrayColor)&&void 0!==j?j:void 0,cursor:null!==(U=null===(V=null==v?void 0:v.group)||void 0===V?void 0:V.cursor)&&void 0!==U?U:void 0,lineDash:null!==($=null===(X=null==v?void 0:v.group)||void 0===X?void 0:X.lineDash)&&void 0!==$?$:void 0,lineCap:"butt",clip:!0,cornerRadius:v.group.cornerRadius}),rt.role="cell",rt.col=r,rt.row=s,null==i||i.addCellGroup(rt)),p&&rt.appendChild(p),f){const i=e;let n;if(g){let e=r,i=s;b&&(e=b.start.col,i=b.start.row),n=t.getCellIcons(e,i)}(function(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p){var f,v,b,m,y,C,w,x,_;let S,A=0,B=0,T=0;if(Array.isArray(e)&&0!==e.length){const{inlineFrontIcons:f,inlineEndIcons:v,contentLeftIcons:b,contentRightIcons:R,leftIconWidth:k,rightIconWidth:M,absoluteRightIconWidth:L}=OR(e,t,p,u);let P;if(A=k,B=M,T=L,0===f.length&&0===v.length){let e=0;tw(u.theme._contentOffset)&&("left"===d?e=u.theme._contentOffset:"right"===d&&(e=-u.theme._contentOffset));const c=p?kR(p.start.col,p.start.row,u):kR(t.col,t.row,u),{text:f,moreThanMaxCharacters:v}=MR(i,u),w={text:1===f.length?f[0]:f,moreThanMaxCharacters:v,maxLineWidth:o?1/0:l-(n[1]+n[3])-A-B-c,textBaseline:"top",heightLimit:!1===(null===(m=u.options.customConfig)||void 0===m?void 0:m.limitContentHeight)||r&&!(null===(y=u.options.customConfig)||void 0===y?void 0:y.multilinesForXTable)?-1:h-Math.floor(n[0]+n[2]),pickable:!1,autoWrapText:s,lineClamp:a,wordBreak:"break-word",whiteSpace:!1===(null===(C=u.options.customConfig)||void 0===C?void 0:C.limitContentHeight)||1!==f.length||s?"normal":"no-wrap",dx:("left"===d?b.length?0:c:0)+e,keepCenterInLine:!0},x=new Fl(g.text?Object.assign({},g.text,w):w);x.name="text",P=x}else{const e=Object.assign({text:null==i?void 0:i.toString()},(null===(_=null===(x=null===(w=t.parent)||void 0===w?void 0:w.theme)||void 0===x?void 0:x.userTheme)||void 0===_?void 0:_.text)||{});g.text&&Object.assign(e,g.text),e.textBaseline="middle";const a=[...f.map((t=>PR(t))),e,...v.map((t=>PR(t)))];a[0].textAlign=d;const u=new lh({width:o?0:l-(n[1]+n[3])-A-B,height:r&&s?0:Math.ceil(h-(n[0]+n[2])),textConfig:a,verticalDirection:r&&s?"top":c,ellipsis:e.ellipsis});u.name="text",P=u,u.bindIconEvent(),!p||p.start.col===p.end.col&&p.start.row===p.end.row||(u.onBeforeAttributeUpdate=IR)}if(0!==b.length||0!==R.length){const e=new RR({x:0,y:0,fill:!1,stroke:!1,pickable:!1});e.name="content",e.setCellContentOption({autoWidth:o,autoHeight:r,cellWidth:l-(n[1]+n[3])-A-B,cellHeight:h-(n[0]+n[2]),align:d,baseline:c});const i={addedHierarchyOffset:0};b.forEach((n=>{const o=LR(n,void 0,t.col,t.row,p,u,i);o.role="icon-content-left",o.name=n.name,e.addLeftOccupyingIcon(o)})),R.forEach((n=>{const o=LR(n,void 0,t.col,t.row,p,u,i);o.role="icon-content-right",o.name=n.name,e.addRightOccupyingIcon(o)})),e.addContent(P),t.appendChild(e),e.layout(),S=e.AABBBounds.width(),e.AABBBounds.height()}else t.firstChild?t.insertBefore(P,t.firstChild):t.appendChild(P),S=P.AABBBounds.width(),P.AABBBounds.height()}else if(XC(i)){const{text:e,moreThanMaxCharacters:m}=MR(i,u),y=p?kR(p.start.col,p.start.row,u):kR(t.col,t.row,u);let C=0;tw(u.theme._contentOffset)&&("left"===d?C=u.theme._contentOffset:"right"===d&&(C=-u.theme._contentOffset));const w={text:1===e.length?e[0]:e,moreThanMaxCharacters:m,maxLineWidth:o?1/0:l-(n[1]+n[3]+y),textBaseline:"top",autoWrapText:s,lineClamp:a,wordBreak:"break-word",heightLimit:!1===(null===(f=u.options.customConfig)||void 0===f?void 0:f.limitContentHeight)||r&&!(null===(v=u.options.customConfig)||void 0===v?void 0:v.multilinesForXTable)?-1:h-Math.floor(n[0]+n[2]),pickable:!1,dx:("left"===d?y:0)+C,whiteSpace:!1===(null===(b=u.options.customConfig)||void 0===b?void 0:b.limitContentHeight)||1!==e.length||s?"normal":"no-wrap",keepCenterInLine:!0},x=new Fl(g.text?Object.assign({},g.text,w):w);x.name="text",x.textBaseline=c,t.appendChild(x),S=x.AABBBounds.width(),x.AABBBounds.height()}const R=o?A+S+B:l-(n[1]+n[3]),k=h-(n[0]+n[2]);t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+n[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+R-B+n[3]):"icon-absolute-right"===t.role?t.setAttribute("x",t.attribute.x+R-T+n[3]+n[1]):"content"!==t.name&&"text"!==t.name||("center"===d&&"richtext"!==t.type?t.setAttribute("x",n[3]+A+(R-A-B)/2):"right"===d&&"richtext"!==t.type?t.setAttribute("x",n[3]+R-B):t.setAttribute("x",n[3]+A))})),t.forEachChildren((t=>{t.name!==WT&&("middle"===c?t.setAttribute("y",n[0]+(k-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",n[0]+k-t.AABBBounds.height()):t.setAttribute("y",n[0]))})),t.setAttributes({width:R+n[1]+n[3],height:k+n[0]+n[2]})})(rt,n,i,d,et,tt,it,"number"==typeof nt?nt:void 0,rt.attribute.width,rt.attribute.height,c,u,t,v,b),(null===(Y=null==v?void 0:v._vtable)||void 0===Y?void 0:Y.marked)&&function(t,e,i){if("boolean"==typeof t){const t=bh({x:e.attribute.width,y:0,startAngle:Math.PI/2,endAngle:Math.PI,outerRadius:6,fill:"#3073F2",pickable:!1});t.name="mark",e.appendChild(t)}else{const{bgColor:i="#3073F2",shape:n="sector",position:o="right-top",size:r=10,offset:s=0}=t;let a,l,h,d,c,u;if("sector"===n)"right-top"===o?(a=e.attribute.width-s,l=s,h=Math.PI/2,d=Math.PI):"left-top"===o?(a=s,l=s,h=0,d=Math.PI/2):"right-bottom"===o?(a=e.attribute.width-s,l=e.attribute.height-s,h=Math.PI,d=Math.PI/2*3):"left-bottom"===o&&(a=s,l=e.attribute.height-s,h=Math.PI/2*3,d=2*Math.PI),c=i,u=bh({x:a,y:l,startAngle:h,endAngle:d,outerRadius:r,fill:c,pickable:!1});else if("triangle"===n){let t,n,h,d;"right-top"===o?(a=e.attribute.width-s,l=s,t=a-r,n=l,h=a,d=l+r):"left-top"===o?(a=s,l=s,t=a+r,n=l,h=a,d=l+r):"right-bottom"===o?(a=e.attribute.width-s,l=e.attribute.height-s,t=a-r,n=l,h=a,d=l-r):"left-bottom"===o&&(a=s,l=e.attribute.height-s,t=a+r,n=l,h=a,d=l-r),c=i,u=Ch({points:[{x:a,y:l},{x:t,y:n},{x:h,y:d}],fill:c,pickable:!1})}else"rect"===n&&("right-top"===o?(a=e.attribute.width-r-s,l=s):"left-top"===o?(a=s,l=s):"right-bottom"===o?(a=e.attribute.width-r-s,l=e.attribute.height-r-s):"left-bottom"===o&&(a=s,l=e.attribute.height-r-s),c=i,u=ql({x:a,y:l,width:r,height:r,fill:c,pickable:!1}));u.name="mark",e.appendChild(u)}}(null===(K=null==v?void 0:v._vtable)||void 0===K?void 0:K.marked,rt)}return p&&rt.setAttributes({width:Math.max(rt.attribute.width,null!==(q=p.attribute.width)&&void 0!==q?q:0),height:Math.max(rt.attribute.height,null!==(Z=p.attribute.height)&&void 0!==Z?Z:0)}),rt}function rz(t,e,i,n,o,r,s,a,l,h){var d,c,u,g,p;if(t.dependField){const e=n_(t.dependField,{col:r,row:s,table:l,value:n,dataValue:o,cellHeaderPaths:void 0});o=null!==(c=null===(d=l.getCellOriginRecord(r,s))||void 0===d?void 0:d[e])&&void 0!==c?c:o}const f=null!==(u=n_(t.barType,{col:r,row:s,table:l,value:n,dataValue:o,cellHeaderPaths:void 0}))&&void 0!==u?u:"default",v=null!==(g=n_(t.min,{col:r,row:s,table:l,value:n,dataValue:o,cellHeaderPaths:void 0}))&&void 0!==g?g:0,b=null!==(p=n_(t.max,{col:r,row:s,table:l,value:n,dataValue:o,cellHeaderPaths:void 0}))&&void 0!==p?p:v+100;let m=0;m=h?l.getRowsHeight(h.start.row,h.end.row):l.getRowHeight(s);let y=i,C=m,w=0;tw(l.theme._contentOffset)&&(w=l.theme._contentOffset);const x=new xR({x:-w,y:-w,width:y,height:C});x.name="progress-bar";const{showBar:_,barColor:S,barBgColor:A,barPositiveColor:B,barNegativeColor:T,barAxisColor:R,barRightToLeft:k,showBarMark:M,barMarkPositiveColor:L,barMarkNegativeColor:P,barMarkWidth:E,barMarkPosition:H,barMarkInBar:O}=e;let{barHeight:I,barBottom:F,barPadding:z}=e;1===z.length?z=[z[0],z[0],z[0],z[0]]:2===z.length?z=[z[0],z[1],z[0],z[1]]:3===z.length&&(z=[z[0],z[1],z[2],z[1]]),z=z.map(((t,e)=>{if("string"==typeof t&&u_.endsWith(t,"%")){const n=Number(t.substr(0,t.length-1));return 0===e||2===e?m*n/100:i*n/100}return Number(t)}));const D=UB(AR("borderLineWidth",e,r,s,l)),W=Math.max(z[0],Math.ceil(D[0]/2));let N=Math.max(z[1],Math.floor(D[1]/2));const G=Math.max(z[2],Math.floor(D[2]/2));let j=Math.max(z[3],Math.ceil(D[3]/2));M&&E>0&&"right"===H&&!1===O&&(N+=E,j+=E),y-=N+j,C-=G+W,s===l.rowCount-1&&[0,"0"].includes(F)&&(C-=1);const V=W,U=j,X=y;if("string"==typeof I&&u_.endsWith(I,"%")?(I=Number(I.substr(0,I.length-1)),I=C*I/100):I=Number(I),"string"==typeof F&&u_.endsWith(F,"%")?(F=Number(F.substr(0,F.length-1)),F=C*F/100):F=Number(F),n_(_,{col:r,row:s,table:l,context:null,value:n,dataValue:o})){let t=`${o}`;u_.endsWith(t,"%")&&(t=t.substr(0,t.length-1));const e=Number(t);if(isNaN(e))return x;if("default"===(null!=f?f:"default")){const t=e<v?0:e>b?1:(e-v)/(b-v),i=y,a=V+C-I-F;let h=Math.min(i*t,i);const d=k?U+X-h:U;r!==l.colCount-1||1!==t||k||(h-=1);const c=n_(A,{col:r,row:s,table:l,context:null,value:n,dataValue:o,percentile:t});if(c){const t=ql({x:d,y:a,width:i,height:I,fill:c});x.addChild(t)}const u=ql({x:d,y:a,width:h,height:I,fill:n_(S,{col:r,row:s,table:l,context:null,value:n,dataValue:o,percentile:t})||"#20a8d8"});x.addChild(u)}else if("negative"===f){const t=v<0?-v:0,i=b>0?b:0,a=t/(t+i),h=1-a,d=e>0?e/i:0,c=e<0?-e/t:0,u=y,g=V+C-I-F,p=U,f=n_(A,{col:r,row:s,table:l,context:null,value:n,dataValue:o,percentile:d});if(f){const t=ql({x:p,y:g,width:u,height:I,fill:f});x.addChild(t)}const w=k?h*u:a*u,_=Math.min(u*a*c,u),S=k?{left:p+w,top:g,width:_,height:I}:{left:p+w-_,top:g,width:_,height:I},z=n_(T,{col:r,row:s,table:l,context:null,value:n,dataValue:o,percentile:c})||"#20a8d8",D=ql({x:S.left,y:S.top,width:S.width,height:S.height,fill:z});x.addChild(D);let W=Math.min(u*h*d,u);r!==l.colCount-1||1!==d||k||(W-=1);const N=k?{left:p+w-W,top:g,width:W,height:I}:{left:p+w,top:g,width:W,height:I},G=n_(B,{col:r,row:s,table:l,context:null,value:n,dataValue:o,percentile:d})||"#20a8d8",j=ql({x:N.left,y:N.top,width:N.width,height:N.height,fill:G});x.addChild(j);const X=k?S.left:N.left,$=$l({x:0,y:0,stroke:n_(R,{col:r,row:s,table:l,context:null,value:n,dataValue:o,percentile:d}),lineWidth:1,lineDash:[2,2],points:[{x:X,y:0},{x:X,y:m}]});if(x.addChild($),M&&(d||c)){const t=E,e=[];let i;if(d>0)if(i=n_(L,{col:r,row:s,table:l,context:null,value:n,dataValue:o,percentile:d})||"#20a8d8","right"===H){const t=k?N.left+E/2:N.left+N.width+(O?-E/2:E/2);e.push({x:t,y:N.top}),e.push({x:t,y:N.top+N.height})}else"bottom"===H&&(e.push({x:N.left,y:N.top+N.height-E/2}),e.push({x:N.left+N.width,y:N.top+N.height-E/2}));else if(c>0)if(i=n_(P,{col:r,row:s,table:l,context:null,value:n,dataValue:o,percentile:c})||"#20a8d8","right"===H){const t=k?S.left+S.width-E/2:S.left+E/2;e.push({x:t,y:S.top}),e.push({x:t,y:S.top+S.height})}else"bottom"===H&&(e.push({x:S.left,y:S.top+S.height-E/2}),e.push({x:S.left+S.width,y:S.top+S.height-E/2}));const a=$l({x:0,y:0,stroke:i,lineWidth:t,points:e});x.addChild(a)}}else if("negative_no_axis"===f){const t=v<0?-v:0,i=b>0?b:0,a=Math.max(t,i),h=0===a?0:Math.abs(e)/a,d=y;let c=Math.min(d*h,d);r!==l.colCount-1||1!==h||k||(c-=1);const u=V+C-I-F,g=k?U+X-c:U,p=n_(A,{col:r,row:s,table:l,context:null,value:n,dataValue:o,percentile:h});if(p){const t=ql({x:g,y:u,width:d,height:I,fill:p});x.addChild(t)}const f={left:g,top:u,width:c,height:I};let m;m=e>=0?n_(B,{col:r,row:s,table:l,context:null,value:n,percentile:h,dataValue:o})||"#20a8d8":n_(T,{col:r,row:s,table:l,context:null,value:n,dataValue:o,percentile:h})||"#20a8d8";const w=ql({x:f.left,y:f.top,width:f.width,height:f.height,fill:m});if(x.addChild(w),M&&e){const t=E,i=[];let a;if(a=e>=0?n_(L,{col:r,row:s,table:l,context:null,value:n,dataValue:o,percentile:h})||"#20a8d8":n_(P,{col:r,row:s,table:l,context:null,value:n,dataValue:o,percentile:h})||"#20a8d8","right"===H){const t=k?f.left+E/2:f.left+f.width-E/2;i.push({x:t,y:f.top}),i.push({x:t,y:f.top+f.height})}else"bottom"===H&&(i.push({x:f.left,y:f.top+f.height-E/2}),i.push({x:f.left+f.width,y:f.top+f.height-E/2}));const d=$l({x:0,y:0,stroke:a,lineWidth:t,points:i});x.addChild(d)}}}return x}function sz(t,e,i,n,o,r){var s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w;if((null==i?void 0:i.zero)&&(t=Math.min(t,0),e=Math.max(e,0)),null==i?void 0:i.expand){const n=t,o=e;XC(i.expand.min)&&(t=n-(o-n)*i.expand.min),XC(i.expand.max)&&(e=o+(o-n)*i.expand.max)}let x,_;if(tw(null==i?void 0:i.min)&&(t=i.min),tw(null==i?void 0:i.max)&&(e=i.max),"log"===(null==i?void 0:i.type)?(x=new qI,x.base(null!==(s=null==i?void 0:i.base)&&void 0!==s?s:10)):"symlog"===(null==i?void 0:i.type)?(x=new ZI,x.constant(null!==(a=null==i?void 0:i.constant)&&void 0!==a?a:10)):x=new XI,x.domain([t,e],!!(null==i?void 0:i.nice)),r)!function(t,e){t.niceMax(e.targetTicks.length)}(x,r);else if(null==i?void 0:i.nice){let t=null!==(c=null!==(h=null===(l=i.tick)||void 0===l?void 0:l.forceTickCount)&&void 0!==h?h:null===(d=i.tick)||void 0===d?void 0:d.tickCount)&&void 0!==c?c:10;VC(t)&&(t=t({axisLength:o,labelStyle:null!==(g=null===(u=null==i?void 0:i.label)||void 0===u?void 0:u.style)&&void 0!==g?g:{fontSize:$O}})),"accurateFirst"===i.niceType&&(t=Math.max(10,t)),UC(i.min)&&UC(i.max)?x.nice(t):XC(i.min)&&UC(i.max)?x.niceMax(t):UC(i.min)&&XC(i.max)&&x.niceMin(t)}return delete x._niceType,_=(null!==(f=null===(p=null==r?void 0:r.targetTicks)||void 0===p?void 0:p.length)&&void 0!==f?f:null===(v=null==i?void 0:i.tick)||void 0===v?void 0:v.forceTickCount)?x.forceTicks(null!==(m=null===(b=null==r?void 0:r.targetTicks)||void 0===b?void 0:b.length)&&void 0!==m?m:null===(y=null==i?void 0:i.tick)||void 0===y?void 0:y.forceTickCount):x.ticks(tw(null===(C=null==i?void 0:i.tick)||void 0===C?void 0:C.tickCount)?i.tick.tickCount:5,{noDecimals:null===(w=null==i?void 0:i.tick)||void 0===w?void 0:w.noDecimals}),{range:x.domain(),ticks:_}}function az(t,e,i,n,o,r,s,a,l,h,d,c,u,g,p,f,v,b){var m,y,C,w,x,_,S,A,B,T,R,k,M,L,P,E,H,O,I,F,z,D,W,N;if(!t){const s=TR(o,r,p,g);b&&(t=g.scenegraph.highPerformanceGetCell(o,r,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:n,width:a,height:l,lineWidth:null!==(y=null===(m=null==p?void 0:p.group)||void 0===m?void 0:m.lineWidth)&&void 0!==y?y:void 0,fill:null!==(w=null===(C=null==p?void 0:p.group)||void 0===C?void 0:C.fill)&&void 0!==w?w:void 0,stroke:null!==(_=null===(x=null==p?void 0:p.group)||void 0===x?void 0:x.stroke)&&void 0!==_?_:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(A=null===(S=null==p?void 0:p.group)||void 0===S?void 0:S.strokeArrayColor)&&void 0!==A?A:void 0,cursor:null!==(T=null===(B=null==p?void 0:p.group)||void 0===B?void 0:B.cursor)&&void 0!==T?T:void 0,lineDash:null!==(k=null===(R=null==p?void 0:p.group)||void 0===R?void 0:R.lineDash)&&void 0!==k?k:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),t&&"cell"===t.role||((t=new xR({x:i,y:n,width:a,height:l,lineWidth:null!==(L=null===(M=null==p?void 0:p.group)||void 0===M?void 0:M.lineWidth)&&void 0!==L?L:void 0,fill:null!==(E=null===(P=null==p?void 0:p.group)||void 0===P?void 0:P.fill)&&void 0!==E?E:void 0,stroke:null!==(O=null===(H=null==p?void 0:p.group)||void 0===H?void 0:H.stroke)&&void 0!==O?O:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(F=null===(I=null==p?void 0:p.group)||void 0===I?void 0:I.strokeArrayColor)&&void 0!==F?F:void 0,cursor:null!==(D=null===(z=null==p?void 0:p.group)||void 0===z?void 0:z.cursor)&&void 0!==D?D:void 0,lineDash:null!==(N=null===(W=null==p?void 0:p.group)||void 0===W?void 0:W.lineDash)&&void 0!==N?N:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",t.col=o,t.row=r,null==e||e.addCellGroup(t))}let G;if(u){let t=o,e=r;v&&(t=v.start.col,e=v.start.row),G=g.getCellIcons(t,e)}let j=0,V=0;if(Array.isArray(G)&&0!==G.length){const{leftIconWidth:e,rightIconWidth:i,absoluteLeftIconWidth:n,absoluteRightIconWidth:o}=OR(G,t,v,g);j=e+i,V=e,t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+a-i-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+a-o-h[1])})),t.forEachChildren((t=>{"middle"===c?t.setAttribute("y",(l-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",l-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])}))}const U=function(t,e,i,n,o,r,s,a,l){var h,d;const c=l._getCellStyle(t,e),u=AR("buttonColor",c,t,e,l),g=AR("buttonBorderColor",c,t,e,l),p=AR("buttonLineWidth",c,t,e,l),f=AR("buttonBorderRadius",c,t,e,l),v=AR("buttonHoverColor",c,t,e,l),b=AR("buttonHoverBorderColor",c,t,e,l),m=AR("buttonPadding",c,t,e,l),y=AR("buttonTextHoverColor",c,t,e,l),C=AR("buttonDisableColor",c,t,e,l),w=AR("buttonDisableBorderColor",c,t,e,l),x=AR("buttonTextDisableColor",c,t,e,l),_=l.getCellValue(t,e),S=l.getCellOriginValue(t,e),A=kR(t,e,l),B=l._getCellStyle(t,e),T=null!==(h=B.autoWrapText)&&void 0!==h?h:l.internalProps.autoWrapText,{lineClamp:R}=B,k="auto"===i,M=l.isAutoRowHeight(e),{disable:L,text:P}=a,E=n_(L,{col:t,row:e,table:l,context:null,value:_,dataValue:S}),H=n_(P,{col:t,row:e,table:l,context:null,value:_,dataValue:S}),O=null!==(d=null!=H?H:_)&&void 0!==d?d:"",I={maxLineWidth:k?1/0:n-(r[1]+r[3]+A),textAlign:"left",textBaseline:"top",autoWrapText:T,lineClamp:R,wordBreak:"break-word",heightLimit:M?-1:o-Math.floor(r[0]+r[2]),pickable:!1,dx:A,whiteSpace:1!==O.length||T?"normal":"no-wrap"},F=s.text?Object.assign({},s.text,I):I,z={x:0,y:0,cursor:E?"not-allowed":"pointer",disable:E,childrenPickable:!1,text:1===O.length?O[0]:O,textStyle:F,padding:m,panel:{visible:!0,fill:E?C:u,stroke:E?w:g,lineWidth:p,cornerRadius:f},state:{text:{hover:{}},panel:{hover:{fill:v,stroke:b}}}};x&&(z.state.text.fill=x),y&&(z.state.text.hover.fill=y);const D=new ym(z);return D.name="button",E||(D.addEventListener("mouseenter",(()=>{D.addState("hover",!0,!1),D.stage.renderNextFrame()})),D.addEventListener("mouseleave",(()=>{D.removeState("hover",!1),D.stage.renderNextFrame()}))),D}(o,r,s-j,a,l,h,p,f,g);return U&&t.appendChild(U),a-=h[1]+h[3]+j,l-=h[0]+h[2],"center"===d?U.setAttribute("x",h[3]+V+(a-U.AABBBounds.width())/2):"right"===d?U.setAttribute("x",h[3]+V+a-U.AABBBounds.width()):U.setAttribute("x",h[3]+V),"middle"===c?U.setAttribute("y",h[0]+(l-U.AABBBounds.height())/2):"bottom"===c?U.setAttribute("y",h[0]+l-U.AABBBounds.height()):U.setAttribute("y",h[0]),t}J_.registerComponent("axis",sF),J_.registerFunction("computeAxisComponentWidth",aF),J_.registerFunction("computeAxisComponentHeight",lF),J_.registerFunction("getAxisConfigInPivotChart",fH),J_.registerComponent("emptyTip",cF),J_.registerFunction("createLegend",CF),J_.registerComponent("menuHandler",kF),J_.registerComponent("title",MF),J_.registerComponent("tooltipHandler",WF),J_.registerComponent("listTreeStickCellPlugin",NF),J_.registerComponent("customCellStylePlugin",_H),J_.registerFunction("createChartCellGroup",UF),J_.registerFunction("getAxisDomainRangeAndLabels",sz),J_.registerFunction("createCheckboxCellGroup",$F),J_.registerFunction("createImageCellGroup",FR),J_.registerFunction("createProgressBarCell",rz),J_.registerFunction("createRadioCellGroup",YF),J_.registerFunction("createSwitchCellGroup",qF),J_.registerFunction("createButtonCellGroup",az),J_.registerFunction("createSparkLineCellGroup",QF),J_.registerFunction("createTextCellGroup",oz),J_.registerFunction("createVideoCellGroup",nz);class lz extends nI{}class hz extends Ea{constructor(t){var e,i,n,o,r,s,a,l,h,d,c,u,g,p;t.direction&&(t.flexDirection=t.direction),!t.justifyContent||"start"!==t.justifyContent&&"end"!==t.justifyContent||(t.justifyContent="flex-"+t.justifyContent),!t.alignItems||"start"!==t.alignItems&&"end"!==t.alignItems||(t.alignItems="flex-"+t.alignItems),!t.alignContent||"start"!==t.alignContent&&"end"!==t.alignContent||(t.alignContent="flex-"+t.alignContent),t.display="flex",t.flexDirection||(t.flexDirection="row"),t.clip=!0,t.fill=null===(e=null==t?void 0:t.background)||void 0===e?void 0:e.fill,t.stroke=null===(i=null==t?void 0:t.background)||void 0===i?void 0:i.stroke,t.lineWidth=null===(n=null==t?void 0:t.background)||void 0===n?void 0:n.lineWidth,t.cornerRadius=null===(o=null==t?void 0:t.background)||void 0===o?void 0:o.cornerRadius;const f=ZC(t.boundsPadding),v=[null!==(s=null!==(r=t.marginTop)&&void 0!==r?r:f?t.boundsPadding[0]:t.boundsPadding)&&void 0!==s?s:0,null!==(l=null!==(a=t.marginRight)&&void 0!==a?a:f?t.boundsPadding[1]:t.boundsPadding)&&void 0!==l?l:0,null!==(c=null!==(h=t.marginBottom)&&void 0!==h?h:f?null!==(d=t.boundsPadding[2])&&void 0!==d?d:t.boundsPadding[0]:t.boundsPadding)&&void 0!==c?c:0,null!==(p=null!==(u=t.marginLeft)&&void 0!==u?u:f?null!==(g=t.boundsPadding[3])&&void 0!==g?g:t.boundsPadding[1]:t.boundsPadding)&&void 0!==p?p:0];t.boundsPadding=v,super(t)}}var dz=Object.freeze({__proto__:null,Arc:class extends vh{constructor(t){var e,i,n,o,r,s,a,l,h,d;const c=ZC(t.boundsPadding),u=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:c?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(o=null!==(n=t.marginRight)&&void 0!==n?n:c?t.boundsPadding[1]:t.boundsPadding)&&void 0!==o?o:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:c?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:c?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=u,super(t)}},CheckBox:vC,Circle:class extends El{constructor(t){var e,i,n,o,r,s,a,l,h,d;const c=ZC(t.boundsPadding),u=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:c?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(o=null!==(n=t.marginRight)&&void 0!==n?n:c?t.boundsPadding[1]:t.boundsPadding)&&void 0!==o?o:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:c?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:c?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=u,super(t)}},Container:hz,Group:class extends Ea{constructor(t){var e,i,n,o,r,s,a,l,h,d;const c=ZC(t.boundsPadding),u=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:c?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(o=null!==(n=t.marginRight)&&void 0!==n?n:c?t.boundsPadding[1]:t.boundsPadding)&&void 0!==o?o:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:c?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:c?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=u,super(t)}},GroupElement:class extends hz{constructor(t){t.flexWrap="nowrap",super(t)}},Icon:class extends eh{constructor(t){var e,i,n,o,r,s,a,l,h,d,c,u;let g;qC(t.iconName)&&(g=wR()[t.iconName],g&&(t.width=null!==(e=t.width)&&void 0!==e?e:g.width,t.height=null!==(i=t.height)&&void 0!==i?i:g.height,t.svg=g.svg,t.cursor=g.cursor)),t.svg&&(t.image=t.svg);const p=ZC(t.boundsPadding),f=[null!==(o=null!==(n=t.marginTop)&&void 0!==n?n:p?t.boundsPadding[0]:t.boundsPadding)&&void 0!==o?o:0,null!==(s=null!==(r=t.marginRight)&&void 0!==r?r:p?t.boundsPadding[1]:t.boundsPadding)&&void 0!==s?s:0,null!==(h=null!==(a=t.marginBottom)&&void 0!==a?a:p?null!==(l=t.boundsPadding[2])&&void 0!==l?l:t.boundsPadding[0]:t.boundsPadding)&&void 0!==h?h:0,null!==(u=null!==(d=t.marginLeft)&&void 0!==d?d:p?null!==(c=t.boundsPadding[3])&&void 0!==c?c:t.boundsPadding[1]:t.boundsPadding)&&void 0!==u?u:0];t.boundsPadding=f,super(t),this.cache=g}},Image:class extends eh{constructor(t){var e,i,n,o,r,s,a,l,h,d;t.src&&(t.image=t.src),"circle"===t.shape&&(t.cornerRadius=t.width/2);const c=ZC(t.boundsPadding),u=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:c?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(o=null!==(n=t.marginRight)&&void 0!==n?n:c?t.boundsPadding[1]:t.boundsPadding)&&void 0!==o?o:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:c?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:c?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=u,super(t)}},Line:Xl,Radio:bC,Rect:class extends Kl{constructor(t){var e,i,n,o,r,s,a,l,h,d;const c=ZC(t.boundsPadding),u=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:c?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(o=null!==(n=t.marginRight)&&void 0!==n?n:c?t.boundsPadding[1]:t.boundsPadding)&&void 0!==o?o:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:c?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:c?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=u,super(t)}},Tag:class extends ym{constructor(t){var e,i,n,o,r,s,a,l,h,d;const c=ZC(t.boundsPadding),u=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:c?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(o=null!==(n=t.marginRight)&&void 0!==n?n:c?t.boundsPadding[1]:t.boundsPadding)&&void 0!==o?o:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:c?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:c?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=u,super(t)}getSize(t){this.AABBBounds.width()}},Text:class extends Fl{constructor(t){var e,i,n,o,r,s,a,l,h,d,c;t.textBaseline||(t.textBaseline="top");const u=ZC(t.boundsPadding),g=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:u?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(o=null!==(n=t.marginRight)&&void 0!==n?n:u?t.boundsPadding[1]:t.boundsPadding)&&void 0!==o?o:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:u?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:u?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=g,t.fill=null!==(c=t.fill)&&void 0!==c?c:"#000",super(t)}getSize(t){this.AABBBounds.width()}},percentCalc:function(t){return{percent:t,delta:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}}});wC();class cz extends Ea{milestoneTextLabel;milestoneTextContainer;clipGroupBox;barRect;progressRect;textLabel;task_index;sub_task_index;record;labelStyle;_lastWidth;_lastHeight;_lastX;_lastY;constructor(t){super(t),this._lastWidth=t.width,this._lastHeight=t.height,this._lastX=t.x,this._lastY=t.y}updateTextPosition(){if(!this.textLabel||!this.barRect)return;const t=this.labelStyle||{},{textAlign:e="left",textBaseline:i="middle",textOverflow:n,color:o="#333333",outsideColor:r="#333333",padding:s=8}=t,a=Array.isArray(s)?s[3]:s,l=this.barRect.attribute.width,h=this.barRect.attribute.height,d=this.textLabel.attribute.fontSize||12,c=this.textLabel.attribute.fontFamily||"Arial",u=String(this.textLabel.attribute.text||""),g=dk.measureTextWidth(u,{fontSize:d,fontFamily:c})+2*a<=l,p=Pw(MC(a),e,i,l,h),f=t.orient||(!g&&t.orientHandleWithOverflow?t.orientHandleWithOverflow:null);if(this.textLabel.setAttribute("visible",!0),this.textLabel.setAttribute("textBaseline",i),f){this.textLabel.parent?.removeChild(this.textLabel),this.appendChild(this.textLabel),this.textLabel.setAttribute("fill",r),this.textLabel.setAttribute("ellipsis",void 0),this.textLabel.setAttribute("maxLineWidth",void 0),this.textLabel.setAttribute("zIndex",1e4),this.setAttribute("zIndex",1e4);const t={left:{x:-a,y:h/2,align:"right",baseline:"middle"},right:{x:l+a,y:h/2,align:"left",baseline:"middle"},top:{x:l/2,y:-a,align:"center",baseline:"bottom"},bottom:{x:l/2,y:h+a,align:"center",baseline:"top"}}[f];t&&(this.textLabel.setAttribute("x",t.x),this.textLabel.setAttribute("y",t.y),this.textLabel.setAttribute("textAlign",t.align),this.textLabel.setAttribute("textBaseline",t.baseline))}else this.textLabel.parent?.removeChild(this.textLabel),this.clipGroupBox?.appendChild(this.textLabel),this.textLabel.setAttribute("x",p.x),this.textLabel.setAttribute("y",p.y),this.textLabel.setAttribute("textAlign",e),this.textLabel.setAttribute("fill",o),this.textLabel.setAttribute("maxLineWidth",l-a),this.textLabel.setAttribute("ellipsis","clip"===n?"":"ellipsis"===n?"...":XC(n)?n:void 0)}}const uz='<svg width="100" height="200" xmlns="http://www.w3.org/2000/svg">\n  <line x1="30" y1="10" x2="30" y2="190" stroke="black" stroke-width="4"/>\n  <line x1="70" y1="10" x2="70" y2="190" stroke="black" stroke-width="4"/>\n</svg>',gz=10;class pz{formatMilestoneText(t,e){if(!t)return"";const i=t.match(/{([^}]+)}/g);return i&&i.forEach((i=>{const n=i.substring(1,i.length-1),o=e[n];void 0!==o&&(t=t.replace(i,String(o)))})),t}calculateMilestoneTextPosition(t,e,i=4){const n="number"==typeof i?i:4;let o=0,r=0,s="left",a="middle";const l=e/2;switch(t){case"left":o=-n,r=l,s="end",a="middle";break;case"right":default:o=e+n,r=l,s="start",a="middle";break;case"top":o=l,r=-n,s="center",a="bottom";break;case"bottom":o=l,r=e+n,s="center",a="top"}return{textX:o,textY:r,textAlignValue:s,textBaselineValue:a}}group;barContainer;hoverBarGroup;creatingDependencyLine;hoverBarLeftIcon;hoverBarRightIcon;_scene;width;height;selectedBorders=[];constructor(t){this._scene=t,this.width=t._gantt.tableNoFrameWidth,this.height=t._gantt.gridHeight,this.group=new Ea({x:0,y:t._gantt.getAllHeaderRowsHeight(),width:this.width,height:this.height,pickable:!1,clip:!0}),this.group.name="task-bar-container",t.ganttGroup.addChild(this.group),this.initBars(),this.initHoverBarIcons()}initBars(){this.barContainer=new Ea({x:0,y:0,width:this._scene._gantt.getAllDateColsWidth(),height:this._scene._gantt.getAllTaskBarsHeight(),pickable:!1,clip:!0}),this.group.appendChild(this.barContainer);for(let t=0;t<this._scene._gantt.itemCount;t++)if(this._scene._gantt.parsedOptions.tasksShowMode!==n.Sub_Tasks_Inline&&this._scene._gantt.parsedOptions.tasksShowMode!==n.Sub_Tasks_Separate&&this._scene._gantt.parsedOptions.tasksShowMode!==n.Sub_Tasks_Arrange&&this._scene._gantt.parsedOptions.tasksShowMode!==n.Sub_Tasks_Compact)if(this._scene._gantt.parsedOptions.tasksShowMode!==n.Project_Sub_Tasks_Inline){const e=this.initBar(t);e&&this.barContainer.appendChild(e)}else{const e=this._scene._gantt.getRecordByIndex(t),i="expand"===e.hierarchyState;if(e.type===o.PROJECT&&e.children?.length>0&&!i){const i=this._scene._gantt.getRecordIndexByTaskShowIndex(t),n=Array.isArray(i)?[...i]:[i],r=(e,i)=>{if(e.children?.length>0)for(let n=0;n<e.children?.length;n++){const s=e.children[n];if(s.type!==o.PROJECT){const o=this.initBar(t,[...i,n],e.children.length);o&&this.barContainer.appendChild(o)}else r(s,[...i,n])}};r(e,n)}else{const e=this.initBar(t);e&&this.barContainer.appendChild(e)}}else{const e=this._scene._gantt.getRecordByIndex(t);if(e.children?.length>0)for(let i=0;i<e.children?.length;i++){const n=this.initBar(t,i,e.children.length);n&&this.barContainer.appendChild(n)}else{const e=this.initBar(t);e&&this.barContainer.appendChild(e)}}}initBar(t,e,i){const r=this._scene._gantt.parsedOptions.taskBarCustomLayout,{startDate:s,endDate:a,taskDays:l,progress:h,taskRecord:d}=this._scene._gantt.getTaskInfoByTaskListIndex(t,e),c=d.type===o.MILESTONE;if(c&&!s||!c&&(l<=0||!s||!a||s.getTime()>a.getTime()))return null;const{unit:u,step:g}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],p=DC(a,s,u,g,1)*this._scene._gantt.parsedOptions.timelineColWidth,f=this._scene._gantt.getTaskBarStyle(t,e),v=f.width,b=this._scene._gantt.parsedOptions.rowHeight,m=this._scene._gantt.parsedOptions.taskBarMilestoneStyle.width,y=DC(s,this._scene._gantt.parsedOptions.minDate,u,g)*this._scene._gantt.parsedOptions.timelineColWidth-(c?m/2:0),C=this._scene._gantt.getRowsHeightByIndex(0,t-1)+(this._scene._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Separate?(e??0)*b:this._scene._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact?d.vtable_gantt_showIndex*b:0)+(b-(c?m:v))/2,w=new cz({x:y,y:C,width:c?m:p,height:c?m:v,cornerRadius:c?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.cornerRadius:f.cornerRadius,lineWidth:c?2*this._scene._gantt.parsedOptions.taskBarMilestoneStyle.borderLineWidth:2*(f.borderLineWidth??f.borderWidth),stroke:c?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.borderColor:f.borderColor,angle:c?.25*Math.PI:0,anchor:c?[y+m/2,C+m/2]:void 0});w.name="task-bar",w.task_index=t,w.sub_task_index=e,w.record=d;const x=new Ea({x:0,y:0,width:w.attribute.width,height:w.attribute.height,cornerRadius:c?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.cornerRadius:f.cornerRadius,clip:!0});let _;x.name="task-bar-group",w.appendChild(x),w.clipGroupBox=x;let S=!0,A=!0;if(r){let e;if("function"==typeof r){e=r({width:p,height:v,index:t,startDate:s,endDate:a,taskDays:l,progress:h,taskRecord:d,ganttInstance:this._scene._gantt})}else e=r;e&&(_=e.rootContainer,S=e.renderDefaultBar??!1,A=e.renderDefaultText??!1,_&&(_.name="task-bar-custom-render"))}if(S){const t=ql({x:0,y:0,width:w.attribute.width,height:w.attribute.height,fill:c?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.fillColor:f.barColor,pickable:!1});if(t.name="task-bar-rect",x.appendChild(t),w.barRect=t,d.type!==o.MILESTONE){const t=ql({x:0,y:0,width:p*h/100,height:v,fill:f.completedBarColor,pickable:!1});t.name="task-bar-progress-rect",x.appendChild(t),w.progressRect=t}}if(_&&x.appendChild(_),A&&d.type!==o.MILESTONE){const{textAlign:t,textBaseline:e,fontSize:i,fontFamily:n,textOverflow:o,color:r,padding:s}=this._scene._gantt.parsedOptions.taskBarLabelStyle,a=Pw(MC(s),t,e,p,v),l=zl({x:a.x,y:a.y,fontSize:i,fill:r,fontFamily:n,text:kC(this._scene._gantt.parsedOptions.taskBarLabelText,d),maxLineWidth:p-gz,textBaseline:e,textAlign:t,ellipsis:"clip"===o?"":"ellipsis"===o?"...":XC(o)?o:void 0,poptip:{position:"bottom"}});x.appendChild(l),w.textLabel=l,w.labelStyle=this._scene._gantt.parsedOptions.taskBarLabelStyle,w.updateTextPosition()}if(A&&"milestone"===d.type&&this._scene._gantt.parsedOptions.taskBarMilestoneStyle.labelText){const t=this._scene._gantt.parsedOptions.taskBarMilestoneStyle,e=t.labelTextStyle||{},i=this.calculateMilestoneTextPosition(t.textOrient||"right",t.width,e.padding??4),n=new Ea({x:y,y:C,width:t.width,height:t.width,angle:0,pickable:!1}),o=zl({x:i.textX,y:i.textY,fontSize:e.fontSize||16,fontFamily:e.fontFamily||"Arial",fill:e.color||"#ff0000",textBaseline:e.textBaseline||i.textBaselineValue,textAlign:e.textAlign||i.textAlignValue,text:this.formatMilestoneText(t.labelText,d),pickable:!1});n.appendChild(o),this.barContainer.appendChild(n),w.milestoneTextLabel=o,w.milestoneTextContainer=n}return w}updateTaskBarNode(t,e){const i=this.getTaskBarNodeByIndex(t,e);i&&this.barContainer.removeChild(i);const n=this.initBar(t,e);n&&(this.barContainer.insertInto(n,t),n.updateTextPosition())}initHoverBarIcons(){const t=new Ea({x:0,y:0,width:100,height:100,clip:!0,pickable:!1,cornerRadius:this._scene._gantt.parsedOptions.taskBarHoverStyle.cornerRadius??Aw.cornerRadius??0,fill:this._scene._gantt.parsedOptions.taskBarHoverStyle.barOverlayColor,visibleAll:!1});if(this.hoverBarGroup=t,t.name="task-bar-hover-shadow",this._scene._gantt.parsedOptions.taskBarResizable){const e=new eh({x:0,y:0,width:gz,height:20,image:uz,pickable:!0,cursor:"col-resize"});e.name="task-bar-hover-shadow-left-icon",this.hoverBarLeftIcon=e,t.appendChild(e);const i=new eh({x:0,y:0,width:gz,height:20,image:uz,pickable:!0,cursor:"col-resize"});i.name="task-bar-hover-shadow-right-icon",this.hoverBarRightIcon=i,t.appendChild(i)}}setX(t){this.barContainer.setAttribute("x",t)}setY(t){this.barContainer.setAttribute("y",t)}refresh(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttributes({height:this.height,width:this.width,y:this._scene._gantt.getAllHeaderRowsHeight()});const t=this.barContainer.attribute.x,e=this.barContainer.attribute.y;this.barContainer.removeAllChild(),this.group.removeChild(this.barContainer),this.initBars(),this.setX(t),this.setY(e)}resize(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttribute("width",this.width),this.group.setAttribute("height",this.height)}showHoverBar(t,e,i,n,r){const{startDate:s,endDate:a,taskRecord:l}=this._scene._gantt.getTaskInfoByTaskListIndex(r.task_index,r.sub_task_index);r&&"task-bar"===r.name&&r.appendChild(this.hoverBarGroup),this.hoverBarGroup.setAttribute("x",0),this.hoverBarGroup.setAttribute("y",0),this.hoverBarGroup.setAttribute("width",i),this.hoverBarGroup.setAttribute("height",n),this.hoverBarGroup.setAttribute("visibleAll",!0);const h=this._scene._gantt.getTaskBarStyle(r.task_index,r.sub_task_index);if(l.type===o.MILESTONE)this.hoverBarGroup.setAttribute("cornerRadius",r.attribute.cornerRadius);else{const t=this._scene._gantt.parsedOptions.taskBarHoverStyle.cornerRadius??h.cornerRadius??0;this.hoverBarGroup.setAttribute("cornerRadius",t)}this.hoverBarLeftIcon?.setAttribute("visible",!1),this.hoverBarRightIcon?.setAttribute("visible",!1);let d=!0,c=!0;if(l.type===o.MILESTONE)d=!1,c=!1;else if("function"==typeof this._scene._gantt.parsedOptions.taskBarResizable){const t={index:r.task_index,startDate:s,endDate:a,taskRecord:l,ganttInstance:this._scene._gantt},e=this._scene._gantt.parsedOptions.taskBarResizable(t);Array.isArray(e)?[d,c]=e:(d=e,c=e)}else Array.isArray(this._scene._gantt.parsedOptions.taskBarResizable)?[d,c]=this._scene._gantt.parsedOptions.taskBarResizable:(d=this._scene._gantt.parsedOptions.taskBarResizable,c=this._scene._gantt.parsedOptions.taskBarResizable);d&&this.hoverBarLeftIcon.setAttribute("visible",!0),c&&this.hoverBarRightIcon.setAttribute("visible",!0),this.hoverBarLeftIcon&&(this.hoverBarLeftIcon.setAttribute("x",0),this.hoverBarLeftIcon.setAttribute("y",Math.ceil(n/10)),this.hoverBarLeftIcon.setAttribute("width",gz),this.hoverBarLeftIcon.setAttribute("height",n-2*Math.ceil(n/10)),this.hoverBarRightIcon.setAttribute("x",i-gz),this.hoverBarRightIcon.setAttribute("y",Math.ceil(n/10)),this.hoverBarRightIcon.setAttribute("width",gz),this.hoverBarRightIcon.setAttribute("height",n-2*Math.ceil(n/10)))}hideHoverBar(){this.hoverBarGroup.setAttribute("visibleAll",!1)}createSelectedBorder(t,e,i,n,r,s=!1){const a=r.record,l=new Ea({x:t,y:e,width:i,height:n,pickable:!1,attachedToTaskBarNode:r,zIndex:1e4});l.name="task-bar-select-border",this.barContainer.appendChild(l),this.selectedBorders.push(l);const h=new Ea({x:0,y:0,width:i,height:n,lineWidth:this._scene._gantt.parsedOptions.taskBarSelectedStyle.borderLineWidth,pickable:!1,cornerRadius:r.attribute.cornerRadius,fill:!1,stroke:this._scene._gantt.parsedOptions.taskBarSelectedStyle.borderColor,shadowColor:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowColor,shadowOffsetX:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowOffsetX,shadowOffsetY:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowOffsetY,shadowBlur:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowBlur,angle:r.attribute.angle,anchor:[i/2,n/2]});if(l.appendChild(h),s){const t=a.type===o.MILESTONE?15:10,e=new Ea({x:-t,y:0,width:10,height:n,pickable:!0}),r=new El({x:5,y:n/2,radius:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.radius,fill:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.fillColor,stroke:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeColor,lineWidth:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeWidth,pickable:!1});e.appendChild(r),e.name="task-bar-link-point-left",l.appendChild(e);const s=new Ea({x:i+(t-10),y:0,width:10,height:n,pickable:!0}),h=new El({x:5,y:n/2,radius:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.radius,fill:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.fillColor,stroke:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeColor,lineWidth:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeWidth,pickable:!1,pickStrokeBuffer:10});s.appendChild(h),s.name="task-bar-link-point-right",l.appendChild(s)}}removeSelectedBorder(){this.selectedBorders.forEach((t=>{t.delete()})),this.selectedBorders=[]}removeSecondSelectedBorder(){if(2===this.selectedBorders.length){this.selectedBorders.pop().delete()}}updateCreatingDependencyLine(t,e,i,n){this.creatingDependencyLine&&(this.creatingDependencyLine.delete(),this.creatingDependencyLine=void 0);const o=new Xl({points:[{x:t,y:e},{x:i,y:n}],stroke:this._scene._gantt.parsedOptions.dependencyLinkLineCreatingStyle.lineColor,lineWidth:this._scene._gantt.parsedOptions.dependencyLinkLineCreatingStyle.lineWidth,lineDash:this._scene._gantt.parsedOptions.dependencyLinkLineCreatingStyle.lineDash,pickable:!1});this.creatingDependencyLine=o,this.selectedBorders[0].appendChild(o)}getTaskBarNodeByIndex(t,e){let i=this.barContainer.firstChild;if(!i)return null;for(let n=0;n<this.barContainer.childrenCount;n++){if(i.task_index===t&&(!XC(e)||XC(e)&&i.sub_task_index===e))return i;i=i._next}return null}}class fz{_scene;group;markLIneContainer;markLineContainerWidth=20;height;constructor(t){this._scene=t,this.height=Math.min(t._gantt.tableNoFrameHeight,t._gantt.drawHeight)-t._gantt.getAllHeaderRowsHeight(),this.group=new Ea({x:0,y:t._gantt.getAllHeaderRowsHeight(),width:t._gantt.tableNoFrameWidth,height:this.height,pickable:!1,clip:!0}),this.group.name="mark-line-container",t.ganttGroup.addChild(this.group),this.markLIneContainer=new Ea({x:0,y:0,width:this._scene._gantt.getAllDateColsWidth(),height:this.height,pickable:!1,clip:!0}),this.group.appendChild(this.markLIneContainer),this.initMarkLines()}initMarkLines(){this._scene._gantt.parsedOptions.markLine.forEach((t=>{const e=t.style,i=t.contentStyle||{},n=this._scene._gantt.parsedOptions.timeScaleIncludeHour?PC(t.date):PC(t.date,!0),o=this._scene._gantt.parsedOptions.minDate,{unit:r,step:s}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],a=DC(n,o,r,s);let l=0;if("right"===t.position)l=1;else if("middle"===t.position)l=.5;else if("date"===t.position){const e=DC(PC(t.date),o,r,s);l=e-Math.floor(e)}const h=this._scene._gantt.parsedOptions.timelineColWidth*(Math.floor(a)+l),d=new Ea({pickable:!1,x:h-this.markLineContainerWidth/2,y:0,width:this.markLineContainerWidth,height:this.height});d.name="mark-line",this.markLIneContainer.appendChild(d);const c=$l({pickable:!1,stroke:e.lineColor,lineWidth:e.lineWidth,lineDash:e.lineDash,points:[{x:this.markLineContainerWidth/2,y:0},{x:this.markLineContainerWidth/2,y:this.height}]});if(d.appendChild(c),t.content){const n=this._scene._gantt.parsedOptions.timelineColWidth,o=i.lineHeight||18,r=new Ea({x:this.markLineContainerWidth/2,y:0,cursor:"pointer",height:o,clip:!1,fill:i.backgroundColor||e.lineColor,display:"flex",cornerRadius:i.cornerRadius||[0,2,2,0]});r.name="mark-line-content",r.data=t,d.appendChild(r);const s=new Fl({maxLineWidth:n,text:t.content,cursor:"pointer",lineHeight:o,fontWeight:i.fontWeight||"normal",fill:i.color||e.lineColor,fontSize:i.fontSize||12,poptip:{position:"top",dx:n/4,dy:-o/4}});r.appendChild(s)}}))}refresh(){this.height=Math.min(this._scene._gantt.tableNoFrameHeight,this._scene._gantt.drawHeight)-this._scene._gantt.getAllHeaderRowsHeight(),this.markLIneContainer.removeAllChild(),this.group.setAttribute("height",this.height),this.markLIneContainer.setAttribute("height",this.height),this.initMarkLines()}setX(t){this.markLIneContainer.setAttribute("x",t)}}class vz{_scene;border;constructor(t){this._scene=t,this.createFrameBorder()}createFrameBorder(){const t=this._scene.ganttGroup,e=this._scene._gantt.parsedOptions.outerFrameStyle;if(!e)return;const{cornerRadius:i,borderColor:n,borderLineWidth:o,borderLineDash:r}=e,s={},a={pickable:!1};if(o&&(a.stroke=!0,a.fill=!1,a.stroke=n,a.lineWidth=o,r&&(a.lineDash=r),a.lineCap="butt"),i&&(this._scene._gantt.taskListTableInstance?(a.cornerRadius=[0,this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius??0,this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius??0,0],s.cornerRadius=[0,this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius??0,this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius??0,0]):(a.cornerRadius=this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius??0,s.cornerRadius=this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius??0)),t.setAttributes(s),a.stroke){a.x=this._scene._gantt.taskListTableInstance?-o/2:o/2,a.y=o/2,a.pickable=!1,a.width=t.attribute.width+o+(this._scene._gantt.taskListTableInstance?this._scene._gantt.parsedOptions.verticalSplitLine.lineWidth:0),a.height=t.attribute.height+o/2+o/2;const e=ql(a);e.name="border-rect",t.parent.insertAfter(e,t),t.border=e,this.border=e}}refresh(){this.border&&this.border.parent&&this.border.parent.removeChild(this.border),this.createFrameBorder()}resize(){const{cornerRadius:t,borderColor:e,borderLineWidth:i,borderLineDash:n}=this._scene._gantt.parsedOptions.outerFrameStyle;this.border?.setAttributes({width:this._scene.ganttGroup.attribute.width+i+(this._scene._gantt.taskListTableInstance?this._scene._gantt.parsedOptions.verticalSplitLine.lineWidth:0),height:this._scene._gantt.drawHeight+i})}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */let bz=class{time=ki.beforeFillStroke;useStyle=!0;order=0;supportedAppName="vtable";drawShape(t,e,i,n,o,r,s,a,l,h,d,c,u){"date-header-cell"===t.name&&t.forEachChildren((t=>{if("date-header-cell-text"===t.name&&!0===t.attribute.textStick){const e=t;e.setAttribute("dx",0);const i=e.globalAABBBounds,n=e.stage.globalAABBBounds,o=e.parent.globalAABBBounds,r=n.intersect(o);n.intersect(o)&&(i.width()>=r.width()&&e.attribute.last_dx?e.setAttribute("dx",e.attribute.last_dx??0):n.x1>=i.x1?(e.setAttribute("dx",n.x1-i.x1),e.setAttribute("last_dx",n.x1-i.x1)):n.x2<=i.x2&&(e.setAttribute("dx",n.x2-i.x2),e.setAttribute("last_dx",n.x1-i.x1)))}}))}};bz=function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s}([w()],bz);var mz=new l(((t,e,i,n)=>{t(bz).toSelf().inSingletonScope(),t(ll).toService(bz)}));class yz{_scene;group;lineVertical;lineHorizontal;constructor(t){this._scene=t,this.createAddButton()}createAddButton(){this._scene._gantt.parsedOptions.taskBarCreationCustomLayout?this.group=new Ea({x:0,y:0,width:100,height:100}):(this.group=new Ea({x:0,y:0,width:100,height:100,lineDash:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineDash,cursor:"pointer",lineWidth:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineWidth,stroke:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineColor,cornerRadius:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.cornerRadius??0,fill:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.backgroundColor}),this.lineVertical=$l({pickable:!1,stroke:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineColor,lineWidth:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineWidth,points:[{x:50,y:0},{x:50,y:100}]}),this.group.appendChild(this.lineVertical),this.lineHorizontal=$l({pickable:!1,stroke:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineColor,lineWidth:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineWidth,points:[{x:0,y:50},{x:100,y:50}]}),this.group.appendChild(this.lineHorizontal)),this.group.name="task-creation-button",this._scene.taskBar.group.addChild(this.group)}show(t,e,i,n){if(this._scene._gantt.parsedOptions.taskBarCreationCustomLayout)this.group.appendChild(this._scene._gantt.parsedOptions.taskBarCreationCustomLayout({width:i,height:n,ganttInstance:this._scene._gantt}).rootContainer);else{const t=Math.min(i,n)/6;this.lineHorizontal.setAttribute("points",[{x:(i-4*t)/2,y:n/2},{x:(i-4*t)/2+4*t,y:n/2}]),this.lineVertical.setAttribute("points",[{x:i/2,y:(n-4*t)/2},{x:i/2,y:(n-4*t)/2+4*t}])}this.group.setAttribute("x",t),this.group.setAttribute("y",e),this.group.setAttribute("width",i),this.group.setAttribute("height",n),this.group.setAttribute("visibleAll",!0)}hide(){this.group.setAttribute("visibleAll",!1),this._scene._gantt.parsedOptions.taskBarCreationCustomLayout&&this.group.removeAllChild()}}class Cz{_scene;group;constructor(t){this._scene=t,this.group=new km({position:"top",content:"",contentStyle:{fill:"#fff"},visible:!1,panel:{background:"#14161c",cornerRadius:4}}),t.ganttGroup.addChild(this.group)}show(t){const e=this._scene._gantt.parsedOptions.markLineCreateOptions?.markLineCreationHoverToolTip||{},i=t.globalTransMatrix,n=t.attribute.width,o=t.attribute.height;let r,s;const a=e.position||"top";"top"===a?(r=i.e+n/2-2,s=i.f):"bottom"===a&&(r=i.e+n/2-2,s=i.f+o);const l=e.style?.contentStyle||{fill:"#fff"},h=e.style?.panelStyle||{background:"#14161c",cornerRadius:4};this.group.setAttributes({content:e.tipContent,position:a,visibleAll:!0,visible:!0,contentStyle:l,panel:{...h,visible:!0},x:r,y:s})}hide(){this.group.setAttributes({visibleAll:!1,visible:!1})}}class wz{group;linkLinesContainer;_scene;width;height;selectedEffectNodes;constructor(t){this._scene=t,this.width=t._gantt.tableNoFrameWidth,this.height=t._gantt.gridHeight,this.group=new Ea({x:0,y:t._gantt.getAllHeaderRowsHeight(),width:this.width,height:this.height,pickable:!1,clip:!0}),this.group.name="dependency-link-container",t.ganttGroup.addChild(this.group),this.initLinkLines()}initLinkLines(){if(Ow(this._scene._gantt.records),this.linkLinesContainer=new Ea({x:0,y:0,width:this._scene._gantt.getAllDateColsWidth(),height:this._scene._gantt.getAllTaskBarsHeight(),pickable:!1,clip:!0}),this.group.appendChild(this.linkLinesContainer),this._scene._gantt.records?.length)for(let t=0;t<this._scene._gantt.parsedOptions.dependencyLinks.length;t++)this.initLinkLine(t)}initLinkLine(t){const{taskKeyField:e,dependencyLinks:r}=this._scene._gantt.parsedOptions,s=r[t],{linkedToTaskKey:a,linkedFromTaskKey:l,type:h}=s,d=Hw(this._scene._gantt.records,e,a),c=Hw(this._scene._gantt.records,e,l);if(!d||!c)return;let u,g,p,f,v,b,m,y;if(d.record.vtable_gantt_linkedTo||(d.record.vtable_gantt_linkedTo=[]),d.record.vtable_gantt_linkedTo.push(s),c.record.vtable_gantt_linkedFrom||(c.record.vtable_gantt_linkedFrom=[]),c.record.vtable_gantt_linkedFrom.push(s),this._scene._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Inline)y=c.index[0],m=d.index[0],({startDate:u,endDate:g,taskDays:p}=this._scene._gantt.getTaskInfoByTaskListIndex(d.index[0],d.index[1])),({startDate:f,endDate:v,taskDays:b}=this._scene._gantt.getTaskInfoByTaskListIndex(c.index[0],c.index[1]));else if(this._scene._gantt.parsedOptions.tasksShowMode===n.Project_Sub_Tasks_Inline){const t=this._scene._gantt.getTaskShowIndexByRecordIndex(c.index.slice(0,-1)),e=this._scene._gantt.getTaskShowIndexByRecordIndex(d.index.slice(0,-1)),i=this._scene._gantt.getRecordByIndex(t),n=this._scene._gantt.getRecordByIndex(e);y=i.type===o.PROJECT&&"expand"!==i.hierarchyState&&!1!==this._scene._gantt.parsedOptions.projectSubTasksExpandable?t:this._scene._gantt.getTaskShowIndexByRecordIndex(c.index),m=n.type===o.PROJECT&&"expand"!==n.hierarchyState&&!1!==this._scene._gantt.parsedOptions.projectSubTasksExpandable?e:this._scene._gantt.getTaskShowIndexByRecordIndex(d.index),({startDate:u,endDate:g,taskDays:p}=this._scene._gantt.getTaskInfoByTaskListIndex(m,d.index)),({startDate:f,endDate:v,taskDays:b}=this._scene._gantt.getTaskInfoByTaskListIndex(y,c.index))}else if(this._scene._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Separate||this._scene._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact){y=this._scene._gantt.getRowsHeightByIndex(0,c.index[0]-1)/this._scene._gantt.parsedOptions.rowHeight+(this._scene._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact?c.record.vtable_gantt_showIndex:c.index[1]??0);m=this._scene._gantt.getRowsHeightByIndex(0,d.index[0]-1)/this._scene._gantt.parsedOptions.rowHeight+(this._scene._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact?d.record.vtable_gantt_showIndex:d.index[1]??0),({startDate:u,endDate:g,taskDays:p}=this._scene._gantt.getTaskInfoByTaskListIndex(d.index[0],d.index[1])),({startDate:f,endDate:v,taskDays:b}=this._scene._gantt.getTaskInfoByTaskListIndex(c.index[0],c.index[1]))}else y=this._scene._gantt.getTaskShowIndexByRecordIndex(c.index),m=this._scene._gantt.getTaskShowIndexByRecordIndex(d.index),({startDate:u,endDate:g,taskDays:p}=this._scene._gantt.getTaskInfoByTaskListIndex(m)),({startDate:f,endDate:v,taskDays:b}=this._scene._gantt.getTaskInfoByTaskListIndex(y));if(!b||!p)return;PC(this._scene._gantt.parsedOptions.minDate);const{arrowPoints:C,linePoints:w}=function(t,e,n,o,r,s,a,l,h,d,c,u){const{unit:g,step:p}=u.parsedOptions.reverseSortedTimelineScales[0],{minDate:f,rowHeight:v,timelineColWidth:b}=u.parsedOptions,m=u.parsedOptions.taskBarMilestoneHypotenuse,y=20,C=10,w=5;let x=[],_=[];if(t===i.FinishToStart){let t=DC(n,f,g,p,1)*b;s&&(t=DC(e,f,g,p,1)*b+m/2);let i=DC(a,f,g,p)*b;c&&(i-=m/2),x=[{x:t,y:v*(o+.5)},{x:t+y,y:v*(o+.5)},{x:t+y,y:v*(o+(o>h?0:1))},{x:i-y,y:v*(o+(o>h?0:1))},{x:i-y,y:v*(h+.5)},{x:i,y:v*(h+.5)}],t+y<=i-y&&x.splice(2,3,{x:t+y,y:v*(h+.5)});const r=x[x.length-1];_=[{x:r.x,y:r.y},{x:r.x-C,y:r.y-w},{x:r.x-C,y:r.y+w},{x:r.x,y:r.y}]}else if(t===i.StartToFinish){let t=DC(e,f,g,p)*b;s&&(t-=m/2);let i=DC(l,f,g,p,1)*b;c&&(i=DC(a,f,g,p,1)*b+m/2),x=[{x:t,y:v*(o+.5)},{x:t-y,y:v*(o+.5)},{x:t-y,y:v*(o+(o>h?0:1))},{x:i+y,y:v*(o+(o>h?0:1))},{x:i+y,y:v*(h+.5)},{x:i,y:v*(h+.5)}],t-y>=i+y&&x.splice(2,3,{x:t-y,y:v*(h+.5)});const n=x[x.length-1];_=[{x:n.x,y:n.y},{x:n.x+C,y:n.y-w},{x:n.x+C,y:n.y+w},{x:n.x,y:n.y}]}else if(t===i.StartToStart){let t=DC(e,f,g,p)*b;s&&(t-=m/2);let i=DC(a,f,g,p)*b;c&&(i-=m/2),x=[{x:t,y:v*(o+.5)},{x:(o===h?t:Math.min(t,i))-y,y:v*(o+.5)},{x:(o===h?t:Math.min(t,i))-y,y:v*(h+(o===h?1:.5))},{x:i-y,y:v*(h+(o===h?1:.5))},{x:(o===h?i:Math.min(t,i))-y,y:v*(h+.5)},{x:i,y:v*(h+.5)}];const n=x[x.length-1];_=[{x:n.x,y:n.y},{x:n.x-C,y:n.y-w},{x:n.x-C,y:n.y+w},{x:n.x,y:n.y}]}else if(t===i.FinishToFinish){let t=DC(n,f,g,p,1)*b;s&&(t=DC(e,f,g,p,1)*b+m/2);let i=DC(l,f,g,p,1)*b;c&&(i=DC(a,f,g,p,1)*b+m/2),x=[{x:t,y:v*(o+.5)},{x:(o===h?t:Math.max(t,i))+y,y:v*(o+.5)},{x:(o===h?t:Math.max(t,i))+y,y:v*(h+(o===h?1:.5))},{x:i+y,y:v*(h+(o===h?1:.5))},{x:i+y,y:v*(h+.5)},{x:i,y:v*(h+.5)}];const r=x[x.length-1];_=[{x:r.x,y:r.y},{x:r.x+C,y:r.y-w},{x:r.x+C,y:r.y+w},{x:r.x,y:r.y}]}return{linePoints:x,arrowPoints:_}}(h,f,v,y,0,c.record.type===o.MILESTONE,u,g,m,0,d.record.type===o.MILESTONE,this._scene._gantt),x=this._scene._gantt.parsedOptions.dependencyLinkLineStyle,_=$l({pickable:!0,stroke:x.lineColor,lineWidth:x.lineWidth,lineDash:x.lineDash,points:w,pickStrokeBuffer:3,vtable_link:s});this.linkLinesContainer.appendChild(_),s.vtable_gantt_linkLineNode=_;const S=new yh({fill:x.lineColor,points:C});this.linkLinesContainer.appendChild(S),s.vtable_gantt_linkArrowNode=S}setX(t){this.linkLinesContainer.setAttribute("x",t)}setY(t){this.linkLinesContainer.setAttribute("y",t)}refresh(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttributes({height:this.height,width:this.width,y:this._scene._gantt.getAllHeaderRowsHeight()});const t=this.linkLinesContainer.attribute.x,e=this.linkLinesContainer.attribute.y;this.linkLinesContainer.removeAllChild(),this.group.removeChild(this.linkLinesContainer),this.initLinkLines(),this.setX(t),this.setY(e)}resize(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttribute("width",this.width),this.group.setAttribute("height",this.height)}createSelectedLinkLine(t){const e=t.vtable_gantt_linkLineNode,i=t.vtable_gantt_linkArrowNode,n=e.clone(),o=i.clone();n.setAttribute("stroke",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.lineColor),n.setAttribute("lineWidth",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.lineWidth),n.setAttribute("shadowColor",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowColor),n.setAttribute("shadowOffsetX",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowOffset),n.setAttribute("shadowOffsetY",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowOffset),n.setAttribute("shadowBlur",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowBlur),this.linkLinesContainer.appendChild(n),o.setAttribute("fill",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.lineColor),this.linkLinesContainer.appendChild(o),this.selectedEffectNodes=[n,o]}removeSelectedLinkLine(){this.selectedEffectNodes?.forEach((t=>{t.delete()})),this.selectedEffectNodes=[]}deleteLink(t){const e=t.vtable_gantt_linkLineNode,i=t.vtable_gantt_linkArrowNode;e.delete(),i.delete()}}function xz(t,e,n,o,r,s,a,l,h,d,c,u,g,p,f,v){const{unit:b,step:m}=v.parsedOptions.reverseSortedTimelineScales[0],{minDate:y,rowHeight:C,timelineColWidth:w}=v.parsedOptions,x=v.parsedOptions.taskBarMilestoneHypotenuse,_=v.parsedOptions.taskBarMilestoneStyle.width,S=20,A=10;let B=[],T=[];if(t===i.FinishToStart){let t=a?a.attribute.x+a.attribute.width:DC(n,y,b,m,1)*w;s&&(t=a?a.attribute.x+a.attribute.width+(x-_)/2:DC(e,y,b,m,1)*w+x/2);let i=p?p.attribute.x:DC(h,y,b,m)*w;g&&(i-=(x-_)/2),B=[{x:t,y:C*(o+.5)+l},{x:t+S,y:C*(o+.5)+l},{x:t+S,y:C*(o+(o>c?0:1))+l},{x:i-S,y:C*(o+(o>c?0:1))+l},{x:i-S,y:C*(c+.5)+f},{x:i,y:C*(c+.5)+f}],t+S<=i-S&&B.splice(2,3,{x:t+S,y:C*(c+.5)+f});const r=B[B.length-1];T=[{x:r.x,y:r.y},{x:r.x-A,y:r.y-5},{x:r.x-A,y:r.y+5},{x:r.x,y:r.y}]}else if(t===i.StartToFinish){let t=a?a.attribute.x:DC(e,y,b,m)*w;s&&(t-=(x-_)/2);let i=p?p.attribute.x+p.attribute.width:DC(d,y,b,m,1)*w;g&&(i=p?p.attribute.x+p.attribute.width+(x-_)/2:DC(h,y,b,m,1)*w+x/2),B=[{x:t,y:C*(o+.5)+l},{x:t-S,y:C*(o+.5)+l},{x:t-S,y:C*(o+(o>c?0:1))+l},{x:i+S,y:C*(o+(o>c?0:1))+l},{x:i+S,y:C*(c+.5)+f},{x:i,y:C*(c+.5)+f}],t-S>=i+S&&B.splice(2,3,{x:t-S,y:C*(c+.5)+f});const n=B[B.length-1];T=[{x:n.x,y:n.y},{x:n.x+A,y:n.y-5},{x:n.x+A,y:n.y+5},{x:n.x,y:n.y}]}else if(t===i.StartToStart){let t=a?a.attribute.x:DC(e,y,b,m)*w;s&&(t-=(x-_)/2);let i=p?p.attribute.x:DC(h,y,b,m)*w;g&&(i-=(x-_)/2),B=[{x:t,y:C*(o+.5)+l},{x:(o===c?t:Math.min(t,i))-S,y:C*(o+.5)+l},{x:(o===c?t:Math.min(t,i))-S,y:C*(c+(o===c?1:.5))+f},{x:i-S,y:C*(c+(o===c?1:.5))+f},{x:(o===c?i:Math.min(t,i))-S,y:C*(c+.5)+f},{x:i,y:C*(c+.5)+f}];const n=B[B.length-1];T=[{x:n.x,y:n.y},{x:n.x-A,y:n.y-5},{x:n.x-A,y:n.y+5},{x:n.x,y:n.y}]}else if(t===i.FinishToFinish){let t=a?a.attribute.x+a.attribute.width:DC(n,y,b,m,1)*w;s&&(t=a?a.attribute.x+a.attribute.width+(x-_)/2:DC(e,y,b,m,1)*w+x/2);let i=p?p.attribute.x+p.attribute.width:DC(d,y,b,m,1)*w;g&&(i=p?p.attribute.x+p.attribute.width+(x-_)/2:DC(h,y,b,m,1)*w+x/2),B=[{x:t,y:C*(o+.5)+l},{x:(o===c?t:Math.max(t,i))+S,y:C*(o+.5)+l},{x:(o===c?t:Math.max(t,i))+S,y:C*(c+(o===c?1:.5))+f},{x:i+S,y:C*(c+(o===c?1:.5))+f},{x:i+S,y:C*(c+.5)+f},{x:i,y:C*(c+.5)+f}];const r=B[B.length-1];T=[{x:r.x,y:r.y},{x:r.x+A,y:r.y-5},{x:r.x+A,y:r.y+5},{x:r.x,y:r.y}]}return{linePoints:B,arrowPoints:T}}class _z{_scene;dragLineContainer;dragLine;constructor(t){this._scene=t,this.dragLineContainer=new Ea({x:0,y:0,width:t._gantt.tableNoFrameWidth,height:Math.min(t._gantt.tableNoFrameHeight,t._gantt.drawHeight),pickable:!1,clip:!0,visible:!1}),this.dragLineContainer.name="drag-order-line-container",t.ganttGroup.addChild(this.dragLineContainer),this.initDragLine()}initDragLine(){if(this._scene._gantt.taskListTableInstance){const t=this._scene._gantt.taskListTableInstance.theme.dragHeaderSplitLine,e=$l({pickable:!1,stroke:t.lineColor,lineWidth:t.lineWidth,points:[]});this.dragLine=e,this.dragLineContainer.appendChild(e)}}showDragLine(t){this.dragLineContainer.showAll(),this.dragLine.setAttribute("points",[{x:0,y:t},{x:this._scene._gantt.tableNoFrameWidth,y:t}])}hideDragLine(){this.dragLineContainer.hideAll()}}fo.load(mz);class Sz{dateStepWidth;rowHeight;_scales;timelineHeader;grid;dependencyLink;taskBar;_gantt;ganttGroup;scrollbarComponent;markLine;dragOrderLine;frameBorder;taskCreationButton;toolTip;stage;tableGroupWidth;tableGroupHeight;constructor(t){let e,i;this._gantt=t,this.tableGroupWidth=t.tableNoFrameWidth,this.tableGroupHeight=Math.min(t.tableNoFrameHeight,t.drawHeight),"node"===NC.mode||(Pu.setEnv("browser"),e=t.canvas.width,i=t.canvas.height),this.stage=Ku({canvas:t.canvas,width:e,height:i,disableDirtyBounds:!1,background:t.parsedOptions.underlayBackgroundColor,enableLayout:!0,autoRender:!1,context:{appName:"vtable"},pluginList:["poptipForText"]}),this.stage.gantt=this._gantt,this.stage.table=this._gantt,this.stage.defaultLayer.setTheme({group:{boundsPadding:0,strokeBoundsBuffer:0,lineJoin:"round"},text:{ignoreBuf:!0}}),this.initSceneGraph()}initSceneGraph(){const t=this;t.ganttGroup=new Ea({x:t._gantt.tableX,y:t._gantt.tableY,width:this.tableGroupWidth,height:this.tableGroupHeight,clip:!0,pickable:!1}),t.stage.defaultLayer.add(t.ganttGroup),t.ganttGroup.name="table",t.timelineHeader=new Gw(t),t.grid=new WC(t),t.dependencyLink=new wz(t),t.taskBar=new pz(t),t.markLine=new fz(t),t.toolTip=new Cz(t),t.frameBorder=new vz(t),t.scrollbarComponent=new ww(t._gantt),t.stage.defaultLayer.addChild(t.scrollbarComponent.hScrollBar),t.stage.defaultLayer.addChild(t.scrollbarComponent.vScrollBar),t.dragOrderLine=new _z(t)}updateSceneGraph(){const t=this._gantt;let e,i;this.tableGroupWidth=t.tableNoFrameWidth,this.tableGroupHeight=Math.min(t.tableNoFrameHeight,t.drawHeight),"node"===NC.mode||(Pu.setEnv("browser"),e=t.canvas.width,i=t.canvas.height),this.stage.resize(e,i),this.refreshAll()}afterCreateSceneGraph(){this.scrollbarComponent.updateScrollBar(),function(t){const i=t._gantt,n=i.stateManager,o=i.scenegraph;o.scrollbarComponent.vScrollBar.addEventListener("pointerover",(t=>{o.scrollbarComponent.showVerticalScrollBar()})),o.scrollbarComponent.hScrollBar.addEventListener("pointerover",(t=>{o.scrollbarComponent.showHorizontalScrollBar()})),o.scrollbarComponent.vScrollBar.addEventListener("pointerout",(t=>{n.interactionState!==e.scrolling&&o.scrollbarComponent.hideVerticalScrollBar()})),o.scrollbarComponent.hScrollBar.addEventListener("pointerout",(t=>{n.interactionState!==e.scrolling&&o.scrollbarComponent.hideHorizontalScrollBar()})),o.scrollbarComponent.vScrollBar.addEventListener("pointermove",(t=>{t.stopPropagation()})),o.scrollbarComponent.vScrollBar.addEventListener("scrollDown",(t=>{o._gantt.eventManager.isDown=!0})),o.scrollbarComponent.vScrollBar.addEventListener("pointerup",(()=>{o._gantt.eventManager.isDraging=!1,n.interactionState===e.scrolling&&n.updateInteractionState(e.default)})),o.scrollbarComponent.vScrollBar.addEventListener("pointerupoutside",(()=>{n.interactionState===e.scrolling&&n.updateInteractionState(e.default)})),o.scrollbarComponent.vScrollBar.addEventListener("scrollUp",(t=>{o._gantt.eventManager.isDraging=!1})),o.scrollbarComponent.hScrollBar.addEventListener("pointermove",(t=>{t.stopPropagation()})),o.scrollbarComponent.hScrollBar.addEventListener("pointerdown",(t=>{t.stopPropagation()})),o.scrollbarComponent.hScrollBar.addEventListener("scrollDown",(t=>{o._gantt.eventManager.isDown=!0,n.interactionState!==e.scrolling&&n.updateInteractionState(e.scrolling)})),o.scrollbarComponent.hScrollBar.addEventListener("pointerup",(()=>{n.interactionState===e.scrolling&&n.updateInteractionState(e.default)})),o.scrollbarComponent.hScrollBar.addEventListener("pointerupoutside",(()=>{n.interactionState===e.scrolling&&n.updateInteractionState(e.default)})),o.scrollbarComponent.hScrollBar.addEventListener("scrollUp",(t=>{o._gantt.eventManager.isDraging=!1}));const r=xC(n.updateVerticalScrollBar,20),s=xC(n.updateHorizontalScrollBar,20);o.scrollbarComponent.vScrollBar.addEventListener("scrollDrag",(t=>{o._gantt.eventManager.isDown&&(o._gantt.eventManager.isDraging=!0),n.interactionState!==e.scrolling&&n.updateInteractionState(e.scrolling);const i=t.detail.value[0]/(1-t.detail.value[1]+t.detail.value[0]);r(i,t)})),o.scrollbarComponent.hScrollBar.addEventListener("scrollDrag",(t=>{o._gantt.eventManager.isDown&&(o._gantt.eventManager.isDraging=!0),n.fastScrolling=!0,n.interactionState!==e.scrolling&&n.updateInteractionState(e.scrolling);const i=t.detail.value[0]/(1-t.detail.value[1]+t.detail.value[0]);s(i)}))}(this._gantt.eventManager)}refreshAll(){this.tableGroupHeight=Math.min(this._gantt.tableNoFrameHeight,this._gantt.drawHeight),this.tableGroupWidth=this._gantt.tableNoFrameWidth,this.ganttGroup.setAttribute("height",this.tableGroupHeight),this.ganttGroup.setAttribute("width",this.tableGroupWidth),this.timelineHeader.refresh(),this.grid.refresh(),this.taskBar.refresh(),this.dependencyLink.refresh(),this.markLine.refresh(),this.dependencyLink.refresh(),this.frameBorder.refresh(),this.scrollbarComponent.updateScrollBar(),this.updateNextFrame()}refreshTaskBars(){this.dependencyLink.refresh(),this.taskBar.refresh(),this.updateNextFrame()}refreshTaskBarsAndGrid(){this._gantt.verticalSplitResizeLine.style.height=this._gantt.drawHeight+"px",this.tableGroupHeight=Math.min(this._gantt.tableNoFrameHeight,this._gantt.drawHeight),this.ganttGroup.setAttribute("height",this.tableGroupHeight),this.grid.refresh(),this.taskBar.refresh(),this.dependencyLink.refresh(),this.markLine.refresh(),this.frameBorder.resize(),this.scrollbarComponent.updateScrollBar(),this.updateNextFrame()}updateTableSize(){this.tableGroupHeight=Math.min(this._gantt.tableNoFrameHeight,this._gantt.drawHeight),this.tableGroupWidth=this._gantt.tableNoFrameWidth,this.ganttGroup.setAttributes({x:this._gantt.tableX,y:this._gantt.tableY,width:this._gantt.tableNoFrameWidth,height:this.tableGroupHeight}),this.grid.resize(),this.taskBar.resize(),this.dependencyLink.resize(),this.markLine.refresh(),this.frameBorder.resize()}updateStageBackground(){this.stage.background=this._gantt.parsedOptions.underlayBackgroundColor,this.updateNextFrame()}renderSceneGraph(){this.stage.render()}updateNextFrame(){this.stage.renderNextFrame()}get width(){return this.ganttGroup.attribute?.width??0}get height(){return this.ganttGroup.attribute?.height??0}get x(){return this.ganttGroup.attribute?.x??0}get y(){return this.ganttGroup.attribute?.y??0}setX(t,e=!1){this.timelineHeader.setX(t),this.grid.setX(t),this.taskBar.setX(t),this.dependencyLink.setX(t),this.markLine.setX(t),this.updateNextFrame()}setY(t,e=!1){this.grid.setY(t),this.taskBar.setY(t),this.dependencyLink.setY(t),this.updateNextFrame()}setPixelRatio(t){this.stage.disableDirtyBounds(),this.stage.window.setDpr(t),this.stage.render(),this.stage.enableDirtyBounds()}resize(){this.updateTableSize(),this.scrollbarComponent.updateScrollBar(),this.updateNextFrame()}release(){this.stage.release()}showTaskCreationButton(t,e,i){this.taskCreationButton||(this.taskCreationButton=new yz(this._gantt.scenegraph));const n=this._gantt.parsedOptions.taskBarCreationMaxWidth,o=this._gantt.parsedOptions.taskBarCreationMinWidth,r=this._gantt.getDateColWidth(i),s=n?Math.min(n,o?Math.max(o,r):r):o?Math.max(o,r):r,a=t-(s-r)/2;this.taskCreationButton.show(a,e,s,this._gantt.parsedOptions.rowHeight),this.updateNextFrame()}hideTaskCreationButton(){this.taskCreationButton&&(this.taskCreationButton.hide(),this.updateNextFrame())}showToolTip(t){this.toolTip||(this.toolTip=new Cz(this._gantt.scenegraph)),this.toolTip.show(t)}hideToolTip(){this.toolTip.hide()}refreshRecordLinkNodes(t,e,i,r=0){const s=this._gantt,a=s.getRecordByIndex(t,e),l=a.vtable_gantt_linkedTo,h=a.vtable_gantt_linkedFrom;for(let a=0;a<l?.length;a++){const h=l[a],d=h.vtable_gantt_linkLineNode,c=h.vtable_gantt_linkArrowNode,{linkedToTaskKey:u,linkedFromTaskKey:g,type:p}=h,{taskKeyField:f,minDate:v}=s.parsedOptions,b=Hw(s.records,f,g),m=Hw(s.records,f,u);let y,C,w,x,_,S,A,B,T;const R=this._gantt.getTaskBarStyle(t,e);if(s.parsedOptions.tasksShowMode===n.Sub_Tasks_Inline){const t=Fw(i.attribute.y+r,s);B=b.index[0];A=s.getRowsHeightByIndex(0,t.task_index-1)/s.parsedOptions.rowHeight,({startDate:y,endDate:C,taskDays:w}=s.getTaskInfoByTaskListIndex(m.index[0],m.index[1])),({startDate:x,endDate:_,taskDays:S}=s.getTaskInfoByTaskListIndex(b.index[0],b.index[1]));const e=R.width;T=i.attribute.y+e/2-(A+.5)*s.parsedOptions.rowHeight}else if(s.parsedOptions.tasksShowMode===n.Project_Sub_Tasks_Inline){const t=s.getTaskShowIndexByRecordIndex(b.index.slice(0,-1)),e=s.getTaskShowIndexByRecordIndex(m.index.slice(0,-1)),i=s.getRecordByIndex(t),n=s.getRecordByIndex(e);B=i.type===o.PROJECT&&"expand"!==i.hierarchyState&&!1!==s.parsedOptions.projectSubTasksExpandable?t:s.getTaskShowIndexByRecordIndex(b.index),A=n.type===o.PROJECT&&"expand"!==n.hierarchyState&&!1!==s.parsedOptions.projectSubTasksExpandable?e:s.getTaskShowIndexByRecordIndex(m.index),({startDate:y,endDate:C,taskDays:w}=s.getTaskInfoByTaskListIndex(A,m.index)),({startDate:x,endDate:_,taskDays:S}=s.getTaskInfoByTaskListIndex(B,b.index))}else if(s.parsedOptions.tasksShowMode===n.Sub_Tasks_Separate||s.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||s.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact){const t=Fw(i.attribute.y+r,s);B=s.getRowsHeightByIndex(0,b.index[0]-1)/s.parsedOptions.rowHeight+(s.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||s.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact?b.record.vtable_gantt_showIndex:b.index[1]);A=s.getRowsHeightByIndex(0,t.task_index-1)/s.parsedOptions.rowHeight+(s.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||s.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact?m.record.vtable_gantt_showIndex:t.sub_task_index),({startDate:y,endDate:C,taskDays:w}=s.getTaskInfoByTaskListIndex(m.index[0],m.index[1])),({startDate:x,endDate:_,taskDays:S}=s.getTaskInfoByTaskListIndex(b.index[0],b.index[1]));const e=R.width;T=i.attribute.y+e/2-(A+.5)*s.parsedOptions.rowHeight}else{if(B=s.getTaskShowIndexByRecordIndex(b.index),A=s.getTaskShowIndexByRecordIndex(m.index),-1===B||-1===A)continue;({startDate:y,endDate:C,taskDays:w}=s.getTaskInfoByTaskListIndex(A)),({startDate:x,endDate:_,taskDays:S}=s.getTaskInfoByTaskListIndex(B))}if(!(x&&_&&y&&C&&d&&c))return;const{linePoints:k,arrowPoints:M}=xz(p,x,_,B,0,b.record.type===o.MILESTONE,null,0,y,C,A,0,m.record.type===o.MILESTONE,i,T??0,this._gantt);d.setAttribute("points",k),c.setAttribute("points",M)}for(let a=0;a<h?.length;a++){const l=h[a],d=l.vtable_gantt_linkLineNode,c=l.vtable_gantt_linkArrowNode,{linkedToTaskKey:u,linkedFromTaskKey:g,type:p}=l,{taskKeyField:f,minDate:v}=s.parsedOptions,b=Hw(s.records,f,u),m=Hw(s.records,f,g);let y,C,w,x,_,S,A,B,T;const R=this._gantt.getTaskBarStyle(t,e);if(s.parsedOptions.tasksShowMode===n.Sub_Tasks_Inline){const t=Fw(i.attribute.y+r,s);B=s.getRowsHeightByIndex(0,t.task_index-1)/s.parsedOptions.rowHeight,A=b.index[0],({startDate:y,endDate:C,taskDays:w}=s.getTaskInfoByTaskListIndex(b.index[0],b.index[1])),({startDate:x,endDate:_,taskDays:S}=s.getTaskInfoByTaskListIndex(m.index[0],m.index[1]));const e=R.width;T=i.attribute.y+e/2-(B+.5)*s.parsedOptions.rowHeight}else if(s.parsedOptions.tasksShowMode===n.Project_Sub_Tasks_Inline){const t=s.getTaskShowIndexByRecordIndex(m.index.slice(0,-1)),e=s.getTaskShowIndexByRecordIndex(b.index.slice(0,-1)),i=s.getRecordByIndex(t),n=s.getRecordByIndex(e);B=i.type===o.PROJECT&&"expand"!==i.hierarchyState&&!1!==s.parsedOptions.projectSubTasksExpandable?t:s.getTaskShowIndexByRecordIndex(m.index),A=n.type===o.PROJECT&&"expand"!==n.hierarchyState&&!1!==s.parsedOptions.projectSubTasksExpandable?e:s.getTaskShowIndexByRecordIndex(b.index),({startDate:y,endDate:C,taskDays:w}=s.getTaskInfoByTaskListIndex(A,b.index)),({startDate:x,endDate:_,taskDays:S}=s.getTaskInfoByTaskListIndex(B,m.index))}else if(s.parsedOptions.tasksShowMode===n.Sub_Tasks_Separate||s.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||s.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact){const t=Fw(i.attribute.y+r,s);B=s.getRowsHeightByIndex(0,t.task_index-1)/s.parsedOptions.rowHeight+(s.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||s.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact?m.record.vtable_gantt_showIndex:t.sub_task_index);A=s.getRowsHeightByIndex(0,b.index[0]-1)/s.parsedOptions.rowHeight+(s.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||s.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact?b.record.vtable_gantt_showIndex:b.index[1]),({startDate:y,endDate:C,taskDays:w}=s.getTaskInfoByTaskListIndex(b.index[0],b.index[1])),({startDate:x,endDate:_,taskDays:S}=s.getTaskInfoByTaskListIndex(m.index[0],m.index[1]));const e=R.width;T=i.attribute.y+e/2-(B+.5)*s.parsedOptions.rowHeight}else{if(B=s.getTaskShowIndexByRecordIndex(m.index),A=s.getTaskShowIndexByRecordIndex(b.index),-1===B||-1===A)continue;({startDate:y,endDate:C,taskDays:w}=s.getTaskInfoByTaskListIndex(A)),({startDate:x,endDate:_,taskDays:S}=s.getTaskInfoByTaskListIndex(B))}if(!(x&&_&&y&&C&&d&&c))return;const{linePoints:k,arrowPoints:M}=xz(p,x,_,B,0,m.record.type===o.MILESTONE,i,T??0,y,C,A,0,b.record.type===o.MILESTONE,null,0,this._gantt);d.setAttribute("points",k),c.setAttribute("points",M)}}}const Az=(t,e)=>(t=>{switch(Object.prototype.toString.call(t)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}})(t)===e;function Bz(t,e,i){let n,o,r,s,a,l,h=0,d=!1,c=!1,u=!0;const g=!e&&0!==e&&"function"==typeof requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){const i=n,r=o;return o=void 0,n=void 0,h=e,s=t.apply(r,i),s}function f(t,e){return g?requestAnimationFrame(t):setTimeout(t,e)}function v(t){const i=t-l;return void 0===l||i>=e||i<0||d&&t-h>=r}function b(){const t=Date.now();if(v(t))return function(t){return a=void 0,u&&n?p(t):(o=void 0,n=void 0,s)}(t);a=f(b,function(t){const i=t-h,n=e&&-(t-l);return d?Math.min(n,r-i):n}(t))}return e=+e||0,Az(i,"object")&&(c=!!i.leading,d="maxWait"in i,d&&(r=Math.max(+i.maxWait||0,e)),u="trailing"in i?!!i.trailing:u),function(...t){const i=Date.now(),r=v(i);if(n=t,o=this,l=i,r){if(void 0===a)return function(t){return h=t,a=f(b,e),c?p(t):s}(l);if(d)return a=f(b,e),p(l)}return void 0===a&&(a=f(b,e)),s}}let Tz=1;class Rz{resizeTime=100;element;cb;observer;lastSize={width:0,height:0};callBackDebounce;constructor(t,e,i){if(this.element=t,this.cb=e,this.lastSize=this.getSize(),i&&(this.resizeTime=Math.max(i,16)),this.callBackDebounce=Bz(this.callBack,this.resizeTime),window?.addEventListener("resize",this.onResize),"ResizeObserver"in window){const t=window.ResizeObserver;this.observer=new t(this.mutationResize),this.observer?.observe(this.element)}else"MutationObserver"in window&&(this.observer=new MutationObserver(this.mutationResize),this.observer.observe(this.element,{attributes:!0,attributeFilter:["style"]}))}mutationResize=()=>{this.onResize()};disConnect(){window.removeEventListener("resize",this.onResize),this.observer&&(this.observer.disconnect(),this.observer=void 0)}callBack=()=>{const t=this.getSize();let e=!1;t.width===this.lastSize.width&&t.height===this.lastSize.height&&(e=!0),this.lastSize=t,this.cb&&this.cb({...this.lastSize,windowSizeNotChange:e})};setSize(t){this.lastSize=t}onResize=()=>{this.callBackDebounce()};checkSize(){const t=this.getSize();return t.width!==this.lastSize.width||t.height!==this.lastSize.height}getSize(){return this.element?{width:Math.floor(this.element.clientWidth),height:Math.floor(this.element.clientHeight)}:{...this.lastSize}}}class kz{resizeTime;listeners={};reseizeListeners={};on(t,e,i,...n){if("node"===NC.mode)return-1;const o=Tz++;if(t?.addEventListener)if("resize"!==e||t===window)t?.addEventListener(e,i,...n);else{const e=new Rz(t,i,this.resizeTime);this.reseizeListeners[o]=e}const r={target:t,type:e,listener:i,options:n};return this.listeners[o]=r,o}once(t,e,i,...n){if("node"===NC.mode)return-1;const o=this.on(t,e,((...t)=>{this.off(o),i(...t)}),...n);return o}off(t){if("node"===NC.mode)return;if(null==t)return;const e=this.listeners?.[t];e&&(delete this.listeners[t],e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options))}fire(t,e,...i){if("node"!==NC.mode)for(const n in this.listeners){const o=this.listeners[n];o.target===t&&o.type===e&&o.listener.call(o.target,...i)}}hasListener(t,e){if("node"===NC.mode)return!1;let i=!1;for(const n in this.listeners){const o=this.listeners[n];o.target===t&&o.type===e&&(i=!0)}return i}clear(){if("node"!==NC.mode){for(const t in this.listeners){const e=this.listeners[t];e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options)}for(const t in this.reseizeListeners){const e=this.reseizeListeners[t];e?.disConnect()}this.listeners={}}}release(){"node"!==NC.mode&&(this.clear(),this.listeners={})}}let Mz=1;function Lz(){return Bw?Mz=1:(Mz=Math.ceil(window.devicePixelRatio||1),Mz>1&&Mz%2!=0&&(Mz+=1)),Mz}function Pz(t){return!!t.changedTouches}Lz();class Ez{friction;lastTime;speedX;speedY;runingId;stopped;scrollHandle;constructor(){}setScrollHandle(t){this.scrollHandle=t}startInertia(t,e,i){this.stopped=!1,this.lastTime=Date.now(),this.speedX=t,this.speedY=e,this.friction=i,this.runingId||(this.runingId=requestAnimationFrame(this.inertia.bind(this)))}inertia(){if(this.stopped)return;const t=Date.now(),e=t-this.lastTime;let i=!0;const n=Math.pow(this.friction,e/16),o=n*this.speedX,r=n*this.speedY;let s=0,a=0;Math.abs(o)>.05&&(i=!1,s=(this.speedX+o)/2*e),Math.abs(r)>.05&&(i=!1,a=(this.speedY+r)/2*e),this.scrollHandle?.(s,a),i?this.runingId=null:(this.lastTime=t,this.speedX=o,this.speedY=r,this.runingId=requestAnimationFrame(this.inertia.bind(this)))}endInertia(){cancelAnimationFrame(this.runingId),this.runingId=null,this.stopped=!0}isInertiaScrolling(){return!!this.runingId}}class Hz{_gantt;_eventHandler;isDown=!1;isDraging=!1;lastDragPointerXYOnWindow;globalEventListeners=[];poniterState;isTouchdown;isTouchMove;isLongTouch;touchMovePoints;touchSetTimeout;touchEnd;_enableTableScroll=!0;inertiaScroll;constructor(t){this._gantt=t,this.inertiaScroll=new Ez,this._eventHandler=new kz,this.bindEvent()}release(){this._eventHandler.release(),this.globalEventListeners.forEach((t=>{"document"===t.env?document.removeEventListener(t.name,t.callback):"body"===t.env?document.body.removeEventListener(t.name,t.callback):"window"===t.env&&window.removeEventListener(t.name,t.callback)})),this.globalEventListeners=[],this.inertiaScroll.endInertia()}bindEvent(){!function(t){const i=t._gantt.scenegraph,s=t._gantt,a=s.stateManager;i.ganttGroup.addEventListener("pointerdown",(n=>{if(0!==n.button)return;let r,l,h;if(n.detailPath.find((t=>"task-bar"===t.name?(r=t,!0):"task-creation-button"===t.name||("task-bar-link-point-left"===t.name?(l=t,!0):"task-bar-link-point-right"===t.name?(h=t,!0):!!t.attribute.vtable_link&&(t.attribute.vtable_link,!0)))),r){const l=r.record;if(!(l?.type===o.PROJECT))if("task-bar-hover-shadow-left-icon"===n.target.name)a.startResizeTaskBar(r,n.nativeEvent.x,n.nativeEvent.y,n.offset.y,"left"),a.updateInteractionState(e.grabing);else if("task-bar-hover-shadow-right-icon"===n.target.name)a.startResizeTaskBar(r,n.nativeEvent.x,n.nativeEvent.y,n.offset.y,"right"),a.updateInteractionState(e.grabing);else if(s.parsedOptions.taskBarMoveable){const o=()=>{let t=!0;if("function"==typeof s.parsedOptions.taskBarMoveable){const{startDate:e,endDate:n,taskRecord:o}=i._gantt.getTaskInfoByTaskListIndex(r.task_index,r.sub_task_index),a={index:r.task_index,startDate:e,endDate:n,taskRecord:o,ganttInstance:i._gantt};t=s.parsedOptions.taskBarMoveable(a)}else t=s.parsedOptions.taskBarMoveable;t&&(a.startMoveTaskBar(r,n.nativeEvent.x,n.nativeEvent.y,n.offset.y),a.updateInteractionState(e.grabing))};"touch"===n.pointerType?(t.touchEnd=!1,t.touchSetTimeout=setTimeout((()=>{t.isTouchdown=!1,t.isLongTouch=!0,o()}),100)):o()}}else l?(a.startCreateDependencyLine(l,n.nativeEvent.x,n.nativeEvent.y,n.offset.y,"left"),a.updateInteractionState(e.grabing)):h&&(a.startCreateDependencyLine(h,n.nativeEvent.x,n.nativeEvent.y,n.offset.y,"right"),a.updateInteractionState(e.grabing))})),i.ganttGroup.addEventListener("pointermove",(l=>{if(t.touchSetTimeout&&(clearTimeout(t.touchSetTimeout),t.touchSetTimeout=void 0),a.interactionState===e.default){const t=l.detailPath.find((t=>"task-bar"===t.name)),e=l.detailPath.find((t=>"markline-hover-group"===t.name)),h=l.detailPath.find((t=>"mark-line-content"===t.name));if(s.parsedOptions.markLineCreateOptions?.markLineCreatable&&(e&&!function(t,e){const i=t.startDate.getTime(),n=t.endDate.getTime();return e.some((t=>{const e=new Date(t.date).getTime();return e>=i&&e<=n}))}(e.data,s.parsedOptions.markLine)?i._gantt.stateManager.marklineIcon.target!==e&&(i._gantt.stateManager.marklineIcon.target=e,a.showMarklineIconHover()):i._gantt.stateManager.marklineIcon.target&&a.hideMarklineIconHover()),t){if(i._gantt.stateManager.hoverTaskBar.target!==t){i._gantt.stateManager.hoverTaskBar.target=t;const e=t.task_index,n=t.sub_task_index,s=t.record;s.type!==o.PROJECT&&a.showTaskBarHover(),i._gantt.hasListeners(r.MOUSEENTER_TASK_BAR)&&i._gantt.fireListeners(r.MOUSEENTER_TASK_BAR,{federatedEvent:l,event:l.nativeEvent,index:e,sub_task_index:n,record:s})}}else{if(i._gantt.stateManager.hoverTaskBar.target){if(i._gantt.hasListeners(r.MOUSELEAVE_TASK_BAR)){const t=i._gantt.stateManager.hoverTaskBar.target.task_index,e=i._gantt.stateManager.hoverTaskBar.target.sub_task_index,n=i._gantt.getRecordByIndex(t,e);i._gantt.fireListeners(r.MOUSELEAVE_TASK_BAR,{federatedEvent:l,event:l.nativeEvent,index:t,sub_task_index:e,record:n})}a.hideTaskBarHover(l)}if(s.parsedOptions.taskBarCreatable&&!h){const t=Fw(l.offset.y-s.headerHeight+s.stateManager.scrollTop,s),e=s.getTaskInfoByTaskListIndex(t.task_index,t.sub_task_index);let i=!0;if("function"==typeof s.parsedOptions.taskBarCreatable){const{startDate:n,endDate:o,taskRecord:r}=e,a={index:t.task_index,sub_task_index:t.sub_task_index,startDate:n,endDate:o,taskRecord:r,ganttInstance:s};i=s.parsedOptions.taskBarCreatable(a)}else i=s.parsedOptions.taskBarCreatable;if(i){const i=function(t,e,i){const r=Fw(e-i.headerHeight+i.stateManager.scrollTop,i),s=i.getRecordByIndex(r.task_index),a=Rw(t,i),l=i.getDateRangeByIndex(a);if(s?.children){const t=Fw(e-i.headerHeight+i.stateManager.scrollTop,i);for(let e=0;e<s.children.length;e++){const{startDate:r,endDate:a,taskDays:h,progress:d,taskRecord:c}=i.getTaskInfoByTaskListIndex(t.task_index,e);if(((i.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact||i.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange)&&c.vtable_gantt_showIndex===t.sub_task_index||i.parsedOptions.tasksShowMode===n.Sub_Tasks_Inline||i.parsedOptions.tasksShowMode===n.Project_Sub_Tasks_Inline&&s.type===o.PROJECT&&"expand"!==s.hierarchyState&&!1!==i.parsedOptions.projectSubTasksExpandable)&&l.startDate.getTime()>=r.getTime()&&l.endDate.getTime()<=a.getTime())return{startDate:r,endDate:a,taskDays:h,progress:d,taskRecord:c}}}}(l.offset.x,l.offset.y,s);if((s.parsedOptions.tasksShowMode===n.Sub_Tasks_Separate||s.parsedOptions.tasksShowMode===n.Tasks_Separate)&&!e.taskDays&&e.taskRecord&&!e.taskRecord.vtableMerge||(s.parsedOptions.tasksShowMode===n.Sub_Tasks_Inline||s.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||s.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact)&&!i){const e=Rw(l.offset.x,s),i=(e>=1?s.getDateColsWidth(0,e-1):0)-s.stateManager.scroll.horizontalBarPos,n=s.taskListTableInstance.getRowsHeight(s.taskListTableInstance.columnHeaderLevelCount,t.task_index+s.taskListTableInstance.columnHeaderLevelCount-1)+(t.sub_task_index??0)*s.parsedOptions.rowHeight-s.stateManager.scroll.verticalBarPos;return void s.scenegraph.showTaskCreationButton(i,n,e)}}}}s.scenegraph.hideTaskCreationButton()}else if(a.interactionState===e.grabing){let t,e,n;l.detailPath.find((i=>"task-bar"===i.name?(t=i,!0):"task-creation-button"===i.name||("task-bar-link-point-left"===i.name?(e=i,!0):"task-bar-link-point-right"===i.name?(n=i,!0):!!i.attribute.vtable_link&&(i.attribute.vtable_link,!0)))),t=t??e?.parent?.attribute.attachedToTaskBarNode??n?.parent?.attribute.attachedToTaskBarNode,i._gantt.stateManager.isCreatingDependencyLine()&&!t?a.hideSecondTaskBarSelectedBorder():i._gantt.stateManager.isCreatingDependencyLine()&&e&&i._gantt.stateManager.selectedTaskBar.target!==t?(a.highlightLinkPointNode(e),a.creatingDenpendencyLink.lastHighLightLinkPoint=e,a.creatingDenpendencyLink.secondTaskBarPosition="left"):i._gantt.stateManager.isCreatingDependencyLine()&&n&&i._gantt.stateManager.selectedTaskBar.target!==t?(a.highlightLinkPointNode(n),a.creatingDenpendencyLink.lastHighLightLinkPoint=n,a.creatingDenpendencyLink.secondTaskBarPosition="right"):i._gantt.stateManager.isCreatingDependencyLine()&&t&&i._gantt.stateManager.selectedTaskBar.target!==t&&(a.unhighlightLinkPointNode(a.creatingDenpendencyLink.lastHighLightLinkPoint),a.creatingDenpendencyLink.secondTaskBarNode&&a.creatingDenpendencyLink.secondTaskBarNode===t||(a.creatingDenpendencyLink.secondTaskBarNode&&a.creatingDenpendencyLink.secondTaskBarNode!==t&&a.hideSecondTaskBarSelectedBorder(),a.creatingDenpendencyLink.secondTaskBarNode=t,a.showSecondTaskBarSelectedBorder()))}})),i.ganttGroup.addEventListener("pointerup",(e=>{if(t.touchSetTimeout&&(clearTimeout(t.touchSetTimeout),t.touchSetTimeout=void 0),0===e.button){let o,l,h,d=!1,c=!1,u=!1,g=!1,p=!1,f=!1,v=!1;const b=e.detailPath.find((t=>"task-bar"===t.name?(d=!0,!0):"task-creation-button"===t.name?(c=!0,!1):"task-bar-link-point-left"===t.name?(g=!0,!1):"task-bar-link-point-right"===t.name?(p=!0,!1):t.attribute.vtable_link?(u=!0,o=t.attribute.vtable_link,!1):"markline-hover-group"===t.name?(f=!0,h=t,!1):"mark-line-content"===t.name&&(v=!0,l=t,!1)));if(d&&i._gantt.parsedOptions.taskBarSelectable&&"down"===t.poniterState){if(a.hideDependencyLinkSelectedLine(),a.showTaskBarSelectedBorder(b),s.hasListeners(r.CLICK_TASK_BAR)){const t=b.task_index,i=b.sub_task_index,n=s.getRecordByIndex(t,i);s.fireListeners(r.CLICK_TASK_BAR,{federatedEvent:e,event:e.nativeEvent,index:t,sub_task_index:i,record:n})}}else if(c&&"down"===t.poniterState){a.hideDependencyLinkSelectedLine(),a.hideTaskBarSelectedBorder();const t=Fw(e.offset.y-s.headerHeight+s.stateManager.scrollTop,s);if(s.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||s.parsedOptions.tasksShowMode===n.Sub_Tasks_Inline||s.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact){if(s.hasListeners(r.CREATE_TASK_SCHEDULE)){const i=Rw(e.offset.x,s),n=s.getDateRangeByIndex(i),o=s.parsedOptions.dateFormat??(s.parsedOptions.timeScaleIncludeHour?"yyyy-mm-dd hh:mm:ss":"yyyy-mm-dd");s.fireListeners(r.CREATE_TASK_SCHEDULE,{federatedEvent:e,event:e.nativeEvent,index:t.task_index,sub_task_index:t.sub_task_index,startDate:_C(n.startDate,o),endDate:_C(n.endDate,o),record:void 0,parentRecord:s.getRecordByIndex(t.task_index)})}}else{const i=s.getTaskInfoByTaskListIndex(t.task_index,t.sub_task_index);if(i.taskRecord){const n=s.parsedOptions.dateFormat??(s.parsedOptions.timeScaleIncludeHour?"yyyy-mm-dd hh:mm:ss":"yyyy-mm-dd"),o=Rw(e.offset.x,s),a=s.getDateRangeByIndex(o);i.taskRecord[s.parsedOptions.startDateField]=_C(a.startDate,n),i.taskRecord[s.parsedOptions.endDateField]=_C(a.endDate,n),s.scenegraph.hideTaskCreationButton(),s.updateTaskRecord(i.taskRecord,t.task_index,t.sub_task_index),s.hasListeners(r.CREATE_TASK_SCHEDULE)&&s.fireListeners(r.CREATE_TASK_SCHEDULE,{federatedEvent:e,event:e.nativeEvent,index:t.task_index,sub_task_index:t.sub_task_index,startDate:i.taskRecord[s.parsedOptions.startDateField],endDate:i.taskRecord[s.parsedOptions.endDateField],record:i.taskRecord})}}}else if(u&&i._gantt.parsedOptions.dependencyLinkSelectable&&"down"===t.poniterState)a.hideDependencyLinkSelectedLine(),a.hideTaskBarSelectedBorder(),i._gantt.stateManager.selectedDenpendencyLink.link=o,a.showDependencyLinkSelectedLine();else if((g||p)&&"down"===t.poniterState){if(s.hasListeners(r.CLICK_DEPENDENCY_LINK_POINT)){const t=Fw(e.offset.y-s.headerHeight+s.stateManager.scrollTop,s),i=s.getRecordByIndex(t.task_index,t.sub_task_index);s.fireListeners(r.CLICK_DEPENDENCY_LINK_POINT,{event:e.nativeEvent,index:t.task_index,sub_task_index:t.sub_task_index,point:g?"start":"end",record:i})}a.hideTaskBarSelectedBorder()}else if(f&&"down"===t.poniterState)s.hasListeners(r.CLICK_MARKLINE_CREATE)&&s.fireListeners(r.CLICK_MARKLINE_CREATE,{event:e.nativeEvent,position:Nw(h,i._gantt),data:i._gantt.stateManager.marklineIcon.target.data});else if(v&&"down"===t.poniterState)s.hasListeners(r.CLICK_MARKLINE_CONTENT)&&s.fireListeners(r.CLICK_MARKLINE_CONTENT,{event:e.nativeEvent,position:Nw(l,i._gantt),data:l.data});else if(g&&"draging"===t.poniterState){if(a.isCreatingDependencyLine()){const t=a.endCreateDependencyLine(e.offset.y);s.hasListeners(r.CREATE_DEPENDENCY_LINK)&&s.fireListeners(r.CREATE_DEPENDENCY_LINK,{federatedEvent:e,event:e.nativeEvent,link:t})}}else if(p&&"draging"===t.poniterState){if(a.isCreatingDependencyLine()){const t=a.endCreateDependencyLine(e.offset.y);s.hasListeners(r.CREATE_DEPENDENCY_LINK)&&s.fireListeners(r.CREATE_DEPENDENCY_LINK,{federatedEvent:e,event:e.nativeEvent,link:t})}}else a.hideDependencyLinkSelectedLine(),a.hideTaskBarSelectedBorder()}})),i.ganttGroup.addEventListener("rightdown",(t=>{let e,i=!1,n=!1;const o=t.detailPath.find((t=>"task-bar"===t.name?(i=!0,!0):!!t.attribute.vtable_link&&(n=!0,e=t.attribute.vtable_link,!1)));if(i){if(s.hasListeners(r.CONTEXTMENU_TASK_BAR)){const e=o.task_index,i=o.sub_task_index,n=s.getRecordByIndex(e,i);s.fireListeners(r.CONTEXTMENU_TASK_BAR,{federatedEvent:t,event:t.nativeEvent,index:e,sub_task_index:i,record:n})}}else n&&s.hasListeners(r.CONTEXTMENU_DEPENDENCY_LINK)&&s.fireListeners(r.CONTEXTMENU_DEPENDENCY_LINK,{federatedEvent:t,event:t.nativeEvent,link:e})})),i.ganttGroup.addEventListener("pointerenter",(t=>{(s.parsedOptions.scrollStyle.horizontalVisible&&"focus"===s.parsedOptions.scrollStyle.horizontalVisible||!s.parsedOptions.scrollStyle.horizontalVisible&&"focus"===s.parsedOptions.scrollStyle.visible)&&i.scrollbarComponent.showHorizontalScrollBar(),(s.parsedOptions.scrollStyle.verticalVisible&&"focus"===s.parsedOptions.scrollStyle.verticalVisible||!s.parsedOptions.scrollStyle.verticalVisible&&"focus"===s.parsedOptions.scrollStyle.visible)&&i.scrollbarComponent.showVerticalScrollBar()})),i.ganttGroup.addEventListener("pointerleave",(t=>{if((s.parsedOptions.scrollStyle.horizontalVisible&&"focus"===s.parsedOptions.scrollStyle.horizontalVisible||!s.parsedOptions.scrollStyle.horizontalVisible&&"focus"===s.parsedOptions.scrollStyle.visible)&&i.scrollbarComponent.hideHorizontalScrollBar(),(s.parsedOptions.scrollStyle.verticalVisible&&"focus"===s.parsedOptions.scrollStyle.verticalVisible||!s.parsedOptions.scrollStyle.verticalVisible&&"focus"===s.parsedOptions.scrollStyle.visible)&&i.scrollbarComponent.hideVerticalScrollBar(),i._gantt.stateManager.hoverTaskBar.target){if(i._gantt.hasListeners(r.MOUSELEAVE_TASK_BAR)){const e=i._gantt.stateManager.hoverTaskBar.target.task_index,n=i._gantt.stateManager.hoverTaskBar.target.sub_task_index,o=i._gantt.getRecordByIndex(e,n);i._gantt.fireListeners(r.MOUSELEAVE_TASK_BAR,{federatedEvent:t,event:t.nativeEvent,index:e,sub_task_index:n,record:o})}a.hideTaskBarHover(t)}})),i.ganttGroup.addEventListener("wheel",(t=>{xw(t,a,s)}))}(this),function(t){const i=t._gantt;t._gantt.scenegraph;const n=i.stateManager,o=t._eventHandler;o.on(i.getElement(),"contextmenu",(t=>{!1!==i.parsedOptions.eventOptions?.preventDefaultContextMenu&&t.preventDefault()})),o.on(i.getContainer(),"resize",(t=>{0===t.width&&0===t.height||(XC(i.options.pixelRatio)||i.setPixelRatio(Lz()),t.windowSizeNotChange||i._resize())})),i.taskListTableInstance&&i.parsedOptions.verticalSplitLineMoveable&&o.on(i.verticalSplitResizeLine,"mousedown",(t=>{n.updateInteractionState(e.grabing),n.startResizeTableWidth(t)}));i.parsedOptions.verticalSplitLineHighlight&&(i.verticalSplitResizeLine&&o.on(i.verticalSplitResizeLine,"mouseover",(t=>{i.verticalSplitResizeLine.childNodes[1].style.opacity="1"})),i.verticalSplitResizeLine&&o.on(i.verticalSplitResizeLine,"mouseout",(t=>{i.verticalSplitResizeLine.childNodes[1].style.opacity="0"})));const s=t=>{i.eventManager.lastDragPointerXYOnWindow={x:t.x,y:t.y},i.eventManager.poniterState="down"};t.globalEventListeners.push({name:"pointerdown",env:"document",callback:s}),Pu.addEventListener("pointerdown",s);const a=t=>{if("down"===i.eventManager.poniterState){const e=i.eventManager.lastDragPointerXYOnWindow.x??t.x,n=t.x-e,o=i.eventManager.lastDragPointerXYOnWindow.y??t.y,r=t.y-o;(Math.abs(n)>=1||Math.abs(r)>=1)&&(i.eventManager.poniterState="draging")}if(n.interactionState===e.grabing&&"draging"===i.eventManager.poniterState){const e=i.eventManager.lastDragPointerXYOnWindow?.x??t.x,o=i.eventManager.lastDragPointerXYOnWindow?.y??t.y;(Math.abs(e-t.x)>=1||Math.abs(o-t.y)>=1)&&(n.isResizingTableWidth()?(n.hideDependencyLinkSelectedLine(),n.hideTaskBarSelectedBorder(),n.dealResizeTableWidth(t)):n.isMoveingTaskBar()?(n.hideDependencyLinkSelectedLine(),n.hideTaskBarSelectedBorder(),n.dealTaskBarMove(t)):n.isResizingTaskBar()?(n.hideDependencyLinkSelectedLine(),n.hideTaskBarSelectedBorder(),n.dealTaskBarResize(t)):n.isCreatingDependencyLine()&&n.dealCreateDependencyLine(t),i.eventManager.lastDragPointerXYOnWindow={x:t.x,y:t.y})}};t.globalEventListeners.push({name:"pointermove",env:"document",callback:a}),Pu.addEventListener("pointermove",a);const l=t=>{"grabing"===n.interactionState&&(n.updateInteractionState(e.default),n.isResizingTableWidth()?n.endResizeTableWidth():n.isMoveingTaskBar()?n.endMoveTaskBar():n.isResizingTaskBar()&&n.endResizeTaskBar(t.x)),setTimeout((()=>{i.eventManager.lastDragPointerXYOnWindow=void 0,i.eventManager.poniterState="up"}),0)};t.globalEventListeners.push({name:"pointerup",env:"document",callback:l}),Pu.addEventListener("pointerup",l);const h=t=>{if(i.parsedOptions.dependencyLinkDeletable&&("Delete"===t.key&&i.parsedOptions.keyboardOptions?.deleteLinkOnDel||"Backspace"===t.key&&i.parsedOptions.keyboardOptions?.deleteLinkOnBack)&&i.stateManager.selectedDenpendencyLink.link){const e=i.stateManager.selectedDenpendencyLink.link;i.deleteLink(i.stateManager.selectedDenpendencyLink.link),n.hideDependencyLinkSelectedLine(),n.hideTaskBarSelectedBorder(),i.hasListeners(r.DELETE_DEPENDENCY_LINK)&&i.fireListeners(r.DELETE_DEPENDENCY_LINK,{event:t,link:e})}};t.globalEventListeners.push({name:"keydown",env:"document",callback:h}),Pu.addEventListener("keydown",h)}(this),function(t){const e=t._gantt,i=e.stateManager,n=e.scenegraph;if(!1===Pu.envContribution.supportsTouchEvents)return;Pu.addEventListener("contextmenu",(t=>{t.stopPropagation(),t.preventDefault()}),{capture:!0}),t.touchMovePoints=[],e.scenegraph.ganttGroup.addEventListener("touchstart",(e=>{e.target.isChildOf(n.scrollbarComponent.vScrollBar)||e.target.isChildOf(n.scrollbarComponent.hScrollBar)||(t.isTouchdown=!0,t.touchMovePoints.push({x:e.page.x,y:e.page.y,timestamp:Date.now()}))}));const o=n=>{if(t.isLongTouch&&n.preventDefault(),t.isTouchdown&&Pz(n)&&(t.isTouchMove=!0,t.touchMovePoints.length>4&&t.touchMovePoints.shift(),t.touchMovePoints.push({x:n.changedTouches[0].pageX,y:n.changedTouches[0].pageY,timestamp:Date.now()}),t._enableTableScroll)){const o=-t.touchMovePoints[t.touchMovePoints.length-1].x+t.touchMovePoints[t.touchMovePoints.length-2].x,r=-t.touchMovePoints[t.touchMovePoints.length-1].y+t.touchMovePoints[t.touchMovePoints.length-2].y;xw(n,i,e),n.cancelable&&("none"===e.parsedOptions.overscrollBehavior||Math.abs(r)>=Math.abs(o)&&0!==r&&_w(r,i)||Math.abs(r)<=Math.abs(o)&&0!==o&&Sw(o,i))&&n.preventDefault()}};Pu.addEventListener("touchmove",o,{passive:!1}),t.globalEventListeners.push({name:"touchmove",env:"vglobal",callback:o});const r=i=>{if(t.touchEnd=!0,t.isLongTouch=!1,t.isTouchdown&&Pz(i)){if(t.touchMovePoints?.length&&(t.touchMovePoints.length>4&&t.touchMovePoints.shift(),t.touchMovePoints.push({x:i.changedTouches[0].pageX,y:i.changedTouches[0].pageY,timestamp:Date.now()}),t._enableTableScroll)){const i=t.touchMovePoints[0],n=t.touchMovePoints[t.touchMovePoints?.length-1],o=(n.x-i.x)/(n.timestamp-i.timestamp),r=(n.y-i.y)/(n.timestamp-i.timestamp);t.inertiaScroll.startInertia(o,r,.95),e.eventManager.inertiaScroll.setScrollHandle(((t,i)=>{xw({deltaX:-t,deltaY:-i},e.stateManager,e)}))}t.isTouchdown=!1,t.isTouchMove=!1,t.isDraging=!1,t.touchMovePoints=[]}};Pu.addEventListener("touchend",r),t.globalEventListeners.push({name:"touchend",env:"vglobal",callback:r});const s=e=>{t.touchEnd=!0,t.isLongTouch=!1,t.isTouchdown&&(t.isTouchdown=!1,t.isTouchMove=!1,t.touchMovePoints=[],t.isDraging=!1)};Pu.addEventListener("touchcancel",s),t.globalEventListeners.push({name:"touchcancel",env:"vglobal",callback:s})}(this)}}function Oz(t){const{scroll:e}=t.stateManager,{verticalBarPos:i}=e;t.taskListTableInstance.stateManager.setScrollTop(i,void 0,!1)}function Iz(t){const e=t.taskTableWidth;t.taskTableWidth=t.taskListTableInstance.getAllColsWidth()+t.parsedOptions.outerFrameStyle.borderLineWidth,t.options?.taskListTable?.maxTableWidth&&(t.taskTableWidth=Math.min(t.options?.taskListTable?.maxTableWidth,t.taskTableWidth)),t.options?.taskListTable?.minTableWidth&&(t.taskTableWidth=Math.max(t.options?.taskListTable?.minTableWidth,t.taskTableWidth)),e!==t.taskTableWidth&&(t.element.style.left=t.taskTableWidth?`${t.taskTableWidth}px`:"0px",t.taskListTableInstance.setCanvasSize(t.taskTableWidth,t.tableNoFrameHeight+2*t.parsedOptions.outerFrameStyle.borderLineWidth),t._updateSize(),Ew(t))}class Fz{_gantt;scroll;fastScrolling;interactionState=e.default;moveTaskBar;hoverTaskBar;resizeTaskBar;selectedTaskBar;resizeTableWidth;selectedDenpendencyLink;creatingDenpendencyLink;marklineIcon;resetInteractionState=Bz((()=>{this.updateInteractionState(e.default)}),100);constructor(t){this._gantt=t,this.scroll={horizontalBarPos:0,verticalBarPos:0},this.moveTaskBar={targetStartX:null,targetStartY:null,deltaX:0,deltaY:0,startOffsetY:null,startX:null,startY:null,moving:!1,target:null,moveTaskBarXSpeed:0,moveTaskBarXInertia:new Ez},this.hoverTaskBar={targetStartX:null,startX:null,target:null},this.marklineIcon={target:null},this.selectedTaskBar={target:null},this.resizeTaskBar={startOffsetY:null,targetStartX:null,targetEndX:null,startX:null,startY:null,target:null,resizing:!1,onIconName:""},this.resizeTableWidth={lastX:null,resizing:!1},this.selectedDenpendencyLink={link:null},this.creatingDenpendencyLink={startClickedPoint:null,startX:null,startY:null,startOffsetY:null,targetStartX:null,creating:!1,secondTaskBarNode:null},this.updateVerticalScrollBar=this.updateVerticalScrollBar.bind(this),this.updateHorizontalScrollBar=this.updateHorizontalScrollBar.bind(this),function(t){t.taskListTableInstance&&t.taskListTableInstance?.on("scroll",(e=>{if("vertical"===e.scrollDirection){const{scroll:e}=t.taskListTableInstance.stateManager,{verticalBarPos:i}=e;t.stateManager.scroll.verticalBarPos!==i&&t.stateManager.setScrollTop(i,!1)}}))}(this._gantt),function(t){t.taskListTableInstance?.on("change_cell_value",(e=>{const{col:i,row:n}=e;t.taskListTableInstance.isHeader(i,n)||t._refreshTaskBar(n-t.taskListTableInstance.columnHeaderLevelCount)}))}(this._gantt),function(t){t.taskListTableInstance?.on("change_header_position",(e=>{t.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||t.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact||t.parsedOptions.tasksShowMode===n.Sub_Tasks_Separate||t.parsedOptions.tasksShowMode===n.Project_Sub_Tasks_Inline?t.scenegraph.refreshTaskBarsAndGrid():t.scenegraph.refreshTaskBars(),t.scenegraph.dragOrderLine.hideDragLine();const i=t.stateManager.scroll.horizontalBarPos,o=t.stateManager.scroll.verticalBarPos;t.scenegraph.setX(-i),t.scenegraph.setY(-o)})),t.taskListTableInstance?.on("change_header_position_start",(e=>{const{col:i,row:n,x:o,y:r,backX:s,lineX:a,backY:l,lineY:h,event:d}=e;t.scenegraph.dragOrderLine.showDragLine(h),t.scenegraph.updateNextFrame()})),t.taskListTableInstance?.on("changing_header_position",(e=>{const{col:i,row:n,x:o,y:r,backX:s,lineX:a,backY:l,lineY:h,event:d}=e;t.scenegraph.dragOrderLine.showDragLine(h),t.scenegraph.updateNextFrame()})),t.taskListTableInstance?.on("change_header_position_fail",(e=>{t.scenegraph.dragOrderLine.hideDragLine(),t.scenegraph.updateNextFrame()}))}(this._gantt),function(t){t.taskListTableInstance?.on("tree_hierarchy_state_change",(e=>{const{row:i,hierarchyState:r}=e;if(t.parsedOptions.tasksShowMode===n.Project_Sub_Tasks_Inline){const e=i-t.taskListTableInstance.columnHeaderLevelCount,n=t.getRecordByIndex(e);n&&n.type===o.PROJECT&&n.children?.length>0&&(n.hierarchyState=r)}t._syncPropsFromTable(),t.scenegraph.refreshTaskBarsAndGrid(),!t.taskListTableInstance.checkHasColumnAutoWidth()||"auto"!==t.options.taskListTable?.tableWidth&&-1!==t.taskTableWidth||Iz(t);const s=t.stateManager.scroll.horizontalBarPos,a=t.stateManager.scroll.verticalBarPos;t.scenegraph.setX(-s),t.scenegraph.setY(-a)}))}(this._gantt),function(t){t.taskListTableInstance?.on("after_sort",(e=>{t.scenegraph.refreshTaskBars();const i=t.stateManager.scroll.horizontalBarPos,n=t.stateManager.scroll.verticalBarPos;t.scenegraph.setX(-i),t.scenegraph.setY(-n)}))}(this._gantt),"auto"!==this._gantt.options.taskListTable?.tableWidth&&-1!==this._gantt.taskTableWidth||function(t){t.taskListTableInstance?.on("resize_column",(e=>{Iz(t)}))}(this._gantt)}setScrollTop(t,e=!0){const i=this._gantt.getAllRowsHeight();t=Math.max(0,Math.min(t,i-this._gantt.scenegraph.height)),t=Math.ceil(t);const n=this.scroll.verticalBarPos;this.scroll.verticalBarPos=t,XC(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this._gantt.scenegraph.setY(-t);const o=t/(i-this._gantt.scenegraph.height);this._gantt.scenegraph.scrollbarComponent.updateVerticalScrollBarPos(o),n!==t&&e&&(Oz(this._gantt),this._gantt.fireListeners(r.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"vertical",scrollRatioY:o}))}get scrollLeft(){return this.scroll.horizontalBarPos}get scrollTop(){return this.scroll.verticalBarPos}setScrollLeft(t,e=!0){const i=this._gantt.getAllDateColsWidth();t=Math.max(0,Math.min(t,i-this._gantt.scenegraph.width)),t=Math.ceil(t);const n=this.scroll.horizontalBarPos;this.scroll.horizontalBarPos=t,XC(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this._gantt.scenegraph.setX(-t);const o=t/(i-this._gantt.scenegraph.width);this._gantt.scenegraph.scrollbarComponent.updateHorizontalScrollBarPos(o),n!==t&&e&&this._gantt.fireListeners(r.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"horizontal",scrollRatioX:o})}updateInteractionState(t){if(this.interactionState===t)return;const i=this.interactionState;this.interactionState=t,i===e.scrolling&&e.default}updateVerticalScrollBar(t){const e=this._gantt.getAllRowsHeight();this.scroll.verticalBarPos,this.scroll.verticalBarPos=Math.ceil(t*(e-this._gantt.scenegraph.height)),XC(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this._gantt.scenegraph.setY(-this.scroll.verticalBarPos,1===t),Oz(this._gantt),this._gantt.fireListeners(r.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"vertical",scrollRatioY:t})}updateHorizontalScrollBar(t){const e=this._gantt.getAllDateColsWidth();this.scroll.horizontalBarPos,this.scroll.horizontalBarPos=Math.ceil(t*(e-this._gantt.scenegraph.width)),XC(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this._gantt.scenegraph.setX(-this.scroll.horizontalBarPos,1===t),this._gantt.fireListeners(r.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"horizontal",scrollRatioY:t})}startMoveTaskBar(t,e,i,n){"task-bar-hover-shadow"===t.name&&(t=t.parent),this.moveTaskBar.moving=!0,this.moveTaskBar.target=t,this.moveTaskBar.targetStartX=t.attribute.x,this.moveTaskBar.targetStartY=t.attribute.y,this.moveTaskBar.startX=e,this.moveTaskBar.startY=i,this.moveTaskBar.startOffsetY=n,t.setAttribute("zIndex",1e4)}isMoveingTaskBar(){return this.moveTaskBar.moving}endMoveTaskBar(){this.moveTaskBar.moveTaskBarXInertia.isInertiaScrolling()&&this.moveTaskBar.moveTaskBarXInertia.endInertia();const t=this.moveTaskBar.deltaX,e=this.moveTaskBar.deltaY,i=this.moveTaskBar.target;if(Math.abs(t)>=1||Math.abs(e)>=1){const t=i.task_index,s=i.sub_task_index,{startDate:a,endDate:l}=this._gantt.getTaskInfoByTaskListIndex(t,s),h=this.moveTaskBar.targetStartY+this._gantt.parsedOptions.rowHeight*Math.round(e/this._gantt.parsedOptions.rowHeight),d=this._gantt.parsedOptions.taskBarMilestoneStyle.width,c=Rw(this.moveTaskBar.target.attribute.x+(i.record.type===o.MILESTONE?d/2:0)-this._gantt.stateManager.scroll.horizontalBarPos,this._gantt),u=this._gantt.parsedOptions.reverseSortedTimelineScales[0].timelineDates[c];if(!u)return;const g=u.startDate,p=new Date(g.getTime()+(PC(l).getTime()-PC(a).getTime()));let f;if(PC(a).getTime()!==g.getTime()){f=PC(a).getTime()>g.getTime()?"left":"right",this._gantt._updateStartEndDateToTaskRecord(g,p,t,s);const e=this._gantt.getRecordByIndex(t,s);this._gantt.hasListeners(r.CHANGE_DATE_RANGE)&&this._gantt.fireListeners(r.CHANGE_DATE_RANGE,{startDate:e[this._gantt.parsedOptions.startDateField],endDate:e[this._gantt.parsedOptions.endDateField],oldStartDate:a,oldEndDate:l,index:t,record:e})}if(this._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||this._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact){const t=Fw(h,this._gantt);this._gantt._dragOrderTaskRecord(i.task_index,i.sub_task_index,t.task_index,t.sub_task_index),Iw(this._gantt.records),this._gantt.taskListTableInstance.renderWithRecreateCells(),this._gantt._syncPropsFromTable(),this._gantt.scenegraph.refreshTaskBarsAndGrid()}else if(this._gantt.parsedOptions.tasksShowMode!==n.Tasks_Separate&&Math.abs(Math.round(e/this._gantt.parsedOptions.rowHeight))>=1){const t=Fw(h,this._gantt);this._gantt._dragOrderTaskRecord(i.task_index,i.sub_task_index,t.task_index,t.sub_task_index),this._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Separate?(this._gantt.taskListTableInstance.renderWithRecreateCells(),this._gantt.scenegraph.refreshTaskBarsAndGrid()):(this._gantt.scenegraph.taskBar.refresh(),this._gantt.scenegraph.dependencyLink.refresh())}else{let t=c>=1?this._gantt.getDateColsWidth(0,c-1):0;if(i.record.type===o.MILESTONE){t-=this._gantt.parsedOptions.taskBarMilestoneStyle.width/2}if(Dz(i,t-i.attribute.x,h-i.attribute.y,this),"right"===f){let t=i;for(;t.nextSibling&&t.nextSibling.attribute.y===i.attribute.y&&t.nextSibling.record[this._gantt.parsedOptions.startDateField]<=i.record[this._gantt.parsedOptions.startDateField];)t=t.nextSibling;t!==i&&t.parent.insertAfter(i,t)}else if("left"===f){let t=i;for(;t.previousSibling&&t.previousSibling.attribute.y===i.attribute.y&&t.previousSibling.record[this._gantt.parsedOptions.startDateField]>=i.record[this._gantt.parsedOptions.startDateField];)t=t.previousSibling;t!==i&&t.parent.insertBefore(i,t)}}this._gantt.scenegraph.updateNextFrame()}this.moveTaskBar.moving=!1,this.selectedTaskBar.target!==i&&i.setAttribute("zIndex",0),i.updateTextPosition(),this.moveTaskBar.target=null,this.moveTaskBar.deltaX=0,this.moveTaskBar.deltaY=0,this.moveTaskBar.moveTaskBarXSpeed=0}dealTaskBarMove(t){const e=this._gantt;let i=this.moveTaskBar.target;i.setAttribute("zIndex",1e4);const n=e.eventManager.lastDragPointerXYOnWindow.x,o=t.x-n,r=e.eventManager.lastDragPointerXYOnWindow.y,s=t.y-r;if(this.moveTaskBar.deltaX+=o,this.moveTaskBar.deltaY+=s,Dz(i,o,s,this),i.attribute.x<=e.stateManager.scrollLeft&&o<0)if(e.parsedOptions.moveTaskBarToExtendDateRange&&0===e.stateManager.scrollLeft){this.moveTaskBar.moveTaskBarXInertia?.endInertia();const n=e.parsedOptions.reverseSortedTimelineScales[0].timelineDates[1].startDate.getTime()-e.parsedOptions.reverseSortedTimelineScales[0].timelineDates[0].startDate.getTime(),{unit:o,startOfWeek:r}=e.parsedOptions.reverseSortedTimelineScales[0];e.parsedOptions.minDate=zC(new Date(e.parsedOptions.reverseSortedTimelineScales[0].timelineDates[0].startDate.getTime()-n/2),o,r),e.parsedOptions._minDateTime=e.parsedOptions.minDate?.getTime(),e._generateTimeLineDateMap(),e._updateSize(),e.scenegraph.refreshAll(),i=this.moveTaskBar.target=e.scenegraph.taskBar.getTaskBarNodeByIndex(this.moveTaskBar.target.task_index,this.moveTaskBar.target.sub_task_index),e.scrollLeft=e.parsedOptions.timelineColWidth-1,e.eventManager.lastDragPointerXYOnWindow.x=t.x,"milestone"===i.record?.type?Dz(i,e.scrollLeft-i.attribute.x,0,this):i.setAttribute("x",e.scrollLeft)}else this.moveTaskBar.moveTaskBarXSpeed=-e.parsedOptions.timelineColWidth/100,this.moveTaskBar.moveTaskBarXInertia.startInertia(this.moveTaskBar.moveTaskBarXSpeed,0,1),this.moveTaskBar.moveTaskBarXInertia.setScrollHandle(((t,n)=>{this.moveTaskBar.deltaX+=t,this.moveTaskBar.deltaY+=n,Dz(i,t,n,this),e.stateManager.setScrollLeft(i.attribute.x),0===e.stateManager.scrollLeft&&this.moveTaskBar.moveTaskBarXInertia.endInertia()}));else if(i.attribute.x+i.attribute.width>=e.stateManager.scrollLeft+e.tableNoFrameWidth&&o>0)if(e.parsedOptions.moveTaskBarToExtendDateRange&&e.stateManager.scrollLeft+e.tableNoFrameWidth===e.getAllDateColsWidth()){this.moveTaskBar.moveTaskBarXInertia?.endInertia();const n=e.parsedOptions.reverseSortedTimelineScales[0].timelineDates,o=n[1].startDate.getTime()-n[0].startDate.getTime(),{unit:r,startOfWeek:s,step:a}=e.parsedOptions.reverseSortedTimelineScales[0];if(e.parsedOptions.maxDate=FC(e.parsedOptions.minDate,new Date(n[n.length-1].endDate.getTime()+o/2),r,a),e.parsedOptions._maxDateTime=e.parsedOptions.maxDate?.getTime(),e._generateTimeLineDateMap(),e._updateSize(),e.scenegraph.refreshAll(),i=this.moveTaskBar.target=e.scenegraph.taskBar.getTaskBarNodeByIndex(this.moveTaskBar.target.task_index,this.moveTaskBar.target.sub_task_index),e.scrollLeft+=1,e.eventManager.lastDragPointerXYOnWindow.x=t.x,"milestone"===i.record?.type){const t=e.scrollLeft+e.tableNoFrameWidth-i.attribute.width;Dz(i,t-i.attribute.x,0,this)}else i.setAttribute("x",e.scrollLeft+e.tableNoFrameWidth-i.attribute.width)}else this.moveTaskBar.moveTaskBarXSpeed=e.parsedOptions.timelineColWidth/100,this.moveTaskBar.moveTaskBarXInertia.startInertia(this.moveTaskBar.moveTaskBarXSpeed,0,1),this.moveTaskBar.moveTaskBarXInertia.setScrollHandle(((t,n)=>{this.moveTaskBar.deltaX+=t,this.moveTaskBar.deltaY+=n,Dz(i,t,n,this),e.stateManager.setScrollLeft(i.attribute.x+i.attribute.width-e.tableNoFrameWidth),e.stateManager.scrollLeft===e.getAllDateColsWidth()-e.tableNoFrameWidth&&this.moveTaskBar.moveTaskBarXInertia.endInertia()}));else this.moveTaskBar.moveTaskBarXInertia.isInertiaScrolling()?this.moveTaskBar.moveTaskBarXInertia.endInertia():this.moveTaskBar.moveTaskBarXSpeed=0;e.scenegraph.updateNextFrame()}startResizeTaskBar(t,e,i,n,o){this.resizeTaskBar.onIconName=o,this.resizeTaskBar.resizing=!0,this.resizeTaskBar.target=t,this.resizeTaskBar.targetStartX=t.attribute.x,this.resizeTaskBar.targetEndX=t.attribute.x+t.attribute.width,this.resizeTaskBar.startX=e,this.resizeTaskBar.startY=i,this.resizeTaskBar.startOffsetY=n}isResizingTaskBar(){return this.resizeTaskBar.resizing}endResizeTaskBar(t){const e=this._gantt.stateManager.resizeTaskBar.onIconName,i=t-this.resizeTaskBar.startX;if(Math.abs(i)>=1){const t=Rw(("left"===e?this.resizeTaskBar.target.attribute.x:this.resizeTaskBar.target.attribute.x+this.resizeTaskBar.target.attribute.width)-this._gantt.stateManager.scroll.horizontalBarPos,this._gantt),i=this._gantt.parsedOptions.reverseSortedTimelineScales[0].timelineDates[t];if(!i)return;const o="left"===e?i.startDate:i.endDate,s=this.resizeTaskBar.target,a=s.clipGroupBox,l=s.barRect,h=s.progressRect,d=s.textLabel,c=s.task_index,u=s.sub_task_index,{taskDays:g,progress:p,startDate:f,endDate:v}=this._gantt.getTaskInfoByTaskListIndex(c,u);let b=!1;if("left"===e?(this._gantt._updateStartDateToTaskRecord(o,c,u),o.getTime()!==new Date(f).getTime()&&(b=!0)):(this._gantt._updateEndDateToTaskRecord(o,c,u),o.getTime()!==new Date(v).getTime()&&(b=!0)),this._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||this._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact)this._gantt.taskListTableInstance.renderWithRecreateCells(),this._gantt._syncPropsFromTable(),this._gantt.scenegraph.refreshTaskBarsAndGrid();else{if("left"===e){const e=t>=1?this._gantt.getDateColsWidth(0,t-1):0;s.setAttribute("x",e),s.setAttribute("width",this.resizeTaskBar.targetEndX-e)}else if("right"===e){const e=this._gantt.getDateColsWidth(0,t);s.setAttribute("width",e-this.resizeTaskBar.targetStartX)}if(a.setAttribute("width",s.attribute.width),l?.setAttribute("width",s.attribute.width),h?.setAttribute("width",p/100*s.attribute.width),d){const{textAlign:t,textBaseline:e,padding:i}=this._gantt.parsedOptions.taskBarLabelStyle,n=Pw(MC(i),t,e,s.attribute.width,s.attribute.height);d.setAttribute("maxLineWidth",s.attribute.width-20),d.setAttribute("x",n.x)}this._gantt.scenegraph.refreshRecordLinkNodes(c,u,s,0),this.showTaskBarHover(),zz(this._gantt,s,c,u),s.setAttribute("zIndex",0)}if(s.updateTextPosition(),this.resizeTaskBar.resizing=!1,this.resizeTaskBar.target=null,b&&this._gantt.hasListeners(r.CHANGE_DATE_RANGE)){const t=this._gantt.getRecordByIndex(c,u);this._gantt.fireListeners(r.CHANGE_DATE_RANGE,{startDate:t[this._gantt.parsedOptions.startDateField],endDate:t[this._gantt.parsedOptions.endDateField],oldStartDate:f,oldEndDate:v,index:c,record:t})}this._gantt.scenegraph.updateNextFrame()}}dealTaskBarResize(t){const e=this._gantt.eventManager.lastDragPointerXYOnWindow.x,i=t.x-e,n=this._gantt.stateManager.resizeTaskBar.target;let r="left"===this._gantt.stateManager.resizeTaskBar.onIconName?-i:i;const s=Math.max(1,n.attribute.width+r);r=s-n.attribute.width,function(t,e,i,n){const r=n._gantt.parsedOptions.progressField,s=t.clipGroupBox,a=t.barRect,l=t.progressRect,h=t.textLabel,d=t.task_index,c=t.sub_task_index,u=t.record,g=u[r],p=u.type===o.MILESTONE;t.setAttribute("zIndex",1e4),e&&t.setAttribute("x",t.attribute.x+e);p&&t.setAttribute("anchor",[t.attribute.x+t.attribute.width/2,t.attribute.y+t.attribute.height/2]);i&&t.setAttribute("width",i);if(s.setAttribute("width",t.attribute.width),a?.setAttribute("width",t.attribute.width),l?.setAttribute("width",g/100*t.attribute.width),h){const{textAlign:e,textBaseline:o,padding:r}=n._gantt.parsedOptions.taskBarLabelStyle,s=Pw(MC(r),e,o,i,t.attribute.height);h.setAttribute("maxLineWidth",i-20),h.setAttribute("x",s.x)}t.updateTextPosition(),n.showTaskBarHover(),zz(n._gantt,t,d,c),n._gantt.scenegraph.refreshRecordLinkNodes(d,c,t,0)}(n,"left"===this._gantt.stateManager.resizeTaskBar.onIconName?-r:0,s,this),this._gantt.scenegraph.updateNextFrame()}startCreateDependencyLine(t,e,i,n,o){this.resizeTaskBar.resizing=!1,this.creatingDenpendencyLink.creating=!0,this.creatingDenpendencyLink.startClickedPoint=t,this.creatingDenpendencyLink.startX=e,this.creatingDenpendencyLink.startY=i,this.creatingDenpendencyLink.startOffsetY=n,this.creatingDenpendencyLink.firstTaskBarPosition=o,this.highlightLinkPointNode(t)}isCreatingDependencyLine(){return this.creatingDenpendencyLink.creating}endCreateDependencyLine(t){const e=this._gantt.parsedOptions.taskKeyField,n=this.selectedTaskBar.target.task_index,o=this.selectedTaskBar.target.sub_task_index,r=this.creatingDenpendencyLink.secondTaskBarNode.task_index,s=this.creatingDenpendencyLink.secondTaskBarNode.sub_task_index,a={linkedFromTaskKey:this._gantt.getRecordByIndex(n,o)[e],linkedToTaskKey:this._gantt.getRecordByIndex(r,s)[e],type:"left"===this.creatingDenpendencyLink.firstTaskBarPosition&&"left"===this.creatingDenpendencyLink.secondTaskBarPosition?i.StartToStart:"right"===this.creatingDenpendencyLink.firstTaskBarPosition&&"left"===this.creatingDenpendencyLink.secondTaskBarPosition?i.FinishToStart:"right"===this.creatingDenpendencyLink.firstTaskBarPosition&&"right"===this.creatingDenpendencyLink.secondTaskBarPosition?i.FinishToFinish:i.StartToFinish};return this._gantt.addLink(a),this.hideTaskBarSelectedBorder(),this._gantt.scenegraph.updateNextFrame(),this.creatingDenpendencyLink.creating=!1,a}dealCreateDependencyLine(t){const e=this.creatingDenpendencyLink.startX,i=this.creatingDenpendencyLink.startY,n=t.x-e,o=t.y-i,r=this.creatingDenpendencyLink.startClickedPoint,s=r.attribute.x+r.attribute.width/2,a=r.attribute.y+r.attribute.height/2;this._gantt.scenegraph.taskBar.updateCreatingDependencyLine(s,a,s+n,a+o),this._gantt.scenegraph.updateNextFrame()}startResizeTableWidth(t){this.resizeTableWidth.resizing=!0,this.resizeTableWidth.lastX=t.pageX}isResizingTableWidth(){return this.resizeTableWidth.resizing}endResizeTableWidth(){this.resizeTableWidth.resizing=!1}dealResizeTableWidth(t){if(!this.resizeTableWidth.resizing)return;const e=t.pageX-this.resizeTableWidth.lastX;if(Math.abs(e)>=1){let i=this._gantt.taskTableWidth+e;const n=Math.min(this._gantt.taskListTableInstance.getAllColsWidth()+this._gantt.parsedOptions.outerFrameStyle.borderLineWidth,this._gantt.options.taskListTable.maxTableWidth??1e5),o=Math.max(this._gantt.parsedOptions.outerFrameStyle.borderLineWidth,this._gantt.options.taskListTable.minTableWidth??0);e>0&&i>n&&(i=n),e<0&&i<o&&(i=o),this._gantt.taskTableWidth=i,this._gantt.element.style.left=this._gantt.taskTableWidth?`${this._gantt.taskTableWidth}px`:"0px",this._gantt.verticalSplitResizeLine.style.left=this._gantt.taskTableWidth?this._gantt.taskTableWidth-7+"px":"0px",this._gantt._resize(),this.resizeTableWidth.lastX=t.pageX}}showTaskBarHover(){const t=this._gantt.stateManager.hoverTaskBar.target;if(t){const e=t.attribute.x,i=t.attribute.y,n=t.attribute.width,o=t.attribute.height;this._gantt.scenegraph.taskBar.showHoverBar(e,i,n,o,t),this._gantt.scenegraph.updateNextFrame()}}hideTaskBarHover(t){this._gantt.stateManager.hoverTaskBar.target=null,this._gantt.scenegraph.taskBar.hideHoverBar(),this._gantt.scenegraph.updateNextFrame()}showTaskBarSelectedBorder(t){this._gantt.stateManager.selectedTaskBar.target?.setAttribute("zIndex",0),this._gantt.stateManager.selectedTaskBar.target=t;const e=this._gantt.parsedOptions.dependencyLinkCreatable;t.setAttribute("zIndex",1e4);const i=t.attribute.x,n=t.attribute.y,o=t.attribute.width,r=t.attribute.height;this._gantt.scenegraph.taskBar.createSelectedBorder(i,n,o,r,t,e),this._gantt.scenegraph.updateNextFrame()}hideTaskBarSelectedBorder(){this._gantt.stateManager.selectedTaskBar.target?.setAttribute("zIndex",0),this._gantt.stateManager.selectedTaskBar.target=null,this._gantt.scenegraph.taskBar.removeSelectedBorder(),this._gantt.scenegraph.updateNextFrame()}showSecondTaskBarSelectedBorder(){const t=this._gantt.stateManager.creatingDenpendencyLink.secondTaskBarNode,e=t.attribute.x,i=t.attribute.y,n=t.attribute.width,o=t.attribute.height;this._gantt.scenegraph.taskBar.createSelectedBorder(e,i,n,o,t,!0),this._gantt.scenegraph.updateNextFrame()}hideSecondTaskBarSelectedBorder(){this._gantt.stateManager.creatingDenpendencyLink.secondTaskBarNode=null,this._gantt.scenegraph.taskBar.removeSecondSelectedBorder(),this._gantt.scenegraph.updateNextFrame()}showDependencyLinkSelectedLine(){const t=this._gantt.stateManager.selectedDenpendencyLink.link;this._gantt.scenegraph.dependencyLink.createSelectedLinkLine(t);const{taskKeyField:e,dependencyLinks:i}=this._gantt.parsedOptions,{linkedToTaskKey:o,linkedFromTaskKey:r,type:s}=t;let a,l,h,d;const c=Hw(this._gantt.records,e,o),u=Hw(this._gantt.records,e,r);this._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Inline||this._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Separate||this._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||this._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact?(a=u.index[0],l=u.index[1],h=c.index[0],d=c.index[1]):(a=this._gantt.getTaskShowIndexByRecordIndex(u.index),h=this._gantt.getTaskShowIndexByRecordIndex(c.index));const g=this._gantt.scenegraph.taskBar.getTaskBarNodeByIndex(a,l);this._gantt.scenegraph.taskBar.createSelectedBorder(g.attribute.x,g.attribute.y,g.attribute.width,g.attribute.height,g,!1);const p=this._gantt.scenegraph.taskBar.getTaskBarNodeByIndex(h,d);this._gantt.scenegraph.taskBar.createSelectedBorder(p.attribute.x,p.attribute.y,p.attribute.width,p.attribute.height,p,!1),this._gantt.scenegraph.updateNextFrame()}hideDependencyLinkSelectedLine(){this._gantt.stateManager.selectedDenpendencyLink.link=null,this._gantt.scenegraph.dependencyLink.removeSelectedLinkLine(),this._gantt.scenegraph.taskBar.removeSelectedBorder(),this._gantt.scenegraph.updateNextFrame()}highlightLinkPointNode(t){if(t?.children.length>0){const e=t.children[0];e.setAttribute("fill",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.fillColor),e.setAttribute("stroke",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.strokeColor),e.setAttribute("radius",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.radius),e.setAttribute("lineWidth",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.strokeWidth),this._gantt.scenegraph.updateNextFrame()}}unhighlightLinkPointNode(t){if(t?.children.length>0){const e=t.children[0];e.setAttribute("fill",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.fillColor),e.setAttribute("stroke",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeColor),e.setAttribute("radius",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.radius),e.setAttribute("lineWidth",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeWidth),this._gantt.scenegraph.updateNextFrame()}}showMarklineIconHover(){const t=this._gantt.stateManager.marklineIcon.target;if(t){const e=this._gantt.scenegraph.timelineHeader.showMarklineIcon(t.parent);e&&this._gantt.parsedOptions.markLineCreateOptions?.markLineCreationHoverToolTip?.tipContent&&this._gantt.scenegraph.showToolTip(e),this._gantt.scenegraph.updateNextFrame()}}hideMarklineIconHover(){this._gantt.scenegraph.timelineHeader.hideMarklineIconHover(this._gantt.stateManager.marklineIcon.target.parent),this._gantt.scenegraph.hideToolTip(),this._gantt.stateManager.marklineIcon.target=null,this._gantt.scenegraph.updateNextFrame()}updateProjectTaskTimes(t){if(!t||0===t.length||!this._gantt||!this._gantt.records)return;const e=this._gantt.parsedOptions.startDateField,i=this._gantt.parsedOptions.endDateField,n=[...t];for(;n.length>0;){const t=[...n],r=t.pop();let s=this._gantt.records;for(const e of t){if(!s[e]||!s[e].children)return;s=s[e].children}const a=0===t.length?this._gantt.records[r]:s[r];if(a&&a.type===o.PROJECT&&a.children&&a.children.length>0){let t=null,n=null;for(const o of a.children)if(o[e]&&o[i]){const r=new Date(o[e]),s=new Date(o[i]);(!t||r<t)&&(t=r),(!n||s>n)&&(n=s)}if(t&&n){const o=a[e]?new Date(a[e]):null,r=a[i]?new Date(a[i]):null;if(!o||!r||t.getTime()!==o.getTime()||n.getTime()!==r.getTime()){const o=this._gantt.parsedOptions.dateFormat??this._gantt.parseTimeFormat(a[e]||a.children[0][e]),r=t=>this._gantt.formatDate?this._gantt.formatDate(t,o):t.toISOString().split("T")[0];a[e]=r(t),a[i]=r(n)}}}n.pop()}this._gantt.scenegraph?.refreshAll()}}function zz(t,e,i,n){const o=t.parsedOptions.taskBarCustomLayout;if(o){let r;if("function"==typeof o){const{startDate:s,endDate:a,taskDays:l,progress:h,taskRecord:d}=t.getTaskInfoByTaskListIndex(i,n);r=o({width:e.attribute.width,height:e.attribute.height,index:i,startDate:s,endDate:a,taskDays:l,progress:h,taskRecord:d,ganttInstance:t})}else r=o;if(r){const t=r.rootContainer;t.name="task-bar-custom-render";const i=e.children.find((t=>"task-bar-group"===t.name));if(i){const e=i.children.findIndex((t=>"task-bar-custom-render"===t.name)),n=i.children[e];n&&(i.removeChild(n),i.insertInto(t,e))}}}}function Dz(t,e,i,r){const s=t.task_index,a=t.sub_task_index,l=t.record.type===o.MILESTONE,h=t.attribute.x,d=t.attribute.y;if(e&&t.setAttribute("x",Math.max(0,t.attribute.x+e)),r._gantt.parsedOptions.tasksShowMode!==n.Tasks_Separate&&r._gantt.parsedOptions.tasksShowMode!==n.Project_Sub_Tasks_Inline?i&&t.setAttribute("y",t.attribute.y+i):i=0,l&&(t.setAttribute("anchor",[t.attribute.x+t.attribute.width/2,t.attribute.y+t.attribute.height/2]),t.milestoneTextContainer)){const e=t.attribute.x-h,i=t.attribute.y-d,n=t.milestoneTextContainer.attribute.x,o=t.milestoneTextContainer.attribute.y;t.milestoneTextContainer.setAttribute("x",n+e),t.milestoneTextContainer.setAttribute("y",o+i)}t.updateTextPosition(),r._gantt.scenegraph.refreshRecordLinkNodes(s,a,t,i)}let Wz=1,Nz=class{listenersData={listeners:{},listenerData:{}};on(t,e){const i=this.listenersData.listeners[t]||(this.listenersData.listeners[t]=[]);i.push(e);const n=Wz++;return this.listenersData.listenerData[n]={type:t,listener:e,remove:()=>{delete this.listenersData.listenerData[n];const o=i.indexOf(e);i.splice(o,1),this.listenersData.listeners[t].length||delete this.listenersData.listeners[t]}},n}off(t,e){if(e){const i=t;this.removeEventListener(i,e)}else{const e=t;if(!this.listenersData)return;this.listenersData.listenerData[e]?.remove()}}addEventListener(t,e,i){this.on(t,e)}removeEventListener(t,e){if(this.listenersData)for(const i in this.listenersData.listenerData){const n=this.listenersData.listenerData[i];n.type===t&&n.listener===e&&this.off(i)}}hasListeners(t){return!!this.listenersData&&!!this.listenersData.listeners[t]}fireListeners(t,e){if(!this.listenersData)return[];const i=this.listenersData.listeners[t];return i?i.map((t=>t.call(this,e))).filter((t=>XC(t))):[]}release(){delete this.listenersData}};class Gz{records;_gantt;constructor(t){this._gantt=t,this.records=t.records,this.processRecords()}processRecords(){const t=!this._gantt.options.minDate,e=!this._gantt.options.maxDate;let i=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;if((t||e||this._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Inline||this._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact)&&this.records.length){for(let r=0;r<this.records.length;r++){const s=this.records[r];if(t&&s[this._gantt.parsedOptions.startDateField]){const t=PC(s[this._gantt.parsedOptions.startDateField]);i=Math.min(i,t.getTime())}if(e&&s[this._gantt.parsedOptions.endDateField]){const t=PC(s[this._gantt.parsedOptions.endDateField]);o=Math.max(o,t.getTime())}this._gantt.parsedOptions.tasksShowMode!==n.Sub_Tasks_Inline&&this._gantt.parsedOptions.tasksShowMode!==n.Sub_Tasks_Compact||s.children&&s.children.sort(((t,e)=>PC(t[this._gantt.parsedOptions.startDateField]).getTime()-PC(e[this._gantt.parsedOptions.startDateField]).getTime()))}const{unit:r,startOfWeek:s,step:a}=this._gantt.parsedOptions.reverseSortedTimelineScales[0];t&&(this._gantt.parsedOptions.minDate=zC(new Date(i),r,s),this._gantt.parsedOptions._minDateTime=this._gantt.parsedOptions.minDate.getTime()),t&&!e&&(this._gantt.parsedOptions.maxDate=FC(this._gantt.parsedOptions.minDate,new Date(this._gantt.options.maxDate),r,a),this._gantt.parsedOptions._maxDateTime=this._gantt.parsedOptions.maxDate.getTime()),e&&(this._gantt.parsedOptions.maxDate=FC(this._gantt.parsedOptions.minDate,new Date(o),r,a),this._gantt.parsedOptions._maxDateTime=this._gantt.parsedOptions.maxDate.getTime())}}adjustOrder(t,e,i,r){if(this._gantt.parsedOptions.tasksShowMode!==n.Sub_Tasks_Arrange&&this._gantt.parsedOptions.tasksShowMode!==n.Sub_Tasks_Compact||t!==i)if(this._gantt.parsedOptions.tasksShowMode===n.Sub_Tasks_Inline){if(XC(e)&&XC(r)&&XC(t)&&XC(i)){const n=this.records[t].children[e];this.records[t].children.splice(e,1),this.records[i].children||(this.records[i].children=[]),this.records[i].children.splice(r,0,n)}this.records[i]?.children?.sort(((t,e)=>PC(t[this._gantt.parsedOptions.startDateField]).getTime()-PC(e[this._gantt.parsedOptions.startDateField]).getTime()))}else if(this._gantt.parsedOptions.tasksShowMode===n.Project_Sub_Tasks_Inline){if(XC(e)&&XC(r)&&XC(t)&&XC(i)){this.records[t].type,o.PROJECT;const n=this.records[i].type===o.PROJECT,s=this.records[t].children[e];this.records[t].children.splice(e,1),this.records[i].children||(this.records[i].children=[]),this.records[i].children.splice(r,0,s),n&&this.records[i]?.children?.sort(((t,e)=>PC(t[this._gantt.parsedOptions.startDateField]).getTime()-PC(e[this._gantt.parsedOptions.startDateField]).getTime()))}}else if(XC(e)&&XC(r)&&XC(t)&&XC(i)){const n=this.records[t].children[e];this.records[t].children.splice(e,1),this.records[i].children||(this.records[i].children=[]),this.records[i].children.splice(r,0,n)}}setRecords(t){this.records=t,this.processRecords()}}class jz{plugins=new Map;gantt;constructor(t,e){this.gantt=t,e.plugins?.forEach((t=>{this.register(t),this._initializePluginRun(t)}))}_initializePluginRun(t){if(void 0===t.runTime)try{t.run(this.gantt)}catch(t){}else this._bindGanttEventForPlugin(t)}register(t){this.plugins.set(t.id,t)}registerAll(t){t.forEach((t=>this.register(t)))}getPlugin(t){return this.plugins.get(t)}getPluginByName(t){return Array.from(this.plugins.values()).find((e=>e.name===t))}_bindGanttEventForPlugin(t){t.runTime&&t.runTime.forEach((e=>{this.gantt.on(e,((...i)=>{try{t.run?.(...i,e,this.gantt)}catch(t){}}))}))}updatePlugins(t){Array.from(this.plugins.values()).filter((e=>!t?.some((t=>t.id===e.id)))).forEach((t=>{this.release(),this.plugins.delete(t.id)})),this.plugins.forEach((t=>{t.update&&t.update()}));const e=t?.filter((t=>!this.plugins.has(t.id)));e?.forEach((t=>{this.register(t),this._initializePluginRun(t)}))}release(){this.plugins.forEach((t=>{try{t.release?.(this.gantt)}catch(t){}}))}}var Vz=Object.freeze({__proto__:null,formatDate:_C,getTodayNearDay:function(t,e){const i=(new Date).getTime(),n=new Date(i+864e5*t);if(e){const t=n.getFullYear().toString(),i=(n.getMonth()+1).toString().padStart(2,"0"),o=n.getDate().toString().padStart(2,"0");return e=(e=(e=e.replace("yyyy",t)).replace("mm",i)).replace("dd",o)}return n},getWeekNumber:LC,getWeekday:function(t,e="long"){const i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=new Date(t);return"short"===e?i[n.getDay()].substr(0,3):"long"===e?i[n.getDay()]:'Invalid format specified. Please use "short" or "long".'}}),Uz=Object.freeze({__proto__:null,Arc:vh,Area:ph,Circle:El,Group:Ea,Image:eh,Line:Xl,Path:ch,Rect:Kl,RichText:lh,Text:Fl}),Xz=Object.freeze({__proto__:null,CustomLayout:dz,TYPES:dx,register:DH,themes:q_}),$z=Object.freeze({__proto__:null,PluginManager:jz});t.Gantt=class extends Nz{options;container;tableNoFrameWidth;tableNoFrameHeight;tableX;tableY;scenegraph;stateManager;eventManager;taskListTableInstance;canvas;element;verticalSplitResizeLine;horizontalSplitLine;context;timeLineHeaderLevel;itemCount;drawHeight;headerHeight;gridHeight;pluginManager;parsedOptions={};taskTableWidth;taskTableColumns;records;data;constructor(t,e){super(),this.container=t,this.options=e,this.taskTableWidth="number"==typeof e?.taskListTable?.tableWidth?e?.taskListTable?.tableWidth:-1,this.taskTableColumns=e?.taskListTable?.columns??[],this.records=e?.records??[],this._sortScales(),Mw(this),function(t){if(!t.records||0===t.records.length)return;const e=t.parsedOptions.startDateField,i=t.parsedOptions.endDateField,n=(r,s,a)=>{let l=null,h=null;return r.forEach(((s,a)=>{if(!s)return;let d=null,c=null;if(s.children&&s.children.length>0&&s.type===o.PROJECT){const[l,h]=n(s.children);if(l&&h&&(d=l,c=h,s.type===o.PROJECT)){const n=t.parsedOptions.dateFormat??t.parseTimeFormat(s[e]||s.children[0][e]||""),o=e=>t.formatDate?t.formatDate(e,n):e.toISOString().split("T")[0],l={...s};l[e]=o(d),l[i]=o(c),r[a]=l}}else s[e]&&s[i]&&(d=new Date(s[e]),c=new Date(s[i]));d&&(!l||d<l)&&(l=d),c&&(!h||c>h)&&(h=c)})),[l,h]};n(t.records)}(this),this.data=new Gz(this),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this.element=function(t,e="vtable-gantt"){const i=document.createElement("div");i.setAttribute("tabindex","0"),i.classList.add(e),i.style.outline="none",i.style.margin=`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`;const n=(i.offsetWidth||i.parentElement?.offsetWidth||1)-1,o=(i.offsetHeight||i.parentElement?.offsetHeight||1)-1;return i.style.width=n&&n-t.left-t.right+"px"||"0px",i.style.height=o&&o-t.top-t.bottom+"px"||"0px",i}({top:0,right:0,left:0,bottom:0},"vtable-gantt"),this.element.style.left=this.taskTableWidth?`${this.taskTableWidth}px`:"0px",this.canvas=document.createElement("canvas"),this.element.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),t?(t.appendChild(this.element),this._updateSize()):this._updateSize(),this._generateListTable(),this._syncPropsFromTable(),function(t){if(t.taskListTableInstance){t.verticalSplitResizeLine=document.createElement("div"),t.verticalSplitResizeLine.style.position="absolute",t.verticalSplitResizeLine.style.top=t.tableY+"px",t.verticalSplitResizeLine.style.left=(t.taskTableWidth?t.taskTableWidth-7+t.parsedOptions.verticalSplitLine.lineWidth/2:0)+"px",t.verticalSplitResizeLine.style.width="14px",t.verticalSplitResizeLine.style.height=t.drawHeight+"px",t.verticalSplitResizeLine.style.backgroundColor="rgba(0,0,0,0)",t.verticalSplitResizeLine.style.zIndex="100",t.parsedOptions.verticalSplitLineMoveable&&(t.verticalSplitResizeLine.style.cursor="col-resize"),t.verticalSplitResizeLine.style.userSelect="none",t.verticalSplitResizeLine.style.opacity="1";const e=document.createElement("div");if(e.style.position="absolute",e.style.top="0px",e.style.left=(14-t.parsedOptions.verticalSplitLine.lineWidth)/2+"px",e.style.width=t.parsedOptions.verticalSplitLine.lineWidth+"px",e.style.height="100%",e.style.backgroundColor=t.parsedOptions.verticalSplitLine.lineColor,e.style.zIndex="100",e.style.userSelect="none",e.style.pointerEvents="none",e.style.transition="background-color 0.3s",t.verticalSplitResizeLine.appendChild(e),t.parsedOptions.verticalSplitLineHighlight){const e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left=(14-t.parsedOptions.verticalSplitLineHighlight.lineWidth)/2+"px",e.style.width=t.parsedOptions.verticalSplitLineHighlight.lineWidth+"px",e.style.height="100%",e.style.backgroundColor=t.parsedOptions.verticalSplitLineHighlight.lineColor,e.style.zIndex="100",e.style.cursor="col-resize",e.style.userSelect="none",e.style.pointerEvents="none",e.style.opacity="0",e.style.transition="background-color 0.3s",t.verticalSplitResizeLine.appendChild(e)}t.container.appendChild(t.verticalSplitResizeLine)}}(this),this.scenegraph=new Sz(this),this.stateManager=new Fz(this),this.eventManager=new Hz(this),this.scenegraph.afterCreateSceneGraph(),this._scrollToMarkLine(),this.pluginManager=new jz(this,e)}renderTaskBarsTable(){this.scenegraph.updateNextFrame()}_updateSize(){let t=0,e=0;if("browser"===NC.mode){const i=this.getElement();let n=0,o=0;if(i.parentElement){const t=i.parentElement.style||window.getComputedStyle(i.parentElement);n=i.parentElement.offsetWidth-parseInt(t.paddingLeft||"0px",10)-parseInt(t.paddingRight||"0px",10),o=i.parentElement.offsetHeight-parseInt(t.paddingTop||"0px",10)-parseInt(t.paddingBottom||"0px",20)}const r=(n??1)-1-this.taskTableWidth,s=(o??1)-1;i.style.width=r&&`${r}px`||"0px",i.style.height=s&&`${s}px`||"0px";const{canvas:a}=this;t=a.parentElement?.offsetWidth??1,e=a.parentElement?.offsetHeight??1,this?.scenegraph?.stage?this.scenegraph.stage.resize(t,e):(a.style.width="",a.style.height="",a.width=t,a.height=e,a.style.width=`${t}px`,a.style.height=`${e}px`)}const i=Math.floor(t-(n=this.parsedOptions.scrollStyle,n?.hoverOn||n?.verticalVisible&&"none"===n?.verticalVisible||!n?.verticalVisible&&"none"===n?.visible?0:n?.width??7));var n;const o=Math.floor(e-function(t){return t?.hoverOn||t?.horizontalVisible&&"none"===t?.horizontalVisible||!t?.horizontalVisible&&"none"===t?.visible?0:t?.width??7}(this.parsedOptions.scrollStyle));if(this.tableNoFrameWidth=t,this.tableNoFrameHeight=Math.floor(e),this.parsedOptions.outerFrameStyle){const t=this.parsedOptions.outerFrameStyle?.borderLineWidth;this.tableX=this.taskTableColumns.length>=1||this.options?.rowSeriesNumber?this.parsedOptions.verticalSplitLine.lineWidth??0:t,this.tableY=t,this.tableNoFrameWidth=Math.min(i-t-this.tableX,this.getAllDateColsWidth()),this.tableNoFrameHeight=o-2*t}}_updateListTableSize(t){if(t&&("auto"!==this.options?.taskListTable?.tableWidth&&-1!==this.taskTableWidth||(this.taskTableWidth=t.getAllColsWidth()+this.parsedOptions.outerFrameStyle.borderLineWidth,this.options?.taskListTable?.maxTableWidth&&(this.taskTableWidth=Math.min(this.options?.taskListTable?.maxTableWidth,this.taskTableWidth)),this.options?.taskListTable?.minTableWidth&&(this.taskTableWidth=Math.max(this.options?.taskListTable?.minTableWidth,this.taskTableWidth)),this.element.style.left=this.taskTableWidth?`${this.taskTableWidth}px`:"0px",t.setCanvasSize(this.taskTableWidth,this.tableNoFrameHeight+2*this.parsedOptions.outerFrameStyle.borderLineWidth),this._updateSize()),t.columnHeaderLevelCount>1))if(t.columnHeaderLevelCount===this.parsedOptions.timeLineHeaderRowHeights.length)for(let e=0;e<t.columnHeaderLevelCount;e++)t.setRowHeight(e,this.parsedOptions.timeLineHeaderRowHeights[e]);else{const e=this.getAllHeaderRowsHeight()/t.columnHeaderLevelCount;for(let i=0;i<t.columnHeaderLevelCount;i++)t.setRowHeight(i,e)}}_generateListTable(){if(this.taskTableColumns.length>=1||this.options?.rowSeriesNumber){const t=this._generateListTableOptions();this.taskListTableInstance=new lz(this.container,t),this._updateListTableSize(this.taskListTableInstance)}}_generateListTableOptions(){const t={},e=["container","records","rowSeriesNumber","overscrollBehavior","pixelRatio","eventOptions"];for(const i in this.options)e.indexOf(i)>=0&&(t[i]=this.options[i]);for(const e in this.options.taskListTable){if(t[e]=this.options.taskListTable[e],"columns"===e&&(t[e][t[e].length-1].disableColumnResize=!0,this.parsedOptions.tasksShowMode===n.Sub_Tasks_Inline||this.parsedOptions.tasksShowMode===n.Sub_Tasks_Separate||this.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange||this.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact))for(let e=0;e<t.columns.length;e++)t.columns[e].tree&&(t.columns[e].tree=!1);"hierarchyExpandLevel"!==e||this.parsedOptions.tasksShowMode!==n.Sub_Tasks_Inline&&this.parsedOptions.tasksShowMode!==n.Sub_Tasks_Separate&&this.parsedOptions.tasksShowMode!==n.Sub_Tasks_Arrange&&this.parsedOptions.tasksShowMode!==n.Sub_Tasks_Compact||delete t[e]}if(this.options.taskListTable?.theme)if(t.theme=this.options.taskListTable?.theme,t.theme.bodyStyle&&!function(t,e){const i=Object.getOwnPropertyDescriptor(t,e);return!(!i||!i.set&&!0!==i.writable)}(t.theme,"bodyStyle")){t.theme=(this.options.taskListTable?.theme).extends((this.options.taskListTable?.theme).getExtendTheme());const e=t.theme.getExtendTheme();t.theme.clearBodyStyleCache(),t.theme.headerStyle?.bgColor||(e.headerStyle?e.headerStyle.bgColor||(e.headerStyle.bgColor=this.parsedOptions.timelineHeaderBackgroundColor):e.headerStyle={bgColor:this.parsedOptions.timelineHeaderBackgroundColor}),e.bodyStyle?e.bodyStyle.frameStyle={borderLineWidth:[this.parsedOptions.horizontalSplitLine?.lineWidth??0,0,0,0],borderColor:this.parsedOptions.horizontalSplitLine?.lineColor}:e.bodyStyle={frameStyle:{borderLineWidth:[this.parsedOptions.horizontalSplitLine?.lineWidth??0,0,0,0],borderColor:this.parsedOptions.horizontalSplitLine?.lineColor}},e.cellInnerBorder=!1,e.frameStyle=Object.assign({},this.parsedOptions.outerFrameStyle,{shadowBlur:0,cornerRadius:[this.parsedOptions.outerFrameStyle?.cornerRadius??0,0,0,this.parsedOptions.outerFrameStyle?.cornerRadius??0],borderLineWidth:[this.parsedOptions.outerFrameStyle?.borderLineWidth??0,0,this.parsedOptions.outerFrameStyle?.borderLineWidth??0,this.parsedOptions.outerFrameStyle?.borderLineWidth??0]}),e.scrollStyle=Object.assign({},this.options.taskListTable?.theme?.scrollStyle,this.parsedOptions.scrollStyle,{verticalVisible:"none"}),e.columnResize=Object.assign({labelColor:"rgba(0,0,0,0)",labelBackgroundFill:"rgba(0,0,0,0)"},e?.columnResize),e.underlayBackgroundColor||(e.underlayBackgroundColor=this.parsedOptions.underlayBackgroundColor)}else t.theme.headerStyle?t.theme.headerStyle.bgColor||(t.theme.headerStyle.bgColor=this.parsedOptions.timelineHeaderBackgroundColor):t.theme.headerStyle={bgColor:this.parsedOptions.timelineHeaderBackgroundColor},t.theme.headerStyle=Object.assign({},j_.headerStyle,{bgColor:this.parsedOptions.timelineHeaderBackgroundColor},this.options.taskListTable?.theme?.headerStyle),t.theme.bodyStyle=Object.assign({},j_.bodyStyle,this.options.taskListTable?.theme?.bodyStyle,{frameStyle:{borderLineWidth:[this.parsedOptions.horizontalSplitLine?.lineWidth??0,0,0,0],borderColor:this.parsedOptions.horizontalSplitLine?.lineColor}}),t.theme.cellInnerBorder=!1,t.theme.frameStyle=Object.assign({},this.parsedOptions.outerFrameStyle,{cornerRadius:[this.parsedOptions.outerFrameStyle?.cornerRadius??0,0,0,this.parsedOptions.outerFrameStyle?.cornerRadius??0],borderLineWidth:[this.parsedOptions.outerFrameStyle?.borderLineWidth??0,0,this.parsedOptions.outerFrameStyle?.borderLineWidth??0,this.parsedOptions.outerFrameStyle?.borderLineWidth??0]}),t.theme.scrollStyle=Object.assign({},this.options.taskListTable?.theme?.scrollStyle,this.parsedOptions.scrollStyle,{verticalVisible:"none"}),t.theme.columnResize=Object.assign({labelColor:"rgba(0,0,0,0)",labelBackgroundFill:"rgba(0,0,0,0)"},this.options.taskListTable?.theme?.columnResize),t.theme.underlayBackgroundColor||(t.theme.underlayBackgroundColor=this.parsedOptions.underlayBackgroundColor);else t.theme={scrollStyle:Object.assign({},this.options.taskListTable?.theme?.scrollStyle,this.parsedOptions.scrollStyle,{verticalVisible:"none"}),headerStyle:Object.assign({},j_.headerStyle,{bgColor:this.parsedOptions.timelineHeaderBackgroundColor},this.options.taskListTable?.theme?.headerStyle),bodyStyle:Object.assign({},j_.bodyStyle,this.options.taskListTable?.theme?.bodyStyle,{frameStyle:{borderLineWidth:[this.parsedOptions.horizontalSplitLine?.lineWidth??0,0,0,0],borderColor:this.parsedOptions.horizontalSplitLine?.lineColor}}),cellInnerBorder:!1,frameStyle:Object.assign({},this.parsedOptions.outerFrameStyle,{cornerRadius:[this.parsedOptions.outerFrameStyle?.cornerRadius??0,0,0,this.parsedOptions.outerFrameStyle?.cornerRadius??0],borderLineWidth:[this.parsedOptions.outerFrameStyle?.borderLineWidth??0,0,this.parsedOptions.outerFrameStyle?.borderLineWidth??0,this.parsedOptions.outerFrameStyle?.borderLineWidth??0]}),columnResize:Object.assign({labelColor:"rgba(0,0,0,0)",labelBackgroundFill:"rgba(0,0,0,0)"},this.options.taskListTable?.theme?.columnResize),underlayBackgroundColor:this.parsedOptions.underlayBackgroundColor};return t.canvasWidth=this.taskTableWidth,t.canvasHeight=this.canvas.height,t.defaultHeaderRowHeight=this.getAllHeaderRowsHeight(),this.parsedOptions.tasksShowMode===n.Sub_Tasks_Separate?(t.customComputeRowHeight=t=>{const{row:e,table:i}=t,n=i.getRecordByRowCol(0,e);if(n)return(n.children?.length||1)*this.parsedOptions.rowHeight},t.defaultRowHeight="auto"):this.parsedOptions.tasksShowMode===n.Sub_Tasks_Compact?(t.customComputeRowHeight=t=>{const{row:e,table:i}=t,n=i.getRecordByRowCol(0,e);if(n)return function(t,e){if(!e.children||1===e.children.length)return 1===e.children?.length?e.children[0].vtable_gantt_showIndex=0:e.vtable_gantt_showIndex=0,1;const i=e.children.slice().sort(((e,i)=>{const{startDate:n}=Dw(t,e),{startDate:o}=Dw(t,i);return n.getTime()-o.getTime()})),n=[];for(let e=0;e<=i.length-1;e++){const o=i[e],{startDate:r,endDate:s}=Dw(t,o);let a=!1;for(let t=0;t<n.length;t++)if(r.getTime()>n[t]){n[t]=s.getTime(),a=!0,o.vtable_gantt_showIndex=t;break}a||(n.push(s.getTime()),o.vtable_gantt_showIndex=n.length-1)}return n.length}(this,n)*this.parsedOptions.rowHeight},t.defaultRowHeight="auto"):this.parsedOptions.tasksShowMode===n.Sub_Tasks_Arrange?(t.customComputeRowHeight=t=>{const{row:e,table:i}=t,n=i.getRecordByRowCol(0,e);if(n)return function(t,e){if(!e.children||1===e.children.length)return 1===e.children?.length?e.children[0].vtable_gantt_showIndex=0:e.vtable_gantt_showIndex=0,1;const i=[];for(let n=0;n<=e.children.length-1;n++){const o=e.children[n],{startDate:r,endDate:s}=Dw(t,o);let a=!1;for(let n=0;n<i.length;n++)if(!zw(r,s,e.children.filter((t=>t!==o&&t.vtable_gantt_showIndex===n)),t)){i[n]=s.getTime(),a=!0,o.vtable_gantt_showIndex=n;break}a||(i.push(s.getTime()),o.vtable_gantt_showIndex=i.length-1)}return i.length}(this,n)*this.parsedOptions.rowHeight},t.defaultRowHeight="auto"):t.defaultRowHeight=this.options.rowHeight??40,t.clearDOM=!1,t}getElement(){return this.element}getContainer(){return this.element.parentElement}_sortScales(){const{timelineHeader:t}=this.options;if(t){const e=t.scales,i=["year","quarter","month","week","day","hour","minute","second"];1===e.length&&("hour"!==e[0].unit&&"minute"!==e[0].unit&&"second"!==e[0].unit||(this.parsedOptions.timeScaleIncludeHour=!0));const n=e.slice().sort(((t,e)=>{"hour"!==t.unit&&"minute"!==t.unit&&"second"!==t.unit||(this.parsedOptions.timeScaleIncludeHour=!0);const n=i.indexOf(t.unit),o=i.indexOf(e.unit);return-1===n?1:-1===o?-1:n-o})),o=e.slice().sort(((t,e)=>{const n=i.indexOf(t.unit),o=i.indexOf(e.unit);return-1===n?1:-1===o?-1:o-n}));this.parsedOptions.sortedTimelineScales=n,this.parsedOptions.reverseSortedTimelineScales=o}}_generateTimeLineDateMap(){if(this.parsedOptions.minDate&&this.parsedOptions.maxDate)for(const t of this.parsedOptions.reverseSortedTimelineScales)t.timelineDates=Lw(new Date(this.parsedOptions.minDate),this.parsedOptions.maxDate,t)}getRowHeightByIndex(t){return this.taskListTableInstance?this.taskListTableInstance.getRowHeight(t+this.taskListTableInstance.columnHeaderLevelCount):this.parsedOptions.rowHeight}getRowsHeightByIndex(t,e){return this.taskListTableInstance?this.taskListTableInstance.getRowsHeight(t+this.taskListTableInstance.columnHeaderLevelCount,e+this.taskListTableInstance.columnHeaderLevelCount):this.parsedOptions.rowHeight*(e-t+1)}getAllRowsHeight(){return this.taskListTableInstance?this.taskListTableInstance.getAllRowsHeight():this.getAllHeaderRowsHeight()+this.itemCount*this.parsedOptions.rowHeight}getAllHeaderRowsHeight(){return this.parsedOptions.timeLineHeaderRowHeights.reduce(((t,e,i)=>!1===this.parsedOptions.sortedTimelineScales[i].visible?t:t+e),0)}getAllDateColsWidth(){return this.parsedOptions.timelineColWidth*(this.parsedOptions.reverseSortedTimelineScales[0].timelineDates?.length??0)}getAllTaskBarsHeight(){return this.taskListTableInstance?this.taskListTableInstance.getRowsHeight(this.taskListTableInstance.columnHeaderLevelCount,this.taskListTableInstance.rowCount-1):this.itemCount*this.parsedOptions.rowHeight}getRecordIndexByTaskShowIndex(t){return this.taskListTableInstance?this.taskListTableInstance.getRecordIndexByCell(0,this.taskListTableInstance.columnHeaderLevelCount+t):t}getTaskShowIndexByRecordIndex(t){return this.taskListTableInstance.getBodyRowIndexByRecordIndex(t)}getRecordByIndex(t,e){if(this.taskListTableInstance){if(XC(e)){const i=this.taskListTableInstance.getRecordByCell(0,t+this.taskListTableInstance.columnHeaderLevelCount);if(Array.isArray(e)){const n=this.getRecordIndexByTaskShowIndex(t),o=Array.isArray(n)?n.length:1,r=[...e];r.splice(0,o);let s=i;for(;r.length>0;){const t=r.shift();s=s?.children?.[t]}return s}return i?.children?.[e]}return this.taskListTableInstance.getRecordByCell(0,t+this.taskListTableInstance.columnHeaderLevelCount)}return this.records[t]}_refreshTaskBar(t,e){this.scenegraph.taskBar.updateTaskBarNode(t,e),this.scenegraph.refreshRecordLinkNodes(t,void 0,this.scenegraph.taskBar.getTaskBarNodeByIndex(t,e)),this.scenegraph.updateNextFrame()}_updateRecordToListTable(t,e){this.taskListTableInstance.updateRecords([t],[e])}getTaskInfoByTaskListIndex(t,e){const i=this.getRecordByIndex(t,e),n=i?.type,o=this.parsedOptions.startDateField,r=this.parsedOptions.endDateField,s=this.parsedOptions.progressField,a=PC(i?.[o]).getTime(),l=PC(i?.[r]).getTime();if(n&&!i?.[o]||!n&&(l<this.parsedOptions._minDateTime||a>this.parsedOptions._maxDateTime||!i?.[o]||!i?.[r]))return{taskDays:0,progress:0,startDate:null,endDate:null,taskRecord:i};const h=function(t){return"string"==typeof t&&(t=t.replace("%",""),t=parseFloat(t)),Math.round(t)}(i[s]);let d,c;this.parsedOptions.timeScaleIncludeHour?(d=PC(Math.min(Math.max(this.parsedOptions._minDateTime,a),this.parsedOptions._maxDateTime)),c=OC(Math.max(Math.min(this.parsedOptions._maxDateTime,l),this.parsedOptions._minDateTime),!0)):(d=PC(Math.min(Math.max(this.parsedOptions._minDateTime,a),this.parsedOptions._maxDateTime),!0),c=IC(Math.max(Math.min(this.parsedOptions._maxDateTime,l),this.parsedOptions._minDateTime),!0));return{taskRecord:i,taskDays:(c.getTime()-d.getTime()+1)/864e5,startDate:d,endDate:c,progress:h}}_updateStartDateToTaskRecord(t,e,i){const n=this.getRecordByIndex(e,i),o=this.parsedOptions.startDateField,r=_C(t,this.parsedOptions.dateFormat??TC(n[o]));if(n[o]=r,XC(i))Array.isArray(i)&&this.stateManager.updateProjectTaskTimes(i);else{const t=this.getRecordIndexByTaskShowIndex(e);this._updateRecordToListTable(n,t),Array.isArray(t)&&this.stateManager.updateProjectTaskTimes(t)}}_updateEndDateToTaskRecord(t,e,i){const n=this.getRecordByIndex(e,i),o=this.parsedOptions.endDateField,r=_C(t,this.parsedOptions.dateFormat??TC(n[o]));if(n[o]=r,XC(i))Array.isArray(i)&&this.stateManager.updateProjectTaskTimes(i);else{const t=this.getRecordIndexByTaskShowIndex(e);this._updateRecordToListTable(n,t),Array.isArray(t)&&this.stateManager.updateProjectTaskTimes(t)}}_updateStartEndDateToTaskRecord(t,e,i,n){const o=this.getRecordByIndex(i,n),r=this.parsedOptions.startDateField,s=this.parsedOptions.endDateField,a=this.parsedOptions.dateFormat??TC(o[r]),l=_C(t,a);o[r]=l;const h=_C(e,a);if(o[s]=h,XC(n))Array.isArray(n)&&this.stateManager.updateProjectTaskTimes(n);else{const t=this.getRecordIndexByTaskShowIndex(i);this._updateRecordToListTable(o,t),Array.isArray(t)&&this.stateManager.updateProjectTaskTimes(t)}}_dragOrderTaskRecord(t,e,i,n){this.data.adjustOrder(t,e,i,n)}updateTaskRecord(t,e,i){if(XC(i)){const n="number"==typeof e?e:e[0];return this._updateRecordToListTable(t,[n,i]),void this._refreshTaskBar(n,i)}if(Array.isArray(e)){const i=e[0],n=e[1];return this._updateRecordToListTable(t,e),void this._refreshTaskBar(i,n)}let n=e;"tree"===this.taskListTableInstance.rowHierarchyType&&(n=this.taskListTableInstance.getRecordIndexByCell(0,e+this.taskListTableInstance.columnHeaderLevelCount)),this._updateRecordToListTable(t,n),this._refreshTaskBar(e,void 0)}setPixelRatio(t){this.taskListTableInstance?.setPixelRatio(t),this.parsedOptions.pixelRatio=t,this.scenegraph.setPixelRatio(t)}updateTasksShowMode(t){this.options.tasksShowMode=t,this.updateOption(this.options)}_resize(){this._updateSize(),this.taskListTableInstance?.setCanvasSize(this.taskTableWidth,this.tableNoFrameHeight+2*this.parsedOptions.outerFrameStyle.borderLineWidth),this._syncPropsFromTable(),this.scenegraph.resize(),Ew(this)}_syncPropsFromTable(){this.itemCount=this.taskListTableInstance?this.taskListTableInstance.rowCount-this.taskListTableInstance.columnHeaderLevelCount:this.records.length,this.headerHeight=this.getAllHeaderRowsHeight(),this.drawHeight=Math.min(this.getAllRowsHeight(),this.tableNoFrameHeight),this.gridHeight=this.drawHeight-this.headerHeight}getContext(){return this.context}release(){super.release?.(),this.eventManager.release(),this.taskListTableInstance?.release();const{parentElement:t}=this.element;t&&(t.removeChild(this.element),this.verticalSplitResizeLine&&t.removeChild(this.verticalSplitResizeLine),this.horizontalSplitLine&&t.removeChild(this.horizontalSplitLine)),this.scenegraph=null,this.pluginManager.release()}updateOption(t){if(this.parsedOptions={},this.options=t,this.taskTableWidth="number"==typeof t?.taskListTable?.tableWidth?t?.taskListTable?.tableWidth:-1,this.taskTableColumns=t?.taskListTable?.columns??[],this.records=t?.records??[],this._sortScales(),Mw(this),this.data.setRecords(this.records),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this._updateSize(),this.taskListTableInstance){const t=this._generateListTableOptions();this.taskListTableInstance.updateOption(t),this._updateListTableSize(this.taskListTableInstance)}this._syncPropsFromTable(),this.scenegraph.updateStageBackground(),this.element.style.left=this.taskTableWidth?`${this.taskTableWidth}px`:"0px",Ew(this),this.scenegraph.updateSceneGraph(),this.scenegraph.afterCreateSceneGraph(),this._scrollToMarkLine()}setRecords(t){this.records=t,this.data.setRecords(t),function(t){const e=t.options,{unit:i,startOfWeek:n}=t.parsedOptions.reverseSortedTimelineScales[0];t.parsedOptions.markLine=kw(e?.markLine),t.parsedOptions.markLine?.length&&(t.parsedOptions.markLine?.every((t=>void 0===t.scrollToMarkLine))&&(t.parsedOptions.markLine[0].scrollToMarkLine=!0),t.parsedOptions.markLine?.find((t=>t.scrollToMarkLine))&&(t.parsedOptions.scrollToMarkLineDate=zC(new Date(t.parsedOptions.markLine?.find((t=>t.scrollToMarkLine)).date),i,n))),t.parsedOptions.dependencyLinks=e.dependency?.links??[]}(this),this.taskListTableInstance.setRecords(t),this._syncPropsFromTable(),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this._updateSize(),this.scenegraph.refreshAll(),this.verticalSplitResizeLine.style.height=this.drawHeight+"px";const e=this.stateManager.scroll.horizontalBarPos,i=this.stateManager.scroll.verticalBarPos;this.scenegraph.setX(-e),this.scenegraph.setY(-i)}updateScales(t){const e=this.parsedOptions.sortedTimelineScales.length;if(this.options.timelineHeader.scales=t,this._sortScales(),function(t){const e=t.options,{unit:i,startOfWeek:n,step:o}=t.parsedOptions.reverseSortedTimelineScales[0];t.parsedOptions.minDate=zC(new Date(t.parsedOptions.minDate),i,n),t.parsedOptions.maxDate=FC(t.parsedOptions.minDate,new Date(t.parsedOptions.maxDate),i,o),t.parsedOptions._minDateTime=t.parsedOptions.minDate?.getTime(),t.parsedOptions._maxDateTime=t.parsedOptions.maxDate?.getTime(),t.parsedOptions.timeLineHeaderRowHeights=[],t.parsedOptions.timelineHeaderStyles=[];for(let i=0;i<t.parsedOptions.sortedTimelineScales.length;i++){const n=t.parsedOptions.sortedTimelineScales[i].style;t.parsedOptions.timelineHeaderStyles.push(Object.assign({fontSize:20,fontWeight:"bold",textAlign:"center",textBaseline:"middle",color:"#000",backgroundColor:"#fff"},n)),t.parsedOptions.timeLineHeaderRowHeights.push(t.parsedOptions.sortedTimelineScales[i].rowHeight??e?.headerRowHeight??40)}}(this),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this.scenegraph.refreshAll(),Ew(this),this.taskListTableInstance)if(this.taskListTableInstance.columnHeaderLevelCount===this.parsedOptions.timeLineHeaderRowHeights.length)for(let t=0;t<this.taskListTableInstance.columnHeaderLevelCount;t++)this.taskListTableInstance.setRowHeight(t,this.parsedOptions.timeLineHeaderRowHeights[t]);else{const t=this.getAllHeaderRowsHeight()/this.taskListTableInstance.columnHeaderLevelCount;for(let e=0;e<this.taskListTableInstance.columnHeaderLevelCount;e++)this.taskListTableInstance.setRowHeight(e,t)}e!==t.length&&this._resize()}updateDateRange(t,e){this.options.minDate=t,this.options.maxDate=e,function(t){const e=t.options,{unit:i,startOfWeek:n,step:o}=t.parsedOptions.reverseSortedTimelineScales[0];t.parsedOptions.minDate=e?.minDate?zC(new Date(e.minDate),i,n):void 0,t.parsedOptions.maxDate=e?.maxDate?FC(t.parsedOptions.minDate,new Date(e.maxDate),i,o):void 0,t.parsedOptions._minDateTime=t.parsedOptions.minDate?.getTime(),t.parsedOptions._maxDateTime=t.parsedOptions.maxDate?.getTime()}(this),this._generateTimeLineDateMap(),this._updateSize(),this.scenegraph.refreshAll(),this._scrollToMarkLine()}updateMarkLine(t){this.options.markLine=t,Ww(this),this.scenegraph.markLine.refresh(),this.scenegraph.renderSceneGraph()}addMarkLine(t){this.options.markLine=[...this.parsedOptions.markLine,t],Ww(this),this.scenegraph.markLine.refresh(),this.scenegraph.renderSceneGraph(),this.scenegraph.updateNextFrame()}updateCurrentMarkLine(t){const e=this.parsedOptions.markLine.findIndex((e=>e.date===t.date));-1!==e&&(this.options.markLine=[...this.parsedOptions.markLine.slice(0,e),{...this.options.markLine[e],...t},...this.parsedOptions.markLine.slice(e+1)],Ww(this),this.scenegraph.markLine.refresh(),this.scenegraph.renderSceneGraph(),this.scenegraph.updateNextFrame())}_scrollToMarkLine(){if(this.parsedOptions.scrollToMarkLineDate&&this.parsedOptions.minDate){const t=this.parsedOptions.minDate,{unit:e,step:i}=this.parsedOptions.reverseSortedTimelineScales[0],n=DC(this.parsedOptions.scrollToMarkLineDate,t,e,i)*this.parsedOptions.timelineColWidth-this.tableNoFrameWidth/2;this.stateManager.setScrollLeft(n)}}scrollToMarkLine(t){if(!t||!this.parsedOptions.minDate)return;const e=this.parsedOptions.minDate,{unit:i,step:n}=this.parsedOptions.reverseSortedTimelineScales[0],o=DC(t,e,i,n)*this.parsedOptions.timelineColWidth-this.tableNoFrameWidth/2;this.stateManager.setScrollLeft(o)}addLink(t){this.parsedOptions.dependencyLinks.push(t),this.scenegraph.dependencyLink.initLinkLine(this.parsedOptions.dependencyLinks.length-1),this.scenegraph.updateNextFrame()}deleteLink(t){if(this.parsedOptions.dependencyLinkDeletable){const e=this.parsedOptions.dependencyLinks.findIndex((e=>e.type===t.type&&e.linkedFromTaskKey===t.linkedFromTaskKey&&e.linkedToTaskKey===t.linkedToTaskKey));if(-1!==e){const t=this.parsedOptions.dependencyLinks[e];this.parsedOptions.dependencyLinks.splice(e,1),this.scenegraph.dependencyLink.deleteLink(t),this.scenegraph.updateNextFrame()}}}get scrollTop(){return this.stateManager.scrollTop}set scrollTop(t){this.stateManager.setScrollTop(t)}get scrollLeft(){return this.stateManager.scrollLeft}set scrollLeft(t){this.stateManager.setScrollLeft(t)}getTaskBarRelativeRect(t){const e=this.scenegraph.taskBar.getTaskBarNodeByIndex(t);return{left:e.attribute.x+this.taskListTableInstance.tableNoFrameWidth+this.taskListTableInstance.tableX+this.tableX-this.scrollLeft,top:e.attribute.y+this.tableY+this.headerHeight-this.scrollTop,width:e.attribute.width,height:e.attribute.height}}getDateColWidth(t){return this.parsedOptions.timelineColWidth}getDateColsWidth(t,e){return(e-t+1)*this.parsedOptions.timelineColWidth}getDateRangeByIndex(t){const e=this.parsedOptions.reverseSortedTimelineScales[0];if(t<e.timelineDates.length){return{startDate:e.timelineDates[t].startDate,endDate:e.timelineDates[t].endDate}}return null}parseTimeFormat(t){return TC(t)}getTaskBarStyle(t,e){const{startDate:i,endDate:n,taskRecord:r}=this.getTaskInfoByTaskListIndex(t,e);let s;if(s=r.type===o.PROJECT?this.parsedOptions.projectBarStyle:this.parsedOptions.taskBarStyle,"function"==typeof s){return s({index:t,startDate:i,endDate:n,taskRecord:r,ganttInstance:this})}return s}formatDate(t,e){return _C(t,e)}},t.TYPES=s,t.VRender=Uz,t.VTable=Xz,t.plugins=$z,t.tools=Vz,t.version="1.18.6"}));